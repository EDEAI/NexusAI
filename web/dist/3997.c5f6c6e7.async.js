"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3997],{82826:function(H,S,r){r.d(S,{Z:function(){return d}});var E=r(1413),n=r(67294),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},f=N,b=r(91146),I=function(M,U){return n.createElement(b.Z,(0,E.Z)((0,E.Z)({},M),{},{ref:U,icon:f}))},D=n.forwardRef(I),d=D},81644:function(H,S,r){r.d(S,{Z:function(){return d}});var E=r(1413),n=r(67294),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"},f=N,b=r(91146),I=function(M,U){return n.createElement(b.Z,(0,E.Z)((0,E.Z)({},M),{},{ref:U,icon:f}))},D=n.forwardRef(I),d=D},2068:function(H,S,r){r.d(S,{Z:function(){return d}});var E=r(1413),n=r(67294),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},f=N,b=r(91146),I=function(M,U){return n.createElement(b.Z,(0,E.Z)((0,E.Z)({},M),{},{ref:U,icon:f}))},D=n.forwardRef(I),d=D},24805:function(H,S,r){r.d(S,{Hb:function(){return M},Ur:function(){return J},cN:function(){return Y},ej:function(){return U}});var E=r(15009),n=r.n(E),N=r(99289),f=r.n(N),b=r(47520),I="/v1/skill/skill_info/",D="/v1/skill/skill_update/",d="/v1/skill/skill_publish/",_="/v1/skill/skill_run",M=function(){var V=f()(n()().mark(function h(l,m){var C;return n()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,b.ZP)("".concat(I).concat(l),{method:"GET",data:{publish_status:m=="true"?1:0}});case 2:return C=O.sent,O.abrupt("return",C);case 4:case"end":return O.stop()}},h)}));return function(l,m){return V.apply(this,arguments)}}(),U=function(){var V=f()(n()().mark(function h(l){var m;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,b.ZP)("".concat(D).concat(l.app_id),{method:"PUT",data:l.data});case 2:return m=i.sent,i.abrupt("return",m);case 4:case"end":return i.stop()}},h)}));return function(l){return V.apply(this,arguments)}}(),Y=function(){var V=f()(n()().mark(function h(l){var m;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,b.ZP)("".concat(d).concat(l),{method:"PUT"});case 2:return m=i.sent,i.abrupt("return",m);case 4:case"end":return i.stop()}},h)}));return function(l){return V.apply(this,arguments)}}(),J=function(){var V=f()(n()().mark(function h(l){var m;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,b.ZP)("".concat(_),{method:"POST",data:l});case 2:return m=i.sent,i.abrupt("return",m);case 4:case"end":return i.stop()}},h)}));return function(l){return V.apply(this,arguments)}}()},18449:function(H,S,r){r.d(S,{Z:function(){return Ae}});var E=r(15009),n=r.n(E),N=r(97857),f=r.n(N),b=r(99289),I=r.n(b),D=r(5574),d=r.n(D),_=r(24805),M=r(37369),U=r(60271),Y=r(620),J=r(2216),V=r(34994),h=r(35312),l=r(45360),m=r(28036),C=r(47221),i=r(96486),O=r.n(i),B=r(67294),ve=r(19632),W=r.n(ve),ee=function(a){return a.filter(function(e,c){return a.indexOf(e)!==c})},he=function(a){var e=[];if(!a)return e.push({field:"input_variables",message:"Input variables cannot be empty",type:"error",code:"INPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!a.properties||O().isEmpty(a.properties))return e.push({field:"input_variables.properties",message:"At least one input variable must be defined",type:"error",code:"INPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var c=Object.keys(a.properties),j=ee(c);return j.length>0&&e.push({field:"input_variables.properties",message:"Duplicate variable names: ".concat(j.join(", ")),type:"error",code:"INPUT_VARIABLES_DUPLICATE"}),Object.entries(a.properties).forEach(function(Z){var w=d()(Z,2),s=w[0],p=w[1];(!p.name||p.name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!p.display_name||p.display_name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),p.name&&!/^[a-zA-Z0-9_]+$/.test(p.name)&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable name ".concat(p.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},ge=function(a){var e=[];if(!a)return e.push({field:"output_variables",message:"Output variables cannot be empty",type:"error",code:"OUTPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!a.properties||O().isEmpty(a.properties))return e.push({field:"output_variables.properties",message:"At least one output variable must be defined",type:"error",code:"OUTPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var c=Object.keys(a.properties),j=ee(c);return j.length>0&&e.push({field:"output_variables.properties",message:"Duplicate variable names: ".concat(j.join(", ")),type:"error",code:"OUTPUT_VARIABLES_DUPLICATE"}),Object.entries(a.properties).forEach(function(Z){var w=d()(Z,2),s=w[0],p=w[1];(!p.name||p.name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!p.display_name||p.display_name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),p.name&&!/^[a-zA-Z0-9_]+$/.test(p.name)&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable name ".concat(p.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},we=function(a){var e=[];if(!a||a.trim()==="")return e.push({field:"code",message:"Code cannot be empty",type:"error",code:"CODE_REQUIRED"}),{isValid:!1,errors:e};try{var c=JSON.parse(a);(!c.python3||c.python3.trim()==="")&&e.push({field:"code.python3",message:"Python code cannot be empty",type:"error",code:"PYTHON_CODE_REQUIRED"}),c.python3&&!c.python3.includes("def main(")&&e.push({field:"code.python3",message:"Code must contain main function definition",type:"warning",code:"MAIN_FUNCTION_MISSING"})}catch(j){e.push({field:"code",message:"Code format is incorrect, cannot parse JSON",type:"error",code:"CODE_INVALID_JSON"})}return{isValid:e.length===0,errors:e}},ye=function(a){var e=[];return(!a.name||a.name.trim()==="")&&e.push({field:"name",message:"Skill name cannot be empty",type:"error",code:"NAME_REQUIRED"}),{isValid:e.length===0,errors:e}},Ee=function(a){var e=[],c=ye(a);e.push.apply(e,W()(c.errors));var j=he(a.input_variables);e.push.apply(e,W()(j.errors));var Z=ge(a.output_variables);return e.push.apply(e,W()(Z.errors)),{isValid:e.length===0,errors:e}},be=function(a){var e={INPUT_VARIABLES_REQUIRED:"skill.message.inputerror1",INPUT_VARIABLES_EMPTY:"skill.message.inputerror1",OUTPUT_VARIABLES_REQUIRED:"skill.message.inputerror2",OUTPUT_VARIABLES_EMPTY:"skill.message.inputerror2",INPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",OUTPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",VARIABLE_NAME_REQUIRED:"skill.rules.name",VARIABLE_DISPLAY_NAME_REQUIRED:"skill.rules.displayname",VARIABLE_NAME_INVALID:"skill.rules.verifydescription",CODE_REQUIRED:"skill.message.codeerror",PYTHON_CODE_REQUIRED:"skill.message.codeerror",NAME_REQUIRED:"skill.message.nameerror",MAIN_FUNCTION_MISSING:"skill.message.mainfunction.missing"};return e[a]||"skill.message.defaulterror"},t=r(85893),Ie=function(a){var e,c,j=a.FourthlyValue,Z=a.Fourthlyref,w=a.handleBack,s=a.Skillinfo,p=a.Operationbentate,Re=a.skillid,Q=a.app_id,ke=a.skillupdata,Fe=a.isCreate,Pe=a.setSkillInfo,re=a.readOnly,ae=re===void 0?!1:re,o=(0,h.useIntl)(),Oe=(0,B.useState)(null),se=d()(Oe,2),te=se[0],Se=se[1],Ne=(0,B.useState)(!1),ne=d()(Ne,2),De=ne[0],z=ne[1],Me=(0,B.useState)(["input"]),ie=d()(Me,2),Ue=ie[0],le=ie[1],Ve=(0,B.useState)([]),oe=d()(Ve,2),ue=oe[0],je=oe[1],Te=(0,B.useState)(!1),de=d()(Te,2),Le=de[0],ce=de[1],_e=(0,B.useRef)();(0,B.useEffect)(function(){},[]);var Ce=function(){var L=I()(n()().mark(function R(){var k;return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,_.cN)(Q||s.app_id);case 2:k=y.sent,k.code==0?(l.ZP.success(o.formatMessage({id:"skill.publishsuccess"})),Pe(f()(f()({},s),{},{publish_status:1,app_publish_status:1}))):l.ZP.error(o.formatMessage({id:"skill.select.value"}));case 4:case"end":return y.stop()}},R)}));return function(){return L.apply(this,arguments)}}(),Be=function(){var L=I()(n()().mark(function R(k){var g,y,P,X,u,A,G,F;return n()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return z(!0),v.next=3,pe();case 3:if(g=v.sent,!(g===!1||!g||g.code!==0)){v.next=7;break}return z(!1),v.abrupt("return");case 7:return y=g.skill_id||Re||s.id,P=O().cloneDeep((s==null?void 0:s.input_variables)||{}),Object.entries(k).forEach(function(Ze){var K,q,fe=d()(Ze,2),$=fe[0],me=fe[1];if(P!=null&&(K=P.properties)!==null&&K!==void 0&&(q=K.hasOwnProperty)!==null&&q!==void 0&&q.call(K,$))if(P.properties[$].type==="file"){var T;P.properties[$].value=(T=me[0])===null||T===void 0||(T=T.response)===null||T===void 0||(T=T.data)===null||T===void 0?void 0:T.file_id}else P.properties[$].value=me}),X=f()(f()({},s),{},{code:JSON.stringify((s==null?void 0:s.code)||{}),test_input:P}),v.prev=11,console.log("Using skill_id for debug run:",y),v.next=15,(0,_.Ur)({skill_id:y,input_dict:X.test_input});case 15:F=v.sent,l.ZP.success(o.formatMessage({id:"skill.run.success"})),Se((u=F.data)===null||u===void 0?void 0:u.outputs),je(((A=F.data)===null||A===void 0?void 0:A.file_list)||[]),ce(!0),le([]),z(!1),(G=F.data)!==null&&G!==void 0&&G.error&&l.ZP.error(o.formatMessage({id:"skill.debug.run.error"},{error:F.data.error})),v.next=31;break;case 25:v.prev=25,v.t0=v.catch(11),z(!1),ce(!1),l.ZP.error(o.formatMessage({id:"skill.debug.run.failed"})),console.error("Skill run error:",v.t0);case 31:case"end":return v.stop()}},R,null,[[11,25]])}));return function(k){return L.apply(this,arguments)}}(),He=function(){var L=I()(n()().mark(function R(){return n()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:h.history.push("/Skill?app_id=".concat(Q||(s==null?void 0:s.app_id),"&type=false")),location.reload();case 2:case"end":return g.stop()}},R)}));return function(){return L.apply(this,arguments)}}(),pe=function(){var L=I()(n()().mark(function R(){var k,g,y,P;return n()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(k=Ee(s),k.isValid){u.next=8;break}if(g=k.errors.filter(function(A){return A.type==="error"}).map(function(A){try{return o.formatMessage({id:be(A.code)})}catch(G){return A.message}}),!(g.length>0)){u.next=6;break}return l.ZP.error(o.formatMessage({id:"skill.message.save.failed.validation"},{errors:g.join(`
`)})),u.abrupt("return",!1);case 6:y=k.errors.filter(function(A){return A.type==="warning"}).map(function(A){return A.message}),y.length>0&&l.ZP.warning(o.formatMessage({id:"skill.message.save.failed.warnings"},{warnings:y.join(`
`)}));case 8:return u.prev=8,u.next=11,ke();case 11:return P=u.sent,u.abrupt("return",P);case 15:return u.prev=15,u.t0=u.catch(8),l.ZP.error(o.formatMessage({id:"skill.conserve.failed"})),console.error("Save skill error:",u.t0),u.abrupt("return",!1);case 20:case"end":return u.stop()}},R,null,[[8,15]])}));return function(){return L.apply(this,arguments)}}(),xe=[{key:"input",label:o.formatMessage({id:"skill.inputsetting"}),children:(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:s!=null&&(e=s.input_variables)!==null&&e!==void 0&&e.properties&&Object.keys(s.input_variables.properties).length>0?(0,t.jsxs)(V.A,{formRef:_e,onFinish:Be,submitter:!1,children:[(0,t.jsx)(J.Z,{data:s==null||(c=s.input_variables)===null||c===void 0?void 0:c.properties}),(0,t.jsx)("div",{className:"flex gap-3 mt-6",children:(0,t.jsx)(m.ZP,{type:"primary",htmlType:"submit",loading:De,className:"flex-1",children:o.formatMessage({id:"skill.run"})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,t.jsx)(U.Z,{hasHover:!1,icon:"/icons/agent_skill.svg",title:o.formatMessage({id:"skill.debug.title"}),loadingText:o.formatMessage({id:"skill.debug.no.input.parameters"})})})})}];return(0,t.jsxs)("div",{style:{height:"calc(100vh-100px)",width:"100%"},children:[(0,t.jsxs)("div",{className:"flex align-center justify-between my-5 px-4",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[o.formatMessage({id:"skill.operationrun"}),ae&&(0,t.jsxs)("span",{className:"ml-2 text-sm text-gray-500 font-normal",children:["- ",o.formatMessage({id:"readonly.mode"})]})]}),!ae&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(m.ZP,{type:"primary",className:"min-w-24",onClick:pe,children:o.formatMessage({id:"skill.btn.save"})})}),(0,t.jsx)(m.ZP,{type:"primary",onClick:Ce,className:"ml-4 min-w-24",children:o.formatMessage({id:"skill.publish"})})]})]}),(0,t.jsxs)("div",{className:"h-[calc(100vh-160px)] overflow-y-auto px-4 relative flex flex-col gap-4",children:[(0,t.jsx)(C.Z,{activeKey:Ue,onChange:le,items:xe,size:"small",className:"[&_.ant-collapse-content-box]:bg-transparent [&_.ant-collapse-content-box]:p-0"}),Le&&(0,t.jsxs)("div",{className:" bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-[#555555] text-sm font-medium mb-4",children:o.formatMessage({id:"skill.runpreview"})}),(0,t.jsxs)("div",{className:"min-h-[calc(100vh-400px)] flex flex-col overflow-y-auto",children:[ue.length>0&&(0,t.jsx)("div",{children:(0,t.jsx)(M.Z,{files:ue,title:o.formatMessage({id:"agent.file.output"}),className:"mb-8 !mt-2"})}),(0,t.jsx)("div",{className:"mb-4 h-[calc(100vh-400px)]",children:(0,t.jsx)(Y.Z,{language:"python3",value:te&&te,showMaximize:!1,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:(0,t.jsx)("div",{children:o.formatMessage({id:"skill.debug.output.title"})})})})]})]})]}),(0,t.jsx)("div",{className:"h-[30px] w-1"})]})},Ae=Ie}}]);
