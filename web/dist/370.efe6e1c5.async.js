"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[370],{80459:function(ke,ge,t){var Ee=t(32332),K=t(67294),pe=t(85893),M=function(d){var be=d.width,ne=be===void 0?"40px":be,oe=d.bg,X=oe===void 0?"#F4F8F1":oe,J=d.rounded,h=J===void 0?"6px":J,S=d.data,U=d.imgWidth,Q=U===void 0?"18px":U,v=d.background;S!=null&&S.avatar&&(Q=ne);var k=v||X;return(0,pe.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:ne,height:ne,backgroundColor:k,borderRadius:h},children:(0,pe.jsx)("img",{src:S!=null&&S.avatar?S.avatar:(0,Ee.s9)("single",S==null?void 0:S.icon),style:{width:Q,height:Q,borderRadius:h},alt:""})})};ge.Z=(0,K.memo)(M)},94813:function(ke,ge,t){t.d(ge,{F:function(){return et}});var Ee=t(19632),K=t.n(Ee),pe=t(97857),M=t.n(pe),Pe=t(15009),d=t.n(Pe),be=t(99289),ne=t.n(be),oe=t(13769),X=t.n(oe),J=t(5574),h=t.n(J),S=t(47635),U=t(43722),Q=t(80459),v=t(27522),k=t(77295),O=t(39e3),w=t(32332),R=t(77171),se=t(69753),Se=t(97245),Ce=t(88484),Ue=t(30159),Oe=t(2068),we=t(41428),Ze=t(64317),W=t(35312),He=t(26915),le=t(55060),m=t(66309),g=t(83062),Z=t(28036),q=t(74330),H=t(45360),F=t(20640),de=t.n(F),Te=t(55026),Re=t(96486),ye=t.n(Re),s=t(67294),ee=t(22683),De=t(97807),e=t(85893),re=["node","className","children"],ce=["node"],Le=He.Z.TextArea,me=function(l,f){try{var i=document.createElement("a");i.href=l,i.download=f,i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(I){}},We=(0,s.memo)(function(n){var l=n.setInstruction,f=n.messageApi,i=n.isStop,I=n.scrollDomRef,j=n.upButtonDom,b=n.abilitiesList,p=(0,W.useIntl)(),E=(0,O.Z)(function(_){return _.disableInput}),a=(0,O.Z)(function(_){return _.setDisableInput}),r=(0,s.useState)(null),o=h()(r,2),T=o[0],N=o[1],c=(0,k.ZP)({maxSizeMB:15,acceptedFileTypes:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg",multiple:!0}),D=c.uploadedFiles,u=c.handleUpload,te=c.removeFile,ue=c.clearFiles,ve=c.isUploading,_e=(0,s.useState)(""),P=h()(_e,2),G=P[0],z=P[1],fe=function(C){(D==null?void 0:D.length)>0?(l(["FILELIST",D.map(function(ie){return ie.file_id})]),T&&l(["SETABILITY",T]),setTimeout(function(){l(["INPUT",C]),D.length>0&&ue()},300)):(T&&l(["SETABILITY",T]),setTimeout(function(){l(["INPUT",C])},300))},he=function(C){!C.shiftKey&&C.target.value==""&&(f.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),z(""),C.preventDefault()),!C.shiftKey&&C.keyCode==13&&C.target.value!=""&&(a(!0),z(""),fe(C.target.value),C.preventDefault())},A=(0,Re.throttle)(function(){l(["STOP",null])},300),ae=function(){E||u()};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:j,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(C){I.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(R.Z,{className:"text-[16px]"})}),(0,e.jsx)(le.Z.PreviewGroup,{children:D.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map(function(_){return(0,e.jsx)(m.Z,{closable:!0,onClose:function(){return te(_.uid)},className:"flex items-center ".concat(_.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(g.Z,{title:_.name,children:(0,e.jsx)("div",{className:"flex items-center",children:_.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(le.Z,{src:_.path_show||_.url,alt:_.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:_.path_show||_.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:_.name}),(0,e.jsx)(se.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(ie){ie.stopPropagation(),me(_.path_show||_.url,_.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Se.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:_.name}),(0,e.jsx)(se.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(ie){ie.stopPropagation(),me(_.path_show||_.url,_.name)}})]})})})},_.uid)})})})}),(b==null?void 0:b.length)>0&&(0,e.jsx)(Ze.Z,{label:p.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:b,initialValue:T,fieldProps:{placeholder:p.formatMessage({id:"agent.pleaseselect"}),size:"small",onChange:function(C){N(C)}},formItemProps:{className:"mb-0 flex-1"}}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] ".concat(D.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,e.jsx)(Z.ZP,{type:"text",icon:(0,e.jsx)(Ce.Z,{}),onClick:ae,disabled:E||ve,loading:ve}),(0,e.jsx)(Le,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:G,disabled:E,onChange:function(C){z(C.target.value)},onPressEnter:he,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(p.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),i?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:A,children:(0,e.jsx)(Ue.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(E||!G?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Re.throttle)(function(){if(E||!G)return!1;G||f.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),a(!0),fe(G),z("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),xe=function n(l){return typeof l=="string"?l:Array.isArray(l)?l.map(n).join(""):s.isValidElement(l)?n(l.props.children):""},Be=function(l){return xe(l)},Ne=function(l,f){return{code:function(I){var j=I.node,b=I.className,p=I.children,E=X()(I,re),a=/language-(\w+)/.exec(b||"");if(a!=null&&a.length){var r=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:a[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var o=ne()(d()().mark(function T(N){var c;return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,c=N.currentTarget,u.next=4,de()(Be(p));case 4:c&&(c.children[1].innerText=f.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){c&&(c.children[1].innerText=f.formatMessage({id:"app.chatroom.content.copycode"}))},200),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(0),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},T,null,[[0,8]])}));return function(T){return o.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:f.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(r).concat(l),className:"p-4",children:p})})]})}else return(0,e.jsx)("code",M()(M()({},E),{},{children:p}))},img:function(I){var j=I.node,b=X()(I,ce);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(le.Z,{src:b.src,alt:b.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(Z.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(se.Z,{}),onClick:function(E){E.stopPropagation(),me(b.src||"",b.alt||"image.png")}})})]})}}},L=(0,s.memo)(function(n){var l=n.messageApi,f=n.index,i=n.idName,I=n.cidName,j=(0,W.useIntl)(),b=(0,s.useState)(!1),p=h()(b,2),E=p[0],a=p[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){a(!0)},onMouseLeave:function(){a(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var r=ne()(d()().mark(function o(T){var N,c;return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return N=T.target.closest("#".concat(i).concat(f)),c=N.querySelector("#".concat(I).concat(f)),u.prev=2,u.next=5,de()(c.innerText);case 5:l.open({type:"success",content:j.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(2),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},o,null,[[2,8]])}));return function(o){return r.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(E?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(E?" text-[#1B64F3]":"text-[#666]"),children:j.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Ge=function(l){var f=l.id,i=l.index,I=l.idName,j=l.cidName,b=(0,W.useIntl)(),p=(0,O.Z)(function(c){return c.setSummaryClick}),E=(0,s.useState)(!0),a=h()(E,2),r=a[0],o=a[1],T=(0,O.Z)(function(c){return c.summaryClick});(0,s.useEffect)(function(){o(T)},[T]);var N=(0,O.Z)(function(c){return c.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(r?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(D){if(r){var u=D.target.closest("#".concat(I).concat(i)),te=u.querySelector("#".concat(j).concat(i));N({id:f,message:te.innerText}),p(!1)}},children:[(0,e.jsx)(Oe.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:b.formatMessage({id:"app.chatroom.content.summary"})})]})})},y=function(l){var f=l.roomid,i=(0,W.useIntl)(),I=(0,O.Z)(function(o){return o.setSummaryClick}),j=(0,s.useState)(!0),b=h()(j,2),p=b[0],E=b[1],a=(0,O.Z)(function(o){return o.summaryClick});(0,s.useEffect)(function(){E(a)},[a]);var r=(0,O.Z)(function(o){return o.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(p?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){p&&(r({id:f}),I(!1))},children:[(0,e.jsx)(we.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:i.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Me=(0,s.memo)(function(n){var l=n.messageApi,f=n.setCurrentMessageContent,i=n.sendValue,I=n.agentList,j=n.scrollDomRef,b=n.upButtonDom,p=n.setIsStop,E=n.setisEnd,a=n.setSendValue,r=n.agentChatRoomId,o=(0,W.useIntl)(),T=(0,W.useParams)(),N=T.id,c=(0,W.useLocation)(),D=new URLSearchParams(c.search),u=D.get("id"),te=r||N||u,ue=(0,O.Z)(function(Ae){return Ae.setDisableInput}),ve=(0,s.useState)({}),_e=h()(ve,2),P=_e[0],G=_e[1],z=(0,s.useRef)(!1),fe=(0,s.useRef)(""),he=(0,O.Z)(function(Ae){return Ae.setTruncatable}),A=function(ze){var $=ze.data;if($.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var Ie=JSON.parse($.slice(22,-2));switch(Ie[0]){case"ERROR":ue(!1),p(!1),a(""),l.open({type:"error",content:"webSocket-".concat(Ie[1]),duration:10});break;case"CHAT":var $e={content:"".concat(Ie[1]),is_agent:0};f(function(B){return[].concat(K()(B),[$e])}),setTimeout(function(){j.current.scrollTop=0,b.current.style.display="none"});break;case"WITHFILELIST":f(function(B){var x=K()(B);return x.length&&(x[x.length-1].file_list=Ie[1]),x}),setTimeout(function(){j.current.scrollTop=0,b.current.style.display="none"});break;case"STOPPABLE":p(Ie[1]);break;case"TRUNCATABLE":he(Ie[1]),Ie[1]||l.open({type:"success",content:"".concat(o.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":l.open({type:"success",content:"".concat(o.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if($.indexOf("REPLY")!==-1&&$.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var Xe=JSON.parse($.slice(22,-2))[1];fe.current="",z.current=!0;var je=I.current.filter(function(B){return B.agent_id==Xe})[0];Object.keys(P).length&&f(function(B){return[].concat(K()(B),[P])}),G(function(B){return M()(M()({},B),{},{is_agent:1,icon:je==null?void 0:je.icon,name:je==null?void 0:je.name})}),p(!0),he(!1)}if($.indexOf("ABILITY")!==-1&&$.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var Je=JSON.parse($.slice(22,-2))[1];G(function(B){return M()(M()({},B),{},{is_agent:1,ability_id:Je})})}$.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&z.current&&(j.current.scrollTop=0,b.current.style.display="none",fe.current+=$,G(function(B){return M()(M()({},B),{},{content:fe.current})})),$.indexOf("ENDCHAT")!==-1&&(z.current=!1,fe.current="",ue(!1),p(!1),he(!0),Object.keys(P).length&&f(function(B){return[].concat(K()(B),[P])}),G({}),E(!0),a(""))},ae=(0,S.Z)("chat",A),_=ae.runSocket,C=ae.sendMessage,ie=ae.readyState;return(0,s.useEffect)(function(){ie==1&&te&&C(JSON.stringify(["ENTER",parseInt(te)]))},[ie]),(0,s.useEffect)(function(){i&&ie==1&&C(i)},[i]),(0,s.useEffect)(function(){_()},[]),(0,e.jsx)(e.Fragment,{children:P.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(P.is_agent!=1?"flex-row-reverse":""),children:[P.is_agent==1?(0,e.jsx)(Q.Z,{data:P}):(0,e.jsx)(Q.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(r?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(P.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:P.name?P.name:(0,w.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(P.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:P.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:[P.file_list&&P.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(v.Z,{fileList:P.file_list,onDownload:me})}),(0,e.jsx)(ee.U,{rehypePlugins:[De.Z],components:Ne("add",o),children:P.content})]})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Ye=(0,s.memo)(function(n){var l=n.messageApi,f=n.setUserMessage,i=n.sendValue,I=n.agentList,j=n.scrollDomRef,b=n.upButtonDom,p=n.setIsStop,E=n.setSendValue,a=n.agentChatRoomId,r=n.abilitiesList,o=(0,W.useIntl)(),T=(0,s.useState)([]),N=h()(T,2),c=N[0],D=N[1],u=(0,s.useState)(!1),te=h()(u,2),ue=te[0],ve=te[1],_e=(0,W.useParams)(),P=_e.id,G=(0,W.useLocation)(),z=new URLSearchParams(G.search),fe=z.get("id"),he=P||fe;return(0,s.useEffect)(function(){ue&&(f(function(A){return[].concat(K()(c.reverse()),K()(A))}),D([]),setTimeout(function(){ve(!1),j.current.scrollTop=0},200))},[ue]),(0,e.jsxs)(e.Fragment,{children:[c.length?c.map(function(A,ae){var _;return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(A.is_agent!=1?"flex-row-reverse":""),children:[A.is_agent==1?(0,e.jsx)(Q.Z,{data:A}):(0,e.jsx)(Q.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"currentContent".concat(ae),children:[(0,e.jsxs)("div",{className:"".concat(A.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[A.name?A.name:(0,w.Qy)("GET").nickname,A.name&&A.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((_=r.find(function(C){return A.ability_id==C.value}))===null||_===void 0?void 0:_.label)||"\u672A\u627E\u5230\u8BE5\u80FD\u529B",")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(A.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:A.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(ae),children:[A.file_list&&A.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(v.Z,{fileList:A.file_list,onDownload:me})}),(0,e.jsx)(ee.U,{rehypePlugins:[De.Z],components:Ne(ae,o),children:A.content})]})}),A.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(L,{messageApi:l,index:ae,idName:"currentContent",cidName:"currentChilContent"}),!a&&(0,e.jsx)(Ge,{id:he,index:ae,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},ae)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Me,{messageApi:l,setCurrentMessageContent:D,sendValue:i,agentList:I,scrollDomRef:j,upButtonDom:b,setIsStop:p,setisEnd:ve,setSendValue:E,agentChatRoomId:a})]})}),qe=(0,s.memo)(function(n){var l=n.messageApi,f=n.scrollDomRef,i=n.instruction,I=n.setIsStop,j=n.upButtonDom,b=n.setInstruction,p=n.agentList,E=n.agentChatRoomId,a=n.abilitiesList,r=(0,W.useIntl)(),o=(0,s.useState)(860),T=h()(o,2),N=T[0],c=T[1],D=(0,W.useParams)(),u=D.id,te=(0,W.useLocation)(),ue=new URLSearchParams(te.search),ve=ue.get("id"),_e=E||u||ve,P=(0,s.useState)([]),G=h()(P,2),z=G[0],fe=G[1],he=(0,s.useRef)(!1),A=(0,s.useState)(""),ae=h()(A,2),_=ae[0],C=ae[1],ie=(0,s.useRef)(null),Ae=(0,s.useRef)(!0),ze=(0,s.useRef)(2),$=(0,s.useRef)(1),Ie=(0,s.useRef)(0),$e=function(){var x=ne()(d()().mark(function V(Y){var Ve,Fe,Qe=arguments;return d()().wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:if(Ve=Qe.length>1&&Qe[1]!==void 0?Qe[1]:function(){},!_e){Ke.next=6;break}return Ke.next=4,(0,U.KH)(_e,{page:$.current,page_size:10});case 4:Fe=Ke.sent,Fe.code==0&&(ze.current=Fe.data.total_pages,Y||(ie.current.style.display="none"),fe(function(tt){return Y?K()(Fe.data.list.reverse()):[].concat(K()(tt),K()(Fe.data.list.reverse()))}),Y?f&&f.current&&setTimeout(function(){f.current.scrollTop=0,j.current.style.display="none"}):Ie.current=Fe.data.list.length,Ae.current=!0);case 6:case"end":return Ke.stop()}},V)}));return function(Y){return x.apply(this,arguments)}}(),Xe=function(V){var Y=V.target.scrollHeight+(V.target.scrollTop-V.target.clientHeight);he.current!==Math.ceil(V.target.scrollTop)<-50&&(he.current=Math.ceil(V.target.scrollTop)<-50,j.current.style.display=he.current?"flex":"none"),Y<10&&Ae.current&&(Ae.current=!1,$.current=$.current+1,ie.current.style.display="flex",ze.current>=$.current?$e(!1):ie.current.style.display="none")},je=function(V,Y){Y==="0"&&(Y=Number(Y));var Ve=["".concat(V),Y===0||Y?Y:null];C(JSON.stringify(Ve))},Je=(0,O.Z)(function(x){return x.disableInput}),B=(0,O.Z)(function(x){return x.clearMemory});return(0,s.useEffect)(function(){B&&B.length&&je(B[0],B[1])},[B]),(0,s.useEffect)(function(){i&&i.length&&(je(i[0],i[1]?i[1]:""),b([]))},[i]),(0,s.useEffect)(function(){$.current=1,$e(!0)},[]),(0,s.useEffect)(function(){var x=function(){window.innerWidth<1280||c(window.innerWidth-320-(window.innerWidth-320)/2-88)};return x(),window.addEventListener("resize",x),function(){window.removeEventListener("resize",x)}},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:f,onScroll:Xe,children:[(0,e.jsxs)("div",{style:{minWidth:E?"":"".concat(N,"px")},children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:z&&z.length?z.map(function(x,V){var Y;return(0,e.jsxs)("div",{id:"c".concat(x.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(x.is_agent!=1?"flex-row-reverse":""),children:[x.is_agent==1?(0,e.jsx)(Q.Z,{data:x}):(0,e.jsx)(Q.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(E?"":"max-w-[560px]"," text-right"),id:"content".concat(V),children:[(0,e.jsxs)("div",{className:"".concat(x.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[x.name?x.name:(0,w.Qy)("GET").nickname,x.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((Y=a.find(function(Ve){return x.ability_id==Ve.value}))===null||Y===void 0?void 0:Y.label)||r.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(x.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:x.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(V),children:[x.file_list&&x.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(v.Z,{fileList:x.file_list,onDownload:me})}),(0,e.jsx)(ee.U,{rehypePlugins:[De.Z],components:Ne(V,r),children:x.content})]})}),x.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(L,{messageApi:l,idName:"content",cidName:"chilContent",index:V}),!E&&(0,e.jsx)(Ge,{id:_e,index:V,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},V)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(Ye,{messageApi:l,setUserMessage:fe,sendValue:_,agentList:p,scrollDomRef:f,upButtonDom:j,setIsStop:I,setSendValue:C,agentChatRoomId:E,abilitiesList:a})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!E&&!Je&&z.length?(0,e.jsx)(y,{roomid:_e}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:ie,children:(0,e.jsx)(q.Z,{})})]})})}),et=(0,s.memo)(function(n){var l=n.agentList,f=n.agentChatRoomId,i=n.abilitiesList,I=(0,s.useRef)(null),j=(0,s.useRef)(null),b=(0,s.useState)(!1),p=h()(b,2),E=p[0],a=p[1],r=(0,s.useState)([]),o=h()(r,2),T=o[0],N=o[1],c=(0,W.useParams)(),D=c.id,u=(0,W.useLocation)(),te=new URLSearchParams(u.search),ue=te.get("id"),ve=D||ue,_e=H.ZP.useMessage(),P=h()(_e,2),G=P[0],z=P[1];return(0,e.jsxs)(e.Fragment,{children:[z,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(f?"w-full":""),children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(qe,{instruction:T,setInstruction:N,messageApi:G,scrollDomRef:I,setIsStop:a,upButtonDom:j,agentList:l,agentChatRoomId:f,abilitiesList:i}),(0,e.jsx)(We,{setInstruction:N,messageApi:G,isStop:E,upButtonDom:j,scrollDomRef:I,abilitiesList:i})]})})]})})},27522:function(ke,ge,t){var Ee=t(55060),K=t(28036),pe=t(69753),M=t(97245),Pe=t(77295),d=t(85893),be=function(X,J){try{var h=document.createElement("a");h.href=X,h.download=J,h.target="_blank",document.body.appendChild(h),h.click(),document.body.removeChild(h)}catch(S){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",S)}},ne=function(X){var J=X.fileList,h=X.onDownload,S=h===void 0?be:h,U=X.className,Q=U===void 0?"":U,v=X.showInGrid,k=v===void 0?!1:v,O=X.maxHeight;return!J||J.length===0?null:(0,d.jsx)("div",{className:"mb-2 ".concat(Q),style:{maxHeight:O,overflow:O?"auto":"visible"},children:(0,d.jsx)(Ee.Z.PreviewGroup,{children:(0,d.jsx)("div",{className:"".concat(k?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:J.map(function(w,R){var se=w.path_show||w.url,Se=(0,Pe.CO)(w.name);return(0,d.jsx)("div",{className:"".concat(k?"":"mb-2"),children:Se?(0,d.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,d.jsx)(Ee.Z,{src:se,alt:w.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,d.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,d.jsx)(K.ZP,{type:"primary",size:"small",icon:(0,d.jsx)(pe.Z,{}),onClick:function(Ue){Ue.stopPropagation(),S(se,w.name)}})})]}):(0,d.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,d.jsx)(M.Z,{className:"mr-2 flex-shrink-0"}),(0,d.jsx)("span",{className:"text-sm truncate",children:w.name})]}),(0,d.jsx)(K.ZP,{type:"text",size:"small",icon:(0,d.jsx)(pe.Z,{}),onClick:function(){return S(se,w.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(w.uid||w.file_id||R))})})})})};ge.Z=ne},85877:function(ke,ge,t){var Ee=t(19632),K=t.n(Ee),pe=t(97857),M=t.n(pe),Pe=t(5574),d=t.n(Pe),be=t(52677),ne=t.n(be),oe=t(35312),X=t(78234),J=t(77598),h=t(96486),S=t.n(h),U=t(67294),Q=t(73935),v=t(43413),k=t(92858),O=t(16845),w=t(15425),R=t(85893),se=function(m){var g=m.children;return(typeof document=="undefined"?"undefined":ne()(document))==="object"?Q.createPortal(g,document.body):null},Se=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ce=function(m){var g=m.value,Z=m.onChange,q=m.id,H=m.placeholder,F=m.options,de=(0,oe.useIntl)(),Te=(0,U.useRef)(),Re=(0,U.useState)(),ye=d()(Re,2),s=ye[0],ee=ye[1],De=(0,U.useState)(0),e=d()(De,2),re=e[0],ce=e[1],Le=(0,U.useState)(""),me=d()(Le,2),We=me[0],xe=me[1],Be=(0,U.useCallback)(function(a){return(0,R.jsx)(Ze,M()({},a))},[]),Ne=(0,U.useCallback)(function(a){return(0,R.jsx)(we,M()({},a))},[]),L=(0,U.useMemo)(function(){return Ue((0,O.BU)((0,k.VC)((0,v.Jh)())))},[]),Ge=(0,U.useState)(null),y=d()(Ge,2),Me=y[0],Ye=y[1],qe=(0,w.Z)(function(a){return a.selectedNode}),et=(0,w.Z)(function(a){return a.getOutputVariables}),n=(0,w.Z)(function(a){return a.getInputVariables}),l=(0,U.useState)([]),f=d()(l,2),i=f[0],I=f[1];(0,X.Z)(function(){g&&g.length>0&&j(g),F!=null&&F.length&&I(F.map(function(a){return M()(M()({},a),{},{name:a.label,id:a.value})}))}),(0,J.Z)(function(){var a=S().isEqual(Me,g);a||(g&&g.length>0?j(g):g&&S().isArray(g)&&g.length==0&&j([{type:"paragraph",children:[]}]))},[g,q]),(0,J.Z)(function(){F.length&&I(F.map(function(a){return M()(M()({},a),{},{name:a.label,id:a.value})})),console.log(F)},[F]);var j=function(r){Ye(r),p(L,{nodes:[{type:"paragraph",children:[]}]}),p(L,{nodes:r})},b=(0,U.useCallback)(function(a){if(s&&i.length>0)switch(a.key){case"ArrowDown":a.preventDefault();var r=re>=i.length-1?0:re+1;ce(r);return;case"ArrowUp":a.preventDefault();var o=re<=0?i.length-1:re-1;ce(o);return;case"Tab":case"Enter":a.preventDefault(),v.YR.select(L,s),Oe(L,i[re]),ee(null);return;case"Escape":a.preventDefault(),ee(null);return}else if(a.key==="@"){setTimeout(function(){return E()},10);return}ee(null)},[i,L,re,s]),p=function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},T=K()(r.children);if(T.forEach(function(D){return r.apply({type:"remove_node",path:[0],node:D})}),o.nodes){var N=v.NB.isNode(o.nodes)?[o.nodes]:o.nodes;N.forEach(function(D,u){return r.apply({type:"insert_node",path:[u],node:D})})}var c=o.at&&v.E9.isPoint(o.at)?o.at:v.ML.end(r,[]);c&&v.YR.select(r,c)};(0,U.useEffect)(function(){if(s&&i.length>0){var a=Te.current,r=O.F3.toDOMRange(L,s),o=r.getBoundingClientRect();a.style.top="".concat(o.top+window.pageYOffset+24,"px"),a.style.left="".concat(o.left+window.pageXOffset,"px")}},[i.length,L,re,We,s]);var E=function(){var r=L.selection;if(r&&v.e6.isCollapsed(r)){var o=v.e6.edges(r),T=d()(o,1),N=T[0],c=v.ML.before(L,N),D=c&&v.ML.range(L,c,N),u=D&&v.ML.string(L,D),te=v.ML.after(L,N),ue=v.ML.range(L,N,te),ve=v.ML.string(L,ue);ee(D),xe(""),ce(0);return}ee(null)};return(0,R.jsxs)(O.mH,{editor:L,initialValue:He,onChange:function(r){Z==null||Z(r),ee(null)},children:[(0,R.jsx)(O.CX,{renderElement:Be,renderLeaf:Ne,onKeyDown:b,className:"!outline-none",placeholder:H!=null?H:de.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),s&&(0,R.jsx)(se,{children:(0,R.jsx)("div",{ref:Te,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:i.length?i.map(function(a,r){return(0,R.jsx)("div",{onClick:function(){console.log(a),v.YR.select(L,s),Oe(L,a),ee(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:r===re?"#B4D5FF":""},children:(0,R.jsx)("span",{children:a.name})},a.name+r)}):(0,R.jsx)(R.Fragment,{children:de.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Ue=function(m){var g=m.isInline,Z=m.isVoid,q=m.markableVoid;return m.isInline=function(H){return H.type==="mention"?!0:g(H)},m.isVoid=function(H){return H.type==="mention"?!0:Z(H)},m.markableVoid=function(H){return H.type==="mention"||q(H)},m},Oe=function(m,g){var Z={type:"mention",id:(g==null?void 0:g.id)||"",character:g.name,base:g,children:[{bold:!0,text:"11111"}]};v.YR.insertNodes(m,Z),v.YR.move(m)},we=function(m){var g=m.attributes,Z=m.children,q=m.leaf;return(0,R.jsx)("span",M()(M()({},g),{},{children:Z}))},Ze=function(m){var g=m.attributes,Z=m.children,q=m.element;switch(q.type){case"mention":return(0,R.jsx)(W,M()({},m));default:return(0,R.jsx)("p",M()(M()({},g),{},{children:Z}))}},W=function(m){var g=m.attributes,Z=m.children,q=m.element,H=(0,O.vt)(),F=(0,O.UE)(),de={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:H&&F?"0 0 0 2px #B4D5FF":"none"};return q.children[0].bold&&(de.fontWeight="bold"),q.children[0].italic&&(de.fontStyle="italic"),(0,R.jsx)("span",M()(M()({},g),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(q.character.replace(" ","-")),style:de,children:Se?(0,R.jsxs)(U.Fragment,{children:["1",Z,"/",q.character]}):(0,R.jsxs)(U.Fragment,{children:[(0,R.jsx)("span",{children:q.character}),Z]})}))},He=[{type:"paragraph",children:[{text:""}]}];ge.Z=Ce},77295:function(ke,ge,t){t.d(ge,{CO:function(){return S}});var Ee=t(15009),K=t.n(Ee),pe=t(19632),M=t.n(pe),Pe=t(99289),d=t.n(Pe),be=t(5574),ne=t.n(be),oe=t(45360),X=t(35312),J=t(67294),h=t(83065),S=function(v){var k,O=(k=v.split(".").pop())===null||k===void 0?void 0:k.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(O||"")},U=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=(0,X.useIntl)(),O=(0,J.useState)([]),w=ne()(O,2),R=w[0],se=w[1],Se=(0,J.useState)(!1),Ce=ne()(Se,2),Ue=Ce[0],Oe=Ce[1],we=v.maxSizeMB,Ze=we===void 0?15:we,W=v.acceptedFileTypes,He=W===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":W,le=v.multiple,m=le===void 0?!0:le,g=function(){var F=document.createElement("input");F.type="file",F.accept=He,F.multiple=m,F.onchange=function(){var de=d()(K()().mark(function Te(Re){var ye,s,ee,De,e,re,ce,Le,me,We,xe,Be,Ne,L;return K()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(ye=Re.target,!(ye.files&&ye.files.length>0)){y.next=37;break}if(Oe(!0),s=Array.from(ye.files),ee=s.filter(function(Me){return Me.size/1024/1024>Ze}),!(ee.length>0)){y.next=9;break}return oe.ZP.error("".concat(ee.map(function(Me){return Me.name}).join(", ")," ").concat(k.formatMessage({id:"workflow.uploadFileErrorText"}))),Oe(!1),y.abrupt("return");case 9:De=[],e=0,re=s;case 11:if(!(e<re.length)){y.next=35;break}return ce=re[e],Le=new FormData,Le.append("file",ce),y.prev=15,y.next=18,(0,h.M$)();case 18:return me=y.sent,y.next=21,fetch(me,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:Le});case 21:return We=y.sent,y.next=24,We.json();case 24:xe=y.sent,xe.code===0?(oe.ZP.success("".concat(ce.name," ").concat(k.formatMessage({id:"workflow.uploadSuccess"}))),(Be=xe.data)!==null&&Be!==void 0&&Be.file_id&&(Ne=S(ce.name),L={name:ce.name,url:xe.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:Ne,file_id:xe.data.file_id,path_show:xe.data.file_url||xe.data.path_show||""},De.push(L))):oe.ZP.error("".concat(ce.name," ").concat(k.formatMessage({id:"workflow.uploadFailed"}))),y.next=32;break;case 28:y.prev=28,y.t0=y.catch(15),console.error("Upload error:",y.t0),oe.ZP.error("".concat(ce.name," ").concat(k.formatMessage({id:"workflow.uploadFailed"})));case 32:e++,y.next=11;break;case 35:se(function(Me){return[].concat(M()(Me),De)}),Oe(!1);case 37:case"end":return y.stop()}},Te,null,[[15,28]])}));return function(Te){return de.apply(this,arguments)}}(),F.click()},Z=function(F){se(function(de){return de.filter(function(Te){return Te.uid!==F})})},q=function(){se([])};return{uploadedFiles:R,setUploadedFiles:se,handleUpload:g,removeFile:Z,clearFiles:q,isUploading:Ue}};ge.ZP=U}}]);
