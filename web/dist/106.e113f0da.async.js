"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[106],{85422:function(Se,X,e){var q=e(15009),O=e.n(q),ee=e(99289),P=e.n(ee),ae=e(5574),y=e.n(ae),te=e(11551),C=e(39873),se=e(28508),S=e(29933),T=e(35312),ne=e(3917),F=e(66309),oe=e(28036),G=e(71471),w=e(74330),f=e(26412),M=e(12845),R=e(67294),H=e(22683),z=e(97807),re=e(24216),r=e(85893);X.Z=(0,R.memo)(function(U){var D,W,Z,h=U.data,le=U.onClose,_=(0,T.useIntl)(),J=(0,R.useState)(500),V=y()(J,2),K=V[0],ie=V[1],m=(0,ne.Z)(function(){var u=P()(O()().mark(function g(v,I){var k;return O()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,te.pC)(v,I);case 2:return k=B.sent,B.abrupt("return",k.data);case 4:case"end":return B.stop()}},g)}));return function(g,v){return u.apply(this,arguments)}}(),{manual:!0}),a=m.data,j=m.loading,s=m.run;(0,R.useEffect)(function(){h!=null&&h.app_id&&h!==null&&h!==void 0&&h.app_run_id&&s(h.app_id,h.app_run_id)},[h==null?void 0:h.app_id,h==null?void 0:h.app_run_id,s]);var d=function(g){var v={1:{color:"processing",text:_.formatMessage({id:"workflow.running"})},2:{color:"success",text:_.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:_.formatMessage({id:"workflow.runF"})}},I=v[g]||{color:"default",text:"Unknown"};return(0,r.jsx)(F.Z,{color:I.color,children:I.text})},c=function(g){ie(g)};return(0,r.jsx)(C.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:K,onChange:c,children:(0,r.jsx)(S.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,r.jsx)(oe.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:le,icon:(0,r.jsx)(se.Z,{})}),title:(0,r.jsx)(G.Z.Title,{level:5,children:_.formatMessage({id:"agent.log.detail"})}),loading:j,children:(0,r.jsx)("div",{className:"space-y-6",children:j?(0,r.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,r.jsx)(w.Z,{})}):a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.Z,{column:1,bordered:!0,size:"small",children:[(0,r.jsx)(f.Z.Item,{label:_.formatMessage({id:"workflow.user"}),children:a.nickname}),(0,r.jsx)(f.Z.Item,{label:_.formatMessage({id:"workflow.status"}),children:d(a.status)}),(0,r.jsx)(f.Z.Item,{label:_.formatMessage({id:"workflow.created_time"}),children:a.created_time}),(0,r.jsxs)(f.Z.Item,{label:_.formatMessage({id:"workflow.elapsed_time"}),children:[a.elapsed_time,"s"]}),(0,r.jsx)(f.Z.Item,{label:"Tokens",children:a.total_tokens})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(G.Z.Title,{level:5,children:_.formatMessage({id:"agent.log.output"})}),a.outputs?(0,r.jsx)("div",{children:(a==null||(D=a.outputs)===null||D===void 0?void 0:D.type)=="json"?(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(re.Z,{language:"python3",value:JSON.parse((W=a.outputs)===null||W===void 0?void 0:W.value)||"{}",readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"JSON"})}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)(H.U,{rehypePlugins:[z.Z],children:((Z=a.outputs)===null||Z===void 0?void 0:Z.value)||""})})}):a.error?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,r.jsx)("div",{className:"text-red-500 font-medium mb-2",children:_.formatMessage({id:"agent.log.error"})}),(0,r.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:a.error})]}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:_.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(a==null?void 0:a.prompt_data)&&a.prompt_data.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(G.Z.Title,{level:5,children:_.formatMessage({id:"agent.log.conversation"})}),(0,r.jsx)(M.Z,{className:"mt-2",children:a.prompt_data.map(function(u,g){var v=y()(u,2),I=v[0],k=v[1];return(0,r.jsx)(M.Z.Item,{color:I==="human"?"blue":"green",children:(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:I}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:k.value})]})},g)})})]})]}):null})})})})},68709:function(Se,X,e){e.d(X,{Z:function(){return j}});var q=e(19632),O=e.n(q),ee=e(15009),P=e.n(ee),ae=e(99289),y=e.n(ae),te=e(97857),C=e.n(te),se=e(5574),S=e.n(se),T=e(11551),ne=e(80279),F=e(38008),oe=e(77295),G=e(39944),w=e(55927),f="agent_fullscreen_states",M=function(d){try{var c=localStorage.getItem(f);if(!c)return!1;var u=JSON.parse(c);return u[String(d)]||!1}catch(g){return console.warn("Failed to get agent fullscreen state:",g),!1}},R=function(d,c){try{var u=localStorage.getItem(f),g=u?JSON.parse(u):{};g[String(d)]=c,localStorage.setItem(f,JSON.stringify(g)),console.log("Agent ".concat(d," fullscreen state saved: ").concat(c))}catch(v){console.warn("Failed to save agent fullscreen state:",v)}},H=function(d){try{var c=localStorage.getItem(f);if(!c)return;var u=JSON.parse(c);delete u[String(d)],localStorage.setItem(f,JSON.stringify(u)),console.log("Agent ".concat(d," fullscreen state cleared"))}catch(g){console.warn("Failed to clear agent fullscreen state:",g)}},z=function(){try{var d=localStorage.getItem(f);return d?JSON.parse(d):{}}catch(c){return console.warn("Failed to get all agent fullscreen states:",c),{}}},re=function(){try{localStorage.removeItem(f),console.log("All agent fullscreen states cleared")}catch(d){console.warn("Failed to clear all agent fullscreen states:",d)}},r=e(58299),U=e(85750),D=e(19078),W=e(5785),Z=e(34994),h=e(35312),le=e(77598),_=e(45360),J=e(74330),V=e(66309),K=e(28036),ie=e(32983),m=e(67294),a=e(85893),j=(0,m.memo)(function(s){var d,c,u,g,v,I,k=(0,m.useState)([]),de=S()(k,2),B=de[0],ce=de[1],Ze=(0,m.useState)(!0),De=S()(Ze,2),_a=De[0],Ke=De[1],$e=(0,m.useState)(1),Pe=S()($e,2),ga=Pe[0],Ge=Pe[1],He=(0,m.useState)(!0),Ie=S()(He,2),ze=Ie[0],Je=Ie[1],Ve=(0,m.useState)(!1),je=S()(Ve,2),me=je[0],be=je[1],ke=(0,m.useState)(!1),ye=S()(ke,2),va=ye[0],_e=ye[1],Ye=(0,m.useState)(!1),Oe=S()(Ye,2),Te=Oe[0],Re=Oe[1],Qe=(0,m.useState)(!1),Ae=S()(Qe,2),Xe=Ae[0],ge=Ae[1],qe=(0,m.useState)(!1),Le=S()(qe,2),A=Le[0],ve=Le[1],fe=(0,m.useRef)(),ea=(0,m.useRef)(null),aa=(0,m.useRef)(null),N=(0,h.useIntl)(),he=(0,w.Z)(function(i){return i.getTypedMessages("chat_message_llm_return")}),ta=(0,m.useState)(null),Ce=S()(ta,2),we=Ce[0],sa=Ce[1],pe=(0,w.Z)(function(i){return i.getTypedLastMessage("chat_message_llm_return")}),na=(0,m.useState)(null),Ue=S()(na,2),Y=Ue[0],ra=Ue[1],la=(0,r.m)(),ue=la.options,ia=function(n){if(!n||!ue)return"\u672A\u77E5\u6A21\u578B";var l=(0,U.ti)(n,{options:ue});return(l==null?void 0:l.label)||"\u672A\u77E5\u6A21\u578B"},oa=function(n){if(!n||!ue)return!1;var l=(0,U.ti)(n,{options:ue});return(l==null?void 0:l.support_image)===1},ua=function(){var n,l=(n=s.data)===null||n===void 0||(n=n.detailList)===null||n===void 0||(n=n.agent)===null||n===void 0?void 0:n.agent_id;if(l){var o=!A;ve(o),R(l,o)}else console.warn("Cannot save fullscreen state: agentId is not available"),ve(function(E){return!E})};(0,m.useEffect)(function(){var i;if(((i=s.data)===null||i===void 0||(i=i.detailList)===null||i===void 0||(i=i.app)===null||i===void 0?void 0:i.name)!=null){var n;console.log(s.data);var l=s.data.detailList.agent_chatroom_id,o=s.data.detailList.agent.agent_id;if(l){var E=window.location.search,x=new URLSearchParams(E);sa(l),x.set("id",String(l));var t="".concat(window.location.pathname,"?").concat(x.toString()).concat(window.location.hash);window.history.replaceState({},"",t)}var L=C()(C()({},s.data.detailList.app),{},{agent:s.data.detailList.agent,agent_id:o});if(console.log("AgentInfo updated:",{m_config_id:(n=L.agent)===null||n===void 0?void 0:n.m_config_id,agent_id:L.agent_id,name:L.name}),ra(L),o){var p=M(o);console.log("Restoring fullscreen state for agent ".concat(o,": ").concat(p)),ve(p)}setTimeout(function(){Je(!1)},500)}},[(d=s.data)===null||d===void 0||(d=d.detailList)===null||d===void 0||(d=d.app)===null||d===void 0?void 0:d.name,(c=s.data)===null||c===void 0||(c=c.detailList)===null||c===void 0||(c=c.agent)===null||c===void 0?void 0:c.m_config_id]);var Q=(0,oe.ZP)(),Be=Q.uploadedFiles,fa=Q.setUploadedFiles,ha=Q.handleUpload,pa=Q.removeFile,da=Q.clearFiles,Ma=Q.isUploading,Me=function(){var n;(n=ea.current)===null||n===void 0||n.scrollIntoView({behavior:"smooth"})},Ne=function(){var i=y()(P()().mark(function n(){var l,o,E;return P()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,Re(!0),!(s!=null&&(l=s.saveInfo)!==null&&l!==void 0&&l.firstjudgingcondition())){t.next=6;break}return t.abrupt("return",!0);case 6:if(!(s!=null&&(o=s.saveInfo)!==null&&o!==void 0&&o.secondjudgingcondition())){t.next=10;break}return t.abrupt("return",!0);case 10:return t.next=12,s==null||(E=s.saveInfo)===null||E===void 0?void 0:E.agentupdata();case 12:return t.abrupt("return",t.sent);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(0),console.error("Failed to save info:",t.t0),t.abrupt("return",!1);case 19:return t.prev=19,Re(!1),t.finish(19);case 22:case"end":return t.stop()}},n,null,[[0,15,19,22]])}));return function(){return i.apply(this,arguments)}}();(0,le.Z)(function(){var i,n=pe==null?void 0:pe.data;if(n&&!((n==null?void 0:n.agent_id)!==((i=s.data)===null||i===void 0||(i=i.detailList)===null||i===void 0||(i=i.agent)===null||i===void 0?void 0:i.agent_id)&&!_.ZP.error)){var l=C()(C()({},n),{},{id:n.message_id});he&&he.length>0&&(_e(!1),ce(function(o){return[].concat(O()(o),[l])}),setTimeout(Me,100))}},[he]),(0,m.useEffect)(function(){!me&&B.length>0&&Me()},[me]);var ca=function(){var i=y()(P()().mark(function n(l){var o,E,x,t,L,p,Ee,Fe,xe,We;return P()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(console.log(l),t=(o=fe.current)===null||o===void 0?void 0:o.getFieldsValue(),!(!t||!((E=l.content)!==null&&E!==void 0&&E.trim()))){b.next=4;break}return b.abrupt("return");case 4:return L=s.data.detailList.agent.agent_id,p=s.data.detailList.agent.input_variables,Ee=t.ability_id,Fe=new G.z({user:{value:t.content}}),xe=Be.map(function($){return{name:$.name,url:$.url||$.path_show||""}}),We={id:Date.now(),content:l.content,isUser:!0,ability_id:Ee,agent_id:L,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:t.content,prompt_tokens:0,total_tokens:0,file_list:xe.length>0?xe:void 0},_e(!0),ce(function($){return[].concat(O()($),[We])}),(x=fe.current)===null||x===void 0||x.resetFields(["content"]),b.prev=13,b.next=16,(0,T.CY)({agent_id:L,input_dict:p,ability_id:Ee,prompt:Fe,file_list:Be.map(function($){return $.file_id})});case 16:da(),b.next=23;break;case 19:b.prev=19,b.t0=b.catch(13),_e(!1),_.ZP.error(N.formatMessage({id:"agent.chat.send.failed"}));case 23:setTimeout(Me,100);case 24:case"end":return b.stop()}},n,null,[[13,19]])}));return function(l){return i.apply(this,arguments)}}(),Ea=function(){var i=y()(P()().mark(function n(){var l,o,E;return P()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((l=s.data)!==null&&l!==void 0&&(l=l.detailList)!==null&&l!==void 0&&(l=l.agent)!==null&&l!==void 0&&l.agent_id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,be(!0),t.next=6,(0,T.CU)(String(s.data.detailList.agent.agent_id),1);case 6:E=t.sent,(o=E.data)!==null&&o!==void 0&&o.list&&(ce(E.data.list),Ke(E.data.total_pages>1),Ge(1)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("Failed to fetch initial messages:",t.t0);case 13:return t.prev=13,be(!1),t.finish(13);case 16:case"end":return t.stop()}},n,null,[[2,10,13,16]])}));return function(){return i.apply(this,arguments)}}();if(me)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(J.Z,{})});var ma=function(){var i=y()(P()().mark(function n(){return P()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,ge(!0),o.next=4,Ne();case 4:setTimeout(y()(P()().mark(function E(){var x,t;return P()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,(0,T.Dh)((x=s.data)===null||x===void 0||(x=x.detailList)===null||x===void 0||(x=x.agent)===null||x===void 0?void 0:x.agent_id);case 3:t=p.sent,t.code==0?_.ZP.success(N.formatMessage({id:"agent.message.success.publish"})):_.ZP.error(N.formatMessage({id:"agent.message.fail.publish"})),p.next=11;break;case 7:p.prev=7,p.t0=p.catch(0),console.error("Failed to publish agent:",p.t0),_.ZP.error(N.formatMessage({id:"agent.message.fail.publish"}));case 11:return p.prev=11,ge(!1),p.finish(11);case 14:case"end":return p.stop()}},E,null,[[0,7,11,14]])})),500),o.next=11;break;case 7:o.prev=7,o.t0=o.catch(0),console.error("Failed to save before publish:",o.t0),ge(!1);case 11:case"end":return o.stop()}},n,null,[[0,7]])}));return function(){return i.apply(this,arguments)}}();return ze?null:(0,a.jsx)("div",{ref:aa,className:"".concat(A?"fixed inset-0 z-50 !h-screen  border border-gray-300 top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:A?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,a.jsxs)(Z.A,{formRef:fe,submitter:!1,onFinish:ca,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[(0,a.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,a.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(u=s.data)===null||u===void 0||(u=u.detailList)===null||u===void 0||(u=u.app)===null||u===void 0?void 0:u.name,A&&(Y==null||(g=Y.agent)===null||g===void 0?void 0:g.m_config_id)&&(0,a.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[ia(Y.agent.m_config_id),oa(Y.agent.m_config_id)&&(0,a.jsx)(V.Z,{color:"blue",className:"text-xs",children:N.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})})]})})]}),(0,a.jsx)(K.ZP,{type:"text",icon:A?(0,a.jsx)(D.Z,{}):(0,a.jsx)(W.Z,{}),onClick:ua,title:N.formatMessage({id:A?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),s.operationbentate=="false"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.ZP,{type:"primary",disabled:s.operationbentate!="false",loading:Te,onClick:Ne,className:"min-w-24",children:N.formatMessage({id:"agent.btn.savedebug"})}),(0,a.jsx)(K.ZP,{type:"primary",disabled:s.operationbentate!="false",loading:Xe||Te,onClick:ma,className:"min-w-24",children:N.formatMessage({id:"agent.publish"})})]})]}),we?(0,a.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(A?"max-w-[1400px] mx-auto justify-center":""),style:{height:A?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,a.jsx)(F.aS,{children:(0,a.jsx)(ne.F,{agentList:{current:[Y]},abilitiesList:(v=s.data)===null||v===void 0?void 0:v.abilitiesList,agentChatRoomId:we,chatStatus:(I=s.data)===null||I===void 0||(I=I.detailList)===null||I===void 0?void 0:I.chat_status})})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(ie.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})},27842:function(Se,X,e){var q=e(5574),O=e.n(q),ee=e(15009),P=e.n(ee),ae=e(99289),y=e.n(ae),te=e(11551),C=e(29608),se=e(83535),S=e(35312),T=e(67294),ne=e(85422),F=e(85893),oe=null,G=null;X.ZP=function(w){var f=w.agent_id,M=(0,S.useIntl)(),R=(0,S.useSearchParams)(),H=O()(R,1),z=H[0],re=(0,T.useRef)(null),r=(0,T.useState)(null),U=O()(r,2),D=U[0],W=U[1],Z=(0,T.useState)(!1),h=O()(Z,2),le=h[0],_=h[1],J=z.get("app_id"),V=function(){_(!1)},K=function(j){W({app_id:J,app_run_id:j.id}),_(!0)},ie=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:M.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:M.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:M.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:M.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:M.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:M.formatMessage({id:"workflow.created_time_des",defaultMessage:M.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(M.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:M.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:M.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],m=(0,C.Z)(function(a){return a.setRunPanelLogRecord});return(0,F.jsxs)("div",{className:"h-full",children:[(0,F.jsx)(se.Z,{columns:ie,formRef:re,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var a=y()(P()().mark(function j(s,d,c){var u;return P()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return console.log(s,d,c),v.next=3,(0,te.My)(J,{page:s.current,page_size:s.pageSize});case 3:return u=v.sent,console.log(u),v.abrupt("return",{data:u.data.list,success:!0,total:u.data.total_count});case 6:case"end":return v.stop()}},j)}));return function(j,s,d){return a.apply(this,arguments)}}(),onRow:function(j){return{onClick:function(){K(j)},className:(D==null?void 0:D.app_run_id)===j.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:M.formatMessage({id:"agent.log.list"})}),le&&(D==null?void 0:D.app_id)&&(D==null?void 0:D.app_run_id)&&(0,F.jsx)(ne.Z,{data:D,onClose:V})]})}}}]);
