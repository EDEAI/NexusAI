"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[370],{80459:function(Xe,ge,t){var Ee=t(32332),K=t(67294),ce=t(85893),j=function(c){var be=c.width,q=be===void 0?"40px":be,oe=c.bg,z=oe===void 0?"#F4F8F1":oe,$=c.rounded,F=$===void 0?"6px":$,A=c.data,p=c.imgWidth,ue=p===void 0?"18px":p,M=c.background;A!=null&&A.avatar&&(ue=q);var R=M||z;return(0,ce.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:q,height:q,backgroundColor:R,borderRadius:F},children:(0,ce.jsx)("img",{src:A!=null&&A.avatar?A.avatar:(0,Ee.s9)("single",A==null?void 0:A.icon),style:{width:ue,height:ue,borderRadius:F},alt:""})})};ge.Z=(0,K.memo)(j)},94813:function(Xe,ge,t){t.d(ge,{F:function(){return qe}});var Ee=t(19632),K=t.n(Ee),ce=t(97857),j=t.n(ce),Re=t(15009),c=t.n(Re),be=t(99289),q=t.n(be),oe=t(13769),z=t.n(oe),$=t(61227),F=t.n($),A=t(5574),p=t.n(A),ue=t(47635),M=t(43722),R=t(80459),V=t(27522),Z=t(77295),x=t(39e3),ee=t(32332),Be=t(82114),Ue=t(77171),je=t(69753),Se=t(97245),we=t(52645),Ge=t(88484),We=t(30159),Ve=t(2068),_e=t(41428),v=t(64317),o=t(35312),H=t(26915),Y=t(85576),B=t(55060),W=t(66309),de=t(83062),me=t(28036),ke=t(74330),Pe=t(45360),te=t(20640),ae=t.n(te),Ke=t(55026),fe=t(96486),ie=t.n(fe),s=t(67294),Ce=t(22683),Oe=t(97807),e=t(85893),pe=["node","className","children"],Le=["node"],Fe=H.Z.TextArea,C=function(u,h){try{var g=document.createElement("a");g.href=u,g.download=h,g.target="_blank",document.body.appendChild(g),g.click(),document.body.removeChild(g)}catch(a){}},Je=(0,s.memo)(function(n){var u=n.setInstruction,h=n.messageApi,g=n.isStop,a=n.scrollDomRef,r=n.upButtonDom,i=n.abilitiesList,D=n.agentChatRoomId,l=(0,o.useIntl)(),m=(0,x.Z)(function(_){return _.disableInput}),b=(0,x.Z)(function(_){return _.setDisableInput}),I=(0,s.useState)(null),L=p()(I,2),U=L[0],P=L[1],ne=(0,x.Z)(function(_){return _.setClearMemory}),f=(0,Z.ZP)({maxSizeMB:15,acceptedFileTypes:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg",multiple:!0}),S=f.uploadedFiles,ve=f.handleUpload,ye=f.removeFile,le=f.clearFiles,O=f.isUploading,se=(0,s.useState)(""),X=p()(se,2),J=X[0],re=X[1],y=function(){var d=Y.Z.confirm;d({title:l.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Be.Z,{}),content:l.formatMessage({id:"app.chatroom.clear.tips"}),okText:l.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:l.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){ne(["TRUNCATE","0"])}})},Q=function _(d,N){if(d.length===0){N&&N();return}var Ne=F()(d),$e=Ne[0],he=Ne.slice(1);u($e),setTimeout(function(){_(he,N)},100)},Me=function(d){var N=[];(S==null?void 0:S.length)>0&&N.push(["FILELIST",S.map(function(Ne){return Ne.file_id})]),U&&N.push(["SETABILITY",U]),N.push(["INPUT",d]),Q(N,function(){(S==null?void 0:S.length)>0&&le()})},Ae=function(d){!d.shiftKey&&d.target.value==""&&(h.open({type:"warning",content:l.formatMessage({id:"app.chatroom.content.input"}),duration:10}),re(""),d.preventDefault()),!d.shiftKey&&d.keyCode==13&&d.target.value!=""&&(b(!0),re(""),Me(d.target.value),d.preventDefault())},De=(0,fe.throttle)(function(){u(["STOP",null])},300),Ie=function(){m||ve()};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:r,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(d){a.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(Ue.Z,{className:"text-[16px]"})}),(0,e.jsx)(B.Z.PreviewGroup,{children:S.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:S.map(function(_){return(0,e.jsx)(W.Z,{closable:!0,onClose:function(){return ye(_.uid)},className:"flex items-center ".concat(_.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(de.Z,{title:_.name,children:(0,e.jsx)("div",{className:"flex items-center",children:_.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(B.Z,{src:_.path_show||_.url,alt:_.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:_.path_show||_.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:_.name}),(0,e.jsx)(je.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(N){N.stopPropagation(),C(_.path_show||_.url,_.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Se.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:_.name}),(0,e.jsx)(je.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(N){N.stopPropagation(),C(_.path_show||_.url,_.name)}})]})})})},_.uid)})})})}),(0,e.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(S.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[D&&(0,e.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(i==null?void 0:i.length)>0&&(0,e.jsx)(v.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:i,initialValue:U,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),size:"small",onChange:function(d){P(d)}},formItemProps:{className:"m-0"}}),(0,e.jsx)(me.ZP,{size:"small",color:"danger",variant:"outlined",onClick:y,icon:(0,e.jsx)(we.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-[10px] box-border ",children:[(0,e.jsx)(me.ZP,{type:"text",icon:(0,e.jsx)(Ge.Z,{}),onClick:Ie,disabled:m||O,loading:O}),(0,e.jsx)(Fe,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:J,disabled:m,onChange:function(d){re(d.target.value)},onPressEnter:Ae,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(l.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),g?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:De,children:(0,e.jsx)(We.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(m||!J?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,fe.throttle)(function(){if(m||!J)return!1;J||h.open({type:"warning",content:l.formatMessage({id:"app.chatroom.content.input"}),duration:10}),b(!0),Me(J),re("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})]})})}),T=function n(u){return typeof u=="string"?u:Array.isArray(u)?u.map(n).join(""):s.isValidElement(u)?n(u.props.children):""},Te=function(u){return T(u)},ze=function(u,h){return{code:function(a){var r=a.node,i=a.className,D=a.children,l=z()(a,pe),m=/language-(\w+)/.exec(i||"");if(m!=null&&m.length){var b=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:m[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var I=q()(c()().mark(function L(U){var P;return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,P=U.currentTarget,f.next=4,ae()(Te(D));case 4:P&&(P.children[1].innerText=h.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){P&&(P.children[1].innerText=h.formatMessage({id:"app.chatroom.content.copycode"}))},200),f.next=11;break;case 8:f.prev=8,f.t0=f.catch(0),console.error("Failed to copy text: ",f.t0);case 11:case"end":return f.stop()}},L,null,[[0,8]])}));return function(L){return I.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:h.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(b).concat(u),className:"p-4",children:D})})]})}else return(0,e.jsx)("code",j()(j()({},l),{},{children:D}))},img:function(a){var r=a.node,i=z()(a,Le);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(B.Z,{src:i.src,alt:i.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(me.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(je.Z,{}),onClick:function(l){l.stopPropagation(),C(i.src||"",i.alt||"image.png")}})})]})}}},et=(0,s.memo)(function(n){var u=n.messageApi,h=n.index,g=n.idName,a=n.cidName,r=(0,o.useIntl)(),i=(0,s.useState)(!1),D=p()(i,2),l=D[0],m=D[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){m(!0)},onMouseLeave:function(){m(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var b=q()(c()().mark(function I(L){var U,P;return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return U=L.target.closest("#".concat(g).concat(h)),P=U.querySelector("#".concat(a).concat(h)),f.prev=2,f.next=5,ae()(P.innerText);case 5:u.open({type:"success",content:r.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),f.next=11;break;case 8:f.prev=8,f.t0=f.catch(2),console.error("Failed to copy text: ",f.t0);case 11:case"end":return f.stop()}},I,null,[[2,8]])}));return function(I){return b.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(l?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(l?" text-[#1B64F3]":"text-[#666]"),children:r.formatMessage({id:"app.chatroom.content.copy"})})]})})}),tt=function(u){var h=u.id,g=u.index,a=u.idName,r=u.cidName,i=(0,o.useIntl)(),D=(0,x.Z)(function(P){return P.setSummaryClick}),l=(0,s.useState)(!0),m=p()(l,2),b=m[0],I=m[1],L=(0,x.Z)(function(P){return P.summaryClick});(0,s.useEffect)(function(){I(L)},[L]);var U=(0,x.Z)(function(P){return P.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(b?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(ne){if(b){var f=ne.target.closest("#".concat(a).concat(g)),S=f.querySelector("#".concat(r).concat(g));U({id:h,message:S.innerText}),D(!1)}},children:[(0,e.jsx)(Ve.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:i.formatMessage({id:"app.chatroom.content.summary"})})]})})},rt=function(u){var h=u.roomid,g=(0,o.useIntl)(),a=(0,x.Z)(function(I){return I.setSummaryClick}),r=(0,s.useState)(!0),i=p()(r,2),D=i[0],l=i[1],m=(0,x.Z)(function(I){return I.summaryClick});(0,s.useEffect)(function(){l(m)},[m]);var b=(0,x.Z)(function(I){return I.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(D?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){D&&(b({id:h}),a(!1))},children:[(0,e.jsx)(_e.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:g.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},at=(0,s.memo)(function(n){var u=n.messageApi,h=n.setCurrentMessageContent,g=n.sendValue,a=n.agentList,r=n.scrollDomRef,i=n.upButtonDom,D=n.setIsStop,l=n.setisEnd,m=n.setSendValue,b=n.agentChatRoomId,I=(0,o.useIntl)(),L=(0,o.useParams)(),U=L.id,P=(0,o.useLocation)(),ne=new URLSearchParams(P.search),f=ne.get("id"),S=b||U||f,ve=(0,x.Z)(function(Ie){return Ie.setDisableInput}),ye=(0,s.useState)({}),le=p()(ye,2),O=le[0],se=le[1],X=(0,s.useRef)(!1),J=(0,s.useRef)(""),re=(0,x.Z)(function(Ie){return Ie.setTruncatable}),y=function(_){var d=_.data;if(d.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var N=JSON.parse(d.slice(22,-2));switch(N[0]){case"ERROR":ve(!1),D(!1),m(""),u.open({type:"error",content:"webSocket-".concat(N[1]),duration:10});break;case"CHAT":var Ne={content:"".concat(N[1]),is_agent:0};h(function(w){return[].concat(K()(w),[Ne])}),setTimeout(function(){r.current.scrollTop=0,i.current.style.display="none"});break;case"WITHFILELIST":h(function(w){var E=K()(w);return E.length&&(E[E.length-1].file_list=N[1]),E}),setTimeout(function(){r.current.scrollTop=0,i.current.style.display="none"});break;case"STOPPABLE":D(N[1]);break;case"TRUNCATABLE":re(N[1]),N[1]||u.open({type:"success",content:"".concat(I.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":u.open({type:"success",content:"".concat(I.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(d.indexOf("REPLY")!==-1&&d.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var $e=JSON.parse(d.slice(22,-2))[1];J.current="",X.current=!0;var he=a.current.filter(function(w){return w.agent_id==$e})[0];Object.keys(O).length&&h(function(w){return[].concat(K()(w),[O])}),se(function(w){return j()(j()({},w),{},{is_agent:1,icon:he==null?void 0:he.icon,name:he==null?void 0:he.name})}),D(!0),re(!1)}if(d.indexOf("ABILITY")!==-1&&d.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var nt=JSON.parse(d.slice(22,-2))[1];se(function(w){return j()(j()({},w),{},{is_agent:1,ability_id:nt})})}d.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&X.current&&(r.current.scrollTop=0,i.current.style.display="none",J.current+=d,se(function(w){return j()(j()({},w),{},{content:J.current})})),d.indexOf("ENDCHAT")!==-1&&(X.current=!1,J.current="",ve(!1),D(!1),re(!0),Object.keys(O).length&&h(function(w){return[].concat(K()(w),[O])}),se({}),l(!0),m(""))},Q=(0,ue.Z)("chat",y),Me=Q.runSocket,Ae=Q.sendMessage,De=Q.readyState;return(0,s.useEffect)(function(){De==1&&S&&Ae(JSON.stringify(["ENTER",parseInt(S)]))},[De]),(0,s.useEffect)(function(){g&&De==1&&Ae(g)},[g]),(0,s.useEffect)(function(){Me()},[]),(0,e.jsx)(e.Fragment,{children:O.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(O.is_agent!=1?"flex-row-reverse":""),children:[O.is_agent==1?(0,e.jsx)(R.Z,{data:O}):(0,e.jsx)(R.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(b?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(O.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:O.name?O.name:(0,ee.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(O.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:O.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:[O.file_list&&O.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(V.Z,{fileList:O.file_list,onDownload:C})}),(0,e.jsx)(Ce.U,{rehypePlugins:[Oe.Z],components:ze("add",I),children:O.content})]})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Qe=(0,s.memo)(function(n){var u=n.messageApi,h=n.setUserMessage,g=n.sendValue,a=n.agentList,r=n.scrollDomRef,i=n.upButtonDom,D=n.setIsStop,l=n.setSendValue,m=n.agentChatRoomId,b=n.abilitiesList,I=(0,o.useIntl)(),L=(0,s.useState)([]),U=p()(L,2),P=U[0],ne=U[1],f=(0,s.useState)(!1),S=p()(f,2),ve=S[0],ye=S[1],le=(0,o.useParams)(),O=le.id,se=(0,o.useLocation)(),X=new URLSearchParams(se.search),J=X.get("id"),re=O||J;return(0,s.useEffect)(function(){ve&&(h(function(y){return[].concat(K()(P.reverse()),K()(y))}),ne([]),setTimeout(function(){ye(!1),r.current.scrollTop=0},200))},[ve]),(0,e.jsxs)(e.Fragment,{children:[P.length?P.map(function(y,Q){var Me;return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(y.is_agent!=1?"flex-row-reverse":""),children:[y.is_agent==1?(0,e.jsx)(R.Z,{data:y}):(0,e.jsx)(R.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(m?"":"max-w-[560px]"," text-right"),id:"currentContent".concat(Q),children:[(0,e.jsxs)("div",{className:"".concat(y.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[y.name?y.name:(0,ee.Qy)("GET").nickname,y.name&&y.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((Me=b.find(function(Ae){return y.ability_id==Ae.value}))===null||Me===void 0?void 0:Me.label)||"\u672A\u627E\u5230\u8BE5\u80FD\u529B",")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(y.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:y.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(Q),children:[y.file_list&&y.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(V.Z,{fileList:y.file_list,onDownload:C})}),(0,e.jsx)(Ce.U,{rehypePlugins:[Oe.Z],components:ze(Q,I),children:y.content})]})}),y.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:u,index:Q,idName:"currentContent",cidName:"currentChilContent"}),!m&&(0,e.jsx)(tt,{id:re,index:Q,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},Q)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(at,{messageApi:u,setCurrentMessageContent:ne,sendValue:g,agentList:a,scrollDomRef:r,upButtonDom:i,setIsStop:D,setisEnd:ye,setSendValue:l,agentChatRoomId:m})]})}),xe=(0,s.memo)(function(n){var u=n.messageApi,h=n.scrollDomRef,g=n.instruction,a=n.setIsStop,r=n.upButtonDom,i=n.setInstruction,D=n.agentList,l=n.agentChatRoomId,m=n.abilitiesList,b=(0,o.useIntl)(),I=(0,s.useState)(860),L=p()(I,2),U=L[0],P=L[1],ne=(0,o.useParams)(),f=ne.id,S=(0,o.useLocation)(),ve=new URLSearchParams(S.search),ye=ve.get("id"),le=l||f||ye,O=(0,s.useState)([]),se=p()(O,2),X=se[0],J=se[1],re=(0,s.useRef)(!1),y=(0,s.useState)(""),Q=p()(y,2),Me=Q[0],Ae=Q[1],De=(0,s.useRef)(null),Ie=(0,s.useRef)(!0),_=(0,s.useRef)(2),d=(0,s.useRef)(1),N=(0,s.useRef)(0),Ne=function(){var E=q()(c()().mark(function G(k){var Ye,Ze,st=arguments;return c()().wrap(function(He){for(;;)switch(He.prev=He.next){case 0:if(Ye=st.length>1&&st[1]!==void 0?st[1]:function(){},!le){He.next=6;break}return He.next=4,(0,M.KH)(le,{page:d.current,page_size:10});case 4:Ze=He.sent,Ze.code==0&&(_.current=Ze.data.total_pages,k||(De.current.style.display="none"),J(function(ot){return k?K()(Ze.data.list.reverse()):[].concat(K()(ot),K()(Ze.data.list.reverse()))}),k?h&&h.current&&setTimeout(function(){h.current.scrollTop=0,r.current.style.display="none"}):N.current=Ze.data.list.length,Ie.current=!0);case 6:case"end":return He.stop()}},G)}));return function(k){return E.apply(this,arguments)}}(),$e=function(G){var k=G.target.scrollHeight+(G.target.scrollTop-G.target.clientHeight);re.current!==Math.ceil(G.target.scrollTop)<-50&&(re.current=Math.ceil(G.target.scrollTop)<-50,r.current.style.display=re.current?"flex":"none"),k<10&&Ie.current&&(Ie.current=!1,d.current=d.current+1,De.current.style.display="flex",_.current>=d.current?Ne(!1):De.current.style.display="none")},he=function(G,k){k==="0"&&(k=Number(k));var Ye=["".concat(G),k===0||k?k:null];Ae(JSON.stringify(Ye))},nt=(0,x.Z)(function(E){return E.disableInput}),w=(0,x.Z)(function(E){return E.clearMemory});return(0,s.useEffect)(function(){w&&w.length&&he(w[0],w[1])},[w]),(0,s.useEffect)(function(){g&&g.length&&(he(g[0],g[1]?g[1]:""),i([]))},[g]),(0,s.useEffect)(function(){d.current=1,Ne(!0)},[]),(0,s.useEffect)(function(){var E=function(){window.innerWidth<1280||P(window.innerWidth-320-(window.innerWidth-320)/2-88)};return E(),window.addEventListener("resize",E),function(){window.removeEventListener("resize",E)}},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:h,onScroll:$e,children:[(0,e.jsxs)("div",{style:{minWidth:l?"":"".concat(U,"px")},children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:X&&X.length?X.map(function(E,G){var k;return(0,e.jsxs)("div",{id:"c".concat(E.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(E.is_agent!=1?"flex-row-reverse":""),children:[E.is_agent==1?(0,e.jsx)(R.Z,{data:E}):(0,e.jsx)(R.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(l?"":"max-w-[560px]"," text-right"),id:"content".concat(G),children:[(0,e.jsxs)("div",{className:"".concat(E.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[E.name?E.name:(0,ee.Qy)("GET").nickname,E.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((k=m.find(function(Ye){return E.ability_id==Ye.value}))===null||k===void 0?void 0:k.label)||b.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(E.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:E.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(G),children:[E.file_list&&E.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(V.Z,{fileList:E.file_list,onDownload:C})}),(0,e.jsx)(Ce.U,{rehypePlugins:[Oe.Z],components:ze(G,b),children:E.content})]})}),E.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:u,idName:"content",cidName:"chilContent",index:G}),!l&&(0,e.jsx)(tt,{id:le,index:G,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},G)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(Qe,{messageApi:u,setUserMessage:J,sendValue:Me,agentList:D,scrollDomRef:h,upButtonDom:r,setIsStop:a,setSendValue:Ae,agentChatRoomId:l,abilitiesList:m})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!l&&!nt&&X.length?(0,e.jsx)(rt,{roomid:le}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:De,children:(0,e.jsx)(ke.Z,{})})]})})}),qe=(0,s.memo)(function(n){var u=n.agentList,h=n.agentChatRoomId,g=n.abilitiesList,a=(0,s.useRef)(null),r=(0,s.useRef)(null),i=(0,s.useState)(!1),D=p()(i,2),l=D[0],m=D[1],b=(0,s.useState)([]),I=p()(b,2),L=I[0],U=I[1],P=(0,o.useParams)(),ne=P.id,f=(0,o.useLocation)(),S=new URLSearchParams(f.search),ve=S.get("id"),ye=ne||ve,le=Pe.ZP.useMessage(),O=p()(le,2),se=O[0],X=O[1];return(0,e.jsxs)(e.Fragment,{children:[X,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(h?"w-full":""),children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(xe,{instruction:L,setInstruction:U,messageApi:se,scrollDomRef:a,setIsStop:m,upButtonDom:r,agentList:u,agentChatRoomId:h,abilitiesList:g}),(0,e.jsx)(Je,{setInstruction:U,messageApi:se,isStop:l,upButtonDom:r,scrollDomRef:a,agentChatRoomId:h,abilitiesList:g})]})})]})})},27522:function(Xe,ge,t){var Ee=t(55060),K=t(28036),ce=t(69753),j=t(97245),Re=t(77295),c=t(85893),be=function(z,$){try{var F=document.createElement("a");F.href=z,F.download=$,F.target="_blank",document.body.appendChild(F),F.click(),document.body.removeChild(F)}catch(A){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",A)}},q=function(z){var $=z.fileList,F=z.onDownload,A=F===void 0?be:F,p=z.className,ue=p===void 0?"":p,M=z.showInGrid,R=M===void 0?!1:M,V=z.maxHeight;return!$||$.length===0?null:(0,c.jsx)("div",{className:"mb-2 ".concat(ue),style:{maxHeight:V,overflow:V?"auto":"visible"},children:(0,c.jsx)(Ee.Z.PreviewGroup,{children:(0,c.jsx)("div",{className:"".concat(R?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:$.map(function(Z,x){var ee=Z.path_show||Z.url,Be=(0,Re.CO)(Z.name);return(0,c.jsx)("div",{className:"".concat(R?"":"mb-2"),children:Be?(0,c.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,c.jsx)(Ee.Z,{src:ee,alt:Z.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,c.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,c.jsx)(K.ZP,{type:"primary",size:"small",icon:(0,c.jsx)(ce.Z,{}),onClick:function(je){je.stopPropagation(),A(ee,Z.name)}})})]}):(0,c.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,c.jsx)(j.Z,{className:"mr-2 flex-shrink-0"}),(0,c.jsx)("span",{className:"text-sm truncate",children:Z.name})]}),(0,c.jsx)(K.ZP,{type:"text",size:"small",icon:(0,c.jsx)(ce.Z,{}),onClick:function(){return A(ee,Z.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(Z.uid||Z.file_id||x))})})})})};ge.Z=q},85877:function(Xe,ge,t){var Ee=t(19632),K=t.n(Ee),ce=t(97857),j=t.n(ce),Re=t(5574),c=t.n(Re),be=t(52677),q=t.n(be),oe=t(35312),z=t(78234),$=t(77598),F=t(96486),A=t.n(F),p=t(67294),ue=t(73935),M=t(43413),R=t(92858),V=t(16845),Z=t(15425),x=t(85893),ee=function(v){var o=v.children;return(typeof document=="undefined"?"undefined":q()(document))==="object"?ue.createPortal(o,document.body):null},Be=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ue=function(v){var o=v.value,H=v.onChange,Y=v.id,B=v.placeholder,W=v.options,de=(0,oe.useIntl)(),me=(0,p.useRef)(),ke=(0,p.useState)(),Pe=c()(ke,2),te=Pe[0],ae=Pe[1],Ke=(0,p.useState)(0),fe=c()(Ke,2),ie=fe[0],s=fe[1],Ce=(0,p.useState)(""),Oe=c()(Ce,2),e=Oe[0],pe=Oe[1],Le=(0,p.useCallback)(function(a){return(0,x.jsx)(Ge,j()({},a))},[]),Fe=(0,p.useCallback)(function(a){return(0,x.jsx)(we,j()({},a))},[]),C=(0,p.useMemo)(function(){return je((0,V.BU)((0,R.VC)((0,M.Jh)())))},[]),Je=(0,p.useState)(null),T=c()(Je,2),Te=T[0],ze=T[1],et=(0,Z.Z)(function(a){return a.selectedNode}),tt=(0,Z.Z)(function(a){return a.getOutputVariables}),rt=(0,Z.Z)(function(a){return a.getInputVariables}),at=(0,p.useState)([]),Qe=c()(at,2),xe=Qe[0],qe=Qe[1];(0,z.Z)(function(){o&&o.length>0&&n(o),W!=null&&W.length&&qe(W.map(function(a){return j()(j()({},a),{},{name:a.label,id:a.value})}))}),(0,$.Z)(function(){var a=A().isEqual(Te,o);a||(o&&o.length>0?n(o):o&&A().isArray(o)&&o.length==0&&n([{type:"paragraph",children:[]}]))},[o,Y]),(0,$.Z)(function(){W.length&&qe(W.map(function(a){return j()(j()({},a),{},{name:a.label,id:a.value})})),console.log(W)},[W]);var n=function(r){ze(r),h(C,{nodes:[{type:"paragraph",children:[]}]}),h(C,{nodes:r})},u=(0,p.useCallback)(function(a){if(te&&xe.length>0)switch(a.key){case"ArrowDown":a.preventDefault();var r=ie>=xe.length-1?0:ie+1;s(r);return;case"ArrowUp":a.preventDefault();var i=ie<=0?xe.length-1:ie-1;s(i);return;case"Tab":case"Enter":a.preventDefault(),M.YR.select(C,te),Se(C,xe[ie]),ae(null);return;case"Escape":a.preventDefault(),ae(null);return}else if(a.key==="@"){setTimeout(function(){return g()},10);return}ae(null)},[xe,C,ie,te]),h=function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},D=K()(r.children);if(D.forEach(function(b){return r.apply({type:"remove_node",path:[0],node:b})}),i.nodes){var l=M.NB.isNode(i.nodes)?[i.nodes]:i.nodes;l.forEach(function(b,I){return r.apply({type:"insert_node",path:[I],node:b})})}var m=i.at&&M.E9.isPoint(i.at)?i.at:M.ML.end(r,[]);m&&M.YR.select(r,m)};(0,p.useEffect)(function(){if(te&&xe.length>0){var a=me.current,r=V.F3.toDOMRange(C,te),i=r.getBoundingClientRect();a.style.top="".concat(i.top+window.pageYOffset+24,"px"),a.style.left="".concat(i.left+window.pageXOffset,"px")}},[xe.length,C,ie,e,te]);var g=function(){var r=C.selection;if(r&&M.e6.isCollapsed(r)){var i=M.e6.edges(r),D=c()(i,1),l=D[0],m=M.ML.before(C,l),b=m&&M.ML.range(C,m,l),I=b&&M.ML.string(C,b),L=M.ML.after(C,l),U=M.ML.range(C,l,L),P=M.ML.string(C,U);ae(b),pe(""),s(0);return}ae(null)};return(0,x.jsxs)(V.mH,{editor:C,initialValue:Ve,onChange:function(r){H==null||H(r),ae(null)},children:[(0,x.jsx)(V.CX,{renderElement:Le,renderLeaf:Fe,onKeyDown:u,className:"!outline-none",placeholder:B!=null?B:de.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),te&&(0,x.jsx)(ee,{children:(0,x.jsx)("div",{ref:me,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:xe.length?xe.map(function(a,r){return(0,x.jsx)("div",{onClick:function(){console.log(a),M.YR.select(C,te),Se(C,a),ae(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:r===ie?"#B4D5FF":""},children:(0,x.jsx)("span",{children:a.name})},a.name+r)}):(0,x.jsx)(x.Fragment,{children:de.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},je=function(v){var o=v.isInline,H=v.isVoid,Y=v.markableVoid;return v.isInline=function(B){return B.type==="mention"?!0:o(B)},v.isVoid=function(B){return B.type==="mention"?!0:H(B)},v.markableVoid=function(B){return B.type==="mention"||Y(B)},v},Se=function(v,o){var H={type:"mention",id:(o==null?void 0:o.id)||"",character:o.name,base:o,children:[{bold:!0,text:"11111"}]};M.YR.insertNodes(v,H),M.YR.move(v)},we=function(v){var o=v.attributes,H=v.children,Y=v.leaf;return(0,x.jsx)("span",j()(j()({},o),{},{children:H}))},Ge=function(v){var o=v.attributes,H=v.children,Y=v.element;switch(Y.type){case"mention":return(0,x.jsx)(We,j()({},v));default:return(0,x.jsx)("p",j()(j()({},o),{},{children:H}))}},We=function(v){var o=v.attributes,H=v.children,Y=v.element,B=(0,V.vt)(),W=(0,V.UE)(),de={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:B&&W?"0 0 0 2px #B4D5FF":"none"};return Y.children[0].bold&&(de.fontWeight="bold"),Y.children[0].italic&&(de.fontStyle="italic"),(0,x.jsx)("span",j()(j()({},o),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(Y.character.replace(" ","-")),style:de,children:Be?(0,x.jsxs)(p.Fragment,{children:["1",H,"/",Y.character]}):(0,x.jsxs)(p.Fragment,{children:[(0,x.jsx)("span",{children:Y.character}),H]})}))},Ve=[{type:"paragraph",children:[{text:""}]}];ge.Z=Ue},77295:function(Xe,ge,t){t.d(ge,{CO:function(){return A}});var Ee=t(15009),K=t.n(Ee),ce=t(19632),j=t.n(ce),Re=t(99289),c=t.n(Re),be=t(5574),q=t.n(be),oe=t(45360),z=t(35312),$=t(67294),F=t(83065),A=function(M){var R,V=(R=M.split(".").pop())===null||R===void 0?void 0:R.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(V||"")},p=function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=(0,z.useIntl)(),V=(0,$.useState)([]),Z=q()(V,2),x=Z[0],ee=Z[1],Be=(0,$.useState)(!1),Ue=q()(Be,2),je=Ue[0],Se=Ue[1],we=M.maxSizeMB,Ge=we===void 0?15:we,We=M.acceptedFileTypes,Ve=We===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":We,_e=M.multiple,v=_e===void 0?!0:_e,o=function(){var W=document.createElement("input");W.type="file",W.accept=Ve,W.multiple=v,W.onchange=function(){var de=c()(K()().mark(function me(ke){var Pe,te,ae,Ke,fe,ie,s,Ce,Oe,e,pe,Le,Fe,C;return K()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(Pe=ke.target,!(Pe.files&&Pe.files.length>0)){T.next=37;break}if(Se(!0),te=Array.from(Pe.files),ae=te.filter(function(Te){return Te.size/1024/1024>Ge}),!(ae.length>0)){T.next=9;break}return oe.ZP.error("".concat(ae.map(function(Te){return Te.name}).join(", ")," ").concat(R.formatMessage({id:"workflow.uploadFileErrorText"}))),Se(!1),T.abrupt("return");case 9:Ke=[],fe=0,ie=te;case 11:if(!(fe<ie.length)){T.next=35;break}return s=ie[fe],Ce=new FormData,Ce.append("file",s),T.prev=15,T.next=18,(0,F.M$)();case 18:return Oe=T.sent,T.next=21,fetch(Oe,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:Ce});case 21:return e=T.sent,T.next=24,e.json();case 24:pe=T.sent,pe.code===0?(oe.ZP.success("".concat(s.name," ").concat(R.formatMessage({id:"workflow.uploadSuccess"}))),(Le=pe.data)!==null&&Le!==void 0&&Le.file_id&&(Fe=A(s.name),C={name:s.name,url:pe.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:Fe,file_id:pe.data.file_id,path_show:pe.data.file_url||pe.data.path_show||""},Ke.push(C))):oe.ZP.error("".concat(s.name," ").concat(R.formatMessage({id:"workflow.uploadFailed"}))),T.next=32;break;case 28:T.prev=28,T.t0=T.catch(15),console.error("Upload error:",T.t0),oe.ZP.error("".concat(s.name," ").concat(R.formatMessage({id:"workflow.uploadFailed"})));case 32:fe++,T.next=11;break;case 35:ee(function(Te){return[].concat(j()(Te),Ke)}),Se(!1);case 37:case"end":return T.stop()}},me,null,[[15,28]])}));return function(me){return de.apply(this,arguments)}}(),W.click()},H=function(W){ee(function(de){return de.filter(function(me){return me.uid!==W})})},Y=function(){ee([])};return{uploadedFiles:x,setUploadedFiles:ee,handleUpload:o,removeFile:H,clearFiles:Y,isUploading:je}};ge.ZP=p}}]);
