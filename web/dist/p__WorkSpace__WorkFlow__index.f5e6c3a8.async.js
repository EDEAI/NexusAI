"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{36711:function(ot,ye,t){t.r(ye),t.d(ye,{waitTime:function(){return v},waitTimePromise:function(){return Ne}});var Re=t(97857),C=t.n(Re),Oe=t(5574),_e=t.n(Oe),Be=t(15009),de=t.n(Be),He=t(99289),Pe=t.n(He),Ue=t(42237),je=t(29608),De=t(32592),V=t(35312),xe=t(67294),Ve=t(85893),Ne=function(){var T=Pe()(de()().mark(function l(){var e,q=arguments;return de()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return e=q.length>0&&q[0]!==void 0?q[0]:100,G.abrupt("return",new Promise(function($){setTimeout(function(){$(!0)},e)}));case 2:case"end":return G.stop()}},l)}));return function(){return T.apply(this,arguments)}}(),v=function(){var T=Pe()(de()().mark(function l(){var e,q=arguments;return de()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return e=q.length>0&&q[0]!==void 0?q[0]:100,G.next=3,Ne(e);case 3:case"end":return G.stop()}},l)}));return function(){return T.apply(this,arguments)}}();ye.default=function(){var T=(0,V.useIntl)(),l=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:T.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(fe){var M;ce==null||(M=ce.current)===null||M===void 0||M.submit()}}},{title:T.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:T.formatMessage({id:"workflow.created_time_des",defaultMessage:T.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:T.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,valueType:"select",fieldProps:{onChange:function(fe){var M;ce==null||(M=ce.current)===null||M===void 0||M.submit()}},valueEnum:{1:{text:T.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:T.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:T.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(T.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:T.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:T.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,key:"user"}],e=(0,V.useSearchParams)(),q=_e()(e,1),Ze=q[0],G=(0,je.Z)(function(Y){return Y.setRunPanelLogRecord}),$=Ze.get("app_id"),ce=(0,xe.useRef)(null);return(0,Ve.jsx)(De.Z,{columns:l,formRef:ce,form:{submitter:!1},cardBordered:!0,request:function(){var Y=Pe()(de()().mark(function fe(M,We,N){var X;return de()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return console.log(M,We,N),pe.next=3,(0,Ue.bB)(C()(C()({app_runs_name:"",app_runs_status:0},M),{},{app_id:$}));case 3:return X=pe.sent,console.log(X),pe.abrupt("return",{data:X.data.list,success:!0,total:X.data.total_count});case 6:case"end":return pe.stop()}},fe)}));return function(fe,M,We){return Y.apply(this,arguments)}}(),onRow:function(fe){return{onClick:function(){console.log("Row clicked:",fe),G(fe)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:T.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})}},23677:function(ot,ye,t){t.r(ye),t.d(ye,{default:function(){return Lt}});var Re=t(5574),C=t.n(Re),Oe=t(47520),_e=t(36711),Be=t(82826),de=t(43425),He=t(48869),Pe=t(69243),Ue=t(91806),je=t(34994),De=t(52688),V=t(35312),xe=t(77598),Ve=t(55241),Ne=t(50136),v=t(67294),T=t(10899),l=t(1096),e=t(85893),q=function(){var c,u=(0,V.useIntl)(),b=(0,v.useState)(!0),A=C()(b,2),g=A[0],r=A[1],h=(0,l.Z)(function(m){return m.setWorkflowEditInfo}),i=(0,l.Z)(function(m){return m.workFlowInfo}),W=(0,l.Z)(function(m){return m.setSelect}),ee=(0,v.useState)("1"),z=C()(ee,2),le=z[0],te=z[1],n=(0,v.useState)(!1),ne=C()(n,2),ie=ne[0],H=ne[1],x=(0,T.Z)(),k=(0,v.useRef)(null),a=function(){var P,Z;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(je.A,{formRef:k,submitter:{render:function(){return null}},onValuesChange:j,layout:"horizontal",children:[(0,e.jsx)(De.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(De.Z,{tooltip:(i==null||(P=i.app)===null||P===void 0?void 0:P.publish_status)!="1"?{title:u.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(i==null||(Z=i.app)===null||Z===void 0?void 0:Z.publish_status)!="1",name:"enable_api",label:"API"})]})})})},w=[{key:"4",icon:(0,e.jsx)(Be.Z,{}),label:u.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:i!=null&&i.isProd?(0,e.jsx)(de.Z,{}):(0,e.jsx)(Ve.Z,{content:a,trigger:"click",forceRender:!0,placement:"rightTop",title:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(de.Z,{})}),label:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:i==null?void 0:i.isProd},{key:"1",icon:(0,e.jsx)(He.Z,{}),label:u.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Pe.Z,{}),label:u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:ie?u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):u.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!ie},{key:"3",icon:(0,e.jsx)(Ue.Z,{}),label:u.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,xe.Z)(function(){if(i){var m,P,Z,F,J=i==null||(m=i.app)===null||m===void 0?void 0:m.is_public,Te=i==null||(P=i.app)===null||P===void 0?void 0:P.enable_api,oe={};oe.is_public=!!J,oe.enable_api=(i==null||(Z=i.app)===null||Z===void 0?void 0:Z.publish_status)=="1"?!!Te:!1,console.log(oe),H(oe.enable_api),k==null||(F=k.current)===null||F===void 0||F.setFieldsValue(oe)}},[i]);var j=function(P,Z){console.log(P,Z),p(Z.enable_api),h(Z),setTimeout(x,300)},p=function(P){H(!!P)},ae=function(P){var Z;switch(P.key){case"4":V.history.go(-1);break;case"0":break;case"2":window.open(Oe._n+(i==null||(Z=i.app)===null||Z===void 0?void 0:Z.api_url),"_blank");break;default:W(""),te(P.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"fixed left-[0px] top-16 mt-2 transition-all duration-300 z-20",children:[(0,e.jsx)(Ne.Z,{defaultSelectedKeys:["1"],selectedKeys:[le],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:g,items:w,onClick:ae}),le=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px]  bg-white  rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(je.A,{formRef:k,submitter:{render:function(){return null}},onValuesChange:j,layout:"horizontal",children:[(0,e.jsx)(De.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(De.Z,{disabled:!(i!=null&&(c=i.app)!==null&&c!==void 0&&c.api_url),name:"enable_api",label:"API"})]})})})]}),le=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px]   pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(_e.default,{})})})]})},Ze=q,G=t(15009),$=t.n(G),ce=t(99289),Y=t.n(ce),fe=t(97857),M=t.n(fe),We=t(32060),N=t(42237),X=t(63648),rt=t(16091),pe=t(13118),Qe=t(78234),Ie=t(45360),st=t(85576),re=t(71471),lt=t(64599),it=t.n(lt),$e=t(7493),ut=t(34559),se=t(96906),Rt=function(c){return{nodes:c.nodes,edges:c.edges,onNodesChange:c.onNodesChange,onEdgesChange:c.onEdgesChange,onConnect:c.onConnect,nodeTypes:c.nodeTypes,connectionLineStyle:c.connectionLineStyle,defaultViewport:c.defaultViewport,onDrop:c.onDrop,onDragOver:c.onDragOver,setSelect:c.setSelect,preventScrolling:c.preventScrolling}},dt=(0,v.memo)(function(E){var c=E.children,u=(0,V.useIntl)(),b=(0,l.Z)(function(a){return a.nodes}),A=(0,l.Z)(function(a){return a.getEdges}),g=(0,l.Z)(function(a){return a.edges}),r=(0,l.Z)(function(a){return a.setEdges}),h=(0,l.Z)(function(a){return a.onNodesChange}),i=(0,l.Z)(function(a){return a.onEdgesChange}),W=(0,l.Z)(function(a){return a.onConnect}),ee=(0,l.Z)(function(a){return a.nodeTypes}),z=(0,l.Z)(function(a){return a.connectionLineStyle}),le=(0,l.Z)(function(a){return a.defaultViewport}),te=(0,l.Z)(function(a){return a.onDrop}),n=(0,l.Z)(function(a){return a.onDragOver}),ne=(0,l.Z)(function(a){return a.setSelect}),ie=(0,l.Z)(function(a){return a.preventScrolling}),H=(0,v.useCallback)(function(a){var w=b.find(function(p){return p.id===a.target}),j=function p(ae){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(m.has(ae.id))return!1;m.add(ae.id);var P=it()((0,$e.xA)(ae,b,g)),Z;try{for(P.s();!(Z=P.n()).done;){var F=Z.value;if(F.id===a.source||p(F,m))return!0}}catch(J){P.e(J)}finally{P.f()}};return w.id===a.source?!1:!j(w)},[b,g]),x=function(){},k=(0,v.useCallback)(function(a,w){console.log(a,w,A(),(0,$e.Kz)(a,w,g)),r((0,$e.Kz)(a,w,A()))},[]);return(0,xe.Z)(function(){},[b]),(0,e.jsx)(ut.tV,{children:(0,e.jsx)(X.x$,{onViewportChange:x,nodes:b,edges:g,onNodesChange:h,onEdgesChange:i,onEdgesDelete:function(w){},onConnect:W,onReconnect:k,nodeTypes:ee,minZoom:.3,maxZoom:1,connectionLineStyle:z,snapToGrid:!1,isValidConnection:H,connectionRadius:30,preventScrolling:ie,onDragOver:n,onPaneClick:function(){ne("")},onPaneContextMenu:function(w){w.preventDefault()},onSelectionChange:function(w){},onNodeClick:function(w,j){ne(j.id)},onEdgeClick:function(w,j){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(w){},onBeforeDelete:function(){var a=Y()($()().mark(function w(j){var p;return $()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if((j==null||(p=j.nodes)===null||p===void 0||(p=p[0])===null||p===void 0?void 0:p.type)!=se.vW.Start){m.next=3;break}return Ie.ZP.error(u.formatMessage({id:"workflow.delStartNodeError"})),m.abrupt("return",Promise.reject(u.formatMessage({id:"workflow.delStartNodeError"})));case 3:return ne(""),m.abrupt("return",Promise.resolve(j));case 5:case"end":return m.stop()}},w)}));return function(w){return a.apply(this,arguments)}}(),fitView:!0,children:c})})}),ct=function(c){var u=(0,v.useCallback)(function(g){g.preventDefault(),g.dataTransfer.dropEffect="move"},[]),b=(0,v.useCallback)(function(g){g.preventDefault();var r=g.dataTransfer.getData("application/reactflow");if(!r)return null;var h=JSON.parse(r),i=h.type,W=h.item;if(!i||!W)return null;var ee=c({x:g.clientX,y:g.clientY});return{position:ee,type:i,item:W}},[c]),A=(0,v.useCallback)(function(g){var r=function(i){var W=b(i);W&&g(W.position,W.type,W.item)};return document.addEventListener("dragover",u),document.addEventListener("drop",r),function(){document.removeEventListener("dragover",u),document.removeEventListener("drop",r)}},[u,b]);return{onDnD:A}},ft=ct,vt=function(){var c=(0,l.Z)(function(r){return r.setAgentData}),u=(0,l.Z)(function(r){return r.setSkillData}),b=(0,l.Z)(function(r){return r.setToolData}),A=(0,l.Z)(function(r){return r.setDatasetData}),g=(0,l.Z)(function(r){return r.setTeamDatasetData});(0,v.useEffect)(function(){(0,N.x$)(2).then(function(r){r.code===0&&c({team:r.data})}),(0,N.x$)(3).then(function(r){r.code===0&&c({user:r.data})}),(0,N.w)(2).then(function(r){r.code===0&&u({team:r.data})}),(0,N.w)(3).then(function(r){r.code===0&&u({user:r.data})}),(0,N.GZ)().then(function(r){r.code===0&&b({list:Object.values(r.data)})}),(0,N.mG)().then(function(r){r.code==0&&A({list:r.data.data.map(function(h){return M()(M()({},h),{},{label:h.name,value:h.dataset_id})})})}),(0,N.mG)(2).then(function(r){r.code==0&&g({list:r.data.data.map(function(h){return M()(M()({},h),{},{label:h.name,value:h.dataset_id})})})})},[c,u,b])},mt=vt,pt=t(83065),gt=t(39944),Ke=t(10759),ke=t(55927),ht=t(33914),xt=t(88284),wt=t(28508),qe=t(90672),Mt=t(46822),yt=t(97462),jt=t(64317),Dt=t(29933),St=t(3917),bt=t(40056),et=t(2487),we=t(28036),Ct=t(96486),tt=t.n(Ct),Se=t(29432),Ae=t(92485),_t=re.Z.Text,Bt=bt.Z.ErrorBoundary,Pt=(0,v.memo)(function(){var E,c,u=(0,V.useIntl)(),b=(0,v.useState)(!1),A=C()(b,2),g=A[0],r=A[1],h=(0,ke.Z)(function(s){return s.dealtWithData}),i=(0,ke.Z)(function(s){return s.setDealtWithData}),W=(0,ke.Z)(function(s){return s.setFlowMessage}),ee=(0,ke.Z)(function(s){return s.getNeedHumanConfirmMessage}),z=(0,ke.Z)(function(s){return s.flowMessage}),le=(0,v.useState)(null),te=C()(le,2),n=te[0],ne=te[1],ie=(0,v.useState)(""),H=C()(ie,2),x=H[0],k=H[1],a=(0,v.useState)(!1),w=C()(a,2),j=w[0],p=w[1],ae=(0,v.useState)(""),m=C()(ae,2),P=m[0],Z=m[1],F=(0,St.Z)(N.N7,{manual:!0}),J=F.loading,Te=F.runAsync;(0,v.useEffect)(function(){var s;r(!!h);var d=h==null||(s=h.data)===null||s===void 0||(s=s.node_exec_data)===null||s===void 0?void 0:s.node_exec_id;return console.log(h,d),k(d),d&&oe(d),function(){r(!1)}},[h]);var oe=function(d){J||Te(d).then(function(f){f.data&&(ne(f.data),d!=P&&(p(!1),Z(d)))})};(0,xe.Z)(function(){console.log(z,x);var s=z.find(function(d){var f;return(d==null||(f=d.data)===null||f===void 0||(f=f.node_exec_data)===null||f===void 0?void 0:f.node_exec_id)==x});console.log(s),s&&oe(x)},[z.length]);var be=function(d){p(!0),(0,N.YX)(x,{correct_prompt:new gt.N("",d.prompt,""),operation:1,outputs:(n==null?void 0:n.outputs)||null}).then(function(f){f.code==0&&(Me(x),k(f.data.exec_id))})},Me=function(d){var f=z.filter(function(D){var I;return!((D==null||(I=D.data)===null||I===void 0||(I=I.node_exec_data)===null||I===void 0?void 0:I.node_exec_id)==d&&(D==null?void 0:D.type)=="workflow_need_human_confirm")});W(f)},Fe=function(){(0,N.YX)(x,{operation:0,outputs:(n==null?void 0:n.outputs)||null}).then(function(d){d.code==0&&(r(!1),Me(x),i(null))})},Ge=(0,v.useCallback)(function(){var s,d,f=h==null||(s=h.data)===null||s===void 0||(s=s.node_exec_data)===null||s===void 0?void 0:s.node_type;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[f!=se.vW.LLM&&(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"input"})}),(n==null||(d=n.correct_llm_history)===null||d===void 0?void 0:d.length)>0&&(0,e.jsx)(et.Z,{header:(0,e.jsx)(re.Z.Title,{level:5,children:u.formatMessage({id:"workflow.historyPrompt",defaultMessage:"prompt"})}),dataSource:n==null?void 0:n.correct_llm_history,renderItem:function(I){var L;return(0,e.jsx)(et.Z.Item,{children:I==null||(L=I.correct_prompt)===null||L===void 0||(L=L.user)===null||L===void 0?void 0:L.value})}}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.outputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"output"})})]}),(0,e.jsx)(je.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:u.formatMessage({id:"workflow.xz"})}},loading:j,onFinish:be,children:(0,e.jsx)("div",{className:"flex ",children:(0,e.jsxs)("div",{className:"flex-1 pt-2 border-stone-300 border rounded-md my-2",children:[(0,e.jsxs)("div",{className:"px-2 flex justify-between cursor-default",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"text-sm text-gray-500 font-bold pb-1",children:"Prompt"})}),(0,e.jsx)("div",{})]}),(0,e.jsx)("div",{className:" pb-6 user-input-error",children:(0,e.jsx)(qe.Z,{formItemProps:{className:"mb-0"},name:"prompt",required:!0,rules:[{required:!0,message:u.formatMessage({id:"workflow.requireInputPrompt"})}],fieldProps:{variant:"borderless",placeholder:u.formatMessage({id:"workflow.requireInputPrompt"}),autoSize:{minRows:2,maxRows:40},count:{show:function(I){var L=I.value,ve=I.count,K=I.maxLength;return(0,e.jsx)("div",{className:"pr-2 text-blue-400",children:ve})}}}})})]})})})]})},[n]),ze=(0,v.useCallback)(function(){var s,d,f,D=n==null||(s=n.node_graph)===null||s===void 0||(s=s.data)===null||s===void 0?void 0:s.input,I=D==null?void 0:D.properties,L=n==null||(d=n.node_graph)===null||d===void 0||(d=d.data)===null||d===void 0?void 0:d.requires_upload,ve=n==null||(f=n.node_graph)===null||f===void 0||(f=f.data)===null||f===void 0||(f=f.import_to_knowledge_base)===null||f===void 0?void 0:f.input;console.log("requires_upload",n,L);var K=(0,l.Z)(function(o){return o.datasetData});if(!I)return(0,e.jsx)(e.Fragment,{children:u.formatMessage({id:"workflow.requireInputPrompt",defaultMessage:""})});var ge=Object.values(I),ue=function(y){var S;console.log(y);var U=(0,Ke.vV)(D);if(ge.length>0){var he=Object.entries(y).filter(function(R){var _=C()(R,2),me=_[0],B=_[1];return me.startsWith("variables.")});he.forEach(function(R){var _=C()(R,2),me=_[0],B=_[1];U.properties[me.replace("variables.","")].value=B})}var O=new Ke.V7(Se.Mp,"array[number]");y.file&&y.file.forEach(function(R){var _,me=new Ke._w(R.uid,"number",(R==null||(_=R.response)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.file_id)||0);O.addValue(me)}),U.addProperty(Se.Mp,O),console.log(U,O);var Q=(n==null||(S=n.node_graph)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.knowledge_base_mapping)||{input:{},output:{}};Object.entries(y).forEach(function(R){var _=C()(R,2),me=_[0],B=_[1];me.startsWith("dataset.")&&(Q.input[Se.Mp]||(Q.input[Se.Mp]={}),Q.input[Se.Mp][me.replace("dataset.","")]=B)}),console.log(Q),(0,N.YX)(x,{operation:0,inputs:U,outputs:null,correct_prompt:null,knowledge_base_mapping:Q}).then(function(R){R.code==0&&(r(!1),i(null),Me(x))})},Ee={icon:(0,e.jsx)(ht.Z,{}),title:u.formatMessage({id:"workflow.uploadFileText",defaultMessage:"\uFF0C"}),description:u.formatMessage({id:"workflow.uploadFileDes"}),accept:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv",fieldProps:{listType:"picture",name:"file",multiple:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},action:pt.M$,beforeUpload:function(y){var S=y.size/1024/1024<15;return S||Ie.ZP.error(u.formatMessage({id:"workflow.uploadFileErrorText"})),S}}};return(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsxs)(je.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:u.formatMessage({id:"workflow.checked",defaultMessage:""})}},onFinish:ue,children:[ge.map(function(o){return(0,e.jsx)(qe.Z,{label:o.display_name,name:"variables.".concat(o.name),required:o.required,rules:[{required:o.required,message:u.formatMessage({id:"workflow.toInput"})}]},o.name)}),L&&(0,e.jsx)(Mt.Z,M()({name:"file"},Ee)),(0,e.jsx)(yt.Z,{name:["file"],children:function(y){var S=y.file;return ve&&(S==null?void 0:S.length)>0&&(S==null?void 0:S.map(function(U){return(0,e.jsx)(jt.Z,{label:U.name,name:"dataset.".concat(U.uid),options:(K==null?void 0:K.list)||[],required:!0,rules:[{required:!0,message:u.formatMessage({id:"workflow.select_to_knowledge_base"})}]},U.uid)}))||null}})]})})},[n]),Ce=function(d){if(d.type!=="object"||!d.properties)return[d];var f=[],D=function I(L){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";tt().forOwn(L,function(K,ge){var ue=ve?"".concat(ve,".").concat(ge):ge;K.type==="object"&&K.properties?I(K.properties,ue):f.push(M()(M()({},K),{},{name:ue}))})};return D(d.properties),f},Je=function(d){return d.reduce(function(f,D){return f[D.name]=D.value,f},{})},Ye=(0,v.useCallback)(function(){console.log(n);var s=n==null?void 0:n.inputs,d=(0,v.useRef)(null),f=(0,v.useState)([]),D=C()(f,2),I=D[0],L=D[1],ve=(0,v.useState)({}),K=C()(ve,2),ge=K[0],ue=K[1],Ee=Ie.ZP.useMessage(),o=C()(Ee,2),y=o[0],S=o[1];(0,Qe.Z)(function(){n!=null&&n.outputs&&(console.log(s,Ce(n==null?void 0:n.outputs)),L(Ce(n==null?void 0:n.outputs)),ue(JSON.stringify(Ce(n==null?void 0:n.outputs))))});var U=function(){var O={};try{O=JSON.parse(ge),console.log(O,O[0]),(0,N.YX)(x,{outputs:tt().isArray(O)?O[0]:O}).then(function(Q){Q.code==0&&(y.success(u.formatMessage({id:"workflow.checkSc",defaultMessage:""})),r(!1),Me(x),i(null))})}catch(Q){console.log(Q),y.error(u.formatMessage({id:"workflow.checkOutputMessageError",defaultMessage:","}))}};return(0,e.jsxs)("div",{children:[S,(0,e.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[!Se.eT.includes(n==null?void 0:n.node_type)&&(0,e.jsxs)("div",{children:[(0,e.jsx)(re.Z.Title,{level:5,children:"Inputs"}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(O){ue(O)}})})]}),(0,e.jsxs)(re.Z.Title,{level:5,children:["Outputs(",u.formatMessage({id:"workflow.toEdit",defaultMessage:""}),")"]}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.outputs,isJSONStringifyBeauty:!0,onChange:function(O){ue(O)}})}),(0,e.jsx)(we.ZP,{type:"primary",onClick:U,className:"w-full mt-4",children:u.formatMessage({id:"workflow.checked",defaultMessage:""})})]})]})},[n]),Xe=(0,v.useCallback)(function(){var s=n==null?void 0:n.node_type;return s==se.vW.Human?(0,e.jsx)(ze,{}):s==se.vW.LLM||s==se.vW.Agent||s==se.vW.TaskGeneration?(0,e.jsx)(Ge,{}):(0,e.jsx)(Ye,{})},[n]),Le=function(){var d=n==null?void 0:n.node_type;return d==se.vW.LLM||d==se.vW.Agent||d==se.vW.TaskGeneration?(0,e.jsx)(we.ZP,{type:"text",onClick:Fe,className:"text-green-500",disabled:j,icon:(0,e.jsx)(xt.Z,{}),children:u.formatMessage({id:"workflow.checkBackLogs",defaultMessage:""})}):null};return g?(0,e.jsx)(Dt.Z,{className:"w-[400px] border border-blue-300 fixed z-10  top-[105px] right-2 ",style:{height:"calc(100vh - 10px - 100px)"},extra:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Le,{}),(0,e.jsx)(we.ZP,{onClick:function(){r(!1),i(null)},type:"text",icon:(0,e.jsx)(wt.Z,{})})]}),title:(0,e.jsx)(re.Z.Title,{level:5,children:u.formatMessage({id:"workflow.backlogs",defaultMessage:""})}),bodyStyle:{overflowY:"auto",marginTop:"20px",boxSizing:"border-box"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Title,{level:5,children:n==null||(E=n.node_graph)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.title})}),(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{children:n==null||(c=n.node_graph)===null||c===void 0||(c=c.data)===null||c===void 0?void 0:c.desc})}),Xe()]})}):null}),nt=t(55877),Zt=t(63680),It=t(74842),kt=t(98165),Tt=t(58638),Et=t(27484),Ot=t.n(Et),Nt=(0,v.memo)(function(){var E=(0,V.useIntl)(),c=(0,V.useSearchParams)(),u=C()(c,1),b=u[0],A=(0,l.Z)(function(x){return x.setWorkFlowInfo}),g=(0,l.Z)(function(x){return x.workFlowInfo}),r=(0,l.Z)(function(x){return x.setRunPanelShow}),h=b.get("type")=="true",i=(0,T.Z)(),W=Ie.ZP.useMessage(),ee=C()(W,2),z=ee[0],le=ee[1],te=function(){var x=Y()($()().mark(function k(){var a;return $()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,i();case 2:a=b.get("app_id"),(0,N.aJ)(a).then(function(p){console.log(p),p.code==0&&(A(M()(M()({},g),{},{app:M()(M()({},g==null?void 0:g.app),{},{publish_status:"1"})})),z.open({type:"success",content:E.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return j.stop()}},k)}));return function(){return x.apply(this,arguments)}}(),n=function(){r(!0)},ne=function(){var x=Y()($()().mark(function k(){var a,w;return $()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=b.get("app_id"),p.next=3,(0,N.Uq)(a);case 3:w=p.sent;case 4:case"end":return p.stop()}},k)}));return function(){return x.apply(this,arguments)}}(),ie=function(){var x=Y()($()().mark(function k(){var a,w,j,p;return $()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:w=b.get("app_id"),j=(g==null||(a=g.app)===null||a===void 0?void 0:a.name)||"workflow",p=Ot()().format("YYYY_MM_DD-HH_mm_ss"),(0,N.w8)(w,h==!0?1:0).then(function(P){var Z=new Blob([P],{type:"text/yaml"}),F=URL.createObjectURL(Z),J=document.createElement("a");J.href=F,J.download="".concat(j,"_").concat(p,".yml"),document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(F)});case 4:case"end":return m.stop()}},k)}));return function(){return x.apply(this,arguments)}}(),H={name:"file",fileList:null,action:Oe._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!h&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(we.ZP,{type:"primary",onClick:te,children:E.formatMessage({id:"workflow.release"})}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(It.Z,{}),onClick:n,children:E.formatMessage({id:"workflow.run"})}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(kt.Z,{}),type:"dashed",onClick:i,children:E.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(Tt.Z,{}),type:"dashed",onClick:ie,children:E.formatMessage({id:"workflow.export",defaultMessage:""})}),le]})}),Wt=function(){var c,u,b=(0,V.useIntl)(),A=(0,v.useRef)(null),g=(0,l.Z)(function(o){return o.resetNodes}),r=(0,l.Z)(function(o){return o.setNodeTypes}),h=(0,l.Z)(function(o){return o.addNode}),i=(0,l.Z)(function(o){return o.createNode}),W=(0,l.Z)(function(o){return o.setNodes}),ee=(0,l.Z)(function(o){return o.setEdges}),z=(0,l.Z)(function(o){return o.setAppId}),le=(0,l.Z)(function(o){return o.setRunPanelShow}),te=(0,l.Z)(function(o){return o.runPanelShow}),n=(0,l.Z)(function(o){return o.getModelData}),ne=(0,l.Z)(function(o){return o.setWorkFlowInfo}),ie=(0,l.Z)(function(o){return o.setHandleList}),H=(0,l.Z)(function(o){return o.workFlowInfo}),x=(0,l.Z)(function(o){return o.setWorkflowEditInfo}),k=Ie.ZP.useMessage(),a=C()(k,2),w=a[0],j=a[1],p=(0,X._K)(),ae=p.screenToFlowPosition,m=p.getNodes,P=p.setViewport,Z=ft(ae),F=Z.onDnD,J=(0,V.useSearchParams)(),Te=C()(J,1),oe=Te[0],be=oe.get("type")=="true",Me=(0,X.B)({includeHiddenNodes:!1}),Fe=(0,pe.Z)(),Ge=(0,T.Z)(),ze=(0,v.useState)(null),Ce=C()(ze,2),Je=Ce[0],Ye=Ce[1],Xe=(0,v.useState)(!1),Le=C()(Xe,2),s=Le[0],d=Le[1],f=(0,v.useState)(""),D=C()(f,2),I=D[0],L=D[1],ve=null;(0,X.CV)({onEnd:function(y){}}),(0,Qe.Z)(function(){r((0,Zt.$P)()),g(),(0,We.b6)(),K(),ie([])}),mt(),(0,v.useEffect)(function(){if(Je){V.history.push(I);return}var o=V.history.block(function(y,S){if(te){L(y.location.pathname),d(!0);return}});return te||o==null||o(),function(){o==null||o()}},[te,Je]),(0,xe.Z)(function(){if(Me){var o=m(),y=o[o.length-1];y.data.drag&&(y.position={x:y.position.x-y.measured.width/2,y:y.position.y-y.measured.height/2},W(o))}},[Me]),(0,v.useEffect)(function(){var o=F(function(y,S,U){console.log(y,S,U),i(S,{position:y,data:M()(M()({drag:!0},U.data),{},{baseData:U.baseData})})});return o},[F,h]),(0,xe.Z)(function(){Fe=="hidden"&&Ge()},[Fe]);var K=function(){var o=Y()($()().mark(function y(){var S;return $()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:S=oe.get("app_id"),be&&w.open({type:"warning",content:b.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),z(S),(0,N.kE)(S,be?1:0).then(function(O){if(O.code==0){if(ne(M()(M()({},O.data),{},{isProd:be})),!O.data.workflow.graph){i(se.vW.Start);return}var Q=O.data,R=Q.workflow.graph,_=R.edges,me=R.nodes,B=R.views,at=Q.app;x({enable_api:!!at.enable_api,is_public:!!at.is_public}),B!=null&&B.nodes&&W(B.nodes),B!=null&&B.edges&&ee(B.edges),B!=null&&B.viewPort}}),n();case 5:case"end":return he.stop()}},y)}));return function(){return o.apply(this,arguments)}}(),ge=function(){le(!0)},ue=function(){Ye(!0),console.log(I),V.history.push(I),d(!1)},Ee=function(){d(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[j,(0,e.jsx)(st.Z,{title:b.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:s,onOk:ue,onCancel:Ee,children:b.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:A,children:(0,e.jsxs)(dt,{children:[(0,e.jsx)(X.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(X.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-left",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsxs)("div",{className:"fixed left-8 top-16 flex  flex-col gap-2 pt-3 pl-4",children:[(0,e.jsx)(re.Z.Title,{className:"!m-0",level:5,children:H==null||(c=H.app)===null||c===void 0?void 0:c.name}),be&&(0,e.jsxs)(re.Z.Text,{children:["( ",b.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(re.Z.Text,{children:H==null||(u=H.app)===null||u===void 0?void 0:u.description})]}),(0,e.jsx)(Nt,{}),(0,e.jsx)(nt.s_,{}),(0,e.jsx)(nt.Jf,{}),(0,e.jsx)(Pt,{})]})},At=(0,v.memo)(function(){return(0,e.jsx)(X.tV,{children:(0,e.jsx)(Wt,{})})}),Ft=function(){return(0,e.jsxs)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:[(0,e.jsx)(Ze,{}),(0,e.jsx)(At,{})]})},Lt=Ft}}]);
