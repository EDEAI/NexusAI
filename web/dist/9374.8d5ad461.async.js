(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9374],{69243:function(L,F,e){"use strict";e.d(F,{Z:function(){return w}});var R=e(1413),_=e(67294),P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"}}]},name:"desktop",theme:"outlined"},v=P,A=e(91146),I=function(f,y){return _.createElement(A.Z,(0,R.Z)((0,R.Z)({},f),{},{ref:y,icon:v}))},j=_.forwardRef(I),w=j},15360:function(L,F,e){"use strict";e.d(F,{Z:function(){return w}});var R=e(1413),_=e(67294),P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},v=P,A=e(91146),I=function(f,y){return _.createElement(A.Z,(0,R.Z)((0,R.Z)({},f),{},{ref:y,icon:v}))},j=_.forwardRef(I),w=j},43319:function(L,F,e){"use strict";e.d(F,{Z:function(){return be}});var R=e(19632),_=e.n(R),P=e(15009),v=e.n(P),A=e(99289),I=e.n(A),j=e(97857),w=e.n(j),W=e(5574),f=e.n(W),y=e(11551),ae=e(18304),K=e(38008),Me=e(77295),xe=e(39944),Z=e(55927),S="agent_fullscreen_states",p=function(o){try{var u=localStorage.getItem(S);if(!u)return!1;var g=JSON.parse(u);return g[String(o)]||!1}catch(E){return console.warn("Failed to get agent fullscreen state:",E),!1}},z=function(o,u){try{var g=localStorage.getItem(S),E=g?JSON.parse(g):{};E[String(o)]=u,localStorage.setItem(S,JSON.stringify(E)),console.log("Agent ".concat(o," fullscreen state saved: ").concat(u))}catch(k){console.warn("Failed to save agent fullscreen state:",k)}},J=function(o){try{var u=localStorage.getItem(S);if(!u)return;var g=JSON.parse(u);delete g[String(o)],localStorage.setItem(S,JSON.stringify(g)),console.log("Agent ".concat(o," fullscreen state cleared"))}catch(E){console.warn("Failed to clear agent fullscreen state:",E)}},Y=function(){try{var o=localStorage.getItem(S);return o?JSON.parse(o):{}}catch(u){return console.warn("Failed to get all agent fullscreen states:",u),{}}},ne=function(){try{localStorage.removeItem(S),console.log("All agent fullscreen states cleared")}catch(o){console.warn("Failed to clear all agent fullscreen states:",o)}},re=e(58299),G=e(85750),M=e(19078),Q=e(1413),d=e(67294),X=e(44685),se=e(91146),q=function(o,u){return d.createElement(se.Z,(0,Q.Z)((0,Q.Z)({},o),{},{ref:u,icon:X.Z}))},ee=d.forwardRef(q),le=ee,ie=e(34994),oe=e(35312),Ie=e(77598),x=e(45360),T=e(74330),N=e(66309),V=e(28036),ye=e(32983),i=e(85893),be=(0,d.memo)(function(a){var o,u,g,E,k,B,Ke=(0,d.useState)([]),we=f()(Ke,2),ze=we[0],ue=we[1],Ge=(0,d.useState)(!0),Ee=f()(Ge,2),_t=Ee[0],Ve=Ee[1],ke=(0,d.useState)(1),Fe=f()(ke,2),St=Fe[0],Je=Fe[1],Ye=(0,d.useState)(!0),Re=f()(Ye,2),Qe=Re[0],Xe=Re[1],qe=(0,d.useState)(!1),Te=f()(qe,2),de=Te[0],De=Te[1],et=(0,d.useState)(!1),Le=f()(et,2),Mt=Le[0],ce=Le[1],tt=(0,d.useState)(!1),Oe=f()(tt,2),Pe=Oe[0],Ae=Oe[1],at=(0,d.useState)(!1),je=f()(at,2),nt=je[0],fe=je[1],rt=(0,d.useState)(!1),Ce=f()(rt,2),D=Ce[0],ve=Ce[1],ge=(0,d.useRef)(),st=(0,d.useRef)(null),lt=(0,d.useRef)(null),O=(0,oe.useIntl)(),me=(0,Z.Z)(function(s){return s.getTypedMessages("chat_message_llm_return")}),it=(0,d.useState)(null),Ue=f()(it,2),Ze=Ue[0],ot=Ue[1],he=(0,Z.Z)(function(s){return s.getTypedLastMessage("chat_message_llm_return")}),ut=(0,d.useState)(null),Ne=f()(ut,2),$=Ne[0],dt=Ne[1],ct=(0,re.m)(),te=ct.options,ft=function(n){if(!n||!te)return"\u672A\u77E5\u6A21\u578B";var r=(0,G.ti)(n,{options:te});return(r==null?void 0:r.label)||"\u672A\u77E5\u6A21\u578B"},vt=function(n){if(!n||!te)return!1;var r=(0,G.ti)(n,{options:te});return(r==null?void 0:r.support_image)===1},gt=function(){var n,r=(n=a.data)===null||n===void 0||(n=n.detailList)===null||n===void 0||(n=n.agent)===null||n===void 0?void 0:n.agent_id;if(r){var l=!D;ve(l),z(r,l)}else console.warn("Cannot save fullscreen state: agentId is not available"),ve(function(c){return!c})};(0,d.useEffect)(function(){var s;if(((s=a.data)===null||s===void 0||(s=s.detailList)===null||s===void 0||(s=s.app)===null||s===void 0?void 0:s.name)!=null){var n=a.data.detailList.agent_chatroom_id,r=a.data.detailList.agent.agent_id;if(n){var l=window.location.search,c=new URLSearchParams(l);ot(n),c.set("id",String(n));var m="".concat(window.location.pathname,"?").concat(c.toString()).concat(window.location.hash);window.history.replaceState({},"",m)}var t=w()(w()({},a.data.detailList.app),{},{agent:a.data.detailList.agent,agent_id:r});if(dt(t),r){var C=p(r);console.log("Restoring fullscreen state for agent ".concat(r,": ").concat(C)),ve(C)}setTimeout(function(){Xe(!1)},500)}},[(o=a.data)===null||o===void 0||(o=o.detailList)===null||o===void 0||(o=o.app)===null||o===void 0?void 0:o.name,(u=a.data)===null||u===void 0||(u=u.detailList)===null||u===void 0||(u=u.agent)===null||u===void 0?void 0:u.m_config_id]);var H=(0,Me.ZP)(),Be=H.uploadedFiles,xt=H.setUploadedFiles,It=H.handleUpload,yt=H.removeFile,mt=H.clearFiles,bt=H.isUploading,pe=function(){var n;(n=st.current)===null||n===void 0||n.scrollIntoView({behavior:"smooth"})},$e=function(){var s=I()(v()().mark(function n(){var r,l,c;return v()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,Ae(!0),!(a!=null&&(r=a.saveInfo)!==null&&r!==void 0&&r.firstjudgingcondition())){t.next=6;break}return t.abrupt("return",!0);case 6:if(!(a!=null&&(l=a.saveInfo)!==null&&l!==void 0&&l.secondjudgingcondition())){t.next=10;break}return t.abrupt("return",!0);case 10:return t.next=12,a==null||(c=a.saveInfo)===null||c===void 0?void 0:c.agentupdata();case 12:return t.abrupt("return",t.sent);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(0),console.error("Failed to save info:",t.t0),t.abrupt("return",!1);case 19:return t.prev=19,Ae(!1),t.finish(19);case 22:case"end":return t.stop()}},n,null,[[0,15,19,22]])}));return function(){return s.apply(this,arguments)}}();(0,Ie.Z)(function(){var s,n=he==null?void 0:he.data;if(n&&!((n==null?void 0:n.agent_id)!==((s=a.data)===null||s===void 0||(s=s.detailList)===null||s===void 0||(s=s.agent)===null||s===void 0?void 0:s.agent_id)&&!x.ZP.error)){var r=w()(w()({},n),{},{id:n.message_id});me&&me.length>0&&(ce(!1),ue(function(l){return[].concat(_()(l),[r])}),setTimeout(pe,100))}},[me]),(0,d.useEffect)(function(){!de&&ze.length>0&&pe()},[de]);var ht=function(){var s=I()(v()().mark(function n(r){var l,c,m,t,C,h,_e,He,Se,We;return v()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t=(l=ge.current)===null||l===void 0?void 0:l.getFieldsValue(),!(!t||!((c=r.content)!==null&&c!==void 0&&c.trim()))){b.next=3;break}return b.abrupt("return");case 3:return C=a.data.detailList.agent.agent_id,h=a.data.detailList.agent.input_variables,_e=t.ability_id,He=new xe.z({user:{value:t.content}}),Se=Be.map(function(U){return{name:U.name,url:U.url||U.path_show||""}}),We={id:Date.now(),content:r.content,isUser:!0,ability_id:_e,agent_id:C,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:t.content,prompt_tokens:0,total_tokens:0,file_list:Se.length>0?Se:void 0},ce(!0),ue(function(U){return[].concat(_()(U),[We])}),(m=ge.current)===null||m===void 0||m.resetFields(["content"]),b.prev=12,b.next=15,(0,y.CY)({agent_id:C,input_dict:h,ability_id:_e,prompt:He,file_list:Be.map(function(U){return U.file_id})});case 15:mt(),b.next=22;break;case 18:b.prev=18,b.t0=b.catch(12),ce(!1),x.ZP.error(O.formatMessage({id:"agent.chat.send.failed"}));case 22:setTimeout(pe,100);case 23:case"end":return b.stop()}},n,null,[[12,18]])}));return function(r){return s.apply(this,arguments)}}(),wt=function(){var s=I()(v()().mark(function n(){var r,l,c;return v()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=a.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,De(!0),t.next=6,(0,y.CU)(String(a.data.detailList.agent.agent_id),1);case 6:c=t.sent,(l=c.data)!==null&&l!==void 0&&l.list&&(ue(c.data.list),Ve(c.data.total_pages>1),Je(1)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("Failed to fetch initial messages:",t.t0);case 13:return t.prev=13,De(!1),t.finish(13);case 16:case"end":return t.stop()}},n,null,[[2,10,13,16]])}));return function(){return s.apply(this,arguments)}}();if(de)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,i.jsx)(T.Z,{})});var pt=function(){var s=I()(v()().mark(function n(){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,fe(!0),l.next=4,$e();case 4:setTimeout(I()(v()().mark(function c(){var m,t;return v()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,(0,y.Dh)((m=a.data)===null||m===void 0||(m=m.detailList)===null||m===void 0||(m=m.agent)===null||m===void 0?void 0:m.agent_id);case 3:t=h.sent,t.code==0?x.ZP.success(O.formatMessage({id:"agent.message.success.publish"})):x.ZP.error(O.formatMessage({id:"agent.message.fail.publish"})),h.next=11;break;case 7:h.prev=7,h.t0=h.catch(0),console.error("Failed to publish agent:",h.t0),x.ZP.error(O.formatMessage({id:"agent.message.fail.publish"}));case 11:return h.prev=11,fe(!1),h.finish(11);case 14:case"end":return h.stop()}},c,null,[[0,7,11,14]])})),500),l.next=11;break;case 7:l.prev=7,l.t0=l.catch(0),console.error("Failed to save before publish:",l.t0),fe(!1);case 11:case"end":return l.stop()}},n,null,[[0,7]])}));return function(){return s.apply(this,arguments)}}();return Qe?null:(0,i.jsx)("div",{ref:lt,className:"".concat(D?"fixed inset-0 z-50 !h-screen  border border-gray-300 top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:D?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,i.jsxs)(ie.A,{formRef:ge,submitter:!1,onFinish:ht,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[(0,i.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(g=a.data)===null||g===void 0||(g=g.detailList)===null||g===void 0||(g=g.app)===null||g===void 0?void 0:g.name,D&&($==null||(E=$.agent)===null||E===void 0?void 0:E.m_config_id)&&(0,i.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,i.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[ft($.agent.m_config_id),vt($.agent.m_config_id)&&(0,i.jsx)(N.Z,{color:"blue",className:"text-xs",children:O.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})})]})})]}),(0,i.jsx)(V.ZP,{type:"text",icon:D?(0,i.jsx)(M.Z,{}):(0,i.jsx)(le,{}),onClick:gt,title:O.formatMessage({id:D?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),a.operationbentate=="false"&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(V.ZP,{type:"primary",disabled:a.operationbentate!="false",loading:Pe,onClick:$e,className:"min-w-24",children:O.formatMessage({id:"agent.btn.savedebug"})}),(0,i.jsx)(V.ZP,{type:"primary",disabled:a.operationbentate!="false",loading:nt||Pe,onClick:pt,className:"min-w-24",children:O.formatMessage({id:"agent.publish"})})]})]}),Ze?(0,i.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(D?"max-w-[1400px] mx-auto justify-center":""),style:{height:D?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,i.jsx)(K.aS,{children:(0,i.jsx)(ae.F,{agentList:{current:[$]},abilitiesList:(k=a.data)===null||k===void 0?void 0:k.abilitiesList,agentChatRoomId:Ze,chatStatus:(B=a.data)===null||B===void 0||(B=B.detailList)===null||B===void 0?void 0:B.chat_status})})}):(0,i.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,i.jsx)(ye.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})},27842:function(L,F,e){"use strict";var R=e(5574),_=e.n(R),P=e(15009),v=e.n(P),A=e(99289),I=e.n(A),j=e(11551),w=e(29608),W=e(46944),f=e(35312),y=e(67294),ae=e(4730),K=e(85893),Me=null,xe=null;F.ZP=function(Z){var S=Z.agent_id,p=(0,f.useIntl)(),z=(0,f.useSearchParams)(),J=_()(z,1),Y=J[0],ne=(0,y.useRef)(null),re=(0,y.useState)(null),G=_()(re,2),M=G[0],Q=G[1],d=(0,y.useState)(!1),X=_()(d,2),se=X[0],q=X[1],ee=Y.get("app_id"),le=function(){q(!1)},ie=function(T){Q({app_id:ee,app_run_id:T.id}),q(!0)},oe=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:p.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:p.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:p.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:p.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:p.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:p.formatMessage({id:"workflow.created_time_des",defaultMessage:p.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(p.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:p.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:p.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],Ie=(0,w.Z)(function(x){return x.setRunPanelLogRecord});return(0,K.jsxs)("div",{className:"h-full",children:[(0,K.jsx)(W.Z,{columns:oe,formRef:ne,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var x=I()(v()().mark(function T(N,V,ye){var i;return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,j.My)(ee,{page:N.current,page_size:N.pageSize});case 2:return i=a.sent,a.abrupt("return",{data:i.data.list,success:!0,total:i.data.total_count});case 4:case"end":return a.stop()}},T)}));return function(T,N,V){return x.apply(this,arguments)}}(),onRow:function(T){return{onClick:function(){ie(T)},className:(M==null?void 0:M.app_run_id)===T.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:p.formatMessage({id:"agent.log.list"})}),se&&(M==null?void 0:M.app_id)&&(M==null?void 0:M.app_run_id)&&(0,K.jsx)(ae.Z,{data:M,onClose:le})]})}},49677:function(L){function F(e){if(e==null)throw new TypeError("Cannot destructure "+e)}L.exports=F,L.exports.__esModule=!0,L.exports.default=L.exports}}]);
