"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9982],{80459:function(st,Oe,c){var Te=c(32332),b=c(67294),Re=c(85893),F=function(Ce){var m=Ce.width,Ae=m===void 0?"40px":m,ee=Ce.bg,we=ee===void 0?"#F4F8F1":ee,he=Ce.rounded,be=he===void 0?"6px":he,B=Ce.data,_e=Ce.imgWidth,ue=_e===void 0?"18px":_e,me=Ce.background;B!=null&&B.avatar&&(ue=Ae);var W=me||we;return(0,Re.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Ae,height:Ae,backgroundColor:W,borderRadius:be},children:(0,Re.jsx)("img",{src:B!=null&&B.avatar?B.avatar:(0,Te.s9)("single",B==null?void 0:B.icon),style:{width:ue,height:ue,borderRadius:be},alt:""})})};Oe.Z=(0,b.memo)(F)},19982:function(st,Oe,c){c.d(Oe,{F:function(){return ar}});var Te=c(97857),b=c.n(Te),Re=c(5574),F=c.n(Re),Ie=c(45360),Ce=c(55026),m=c(67294),Ae=c(15009),ee=c.n(Ae),we=c(99289),he=c.n(we),be=c(19632),B=c.n(be),_e=c(9783),ue=c.n(_e),me=c(43722),W=c(39e3),E=c(76772),Ee=c(74330),H=c(41428),t=c(85893),Qe=function(e){var n=e.roomid,r=(0,E.useIntl)(),a=(0,W.Z)(function(C){return C.setSummaryClick}),s=(0,m.useState)(!0),o=F()(s,2),l=o[0],u=o[1],d=(0,W.Z)(function(C){return C.summaryClick});(0,m.useEffect)(function(){u(d)},[d]);var h=(0,W.Z)(function(C){return C.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(h({id:n}),a(!1))},children:[(0,t.jsx)(H.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:r.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ne=c(80459),He=c(45585),Me=c(55060),fe=c(28036),ge=c(69753),Ue=c(97245),rt=c(77295),it=function(e,n){try{var r=document.createElement("a");r.href=e,r.download=n,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(a){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",a)}},ht=function(e){var n=e.fileList,r=e.onDownload,a=r===void 0?it:r,s=e.className,o=s===void 0?"":s,l=e.showInGrid,u=l===void 0?!1:l,d=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(o),style:{maxHeight:d,overflow:d?"auto":"visible"},children:(0,t.jsx)(Me.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(u?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(h,C){var v=h.path_show||h.url,M=(0,rt.CO)(h.name);return(0,t.jsx)("div",{className:"".concat(u?"":"mb-2"),children:M?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(Me.Z,{src:v,alt:h.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(fe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ge.Z,{}),onClick:function(j){j.stopPropagation(),a(v,h.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Ue.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:h.name})]}),(0,t.jsx)(fe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ge.Z,{}),onClick:function(){return a(v,h.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(h.uid||h.file_id||C))})})})})},gt=ht,Xe=c(22683),qe=c(97807),et=c(4958),ke=c(13769),Pe=c.n(ke),ze=function(){var i=he()(ee()().mark(function e(n){return ee()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){a.next=5;break}return a.next=4,navigator.clipboard.writeText(n);case 4:return a.abrupt("return",!0);case 5:return a.abrupt("return",lt(n));case 8:return a.prev=8,a.t0=a.catch(0),console.error("Failed to copy using Clipboard API:",a.t0),a.abrupt("return",lt(n));case 12:case"end":return a.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),lt=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var r=document.execCommand("copy");return document.body.removeChild(n),r}catch(a){return console.error("Fallback copy failed:",a),!1}},tt=c(52677),ye=c.n(tt),Ge=function(e,n){try{var r=document.createElement("a");r.href=e,r.download=n,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(a){}},at=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):m.isValidElement(e)?i(e.props.children):""},Ke=function(e){return at(e)},Be=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||ye()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var r=n.checkText,a=r===void 0?!0:r,s=n.checkFiles,o=s===void 0?!0:s,l=n.checkMCPTools,u=l===void 0?!0:l,d=n.checkStreaming,h=d===void 0?!0:d,C=n.minTextLength,v=C===void 0?1:C,M=function(){if(!a)return!1;try{var w=e.content;return w&&typeof w=="string"&&w.trim().length>=v}catch(A){return console.warn("Error checking text content:",A),!1}},_=function(){if(!o)return!1;try{var w=e.fileList||e.file_list;return w&&Array.isArray(w)&&w.length>0}catch(A){return console.warn("Error checking file content:",A),!1}},j=function(){if(!u)return!1;try{var w;if((w=e.parsedContent)!==null&&w!==void 0&&w.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var A=e.contentBlocks.some(function(P){return P&&P.type==="mcp"&&P.toolId});if(A)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(P){return console.warn("Error checking MCP content:",P),!1}},p=function(){if(!h)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(w){return w&&w.type==="text"&&w.content&&w.content.trim().length>=v}):!1}catch(w){return console.warn("Error checking streaming content:",w),!1}};return M()||_()||j()||p()}catch(I){return console.error("hasMessageContent unexpected error:",I),!0}},We=function(e){try{var n=(e==null?void 0:e.content)||"",r=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],a=(e==null?void 0:e.parsedContent)||{},s=(e==null?void 0:e.contentBlocks)||[],o=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(r)&&r.length>0,hasParsedMCP:!!a.hasMCPTools,hasContentBlocksMCP:s.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(o)&&o.length>0,hasStreamingText:s.some(function(l){var u;return(l==null?void 0:l.type)==="text"&&(l==null||(u=l.content)===null||u===void 0?void 0:u.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(r)?r.length:0,mcpToolCount:Array.isArray(o)?o.length:0,blockCount:Array.isArray(s)?s.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},ot=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var r=e[0];return r.is_agent===1&&r.content!=""?r:null}catch(a){return console.error("checkLastAgentMessage error:",a),null}},ut=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var r;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(r=n.toolData)!==null&&r!==void 0&&r.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},ct=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},Ze=function(e,n){try{var r=b()(b()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),a=e.contentBlocks;if(!a&&e.parsedContent?a=ut(e.parsedContent):!a&&e.content&&(a=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&a){var s=ct(a);r.activeMCPTools=s}return r.contentBlocks=a||[],r}catch(o){return console.error("prepareHistoryMessageForCurrent error:",o),e}},nt=c(76637),dt=function(e){var n=e.code,r=e.index,a=(0,m.useState)(""),s=F()(a,2),o=s[0],l=s[1],u=(0,m.useState)(!0),d=F()(u,2),h=d[0],C=d[1],v=(0,m.useState)(null),M=F()(v,2),_=M[0],j=M[1],p=(0,m.useState)(!1),I=F()(p,2),w=I[0],A=I[1],P=(0,m.useState)(""),V=F()(P,2),ve=V[0],q=V[1],se=(0,m.useMemo)(function(){var $=n.split("").reduce(function(Z,Q){return Z=(Z<<5)-Z+Q.charCodeAt(0),Z&Z},0);return"mermaid-chart-".concat(r,"-").concat(Math.abs($))},[n,r]),ce=(0,m.useMemo)(function(){return{startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:"Arial, sans-serif",fontSize:14}},[]),L=(0,m.useCallback)(he()(ee()().mark(function $(){var Z,Q;return ee()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,C(!0),j(null),nt.Z.initialize(ce),D.next=6,nt.Z.render(se,n);case 6:Z=D.sent,Q=Z.svg,l(Q),D.next=15;break;case 11:D.prev=11,D.t0=D.catch(0),console.error("Mermaid rendering error:",D.t0),j(D.t0.message||"Unknown error occurred");case 15:return D.prev=15,C(!1),D.finish(15);case 18:case"end":return D.stop()}},$,null,[[0,11,15,18]])})),[n,se,ce]);(0,m.useEffect)(function(){L()},[L]),(0,m.useEffect)(function(){if(!o){q("");return}var $="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o));q($)},[o]);var ae=(0,m.useMemo)(function(){return h?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading chart..."})}):_?(0,t.jsxs)("div",{className:"p-4 text-red-500 bg-red-50 border border-red-200 rounded",children:[(0,t.jsx)("p",{className:"font-medium",children:"\u56FE\u8868\u6E32\u67D3\u5931\u8D25"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:_})]}):o?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px]",dangerouslySetInnerHTML:{__html:o}}),(0,t.jsx)(fe.ZP,{type:"button","aria-label":"Open preview",title:"Open preview",tabIndex:0,onClick:function(){return A(!0)},onKeyDown:function(Z){(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),A(!0))},className:"absolute top-2 right-2 z-10 rounded-md bg-white/90 hover:bg-white text-gray-700 shadow px-2 py-1 text-xs border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Preview"}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(Me.Z,{style:{display:"none"},src:"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o)),width:"100%",className:"w-full",preview:{visible:w,mask:!1,scaleStep:.25,imageRender:function(Z){return(0,t.jsx)("div",{className:"bg-white w-full h-full flex justify-center items-center",children:Z})},onVisibleChange:function(Z){return A(Z)}}})})]}):null},[h,_,o,w]);return(0,t.jsx)("div",{className:"my-4 p-4 bg-white border border-gray-200 rounded-lg",children:ae})},mt=function(e,n){return e.code===n.code&&e.index===n.index},xt=m.memo(dt,mt),te=["node","className","children"],Ve=["node"],Ut=["node","children"],Dt=["node","children"],kt=["node","children"],Zt=["node","children"],Bt=["node","children"],Wt=["node","children"],Ht=function(e){var n=e.code,r=e.index,a=e.isCurrentMessage;if(!a)return(0,t.jsx)(xt,{code:n,index:r});var s=(0,m.useState)(!1),o=F()(s,2),l=o[0],u=o[1];return(0,m.useEffect)(function(){u(!1);var d=setTimeout(function(){return u(!0)},1e3);return function(){return clearTimeout(d)}},[n]),l?(0,t.jsx)(xt,{code:n,index:r}):(0,t.jsx)("div",{className:"my-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading Mermaid chart..."})})})},zt=function(e,n){return e.code===n.code&&e.index===n.index},Gt=(0,m.memo)(Ht,zt),ft=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=function(o,l){try{var u=document.createElement("a");u.href=o,u.download=l,u.target="_blank",document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(d){}};return{code:function(o){var l=o.node,u=o.className,d=o.children,h=Pe()(o,te),C=/language-(\w+)/.exec(u||"");if(C!=null&&C.length){if(C[1]==="mermaid"){var v=Ke(d);return(0,t.jsx)(Gt,{code:v,index:e,isCurrentMessage:r})}var M=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:C[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var _=he()(ee()().mark(function j(p){var I,w;return ee()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,I=p.currentTarget,P.next=4,ze(Ke(d));case 4:w=P.sent,w&&I?(I.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){I&&(I.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):I&&(I.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){I&&(I.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),P.next=11;break;case 8:P.prev=8,P.t0=P.catch(0),console.error("Failed to copy text: ",P.t0);case 11:case"end":return P.stop()}},j,null,[[0,8]])}));return function(j){return _.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(M).concat(e),className:"p-4",children:d})})]})}else return(0,t.jsx)("code",b()(b()({},h),{},{children:d}))},img:function(o){var l=o.node,u=Pe()(o,Ve);return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(Me.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(fe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ge.Z,{}),onClick:function(h){h.stopPropagation(),a(u.src||"",u.alt||"image.png")}})})]},u.src)},table:function(o){var l=o.node,u=o.children,d=Pe()(o,Ut);return(0,t.jsx)("div",{className:"overflow-x-auto my-4 border border-gray-300 rounded-lg",children:(0,t.jsx)("table",b()(b()({className:"min-w-full"},d),{},{children:u}))})},thead:function(o){var l=o.node,u=o.children,d=Pe()(o,Dt);return(0,t.jsx)("thead",b()(b()({className:"bg-gray-50"},d),{},{children:u}))},tbody:function(o){var l=o.node,u=o.children,d=Pe()(o,kt);return(0,t.jsx)("tbody",b()(b()({className:"bg-white"},d),{},{children:u}))},tr:function(o){var l=o.node,u=o.children,d=Pe()(o,Zt);return(0,t.jsx)("tr",b()(b()({className:"border-b border-gray-200 hover:bg-gray-50"},d),{},{children:u}))},th:function(o){var l=o.node,u=o.children,d=Pe()(o,Bt);return(0,t.jsx)("th",b()(b()({className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},d),{},{children:u}))},td:function(o){var l=o.node,u=o.children,d=Pe()(o,Wt);return(0,t.jsx)("td",b()(b()({className:"px-4 py-3 text-sm text-gray-900 border-r border-gray-200 last:border-r-0"},d),{},{children:u}))}}},Kt=c(61227),It=c.n(Kt),Vt=c(29608),$t=c(97175),Jt=c(4161),Yt=c(49354),Qt=c(45699),Xt=c(8751),qt=c(79090),wt=c(66212),en=c(16596),tn=c(11475),nn=c(2830),rn=c(87547),Nt=c(71471),Pt=c(47221),yt=c(66309),an=c(4393),on=c(40056),U=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i.WAITING_FILE_UPLOAD="waiting_file_upload",i}({}),Tt=function(e,n){if(e){if(e.status==="waiting_confirm")return U.WAITING_CONFIRMATION;if(n===null)return U.RUNNING}if(n!==null){if(typeof n=="string")try{var r=JSON.parse(n);if(r.status==="failed")return U.FAILED}catch(a){}else if(ye()(n)==="object"&&n.status==="failed")return U.FAILED;return U.COMPLETED}return U.PENDING},At=(0,m.createContext)(void 0),sn=function(e){var n=e.children,r=e.agentChatRoomId,a=e.agentList,s=(0,m.useRef)(null),o=(0,m.useRef)(null),l=(0,m.useState)(!1),u=F()(l,2),d=u[0],h=u[1],C=(0,m.useState)([]),v=F()(C,2),M=v[0],_=v[1],j=(0,E.useParams)(),p=j.id,I=(0,E.useLocation)(),w=new URLSearchParams(I.search),A=w.get("id"),P=r||p||A,V={scrollDomRef:s,upButtonDom:o,isStop:d,setIsStop:h,instruction:M,setInstruction:_,id:P,agentList:a};return(0,t.jsx)(At.Provider,{value:V,children:n})},$e=function(){var e=(0,m.useContext)(At);if(e===void 0)throw new Error("useChatRoomContext must be used within a ChatRoomProvider");return e},ln=function(e){var n,r=e.fileConfig,a=e.value,s=e.onChange,o=(0,rt.ZP)({maxSizeMB:r.maxSize||10,acceptedFileTypes:((n=r.accepted_types)===null||n===void 0?void 0:n.join(","))||void 0,multiple:!1}),l=o.uploadedFiles,u=o.handleUpload,d=o.removeFile,h=o.clearFiles,C=o.isUploading,v=(0,E.useIntl)();return(0,m.useEffect)(function(){if(l.length>0){var M=l[l.length-1],_={file_name:M.name,file_path:M.path_show,size:0,type:"",id:M.file_id,status:"done"};s(_)}else s(null)},[l]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[r.name,r.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),r.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:r.description}),r.accepted_types&&r.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",r.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:l.length===0?(0,t.jsx)(fe.ZP,{type:"dashed",onClick:u,loading:C,disabled:C,className:"w-48",children:C?v.formatMessage({id:"app.chatroom.mcptool.uploading"}):v.formatMessage({id:"app.chatroom.mcptool.uploadFile"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:l[l.length-1].name}),(0,t.jsx)(fe.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return d(l[l.length-1].uid)},disabled:C,children:v.formatMessage({id:"app.chatroom.mcptool.remove"})})]})})]})},un=ln,cn=function(e){var n=e.toolData,r=e.onFileUploadComplete,a=e.onFileUploadError,s=n.files_to_upload||[],o=(0,m.useState)({}),l=F()(o,2),u=l[0],d=l[1],h=(0,E.useIntl)(),C=s.every(function(j){return j.required===!1||u[j.variable_name]&&u[j.variable_name].status==="done"}),v=function(p,I){d(function(w){var A=b()({},w);return I?A[p]=I:delete A[p],A})},M=function(){return s.map(function(p){var I=u[p.variable_name];return b()(b()({},p),I)})},_=function(){if(!C){Ie.ZP.warning(h.formatMessage({id:"app.chatroom.mcptool.pleaseUploadAllRequiredFiles"}));return}var p=M();r(p)};return(0,m.useEffect)(function(){},[C,u,r]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-blue-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:h.formatMessage({id:"app.chatroom.mcptool.requiredFiles"})})}),s.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:h.formatMessage({id:"app.chatroom.mcptool.noFilesRequired"})}),s.map(function(j){return(0,t.jsx)(un,{fileConfig:j,value:u[j.variable_name],onChange:function(I){return v(j.variable_name,I)}},j.variable_name)}),(0,t.jsx)(fe.ZP,{type:"primary",className:"mt-2 w-full",disabled:!C,onClick:_,children:h.formatMessage({id:"app.chatroom.mcptool.completeUpload"})})]})},dn=cn,Se=Nt.Z.Text,ir=Nt.Z.Paragraph,Ct=Pt.Z.Panel,mn=function(e){var n=e.toLowerCase().split(".").pop(),r="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)($t.Z,{className:"text-green-600 ".concat(r)});case"doc":case"docx":return(0,t.jsx)(Jt.Z,{className:"text-blue-600 ".concat(r)});case"pdf":return(0,t.jsx)(Yt.Z,{className:"text-red-600 ".concat(r)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(Qt.Z,{className:"text-purple-600 ".concat(r)});default:return(0,t.jsx)(Ue.Z,{className:"text-gray-600 ".concat(r)})}},Et=function(e){var n=e.fileList,r=e.intl,a=function(o,l){try{var u=document.createElement("a");u.href=o,u.download=l,u.target="_blank",document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(d){console.error("Download file failed",d)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(s,o){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[s.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Se,{strong:!0,className:"text-xs text-gray-700",children:[s.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:mn(s.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:s.file_name})})]}),(0,t.jsx)(fe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ge.Z,{}),onClick:function(){return a(s.file_path,s.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:r.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},o)})})},fn=function(e){var n=e.status;switch(n){case U.COMPLETED:return(0,t.jsx)(Xt.Z,{className:"text-green-500"});case U.RUNNING:return(0,t.jsx)(qt.Z,{className:"text-blue-500"});case U.WAITING_CONFIRMATION:return(0,t.jsx)(wt.Z,{className:"text-orange-500"});case U.WAITING_FILE_UPLOAD:return(0,t.jsx)(en.Z,{className:"text-purple-500"});case U.FAILED:return(0,t.jsx)(tn.Z,{className:"text-red-500"});default:return(0,t.jsx)(wt.Z,{className:"text-gray-500"})}},vn=function(e){var n=e.status,r=e.intl,a=function(l){switch(l){case U.COMPLETED:return{color:"success",text:r.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case U.RUNNING:return{color:"processing",text:r.formatMessage({id:"app.chatroom.mcptool.status.running"})};case U.WAITING_CONFIRMATION:return{color:"warning",text:r.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case U.WAITING_FILE_UPLOAD:return{color:"purple",text:r.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case U.FAILED:return{color:"error",text:r.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:r.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},s=a(n);return(0,t.jsx)(yt.Z,{color:s.color,children:s.text})},vt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(r){return e}try{return JSON.stringify(e,null,2)}catch(r){return String(e)}},pn=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},hn=function(e){if(!e||ye()(e)!=="object")return{specialFields:{},regularFields:e};var n={},r={};return Object.keys(e).forEach(function(a){a==="input_variables"?n[a]=e[a]:r[a]=e[a]}),{specialFields:n,regularFields:r}},gn=function(e){var n=e.inputVariables,r=e.intl;return!n||ye()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Se,{strong:!0,className:"text-blue-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(a){var s=F()(a,2),o=s[0],l=s[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(Se,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[o,":"]}),(0,t.jsx)(Se,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},o)})})]})},xn=function(e){var n=e.args,r=e.intl;try{var a=hn(n),s=a.specialFields,o=a.regularFields,l=s.input_variables&&Object.keys(s.input_variables).length>0,u=o&&Object.keys(o).length>0;return!l&&!u?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:r.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(gn,{inputVariables:s.input_variables,intl:r}),u&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Se,{strong:!0,className:"text-gray-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:vt(o)})})]})]})}catch(d){return console.warn("Failed to parse parameters for enhanced display:",d),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:vt(n)})})}},yn=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(r){return[]}return n&&ye()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(r){return console.warn("Failed to extract file list from result data:",r),[]}},Cn=function(e){var n=e.resultData,r=e.intl,a=e.status,s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(d){s=n}var o=s&&ye()(s)==="object"&&s.status==="success"&&s.outputs&&ye()(s.outputs)==="object";if(o){var l=s.outputs,u=Object.keys(l).length>0;return u?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Se,{strong:!0,className:"text-green-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(d){var h=F()(d,2),C=h[0],v=h[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Se,{strong:!0,className:"text-xs text-gray-700",children:[C,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof v=="string"?(0,t.jsx)(Xe.U,{rehypePlugins:[qe.Z],components:ft(0,r),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:v}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:vt(v)})})]},C)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:r.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(a===U.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:vt(n)})})},_t=function(e){var n=e.toolData,r=e.intl,a=e.runtimeData,s=e.updateMCPTool,o=$e(),l=o.setInstruction,u=(a==null?void 0:a.status)||Tt(n.workflow_confirmation_status,n.result),d=pn(n.name,r),h=(a==null?void 0:a.workflow_confirmation)||n.workflow_confirmation_status,C=(0,Vt.Z)(function(L){return L.setDealtWithData}),v=(a==null?void 0:a.result)||n.result,M=null;if(typeof v=="string")try{var _=JSON.parse(v);_.status==="failed"&&(M=_.message)}catch(L){}else ye()(v)==="object"&&(v==null?void 0:v.status)==="failed"&&(M=v.message);var j=function(){C(b()(b()({},h),{},{exec_id:h.node_exec_id}))},p=function L(ae,$){if(l){if(ae.length===0){$&&$();return}var Z=It()(ae),Q=Z[0],ne=Z.slice(1);l(Q),setTimeout(function(){L(ne,$)},100)}},I=function(ae){if(!s){console.warn("updateMCPTool function not available");return}try{if(s(n.id,{uploaded_files:ae,status:U.RUNNING}),l){var $=[["MCPTOOLFILES",{id:n.id,files_to_upload:ae}]];p($)}}catch(Z){console.error("Error handling file upload completion:",Z),Ie.ZP.error("Failed to process file upload completion")}},w=function(ae){console.error("File upload error:",ae),Ie.ZP.error(ae),s&&s(n.id,{status:U.FAILED,error:ae})},A=yn(v),P=A&&Array.isArray(A)&&A.length>0,V=((a==null?void 0:a.uploaded_files)||[]).map(function(L){return{file_name:L.file_name||L.name,file_path:L.file_path||"",variable_name:L.variable_name}}),ve=V&&Array.isArray(V)&&V.length>0,q=(a==null?void 0:a.messages)||[],se=(!q||q.length===0)&&n.msg?[{key:"fallback-".concat(n.id),type:"warning",text:n.msg,createdAt:0,transient:!1,source:"history"}]:[],ce=q.length?q:se;return(0,t.jsxs)(an.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(nn.Z,{className:"text-blue-500"}),(0,t.jsx)(Se,{strong:!0,className:"text-sm",children:(a==null?void 0:a.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(yt.Z,{color:"blue",children:d}),(0,t.jsx)(fn,{status:u}),(0,t.jsx)(vn,{status:u,intl:r})]}),h&&u!==U.COMPLETED&&u!==U.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(rn.Z,{className:"text-orange-500"}),(0,t.jsxs)(Se,{className:"text-sm font-medium",children:[r.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(a==null?void 0:a.skill_or_workflow_name)||n.skill_or_workflow_name]}),h.confirmer_name&&(0,t.jsxs)(Se,{className:"text-xs text-gray-600",children:[r.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",h.confirmer_name]})]}),h.show_todo_button&&(0,t.jsx)(fe.ZP,{size:"small",type:"primary",onClick:j,children:r.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),M&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(Se,{type:"danger",className:"text-xs",children:[r.formatMessage({id:"app.chatroom.mcptool.error"}),": ",M]})}),ce&&ce.length>0&&(0,t.jsx)("div",{className:"mb-2 space-y-2",children:ce.map(function(L){return(0,t.jsx)(on.Z,{type:L.type,message:(0,t.jsx)("span",{className:"text-xs font-medium text-gray-800",children:L.text}),showIcon:!0,className:"mcp-tool-message ".concat(L.type==="info"?"mcp-tool-message-info":"mcp-tool-message-warning"),banner:L.type==="warning"},L.key)})}),(a==null?void 0:a.status)===U.WAITING_FILE_UPLOAD&&(0,t.jsx)(dn,{toolData:a,onFileUploadComplete:I,onFileUploadError:w}),(0,t.jsxs)(Pt.Z,{size:"small",ghost:!0,children:[((a==null?void 0:a.args)||n.args)&&Object.keys((a==null?void 0:a.args)||n.args).length>0&&(0,t.jsxs)(Ct,{header:r.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(xn,{args:(a==null?void 0:a.args)||n.args,intl:r}),ve&&(0,t.jsx)(Et,{fileList:V,intl:r})]},"params"),v&&(0,t.jsx)(Ct,{header:r.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(Cn,{resultData:v,intl:r,status:u})},"result"),P&&(0,t.jsx)(Ct,{header:r.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Et,{fileList:A,intl:r})},"files")]})]})},bt="<<<mcp-tool-start>>>",pt="<<<mcp-tool-end>>>",lr=function(e){var n,r=e.files_to_upload&&Array.isArray(e.files_to_upload)&&e.files_to_upload.length>0,a=((n=e.args)===null||n===void 0?void 0:n.input_variables)&&Object.values(e.args.input_variables).some(function(s){return s==="need_upload"});return(r||a)&&!e.result?MCPToolStatus.WAITING_FILE_UPLOAD:getMCPToolStatus(e.workflow_confirmation_status,e.result)},_n=function(e){return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.map(function(n){return{name:n.name||"",variable_name:n.variable_name||"",id:n.id||0,file_name:n.file_name||null,file_path:n.file_path||null,required:!0,accept:void 0,maxSize:void 0,description:void 0,accepted_types:void 0}})},bn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],r=0;;){var a=e.indexOf(bt,r);if(a===-1)break;var s=e.indexOf(pt,a);if(s===-1)break;var o=a+bt.length,l=e.substring(o,s).trim();try{var u=JSON.parse(l),d=_n(u),h={id:u.id,name:u.name||"",skill_or_workflow_name:u.skill_or_workflow_name||"",workflow_run_id:u.workflow_run_id||0,workflow_confirmation_status:u.workflow_confirmation_status||null,args:u.args||{},result:u.result||null,files_to_upload:d,msg:u.msg||void 0};d.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(h.id,":"),d),n.push({toolData:h,startIndex:a,endIndex:s+pt.length})}catch(C){console.error("Failed to parse MCP tool JSON:",C)}r=s+pt.length}return n},Mn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=bn(e);if(n.length===0)return[{type:"text",content:e}];var r=[],a=0;if(n.forEach(function(o){if(o.startIndex>a){var l=e.substring(a,o.startIndex).trim();l&&r.push({type:"text",content:l})}r.push({type:"mcp-tool",content:e.substring(o.startIndex,o.endIndex),toolData:o.toolData}),a=o.endIndex}),a<e.length){var s=e.substring(a).trim();s&&r.push({type:"text",content:s})}return r},xe=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=Mn(e),r=n.some(function(a){return a.type==="mcp-tool"});return{blocks:n,hasMCPTools:r}},ur=function(e,n,r){var a=_objectSpread({},e);a.mcpTools||(a.mcpTools=[]);var s=a.mcpTools.findIndex(function(o){return o.id===n});return s>=0?a.mcpTools[s]=_objectSpread(_objectSpread({},a.mcpTools[s]),r):a.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},r)),a},cr=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(r){return r.id===n})||null},dr=function(e,n){var r=_objectSpread({},e);return r.mcpTools&&Array.isArray(r.mcpTools)&&(r.mcpTools=r.mcpTools.filter(function(a){return a.id!==n})),r},mr=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,r){return String(n.id).localeCompare(String(r.id))})},jn=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload,msg:e.msg},r=JSON.stringify(n,null,0);return"".concat(bt).concat(r).concat(pt)}catch(a){return console.error("Failed to serialize MCP tool:",a),""}},In=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(n){return!n||ye()(n)!=="object"?(console.warn("Invalid file object in files_to_upload:",n),!1):n.file_path&&typeof n.file_path=="string"&&n.file_path.trim()!==""&&(n.file_path.startsWith("http")||n.file_path.startsWith("/"))})}catch(n){return console.error("Error inferring uploaded files:",n),[]}},Mt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var r="";return e.forEach(function(a){if(a.type==="text")r+=a.content||"";else if(a.type==="mcp"&&a.toolId){var s=n(a.toolId);if(s){var o=jn(s);r+=o}else console.warn("MCP tool ".concat(a.toolId," not found in runtime data"))}}),r}catch(a){return console.error("Failed to reconstruct content with updated MCP tools:",a),""}},wn=c(27484),Nn=c.n(wn),St=function(e){var n,r=e.content,a=e.fileList,s=e.index,o=e.intl,l=e.isAgent,u=e.contentId,d=e.isCurrentMessage,h=e.mcpTools,C=e.updateMCPTool,v=e.getMCPTool,M=e.item,_=e.contentBlocks,j=(M==null?void 0:M.parsedContent)||xe(r);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:u,children:[a&&a.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(gt,{fileList:a,onDownload:Ge})}),_&&_.length>0?(0,t.jsx)("div",{children:_.map(function(p,I){var w,A,P,V,ve,q;return(0,t.jsx)("div",{children:p.type==="text"?p.content&&(0,t.jsx)(Xe.U,{remarkPlugins:[et.Z],rehypePlugins:[qe.Z],components:ft(s,o,d),children:p.content}):p.toolId&&v&&(0,t.jsx)(_t,{toolData:{id:p.toolId,name:((w=v(p.toolId))===null||w===void 0?void 0:w.name)||"",skill_or_workflow_name:((A=v(p.toolId))===null||A===void 0?void 0:A.skill_or_workflow_name)||"",workflow_run_id:(P=v(p.toolId))===null||P===void 0?void 0:P.workflow_run_id,workflow_confirmation_status:(V=v(p.toolId))===null||V===void 0?void 0:V.workflow_confirmation_status,args:((ve=v(p.toolId))===null||ve===void 0?void 0:ve.args)||{},result:(q=v(p.toolId))===null||q===void 0?void 0:q.result},intl:o,runtimeData:v(p.toolId),updateMCPTool:C})},"content-block-".concat(I))})}):j.hasMCPTools?(0,t.jsx)("div",{children:j.blocks.map(function(p,I){return(0,t.jsx)("div",{children:p.type==="text"?(0,t.jsx)(Xe.U,{remarkPlugins:[et.Z],rehypePlugins:[qe.Z],components:ft(s,o),children:p.content}):p.toolData&&(0,t.jsx)(_t,{toolData:p.toolData,intl:o,runtimeData:v?v(p.toolData.id):null,updateMCPTool:C})},I)})}):(0,t.jsx)(Xe.U,{remarkPlugins:[et.Z],rehypePlugins:[qe.Z],components:ft(s,o),children:r}),e.isCurrentMessage&&!_&&(M==null||(n=M.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:M.activeMCPTools.map(function(p){return v?v(p):null}).filter(Boolean).map(function(p){return(0,t.jsx)(_t,{toolData:{name:p.name,skill_or_workflow_name:p.skill_or_workflow_name,workflow_run_id:p.workflow_run_id,workflow_confirmation_status:p.workflow_confirmation_status,args:p.args,result:p.result,id:p.id},intl:o,runtimeData:p,updateMCPTool:C},"current-tool-".concat(p.id))})}),M.created_time&&M.is_agent==1&&(0,t.jsx)("div",{className:"text-xs text-gray-300  text-right -mr-2 mb-1",children:Nn()(M.created_time).format("YYYY-MM-DD HH:mm:ss")})]})},Pn=(0,m.memo)(function(i){var e=i.messageApi,n=i.index,r=i.idName,a=i.cidName,s=(0,E.useIntl)(),o=(0,m.useState)(!1),l=F()(o,2),u=l[0],d=l[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){d(!0)},onMouseLeave:function(){d(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var h=he()(ee()().mark(function C(v){var M,_,j;return ee()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return M=v.target.closest("#".concat(r).concat(n)),_=M.querySelector("#".concat(a).concat(n)),I.prev=2,I.next=5,ze(_.innerText);case 5:j=I.sent,j?e.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),I.next=13;break;case 9:I.prev=9,I.t0=I.catch(2),console.error("Failed to copy text: ",I.t0),e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return I.stop()}},C,null,[[2,9]])}));return function(C){return h.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(u?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(u?" text-[#1B64F3]":"text-[#666]"),children:s.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Tn=c(2068),An=function(e){var n=e.id,r=e.index,a=e.idName,s=e.cidName,o=(0,E.useIntl)(),l=(0,W.Z)(function(_){return _.setSummaryClick}),u=(0,m.useState)(!0),d=F()(u,2),h=d[0],C=d[1],v=(0,W.Z)(function(_){return _.summaryClick});(0,m.useEffect)(function(){C(v)},[v]);var M=(0,W.Z)(function(_){return _.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(h?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(j){if(h){var p=j.target.closest("#".concat(a).concat(r)),I=p.querySelector("#".concat(s).concat(r));M({id:n,message:I.innerText}),l(!1)}},children:[(0,t.jsx)(Tn.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:o.formatMessage({id:"app.chatroom.content.summary"})})]})})},En=function(e){var n=e.messageApi,r=e.index,a=e.idName,s=e.cidName,o=e.id,l=e.agentChatRoomId,u=e.isAgent;return u?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(Pn,{messageApi:n,index:r,idName:a,cidName:s}),!l&&(0,t.jsx)(An,{id:o,index:r,idName:a,cidName:s})]}):null},jt=c(79574),Ft=function(e){var n,r=e.item,a=e.index,s=e.agentChatRoomId,o=e.abilitiesList,l=e.messageApi,u=e.id,d=e.idName,h=e.cidName,C=e.mcpTools,v=e.updateMCPTool,M=e.getMCPTool,_=(0,E.useIntl)(),j=r.is_agent===1,p=(0,He.Pc)(),I=p.userInfo;return Be(r)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(j?"":"flex-row-reverse"),children:[j?(0,t.jsx)(Ne.Z,{data:r}):(0,t.jsx)(Ne.Z,{data:{avatar:(0,jt.Ep)()?"/icons/headportrait/atyun.svg":"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(s?"":"max-w-[560px]"," text-right"),id:"".concat(d).concat(a),children:[(0,t.jsxs)("div",{className:"".concat(j?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[r.name?r.name:(I==null?void 0:I.nickname)||"",r.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(o==null||(n=o.find(function(w){return r.ability_id==w.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(j?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(St,{content:r.content,fileList:r.file_list,index:a,intl:_,isAgent:j,contentId:"".concat(h).concat(a),mcpTools:C,updateMCPTool:v,getMCPTool:M,item:r})}),(0,t.jsx)(En,{messageApi:l,index:a,idName:d,cidName:h,id:u,agentChatRoomId:s,isAgent:j})]})]}):null},Sn=c(47635),Fn=function(e,n,r,a,s,o,l,u,d,h,C,v,M,_,j,p,I){var w=(0,E.useIntl)(),A=(0,W.Z)(function(O){return O.setTruncatable}),P=(0,m.useRef)({}),V=(0,m.useRef)(p),ve=function(f){try{var g=JSON.parse(f.slice(22,-2));return Array.isArray(g)&&g.length>=2?[g[0],g[1]]:null}catch(x){return console.warn("Failed to parse instruction:",x),null}},q=function(f){return f.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},se=function(f){return!f||!f.input_variables?!1:Object.values(f.input_variables).some(function(g){return g==="need_upload"})},ce=function(f){d(function(g){var x=g.contentBlocks||[],y=f(x);return b()(b()({},g),{},{contentBlocks:y})})},L=function(f){ce(function(g){var x=g[g.length-1];return x&&x.type==="text"?g.map(function(y,N){return N===g.length-1?b()(b()({},y),{},{content:(y.content||"")+f}):y}):[].concat(B()(g),[{type:"text",content:f,timestamp:Date.now()}])})},ae=function(f){ce(function(g){return[].concat(B()(g),[{type:"mcp",toolId:f,timestamp:Date.now()}])})},$=function(f){return!(f!=null&&f.blocks)||!Array.isArray(f.blocks)?[]:f.blocks.map(function(g){var x;return g.type==="text"?{type:"text",content:g.content||"",timestamp:Date.now()}:g.type==="mcp-tool"&&(x=g.toolData)!==null&&x!==void 0&&x.id?{type:"mcp",toolId:g.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},Z=function(f){return f.filter(function(g){return g.type==="mcp"&&g.toolId}).map(function(g){return g.toolId})},Q=function(f,g){M&&M(f,g),v.current&&Object.keys(h).length>0&&d(function(x){var y=x.activeMCPTools||[],N=y.includes(f)?y:[].concat(B()(y),[f]);return b()(b()({},x),{},{activeMCPTools:N})})},ne=function(f,g,x){try{if(!f||!Array.isArray(f))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!x)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),f;var y=f.filter(function(J){return J.type==="mcp"&&J.toolId}).map(function(J){return J.toolId}),N=g.filter(function(J){return!y.includes(J)}),K=N.map(function(J){return{type:"mcp",toolId:J,timestamp:Date.now()}});return[].concat(B()(f),B()(K))}catch(J){return console.error("Failed to sync MCP tool states to contentBlocks:",J),f}};(0,m.useEffect)(function(){return function(){Object.values(P.current).forEach(function(O){return clearTimeout(O)}),P.current={}}},[]),(0,m.useEffect)(function(){V.current=p},[p]);var D={ERROR:function(f){e(!1),n(!1),r(""),a.open({type:"error",content:"webSocket-".concat(f),duration:10})},CHAT:function(f){if(Object.keys(h).length&&Be(h,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var g,x,y=b()({},h);if(((g=y.activeMCPTools)===null||g===void 0?void 0:g.length)>0||((x=y.contentBlocks)===null||x===void 0?void 0:x.length)>0){var N=ne(y.contentBlocks||[],y.activeMCPTools||[],p);if(p&&N.length>0){var K=Mt(N,p);K?(y.content=K,y.parsedContent=xe(K)):y.content&&(y.parsedContent=xe(y.content))}else y.content&&(y.parsedContent=xe(y.content));y.contentBlocks=N}else y.content&&(y.parsedContent=xe(y.content));s(function(Y){return Y.concat(y)}),d({})}var J={content:"".concat(f),is_agent:0};s(function(Y){return Y.concat(J)}),j&&j(!0),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(f){s(function(g){if(g.length===0)return g;var x=g.length-1;return g.map(function(y,N){return N===x?b()(b()({},y),{},{file_list:f}):y})}),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(f){n(f)},TRUNCATABLE:function(f){A(f),f||a.open({type:"success",content:"".concat(w.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(f){a.open({type:"success",content:"".concat(w.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(f){var g=f.id,x=f.name,y=f.skill_or_workflow_name,N=f.args,K=f.files_to_upload,J=y&&y.toLowerCase().includes("workflow"),Y=K&&Array.isArray(K)&&K.length>0,z=Y||se(N),R=z?U.WAITING_FILE_UPLOAD:U.RUNNING;Q(g,{name:x,skill_or_workflow_name:y||x,args:N,status:R,isWorkflow:J,files_to_upload:K||[],uploaded_files:[]}),j&&j(!1),ae(g)},SHOWTOOLMSG:function(f){if(f){var g=f.id,x=f.type,y=f.msg;if(!(g===void 0||!x||!y)){var N=x||"info",K="runtime-".concat(g,"-").concat(Date.now(),"-").concat(Math.random()),J={key:K,type:N,text:y,createdAt:Date.now(),transient:N==="info",source:"runtime"},Y=p?p(g):null,z=(Y==null?void 0:Y.messages)||[],R=[].concat(B()(z),[J]);if(Q(g,b()({messages:R},N==="warning"?{msg:y}:{})),N==="info"){var X=setTimeout(function(){var oe=V.current,le=oe?oe(g):null;if(le!=null&&le.messages){var G=le.messages.filter(function(S){return S.key!==K||S.type!=="info"});G.length!==le.messages.length&&(Q(g,{messages:G}),delete P.current[K])}},3e3);P.current[K]=X}}}},WITHMCPTOOLRESULT:function(f){var g=f.id,x=f.result,y=U.COMPLETED;if(typeof x=="string")try{var N=JSON.parse(x);N.status==="failed"&&(y=U.FAILED)}catch(K){}else ye()(x)==="object"&&(x==null?void 0:x.status)==="failed"&&(y=U.FAILED);Q(g,{result:x,status:y})},WITHWFSTATUS:function(f){var g=f.id,x=f.status,y={id:x.id,status:x.status,app_run_id:x.app_run_id,node_exec_id:x.node_exec_id,workflow_name:x.workflow_name,need_user_confirm:x.need_user_confirm,show_todo_button:x.show_todo_button,confirmer_name:x.confirmer_name},N;switch(x.status){case"running":N=U.RUNNING;break;case"waiting_confirm":N=U.WAITING_CONFIRMATION;break;case"completed":N=U.COMPLETED;break;case"failed":N=U.FAILED;break;default:N=U.RUNNING;break}j&&j(!1),Q(g,{workflow_confirmation:y,status:N,isWorkflow:!0})},WITHMCPTOOLFILES:function(f){var g=f.id,x=f.files_to_upload,y=f.args;Q(g,b()({uploaded_files:x||[],status:U.COMPLETED},y?{args:y}:{}))}},De=function(f,g){D[f]=g},Fe=function(f){var g=f.data,x=ve(g),y=q(g),N=g.indexOf("REPLY")!==-1&&g.indexOf("ENDREPLY")===-1,K=g.indexOf("ABILITY")!==-1,J=g.indexOf("ENDCHAT")!==-1;if(y){if(!x)return;var Y=x[0],z=x[1],R=D[Y];R?R(z):console.warn("Unknown message type: ".concat(Y))}if(y||console.log(v.current,f),!y&&v.current&&(C.current+=g,j&&j(!1),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")}),d(function(ie){var Le=C.current,k=b()(b()({},ie),{},{content:Le});return Le&&(k.parsedContent=xe(Le)),k}),L(g)),N&&y){var X=x[1],oe=u.current.filter(function(ie){return ie.agent_id==X})[0];s(function(ie){var Le=ie;if(Object.keys(h).length&&Be(h,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var k,Je,re=b()({},h);if(((k=re.activeMCPTools)===null||k===void 0?void 0:k.length)>0||((Je=re.contentBlocks)===null||Je===void 0?void 0:Je.length)>0){var je=ne(re.contentBlocks||[],re.activeMCPTools||[],p);if(p&&je.length>0){var Ye=Mt(je,p);Ye?(re.content=Ye,re.parsedContent=xe(Ye)):re.content&&(re.parsedContent=xe(re.content))}else re.content&&(re.parsedContent=xe(re.content));re.contentBlocks=je}else re.content&&(re.parsedContent=xe(re.content));Le=ie.concat(re)}return C.current="",d({is_agent:1,icon:oe==null?void 0:oe.icon,name:oe==null?void 0:oe.name,avatar:oe==null?void 0:oe.avatar,content:"",activeMCPTools:[],agent_id:X,parsedContent:null,contentBlocks:[]}),v.current=!0,n(!0),A(!1),Le})}if(K&&y){var le=x[1];d(function(ie){return b()(b()({},ie),{},{is_agent:1,ability_id:le})})}if(J){if(v.current=!1,C.current="",e(!1),n(!1),A(!0),Object.keys(h).length){var G,S,T=b()({},h);if(((G=T.activeMCPTools)===null||G===void 0?void 0:G.length)>0||((S=T.contentBlocks)===null||S===void 0?void 0:S.length)>0){var de=ne(T.contentBlocks||[],T.activeMCPTools||[],p);if(p&&de.length>0){var pe=Mt(de,p);pe?(T.content=pe,T.parsedContent=xe(pe)):T.content&&(T.parsedContent=xe(T.content))}else T.content&&(T.parsedContent=xe(T.content));T.contentBlocks=de}else T.content&&(T.parsedContent=xe(T.content));console.log(T),s(function(ie){return ie.concat(T)})}d({}),r("")}};return{getSocketMessage:Fe,addMessageHandler:De}},Ln=function(e){var n=e.currentMessage,r=e.agentChatRoomId,a=e.intl,s=e.mcpTools,o=s===void 0?{}:s,l=e.updateMCPTool,u=l===void 0?function(){}:l,d=e.getMCPTool,h=d===void 0?function(){return null}:d,C=$e(),v=C.setInstruction,M=(0,He.Pc)(),_=M.userInfo;return!n.name||!Be(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(Ne.Z,{data:n}):(0,t.jsx)(Ne.Z,{data:{avatar:(0,jt.Ep)()?"/icons/headportrait/atyun.svg":"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(r?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(_==null?void 0:_.nickname)||""}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(St,{content:n.content||"",fileList:n.file_list,index:-1,intl:a,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:o,updateMCPTool:u,getMCPTool:h,item:b()(b()({},n),{},{parsedContent:xe(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},On=(0,m.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,r=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,l=i.setIsStop,u=i.setisEnd,d=i.setSendValue,h=i.agentChatRoomId,C=i.updateMCPTool,v=i.getCurrentMessageList,M=i.mcpTools,_=M===void 0?{}:M,j=i.getMCPTool,p=j===void 0?function(){return null}:j,I=i.setIsWaitingReply,w=i.removeHistoryMessage,A=i.setCurrentMessageFromHistory,P=$e(),V=P.setInstruction,ve=(0,E.useIntl)(),q=(0,E.useParams)(),se=q.id,ce=(0,E.useLocation)(),L=new URLSearchParams(ce.search),ae=L.get("id"),$=h||se||ae,Z=(0,W.Z)(function(Y){return Y.setDisableInput}),Q=(0,m.useState)({}),ne=F()(Q,2),D=ne[0],De=ne[1],Fe=(0,m.useRef)(!1),O=(0,m.useRef)(""),f=(0,m.useCallback)(function(Y){try{if(!Y||ye()(Y)!=="object"){console.warn("Invalid history message provided:",Y);return}if(Y.is_agent!==1){console.warn("Attempted to set non-agent message as current:",Y);return}var z=Ze(Y,p);if(!z){console.warn("Failed to prepare history message:",Y);return}De(z),Fe.current=!0,O.current=z.content||""}catch(R){console.error("Failed to set current message from history:",R)}},[p]);(0,m.useEffect)(function(){A&&A(f)},[A,f]);var g=Fn(Z,l,d,e,n,s,o,a,De,D,O,Fe,C,v,I,p,w),x=g.getSocketMessage,y=(0,Sn.Z)("chat",x),N=y.runSocket,K=y.sendMessage,J=y.readyState;return(0,m.useEffect)(function(){J==1&&$&&K(JSON.stringify(["ENTER",parseInt($)]))},[J]),(0,m.useEffect)(function(){r&&J==1&&K(r)},[r]),(0,m.useEffect)(function(){N()},[]),(0,t.jsx)(Ln,{currentMessage:D,agentChatRoomId:h,intl:ve,mcpTools:_,updateMCPTool:C,getMCPTool:p})}),Rn=function(e){var n=e.type,r=n===void 0?"typing":n,a=e.size,s=a===void 0?"medium":a;if(r==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(r==="wave"){var o={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,u){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:b()(b()({},o),{},{animationDelay:"".concat(l,"s")})},u)})})]})}return r==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):r==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},Un=function(e){var n=e.autoRotate,r=n===void 0?!1:n,a=e.rotateInterval,s=a===void 0?3e3:a,o=e.initialType,l=o===void 0?"wave":o,u=e.size,d=u===void 0?"medium":u,h=(0,m.useState)(l),C=F()(h,2),v=C[0],M=C[1],_=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(Rn,{type:v,size:d})})},Dn=function(e){var n=e.isVisible,r=e.animationType,a=r===void 0?"pulse":r,s=e.enableAutoRotate,o=s===void 0?!0:s,l=(0,E.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(Un,{initialType:a,autoRotate:o,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},kn=(0,m.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,r=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,l=i.setIsStop,u=i.setSendValue,d=i.agentChatRoomId,h=i.abilitiesList,C=i.mcpTools,v=i.updateMCPTool,M=i.getMCPTool,_=i.userMessage,j=$e(),p=j.setInstruction,I=(0,m.useState)([]),w=F()(I,2),A=w[0],P=w[1],V=(0,m.useState)(!1),ve=F()(V,2),q=ve[0],se=ve[1],ce=(0,m.useState)(!1),L=F()(ce,2),ae=L[0],$=L[1],Z=(0,m.useRef)(!1),Q=(0,m.useRef)(null),ne=(0,E.useParams)(),D=ne.id,De=(0,E.useLocation)(),Fe=new URLSearchParams(De.search),O=Fe.get("id"),f=D||O;(0,m.useEffect)(function(){q&&(n(function(x){return[].concat(B()(A.reverse()),B()(x))}),P([]),setTimeout(function(){se(!1),s.current.scrollTop=0},200))},[q]),(0,m.useEffect)(function(){if(!Z.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!Q.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var x=ot(_);if(x){if(!x.id){console.warn("Found agent message without ID, skipping:",x),Z.current=!0;return}if(Q.current(x),n){var y=_.filter(function(N){return N!==x});n(y)}else console.warn("setUserMessage not available for history update");Z.current=!0}}catch(N){console.error("Failed to process history message:",N,{userMessageLength:_==null?void 0:_.length,hasCallback:!!Q.current}),Z.current=!0}}},[_,n]),(0,m.useEffect)(function(){Z.current=!1},[f]);var g=function(y){if(n&&_){var N=_.filter(function(K){return K!==y});n(N)}};return(0,t.jsxs)(t.Fragment,{children:[A.length?A.map(function(x,y){return(0,t.jsx)(Ft,{item:x,index:y,agentChatRoomId:d,abilitiesList:h,messageApi:e,id:f,idName:"currentContent",cidName:"currentChilContent",mcpTools:C,updateMCPTool:v,setInstruction:p,getMCPTool:M},y)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(Dn,{isVisible:ae}),(0,t.jsx)(On,{messageApi:e,setCurrentMessageContent:P,sendValue:r,agentList:a,scrollDomRef:s,upButtonDom:o,setIsStop:l,setisEnd:se,setSendValue:u,agentChatRoomId:d,updateMCPTool:v,getCurrentMessageList:function(){return _||[]},mcpTools:C,getMCPTool:M,setIsWaitingReply:$,removeHistoryMessage:g,setCurrentMessageFromHistory:function(y){Q.current=y},setInstruction:p})]})}),Zn=(0,m.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,r=i.instruction,a=i.setIsStop,s=i.upButtonDom,o=i.agentList,l=i.agentChatRoomId,u=i.abilitiesList,d=$e(),h=d.setInstruction,C=(0,E.useIntl)(),v=(0,m.useState)(860),M=F()(v,2),_=M[0],j=M[1],p=(0,E.useParams)(),I=p.id,w=(0,E.useLocation)(),A=new URLSearchParams(w.search),P=A.get("id"),V=l||I||P,ve=(0,m.useState)([]),q=F()(ve,2),se=q[0],ce=q[1],L=(0,m.useRef)(!1),ae=(0,m.useState)(""),$=F()(ae,2),Z=$[0],Q=$[1],ne=(0,m.useRef)(null),D=(0,m.useRef)(!0),De=(0,m.useState)({}),Fe=F()(De,2),O=Fe[0],f=Fe[1],g=(0,m.useRef)(2),x=(0,m.useRef)(1),y=(0,m.useRef)(0),N=function(S,T){f(function(de){var pe=de[S];return pe?b()(b()({},de),{},ue()({},S,b()(b()({},pe),T))):b()(b()({},de),{},ue()({},S,b()({id:S,status:U.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null,messages:[]},T)))})},K=function(S){return O[S]||null},J=function(S){var T,de=S.files_to_upload&&Array.isArray(S.files_to_upload)&&S.files_to_upload.length>0,pe=((T=S.args)===null||T===void 0?void 0:T.input_variables)&&Object.values(S.args.input_variables).some(function(ie){return ie==="need_upload"});return(de||pe)&&!S.result?U.WAITING_FILE_UPLOAD:Tt(S.workflow_confirmation_status,S.result)},Y=function(S){var T=S.map(function(de){var pe=b()({},de);if(de.is_agent===1&&de.content){var ie=xe(de.content);pe.parsedContent=ie,ie.hasMCPTools&&ie.blocks.forEach(function(Le){if(Le.type==="mcp-tool"&&Le.toolData){var k=Le.toolData,Je=J(k);f(function(re){var je=re[k.id],Ye=(je==null?void 0:je.messages)||[],Ot=Ye;if(k.msg){var or=Ye.some(function(Rt){return Rt.type==="warning"&&Rt.text===k.msg});if(!or){var sr={key:"history-".concat(k.id,"-").concat(k.msg),type:"warning",text:k.msg,createdAt:Date.now(),transient:!1,source:"history"};Ot=[].concat(B()(Ye),[sr])}}return b()(b()({},re),{},ue()({},k.id,{id:k.id,name:k.name,skill_or_workflow_name:k.skill_or_workflow_name||k.name,workflow_run_id:k.workflow_run_id||0,workflow_confirmation_status:k.workflow_confirmation_status||null,args:k.args||{},result:k.result||null,status:Je,isWorkflow:k.skill_or_workflow_name?k.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:k.files_to_upload||[],uploaded_files:In(k),messages:Ot,msg:k.msg||(je==null?void 0:je.msg)}))})}})}return pe});return T},z=function(){var G=he()(ee()().mark(function S(T){var de,pe,ie=arguments;return ee()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(de=ie.length>1&&ie[1]!==void 0?ie[1]:function(){},!V){k.next=6;break}return k.next=4,(0,me.KH)(V,{page:x.current,page_size:10});case 4:pe=k.sent,pe.code==0&&(g.current=pe.data.total_pages,T||(ne.current.style.display="none"),ce(function(Je){var re=pe.data.list.reverse(),je=Y(re);return T?B()(je):[].concat(B()(Je),B()(je))}),T?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,s.current.style.display="none"}):y.current=pe.data.list.length,D.current=!0);case 6:case"end":return k.stop()}},S)}));return function(T){return G.apply(this,arguments)}}(),R=function(S){var T=S.target.scrollHeight+(S.target.scrollTop-S.target.clientHeight);L.current!==Math.ceil(S.target.scrollTop)<-50&&(L.current=Math.ceil(S.target.scrollTop)<-50,s.current.style.display=L.current?"flex":"none"),T<10&&D.current&&(D.current=!1,x.current=x.current+1,ne.current.style.display="flex",g.current>=x.current?z(!1):ne.current.style.display="none")},X=function(S,T){T==="0"&&(T=Number(T));var de=["".concat(S),T!==""&&T!==null&&T!==void 0?T:null];Q(JSON.stringify(de))},oe=(0,W.Z)(function(G){return G.disableInput}),le=(0,W.Z)(function(G){return G.clearMemory});return(0,m.useEffect)(function(){le&&le.length&&X(le[0],le[1])},[le]),(0,m.useEffect)(function(){r&&r.length&&(X(r[0],r[1]!==void 0?r[1]:""),h([]))},[r]),(0,m.useEffect)(function(){x.current=1,z(!0)},[]),(0,m.useEffect)(function(){var G=function(){window.innerWidth<1280||j(window.innerWidth-320-(window.innerWidth-320)/2-88)};return G(),window.addEventListener("resize",G),function(){window.removeEventListener("resize",G)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth  ".concat((0,jt.Ep)()?"px-2":"chatroom"),ref:n,onScroll:R,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:l?"":"".concat(_,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:se&&se.length?se.map(function(G,S){return(0,t.jsx)(Ft,{item:b()(b()({},G),{},{id:"c".concat(G.id)}),index:S,agentChatRoomId:l,abilitiesList:u,messageApi:e,id:V,idName:"content",cidName:"chilContent",mcpTools:O,updateMCPTool:N,getMCPTool:K},S)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(kn,{messageApi:e,setUserMessage:ce,sendValue:Z,agentList:o,scrollDomRef:n,upButtonDom:s,setIsStop:a,setSendValue:Q,agentChatRoomId:l,abilitiesList:u,mcpTools:O,updateMCPTool:N,getMCPTool:K,userMessage:se})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!l&&!oe&&se.length?(0,t.jsx)(Qe,{roomid:V}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:ne,children:(0,t.jsx)(Ee.Z,{})})]})})}),Bn=c(82114),Wn=c(77171),Hn=c(85576),Lt=c(96486),zn=c(58299),Gn=c(38008),Kn=c(83062),Vn=function(e){var n=e.uploadedFiles,r=e.handleRemoveFile;return n.length?(0,t.jsx)(Me.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(a){return(0,t.jsx)(yt.Z,{closable:!0,onClose:function(){return r(a.uid)},className:"flex items-center ".concat(a.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Kn.Z,{title:a.name,children:(0,t.jsx)("div",{className:"flex items-center",children:a.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(Me.Z,{src:a.path_show||a.url,alt:a.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:a.path_show||a.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(ge.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),Ge(a.path_show||a.url,a.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Ue.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(ge.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),Ge(a.path_show||a.url,a.name)}})]})})})},a.uid)})})})}):null},$n=c(52645),Jn=c(64317),Yn=function(e){var n=e.agentChatRoomId,r=e.abilitiesList,a=e.abilityId,s=e.setAbilityId,o=e.clearContext,l=(0,E.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(r==null?void 0:r.length)>0&&(0,t.jsx)(Jn.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:r,initialValue:a,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(d){s(d)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(fe.ZP,{size:"small",color:"danger",variant:"outlined",onClick:o,icon:(0,t.jsx)($n.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},Qn=c(88484),Xn=c(30159),qn=c(26915),er=qn.Z.TextArea,tr=function(e){var n=e.userSendvalue,r=e.setUserSendvalue,a=e.disableInput,s=e.isUploading,o=e.isStop,l=e.userSendmessage,u=e.handleFileUpload,d=e.sendMessage,h=e.stopChatRoom,C=(0,E.useIntl)(),v=(0,Lt.throttle)(function(){if(a||!n)return!1;d(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(fe.ZP,{type:"text",icon:(0,t.jsx)(Qn.Z,{}),onClick:u,disabled:a||s,loading:s}),(0,t.jsx)(er,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:a,onChange:function(_){r(_.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(C.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),o?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:h,children:(0,t.jsx)(Xn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(a||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:v,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},nr=(0,m.memo)(function(i){var e,n=i.messageApi,r=i.isStop,a=i.scrollDomRef,s=i.upButtonDom,o=i.agentList,l=i.abilitiesList,u=i.agentChatRoomId,d=i.chatStatus,h=$e(),C=h.setInstruction,v=(0,E.useIntl)(),M=(0,W.Z)(function(z){return z.disableInput}),_=(0,W.Z)(function(z){return z.setDisableInput}),j=(0,W.Z)(function(z){return z.setClearMemory}),p=(0,zn.m)(),I=p.options,w=u?(0,Gn.Zc)().isImageSupportModel:function(){return!1},A=(0,m.useState)(null),P=F()(A,2),V=P[0],ve=P[1],q=(0,m.useState)(""),se=F()(q,2),ce=se[0],L=se[1],ae=(0,m.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),$=F()(ae,2),Z=$[0],Q=$[1],ne=(0,rt.ZP)({maxSizeMB:15,acceptedFileTypes:Z,multiple:!0}),D=ne.uploadedFiles,De=ne.handleUpload,Fe=ne.removeFile,O=ne.clearFiles,f=ne.isUploading;(0,m.useEffect)(function(){var z,R;if(u&&(o==null||(z=o.current)===null||z===void 0?void 0:z.length)>0&&o!==null&&o!==void 0&&(R=o.current[0])!==null&&R!==void 0&&(R=R.agent)!==null&&R!==void 0&&R.m_config_id){var X,oe=o==null||(X=o.current[0])===null||X===void 0||(X=X.agent)===null||X===void 0?void 0:X.m_config_id,le=w(oe),G=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(le?",.jpg,.png,.jpeg":"");Q(G)}},[o,I,o==null||(e=o.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,w]);var g=function(){var R=Hn.Z.confirm;R({title:v.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(Bn.Z,{}),content:v.formatMessage({id:"app.chatroom.clear.tips"}),okText:v.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:v.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){j(["TRUNCATE","0"])}})},x=function z(R,X){if(R.length===0){X&&X();return}var oe=It()(R),le=oe[0],G=oe.slice(1);C(le),setTimeout(function(){z(G,X)},100)},y=function(R){var X=[];(D==null?void 0:D.length)>0&&X.push(["FILELIST",D.map(function(le){return le.file_id})]);var oe=V||0;X.push(["SETABILITY",oe]),X.push(["INPUT",R]),x(X,function(){(D==null?void 0:D.length)>0&&O()})},N=function(R){!R.shiftKey&&R.target.value==""&&(n.open({type:"warning",content:v.formatMessage({id:"app.chatroom.content.input"}),duration:10}),L(""),R.preventDefault()),!R.shiftKey&&R.keyCode==13&&R.target.value!=""&&(_(!0),L(""),y(R.target.value),R.preventDefault())},K=(0,Lt.throttle)(function(){C(["STOP",null])},300),J=function(){M||De()},Y=function(R){if(!R){n.open({type:"warning",content:v.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}_(!0),y(R),L("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:s,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(R){a.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(Wn.Z,{className:"text-[16px]"})}),(0,t.jsx)(Vn,{uploadedFiles:D,handleRemoveFile:Fe}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(D.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(Yn,{agentChatRoomId:u,abilitiesList:l,abilityId:V,setAbilityId:ve,clearContext:g}),(0,t.jsx)(tr,{userSendvalue:ce,setUserSendvalue:L,disableInput:M,isUploading:f,isStop:r,userSendmessage:N,handleFileUpload:J,sendMessage:Y,stopChatRoom:K})]})]})}),rr=(0,m.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,r=i.abilitiesList,a=i.chatStatus,s=$e(),o=s.scrollDomRef,l=s.upButtonDom,u=s.isStop,d=s.setIsStop,h=s.instruction,C=s.setInstruction;(0,m.useEffect)(function(){a==1&&d(!0)},[a]);var v=Ie.ZP.useMessage(),M=F()(v,2),_=M[0],j=M[1];return(0,t.jsxs)(t.Fragment,{children:[j,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(Zn,{instruction:h,messageApi:_,scrollDomRef:o,setIsStop:d,upButtonDom:l,agentList:e,agentChatRoomId:n,abilitiesList:r}),(0,t.jsx)(nr,{messageApi:_,isStop:u,upButtonDom:l,scrollDomRef:o,agentList:e,agentChatRoomId:n,abilitiesList:r,chatStatus:a})]})})]})}),ar=(0,m.memo)(function(i){return(0,t.jsx)(sn,{agentChatRoomId:i.agentChatRoomId,agentList:i.agentList,children:(0,t.jsx)(rr,b()({},i))})})},38008:function(st,Oe,c){c.d(Oe,{Zc:function(){return m},aS:function(){return Ce}});var Te=c(67294),b=c(85750),Re=c(58299),F=c(85893),Ie=(0,Te.createContext)(void 0),Ce=function(we){var he=we.children,be=(0,Re.m)(),B=be.options,_e=(0,Te.useMemo)(function(){var ue=function(E){if(!E||!B)return!1;var Ee=(0,b.ti)(E,{options:B});return(Ee==null?void 0:Ee.support_image)===1},me=function(E){return ue(E)};return{isImageSupportModel:ue,getCurrentModelImageSupport:me}},[B]);return(0,F.jsx)(Ie.Provider,{value:_e,children:he})},m=function(){var we=(0,Te.useContext)(Ie);if(we===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return we},Ae=null},77295:function(st,Oe,c){c.d(Oe,{CO:function(){return B}});var Te=c(15009),b=c.n(Te),Re=c(19632),F=c.n(Re),Ie=c(99289),Ce=c.n(Ie),m=c(5574),Ae=c.n(m),ee=c(45360),we=c(76772),he=c(67294),be=c(83065),B=function(me){var W,E=me==null||(W=me.split(".").pop())===null||W===void 0?void 0:W.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(E||"")},_e=function(){var me=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=(0,we.useIntl)(),E=(0,he.useState)([]),Ee=Ae()(E,2),H=Ee[0],t=Ee[1],Qe=(0,he.useState)(!1),Ne=Ae()(Qe,2),He=Ne[0],Me=Ne[1],fe=me.maxSizeMB,ge=fe===void 0?15:fe,Ue=me.acceptedFileTypes,rt=Ue===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Ue,it=me.multiple,ht=it===void 0?!0:it,gt=function(){var ke=document.createElement("input");ke.type="file",ke.accept=rt,ke.multiple=ht,ke.onchange=function(){var Pe=Ce()(b()().mark(function ze(lt){var tt,ye,Ge,at,Ke,Be,We,ot,ut,ct,Ze,nt,dt,mt;return b()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(tt=lt.target,!(tt.files&&tt.files.length>0)){te.next=37;break}if(Me(!0),ye=Array.from(tt.files),Ge=ye.filter(function(Ve){return Ve.size/1024/1024>ge}),!(Ge.length>0)){te.next=9;break}return ee.ZP.error("".concat(Ge.map(function(Ve){return Ve.name}).join(", ")," ").concat(W.formatMessage({id:"workflow.uploadFileErrorText"}))),Me(!1),te.abrupt("return");case 9:at=[],Ke=0,Be=ye;case 11:if(!(Ke<Be.length)){te.next=35;break}return We=Be[Ke],ot=new FormData,ot.append("file",We),te.prev=15,te.next=18,(0,be.M$)();case 18:return ut=te.sent,te.next=21,fetch(ut,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:ot});case 21:return ct=te.sent,te.next=24,ct.json();case 24:Ze=te.sent,Ze.code===0?(ee.ZP.success("".concat(We.name," ").concat(W.formatMessage({id:"workflow.uploadSuccess"}))),(nt=Ze.data)!==null&&nt!==void 0&&nt.file_id&&(dt=B(We.name),mt={name:We.name,url:Ze.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:dt,file_id:Ze.data.file_id,path_show:Ze.data.file_url||Ze.data.path_show||""},at.push(mt))):ee.ZP.error("".concat(We.name," ").concat(W.formatMessage({id:"workflow.uploadFailed"}))),te.next=32;break;case 28:te.prev=28,te.t0=te.catch(15),console.error("Upload error:",te.t0),ee.ZP.error("".concat(We.name," ").concat(W.formatMessage({id:"workflow.uploadFailed"})));case 32:Ke++,te.next=11;break;case 35:t(function(Ve){return[].concat(F()(Ve),at)}),Me(!1);case 37:case"end":return te.stop()}},ze,null,[[15,28]])}));return function(ze){return Pe.apply(this,arguments)}}(),ke.click()},Xe=function(ke){t(function(Pe){return Pe.filter(function(ze){return ze.uid!==ke})})},qe=function(){t([])};return{uploadedFiles:H,setUploadedFiles:t,handleUpload:gt,removeFile:Xe,clearFiles:qe,isUploading:He}};Oe.ZP=_e},58299:function(st,Oe,c){c.d(Oe,{m:function(){return B}});var Te=c(64599),b=c.n(Te),Re=c(97857),F=c.n(Re),Ie=c(15009),Ce=c.n(Ie),m=c(99289),Ae=c.n(m),ee=c(73445),we=c(42237),he=c(67294),be=(0,ee.Ue)(function(_e){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var ue=Ae()(Ce()().mark(function W(){var E;return Ce()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.prev=0,_e({loading:!0}),H.next=4,(0,we.fZ)();case 4:if(E=H.sent,E.code!==0){H.next=9;break}_e({models:Array.isArray(E.data.data)?E.data.data:[],initialized:!0}),H.next=10;break;case 9:throw new Error(E.message||"Failed to fetch models");case 10:H.next=15;break;case 12:H.prev=12,H.t0=H.catch(0),_e({error:H.t0.message});case 15:return H.prev=15,_e({loading:!1}),H.finish(15);case 18:case"end":return H.stop()}},W,null,[[0,12,15,18]])}));function me(){return ue.apply(this,arguments)}return me}()}}),B=function(){var ue=be(function(H){return H.models}),me=be(function(H){return H.loading}),W=be(function(H){return H.initialized}),E=be(function(H){return H.fetchModels});(0,he.useEffect)(function(){W||E()},[W,E]);var Ee=(0,he.useMemo)(function(){var H=Array.isArray(ue)?ue:[],t=H.map(function(ge){return{label:ge.supplier_name,options:Array.isArray(ge.model_list)?ge.model_list.map(function(Ue){return F()({label:Ue.model_name,value:Ue.model_config_id},Ue)}):[]}}),Qe,Ne=b()(H),He;try{for(Ne.s();!(He=Ne.n()).done;){var Me=He.value;if(Array.isArray(Me.model_list)){var fe=Me.model_list.find(function(ge){return ge.model_default_used===1});if(fe){Qe=fe.model_config_id;break}}}}catch(ge){Ne.e(ge)}finally{Ne.f()}return{options:t,defaultValue:Qe}},[ue]);return F()(F()({},Ee),{},{loading:me})}}}]);
