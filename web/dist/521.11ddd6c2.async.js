"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[521],{13085:function(Ye,Ie,t){t.d(Ie,{Z:function(){return ne}});var Ze=t(19632),E=t.n(Ze),Ce=t(97857),J=t.n(Ce),Re=t(15009),w=t.n(Re),he=t(99289),D=t.n(he),ke=t(5574),I=t.n(ke),R=t(11551),c=t(67294),re=t(74330),se=t(35312),a=t(85893),De=function(r){var u=r.children,S=r.onLoadMore,p=r.onLoadPrevious,M=r.hasMore,x=r.hasPrevious,v=x===void 0?!1:x,N=r.threshold,g=N===void 0?100:N,A=r.className,k=A===void 0?"":A,h=r.loadingComponent,Z=h===void 0?(0,a.jsx)(re.Z,{size:"small"}):h,le=r.errorComponent,_=r.initialScrollPosition,ee=_===void 0?"bottom":_,K=r.preserveScrollPosition,G=K===void 0?!0:K,ve=r.scrollBehavior,We=ve===void 0?"smooth":ve,Ae=(0,se.useIntl)(),B=(0,c.useRef)(null),xe=(0,c.useState)(!1),ye=I()(xe,2),ie=ye[0],je=ye[1],be=(0,c.useState)(!1),me=I()(be,2),oe=me[0],we=me[1],Se=(0,c.useState)(null),de=I()(Se,2),fe=de[0],Ge=de[1],Y=(0,c.useRef)(!1),Me=(0,c.useRef)(!0),Ne=function(){B.current&&(B.current.scrollTop=B.current.scrollHeight)};(0,c.useEffect)(function(){Me.current&&B.current&&(B.current.scrollTop=B.current.scrollHeight,Me.current=!1)},[]),(0,c.useEffect)(function(){var P=B.current;if(P){var ge=function(){var te=D()(w()().mark(function V(){var O,U,Le,Pe,Te;return w()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Y.current){T.next=2;break}return T.abrupt("return");case 2:if(O=P.scrollTop,U=P.scrollHeight,Le=P.clientHeight,!(v&&!oe&&O<g)){T.next=16;break}return T.prev=4,Y.current=!0,we(!0),Pe=P.scrollHeight,Te=P.scrollTop,T.next=11,p==null?void 0:p();case 11:requestAnimationFrame(function(){var Be=P.scrollHeight,n=Be-Pe;P.scrollTop=Te+n});case 12:return T.prev=12,Y.current=!1,we(!1),T.finish(12);case 16:if(!(M&&!ie&&U-O-Le<g)){T.next=27;break}return T.prev=17,Y.current=!0,je(!0),T.next=22,S==null?void 0:S();case 22:P.scrollTop=P.scrollHeight;case 23:return T.prev=23,Y.current=!1,je(!1),T.finish(23);case 27:case"end":return T.stop()}},V,null,[[4,,12,16],[17,,23,27]])}));return function(){return te.apply(this,arguments)}}(),y=ae(ge,150);return P.addEventListener("scroll",y),function(){return P.removeEventListener("scroll",y)}}},[M,v,S,p,g,ie,oe]);function ae(P,ge){var y;return function(){for(var te=this,V=arguments.length,O=new Array(V),U=0;U<V;U++)O[U]=arguments[U];clearTimeout(y),y=setTimeout(function(){return P.apply(te,O)},ge)}}return(0,a.jsxs)("div",{ref:B,className:"relative overflow-y-auto ".concat(k),children:[(0,a.jsxs)("div",{className:"flex flex-col-reverse min-h-full",children:[oe&&(0,a.jsx)("div",{className:"sticky top-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:Z}),u,ie&&(0,a.jsx)("div",{className:"sticky bottom-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:Z})]}),fe&&(0,a.jsx)("div",{className:"sticky top-0 w-full text-center py-2 text-red-500",children:le||fe.message})]})},ue=De,He=t(39944),W=t(55927),pe=t(82114),ze=t(27496),l=t(82061),Ee=t(34994),Oe=t(90672),Ue=t(64317),Fe=t(77598),H=t(45360),F=t(85576),d=t(28036),Q=t(22683),L=t(97807),X=(0,c.memo)(function(e){var r=e.message;return(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("div",{className:"max-w-[70%] rounded-lg p-3 bg-blue-100 text-blue-900",children:r.message})})}),q=(0,c.memo)(function(e){var r,u=e.message,S=e.detailList,p=e.abilitiesList,M=(0,se.useIntl)(),x=p==null?void 0:p.find(function(v){return v.value===u.ability_id});return(0,a.jsx)("div",{className:"flex justify-start pb-4",children:(0,a.jsxs)("div",{className:"max-w-full",children:[(0,a.jsxs)("div",{className:"text-sm font-bold mb-2",children:[S==null||(r=S.app)===null||r===void 0?void 0:r.name," ",(x==null?void 0:x.label)&&(0,a.jsxs)("span",{className:"text-gray-500 font-normal text-xs",children:["(",x==null?void 0:x.label,")"]})]}),(0,a.jsxs)("div",{className:"max-w-[90%] rounded-lg  relative bg-white text-gray-900 border border-gray-200",children:[u.message&&(0,a.jsx)("div",{className:"p-3 child  max-w-full [&_p]:mb-0 [&_div]:max-w-full break-words",children:(0,a.jsx)(Q.U,{rehypePlugins:[L.Z],children:u.message})}),u.error&&(0,a.jsxs)("div",{className:"p-3 text-red-500",children:[(0,a.jsx)("div",{children:M.formatMessage({id:"agent.chat.error.message"})}),u.error]}),(0,a.jsx)("div",{className:"absolute w-full mt-1",children:(0,a.jsxs)("div",{className:"text-xs text-gray-500 flex justify-between",children:[(0,a.jsx)("div",{children:u.created_time}),(0,a.jsx)("div",{})]})})]})]})})}),ce=(0,c.memo)(function(e){var r,u=e.detailList,S=(0,se.useIntl)();return(0,a.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[70%]",children:(0,a.jsxs)("div",{className:"max-w-full",children:[(0,a.jsx)("div",{className:"text-sm font-bold mb-2",children:u==null||(r=u.app)===null||r===void 0?void 0:r.name}),(0,a.jsx)("div",{className:"max-w-[90%] min-w-[200px] rounded-lg relative bg-white text-gray-900 border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 pr-4",children:[(0,a.jsx)(re.Z,{size:"small"}),(0,a.jsx)("span",{className:"text-gray-500",children:S.formatMessage({id:"agent.chat.waiting"})})]})})]})})}),ne=(0,c.memo)(function(e){var r,u,S,p,M,x,v,N,g,A=(0,c.useState)([]),k=I()(A,2),h=k[0],Z=k[1],le=(0,c.useState)(!0),_=I()(le,2),ee=_[0],K=_[1],G=(0,c.useState)(1),ve=I()(G,2),We=ve[0],Ae=ve[1],B=(0,c.useState)(!1),xe=I()(B,2),ye=xe[0],ie=xe[1],je=(0,c.useState)(!1),be=I()(je,2),me=be[0],oe=be[1],we=(0,c.useState)(!1),Se=I()(we,2),de=Se[0],fe=Se[1],Ge=(0,c.useState)(!1),Y=I()(Ge,2),Me=Y[0],Ne=Y[1],ae=(0,c.useRef)(),P=(0,c.useRef)(null),ge=(0,c.useRef)(null),y=(0,se.useIntl)(),te=(0,W.Z)(function(n){return n.getTypedMessages("chat_message_llm_return")}),V=(0,W.Z)(function(n){return n.getTypedLastMessage("chat_message_llm_return")});console.log(e.data);var O=function(){var o;(o=P.current)===null||o===void 0||o.scrollIntoView({behavior:"smooth"})},U=function(){var n=D()(w()().mark(function o(){var s,f,m;return w()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e!=null&&(s=e.saveInfo)!==null&&s!==void 0&&s.firstjudgingcondition())){i.next=4;break}return i.abrupt("return",!0);case 4:if(!(e!=null&&(f=e.saveInfo)!==null&&f!==void 0&&f.secondjudgingcondition())){i.next=8;break}return i.abrupt("return",!0);case 8:return i.next=10,e==null||(m=e.saveInfo)===null||m===void 0?void 0:m.agentupdata();case 10:return i.abrupt("return",i.sent);case 11:case"end":return i.stop()}},o)}));return function(){return n.apply(this,arguments)}}();(0,Fe.Z)(function(){var n=V==null?void 0:V.data;if(n){var o=J()(J()({},n),{},{id:n.message_id});te&&te.length>0&&(Ne(!1),Z(function(s){return[].concat(E()(s),[o])}),setTimeout(O,100))}},[te]);var Le=function(){var n=D()(w()().mark(function o(s){var f,m,j,i,b,C,$e,$,Ke;return w()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(console.log(s),i=(f=ae.current)===null||f===void 0?void 0:f.getFieldsValue(),!(!i||!((m=s.content)!==null&&m!==void 0&&m.trim()))){z.next=4;break}return z.abrupt("return");case 4:return b=e.data.detailList.agent.agent_id,C=e.data.detailList.agent.input_variables,$e=i.ability_id,$=new He.z({user:{value:i.content}}),Ke={id:Date.now(),content:s.content,isUser:!0,ability_id:$e,agent_id:b,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:i.content,prompt_tokens:0,total_tokens:0},Ne(!0),Z(function(Je){return[].concat(E()(Je),[Ke])}),(j=ae.current)===null||j===void 0||j.resetFields(["content"]),z.prev=12,z.next=15,(0,R.CY)({agent_id:b,input_dict:C,ability_id:$e,prompt:$});case 15:z.next=21;break;case 17:z.prev=17,z.t0=z.catch(12),Ne(!1),H.ZP.error("\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 21:setTimeout(O,100);case 22:case"end":return z.stop()}},o,null,[[12,17]])}));return function(s){return n.apply(this,arguments)}}(),Pe=function(){var n=D()(w()().mark(function o(){var s,f,m;return w()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if((s=e.data)!==null&&s!==void 0&&(s=s.detailList)!==null&&s!==void 0&&(s=s.agent)!==null&&s!==void 0&&s.agent_id){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,fe(!0),i.next=6,(0,R.CU)(String(e.data.detailList.agent.agent_id),1);case 6:m=i.sent,(f=m.data)!==null&&f!==void 0&&f.list&&(Z(m.data.list),K(m.data.total_pages>1),Ae(1)),i.next=13;break;case 10:i.prev=10,i.t0=i.catch(2),console.error("Failed to fetch initial messages:",i.t0);case 13:return i.prev=13,fe(!1),i.finish(13);case 16:case"end":return i.stop()}},o,null,[[2,10,13,16]])}));return function(){return n.apply(this,arguments)}}(),Te=function(){var n=D()(w()().mark(function o(){var s,f,m,j;return w()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(ye||!((s=e.data)!==null&&s!==void 0&&(s=s.detailList)!==null&&s!==void 0&&(s=s.agent)!==null&&s!==void 0&&s.agent_id))){b.next=2;break}return b.abrupt("return");case 2:return b.prev=2,ie(!0),m=We+1,b.next=7,(0,R.CU)(String(e.data.detailList.agent.agent_id),m);case 7:j=b.sent,((f=j.data)===null||f===void 0||(f=f.list)===null||f===void 0?void 0:f.length)>0?(Z(function(C){return[].concat(E()(j.data.list),E()(C))}),Ae(m),K(m<j.data.total_pages)):K(!1),b.next=15;break;case 11:b.prev=11,b.t0=b.catch(2),console.error("Failed to load more messages:",b.t0),K(!1);case 15:return b.prev=15,ie(!1),b.finish(15);case 18:case"end":return b.stop()}},o,null,[[2,11,15,18]])}));return function(){return n.apply(this,arguments)}}(),Ve=function(){var n=D()(w()().mark(function o(){var s;return w()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(!((s=e.data)!==null&&s!==void 0&&(s=s.detailList)!==null&&s!==void 0&&(s=s.agent)!==null&&s!==void 0&&s.agent_id)||me||!h.length)){m.next=2;break}return m.abrupt("return");case 2:F.Z.confirm({title:y.formatMessage({id:"agent.chat.clear.memory.confirm.title"}),icon:(0,a.jsx)(pe.Z,{}),content:y.formatMessage({id:"agent.chat.clear.memory.confirm.content"}),okText:y.formatMessage({id:"agent.chat.clear.memory.confirm.ok"}),cancelText:y.formatMessage({id:"agent.chat.clear.memory.confirm.cancel"}),onOk:function(){var j=D()(w()().mark(function b(){var C;return w()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,oe(!0),C=h[h.length-1].id,$.next=5,(0,R.Nj)(String(e.data.detailList.agent.agent_id),C);case 5:H.ZP.success(y.formatMessage({id:"agent.chat.clear.memory.success"})),$.next=11;break;case 8:$.prev=8,$.t0=$.catch(0),console.error("Failed to clear context memory:",$.t0);case 11:return $.prev=11,oe(!1),$.finish(11);case 14:case"end":return $.stop()}},b,null,[[0,8,11,14]])}));function i(){return j.apply(this,arguments)}return i}()});case 3:case"end":return m.stop()}},o)}));return function(){return n.apply(this,arguments)}}();(0,c.useEffect)(function(){var n;(n=e.data)!==null&&n!==void 0&&(n=n.detailList)!==null&&n!==void 0&&(n=n.agent)!==null&&n!==void 0&&n.agent_id&&Pe()},[(r=e.data)===null||r===void 0||(r=r.detailList)===null||r===void 0||(r=r.agent)===null||r===void 0?void 0:r.agent_id]),(0,c.useEffect)(function(){!de&&h.length>0&&O()},[de]);var T=function(){return(0,a.jsxs)("div",{className:"flex items-center justify-center py-2 bg-white/80",children:[(0,a.jsx)(re.Z,{size:"small"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:y.formatMessage({id:"agent.chat.loading.more"})})]})};if(de)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(re.Z,{})});var Be=function(){var n=D()(w()().mark(function o(){return w()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,U();case 2:setTimeout(D()(w()().mark(function m(){var j,i;return w()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,(0,R.Dh)((j=e.data)===null||j===void 0||(j=j.detailList)===null||j===void 0||(j=j.agent)===null||j===void 0?void 0:j.agent_id);case 2:i=C.sent,i.code==0?H.ZP.success(y.formatMessage({id:"agent.message.success.publish"})):H.ZP.error(y.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return C.stop()}},m)})),500);case 3:case"end":return f.stop()}},o)}));return function(){return n.apply(this,arguments)}}();return(0,a.jsx)("div",{className:"!h-[calc(100vh-65px)] p-4 !pb-0 box-border",children:(0,a.jsxs)(Ee.A,{formRef:ae,submitter:!1,onFinish:Le,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto ",children:[(0,a.jsxs)("div",{className:"pb-4 flex gap-[10px] ",style:{paddingBottom:"16px"},children:[(0,a.jsx)("div",{className:"flex-1 flex items-center font-bold text-base",children:(u=e.data)===null||u===void 0||(u=u.detailList)===null||u===void 0||(u=u.app)===null||u===void 0?void 0:u.name}),e.operationbentate=="false"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.ZP,{type:"primary",disabled:e.operationbentate!="false",onClick:U,className:"min-w-24",children:y.formatMessage({id:"agent.btn.savedebug"})}),(0,a.jsx)(d.ZP,{type:"primary",disabled:e.operationbentate!="false",onClick:Be,className:"min-w-24",children:y.formatMessage({id:"agent.publish"})})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#ccc] flex-1 overflow-y-auto flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto ",ref:ge,children:(0,a.jsx)(ue,{className:"h-full",onLoadPrevious:Te,hasPrevious:ee,hasMore:!1,threshold:50,loadingComponent:(0,a.jsx)(T,{}),children:(0,a.jsxs)("div",{className:"px-4 py-2 space-y-4",children:[h.map(function(n){var o,s;return n.agent_run_id===0?(0,a.jsx)(X,{message:n},n.id):(0,a.jsx)(q,{detailList:e==null||(o=e.data)===null||o===void 0?void 0:o.detailList,abilitiesList:e==null||(s=e.data)===null||s===void 0?void 0:s.abilitiesList,message:n},n.id)}),Me&&(0,a.jsx)(ce,{detailList:e==null||(S=e.data)===null||S===void 0?void 0:S.detailList}),(0,a.jsx)("div",{ref:P})]})})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 bg-white  px-4 py-2 relative",children:[(0,a.jsxs)("div",{className:"flex items-center p-[8px] gap-[10px] box-border border bg-white rounded-[8px]",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(Oe.Z,{name:"content",placeholder:y.formatMessage({id:"agent.chat.input.placeholder"}),disabled:(e==null||(p=e.data)===null||p===void 0||(p=p.detailList)===null||p===void 0||(p=p.agent)===null||p===void 0?void 0:p.agent_id)==0,fieldProps:{autoSize:{minRows:1,maxRows:4},variant:"borderless",onPressEnter:function(o){if(!o.shiftKey){var s;o.preventDefault(),(s=ae.current)===null||s===void 0||s.submit()}},size:"small",className:"",title:y.formatMessage({id:"agent.chat.input.shift.enter"})},formItemProps:{className:"mb-0"},className:"mb-0"})}),(0,a.jsx)(d.ZP,{onClick:function(){var o;return(o=ae.current)===null||o===void 0?void 0:o.submit()},type:"primary",disabled:(e==null||(M=e.data)===null||M===void 0||(M=M.detailList)===null||M===void 0||(M=M.agent)===null||M===void 0?void 0:M.agent_id)==0,className:"min-w-[30px] h-[30px] flex items-center justify-center cursor-pointer rounded-[6px]",icon:(0,a.jsx)(ze.Z,{}),title:y.formatMessage({id:"agent.chat.send"})})]}),(0,a.jsxs)("div",{className:"flex items-center mt-1 gap-2",children:[(0,a.jsx)(Ue.Z,{name:"ability_id",options:((x=e.data)===null||x===void 0?void 0:x.abilitiesList)||[{value:0,label:y.formatMessage({id:"agent.allability"})}],fieldProps:{placeholder:y.formatMessage({id:"agent.pleaseselect"}),size:"small"},disabled:(e==null||(v=e.data)===null||v===void 0||(v=v.detailList)===null||v===void 0||(v=v.agent)===null||v===void 0?void 0:v.agent_id)==0||!((N=e.data)!==null&&N!==void 0&&(N=N.abilitiesList)!==null&&N!==void 0&&N.length),formItemProps:{className:"mb-0"}}),(0,a.jsx)(d.ZP,{icon:(0,a.jsx)(l.Z,{}),disabled:(e==null||(g=e.data)===null||g===void 0||(g=g.detailList)===null||g===void 0||(g=g.agent)===null||g===void 0?void 0:g.agent_id)==0,loading:me,onClick:Ve,size:"small",children:y.formatMessage({id:"agent.chat.clear.memory"})})]})]})]})]})})})},43822:function(Ye,Ie,t){t.d(Ie,{ZP:function(){return Fe}});var Ze=t(5574),E=t.n(Ze),Ce=t(15009),J=t.n(Ce),Re=t(99289),w=t.n(Re),he=t(11551),D=t(29608),ke=t(32592),I=t(35312),R=t(67294),c=t(28508),re=t(29933),se=t(3917),a=t(66309),De=t(28036),ue=t(71471),He=t(74330),W=t(26412),pe=t(12845),ze=t(39873),l=t(85893),Ee=(0,R.memo)(function(H){var F,d=H.data,Q=H.onClose,L=(0,I.useIntl)(),X=(0,R.useState)(500),q=E()(X,2),ce=q[0],ne=q[1],e=(0,se.Z)(function(){var x=w()(J()().mark(function v(N,g){var A;return J()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,he.pC)(N,g);case 2:return A=h.sent,h.abrupt("return",A.data);case 4:case"end":return h.stop()}},v)}));return function(v,N){return x.apply(this,arguments)}}(),{manual:!0}),r=e.data,u=e.loading,S=e.run;(0,R.useEffect)(function(){d!=null&&d.app_id&&d!==null&&d!==void 0&&d.app_run_id&&S(d.app_id,d.app_run_id)},[d==null?void 0:d.app_id,d==null?void 0:d.app_run_id,S]);var p=function(v){var N={1:{color:"processing",text:L.formatMessage({id:"workflow.running"})},2:{color:"success",text:L.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:L.formatMessage({id:"workflow.runF"})}},g=N[v]||{color:"default",text:"Unknown"};return(0,l.jsx)(a.Z,{color:g.color,children:g.text})},M=function(v){ne(v)};return(0,l.jsx)(ze.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:ce,onChange:M,children:(0,l.jsx)(re.Z,{className:"border-none h-full",style:{height:"calc(100vh - 10px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,l.jsx)(De.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:Q,icon:(0,l.jsx)(c.Z,{})}),title:(0,l.jsx)(ue.Z.Title,{level:5,children:L.formatMessage({id:"agent.log.detail"})}),loading:u,children:(0,l.jsx)("div",{className:"space-y-6",children:u?(0,l.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,l.jsx)(He.Z,{})}):r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(W.Z,{column:1,bordered:!0,size:"small",children:[(0,l.jsx)(W.Z.Item,{label:L.formatMessage({id:"workflow.user"}),children:r.nickname}),(0,l.jsx)(W.Z.Item,{label:L.formatMessage({id:"workflow.status"}),children:p(r.status)}),(0,l.jsx)(W.Z.Item,{label:L.formatMessage({id:"workflow.created_time"}),children:r.created_time}),(0,l.jsxs)(W.Z.Item,{label:L.formatMessage({id:"workflow.elapsed_time"}),children:[r.elapsed_time,"s"]}),(0,l.jsx)(W.Z.Item,{label:"Tokens",children:r.total_tokens})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)(ue.Z.Title,{level:5,children:L.formatMessage({id:"agent.log.output"})}),r.outputs?(0,l.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:((F=r.outputs)===null||F===void 0?void 0:F.value)||""})}):r.error?(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,l.jsx)("div",{className:"text-red-500 font-medium mb-2",children:L.formatMessage({id:"agent.log.error"})}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:r.error})]}):(0,l.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,l.jsx)("div",{className:"text-sm text-gray-500",children:L.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(r==null?void 0:r.prompt_data)&&r.prompt_data.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)(ue.Z.Title,{level:5,children:L.formatMessage({id:"agent.log.conversation"})}),(0,l.jsx)(pe.Z,{className:"mt-2",children:r.prompt_data.map(function(x,v){var N=E()(x,2),g=N[0],A=N[1];return(0,l.jsx)(pe.Z.Item,{color:g==="human"?"blue":"green",children:(0,l.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,l.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:g}),(0,l.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:A.value})]})},v)})})]})]}):null})})})}),Oe=null,Ue=null,Fe=function(H){var F=H.agent_id,d=(0,I.useIntl)(),Q=(0,I.useSearchParams)(),L=E()(Q,1),X=L[0],q=(0,R.useRef)(null),ce=(0,R.useState)(null),ne=E()(ce,2),e=ne[0],r=ne[1],u=(0,R.useState)(!1),S=E()(u,2),p=S[0],M=S[1],x=X.get("app_id"),v=function(){M(!1)},N=function(h){r({app_id:x,app_run_id:h.id}),M(!0)},g=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:d.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:d.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:d.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:d.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:d.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:d.formatMessage({id:"workflow.created_time_des",defaultMessage:d.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(d.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:d.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:d.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],A=(0,D.Z)(function(k){return k.setRunPanelLogRecord});return(0,l.jsxs)("div",{className:"h-full",children:[(0,l.jsx)(ke.Z,{columns:g,formRef:q,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var k=w()(J()().mark(function h(Z,le,_){var ee;return J()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return console.log(Z,le,_),G.next=3,(0,he.My)(x,{page:Z.current,page_size:Z.pageSize});case 3:return ee=G.sent,console.log(ee),G.abrupt("return",{data:ee.data.list,success:!0,total:ee.data.total_count});case 6:case"end":return G.stop()}},h)}));return function(h,Z,le){return k.apply(this,arguments)}}(),onRow:function(h){return{onClick:function(){N(h)},className:(e==null?void 0:e.app_run_id)===h.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:d.formatMessage({id:"agent.log.list"})}),p&&(e==null?void 0:e.app_id)&&(e==null?void 0:e.app_run_id)&&(0,l.jsx)(Ee,{data:e,onClose:v})]})}}}]);
