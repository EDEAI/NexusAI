"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,be,t){var Re=t(5574),H=t.n(Re),Be=t(42881),q=t(67294),ie=t(85893),p=function(S){var $e=S.children,J=S.className,_=J===void 0?"":J,te=S.dragDirection,ve=te===void 0?"left":te,we=S.minWidth,Ee=we===void 0?115:we,he=S.maxWidth,F=he===void 0?820:he,ue=S.minHeight,r=ue===void 0?200:ue,ae=S.maxHeight,xe=ae===void 0?800:ae,Y=S.defaultWidth,Ce=Y===void 0?415:Y,f=S.defaultHeight,K=f===void 0?300:f,e=S.onChange,ee=(0,q.useState)(Ce),ke=H()(ee,2),He=ke[0],pe=ke[1],Ye=(0,q.useState)(K),fe=H()(Ye,2),rt=fe[0],Xe=fe[1],it=(0,q.useCallback)(function(Fe,Ue){pe(Fe),Ue&&Xe(Ue),e==null||e(Fe,Ue)},[pe,Xe,e]),Qe=(0,Be.W)({direction:["left","right"].includes(ve)?"horizontal":"vertical",triggerDirection:ve,minWidth:Ee,maxWidth:F,minHeight:r,maxHeight:xe,onResize:it}),Ze=Qe.triggerRef,st=Qe.containerRef;return(0,ie.jsxs)("div",{ref:st,style:{width:["left","right"].includes(ve)?"".concat(He,"px"):void 0,height:["top","bottom"].includes(ve)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(_),children:[ve==="left"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="right"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="top"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ve==="bottom"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),$e]})};be.Z=(0,q.memo)(p)},36711:function(bt,be,t){t.r(be),t.d(be,{waitTime:function(){return he},waitTimePromise:function(){return Ee}});var Re=t(97857),H=t.n(Re),Be=t(5574),q=t.n(Be),ie=t(15009),p=t.n(ie),Je=t(99289),S=t.n(Je),$e=t(42237),J=t(29608),_=t(83535),te=t(35312),ve=t(67294),we=t(85893),Ee=function(){var F=S()(p()().mark(function ue(){var r,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return r=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.abrupt("return",new Promise(function(Ce){setTimeout(function(){Ce(!0)},r)}));case 2:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}(),he=function(){var F=S()(p()().mark(function ue(){var r,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return r=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.next=3,Ee(r);case 3:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}();be.default=function(){var F=(0,te.useIntl)(),ue=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:F.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ee;f==null||(ee=f.current)===null||ee===void 0||ee.submit()}}},{title:F.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:F.formatMessage({id:"workflow.created_time_des",defaultMessage:F.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:F.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ee;f==null||(ee=f.current)===null||ee===void 0||ee.submit()}},valueEnum:{1:{text:F.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:F.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:F.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(F.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:F.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:F.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],r=(0,te.useSearchParams)(),ae=q()(r,1),xe=ae[0],Y=(0,J.Z)(function(K){return K.setRunPanelLogRecord}),Ce=xe.get("app_id"),f=(0,ve.useRef)(null);return(0,we.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,we.jsx)("div",{children:(0,we.jsx)(_.Z,{columns:ue,formRef:f,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var K=S()(p()().mark(function e(ee,ke,He){var pe;return p()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return console.log(ee,ke,He),fe.next=3,(0,$e.bB)(H()(H()({app_runs_name:"",app_runs_status:0},ee),{},{app_id:Ce}));case 3:return pe=fe.sent,console.log(pe),fe.abrupt("return",{data:pe.data.list,success:!0,total:pe.data.total_count});case 6:case"end":return fe.stop()}},e)}));return function(e,ee,ke){return K.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),Y(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:F.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(bt,be,t){t.r(be),t.d(be,{default:function(){return xa}});var Re=t(15009),H=t.n(Re),Be=t(99289),q=t.n(Be),ie=t(97857),p=t.n(ie),Je=t(5574),S=t.n(Je),$e=t(32060),J=t(42237),_=t(35312),te=t(63648),ve=t(16091),we=t(13118),Ee=t(78234),he=t(77598),F=t(45360),ue=t(85576),r=t(67294),ae=t(64599),xe=t.n(ae),Y=t(7493),Ce=t(34559),f=t(15425),K=t(96906),e=t(85893),ee=function(i){return{nodes:i.nodes,edges:i.edges,onNodesChange:i.onNodesChange,onEdgesChange:i.onEdgesChange,onConnect:i.onConnect,nodeTypes:i.nodeTypes,connectionLineStyle:i.connectionLineStyle,defaultViewport:i.defaultViewport,onDrop:i.onDrop,onDragOver:i.onDragOver,setSelect:i.setSelect,preventScrolling:i.preventScrolling}},ke=(0,r.memo)(function(o){var i=o.children,d=(0,_.useIntl)(),v=(0,f.Z)(function(c){return c.nodes}),w=(0,f.Z)(function(c){return c.getEdges}),s=(0,f.Z)(function(c){return c.edges}),x=(0,f.Z)(function(c){return c.setEdges}),l=(0,f.Z)(function(c){return c.onNodesChange}),a=(0,f.Z)(function(c){return c.onEdgesChange}),g=(0,f.Z)(function(c){return c.onConnect}),D=(0,f.Z)(function(c){return c.nodeTypes}),N=(0,f.Z)(function(c){return c.connectionLineStyle}),M=(0,f.Z)(function(c){return c.defaultViewport}),B=(0,f.Z)(function(c){return c.onDrop}),E=(0,f.Z)(function(c){return c.onDragOver}),u=(0,f.Z)(function(c){return c.setSelect}),m=(0,f.Z)(function(c){return c.preventScrolling}),$=(0,r.useCallback)(function(c){var W=v.find(function(I){return I.id===c.target}),h=function I(L){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(C.has(L.id))return!1;C.add(L.id);var T=xe()((0,Y.xA)(L,v,s)),k;try{for(T.s();!(k=T.n()).done;){var se=k.value;if(se.id===c.source||I(se,C))return!0}}catch(ce){T.e(ce)}finally{T.f()}};return W.id===c.source?!1:!h(W)},[v,s]),me=function(){},U=(0,r.useCallback)(function(c,W){console.log(c,W,w(),(0,Y.Kz)(c,W,s)),x((0,Y.Kz)(c,W,w()))},[]);return(0,he.Z)(function(){},[v]),(0,e.jsx)(Ce.tV,{children:(0,e.jsx)(te.x$,{onViewportChange:me,nodes:v,edges:s,onNodesChange:l,onEdgesChange:a,onEdgesDelete:function(W){},onConnect:g,onReconnect:U,nodeTypes:D,minZoom:.3,maxZoom:1,connectionLineStyle:N,snapToGrid:!1,isValidConnection:$,connectionRadius:30,preventScrolling:m,onDragOver:E,onPaneClick:function(){u("")},onPaneContextMenu:function(W){W.preventDefault()},onSelectionChange:function(W){},onNodeClick:function(W,h){u(h.id)},onEdgeClick:function(W,h){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(W){},onBeforeDelete:function(){var c=q()(H()().mark(function W(h){var I;return H()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if((h==null||(I=h.nodes)===null||I===void 0||(I=I[0])===null||I===void 0?void 0:I.type)!=K.vW.Start){C.next=3;break}return F.ZP.error(d.formatMessage({id:"workflow.delStartNodeError"})),C.abrupt("return",Promise.reject(d.formatMessage({id:"workflow.delStartNodeError"})));case 3:return u(""),C.abrupt("return",Promise.resolve(h));case 5:case"end":return C.stop()}},W)}));return function(W){return c.apply(this,arguments)}}(),fitView:!0,children:i})})}),He=function(i){var d=(0,r.useCallback)(function(s){s.preventDefault(),s.dataTransfer.dropEffect="move"},[]),v=(0,r.useCallback)(function(s){s.preventDefault();var x=s.dataTransfer.getData("application/reactflow");if(!x)return null;var l=JSON.parse(x),a=l.type,g=l.item;if(!a||!g)return null;var D=i({x:s.clientX,y:s.clientY});return{position:D,type:a,item:g}},[i]),w=(0,r.useCallback)(function(s){var x=function(a){var g=v(a);g&&s(g.position,g.type,g.item)};return document.addEventListener("dragover",d),document.addEventListener("drop",x),function(){document.removeEventListener("dragover",d),document.removeEventListener("drop",x)}},[d,v]);return{onDnD:w}},pe=He,Ye=function(){var i=(0,f.Z)(function(l){return l.setAgentData}),d=(0,f.Z)(function(l){return l.setSkillData}),v=(0,f.Z)(function(l){return l.setToolData}),w=(0,f.Z)(function(l){return l.setDatasetData}),s=(0,f.Z)(function(l){return l.setTeamDatasetData}),x=(0,f.Z)(function(l){return l.setModelOptionsData});(0,r.useEffect)(function(){(0,J.x$)(2).then(function(l){l.code===0&&i({team:l.data})}),(0,J.x$)(3).then(function(l){l.code===0&&i({user:l.data})}),(0,J.w)(2).then(function(l){l.code===0&&d({team:l.data})}),(0,J.w)(3).then(function(l){l.code===0&&d({user:l.data})}),(0,J.GZ)().then(function(l){l.code===0&&v({list:Object.values(l.data)})}),(0,J.fZ)().then(function(l){var a,g=Array.isArray(l==null||(a=l.data)===null||a===void 0?void 0:a.data)?l.data.data:[],D=g.map(function(m){return{label:m.supplier_name,options:Array.isArray(m.model_list)?m.model_list.map(function($){return p()(p()({},$),{},{label:$.model_name,value:$.model_config_id})}):[]}}),N,M=xe()(g),B;try{for(M.s();!(B=M.n()).done;){var E=B.value;if(Array.isArray(E.model_list)){var u=E.model_list.find(function(m){return m.model_default_used===1});if(u){N=u.model_config_id;break}}}}catch(m){M.e(m)}finally{M.f()}x({options:D,defaultValue:N})}),(0,J.mG)().then(function(l){l.code==0&&w({list:l.data.data.map(function(a){return p()(p()({},a),{},{label:a.name,value:a.dataset_id})})})}),(0,J.mG)(2).then(function(l){l.code==0&&s({list:l.data.data.map(function(a){return p()(p()({},a),{},{label:a.name,value:a.dataset_id})})})})},[i,d,v])},fe=Ye,rt=t(18032),Xe=(0,r.memo)(function(o){var i=o.onSubmit,d=o.onClose;return(0,e.jsx)(rt.default,{onSubmit:i,onClose:d})}),it=t(39873),Qe=t(47520),Ze=t(36711),st=t(82826),Fe=t(43425),Ue=t(48869),Tt=t(69243),Pt=t(91806),lt=t(34994),qe=t(52688),Et=t(55241),Zt=t(50136),dt=t(43586),Wt=function(){var i,d=(0,_.useIntl)(),v=(0,r.useState)(!0),w=S()(v,2),s=w[0],x=w[1],l=(0,f.Z)(function(C){return C.setWorkflowEditInfo}),a=(0,f.Z)(function(C){return C.workFlowInfo}),g=(0,f.Z)(function(C){return C.setSelect}),D=(0,r.useState)("1"),N=S()(D,2),M=N[0],B=N[1],E=(0,r.useState)(!1),u=S()(E,2),m=u[0],$=u[1],me=(0,dt.Z)(),U=(0,r.useRef)(null),c=function(){var T,k;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(lt.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(qe.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(qe.Z,{tooltip:(a==null||(T=a.app)===null||T===void 0?void 0:T.publish_status)!="1"?{title:d.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(a==null||(k=a.app)===null||k===void 0?void 0:k.publish_status)!="1",name:"enable_api",label:"API"})]})})})},W=[{key:"4",icon:(0,e.jsx)(st.Z,{}),label:d.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:a!=null&&a.isProd?(0,e.jsx)(Fe.Z,{}):(0,e.jsx)(Et.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Fe.Z,{})}),label:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:a==null?void 0:a.isProd},{key:"1",icon:(0,e.jsx)(Ue.Z,{}),label:d.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Tt.Z,{}),label:d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:m?d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):d.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!m},{key:"3",icon:(0,e.jsx)(Pt.Z,{}),label:d.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,he.Z)(function(){if(a){var C,T,k,se,ce=a==null||(C=a.app)===null||C===void 0?void 0:C.is_public,je=a==null||(T=a.app)===null||T===void 0?void 0:T.enable_api,le={};le.is_public=!!ce,le.enable_api=(a==null||(k=a.app)===null||k===void 0?void 0:k.publish_status)=="1"?!!je:!1,console.log(le),$(le.enable_api),U==null||(se=U.current)===null||se===void 0||se.setFieldsValue(le)}},[a]);var h=function(T,k){console.log(T,k),I(k.enable_api),l(k),setTimeout(me,300)},I=function(T){$(!!T)},L=function(T){var k;switch(T.key){case"4":_.history.go(-1);break;case"0":break;case"2":window.open(Qe._n+(a==null||(k=a.app)===null||k===void 0?void 0:k.api_url),"_blank");break;default:g(""),B(T.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(M==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Zt.Z,{defaultSelectedKeys:["1"],selectedKeys:[M],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:s,items:W,onClick:L}),M=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(lt.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(qe.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(qe.Z,{disabled:!(a!=null&&(i=a.app)!==null&&i!==void 0&&i.api_url),name:"enable_api",label:"API"})]})})})]}),M=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(Ze.default,{})})})]})},At=Wt,ut=t(71471),Lt=(0,r.memo)(function(o){var i=o.name,d=o.description,v=o.publishStatus,w=(0,_.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ut.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:i}),v&&(0,e.jsxs)(ut.Z.Text,{className:"whitespace-normal",children:["(",w.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ut.Z.Text,{className:"whitespace-normal text-gray-500",children:d})]})}),Ot=t(19632),wt=t.n(Ot),Rt=t(9783),et=t.n(Rt),Bt=t(22352),ct=t(2302),$t=t(26474),Ht=t(40110),Ft=t(86615),Ut=t(5966),Kt=t(62370),zt=t(96638),_t=t(74330),Vt=t(11941),vt=t(69386),Gt=t(96486),Jt=t(87718),Yt=t(63783),tt=t(83062),ft=t(99510),mt=(0,r.memo)(function(o){var i=o.children,d=o.onDragStart,v=o.onClick,w=o.type,s=o.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(l){return d(l,w,s)},onClick:v,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:i})}),Xt=(0,r.memo)(function(o){var i,d,v,w,s=o.item,x=o.onDragStart,l=o.typeBadge,a=o.onItemClick;return(0,e.jsx)(tt.Z,{placement:"right",title:(s==null||(i=s.baseData)===null||i===void 0?void 0:i.description)||(s==null||(d=s.data)===null||d===void 0?void 0:d.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:x,type:s.type,item:s,onClick:function(){return a==null?void 0:a(s)},children:(0,e.jsx)(ft.Z,{title:s.data.title,icon:(s==null||(v=s.baseData)===null||v===void 0?void 0:v.avatar)||(s==null||(w=s.baseData)===null||w===void 0?void 0:w.icon)||s.type,typeBadge:l})})})})}),Qt=(0,r.memo)(function(o){var i,d=o.item,v=o.onDragStart,w=o.typeBadge,s=o.onItemClick;return(0,e.jsx)(tt.Z,{placement:"right",title:(i=d.baseData)===null||i===void 0?void 0:i.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:v,type:d.type,item:d,onClick:function(){return s==null?void 0:s(d)},children:(0,e.jsx)(ft.Z,{title:d.baseData.name,icon:d.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:d.baseData.nickname}),typeBadge:w})})})})}),qt=(0,r.memo)(function(o){var i,d,v,w,s,x,l,a,g,D,N,M,B,E,u=o.tool,m=o.category,$=o.onDragStart,me=o.typeBadge,U=o.onItemClick,c=o.categoryIndex,W=o.toolIndex,h=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans",I=(0,ct.o6)()[K.vW.Tool],L=p()(p()({},u),{},{authorization_status:m==null?void 0:m.authorization_status,title:u==null||(i=u.identity)===null||i===void 0?void 0:i.label[h],icon:m==null||(d=m.identity)===null||d===void 0?void 0:d.icon,groupName:m==null||(v=m.identity)===null||v===void 0?void 0:v.name,credentials_for_provider:m==null?void 0:m.credentials_for_provider}),C={title:u==null||(w=u.identity)===null||w===void 0?void 0:w.label[h],desc:(u==null||(s=u.description)===null||s===void 0||(s=s.human)===null||s===void 0?void 0:s[h])||(u==null||(x=u.description)===null||x===void 0?void 0:x.llm),icon:m==null||(l=m.identity)===null||l===void 0?void 0:l.icon,data:{title:u==null||(a=u.identity)===null||a===void 0?void 0:a.label[h],desc:(u==null||(g=u.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[h])||(u==null||(D=u.description)===null||D===void 0?void 0:D.llm),icon:m==null||(N=m.identity)===null||N===void 0?void 0:N.icon},baseData:L};return(0,e.jsx)(tt.Z,{placement:"right",title:u==null||(M=u.description)===null||M===void 0||(M=M.human)===null||M===void 0?void 0:M[h],children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:$,type:K.vW.Tool,item:C,onClick:function(){return U==null?void 0:U(m,u,c,W)},children:(0,e.jsx)(ft.Z,{title:u==null||(B=u.identity)===null||B===void 0?void 0:B.label[h],icon:m==null||(E=m.identity)===null||E===void 0?void 0:E.icon,typeBadge:me})})})})}),ea=(0,r.memo)(function(o){var i,d,v=o.category,w=o.onDragStart,s=o.typeBadge,x=o.onItemClick,l=o.categoryIndex,a=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[v==null||(i=v.identity)===null||i===void 0?void 0:i.label[a],(0,e.jsx)(tt.Z,{placement:"right",title:v==null||(d=v.identity)===null||d===void 0?void 0:d.description[a],children:(0,e.jsx)(Yt.Z,{className:"cursor-pointer ml-1"})})]}),v.tools.map(function(g,D){return(0,e.jsx)(qt,{tool:g,category:v,onDragStart:w,typeBadge:s,onItemClick:function(M,B,E,u){return x==null?void 0:x(M,B,E,u)},categoryIndex:l,toolIndex:D},D)})]})}),ta=function(i){var d=i.list,v=i.onDragStart,w=i.type,s=w===void 0?"normal":w,x=i.typeBadge,l=x===void 0?null:x,a=i.onItemClick;return d!=null&&d.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:s==="tools"?d.map(function(g,D){return(0,e.jsx)(ea,{category:g,typeBadge:l,onDragStart:v,onItemClick:a,categoryIndex:D},D)}):s==="workflow"?d.map(function(g,D){return(0,e.jsx)(Qt,{item:g,onDragStart:v,typeBadge:l,onItemClick:a},D)}):d.map(function(g,D){return(0,e.jsx)(Xt,{item:g,onDragStart:v,typeBadge:l,onItemClick:a},D)})}):null},aa=(0,r.memo)(ta),na=(0,r.memo)(function(o){var i=o.visibleTabs,d=o.defaultActiveTab,v=o.showTeamSwitch,w=v===void 0?!0:v,s=o.isMinWidth,x=s===void 0?!1:s,l=o.isCollapsed,a=l===void 0?!1:l,g=o.onItemClick,D=(0,_.useIntl)(),N=(0,_.getLocale)()=="en-US"?"en_US":"zh_Hans",M=(0,ct.o6)(),B=(0,r.useMemo)(function(){return Object.values(M).filter(function(b){return![K.vW.Start,K.vW.Agent,K.vW.Tool,K.vW.Skill].includes(b.base.type)}).map(function(b){return b.base})},[M]),E=(0,r.useState)(d||"1"),u=S()(E,2),m=u[0],$=u[1],me=(0,r.useState)(B),U=S()(me,2),c=U[0],W=U[1],h=(0,r.useState)([]),I=S()(h,2),L=I[0],C=I[1],T=(0,$t.v)(),k=T.tags,se=(0,zt.Z)(et()(et()(et()({},K.vW.Agent,[]),K.vW.Skill,[]),"workflow",[])),ce=S()(se,2),je=ce[0],le=ce[1],De=(0,r.useState)({team:1,keyword:"",tag:[]}),ye=S()(De,2),y=ye[0],ze=ye[1],_e=(0,r.useRef)({}),gt=6e4,Me=(0,f.Z)(function(b){return b.toolData});(0,r.useEffect)(function(){C((Me==null?void 0:Me.list)||[])},[Me]);var We=(0,r.useCallback)(function(b,R,Z){b.dataTransfer.setData("application/reactflow",JSON.stringify({type:R,item:Z})),b.dataTransfer.effectAllowed="move"},[]),at=(0,r.useCallback)(function(b,R){if(!R)return b;var Z=new vt.Z(b,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),ne=Z.search(R);return ne.map(function(n){return n.item})},[]),nt=(0,r.useCallback)(function(b,R){if(!R)return b;var Z=b.map(function(P){var j;return p()(p()({},P),{},{tools:(j=P.tools)===null||j===void 0?void 0:j.map(function(X){var z,oe;return p()(p()({},X),{},{categoryName:(z=P.identity)===null||z===void 0||(z=z.label)===null||z===void 0?void 0:z[N],categoryIcon:(oe=P.identity)===null||oe===void 0?void 0:oe.icon})})})}),ne=new vt.Z(Z,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),n=ne.search(R);return n.map(function(P){return p()(p()({},P.item),{},{tools:P.item.tools.filter(function(j){var X=new vt.Z([j],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return X.search(R).length>0})})}).filter(function(P){return P.tools.length>0})},[N]),Ae=(0,r.useCallback)(function(){var b=q()(H()().mark(function R(Z){var ne,n,P,j,X,z;return H()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(ne="".concat(Z,"-").concat(y.team,"-").concat(y.keyword,"-").concat(y.tag.join(",")),n=_e.current[ne],!(n&&Date.now()-n.timestamp<gt&&JSON.stringify(n.params)===JSON.stringify(y))){O.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(Z)),O.abrupt("return",n.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(Z)),O.prev=6,O.next=9,(0,J.RE)(Z,{search_type:y.team,apps_name:y.keyword,tag_ids:((P=y.tag)===null||P===void 0?void 0:P.join(","))||""});case 9:if(j=O.sent,!((j==null?void 0:j.code)===0&&j!==null&&j!==void 0&&j.data&&Array.isArray(j.data.list)&&j.data.list.length>0)){O.next=16;break}return X=j.data.list,z=X.filter(function(ge){return ge.publish_status==1}).map(function(ge){var Ne,Oe;return p()(p()({},(Ne=M[Z])===null||Ne===void 0?void 0:Ne.base),{},{data:p()(p()({},(Oe=M[Z])===null||Oe===void 0?void 0:Oe.base.data),{},{title:ge.name,desc:ge.description}),baseData:ge})}),_e.current[ne]={data:z,timestamp:Date.now(),params:p()({},y)},le(et()({},Z,z)),O.abrupt("return",z);case 16:return O.abrupt("return",[]);case 19:return O.prev=19,O.t0=O.catch(6),console.error("Failed to fetch ".concat(Z," data:"),O.t0),O.abrupt("return",[]);case 23:case"end":return O.stop()}},R,null,[[6,19]])}));return function(R){return b.apply(this,arguments)}}(),[y,M,le]),Ie=(0,r.useMemo)(function(){var b=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return y.keyword?at(c,y.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Ae(K.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return y.keyword?nt(L,y.keyword):L}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var Z=q()(H()().mark(function n(){return H()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,Ae(K.vW.Skill);case 2:return j.abrupt("return",j.sent);case 3:case"end":return j.stop()}},n)}));function ne(){return Z.apply(this,arguments)}return ne}()}],R=i!=null&&i.length?b.filter(function(Z){return i.includes(Z.tabKey)}):b;return R.map(function(Z,ne){return p()(p()({},Z),{},{key:ne+1+""})})},[c,je,L,i,y,at,nt,Ae]),Ve=(0,r.useMemo)(function(){return Ie.map(function(b){return{key:b.key,label:D.formatMessage({id:b.label,defaultMessage:b.defaultMessage})}})},[Ie,D]),ot=(0,r.useCallback)(function(b){var R=b.tabIndex,Z=b.showName,ne=Z===void 0?!0:Z,n=Ie.find(function(A){return A.key===R}),P=(0,r.useState)([]),j=S()(P,2),X=j[0],z=j[1],oe=(0,r.useState)(!0),O=S()(oe,2),ge=O[0],Ne=O[1],Oe=(0,r.useState)([]),re=S()(Oe,2),Se=re[0],St=re[1],Da=(0,r.useState)(20),Sa=S()(Da,1),pt=Sa[0],Ca=(0,r.useState)(500),Ct=S()(Ca,2),kt=Ct[0],jt=Ct[1],Te=(0,r.useRef)(null),yt=(0,r.useRef)(!1),ka=54;(0,r.useEffect)(function(){var A=function(){if(Te.current){var Q=Te.current.clientHeight;jt(Q)}},V=function(Q){jt(Q.detail.height)};return A(),Te.current&&Te.current.addEventListener("containerResize",V),window.addEventListener("resize",A),function(){Te.current&&Te.current.removeEventListener("containerResize",V),window.removeEventListener("resize",A)}},[]),(0,r.useEffect)(function(){return function(){yt.current=!1}},[n==null?void 0:n.tabKey]),(0,r.useEffect)(function(){var A=function(){var V=q()(H()().mark(function de(){var Q,Pe;return H()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!(yt.current&&!y.keyword&&y.tag.length===0)){G.next=2;break}return G.abrupt("return");case 2:if(Ne(!0),G.prev=3,n){G.next=6;break}return G.abrupt("return");case 6:return G.next=8,n.getData();case 8:Q=G.sent,Pe=(Q==null?void 0:Q.map(function(Ma,Ia){return p()(p()({},Ma),{},{id:"".concat(n.tabKey,"-").concat(Ia)})}))||[],z(Pe),St(Pe.slice(0,pt)),yt.current=!0,G.next=18;break;case 15:G.prev=15,G.t0=G.catch(3),console.error("Failed to fetch data:",G.t0);case 18:return G.prev=18,Ne(!1),G.finish(18);case 21:case"end":return G.stop()}},de,null,[[3,15,18,21]])}));return function(){return V.apply(this,arguments)}}();A()},[n,y,pt]);var ja=function(V){if(V.currentTarget.scrollHeight-V.currentTarget.scrollTop===kt){var de=Se.length;if(de<X.length){var Q=X.slice(de,de+pt);St(function(Pe){return[].concat(wt()(Pe),wt()(Q))})}}},Mt=(0,r.useCallback)(function(A){var V,de,Q;if(n){switch(console.log("Clicked item:",A),n.tabKey){case"tool":console.log("Tool ".concat((V=A.identity)===null||V===void 0||(V=V.label)===null||V===void 0?void 0:V[N]));break;case"workflow":console.log("Workflow ".concat((de=A.data)===null||de===void 0?void 0:de.title));break;case"agent":console.log("Agent ".concat((Q=A.data)===null||Q===void 0?void 0:Q.title));break;default:console.log("Clicked ".concat(n.tabKey," item:"),A)}g&&g(A,n.tabKey)}},[n,N,g]),It=(0,r.memo)(function(A){var V=A.data,de=A.index,Q=A.onDragStart,Pe=A.onItemClick,Nt=A.type,G=A.typeBadge;return(0,e.jsx)(aa,{typeBadge:G,list:[V],onDragStart:Q,type:Nt,onItemClick:Pe})});return n?(0,e.jsx)("div",{ref:Te,className:"overflow-y-auto h-full",children:(0,e.jsx)(_t.Z,{spinning:ge,children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:Se.map(function(A){return(0,e.jsx)(It,{data:A,index:Se.indexOf(A),onDragStart:We,onItemClick:Mt,type:n.type,typeBadge:y!=null&&y.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0},A.id)})}):(0,e.jsx)(Jt.Z,{data:Se,height:kt,itemHeight:ka,itemKey:"id",onScroll:ja,children:function(V){return(0,e.jsx)(It,{data:V,index:Se.indexOf(V),onDragStart:We,onItemClick:Mt,type:n.type,typeBadge:y!=null&&y.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[m,y,x,Ie,We,N,g]),Ge=(0,r.useCallback)((0,Gt.debounce)(function(b){ze(b)},500),[]),Le=(0,r.useCallback)(function(){_e.current={}},[]);(0,r.useEffect)(function(){Le()},[y.team,Le]);var ht=(0,r.useCallback)(function(b,R){"team"in b?ze(R):("tag"in b||"keyword"in b)&&Ge(R)},[Ge]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!a&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(lt.A,{submitter:!1,initialValues:y,onValuesChange:ht,children:[w&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[D.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Ft.Z.Group,{name:"team",fieldProps:{options:[{label:D.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:D.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Ut.Z,{fieldProps:{prefix:(0,e.jsx)(Ht.Z,{}),placeholder:D.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Kt.Z,{name:"tag",children:(0,e.jsx)(Bt.O,{className:"w-full",options:k,listStyle:x?"horizontal":"vertical",allowClear:!0,placeholder:D.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(R){}})})})]}),y!=null&&y.keyword?null:(0,e.jsx)(Vt.Z,{activeKey:m,items:Ve,onChange:function(R){$(R)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ie.map(function(b,R){return(0,e.jsxs)("div",{className:"space-y-2",children:[!a&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:D.formatMessage({id:b.label,defaultMessage:b.defaultMessage})}),(0,e.jsx)(ot,{tabIndex:R+1+"",showName:!x},b.key)]},b.key)})}):(0,e.jsx)(ot,{tabIndex:m,showName:!x})})]})}),oa=(0,r.memo)(function(o){var i=o.visibleTabs,d=o.defaultActiveTab,v=o.showTeamSwitch,w=v===void 0?!0:v,s=o.workflowName,x=o.workflowDesc,l=o.publishStatus,a=o.onWidthChange,g=o.onItemClick,D=(0,r.useState)(!1),N=S()(D,2),M=N[0],B=N[1],E=(0,r.useState)(!1),u=S()(E,2),m=u[0],$=u[1];return(0,e.jsx)(it.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:m?100:315,onChange:function(U,c){requestAnimationFrame(function(){B(U<100),a==null||a(U);var W=document.querySelectorAll(".overflow-y-auto");W.forEach(function(h){if(h instanceof HTMLElement){var I=h.clientHeight,L=new CustomEvent("containerResize",{detail:{height:I,width:U}});h.dispatchEvent(L)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(na,{visibleTabs:i,defaultActiveTab:d,showTeamSwitch:w,isMinWidth:M,isCollapsed:m,onItemClick:g}),(0,e.jsx)(At,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Lt,{name:s,description:x,publishStatus:l})})]})})}),ra=t(74842),ia=t(98165),sa=t(83456),la=t(58638),Ke=t(28036),da=t(83159),ua=t(27484),ca=t.n(ua),xt=t(70681),va=200,fa=80,ma={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ga=function(){var i=(0,te._K)(),d=i.getNodes,v=i.getEdges,w=i.setNodes,s=function(a){return{width:a.width||va,height:a.height||fa}},x=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",g=d(),D=v();if(g.length){var N=new xt.graphlib.Graph;N.setDefaultEdgeLabel(function(){return{}});var M=p()(p()({},ma),{},{rankdir:a});N.setGraph(M),g.forEach(function(E){var u=s(E),m=u.width,$=u.height;N.setNode(E.id,{width:m,height:$})}),D.forEach(function(E){N.setEdge(E.source,E.target)}),xt.layout(N);var B=g.map(function(E){var u=N.node(E.id);return p()(p()({},E),{},{position:{x:u.x-u.width/2,y:u.y-u.height/2}})});w(B)}};return{autoLayout:x}},ha=ga,pa=(0,r.memo)(function(){var o=(0,_.useIntl)(),i=(0,_.useSearchParams)(),d=S()(i,1),v=d[0],w=(0,f.Z)(function(h){return h.setWorkFlowInfo}),s=(0,f.Z)(function(h){return h.workFlowInfo}),x=(0,f.Z)(function(h){return h.setRunPanelShow}),l=v.get("type")=="true",a=(0,dt.Z)(),g=ha(),D=g.autoLayout,N=F.ZP.useMessage(),M=S()(N,2),B=M[0],E=M[1],u=(0,f.Z)(function(h){return h.loadingWorkflowData}),m=function(){var h=q()(H()().mark(function I(){var L;return H()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,a();case 2:L=v.get("app_id"),(0,J.aJ)(L).then(function(k){console.log(k),k.code==0&&(w(p()(p()({},s),{},{app:p()(p()({},s==null?void 0:s.app),{},{publish_status:"1"})})),B.open({type:"success",content:o.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return T.stop()}},I)}));return function(){return h.apply(this,arguments)}}(),$=function(){x(!0)},me=function(){var h=q()(H()().mark(function I(){var L,C;return H()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return L=v.get("app_id"),k.next=3,(0,J.Uq)(L);case 3:C=k.sent;case 4:case"end":return k.stop()}},I)}));return function(){return h.apply(this,arguments)}}(),U=function(){var h=q()(H()().mark(function I(){var L,C,T,k;return H()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:C=v.get("app_id"),T=(s==null||(L=s.app)===null||L===void 0?void 0:L.name)||"workflow",k=ca()().format("YYYY_MM_DD-HH_mm_ss"),(0,J.w8)(C,l==!0?1:0).then(function(je){var le=je,De=new Blob([le],{type:"text/yaml"}),ye=URL.createObjectURL(De),y=document.createElement("a");y.href=ye,y.download="".concat(T,"_").concat(k,".yml"),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(ye)});case 4:case"end":return ce.stop()}},I)}));return function(){return h.apply(this,arguments)}}(),c=function(I){D(I),B.open({type:"success",content:o.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},W=[{key:"TB",label:o.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:o.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}];return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!l&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Ke.ZP,{type:"primary",disabled:u,onClick:m,children:o.formatMessage({id:"workflow.release"})}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(ra.Z,{}),disabled:u,onClick:$,children:o.formatMessage({id:"workflow.run"})}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(ia.Z,{}),type:"dashed",disabled:u,onClick:a,children:o.formatMessage({id:"workflow.save"})}),(0,e.jsx)(da.Z,{menu:{items:W},placement:"bottomRight",children:(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(sa.Z,{}),type:"dashed",disabled:u,children:o.formatMessage({id:"workflow.autoLayout",defaultMessage:"Auto Layout"})})})]}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(la.Z,{}),type:"dashed",onClick:U,disabled:u,children:o.formatMessage({id:"workflow.export",defaultMessage:""})}),E]})}),Dt=t(64458),ya=function(){var i,d,v=(0,_.useIntl)(),w=(0,r.useRef)(null),s=(0,f.Z)(function(n){return n.resetNodes}),x=(0,f.Z)(function(n){return n.setNodeTypes}),l=(0,f.Z)(function(n){return n.addNode}),a=(0,f.Z)(function(n){return n.createNode}),g=(0,f.Z)(function(n){return n.setNodes}),D=(0,f.Z)(function(n){return n.setEdges}),N=(0,f.Z)(function(n){return n.setAppId}),M=(0,f.Z)(function(n){return n.setRunPanelShow}),B=(0,f.Z)(function(n){return n.runPanelShow}),E=(0,f.Z)(function(n){return n.getModelData}),u=(0,f.Z)(function(n){return n.setWorkFlowInfo}),m=(0,f.Z)(function(n){return n.setHandleList}),$=(0,f.Z)(function(n){return n.workFlowInfo}),me=(0,f.Z)(function(n){return n.setWorkflowEditInfo}),U=F.ZP.useMessage(),c=S()(U,2),W=c[0],h=c[1],I=(0,te._K)(),L=I.screenToFlowPosition,C=I.getNodes,T=I.setViewport,k=pe(L),se=k.onDnD,ce=(0,_.useSearchParams)(),je=S()(ce,1),le=je[0],De=le.get("type")=="true",ye=(0,f.Z)(function(n){return n.setLoadingWorkflowData}),y=(0,te.B)({includeHiddenNodes:!1}),ze=(0,we.Z)(),_e=(0,dt.Z)(),gt=(0,r.useState)(null),Me=S()(gt,2),We=Me[0],at=Me[1],nt=(0,r.useState)(!1),Ae=S()(nt,2),Ie=Ae[0],Ve=Ae[1],ot=(0,r.useState)(""),Ge=S()(ot,2),Le=Ge[0],ht=Ge[1],b=null;(0,te.CV)({onEnd:function(P){}}),(0,Ee.Z)(function(){x((0,ct.$P)()),s(),(0,$e.b6)(),R(),m([])}),fe(),(0,r.useEffect)(function(){if(We){_.history.push(Le);return}var n=_.history.block(function(P,j){if(B){ht(P.location.pathname),Ve(!0);return}});return B||n==null||n(),function(){n==null||n()}},[B,We]),(0,he.Z)(function(){if(y){var n=C(),P=n[n.length-1];P.data.drag&&(P.position={x:P.position.x-P.measured.width/2,y:P.position.y-P.measured.height/2},g(n))}},[y]),(0,r.useEffect)(function(){var n=se(function(P,j,X){var z;console.log(P,j,X);var oe=p()(p()({drag:!0},X.data),{},{baseData:X.baseData});if((z=X.baseData)!==null&&z!==void 0&&z.output){var O;oe.outputInfo=(O=X.baseData)===null||O===void 0?void 0:O.output}a(j,{position:P,data:oe})});return n},[se,l]),(0,he.Z)(function(){ze=="hidden"&&_e()},[ze]);var R=function(){var n=q()(H()().mark(function P(){var j;return H()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:j=le.get("app_id"),De&&W.open({type:"warning",content:v.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),ye(!0),N(j),(0,J.kE)(j,De?1:0).then(function(oe){if(oe.code==0){if(u(p()(p()({},oe.data),{},{isProd:De})),!oe.data.workflow.graph){ye(!1),a(K.vW.Start);return}var O=oe.data,ge=O.workflow.graph,Ne=ge.edges,Oe=ge.nodes,re=ge.views,Se=O.app;me({enable_api:!!Se.enable_api,is_public:!!Se.is_public}),re!=null&&re.nodes&&g(re.nodes),re!=null&&re.edges&&D(re.edges),re!=null&&re.viewPort,setTimeout(function(){ye(!1)},1e3)}}),E();case 6:case"end":return z.stop()}},P)}));return function(){return n.apply(this,arguments)}}(),Z=function(){at(!0),console.log(Le),_.history.push(Le),Ve(!1)},ne=function(){Ve(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[h,(0,e.jsx)(ue.Z,{title:v.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ie,onOk:Z,onCancel:ne,children:v.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:w,children:(0,e.jsxs)(ke,{children:[(0,e.jsx)(te.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(te.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(oa,{workflowName:$==null||(i=$.app)===null||i===void 0?void 0:i.name,workflowDesc:$==null||(d=$.app)===null||d===void 0?void 0:d.description,publishStatus:De}),(0,e.jsx)(pa,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Xe,{})]})},ba=(0,r.memo)(function(){return(0,e.jsx)(te.tV,{children:(0,e.jsx)(ya,{})})}),wa=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(ba,{})})},xa=wa}}]);
