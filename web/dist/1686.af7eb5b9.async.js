"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1686],{80459:function(yt,Ze,l){var Ue=l(32332),y=l(67294),We=l(85893),P=function(de){var m=de.width,Re=m===void 0?"40px":m,te=de.bg,Le=te===void 0?"#F4F8F1":te,se=de.rounded,Be=se===void 0?"6px":se,K=de.data,ne=de.imgWidth,pe=ne===void 0?"18px":ne,O=de.background;K!=null&&K.avatar&&(pe=Re);var Z=O||Le;return(0,We.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Re,height:Re,backgroundColor:Z,borderRadius:Be},children:(0,We.jsx)("img",{src:K!=null&&K.avatar?K.avatar:(0,Ue.s9)("single",K==null?void 0:K.icon),style:{width:pe,height:pe,borderRadius:Be},alt:""})})};Ze.Z=(0,y.memo)(P)},18304:function(yt,Ze,l){l.d(Ze,{F:function(){return qn}});var Ue=l(97857),y=l.n(Ue),We=l(5574),P=l.n(We),Oe=l(45360),de=l(55026),m=l(67294),Re=l(15009),te=l.n(Re),Le=l(19632),se=l.n(Le),Be=l(99289),K=l.n(Be),ne=l(9783),pe=l.n(ne),O=l(43722),Z=l(39e3),w=l(35312),ce=l(74330),re=l(41428),t=l(85893),lt=function(e){var n=e.roomid,r=(0,w.useIntl)(),a=(0,Z.Z)(function(g){return g.setSummaryClick}),s=(0,m.useState)(!0),o=P()(s,2),u=o[0],d=o[1],c=(0,Z.Z)(function(g){return g.summaryClick});(0,m.useEffect)(function(){d(c)},[c]);var v=(0,Z.Z)(function(g){return g.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(u?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){u&&(v({id:n}),a(!1))},children:[(0,t.jsx)(re.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:r.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},He=l(80459),Ve=l(45585),we=l(55060),xe=l(28036),ke=l(69753),Ee=l(97245),$e=l(77295),Je=function(e,n){try{var r=document.createElement("a");r.href=e,r.download=n,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(a){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",a)}},B=function(e){var n=e.fileList,r=e.onDownload,a=r===void 0?Je:r,s=e.className,o=s===void 0?"":s,u=e.showInGrid,d=u===void 0?!1:u,c=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(o),style:{maxHeight:c,overflow:c?"auto":"visible"},children:(0,t.jsx)(we.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(d?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(v,g){var f=v.path_show||v.url,C=(0,$e.CO)(v.name);return(0,t.jsx)("div",{className:"".concat(d?"":"mb-2"),children:C?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(we.Z,{src:f,alt:v.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(xe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(b){b.stopPropagation(),a(f,v.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Ee.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:v.name})]}),(0,t.jsx)(xe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(){return a(f,v.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(v.uid||v.file_id||g))})})})})},z=B,me=l(22683),_e=l(97807),fe=l(4958),he=l(13769),ye=l.n(he),et=function(){var i=K()(te()().mark(function e(n){return te()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){a.next=5;break}return a.next=4,navigator.clipboard.writeText(n);case 4:return a.abrupt("return",!0);case 5:return a.abrupt("return",ht(n));case 8:return a.prev=8,a.t0=a.catch(0),console.error("Failed to copy using Clipboard API:",a.t0),a.abrupt("return",ht(n));case 12:case"end":return a.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),ht=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var r=document.execCommand("copy");return document.body.removeChild(n),r}catch(a){return console.error("Fallback copy failed:",a),!1}},nt=l(52677),ae=l.n(nt),Fe=function(e,n){try{var r=document.createElement("a");r.href=e,r.download=n,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(a){}},ut=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):m.isValidElement(e)?i(e.props.children):""},tt=function(e){return ut(e)},Pe=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||ae()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var r=n.checkText,a=r===void 0?!0:r,s=n.checkFiles,o=s===void 0?!0:s,u=n.checkMCPTools,d=u===void 0?!0:u,c=n.checkStreaming,v=c===void 0?!0:c,g=n.minTextLength,f=g===void 0?1:g,C=function(){if(!a)return!1;try{var N=e.content;return N&&typeof N=="string"&&N.trim().length>=f}catch(E){return console.warn("Error checking text content:",E),!1}},_=function(){if(!o)return!1;try{var N=e.fileList||e.file_list;return N&&Array.isArray(N)&&N.length>0}catch(E){return console.warn("Error checking file content:",E),!1}},b=function(){if(!d)return!1;try{var N;if((N=e.parsedContent)!==null&&N!==void 0&&N.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var E=e.contentBlocks.some(function(D){return D&&D.type==="mcp"&&D.toolId});if(E)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(D){return console.warn("Error checking MCP content:",D),!1}},p=function(){if(!v)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(N){return N&&N.type==="text"&&N.content&&N.content.trim().length>=f}):!1}catch(N){return console.warn("Error checking streaming content:",N),!1}};return C()||_()||b()||p()}catch(j){return console.error("hasMessageContent unexpected error:",j),!0}},Ge=function(e){try{var n=(e==null?void 0:e.content)||"",r=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],a=(e==null?void 0:e.parsedContent)||{},s=(e==null?void 0:e.contentBlocks)||[],o=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(r)&&r.length>0,hasParsedMCP:!!a.hasMCPTools,hasContentBlocksMCP:s.some(function(u){return(u==null?void 0:u.type)==="mcp"}),hasActiveMCP:Array.isArray(o)&&o.length>0,hasStreamingText:s.some(function(u){var d;return(u==null?void 0:u.type)==="text"&&(u==null||(d=u.content)===null||d===void 0?void 0:d.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(r)?r.length:0,mcpToolCount:Array.isArray(o)?o.length:0,blockCount:Array.isArray(s)?s.length:0}}catch(u){return console.error("analyzeMessageContent error:",u),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},dt=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var r=e[0];return r.is_agent===1&&r.content!=""?r:null}catch(a){return console.error("checkLastAgentMessage error:",a),null}},ct=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var r;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(r=n.toolData)!==null&&r!==void 0&&r.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},gt=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},Ye=function(e,n){try{var r=y()(y()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),a=e.contentBlocks;if(!a&&e.parsedContent?a=ct(e.parsedContent):!a&&e.content&&(a=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&a){var s=gt(a);r.activeMCPTools=s}return r.contentBlocks=a||[],r}catch(o){return console.error("prepareHistoryMessageForCurrent error:",o),e}},ot=l(76637),xt=function(e){var n=e.code,r=e.index,a=(0,m.useState)(""),s=P()(a,2),o=s[0],u=s[1],d=(0,m.useState)(!0),c=P()(d,2),v=c[0],g=c[1],f=(0,m.useState)(null),C=P()(f,2),_=C[0],b=C[1],p=(0,m.useState)(!1),j=P()(p,2),N=j[0],E=j[1],D=(0,m.useState)(""),oe=P()(D,2),Te=oe[0],W=oe[1],J=(0,m.useMemo)(function(){var Y=n.split("").reduce(function(H,Me){return H=(H<<5)-H+Me.charCodeAt(0),H&H},0);return"mermaid-chart-".concat(r,"-").concat(Math.abs(Y))},[n,r]),Ce=(0,m.useMemo)(function(){return{startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:"Arial, sans-serif",fontSize:14}},[]),ue=(0,m.useCallback)(K()(te()().mark(function Y(){var H,Me;return te()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,g(!0),b(null),ot.Z.initialize(Ce),k.next=6,ot.Z.render(J,n);case 6:H=k.sent,Me=H.svg,u(Me),k.next=15;break;case 11:k.prev=11,k.t0=k.catch(0),console.error("Mermaid rendering error:",k.t0),b(k.t0.message||"Unknown error occurred");case 15:return k.prev=15,g(!1),k.finish(15);case 18:case"end":return k.stop()}},Y,null,[[0,11,15,18]])})),[n,J,Ce]);(0,m.useEffect)(function(){ue()},[ue]),(0,m.useEffect)(function(){if(!o){W("");return}var Y="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o));W(Y)},[o]);var Ke=(0,m.useMemo)(function(){return v?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading chart..."})}):_?(0,t.jsxs)("div",{className:"p-4 text-red-500 bg-red-50 border border-red-200 rounded",children:[(0,t.jsx)("p",{className:"font-medium",children:"\u56FE\u8868\u6E32\u67D3\u5931\u8D25"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:_})]}):o?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px]",dangerouslySetInnerHTML:{__html:o}}),(0,t.jsx)(xe.ZP,{type:"button","aria-label":"Open preview",title:"Open preview",tabIndex:0,onClick:function(){return E(!0)},onKeyDown:function(H){(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),E(!0))},className:"absolute top-2 right-2 z-10 rounded-md bg-white/90 hover:bg-white text-gray-700 shadow px-2 py-1 text-xs border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Preview"}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(we.Z,{style:{display:"none"},src:"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o)),width:"100%",className:"w-full",preview:{visible:N,mask:!1,scaleStep:.25,imageRender:function(H){return(0,t.jsx)("div",{className:"bg-white w-full h-full flex justify-center items-center",children:H})},onVisibleChange:function(H){return E(H)}}})})]}):null},[v,_,o,N]);return(0,t.jsx)("div",{className:"my-4 p-4 bg-white border border-gray-200 rounded-lg",children:Ke})},le=function(e,n){return e.code===n.code&&e.index===n.index},Ct=m.memo(xt,le),q=["node","className","children"],rt=["node"],At=["node","children"],kt=["node","children"],Zt=["node","children"],Wt=["node","children"],St=["node","children"],It=["node","children"],Xe=function(e){var n=e.code,r=e.index,a=e.isCurrentMessage;if(!a)return(0,t.jsx)(Ct,{code:n,index:r});var s=(0,m.useState)(!1),o=P()(s,2),u=o[0],d=o[1];return(0,m.useEffect)(function(){d(!1);var c=setTimeout(function(){return d(!0)},1e3);return function(){return clearTimeout(c)}},[n]),u?(0,t.jsx)(Ct,{code:n,index:r}):(0,t.jsx)("div",{className:"my-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading Mermaid chart..."})})})},Pt=function(e,n){return e.code===n.code&&e.index===n.index},Mt=(0,m.memo)(Xe,Pt),_t=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=function(o,u){try{var d=document.createElement("a");d.href=o,d.download=u,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(c){}};return{code:function(o){var u=o.node,d=o.className,c=o.children,v=ye()(o,q),g=/language-(\w+)/.exec(d||"");if(g!=null&&g.length){if(g[1]==="mermaid"){var f=tt(c);return(0,t.jsx)(Mt,{code:f,index:e,isCurrentMessage:r})}var C=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:g[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var _=K()(te()().mark(function b(p){var j,N;return te()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,j=p.currentTarget,D.next=4,et(tt(c));case 4:N=D.sent,N&&j?(j.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){j&&(j.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):j&&(j.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){j&&(j.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),D.next=11;break;case 8:D.prev=8,D.t0=D.catch(0),console.error("Failed to copy text: ",D.t0);case 11:case"end":return D.stop()}},b,null,[[0,8]])}));return function(b){return _.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(C).concat(e),className:"p-4",children:c})})]})}else return(0,t.jsx)("code",y()(y()({},v),{},{children:c}))},img:function(o){var u=o.node,d=ye()(o,rt);return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(we.Z,{src:d.src,alt:d.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(xe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(v){v.stopPropagation(),a(d.src||"",d.alt||"image.png")}})})]},d.src)},table:function(o){var u=o.node,d=o.children,c=ye()(o,At);return(0,t.jsx)("div",{className:"overflow-x-auto my-4 border border-gray-300 rounded-lg",children:(0,t.jsx)("table",y()(y()({className:"min-w-full"},c),{},{children:d}))})},thead:function(o){var u=o.node,d=o.children,c=ye()(o,kt);return(0,t.jsx)("thead",y()(y()({className:"bg-gray-50"},c),{},{children:d}))},tbody:function(o){var u=o.node,d=o.children,c=ye()(o,Zt);return(0,t.jsx)("tbody",y()(y()({className:"bg-white"},c),{},{children:d}))},tr:function(o){var u=o.node,d=o.children,c=ye()(o,Wt);return(0,t.jsx)("tr",y()(y()({className:"border-b border-gray-200 hover:bg-gray-50"},c),{},{children:d}))},th:function(o){var u=o.node,d=o.children,c=ye()(o,St);return(0,t.jsx)("th",y()(y()({className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},c),{},{children:d}))},td:function(o){var u=o.node,d=o.children,c=ye()(o,It);return(0,t.jsx)("td",y()(y()({className:"px-4 py-3 text-sm text-gray-900 border-r border-gray-200 last:border-r-0"},c),{},{children:d}))}}},Nt=l(61227),Tt=l.n(Nt),S=l(29608),ie=l(97175),Ne=l(4161),bt=l(49354),st=l(45699),mt=l(8751),at=l(79090),jt=l(66212),Ft=l(16596),Dt=l(11475),Ht=l(2830),qt=l(87547),Gt=l(71471),Kt=l(47221),Ot=l(66309),en=l(4393),U=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i.WAITING_FILE_UPLOAD="waiting_file_upload",i}({}),zt=function(e,n){if(e){if(e.status==="waiting_confirm")return U.WAITING_CONFIRMATION;if(n===null)return U.RUNNING}if(n!==null){if(typeof n=="string")try{var r=JSON.parse(n);if(r.status==="failed")return U.FAILED}catch(a){}else if(ae()(n)==="object"&&n.status==="failed")return U.FAILED;return U.COMPLETED}return U.PENDING},Vt=(0,m.createContext)(void 0),tn=function(e){var n=e.children,r=e.agentChatRoomId,a=(0,m.useRef)(null),s=(0,m.useRef)(null),o=(0,m.useState)(!1),u=P()(o,2),d=u[0],c=u[1],v=(0,m.useState)([]),g=P()(v,2),f=g[0],C=g[1],_=(0,w.useParams)(),b=_.id,p=(0,w.useLocation)(),j=new URLSearchParams(p.search),N=j.get("id"),E=r||b||N,D={scrollDomRef:a,upButtonDom:s,isStop:d,setIsStop:c,instruction:f,setInstruction:C,id:E};return(0,t.jsx)(Vt.Provider,{value:D,children:n})},ft=function(){var e=(0,m.useContext)(Vt);if(e===void 0)throw new Error("useChatRoomContext must be used within a ChatRoomProvider");return e},nn=function(e){var n,r=e.fileConfig,a=e.value,s=e.onChange,o=(0,$e.ZP)({maxSizeMB:r.maxSize||10,acceptedFileTypes:((n=r.accepted_types)===null||n===void 0?void 0:n.join(","))||void 0,multiple:!1}),u=o.uploadedFiles,d=o.handleUpload,c=o.removeFile,v=o.clearFiles,g=o.isUploading,f=(0,w.useIntl)();return(0,m.useEffect)(function(){if(u.length>0){var C=u[u.length-1],_={file_name:C.name,file_path:C.path_show,size:0,type:"",id:C.file_id,status:"done"};s(_)}else s(null)},[u]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[r.name,r.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),r.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:r.description}),r.accepted_types&&r.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",r.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:u.length===0?(0,t.jsx)(xe.ZP,{type:"dashed",onClick:d,loading:g,disabled:g,className:"w-48",children:g?f.formatMessage({id:"app.chatroom.mcptool.uploading"}):f.formatMessage({id:"app.chatroom.mcptool.uploadFile"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:u[u.length-1].name}),(0,t.jsx)(xe.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return c(u[u.length-1].uid)},disabled:g,children:f.formatMessage({id:"app.chatroom.mcptool.remove"})})]})})]})},rn=nn,an=function(e){var n=e.toolData,r=e.onFileUploadComplete,a=e.onFileUploadError,s=n.files_to_upload||[],o=(0,m.useState)({}),u=P()(o,2),d=u[0],c=u[1],v=(0,w.useIntl)(),g=s.every(function(b){return b.required===!1||d[b.variable_name]&&d[b.variable_name].status==="done"}),f=function(p,j){c(function(N){var E=y()({},N);return j?E[p]=j:delete E[p],E})},C=function(){return s.map(function(p){var j=d[p.variable_name];return y()(y()({},p),j)})},_=function(){if(!g){Oe.ZP.warning(v.formatMessage({id:"app.chatroom.mcptool.pleaseUploadAllRequiredFiles"}));return}var p=C();r(p)};return(0,m.useEffect)(function(){},[g,d,r]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-blue-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:v.formatMessage({id:"app.chatroom.mcptool.requiredFiles"})})}),s.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:v.formatMessage({id:"app.chatroom.mcptool.noFilesRequired"})}),s.map(function(b){return(0,t.jsx)(rn,{fileConfig:b,value:d[b.variable_name],onChange:function(j){return f(b.variable_name,j)}},b.variable_name)}),(0,t.jsx)(xe.ZP,{type:"primary",className:"mt-2 w-full",disabled:!g,onClick:_,children:v.formatMessage({id:"app.chatroom.mcptool.completeUpload"})})]})},on=an,Qe=Gt.Z.Text,er=Gt.Z.Paragraph,Lt=Kt.Z.Panel,sn=function(e){var n=e.toLowerCase().split(".").pop(),r="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)(ie.Z,{className:"text-green-600 ".concat(r)});case"doc":case"docx":return(0,t.jsx)(Ne.Z,{className:"text-blue-600 ".concat(r)});case"pdf":return(0,t.jsx)(bt.Z,{className:"text-red-600 ".concat(r)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(st.Z,{className:"text-purple-600 ".concat(r)});default:return(0,t.jsx)(Ee.Z,{className:"text-gray-600 ".concat(r)})}},$t=function(e){var n=e.fileList,r=e.intl,a=function(o,u){try{var d=document.createElement("a");d.href=o,d.download=u,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(c){console.error("Download file failed",c)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(s,o){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[s.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700",children:[s.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:sn(s.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:s.file_name})})]}),(0,t.jsx)(xe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(){return a(s.file_path,s.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:r.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},o)})})},ln=function(e){var n=e.status;switch(n){case U.COMPLETED:return(0,t.jsx)(mt.Z,{className:"text-green-500"});case U.RUNNING:return(0,t.jsx)(at.Z,{className:"text-blue-500"});case U.WAITING_CONFIRMATION:return(0,t.jsx)(jt.Z,{className:"text-orange-500"});case U.WAITING_FILE_UPLOAD:return(0,t.jsx)(Ft.Z,{className:"text-purple-500"});case U.FAILED:return(0,t.jsx)(Dt.Z,{className:"text-red-500"});default:return(0,t.jsx)(jt.Z,{className:"text-gray-500"})}},un=function(e){var n=e.status,r=e.intl,a=function(u){switch(u){case U.COMPLETED:return{color:"success",text:r.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case U.RUNNING:return{color:"processing",text:r.formatMessage({id:"app.chatroom.mcptool.status.running"})};case U.WAITING_CONFIRMATION:return{color:"warning",text:r.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case U.WAITING_FILE_UPLOAD:return{color:"purple",text:r.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case U.FAILED:return{color:"error",text:r.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:r.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},s=a(n);return(0,t.jsx)(Ot.Z,{color:s.color,children:s.text})},wt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(r){return e}try{return JSON.stringify(e,null,2)}catch(r){return String(e)}},dn=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},cn=function(e){if(!e||ae()(e)!=="object")return{specialFields:{},regularFields:e};var n={},r={};return Object.keys(e).forEach(function(a){a==="input_variables"?n[a]=e[a]:r[a]=e[a]}),{specialFields:n,regularFields:r}},mn=function(e){var n=e.inputVariables,r=e.intl;return!n||ae()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-blue-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(a){var s=P()(a,2),o=s[0],u=s[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[o,":"]}),(0,t.jsx)(Qe,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof u=="string"?u:JSON.stringify(u)})]},o)})})]})},fn=function(e){var n=e.args,r=e.intl;try{var a=cn(n),s=a.specialFields,o=a.regularFields,u=s.input_variables&&Object.keys(s.input_variables).length>0,d=o&&Object.keys(o).length>0;return!u&&!d?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:r.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[u&&(0,t.jsx)(mn,{inputVariables:s.input_variables,intl:r}),d&&(0,t.jsxs)("div",{children:[u&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-gray-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(o)})})]})]})}catch(c){return console.warn("Failed to parse parameters for enhanced display:",c),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(n)})})}},vn=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(r){return[]}return n&&ae()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(r){return console.warn("Failed to extract file list from result data:",r),[]}},pn=function(e){var n=e.resultData,r=e.intl,a=e.status,s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(c){s=n}var o=s&&ae()(s)==="object"&&s.status==="success"&&s.outputs&&ae()(s.outputs)==="object";if(o){var u=s.outputs,d=Object.keys(u).length>0;return d?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-green-600 text-sm",children:r.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(u).map(function(c){var v=P()(c,2),g=v[0],f=v[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700",children:[g,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof f=="string"?(0,t.jsx)(me.U,{rehypePlugins:[_e.Z],components:_t(0,r),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:f}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:wt(f)})})]},g)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:r.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(a===U.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(n)})})},Ut=function(e){var n=e.toolData,r=e.intl,a=e.runtimeData,s=e.updateMCPTool,o=ft(),u=o.setInstruction,d=(a==null?void 0:a.status)||zt(n.workflow_confirmation_status,n.result),c=dn(n.name,r),v=(a==null?void 0:a.workflow_confirmation)||n.workflow_confirmation_status,g=(0,S.Z)(function(W){return W.setDealtWithData}),f=(a==null?void 0:a.result)||n.result,C=null;if(typeof f=="string")try{var _=JSON.parse(f);_.status==="failed"&&(C=_.message)}catch(W){}else ae()(f)==="object"&&(f==null?void 0:f.status)==="failed"&&(C=f.message);var b=function(){g(y()(y()({},v),{},{exec_id:v.node_exec_id}))},p=function W(J,Ce){if(u){if(J.length===0){Ce&&Ce();return}var ue=Tt()(J),Ke=ue[0],Y=ue.slice(1);u(Ke),setTimeout(function(){W(Y,Ce)},100)}},j=function(J){if(!s){console.warn("updateMCPTool function not available");return}try{if(s(n.id,{uploaded_files:J,status:U.RUNNING}),u){var Ce=[["MCPTOOLFILES",{id:n.id,files_to_upload:J}]];p(Ce)}debugger}catch(ue){console.error("Error handling file upload completion:",ue),Oe.ZP.error("Failed to process file upload completion")}},N=function(J){console.error("File upload error:",J),Oe.ZP.error(J),s&&s(n.id,{status:U.FAILED,error:J})},E=vn(f),D=E&&Array.isArray(E)&&E.length>0,oe=((a==null?void 0:a.uploaded_files)||[]).map(function(W){return{file_name:W.file_name||W.name,file_path:W.file_path||"",variable_name:W.variable_name}}),Te=oe&&Array.isArray(oe)&&oe.length>0;return(0,t.jsxs)(en.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Ht.Z,{className:"text-blue-500"}),(0,t.jsx)(Qe,{strong:!0,className:"text-sm",children:(a==null?void 0:a.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(Ot.Z,{color:"blue",children:c}),(0,t.jsx)(ln,{status:d}),(0,t.jsx)(un,{status:d,intl:r})]}),v&&d!==U.COMPLETED&&d!==U.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(qt.Z,{className:"text-orange-500"}),(0,t.jsxs)(Qe,{className:"text-sm font-medium",children:[r.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(a==null?void 0:a.skill_or_workflow_name)||n.skill_or_workflow_name]}),v.confirmer_name&&(0,t.jsxs)(Qe,{className:"text-xs text-gray-600",children:[r.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",v.confirmer_name]})]}),v.show_todo_button&&(0,t.jsx)(xe.ZP,{size:"small",type:"primary",onClick:b,children:r.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),C&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(Qe,{type:"danger",className:"text-xs",children:[r.formatMessage({id:"app.chatroom.mcptool.error"}),": ",C]})}),(a==null?void 0:a.status)===U.WAITING_FILE_UPLOAD&&(0,t.jsx)(on,{toolData:a,onFileUploadComplete:j,onFileUploadError:N}),(0,t.jsxs)(Kt.Z,{size:"small",ghost:!0,children:[((a==null?void 0:a.args)||n.args)&&Object.keys((a==null?void 0:a.args)||n.args).length>0&&(0,t.jsxs)(Lt,{header:r.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(fn,{args:(a==null?void 0:a.args)||n.args,intl:r}),Te&&(0,t.jsx)($t,{fileList:oe,intl:r})]},"params"),f&&(0,t.jsx)(Lt,{header:r.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(pn,{resultData:f,intl:r,status:d})},"result"),D&&(0,t.jsx)(Lt,{header:r.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)($t,{fileList:E,intl:r})},"files")]})]})},Rt="<<<mcp-tool-start>>>",Et="<<<mcp-tool-end>>>",tr=function(e){var n,r=e.files_to_upload&&Array.isArray(e.files_to_upload)&&e.files_to_upload.length>0,a=((n=e.args)===null||n===void 0?void 0:n.input_variables)&&Object.values(e.args.input_variables).some(function(s){return s==="need_upload"});return(r||a)&&!e.result?MCPToolStatus.WAITING_FILE_UPLOAD:getMCPToolStatus(e.workflow_confirmation_status,e.result)},hn=function(e){return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.map(function(n){return{name:n.name||"",variable_name:n.variable_name||"",id:n.id||0,file_name:n.file_name||null,file_path:n.file_path||null,required:!0,accept:void 0,maxSize:void 0,description:void 0,accepted_types:void 0}})},gn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],r=0;;){var a=e.indexOf(Rt,r);if(a===-1)break;var s=e.indexOf(Et,a);if(s===-1)break;var o=a+Rt.length,u=e.substring(o,s).trim();try{var d=JSON.parse(u),c=hn(d),v={id:d.id,name:d.name||"",skill_or_workflow_name:d.skill_or_workflow_name||"",workflow_run_id:d.workflow_run_id||0,workflow_confirmation_status:d.workflow_confirmation_status||null,args:d.args||{},result:d.result||null,files_to_upload:c};c.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(v.id,":"),c),n.push({toolData:v,startIndex:a,endIndex:s+Et.length})}catch(g){console.error("Failed to parse MCP tool JSON:",g)}r=s+Et.length}return n},xn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=gn(e);if(n.length===0)return[{type:"text",content:e}];var r=[],a=0;if(n.forEach(function(o){if(o.startIndex>a){var u=e.substring(a,o.startIndex).trim();u&&r.push({type:"text",content:u})}r.push({type:"mcp-tool",content:e.substring(o.startIndex,o.endIndex),toolData:o.toolData}),a=o.endIndex}),a<e.length){var s=e.substring(a).trim();s&&r.push({type:"text",content:s})}return r},Ae=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=xn(e),r=n.some(function(a){return a.type==="mcp-tool"});return{blocks:n,hasMCPTools:r}},nr=function(e,n,r){var a=_objectSpread({},e);a.mcpTools||(a.mcpTools=[]);var s=a.mcpTools.findIndex(function(o){return o.id===n});return s>=0?a.mcpTools[s]=_objectSpread(_objectSpread({},a.mcpTools[s]),r):a.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},r)),a},rr=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(r){return r.id===n})||null},ar=function(e,n){var r=_objectSpread({},e);return r.mcpTools&&Array.isArray(r.mcpTools)&&(r.mcpTools=r.mcpTools.filter(function(a){return a.id!==n})),r},or=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,r){return String(n.id).localeCompare(String(r.id))})},_n=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload},r=JSON.stringify(n,null,0);return"".concat(Rt).concat(r).concat(Et)}catch(a){return console.error("Failed to serialize MCP tool:",a),""}},yn=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(n){return!n||ae()(n)!=="object"?(console.warn("Invalid file object in files_to_upload:",n),!1):n.file_path&&typeof n.file_path=="string"&&n.file_path.trim()!==""&&(n.file_path.startsWith("http")||n.file_path.startsWith("/"))})}catch(n){return console.error("Error inferring uploaded files:",n),[]}},Bt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var r="";return e.forEach(function(a){if(a.type==="text")r+=a.content||"";else if(a.type==="mcp"&&a.toolId){var s=n(a.toolId);if(s){var o=_n(s);r+=o}else console.warn("MCP tool ".concat(a.toolId," not found in runtime data"))}}),r}catch(a){return console.error("Failed to reconstruct content with updated MCP tools:",a),""}},Cn=l(27484),Mn=l.n(Cn),Jt=function(e){var n,r=e.content,a=e.fileList,s=e.index,o=e.intl,u=e.isAgent,d=e.contentId,c=e.isCurrentMessage,v=e.mcpTools,g=e.updateMCPTool,f=e.getMCPTool,C=e.item,_=e.contentBlocks,b=(C==null?void 0:C.parsedContent)||Ae(r);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:u?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:d,children:[a&&a.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(z,{fileList:a,onDownload:Fe})}),_&&_.length>0?(0,t.jsx)("div",{children:_.map(function(p,j){var N,E,D,oe,Te,W;return(0,t.jsx)("div",{children:p.type==="text"?p.content&&(0,t.jsx)(me.U,{remarkPlugins:[fe.Z],rehypePlugins:[_e.Z],components:_t(s,o,c),children:p.content}):p.toolId&&f&&(0,t.jsx)(Ut,{toolData:{id:p.toolId,name:((N=f(p.toolId))===null||N===void 0?void 0:N.name)||"",skill_or_workflow_name:((E=f(p.toolId))===null||E===void 0?void 0:E.skill_or_workflow_name)||"",workflow_run_id:(D=f(p.toolId))===null||D===void 0?void 0:D.workflow_run_id,workflow_confirmation_status:(oe=f(p.toolId))===null||oe===void 0?void 0:oe.workflow_confirmation_status,args:((Te=f(p.toolId))===null||Te===void 0?void 0:Te.args)||{},result:(W=f(p.toolId))===null||W===void 0?void 0:W.result},intl:o,runtimeData:f(p.toolId),updateMCPTool:g})},"content-block-".concat(j))})}):b.hasMCPTools?(0,t.jsx)("div",{children:b.blocks.map(function(p,j){return(0,t.jsx)("div",{children:p.type==="text"?(0,t.jsx)(me.U,{remarkPlugins:[fe.Z],rehypePlugins:[_e.Z],components:_t(s,o),children:p.content}):p.toolData&&(0,t.jsx)(Ut,{toolData:p.toolData,intl:o,runtimeData:f?f(p.toolData.id):null,updateMCPTool:g})},j)})}):(0,t.jsx)(me.U,{remarkPlugins:[fe.Z],rehypePlugins:[_e.Z],components:_t(s,o),children:r}),e.isCurrentMessage&&!_&&(C==null||(n=C.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:C.activeMCPTools.map(function(p){return f?f(p):null}).filter(Boolean).map(function(p){return(0,t.jsx)(Ut,{toolData:{name:p.name,skill_or_workflow_name:p.skill_or_workflow_name,workflow_run_id:p.workflow_run_id,workflow_confirmation_status:p.workflow_confirmation_status,args:p.args,result:p.result,id:p.id},intl:o,runtimeData:p,updateMCPTool:g},"current-tool-".concat(p.id))})}),C.created_time&&C.is_agent==1&&(0,t.jsx)("div",{className:"text-xs text-gray-300  text-right -mr-2 mb-1",children:Mn()(C.created_time).format("YYYY-MM-DD HH:mm:ss")})]})},bn=(0,m.memo)(function(i){var e=i.messageApi,n=i.index,r=i.idName,a=i.cidName,s=(0,w.useIntl)(),o=(0,m.useState)(!1),u=P()(o,2),d=u[0],c=u[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var v=K()(te()().mark(function g(f){var C,_,b;return te()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return C=f.target.closest("#".concat(r).concat(n)),_=C.querySelector("#".concat(a).concat(n)),j.prev=2,j.next=5,et(_.innerText);case 5:b=j.sent,b?e.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),j.next=13;break;case 9:j.prev=9,j.t0=j.catch(2),console.error("Failed to copy text: ",j.t0),e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return j.stop()}},g,null,[[2,9]])}));return function(g){return v.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(d?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(d?" text-[#1B64F3]":"text-[#666]"),children:s.formatMessage({id:"app.chatroom.content.copy"})})]})})}),jn=l(2068),In=function(e){var n=e.id,r=e.index,a=e.idName,s=e.cidName,o=(0,w.useIntl)(),u=(0,Z.Z)(function(_){return _.setSummaryClick}),d=(0,m.useState)(!0),c=P()(d,2),v=c[0],g=c[1],f=(0,Z.Z)(function(_){return _.summaryClick});(0,m.useEffect)(function(){g(f)},[f]);var C=(0,Z.Z)(function(_){return _.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(v?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(b){if(v){var p=b.target.closest("#".concat(a).concat(r)),j=p.querySelector("#".concat(s).concat(r));C({id:n,message:j.innerText}),u(!1)}},children:[(0,t.jsx)(jn.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:o.formatMessage({id:"app.chatroom.content.summary"})})]})})},Pn=function(e){var n=e.messageApi,r=e.index,a=e.idName,s=e.cidName,o=e.id,u=e.agentChatRoomId,d=e.isAgent;return d?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(bn,{messageApi:n,index:r,idName:a,cidName:s}),!u&&(0,t.jsx)(In,{id:o,index:r,idName:a,cidName:s})]}):null},Yt=function(e){var n,r=e.item,a=e.index,s=e.agentChatRoomId,o=e.abilitiesList,u=e.messageApi,d=e.id,c=e.idName,v=e.cidName,g=e.mcpTools,f=e.updateMCPTool,C=e.getMCPTool,_=(0,w.useIntl)(),b=r.is_agent===1,p=(0,Ve.Pc)(),j=p.userInfo;return Pe(r)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(b?"":"flex-row-reverse"),children:[b?(0,t.jsx)(He.Z,{data:r}):(0,t.jsx)(He.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(s?"":"max-w-[560px]"," text-right"),id:"".concat(c).concat(a),children:[(0,t.jsxs)("div",{className:"".concat(b?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[r.name?r.name:(j==null?void 0:j.nickname)||"",r.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(o==null||(n=o.find(function(N){return r.ability_id==N.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(b?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Jt,{content:r.content,fileList:r.file_list,index:a,intl:_,isAgent:b,contentId:"".concat(v).concat(a),mcpTools:g,updateMCPTool:f,getMCPTool:C,item:r})}),(0,t.jsx)(Pn,{messageApi:u,index:a,idName:c,cidName:v,id:d,agentChatRoomId:s,isAgent:b})]})]}):null},Nn=l(47635),Tn=function(e,n,r,a,s,o,u,d,c,v,g,f,C,_,b,p,j){var N=(0,w.useIntl)(),E=(0,Z.Z)(function(G){return G.setTruncatable}),D=function(h){try{var x=JSON.parse(h.slice(22,-2));return Array.isArray(x)&&x.length>=2?[x[0],x[1]]:null}catch(M){return console.warn("Failed to parse instruction:",M),null}},oe=function(h){return h.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},Te=function(h){return!h||!h.input_variables?!1:Object.values(h.input_variables).some(function(x){return x==="need_upload"})},W=function(h){c(function(x){var M=x.contentBlocks||[],I=h(M);return y()(y()({},x),{},{contentBlocks:I})})},J=function(h){W(function(x){var M=x[x.length-1];return M&&M.type==="text"?x.map(function(I,T){return T===x.length-1?y()(y()({},I),{},{content:(I.content||"")+h}):I}):[].concat(se()(x),[{type:"text",content:h,timestamp:Date.now()}])})},Ce=function(h){W(function(x){return[].concat(se()(x),[{type:"mcp",toolId:h,timestamp:Date.now()}])})},ue=function(h){return!(h!=null&&h.blocks)||!Array.isArray(h.blocks)?[]:h.blocks.map(function(x){var M;return x.type==="text"?{type:"text",content:x.content||"",timestamp:Date.now()}:x.type==="mcp-tool"&&(M=x.toolData)!==null&&M!==void 0&&M.id?{type:"mcp",toolId:x.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},Ke=function(h){return h.filter(function(x){return x.type==="mcp"&&x.toolId}).map(function(x){return x.toolId})},Y=function(h,x){C&&C(h,x),f.current&&Object.keys(v).length>0&&c(function(M){var I=M.activeMCPTools||[],T=I.includes(h)?I:[].concat(se()(I),[h]);return y()(y()({},M),{},{activeMCPTools:T})})},H=function(h,x,M){try{if(!h||!Array.isArray(h))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!M)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),h;var I=h.filter(function($){return $.type==="mcp"&&$.toolId}).map(function($){return $.toolId}),T=x.filter(function($){return!I.includes($)}),V=T.map(function($){return{type:"mcp",toolId:$,timestamp:Date.now()}});return[].concat(se()(h),se()(V))}catch($){return console.error("Failed to sync MCP tool states to contentBlocks:",$),h}},Me={ERROR:function(h){e(!1),n(!1),r(""),a.open({type:"error",content:"webSocket-".concat(h),duration:10})},CHAT:function(h){if(Object.keys(v).length&&Pe(v,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var x,M,I=y()({},v);if(((x=I.activeMCPTools)===null||x===void 0?void 0:x.length)>0||((M=I.contentBlocks)===null||M===void 0?void 0:M.length)>0){var T=H(I.contentBlocks||[],I.activeMCPTools||[],p);if(p&&T.length>0){var V=Bt(T,p);V?(I.content=V,I.parsedContent=Ae(V)):I.content&&(I.parsedContent=Ae(I.content))}else I.content&&(I.parsedContent=Ae(I.content));I.contentBlocks=T}else I.content&&(I.parsedContent=Ae(I.content));s(function(je){return je.concat(I)}),c({})}var $={content:"".concat(h),is_agent:0};s(function(je){return je.concat($)}),b&&b(!0),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),u.current&&(u.current.style.display="none")})},WITHFILELIST:function(h){s(function(x){if(x.length===0)return x;var M=x.length-1;return x.map(function(I,T){return T===M?y()(y()({},I),{},{file_list:h}):I})}),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),u.current&&(u.current.style.display="none")})},STOPPABLE:function(h){n(h)},TRUNCATABLE:function(h){E(h),h||a.open({type:"success",content:"".concat(N.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(h){a.open({type:"success",content:"".concat(N.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(h){var x=h.id,M=h.name,I=h.skill_or_workflow_name,T=h.args,V=h.files_to_upload,$=I&&I.toLowerCase().includes("workflow"),je=V&&Array.isArray(V)&&V.length>0,qe=je||Te(T),Ie=qe?U.WAITING_FILE_UPLOAD:U.RUNNING;Y(x,{name:M,skill_or_workflow_name:I||M,args:T,status:Ie,isWorkflow:$,files_to_upload:V||[],uploaded_files:[]}),b&&b(!1),Ce(x)},WITHMCPTOOLRESULT:function(h){var x=h.id,M=h.result,I=U.COMPLETED;if(typeof M=="string")try{var T=JSON.parse(M);T.status==="failed"&&(I=U.FAILED)}catch(V){}else ae()(M)==="object"&&(M==null?void 0:M.status)==="failed"&&(I=U.FAILED);Y(x,{result:M,status:I})},WITHWFSTATUS:function(h){var x=h.id,M=h.status,I={id:M.id,status:M.status,app_run_id:M.app_run_id,node_exec_id:M.node_exec_id,workflow_name:M.workflow_name,need_user_confirm:M.need_user_confirm,show_todo_button:M.show_todo_button,confirmer_name:M.confirmer_name},T;switch(M.status){case"running":T=U.RUNNING;break;case"waiting_confirm":T=U.WAITING_CONFIRMATION;break;case"completed":T=U.COMPLETED;break;case"failed":T=U.FAILED;break;default:T=U.RUNNING;break}b&&b(!1),Y(x,{workflow_confirmation:I,status:T,isWorkflow:!0})},WITHMCPTOOLFILES:function(h){var x=h.id,M=h.files_to_upload,I=h.args;Y(x,y()({uploaded_files:M||[],status:U.COMPLETED},I?{args:I}:{}))}},be=function(h,x){Me[h]=x},k=function(h){var x=h.data,M=D(x),I=oe(x),T=x.indexOf("REPLY")!==-1&&x.indexOf("ENDREPLY")===-1,V=x.indexOf("ABILITY")!==-1,$=x.indexOf("ENDCHAT")!==-1;if(I){if(!M)return;var je=M[0],qe=M[1],Ie=Me[je];Ie?Ie(qe):console.warn("Unknown message type: ".concat(je))}if(I||console.log(f.current,h),!I&&f.current&&(g.current+=x,b&&b(!1),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),u.current&&(u.current.style.display="none")}),c(function(ee){var ge=g.current,Se=y()(y()({},ee),{},{content:ge});return ge&&(Se.parsedContent=Ae(ge)),Se}),J(x)),T&&I){var X=M[1],L=d.current.filter(function(ee){return ee.agent_id==X})[0];s(function(ee){var ge=ee;if(Object.keys(v).length&&Pe(v,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var Se,it,F=y()({},v);if(((Se=F.activeMCPTools)===null||Se===void 0?void 0:Se.length)>0||((it=F.contentBlocks)===null||it===void 0?void 0:it.length)>0){var vt=H(F.contentBlocks||[],F.activeMCPTools||[],p);if(p&&vt.length>0){var pt=Bt(vt,p);pt?(F.content=pt,F.parsedContent=Ae(pt)):F.content&&(F.parsedContent=Ae(F.content))}else F.content&&(F.parsedContent=Ae(F.content));F.contentBlocks=vt}else F.content&&(F.parsedContent=Ae(F.content));ge=ee.concat(F)}return g.current="",c({is_agent:1,icon:L==null?void 0:L.icon,name:L==null?void 0:L.name,content:"",activeMCPTools:[],agent_id:X,parsedContent:null,contentBlocks:[]}),f.current=!0,n(!0),E(!1),ge})}if(V&&I){var ve=M[1];c(function(ee){return y()(y()({},ee),{},{is_agent:1,ability_id:ve})})}if($){if(f.current=!1,g.current="",e(!1),n(!1),E(!0),Object.keys(v).length){var ze,De,A=y()({},v);if(((ze=A.activeMCPTools)===null||ze===void 0?void 0:ze.length)>0||((De=A.contentBlocks)===null||De===void 0?void 0:De.length)>0){var R=H(A.contentBlocks||[],A.activeMCPTools||[],p);if(p&&R.length>0){var Q=Bt(R,p);Q?(A.content=Q,A.parsedContent=Ae(Q)):A.content&&(A.parsedContent=Ae(A.content))}else A.content&&(A.parsedContent=Ae(A.content));A.contentBlocks=R}else A.content&&(A.parsedContent=Ae(A.content));console.log(A),s(function(ee){return ee.concat(A)})}c({}),r("")}};return{getSocketMessage:k,addMessageHandler:be}},wn=function(e){var n=e.currentMessage,r=e.agentChatRoomId,a=e.intl,s=e.mcpTools,o=s===void 0?{}:s,u=e.updateMCPTool,d=u===void 0?function(){}:u,c=e.getMCPTool,v=c===void 0?function(){return null}:c,g=ft(),f=g.setInstruction,C=(0,Ve.Pc)(),_=C.userInfo;return!n.name||!Pe(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(He.Z,{data:n}):(0,t.jsx)(He.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(r?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(_==null?void 0:_.nickname)||""}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Jt,{content:n.content||"",fileList:n.file_list,index:-1,intl:a,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:o,updateMCPTool:d,getMCPTool:v,item:y()(y()({},n),{},{parsedContent:Ae(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},En=(0,m.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,r=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,u=i.setIsStop,d=i.setisEnd,c=i.setSendValue,v=i.agentChatRoomId,g=i.updateMCPTool,f=i.getCurrentMessageList,C=i.mcpTools,_=C===void 0?{}:C,b=i.getMCPTool,p=b===void 0?function(){return null}:b,j=i.setIsWaitingReply,N=i.removeHistoryMessage,E=i.setCurrentMessageFromHistory,D=ft(),oe=D.setInstruction,Te=(0,w.useIntl)(),W=(0,w.useParams)(),J=W.id,Ce=(0,w.useLocation)(),ue=new URLSearchParams(Ce.search),Ke=ue.get("id"),Y=v||J||Ke,H=(0,Z.Z)(function(Ie){return Ie.setDisableInput}),Me=(0,m.useState)({}),be=P()(Me,2),k=be[0],G=be[1],h=(0,m.useRef)(!1),x=(0,m.useRef)(""),M=(0,m.useCallback)(function(Ie){try{if(!Ie||ae()(Ie)!=="object"){console.warn("Invalid history message provided:",Ie);return}if(Ie.is_agent!==1){console.warn("Attempted to set non-agent message as current:",Ie);return}var X=Ye(Ie,p);if(!X){console.warn("Failed to prepare history message:",Ie);return}G(X),h.current=!0,x.current=X.content||""}catch(L){console.error("Failed to set current message from history:",L)}},[p]);(0,m.useEffect)(function(){E&&E(M)},[E,M]);var I=Tn(H,u,c,e,n,s,o,a,G,k,x,h,g,f,j,p,N),T=I.getSocketMessage,V=(0,Nn.Z)("chat",T),$=V.runSocket,je=V.sendMessage,qe=V.readyState;return(0,m.useEffect)(function(){qe==1&&Y&&je(JSON.stringify(["ENTER",parseInt(Y)]))},[qe]),(0,m.useEffect)(function(){r&&qe==1&&je(r)},[r]),(0,m.useEffect)(function(){$()},[]),(0,t.jsx)(wn,{currentMessage:k,agentChatRoomId:v,intl:Te,mcpTools:_,updateMCPTool:g,getMCPTool:p})}),An=function(e){var n=e.type,r=n===void 0?"typing":n,a=e.size,s=a===void 0?"medium":a;if(r==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(r==="wave"){var o={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(u,d){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:y()(y()({},o),{},{animationDelay:"".concat(u,"s")})},d)})})]})}return r==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):r==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},Sn=function(e){var n=e.autoRotate,r=n===void 0?!1:n,a=e.rotateInterval,s=a===void 0?3e3:a,o=e.initialType,u=o===void 0?"wave":o,d=e.size,c=d===void 0?"medium":d,v=(0,m.useState)(u),g=P()(v,2),f=g[0],C=g[1],_=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(An,{type:f,size:c})})},Fn=function(e){var n=e.isVisible,r=e.animationType,a=r===void 0?"pulse":r,s=e.enableAutoRotate,o=s===void 0?!0:s,u=(0,w.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(Sn,{initialType:a,autoRotate:o,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:u.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},Dn=(0,m.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,r=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,u=i.setIsStop,d=i.setSendValue,c=i.agentChatRoomId,v=i.abilitiesList,g=i.mcpTools,f=i.updateMCPTool,C=i.getMCPTool,_=i.userMessage,b=ft(),p=b.setInstruction,j=(0,m.useState)([]),N=P()(j,2),E=N[0],D=N[1],oe=(0,m.useState)(!1),Te=P()(oe,2),W=Te[0],J=Te[1],Ce=(0,m.useState)(!1),ue=P()(Ce,2),Ke=ue[0],Y=ue[1],H=(0,m.useRef)(!1),Me=(0,m.useRef)(null),be=(0,w.useParams)(),k=be.id,G=(0,w.useLocation)(),h=new URLSearchParams(G.search),x=h.get("id"),M=k||x;(0,m.useEffect)(function(){W&&(n(function(T){return[].concat(se()(E.reverse()),se()(T))}),D([]),setTimeout(function(){J(!1),s.current.scrollTop=0},200))},[W]),(0,m.useEffect)(function(){if(!H.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!Me.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var T=dt(_);if(T){if(!T.id){console.warn("Found agent message without ID, skipping:",T),H.current=!0;return}if(Me.current(T),n){var V=_.filter(function($){return $!==T});n(V)}else console.warn("setUserMessage not available for history update");H.current=!0}}catch($){console.error("Failed to process history message:",$,{userMessageLength:_==null?void 0:_.length,hasCallback:!!Me.current}),H.current=!0}}},[_,n]),(0,m.useEffect)(function(){H.current=!1},[M]);var I=function(V){if(n&&_){var $=_.filter(function(je){return je!==V});n($)}};return(0,t.jsxs)(t.Fragment,{children:[E.length?E.map(function(T,V){return(0,t.jsx)(Yt,{item:T,index:V,agentChatRoomId:c,abilitiesList:v,messageApi:e,id:M,idName:"currentContent",cidName:"currentChilContent",mcpTools:g,updateMCPTool:f,setInstruction:p,getMCPTool:C},V)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(Fn,{isVisible:Ke}),(0,t.jsx)(En,{messageApi:e,setCurrentMessageContent:D,sendValue:r,agentList:a,scrollDomRef:s,upButtonDom:o,setIsStop:u,setisEnd:J,setSendValue:d,agentChatRoomId:c,updateMCPTool:f,getCurrentMessageList:function(){return _||[]},mcpTools:g,getMCPTool:C,setIsWaitingReply:Y,removeHistoryMessage:I,setCurrentMessageFromHistory:function(V){Me.current=V},setInstruction:p})]})}),On=(0,m.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,r=i.instruction,a=i.setIsStop,s=i.upButtonDom,o=i.agentList,u=i.agentChatRoomId,d=i.abilitiesList,c=ft(),v=c.setInstruction,g=(0,w.useIntl)(),f=(0,m.useState)(860),C=P()(f,2),_=C[0],b=C[1],p=(0,w.useParams)(),j=p.id,N=(0,w.useLocation)(),E=new URLSearchParams(N.search),D=E.get("id"),oe=u||j||D,Te=(0,m.useState)([]),W=P()(Te,2),J=W[0],Ce=W[1],ue=(0,m.useRef)(!1),Ke=(0,m.useState)(""),Y=P()(Ke,2),H=Y[0],Me=Y[1],be=(0,m.useRef)(null),k=(0,m.useRef)(!0),G=(0,m.useState)({}),h=P()(G,2),x=h[0],M=h[1],I=(0,m.useRef)(2),T=(0,m.useRef)(1),V=(0,m.useRef)(0),$=function(R,Q){M(function(ee){var ge=ee[R];return ge?y()(y()({},ee),{},pe()({},R,y()(y()({},ge),Q))):y()(y()({},ee),{},pe()({},R,y()({id:R,status:U.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},Q)))})},je=function(R){return x[R]||null},qe=function(R){var Q,ee=R.files_to_upload&&Array.isArray(R.files_to_upload)&&R.files_to_upload.length>0,ge=((Q=R.args)===null||Q===void 0?void 0:Q.input_variables)&&Object.values(R.args.input_variables).some(function(Se){return Se==="need_upload"});return(ee||ge)&&!R.result?U.WAITING_FILE_UPLOAD:zt(R.workflow_confirmation_status,R.result)},Ie=function(R){var Q=R.map(function(ee){var ge=y()({},ee);if(ee.is_agent===1&&ee.content){var Se=Ae(ee.content);ge.parsedContent=Se,Se.hasMCPTools&&Se.blocks.forEach(function(it){if(it.type==="mcp-tool"&&it.toolData){var F=it.toolData;if(!x[F.id]){var vt=qe(F);M(function(pt){return y()(y()({},pt),{},pe()({},F.id,{id:F.id,name:F.name,skill_or_workflow_name:F.skill_or_workflow_name||F.name,workflow_run_id:F.workflow_run_id||0,workflow_confirmation_status:F.workflow_confirmation_status||null,args:F.args||{},result:F.result||null,status:vt,isWorkflow:F.skill_or_workflow_name?F.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:F.files_to_upload||[],uploaded_files:yn(F)}))})}}})}return ge});return Q},X=function(){var A=K()(te()().mark(function R(Q){var ee,ge,Se=arguments;return te()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(ee=Se.length>1&&Se[1]!==void 0?Se[1]:function(){},!oe){F.next=6;break}return F.next=4,(0,O.KH)(oe,{page:T.current,page_size:10});case 4:ge=F.sent,ge.code==0&&(I.current=ge.data.total_pages,Q||(be.current.style.display="none"),Ce(function(vt){var pt=ge.data.list.reverse(),Qt=Ie(pt);return Q?se()(Qt):[].concat(se()(vt),se()(Qt))}),Q?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,s.current.style.display="none"}):V.current=ge.data.list.length,k.current=!0);case 6:case"end":return F.stop()}},R)}));return function(Q){return A.apply(this,arguments)}}(),L=function(R){var Q=R.target.scrollHeight+(R.target.scrollTop-R.target.clientHeight);ue.current!==Math.ceil(R.target.scrollTop)<-50&&(ue.current=Math.ceil(R.target.scrollTop)<-50,s.current.style.display=ue.current?"flex":"none"),Q<10&&k.current&&(k.current=!1,T.current=T.current+1,be.current.style.display="flex",I.current>=T.current?X(!1):be.current.style.display="none")},ve=function(R,Q){Q==="0"&&(Q=Number(Q));var ee=["".concat(R),Q!==""&&Q!==null&&Q!==void 0?Q:null];Me(JSON.stringify(ee))},ze=(0,Z.Z)(function(A){return A.disableInput}),De=(0,Z.Z)(function(A){return A.clearMemory});return(0,m.useEffect)(function(){De&&De.length&&ve(De[0],De[1])},[De]),(0,m.useEffect)(function(){r&&r.length&&(ve(r[0],r[1]!==void 0?r[1]:""),v([]))},[r]),(0,m.useEffect)(function(){T.current=1,X(!0)},[]),(0,m.useEffect)(function(){var A=function(){window.innerWidth<1280||b(window.innerWidth-320-(window.innerWidth-320)/2-88)};return A(),window.addEventListener("resize",A),function(){window.removeEventListener("resize",A)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:L,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:u?"":"".concat(_,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:J&&J.length?J.map(function(A,R){return(0,t.jsx)(Yt,{item:y()(y()({},A),{},{id:"c".concat(A.id)}),index:R,agentChatRoomId:u,abilitiesList:d,messageApi:e,id:oe,idName:"content",cidName:"chilContent",mcpTools:x,updateMCPTool:$,getMCPTool:je},R)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(Dn,{messageApi:e,setUserMessage:Ce,sendValue:H,agentList:o,scrollDomRef:n,upButtonDom:s,setIsStop:a,setSendValue:Me,agentChatRoomId:u,abilitiesList:d,mcpTools:x,updateMCPTool:$,getMCPTool:je,userMessage:J})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!u&&!ze&&J.length?(0,t.jsx)(lt,{roomid:oe}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:be,children:(0,t.jsx)(ce.Z,{})})]})})}),Ln=l(82114),Un=l(77171),Rn=l(85576),Xt=l(96486),Bn=l(58299),kn=l(38008),Zn=l(83062),Wn=function(e){var n=e.uploadedFiles,r=e.handleRemoveFile;return n.length?(0,t.jsx)(we.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(a){return(0,t.jsx)(Ot.Z,{closable:!0,onClose:function(){return r(a.uid)},className:"flex items-center ".concat(a.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Zn.Z,{title:a.name,children:(0,t.jsx)("div",{className:"flex items-center",children:a.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(we.Z,{src:a.path_show||a.url,alt:a.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:a.path_show||a.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(ke.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),Fe(a.path_show||a.url,a.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Ee.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(ke.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),Fe(a.path_show||a.url,a.name)}})]})})})},a.uid)})})})}):null},Hn=l(52645),Gn=l(64317),Kn=function(e){var n=e.agentChatRoomId,r=e.abilitiesList,a=e.abilityId,s=e.setAbilityId,o=e.clearContext,u=(0,w.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(r==null?void 0:r.length)>0&&(0,t.jsx)(Gn.Z,{label:u.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:r,initialValue:a,fieldProps:{placeholder:u.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(c){s(c)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(xe.ZP,{size:"small",color:"danger",variant:"outlined",onClick:o,icon:(0,t.jsx)(Hn.Z,{}),children:u.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},zn=l(88484),Vn=l(30159),$n=l(26915),Jn=$n.Z.TextArea,Yn=function(e){var n=e.userSendvalue,r=e.setUserSendvalue,a=e.disableInput,s=e.isUploading,o=e.isStop,u=e.userSendmessage,d=e.handleFileUpload,c=e.sendMessage,v=e.stopChatRoom,g=(0,w.useIntl)(),f=(0,Xt.throttle)(function(){if(a||!n)return!1;c(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(xe.ZP,{type:"text",icon:(0,t.jsx)(zn.Z,{}),onClick:d,disabled:a||s,loading:s}),(0,t.jsx)(Jn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:a,onChange:function(_){r(_.target.value)},onPressEnter:u,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(g.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),o?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:v,children:(0,t.jsx)(Vn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(a||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:f,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Xn=(0,m.memo)(function(i){var e,n=i.messageApi,r=i.isStop,a=i.scrollDomRef,s=i.upButtonDom,o=i.agentList,u=i.abilitiesList,d=i.agentChatRoomId,c=i.chatStatus,v=ft(),g=v.setInstruction,f=(0,w.useIntl)(),C=(0,Z.Z)(function(X){return X.disableInput}),_=(0,Z.Z)(function(X){return X.setDisableInput}),b=(0,Z.Z)(function(X){return X.setClearMemory}),p=(0,Bn.m)(),j=p.options,N=d?(0,kn.Zc)().isImageSupportModel:function(){return!1},E=(0,m.useState)(null),D=P()(E,2),oe=D[0],Te=D[1],W=(0,m.useState)(""),J=P()(W,2),Ce=J[0],ue=J[1],Ke=(0,m.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),Y=P()(Ke,2),H=Y[0],Me=Y[1],be=(0,$e.ZP)({maxSizeMB:15,acceptedFileTypes:H,multiple:!0}),k=be.uploadedFiles,G=be.handleUpload,h=be.removeFile,x=be.clearFiles,M=be.isUploading;(0,m.useEffect)(function(){var X,L;if(d&&(o==null||(X=o.current)===null||X===void 0?void 0:X.length)>0&&o!==null&&o!==void 0&&(L=o.current[0])!==null&&L!==void 0&&(L=L.agent)!==null&&L!==void 0&&L.m_config_id){var ve,ze=o==null||(ve=o.current[0])===null||ve===void 0||(ve=ve.agent)===null||ve===void 0?void 0:ve.m_config_id,De=N(ze),A=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(De?",.jpg,.png,.jpeg":"");Me(A)}},[o,j,o==null||(e=o.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,N]);var I=function(){var L=Rn.Z.confirm;L({title:f.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(Ln.Z,{}),content:f.formatMessage({id:"app.chatroom.clear.tips"}),okText:f.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:f.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){b(["TRUNCATE","0"])}})},T=function X(L,ve){if(L.length===0){ve&&ve();return}var ze=Tt()(L),De=ze[0],A=ze.slice(1);g(De),setTimeout(function(){X(A,ve)},100)},V=function(L){var ve=[];(k==null?void 0:k.length)>0&&ve.push(["FILELIST",k.map(function(De){return De.file_id})]);var ze=oe||0;ve.push(["SETABILITY",ze]),ve.push(["INPUT",L]),T(ve,function(){(k==null?void 0:k.length)>0&&x()})},$=function(L){!L.shiftKey&&L.target.value==""&&(n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),ue(""),L.preventDefault()),!L.shiftKey&&L.keyCode==13&&L.target.value!=""&&(_(!0),ue(""),V(L.target.value),L.preventDefault())},je=(0,Xt.throttle)(function(){g(["STOP",null])},300),qe=function(){C||G()},Ie=function(L){if(!L){n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}_(!0),V(L),ue("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:s,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(L){a.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(Un.Z,{className:"text-[16px]"})}),(0,t.jsx)(Wn,{uploadedFiles:k,handleRemoveFile:h}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(k.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(Kn,{agentChatRoomId:d,abilitiesList:u,abilityId:oe,setAbilityId:Te,clearContext:I}),(0,t.jsx)(Yn,{userSendvalue:Ce,setUserSendvalue:ue,disableInput:C,isUploading:M,isStop:r,userSendmessage:$,handleFileUpload:qe,sendMessage:Ie,stopChatRoom:je})]})]})}),Qn=(0,m.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,r=i.abilitiesList,a=i.chatStatus,s=ft(),o=s.scrollDomRef,u=s.upButtonDom,d=s.isStop,c=s.setIsStop,v=s.instruction,g=s.setInstruction;(0,m.useEffect)(function(){console.log(a),a==1&&c(!0)},[a]);var f=Oe.ZP.useMessage(),C=P()(f,2),_=C[0],b=C[1];return(0,t.jsxs)(t.Fragment,{children:[b,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(On,{instruction:v,messageApi:_,scrollDomRef:o,setIsStop:c,upButtonDom:u,agentList:e,agentChatRoomId:n,abilitiesList:r}),(0,t.jsx)(Xn,{messageApi:_,isStop:d,upButtonDom:u,scrollDomRef:o,agentList:e,agentChatRoomId:n,abilitiesList:r,chatStatus:a})]})})]})}),qn=(0,m.memo)(function(i){return(0,t.jsx)(tn,{agentChatRoomId:i.agentChatRoomId,children:(0,t.jsx)(Qn,y()({},i))})})},85877:function(yt,Ze,l){var Ue=l(19632),y=l.n(Ue),We=l(97857),P=l.n(We),Oe=l(5574),de=l.n(Oe),m=l(52677),Re=l.n(m),te=l(35312),Le=l(78234),se=l(77598),Be=l(96486),K=l.n(Be),ne=l(67294),pe=l(73935),O=l(43413),Z=l(92858),w=l(16845),ce=l(15425),re=l(85893),t=function(B){var z=B.children;return(typeof document=="undefined"?"undefined":Re()(document))==="object"?pe.createPortal(z,document.body):null},lt=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),He=function(B){var z=B.value,me=B.onChange,_e=B.id,fe=B.placeholder,he=B.options,ye=(0,te.useIntl)(),et=(0,ne.useRef)(),ht=(0,ne.useState)(),nt=de()(ht,2),ae=nt[0],Fe=nt[1],ut=(0,ne.useState)(0),tt=de()(ut,2),Pe=tt[0],Ge=tt[1],dt=(0,ne.useState)(""),ct=de()(dt,2),gt=ct[0],Ye=ct[1],ot=(0,ne.useCallback)(function(S){return(0,re.jsx)(ke,P()({},S))},[]),xt=(0,ne.useCallback)(function(S){return(0,re.jsx)(xe,P()({},S))},[]),le=(0,ne.useMemo)(function(){return Ve((0,w.BU)((0,Z.VC)((0,O.Jh)())))},[]),Ct=(0,ne.useState)(null),q=de()(Ct,2),rt=q[0],At=q[1],kt=(0,ce.Z)(function(S){return S.selectedNode}),Zt=(0,ce.Z)(function(S){return S.getOutputVariables}),Wt=(0,ce.Z)(function(S){return S.getInputVariables}),St=(0,ne.useState)([]),It=de()(St,2),Xe=It[0],Pt=It[1];(0,Le.Z)(function(){z&&z.length>0&&Mt(z),he!=null&&he.length&&Pt(he.map(function(S){return P()(P()({},S),{},{name:S.label,id:S.value})}))}),(0,se.Z)(function(){var S=K().isEqual(rt,z);S||(z&&z.length>0?Mt(z):z&&K().isArray(z)&&z.length==0&&Mt([{type:"paragraph",children:[]}]))},[z,_e]),(0,se.Z)(function(){he.length&&Pt(he.map(function(S){return P()(P()({},S),{},{name:S.label,id:S.value})})),console.log(he)},[he]);var Mt=function(ie){At(ie),Nt(le,{nodes:[{type:"paragraph",children:[]}]}),Nt(le,{nodes:ie})},_t=(0,ne.useCallback)(function(S){if(ae&&Xe.length>0)switch(S.key){case"ArrowDown":S.preventDefault();var ie=Pe>=Xe.length-1?0:Pe+1;Ge(ie);return;case"ArrowUp":S.preventDefault();var Ne=Pe<=0?Xe.length-1:Pe-1;Ge(Ne);return;case"Tab":case"Enter":S.preventDefault(),O.YR.select(le,ae),we(le,Xe[Pe]),Fe(null);return;case"Escape":S.preventDefault(),Fe(null);return}else if(S.key==="@"){setTimeout(function(){return Tt()},10);return}Fe(null)},[Xe,le,Pe,ae]),Nt=function(ie){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},bt=y()(ie.children);if(bt.forEach(function(at){return ie.apply({type:"remove_node",path:[0],node:at})}),Ne.nodes){var st=O.NB.isNode(Ne.nodes)?[Ne.nodes]:Ne.nodes;st.forEach(function(at,jt){return ie.apply({type:"insert_node",path:[jt],node:at})})}var mt=Ne.at&&O.E9.isPoint(Ne.at)?Ne.at:O.ML.end(ie,[]);mt&&O.YR.select(ie,mt)};(0,ne.useEffect)(function(){if(ae&&Xe.length>0){var S=et.current,ie=w.F3.toDOMRange(le,ae),Ne=ie.getBoundingClientRect();S.style.top="".concat(Ne.top+window.pageYOffset+24,"px"),S.style.left="".concat(Ne.left+window.pageXOffset,"px")}},[Xe.length,le,Pe,gt,ae]);var Tt=function(){var ie=le.selection;if(ie&&O.e6.isCollapsed(ie)){var Ne=O.e6.edges(ie),bt=de()(Ne,1),st=bt[0],mt=O.ML.before(le,st),at=mt&&O.ML.range(le,mt,st),jt=at&&O.ML.string(le,at),Ft=O.ML.after(le,st),Dt=O.ML.range(le,st,Ft),Ht=O.ML.string(le,Dt);Fe(at),Ye(""),Ge(0);return}Fe(null)};return(0,re.jsxs)(w.mH,{editor:le,initialValue:$e,onChange:function(ie){me==null||me(ie),Fe(null)},children:[(0,re.jsx)(w.CX,{renderElement:ot,renderLeaf:xt,onKeyDown:_t,className:"!outline-none",placeholder:fe!=null?fe:ye.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),ae&&(0,re.jsx)(t,{children:(0,re.jsx)("div",{ref:et,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:Xe.length?Xe.map(function(S,ie){return(0,re.jsx)("div",{onClick:function(){console.log(S),O.YR.select(le,ae),we(le,S),Fe(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:ie===Pe?"#B4D5FF":""},children:(0,re.jsx)("span",{children:S.name})},S.name+ie)}):(0,re.jsx)(re.Fragment,{children:ye.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Ve=function(B){var z=B.isInline,me=B.isVoid,_e=B.markableVoid;return B.isInline=function(fe){return fe.type==="mention"?!0:z(fe)},B.isVoid=function(fe){return fe.type==="mention"?!0:me(fe)},B.markableVoid=function(fe){return fe.type==="mention"||_e(fe)},B},we=function(B,z){var me={type:"mention",id:(z==null?void 0:z.id)||"",character:z.name,base:z,children:[{bold:!0,text:"11111"}]};O.YR.insertNodes(B,me),O.YR.move(B)},xe=function(B){var z=B.attributes,me=B.children,_e=B.leaf;return(0,re.jsx)("span",P()(P()({},z),{},{children:me}))},ke=function(B){var z=B.attributes,me=B.children,_e=B.element;switch(_e.type){case"mention":return(0,re.jsx)(Ee,P()({},B));default:return(0,re.jsx)("p",P()(P()({},z),{},{children:me}))}},Ee=function(B){var z=B.attributes,me=B.children,_e=B.element,fe=(0,w.vt)(),he=(0,w.UE)(),ye={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:fe&&he?"0 0 0 2px #B4D5FF":"none"};return _e.children[0].bold&&(ye.fontWeight="bold"),_e.children[0].italic&&(ye.fontStyle="italic"),(0,re.jsx)("span",P()(P()({},z),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(_e.character.replace(" ","-")),style:ye,children:lt?(0,re.jsxs)(ne.Fragment,{children:["1",me,"/",_e.character]}):(0,re.jsxs)(ne.Fragment,{children:[(0,re.jsx)("span",{children:_e.character}),me]})}))},$e=[{type:"paragraph",children:[{text:""}]}];Ze.Z=He},38008:function(yt,Ze,l){l.d(Ze,{Zc:function(){return m},aS:function(){return de}});var Ue=l(67294),y=l(85750),We=l(58299),P=l(85893),Oe=(0,Ue.createContext)(void 0),de=function(Le){var se=Le.children,Be=(0,We.m)(),K=Be.options,ne=(0,Ue.useMemo)(function(){var pe=function(w){if(!w||!K)return!1;var ce=(0,y.ti)(w,{options:K});return(ce==null?void 0:ce.support_image)===1},O=function(w){return pe(w)};return{isImageSupportModel:pe,getCurrentModelImageSupport:O}},[K]);return(0,P.jsx)(Oe.Provider,{value:ne,children:se})},m=function(){var Le=(0,Ue.useContext)(Oe);if(Le===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return Le},Re=null},77295:function(yt,Ze,l){l.d(Ze,{CO:function(){return K}});var Ue=l(15009),y=l.n(Ue),We=l(19632),P=l.n(We),Oe=l(99289),de=l.n(Oe),m=l(5574),Re=l.n(m),te=l(45360),Le=l(35312),se=l(67294),Be=l(83065),K=function(O){var Z,w=O==null||(Z=O.split(".").pop())===null||Z===void 0?void 0:Z.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(w||"")},ne=function(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Z=(0,Le.useIntl)(),w=(0,se.useState)([]),ce=Re()(w,2),re=ce[0],t=ce[1],lt=(0,se.useState)(!1),He=Re()(lt,2),Ve=He[0],we=He[1],xe=O.maxSizeMB,ke=xe===void 0?15:xe,Ee=O.acceptedFileTypes,$e=Ee===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Ee,Je=O.multiple,B=Je===void 0?!0:Je,z=function(){var he=document.createElement("input");he.type="file",he.accept=$e,he.multiple=B,he.onchange=function(){var ye=de()(y()().mark(function et(ht){var nt,ae,Fe,ut,tt,Pe,Ge,dt,ct,gt,Ye,ot,xt,le;return y()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(nt=ht.target,!(nt.files&&nt.files.length>0)){q.next=37;break}if(we(!0),ae=Array.from(nt.files),Fe=ae.filter(function(rt){return rt.size/1024/1024>ke}),!(Fe.length>0)){q.next=9;break}return te.ZP.error("".concat(Fe.map(function(rt){return rt.name}).join(", ")," ").concat(Z.formatMessage({id:"workflow.uploadFileErrorText"}))),we(!1),q.abrupt("return");case 9:ut=[],tt=0,Pe=ae;case 11:if(!(tt<Pe.length)){q.next=35;break}return Ge=Pe[tt],dt=new FormData,dt.append("file",Ge),q.prev=15,q.next=18,(0,Be.M$)();case 18:return ct=q.sent,q.next=21,fetch(ct,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:dt});case 21:return gt=q.sent,q.next=24,gt.json();case 24:Ye=q.sent,Ye.code===0?(te.ZP.success("".concat(Ge.name," ").concat(Z.formatMessage({id:"workflow.uploadSuccess"}))),(ot=Ye.data)!==null&&ot!==void 0&&ot.file_id&&(xt=K(Ge.name),le={name:Ge.name,url:Ye.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:xt,file_id:Ye.data.file_id,path_show:Ye.data.file_url||Ye.data.path_show||""},ut.push(le))):te.ZP.error("".concat(Ge.name," ").concat(Z.formatMessage({id:"workflow.uploadFailed"}))),q.next=32;break;case 28:q.prev=28,q.t0=q.catch(15),console.error("Upload error:",q.t0),te.ZP.error("".concat(Ge.name," ").concat(Z.formatMessage({id:"workflow.uploadFailed"})));case 32:tt++,q.next=11;break;case 35:t(function(rt){return[].concat(P()(rt),ut)}),we(!1);case 37:case"end":return q.stop()}},et,null,[[15,28]])}));return function(et){return ye.apply(this,arguments)}}(),he.click()},me=function(he){t(function(ye){return ye.filter(function(et){return et.uid!==he})})},_e=function(){t([])};return{uploadedFiles:re,setUploadedFiles:t,handleUpload:z,removeFile:me,clearFiles:_e,isUploading:Ve}};Ze.ZP=ne},58299:function(yt,Ze,l){l.d(Ze,{m:function(){return ne}});var Ue=l(64599),y=l.n(Ue),We=l(97857),P=l.n(We),Oe=l(15009),de=l.n(Oe),m=l(99289),Re=l.n(m),te=l(73445),Le=l(42237),se=l(45360),Be=l(67294),K=(0,te.Ue)(function(pe){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var O=Re()(de()().mark(function w(){var ce;return de()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,pe({loading:!0}),t.next=4,(0,Le.fZ)();case 4:if(ce=t.sent,ce.code!==0){t.next=9;break}pe({models:Array.isArray(ce.data.data)?ce.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(ce.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),pe({error:t.t0.message}),se.ZP.error("Failed to fetch models");case 16:return t.prev=16,pe({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},w,null,[[0,12,16,19]])}));function Z(){return O.apply(this,arguments)}return Z}()}}),ne=function(){var O=K(function(t){return t.models}),Z=K(function(t){return t.loading}),w=K(function(t){return t.initialized}),ce=K(function(t){return t.fetchModels});(0,Be.useEffect)(function(){w||ce()},[w,ce]);var re=(0,Be.useMemo)(function(){var t=Array.isArray(O)?O:[],lt=t.map(function(Ee){return{label:Ee.supplier_name,options:Array.isArray(Ee.model_list)?Ee.model_list.map(function($e){return P()({label:$e.model_name,value:$e.model_config_id},$e)}):[]}}),He,Ve=y()(t),we;try{for(Ve.s();!(we=Ve.n()).done;){var xe=we.value;if(Array.isArray(xe.model_list)){var ke=xe.model_list.find(function(Ee){return Ee.model_default_used===1});if(ke){He=ke.model_config_id;break}}}}catch(Ee){Ve.e(Ee)}finally{Ve.f()}return{options:lt,defaultValue:He}},[O]);return P()(P()({},re),{},{loading:Z})}}}]);
