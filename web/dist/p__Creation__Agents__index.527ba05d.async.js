"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[178],{83510:function(Mt,Ce,a){a.d(Ce,{LK:function(){return ve},bs:function(){return Ke},go:function(){return Fe},uy:function(){return Ue}});var Le=a(15009),_=a.n(Le),$e=a(99289),O=a.n($e),se=a(47520),t="/v1/apps/apps_list",Re="/v1/agent/agent_delete/",h="/v1/workflow/workflow_app_delete/",G="/v1/vector/delete_dataset/",ze="/v1/skill/delete_skill_by_app_id/",Ge="/v1/apps/apps_create",De="/v1/apps/app_update/",Fe=function(){var ne=O()(_()().mark(function U(P){var E;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,se.ZP)("".concat(t),{method:"GET",data:P});case 2:return E=s.sent,s.abrupt("return",E);case 4:case"end":return s.stop()}},U)}));return function(P){return ne.apply(this,arguments)}}(),ve=function(){var ne=O()(_()().mark(function U(P){var E;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log(P),s.next=3,P.mode;case 3:if(s.t0=s.sent,s.t0!=1){s.next=8;break}s.t1=(0,se.ZP)("".concat(Re).concat(P.app_id),{method:"DELETE"}),s.next=9;break;case 8:s.t1=P.mode==2?(0,se.ZP)("".concat(h).concat(P.app_id),{method:"DELETE"}):P.mode==3?(0,se.ZP)("".concat(G).concat(P.app_id),{method:"DELETE"}):(0,se.ZP)("".concat(ze).concat(P.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return E=s.t1,s.abrupt("return",E);case 11:case"end":return s.stop()}},U)}));return function(P){return ne.apply(this,arguments)}}(),Ue=function(){var ne=O()(_()().mark(function U(P){var E;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,se.ZP)("".concat(Ge),{method:"POST",data:P});case 2:return E=s.sent,s.abrupt("return",E);case 4:case"end":return s.stop()}},U)}));return function(P){return ne.apply(this,arguments)}}(),Ke=function(){var ne=O()(_()().mark(function U(P){var E;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,se.ZP)("".concat(De).concat(P.app_id),{method:"PUT",data:P});case 2:return E=s.sent,s.abrupt("return",E);case 4:case"end":return s.stop()}},U)}));return function(P){return ne.apply(this,arguments)}}()},48528:function(Mt,Ce,a){a.r(Ce),a.d(Ce,{default:function(){return na}});var Le=a(15009),_=a.n(Le),$e=a(99289),O=a.n($e),se=a(97857),t=a.n(se),Re=a(5574),h=a.n(Re),G=a(11551),ze=a(83510),Ge=a(47520),De=a(29432),Fe=a(10759),ve=a(32332),Ue=a(2068),Ke=a(89035),ne=a(15360),U=a(82826),P=a(69243),E=a(35312),j=a(40741),s=a(45360),xe=a(28036),Zt=a(50136),We=a(25409),Qe=a(74330),m=a(67294),be=a(92939),Pt=a(5608),At=a(64599),Ct=a.n(At),Dt=a(73445),Et=a(42237),Ee=(0,Dt.Ue)(function(ie){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var n=O()(_()().mark(function Z(){var F;return _()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,ie({loading:!0}),v.next=4,(0,Et.fZ)();case 4:if(F=v.sent,F.code!==0){v.next=9;break}ie({models:Array.isArray(F.data.data)?F.data.data:[],initialized:!0}),v.next=10;break;case 9:throw new Error(F.message||"Failed to fetch models");case 10:v.next=16;break;case 12:v.prev=12,v.t0=v.catch(0),ie({error:v.t0.message}),s.ZP.error("Failed to fetch models");case 16:return v.prev=16,ie({loading:!1}),v.finish(16);case 19:case"end":return v.stop()}},Z,null,[[0,12,16,19]])}));function L(){return n.apply(this,arguments)}return L}()}}),kt=function(){var n=Ee(function(v){return v.models}),L=Ee(function(v){return v.loading}),Z=Ee(function(v){return v.initialized}),F=Ee(function(v){return v.fetchModels});(0,m.useEffect)(function(){Z||F()},[Z,F]);var x=(0,m.useMemo)(function(){var v=Array.isArray(n)?n:[],i=v.map(function(f){return{label:f.supplier_name,options:Array.isArray(f.model_list)?f.model_list.map(function(X){return{label:X.model_name,value:X.model_config_id}}):[]}}),k,D=Ct()(v),le;try{for(D.s();!(le=D.n()).done;){var q=le.value;if(Array.isArray(q.model_list)){var b=q.model_list.find(function(f){return f.model_default_used===1});if(b){k=b.model_config_id;break}}}}catch(f){D.e(f)}finally{D.f()}return{options:i,defaultValue:k}},[n]);return t()(t()({},x),{},{loading:L})},ye=a(26915),Me=a(72269),He=a(34041),H=a(78045),e=a(85893),Tt=ye.Z.TextArea,It=function(n){var L,Z,F,x=n.loading,v=n.FirstValue,i=n.Detaillist,k=n.setDetaillist,D=n.repository,le=n.setRepository,q=n.Operationbentate,b=n.Ffromref,f=n.setFourthly_config_id,X=n.Fourthly_config_id,re=n.Fourthly_select_list,Ze=n.Newproperties,oe=n.setNewproperties,ee=n.pageKeyfun,de=n.firstjudgingcondition,ue=n.setAgentmunudisabled,y=n.agentmenudisabled,g=(0,E.useIntl)(),he=(0,m.useState)([]),Y=h()(he,2),we=Y[0],J=Y[1],S=(0,m.useState)({agent_id:0,data:{is_public:1,enable_api:0,obligations:null,input_variables:{},dataset_ids:[],attrs_are_visible:1}}),K=h()(S,2),M=K[0],V=K[1];(0,m.useEffect)(function(){w()},[]);var ce=function(p){f(p)},je=function(p){V(t()(t()({},M),{},{data:t()(t()({},M.data),{},{obligations:p.target.value})})),k(t()(t()({},i),{},{agent:t()(t()({},i.agent),{},{obligations:p.target.value})}))},te=function(p,Q){var z=new Set;return p.some(function(W){var fe=W[Q];return z.has(fe)?z.add(fe):z.add(fe)&&!1})},me=function(p){k(t()(t()({},i),{},{app:t()(t()({},i.app),{},{is_public:p?1:0})})),V(t()(t()({},M),{},{data:t()(t()({},M.data),{},{is_public:p?1:0})}))},Se=function(p){k(t()(t()({},i),{},{app:t()(t()({},i.app),{},{enable_api:p?1:0})})),V(t()(t()({},M),{},{data:t()(t()({},M.data),{},{enable_api:p?1:0})}))},Ne=function(p){k(t()(t()({},i),{},{app:t()(t()({},i.app),{},{attrs_are_visible:p?1:0})})),V(t()(t()({},M),{},{data:t()(t()({},M.data),{},{attrs_are_visible:p?1:0})}))},ke=function(p){k(t()(t()({},i),{},{agent:t()(t()({},i.agent),{},{allow_upload_file:p?1:0})}))},B=function(p){V(t()(t()({},M),{},{data:t()(t()({},M.data),{},{dataset_ids:p})})),le(p)},w=function(){var I=O()(_()().mark(function p(){var Q;return _()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(0,G.zl)();case 2:Q=W.sent,J(Q.data.data.map(function(fe){return{value:fe.dataset_id,label:fe.name}}));case 4:case"end":return W.stop()}},p)}));return function(){return I.apply(this,arguments)}}(),N=function(){var I=O()(_()().mark(function p(){return _()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:de()||(ee("2"),ue(t()(t()({},y),{},{first:!1,second:!1})));case 1:case"end":return z.stop()}},p)}));return function(){return I.apply(this,arguments)}}(),$=function(p){k(t()(t()({},i),{},{agent:t()(t()({},i.agent),{},{default_output_format:p.target.value})}))},R=function(p){k(t()(t()({},i),{},{agent:t()(t()({},i==null?void 0:i.agent),{},{input_variables:p.free})}))},A=kt(),ae=A.options,Xe=A.defaultValue;return(0,e.jsxs)("div",{style:{height:"100%",width:"100%",marginBottom:"30px"},children:[(0,e.jsx)("div",{className:"flex align-center justify-between mt-[30px]",children:(0,e.jsx)("div",{className:"text-base font-medium mb-[30px] text-[#333333]",children:g.formatMessage({id:"agent.menu.basicsetup"})})}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(j.Z,{name:"dynamic_form_nest_item",style:{width:"100%"},autoComplete:"off",form:b,children:[(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:g.formatMessage({id:"agent.appname"})}),(0,e.jsxs)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:[(0,e.jsxs)("div",{children:[i&&i.app&&i.app.name,"\xA0"]}),(0,e.jsx)("div",{className:"",children:q==="true"?g.formatMessage({id:"agent.cannotmodify"}):""})]})]})}),(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:g.formatMessage({id:"agent.appdescription"})}),(0,e.jsx)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:i&&i.app&&i.app.description})]})}),(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",name:g.formatMessage({id:"agent.teamvisibility"}),title:g.formatMessage({id:"agent.explain.teamvisibility"})})}),(0,e.jsx)(Me.Z,{size:"small",onChange:me,checked:!!(i&&((L=i.app)===null||L===void 0?void 0:L.is_public)===1)})]}),(0,e.jsxs)("div",{className:"mb-[30px]  font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",name:g.formatMessage({id:"agent.attrVisible"}),title:g.formatMessage({id:"agent.explain.attrVisible"})})}),(0,e.jsx)(Me.Z,{size:"small",onChange:Ne,checked:i&&i.app.attrs_are_visible===1})]}),(0,e.jsxs)("div",{className:"mb-[30px]  font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:g.formatMessage({id:"agent.APIswitch"})}),(0,e.jsx)(Me.Z,{size:"small",onChange:Se,checked:i&&i.app.enable_api===1,disabled:(i==null||(Z=i.app)===null||Z===void 0?void 0:Z.publish_status)!==1})]}),(0,e.jsxs)("div",{className:"font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:g.formatMessage({id:"agent.filesupload"})}),(0,e.jsx)(Me.Z,{size:"small",onChange:ke,checked:!!(i&&i.agent.allow_upload_file==1)})]})]})}),(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:[(0,e.jsx)("span",{className:"text-[#E80000]",children:"* "}),g.formatMessage({id:"agent.LLMmodel"})]}),(0,e.jsx)(He.Z,{placeholder:g.formatMessage({id:"agent.pleaseselect"}),style:{width:270},value:X==0?g.formatMessage({id:"agent.pleaseselect"}):X,variant:"filled",onChange:ce,options:ae})]})}),(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",name:"obligations",children:(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",required:!0,name:g.formatMessage({id:"agent.functiondescription"}),title:g.formatMessage({id:"agent.explain.function"})})}),(0,e.jsx)(Tt,{onChange:je,value:i&&i.agent&&i.agent.obligations,placeholder:"Agent".concat(g.formatMessage({id:"agent.functiondescription"})),autoSize:{minRows:8,maxRows:10}})]})}),!x&&(0,e.jsx)("div",{className:"mb-[30px]",children:(0,e.jsx)(Pt.Z,{title:(0,e.jsx)("div",{className:"text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",required:!0,name:g.formatMessage({id:"agent.inputvariable"}),title:g.formatMessage({id:"agent.explain.inputvariable"})})}),variables:Object.values((i==null||(F=i.agent)===null||F===void 0||(F=F.input_variables)===null||F===void 0?void 0:F.properties)||{}),onChange:R})}),(0,e.jsx)(j.Z.List,{name:"users",children:function(p,Q){var z=Q.add,W=Q.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(j.Z.Item,{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs mb-[15px]",children:(0,e.jsx)(be.Z,{className:"font-medium",name:g.formatMessage({id:"agent.associatedknowledgebase"}),title:g.formatMessage({id:"agent.explain.associatedknowledgebase"})})}),(0,e.jsx)(He.Z,{size:"large",mode:"tags",style:{width:"100%"},placeholder:g.formatMessage({id:"agent.pleaseselect"}),value:D,onChange:B,options:we})]}),(0,e.jsx)(j.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"",children:[(0,e.jsxs)("div",{className:"text-[#555555] text-xs mb-[15px]",children:[" ",g.formatMessage({id:"agent.defaultoutputformat"})]}),(0,e.jsxs)(H.ZP.Group,{value:i&&i.agent.default_output_format,onChange:function(Te){$(Te)},children:[(0,e.jsx)(H.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text"})}),(0,e.jsx)(H.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"json"})}),(0,e.jsx)(H.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})]})})]})}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(xe.ZP,{type:"primary",className:"mr-[20px]",onClick:function(){N()},children:g.formatMessage({id:"agent.btn.nextstep"})}),(0,e.jsx)(xe.ZP,{onClick:function(){history.back()},children:g.formatMessage({id:"agent.btn.back"})})]}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Vt=It,Bt=a(13769),qe=a.n(Bt),Ot=a(49677),Lt=a.n(Ot),$t=a(92485),Rt=a(85877),et=a(39944),zt=a(71471),Gt=["key","name"],Na=zt.Z.Title,Ma=ye.Z.TextArea,Za=ye.Z.Search,Ut=function(n){var L=n.handleBack,Z=n.Detaillist,F=n.setDetaillist,x=n.Fourthly_select_list,v=n.setFourthly_config_id,i=n.Fourthly_config_id,k=n.Fourthlyref,D=n.Fourthly_abilities_list,le=n.Operationbentate,q=n.callwordlist,b=n.newagentid,f=(0,E.useIntl)(),X=(0,m.useState)(0),re=h()(X,2),Ze=re[0],oe=re[1],ee=(0,m.useState)(""),de=h()(ee,2),ue=de[0],y=de[1],g=(0,m.useState)(""),he=h()(g,2),Y=he[0],we=he[1],J=(0,m.useState)(!1),S=h()(J,2),K=S[0],M=S[1],V=function(w){var N={user:{value:me(w)}};y(new et.z(N))},ce=function(w){var N={user:{value:w.target.value}};y(new et.z(N))},je=function(w){oe(w)},te=function(w){var N=w.users.filter(function(A,ae){return A.type=="number"&&!Number(A.value)&&!!A.value});if(!ue.user)s.ZP.warning(f.formatMessage({id:"agent.message.warning.callword"}));else if(N.length>0)s.ZP.warning(f.formatMessage({id:"agent.message.warning.datatype"}));else{M(!0);var $=new Fe.Kr("input","","");w.users.forEach(function(A){var ae=new Fe._w(A.name,A.type?A.type:"string",A.type=="string"?A.value:Number(A.value),A.content,A.status);$.addProperty(A.name,ae)});var R={agent_id:b||Z.agent.agent_id,ability_id:Ze,input_dict:$,prompt:ue};Se(R)}},me=function B(w){return w.map(function(N){return N.type==="mention"?N.id:N.children?B(N.children):N.text}).join("")},Se=function(w){(0,G.LH)(w).then(function(N){s.ZP.success(f.formatMessage({id:"agent.message.success.runpublish"})),we(N.data.outputs.text),M(!1)}).catch(function(N){M(!1)})},Ne=function(){var B=O()(_()().mark(function w(){var N;return _()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,G.Dh)(b||Z.agent.agent_id);case 2:N=R.sent,N.code==0?s.ZP.success(f.formatMessage({id:"agent.message.success.publish"})):s.ZP.error(f.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return R.stop()}},w)}));return function(){return B.apply(this,arguments)}}(),ke=function(){var B=O()(_()().mark(function w(){return _()().wrap(function($){for(;;)switch($.prev=$.next){case 0:E.history.push("/Agents?app_id=".concat(Z.app.app_id,"&type=false")),location.reload();case 2:case"end":return $.stop()}},w)}));return function(){return B.apply(this,arguments)}}();return(0,m.useEffect)(function(){},[]),(0,e.jsxs)("div",{style:{height:"100%"},children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:f.formatMessage({id:"agent.operationrun"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:f.formatMessage({id:"agent.selectivepower"})}),(0,e.jsx)(He.Z,{placeholder:f.formatMessage({id:"agent.pleaseselect"}),defaultValue:f.formatMessage({id:"agent.allability"}),style:{width:390,fontSize:"12px",color:"#BBBBBB",fontWeight:"400"},onChange:je,options:D})]}),(0,e.jsx)("div",{children:(0,e.jsxs)(j.Z,{name:"dynamic_form_nest_item",onFinish:te,style:{width:"100%"},autoComplete:"off",form:k,children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:f.formatMessage({id:"agent.inputvariable"})}),(0,e.jsx)(j.Z.List,{name:"users",children:function(w,N){return Lt()(N),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"w-full flex justify-start items-center text-xs font-medium px-[10px] text-[#213044] h-12 bg-[#F7F7F7]  rounded-t-lg",children:[(0,e.jsx)("div",{className:"mr-5 ml-2.5",children:f.formatMessage({id:"agent.variable.name"})}),(0,e.jsx)("div",{className:"",children:f.formatMessage({id:"agent.variable.value"})})]}),(0,e.jsx)("div",{className:"mb-[30px]",children:w.map(function($){var R=$.key,A=$.name,ae=qe()($,Gt);return(0,e.jsxs)("div",{className:"w-full h-20 flex justify-start  px-2.5 border-b border-x pt-7 last:rounded-b-lg",children:[(0,e.jsx)(j.Z.Item,t()(t()({},ae),{},{name:[A,"content"],children:(0,e.jsx)(ye.Z,{className:"mr-5",style:{color:"#213044",fontWeight:"400",fontSize:"12px"},variant:"borderless",disabled:!0})})),(0,e.jsx)(j.Z.Item,t()(t()({},ae),{},{name:[A,"value"],rules:[{required:!!(k.getFieldsValue()&&k.getFieldsValue().users[R].status==!0),message:f.formatMessage({id:"agent.rules.veriablevalue"})}],children:(0,e.jsx)(ye.Z,{placeholder:k.getFieldsValue()&&k.getFieldsValue().users[R].status==!0?f.formatMessage({id:"agent.variable.required.value"}):f.formatMessage({id:"agent.variable.value"})})}))]})})})]})}}),(0,e.jsxs)(j.Z.Item,{rules:[{required:!0,message:f.formatMessage({id:"agent.rules.callwordvalue"})}],children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:f.formatMessage({id:"agent.runpreview"})}),(0,e.jsx)(Qe.Z,{spinning:K,children:(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-3.5 rounded-lg",children:[(0,e.jsx)("div",{className:"h-[345px] mb-[30px]",children:Y?(0,e.jsx)($t.Z,{language:"python3",value:Y&&JSON.stringify(Y)}):null}),(0,e.jsxs)("div",{className:"agents-input p-2 bg-white border rounded-md my-2 flex items-center justify-between",style:{border:"1px solid #EEE"},children:[(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Rt.Z,{onChange:function(w){V(w)},options:q})}),(0,e.jsx)("div",{className:"w-8 h-8 bg-[#e8effc] rounded-md",children:(0,e.jsx)(xe.ZP,{className:"bg-[#e8effc]",icon:(0,e.jsx)("img",{src:"/icons/fs.svg"}),type:"link",htmlType:"submit",block:!0})})]})]})})]})]})}),(0,e.jsx)("div",{className:"w-28",children:(Z==null?void 0:Z.agent.publish_status)===1&&(Z==null?void 0:Z.is_creator)===1?(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"primary",htmlType:"submit",className:"w-full",onClick:ke,children:f.formatMessage({id:"agent.amend"})})}):(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"primary",htmlType:"submit",className:"w-full",disabled:le!="false",onClick:Ne,children:f.formatMessage({id:"agent.publish"})})})}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})},Kt=Ut,Wt=a(51042),Ht=a(82061),Xt=["key","name"],Yt=ye.Z.TextArea,Jt=function(n){var L=n.SecondValue,Z=n.handleBack,F=n.Detaillist,x=n.setDetaillist,v=n.Sformref,i=n.Operationbentate,k=n.pageKeyfun,D=n.secondjudgingcondition,le=n.SkillMenuClick,q=n.agentupdata,b=(0,E.useIntl)(),f=s.ZP.useMessage(),X=h()(f,2),re=X[0],Ze=X[1],oe=(0,m.useRef)(null),ee=(0,m.useState)({auto_match_ability:0,agent_abilities:[{agent_ability_id:0,name:"string",content:"string",status:0}]}),de=h()(ee,2),ue=de[0],y=de[1];(0,m.useEffect)(function(){});var g=function(S){if(S.users.length==1&&(!S.users[0].content&&S.users[0].name||S.users[0].content&&!S.users[0].name))return s.ZP.warning(b.formatMessage({id:"agent.message.warning.selectknowledgebase"}));var K=S.users.map(function(V){return t()(t()({},V),{},{status:V.status?1:2,agent_ability_id:V.agent_ability_id?V.agent_ability_id:0})}),M={agent_id:F.agent.agent_id,data:{auto_match_ability:F.agent.auto_match_ability,agent_abilities:S.users.length==1&&!S.users[0].content&&!S.users[0].name?[]:K}};i=="false"&&he(),L(t()({},ue))},he=function(){var J=O()(_()().mark(function S(){return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:D()||q();case 1:case"end":return M.stop()}},S)}));return function(){return J.apply(this,arguments)}}(),Y=function(S){x(t()(t()({},F),{},{agent:t()(t()({},F.agent),{},{auto_match_ability:S?1:0})}))},we=function(){setTimeout(function(){oe.current&&oe.current.scrollTo({top:oe.current.scrollHeight,behavior:"smooth"})},100)};return(0,e.jsxs)("div",{style:{height:"100%"},className:"w-full flex-1 sticky top-0",children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:b.formatMessage({id:"agent.Applicationcapabilitysetting"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:(0,e.jsx)(be.Z,{name:b.formatMessage({id:"agent.automatch"}),title:b.formatMessage({id:"agent.explain.automatch"})})}),(0,e.jsx)(Me.Z,{size:"small",checked:!!(F&&F.agent.auto_match_ability==1),onChange:Y})]}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(j.Z,{name:"dynamic_form_nest_item",onFinish:g,style:{width:"100%"},autoComplete:"off",form:v,children:[(0,e.jsx)(j.Z.List,{name:"users",children:function(S,K){var M=K.add,V=K.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"w-full flex items-center justify-between mb-[11px]",children:[(0,e.jsx)("div",{className:" text-[#555555] text-xs font-medium",children:b.formatMessage({id:"agent.capability"})}),(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"link",onClick:function(){M(),we()},block:!0,icon:(0,e.jsx)(Wt.Z,{}),children:b.formatMessage({id:"agent.add"})})})]}),(0,e.jsx)("div",{style:{height:"calc(100vh - 206px)",overflowY:"auto"},className:"overflow-y-auto",ref:oe,children:S.map(function(ce){var je=ce.key,te=ce.name,me=qe()(ce,Xt);return(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-[15px] rounded-lg mb-[20px]",children:[(0,e.jsx)(j.Z.Item,{className:"mb-0",children:(0,e.jsxs)("div",{className:"w-full flex justify-between items-center mb-[15px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium",children:b.formatMessage({id:"agent.capabilityname"})}),(0,e.jsxs)("div",{children:[" ",(0,e.jsx)(Ht.Z,{onClick:function(){return V(te)}})]})]})}),(0,e.jsx)(j.Z.Item,t()(t()({className:"mb-[20px]"},me),{},{name:[te,"name"],rules:[{required:S.length!==1,message:b.formatMessage({id:"agent.capabilityname"})}],children:(0,e.jsx)(ye.Z,{placeholder:b.formatMessage({id:"agent.capabilityname"}),maxLength:50,className:"w-full"})})),(0,e.jsx)("div",{className:"mb-[15px]",children:(0,e.jsx)(be.Z,{className:"text-[#555555] text-xs font-medium",name:b.formatMessage({id:"agent.capabilitydescription"}),title:b.formatMessage({id:"agent.explain.capabilitydescription"})})}),(0,e.jsx)(j.Z.Item,t()(t()({className:"w-full mb-[20px]"},me),{},{name:[te,"content"],rules:[{required:S.length!==1,message:b.formatMessage({id:"agent.capabilitydescription"})}],children:(0,e.jsx)(Yt,{placeholder:b.formatMessage({id:"agent.capabilitydescription"}),autoSize:{minRows:3,maxRows:10},className:"w-full"})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[15px]",children:b.formatMessage({id:"agent.capabilitystatus"})}),(0,e.jsx)(j.Z.Item,t()(t()({className:"mb-[20px]"},me),{},{name:[te,"status"],children:(0,e.jsxs)(H.ZP.Group,{optionType:"button",buttonStyle:"solid",defaultValue:!0,children:[(0,e.jsx)(H.ZP,{value:!0,children:b.formatMessage({id:"agent.capabilitystatus.enable"})}),(0,e.jsx)(H.ZP,{value:!1,children:b.formatMessage({id:"agent.capabilitystatus.disable"})})]})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[11px]",children:b.formatMessage({id:"agent.enableall"})}),(0,e.jsx)(j.Z.Item,{className:"mb-0",name:[te,"output_format"],children:(0,e.jsxs)(H.ZP.Group,{defaultValue:0,children:[(0,e.jsx)(H.ZP,{value:0,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:b.formatMessage({id:"agent.menu"})})}),(0,e.jsx)(H.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text string"})}),(0,e.jsx)(H.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"format json"})}),(0,e.jsx)(H.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})})]})})})]})}}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Qt=Jt,qt=a(13085),ea=a(27842),ta=a(96486),aa=a.n(ta),sa=function(){var n,L,Z,F,x=(0,E.useIntl)(),v=(0,m.useRef)(null),i=j.Z.useForm(),k=h()(i,1),D=k[0],le=j.Z.useForm(),q=h()(le,1),b=q[0],f=j.Z.useForm(),X=h()(f,1),re=X[0],Ze=j.Z.useForm(),oe=h()(Ze,1),ee=oe[0],de=(0,m.useState)(null),ue=h()(de,2),y=ue[0],g=ue[1],he=(0,m.useState)(0),Y=h()(he,2),we=Y[0],J=Y[1],S=(0,m.useState)(null),K=h()(S,2),M=K[0],V=K[1],ce=(0,m.useState)(null),je=h()(ce,2),te=je[0],me=je[1],Se=(0,m.useState)(null),Ne=h()(Se,2),ke=Ne[0],B=Ne[1],w=(0,m.useState)(null),N=h()(w,2),$=N[0],R=N[1],A=(0,m.useState)(null),ae=h()(A,2),Xe=ae[0],I=ae[1],p=(0,m.useState)(null),Q=h()(p,2),z=Q[0],W=Q[1],fe=(0,m.useState)(null),Te=h()(fe,2),Pa=Te[0],Aa=Te[1],ia=(0,m.useState)(null),tt=h()(ia,2),at=tt[0],la=tt[1],ra=(0,m.useState)(null),st=h()(ra,2),_e=st[0],oa=st[1],da=(0,m.useState)("1"),nt=h()(da,2),ge=nt[0],Ie=nt[1],ua=(0,m.useState)(null),it=h()(ua,2),ca=it[0],lt=it[1],ma=(0,m.useState)(null),rt=h()(ma,2),fa=rt[0],ga=rt[1],pa=(0,m.useState)(null),ot=h()(pa,2),ha=ot[0],dt=ot[1],va=(0,m.useState)(null),ut=h()(va,2),Pe=ut[0],ct=ut[1],xa=(0,m.useState)(!0),mt=h()(xa,2),ft=mt[0],Ve=mt[1],ba=(0,m.useState)({first:!1,second:!1,fourthly:!1}),gt=h()(ba,2),Ae=gt[0],Be=gt[1],ya=[{key:"1",icon:(0,e.jsx)(Ue.Z,{}),label:x.formatMessage({id:"agent.menu.basicsetup"}),disabled:Ae.first,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",lineHeight:"22px",color:ge=="1"?"#1B64F3":"#213044"}},{key:"2",disabled:Ae.second,icon:(0,e.jsx)(Ke.Z,{}),label:x.formatMessage({id:"agent.menu.Capacityoutput"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:ge=="2"?"#1B64F3":"#213044"}},{key:"5",disabled:Ae.fourthly,icon:(0,e.jsx)(ne.Z,{}),label:x.formatMessage({id:"app.dashboard.run_log_agent"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:ge=="5"?"#1B64F3":"#213044"}}];(0,m.useEffect)(function(){var C=new URLSearchParams(window.location.search);C.get("app_id")||(Be(t()(t()({},Ae),{},{first:!1,second:!0,fourthly:!0})),Ve(!1)),Oe()},[]);var Oe=function(){var C=O()(_()().mark(function r(o){var l,u,c,d,wt,Je,St,Nt;return _()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(u=new URLSearchParams(window.location.search),u.get("from")&&ga(u.get("from")),c=null,!(u.get("app_id")||o)){pe.next=10;break}return pe.next=6,(0,G.ek)(o||u.get("app_id"),u.get("type"));case 6:c=pe.sent,ct(c.data.app.app_id),pe.next=13;break;case 10:return pe.next=12,(0,ve.cI)();case 12:c=pe.sent;case 13:d=c.data,wt=(l=c.data)===null||l===void 0||(l=l.agent_dataset_relation_list)===null||l===void 0?void 0:l.map(function(T){return T.dataset_id}),V(wt),g(c.data),oa(c.data.agent.publish_status===0&&c.data.is_creator===1?"false":"true"),c.data.agent.publish_status===1&&s.ZP.warning(x.formatMessage({id:"agent.message.listwarning"}),5),D.setFieldsValue(pt(d.agent.input_variables)),Je=c.data.agent_abilities_list.map(function(T){return T.status==1?t()(t()({},T),{},{status:!0}):t()(t()({},T),{},{status:!1})}),re.setFieldsValue({users:Je[0]?Je:[{agent_ability_id:0,name:"",content:"",status:!0,output_format:0}]}),B(Ye(d.agent_abilities_list)),R(Ye(d.agent_abilities_list)),St=d.agent_abilities_list.filter(function(T){return T.output_format!==0}),b.setFieldsValue({users:St.map(function(T){return{agent_ability_id:T.agent_ability_id,output_format:T.output_format}})}),ee.setFieldsValue(pt(d.agent.input_variables)),I(d.m_configurations_list.map(function(T){return{value:T.m_config_id?T.m_config_id:T.model_config_id,label:T.m_name?T.m_name:T.model_name}})),d.agent.m_config_id||d.agent.model_config_id?W(d.agent.m_config_id?d.agent.m_config_id:d.agent.model_config_id):W(d.m_configurations_list[0].model_config_id),Nt=d.agent_abilities_list.filter(function(T,Da){return T.status===1}),la(Ye(Nt).concat([{value:0,label:x.formatMessage({id:"agent.allability"})}])),Ve(!1);case 32:case"end":return pe.stop()}},r)}));return function(o){return C.apply(this,arguments)}}(),pt=function(r){var o={users:r&&r.properties?Object.values(r.properties).map(function(l){return t()({name:l.name,type:l.type,content:l.display_name,status:l.required},l)}):[{name:"",content:"",type:"string",agent_ability_id:0,output_format:0,status:0}]};return o},Ye=function(r){return r.map(function(o){return{value:o.agent_ability_id,label:o.name}})},ja=function(r){Ft(r,1),ee.setFieldsValue(D.getFieldsValue())},_a=function(){Oe()},ht=function(r){J(r)},Fa=function(){E.history.back()},vt=function(){if(!y.agent.input_variables)return s.ZP.warning(x.formatMessage({id:"agent.message.warning.variable"})),!0;if(aa().isEmpty(y.agent.input_variables.properties))return s.ZP.warning(x.formatMessage({id:"agent.message.warning.variable"})),!0;if(z)if(y.agent.obligations){if(wa(D.getFieldsValue().users,"name"))return s.ZP.warning(x.formatMessage({id:"agent.message.warning.repetition"})),!0}else return s.ZP.warning(x.formatMessage({id:"agent.message.warning.functiondescribe"})),!0;else return s.ZP.warning(x.formatMessage({id:"agent.message.warning.LLM"})),!0;return!1},xt=function(){var r=re.getFieldsValue().users.filter(function(l){return!!l}),o=r.filter(function(l){return!l.name||!l.content});return o.length!==0&&!(o.length==1&&o[0].name==""&&o[0].content=="")?(s.ZP.warning(x.formatMessage({id:"agent.message.warning.integritycapacity"})),!0):!1},bt=function(r){if((r==null?void 0:r.key)=="4"){var o=D.getFieldsValue().users.map(function(l){return{value:"<<".concat(De.qX,".inputs.").concat(l.name,">>"),label:l.name}});lt(o)}Ie(r.key)},yt=function(){Ve(!0);var r=0;return new Promise(function(o,l){Pe?(0,G.ek)(Pe,!1).then(function(u){r=u.data.agent.agent_id,jt(r),o(""),setTimeout(function(){_t(r),s.ZP.success(x.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Oe(Pe)},1e3),dt(r)}).catch(function(u){o("")}):(0,ze.uy)((0,ve.Go)("GET")).then(function(u){ct(u.data.app_id),(0,G.ek)(Pe||u.data.app_id,!1).then(function(c){o(c),r=c.data.agent.agent_id,jt(r),u.data.app_id&&E.history.replace("/Agents?app_id=".concat(u.data.app_id,"&type=false")),setTimeout(function(){_t(r),s.ZP.success(x.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Oe(u.data.app_id);var d=t()(t()({},(0,ve.Go)("GET")),{},{app_id:u.data.app_id});(0,ve.Go)("SET",d)},1e3),dt(r)}).catch(function(c){o("")})}).catch(function(u){console.log(u)})})},jt=function(r,o){D.validateFields().then(function(l){var u={agent_id:r,data:{is_public:y.app.is_public,enable_api:y.app.enable_api,attrs_are_visible:y.app.attrs_are_visible,obligations:y.agent.obligations,input_variables:y.agent.input_variables?y.agent.input_variables:Sa(D.getFieldsValue()),dataset_ids:M,m_config_id:z,allow_upload_file:y.agent.allow_upload_file,default_output_format:y.agent.default_output_format}};_e=="false"&&Ft(u,1),ee.setFieldsValue(D.getFieldsValue());var c=D.getFieldsValue().users.map(function(d){return{value:"<<".concat(De.qX,".inputs.").concat(d.name,">>"),label:d.name}});lt(c),o&&Ie(o.key)}).catch(function(l){})},_t=function(r){var o=re.getFieldsValue().users.filter(function(c){return!!c}),l=o.map(function(c){return t()(t()({},c),{},{status:c.status==!1?2:1,agent_ability_id:c.agent_ability_id?c.agent_ability_id:0,output_format:c.output_format?c.output_format:0})}),u={agent_id:r,data:{auto_match_ability:y.agent.auto_match_ability,agent_abilities:l}};_e=="false"&&(l.length==1&&l[0].name==""&&l[0].content==""?Be({first:!1,second:!1,fourthly:!1}):(0,G.Iw)(u).then(function(c){c.code==0&&Be({first:!1,second:!1,fourthly:!1})}).catch(function(c){}))},Ft=function(){var C=O()(_()().mark(function r(o,l){var u;return _()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(_e!=="false"){d.next=19;break}if(l!==1){d.next=7;break}return d.next=4,(0,G.XB)(o);case 4:d.t0=d.sent,d.next=17;break;case 7:if(l!==2){d.next=13;break}return d.next=10,(0,G.Iw)(o);case 10:d.t1=d.sent,d.next=16;break;case 13:return d.next=15,(0,G.Ce)(o);case 15:d.t1=d.sent;case 16:d.t0=d.t1;case 17:u=d.t0,u&&u.code===0&&Ve(!1);case 19:case"end":return d.stop()}},r)}));return function(o,l){return C.apply(this,arguments)}}(),wa=function(r,o){var l=new Set;return r.some(function(u){var c=u[o];return l.has(c)?l.add(c):l.add(c)&&!1})},Sa=function(r){var o=new Fe.Kr("input","","");return r.users.forEach(function(l){var u=new Fe._w(l.name,l.type?l.type:"string",l.value?l.value:"",l.content,l.status);o.addProperty(l.name,u)}),o};return(0,e.jsxs)("div",{className:" flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsxs)("div",{className:"flex flex-col w-[300px]",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"flex w-full items-center bg-white px-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsxs)(xe.ZP,{type:"link",shape:"circle",size:"middle",className:"",onClick:Fa,children:[(0,e.jsx)(U.Z,{}),(0,e.jsx)("span",{className:"text-sm font-medium text-[#213044]",children:fa=="chat_room"?x.formatMessage({id:"agent.back_meeting"}):x.formatMessage({id:"agent.back"})})]})}),(0,e.jsxs)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:[(0,e.jsx)(Zt.Z,{selectedKeys:[ge],onClick:bt,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[ge],mode:"inline",items:ya}),y&&((n=y.app)===null||n===void 0?void 0:n.enable_api)===1&&((L=y.app)===null||L===void 0?void 0:L.publish_status)===1?(0,e.jsx)("div",{className:"w-full h-[40px] rounded-lg text-[#000] hover:bg-[#f0f0f0] p-[12px] pl-[16px] cursor-pointer",onClick:O()(_()().mark(function C(){var r,o;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r=new URLSearchParams(window.location.search),o=null,!r.get("app_id")){u.next=6;break}return u.next=5,(0,G.ek)(r.get("app_id"),r.get("type"));case 5:o=u.sent;case 6:o!=null&&o.data.app.enable_api===1&&o.data.app.publish_status===1?window.open(Ge._n+y.app.api_url):s.ZP.warning(x.formatMessage({id:"agent.save.and.click"}),5);case 7:case"end":return u.stop()}},C)})),children:(0,e.jsxs)("div",{className:"mr-[20px] text-base font-medium text-[#213044] -mt-1",children:[(0,e.jsx)(P.Z,{className:"mr-3"}),x.formatMessage({id:"agent.visit"})," API"]})}):null]})]}),(0,e.jsx)("div",{className:"flex-1 relative w-[calc(100%-300px)]",children:(0,e.jsxs)(We.Z,{style:{height:"100%",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)"},children:[(0,e.jsx)(We.Z.Panel,{defaultSize:"50%",min:"40%",max:"70%",children:(0,e.jsx)(Qe.Z,{spinning:ft,size:"large",className:"mt-[112px] mr-4",children:(0,e.jsx)("div",{className:"flex flex-col",style:{height:"calc(100vh - 56px)",overflowY:"scroll",scrollbarWidth:"none"},children:(0,e.jsxs)("div",{className:"px-[30px] ",style:{overflowX:"auto",height:"100%"},children:[(0,e.jsx)("div",{className:"w-full flex justify-center  mt-[30px]",children:(0,e.jsxs)("div",{className:"flex items-center w-full ",children:[(0,e.jsx)("div",{className:"mr-[10px] w-[16px] h-[16px]",children:(0,e.jsx)("img",{src:"/icons/flag.svg",alt:"",className:"w-[16px] h-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"mr-[6px] text-lg text-[#213044] font-medium",children:[(Z=(0,ve.Go)("GET"))!==null&&Z!==void 0&&Z.app_id?x.formatMessage({id:"agent.compile"}):x.formatMessage({id:"agent.created"})," ",x.formatMessage({id:"agent"})]}),(y==null||(F=y.app)===null||F===void 0?void 0:F.publish_status)===1?(0,e.jsx)("div",{className:"bg-[#1B64F3] px-[7px] text-[#fff] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:x.formatMessage({id:"agent.havepublished"})}):(0,e.jsx)("div",{className:" bg-[#EEE] px-[7px]  text-[#999] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:x.formatMessage({id:"agent.unpublish"})})]})]})}),(0,e.jsx)("div",{style:{display:ge==="1"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:!ft&&(0,e.jsx)(Vt,{FirstValue:ja,Ffromref:D,Detaillist:y,setDetaillist:g,repository:M,setRepository:V,Newproperties:te,setNewproperties:me,Operationbentate:_e,Fourthly_config_id:z,setFourthly_config_id:W,Fourthly_select_list:Xe,pageKeyfun:Ie,firstjudgingcondition:vt,agentmenudisabled:Ae,setAgentmunudisabled:Be})}),(0,e.jsx)("div",{style:{display:ge==="2"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center",position:"sticky",top:"-150px"},children:(0,e.jsx)(Qt,{SecondValue:_a,Detaillist:y,setDetaillist:g,Sformref:re,Operationbentate:_e,handleBack:ht,pageKeyfun:Ie,SkillMenuClick:bt,secondjudgingcondition:xt,agentupdata:yt})}),(0,e.jsx)("div",{style:{display:ge==="4"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Kt,{handleBack:ht,Detaillist:y,setDetaillist:g,Fourthly_select_list:Xe,Fourthly_config_id:z,setFourthly_config_id:W,Fourthlyref:ee,Fourthly_abilities_list:at,Operationbentate:_e,callwordlist:ca,newagentid:ha})})]})})})}),(0,e.jsx)(We.Z.Panel,{children:(0,e.jsx)("div",{children:(0,e.jsx)(qt.Z,{saveInfo:{firstjudgingcondition:vt,secondjudgingcondition:xt,agentupdata:yt},operationbentate:_e,data:{abilitiesList:at,detailList:y}})})}),ge=="5"&&(0,e.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-slate-50 w-full h-full z-10",children:(0,e.jsx)(ea.ZP,{agent_id:y.agent.agent_id})})]})})]})},na=sa}}]);
