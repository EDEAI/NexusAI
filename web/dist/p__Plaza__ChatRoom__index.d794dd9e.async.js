"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{82826:function(Ce,re,n){n.d(re,{Z:function(){return G}});var ce=n(1413),Z=n(67294),oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},M=oe,ue=n(91146),A=function(xe,fe){return Z.createElement(ue.Z,(0,ce.Z)((0,ce.Z)({},xe),{},{ref:fe,icon:M}))},de=Z.forwardRef(A),G=de},23595:function(Ce,re,n){n.r(re),n.d(re,{default:function(){return nt}});var ce=n(19632),Z=n.n(ce),oe=n(97857),M=n.n(oe),ue=n(15009),A=n.n(ue),de=n(99289),G=n.n(de),je=n(13769),xe=n.n(je),fe=n(5574),I=n.n(fe),Ae=n(47635),te=n(43722),q=n(32332),ie=n(1413),s=n(67294),Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},Me=Te,Ne=n(91146),Ie=function(c,r){return s.createElement(Ne.Z,(0,ie.Z)((0,ie.Z)({},c),{},{ref:r,icon:Me}))},De=s.forwardRef(Ie),Fe=De,Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},ke=Ee,Le=function(c,r){return s.createElement(Ne.Z,(0,ie.Z)((0,ie.Z)({},c),{},{ref:r,icon:ke}))},Oe=s.forwardRef(Le),Pe=Oe,k=n(35312),Ze=n(26915),pe=n(74330),Be=n(2453),Ue=n(20640),Se=n.n(Ue),me=n(96486),he=n(22683),ge=n(97807),ze=n(82826),Ve=n(63783),He=n(3471),$e=n(28036),Ge=n(83062),be=n(72269),le=n(32983),Je=n(92004),e=n(85893),Ke=function(c){var r=(0,k.useIntl)(),N=c.setsendMessage,y=c.truncatable,m=c.messageApi,D=c.roomDetail,x=c.disableInput,S=c.setAgent,w=(0,k.useParams)(),f=w.id,R=(0,s.useState)([]),b=I()(R,2),g=b[0],h=b[1],T=(0,s.useState)(M()({},D)),a=I()(T,2),E=a[0],p=a[1],z=(0,s.useState)([]),B=I()(z,2),v=B[0],L=B[1],V=(0,s.useRef)(!1),J=(0,s.useRef)(!1),K=(0,s.useState)(!1),H=I()(K,2),$=H[0],se=H[1],O=function(){N("TRUNCATE","0")},U=function(){var i=G()(A()().mark(function o(){var d;return A()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!f){j.next=5;break}return j.next=3,(0,te.cH)({id:f});case 3:if(d=j.sent,d.code==0)try{p(function(){return M()(M()({},d.data.chat_info),{},{max_round:d.data.max_round,smart_selection:d.data.smart_selection})}),h(d.data.agent_list),V.current=!0}catch(ee){}case 5:case"end":return j.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),ae=function(){var i=G()(A()().mark(function o(){var d;return A()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,te.j2)({id:f});case 2:d=j.sent,d.code==0&&(L(d.data.list),J.current=!0);case 4:case"end":return j.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),C=function(){var i=G()(A()().mark(function o(d){var W,j,ee;return A()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!f){P.next=11;break}if(W=d.active==1?0:1,W!=0){P.next=7;break}if(j=g.filter(function(X){return X.active==1}),j.length-1!=0){P.next=7;break}return m.open({type:"error",content:r.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),P.abrupt("return",!1);case 7:return P.next=9,(0,te.sT)({active:W},f,d.agent_id);case 9:ee=P.sent,ee.code==0&&h(function(X){return X.map(function(ne){return M()(M()({},ne),{},{active:ne.agent_id==d.agent_id?W:ne.active})})});case 11:case"end":return P.stop()}},o)}));return function(d){return i.apply(this,arguments)}}(),u=function(o){return o.length>6?o.length=6:o.lenth,o},l=function(o){o.type=="my_agent"?k.history.push("/Agents?app_id=".concat(o.app_id,"&type=false&from=chat_room")):k.history.push("/ReadOnlyAgent?app_id=".concat(o.app_id,"&type=true&from=chat_room"))},Q=function(o){k.history.replace("/chat_room/".concat(o.chatroom_id)),window.location.reload()},F=function(){se(!0)},Y=function(){se(!1)},we=function(){var i=G()(A()().mark(function o(d){var W,j,ee;return A()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return W=Z()(d.checkAgent).map(function(X){var ne=X.agent_id,Re=X.active,ct=Re===void 0?1:Re;return{agent_id:ne,active:ct}}),j={description:E.description,name:E.name,max_round:E.max_round},P.next=4,(0,te.sI)(M()(M()({},j),{},{agent:W}),f);case 4:ee=P.sent,ee.code==0?(d.checkAgent.map(function(X){X.active=X.active==null?1:X.active}),h(Z()(d.checkAgent)),S.current=Z()(d.checkAgent),m.open({type:"success",content:r.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):m.open({type:"error",content:r.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 6:case"end":return P.stop()}},o)}));return function(d){return i.apply(this,arguments)}}(),_=function(){var i=G()(A()().mark(function o(){var d;return A()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return d=E.smart_selection==1?0:1,j.next=3,(0,te.r5)({smart_selection:d},f);case 3:p(function(ee){return M()(M()({},ee),{},{smart_selection:d})});case 4:case"end":return j.stop()}},o)}));return function(){return i.apply(this,arguments)}}();return(0,s.useEffect)(function(){U(),ae()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){k.history.go(-1)},children:[(0,e.jsx)($e.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(ze.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:r.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:E.name})]})}),(0,e.jsx)("div",{className:"h-[327px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsxs)("div",{className:"flex gap-x-[5px] flex-1",children:[(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_title"})}),(0,e.jsxs)("div",{onClick:F,children:[(0,e.jsx)("img",{src:"/icons/edit_icon_1.svg",className:"w-[16px] h-[16px] shrink-0"})," "]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(Ge.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:r.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ve.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:r.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(be.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:E.smart_selection==1,onChange:_,disabled:x})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:V.current?(0,e.jsx)("div",{className:"flex flex-col",children:g&&g.length>0?g.map(function(i){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,q.s9)("single",i.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:i.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:i.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){l(i)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(be.Z,{size:"small",disabled:x,defaultChecked:!0,className:"w-[28px]",checked:i.active==1,onChange:function(){C(i)}})]})]},i.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(le.Z,{image:le.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(pe.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px]",children:(0,e.jsx)("div",{style:y&&!x?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,me.throttle)(function(){y&&!x&&O()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:r.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:J.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:v&&v.length>0?v.map(function(i){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){Q(i)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:i.name}),i.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:i.agent_list&&i.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[u(i.agent_list).map(function(o,d){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,q.s9)("single",o.icon),alt:"",className:"w-[18px]  h-[18px]"})})},d)}),i.agent_list.length>=6?(0,e.jsx)(He.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},i.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(le.Z,{image:le.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(pe.Z,{})})})})]})]}),$?(0,e.jsx)(Je.Z,{show:$,popupClose:Y,popupSave:we,checkList:g,zIndex:99}):(0,e.jsx)(e.Fragment,{})]})})},Qe=(0,s.memo)(Ke),We=["node","className","children"],Xe=Ze.Z.TextArea,Ye=(0,s.memo)(function(t){var c=t.disableInput,r=t.setsendMessage,N=t.setDisableInput,y=t.messageApi,m=t.isStop,D=t.scrollDomRef,x=t.upButtonDom,S=(0,k.useIntl)(),w=(0,s.useState)(""),f=I()(w,2),R=f[0],b=f[1],g=function(a){!a.shiftKey&&a.target.value==""&&(y.open({type:"warning",content:S.formatMessage({id:"app.chatroom.content.input"}),duration:10}),b(""),a.preventDefault()),!a.shiftKey&&a.keyCode==13&&a.target.value!=""&&(N(!0),b(""),r("INPUT",a.target.value),a.preventDefault())},h=(0,me.throttle)(function(){r("STOP",null)},300);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:x,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(a){D.current.scrollTo({top:D.current.scrollHeight,behavior:"smooth"})},children:(0,e.jsx)(Fe,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(Xe,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:R,disabled:c,onChange:function(a){b(a.target.value)},onPressEnter:g,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(S.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),m?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:h,children:(0,e.jsx)(Pe,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(c||!R?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,me.throttle)(function(){if(c||!R)return!1;R||y.open({type:"warning",content:S.formatMessage({id:"app.chatroom.content.input"}),duration:10}),N(!0),r("INPUT",R),b("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})}),qe=function t(c){return typeof c=="string"?c:Array.isArray(c)?c.map(t).join(""):s.isValidElement(c)?t(c.props.children):""},_e=function(c){return qe(c)},ve=function(c,r){return{code:function(y){var m=y.node,D=y.className,x=y.children,S=xe()(y,We),w=/language-(\w+)/.exec(D||"");if(w!=null&&w.length){var f=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:w[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var R=G()(A()().mark(function b(g){var h;return A()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,h=g.currentTarget,a.next=4,Se()(_e(x));case 4:h&&(h.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){h&&(h.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copycode"}))},200),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.error("Failed to copy text: ",a.t0);case 11:case"end":return a.stop()}},b,null,[[0,8]])}));return function(b){return R.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:r.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(f).concat(c),className:"p-4",children:x})})]})}else return(0,e.jsx)("code",M()(M()({},S),{},{children:x}))}}},ye=(0,s.memo)(function(t){var c=t.messageApi,r=t.index,N=t.idName,y=t.cidName,m=(0,k.useIntl)(),D=(0,s.useState)(!1),x=I()(D,2),S=x[0],w=x[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){w(!0)},onMouseLeave:function(){w(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var f=G()(A()().mark(function R(b){var g,h;return A()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g=b.target.closest("#".concat(N).concat(r)),h=g.querySelector("#".concat(y).concat(r)),a.prev=2,a.next=5,Se()(h.innerText);case 5:c.open({type:"success",content:m.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(2),console.error("Failed to copy text: ",a.t0);case 11:case"end":return a.stop()}},R,null,[[2,8]])}));return function(R){return f.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(S?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(S?" text-[#1B64F3]":"text-[#666]"),children:m.formatMessage({id:"app.chatroom.content.copy"})})]})})}),et=(0,s.memo)(function(t){var c=t.messageApi,r=t.scrollDomRef,N=t.instruction,y=t.setDisableInput,m=t.setIsStop,D=t.setTruncatable,x=t.upButtonDom,S=t.setInstruction,w=t.agentList,f=t.isRoomSuccess,R=(0,k.useIntl)(),b=(0,k.useParams)(),g=b.id,h=(0,s.useState)([]),T=I()(h,2),a=T[0],E=T[1],p=(0,s.useRef)(!1),z=(0,s.useState)(""),B=I()(z,2),v=B[0],L=B[1],V=(0,s.useRef)(null),J=(0,s.useRef)(null),K=(0,s.useRef)(!0),H=(0,s.useRef)(2),$=(0,s.useRef)(1),se=(0,s.useRef)(!1),O=function(){var C=G()(A()().mark(function u(l){var Q,F,Y=arguments;return A()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(Q=Y.length>1&&Y[1]!==void 0?Y[1]:function(){},!g){_.next=6;break}return _.next=4,(0,te.KH)(g,{page:$.current,page_size:20});case 4:F=_.sent,F.code==0&&(H.current=F.data.total_pages,E(function(i){return l?Z()(F.data.list):[].concat(Z()(F.data.list),Z()(i))}),l?setTimeout(function(){r.current.scrollTop=r.current.scrollHeight,x.current.style.display="none"}):Q({length:F.data.list.length}));case 6:case"end":return _.stop()}},u)}));return function(l){return C.apply(this,arguments)}}(),U=function(u){var l=u.target.scrollHeight-u.target.scrollTop-u.target.clientHeight;if(p.current!==Math.ceil(l)>50&&(p.current=Math.ceil(l)>50,x.current.style.display=p.current?"flex":"none"),u.target.scrollTop==0&&K.current){K.current=!1;var Q=V.current.firstChild;$.current=$.current+1,J.current.style.display="flex",H.current,H.current>=$.current?O(!1,function(F){J.current.style.display="none",setTimeout(function(){var Y=0;Q.offsetTop==0?Y=V.current.children[F.length].offsetTop:Y=Q.offsetTop,r.current.scrollTop=Y,K.current=!0})}):J.current.style.display="none"}},ae=function(u,l){l==="0"&&(l=Number(l));var Q=["".concat(u),l===0||l?l:null];L(JSON.stringify(Q))};return(0,s.useEffect)(function(){N&&N.length&&(ae(N[0],N[1]?N[1]:""),S([]))},[N]),(0,s.useEffect)(function(){$.current=1,O(!0)},[]),(0,e.jsxs)("div",{className:"flex-1 box-border relative overflow-y-auto chatroom",ref:r,onScroll:U,children:[(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:J,children:(0,e.jsx)(pe.Z,{})}),(0,e.jsxs)("div",{className:"max-w-[920px] mx-auto",ref:V,children:[a.map(function(C,u){return(0,e.jsxs)("div",{id:"c".concat(C.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(C.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:C.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",C.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(u),children:[(0,e.jsx)("div",{className:"".concat(C.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:C.name?C.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:C.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"chilContent".concat(u),children:(0,e.jsx)(he.U,{rehypePlugins:[ge.Z],components:ve(u,R),children:C.content})}),C.is_agent==1?(0,e.jsx)(ye,{messageApi:c,idName:"content",cidName:"chilContent",index:u}):(0,e.jsx)(e.Fragment,{})]})]},u)}),(0,e.jsx)(tt,{messageApi:c,setUserMessage:E,sendValue:v,agentList:w,scrollDomRef:r,upButtonDom:x,setDisableInput:y,setIsStop:m,setTruncatable:D,setSendValue:L,isRoomSuccess:f})]})]})}),tt=(0,s.memo)(function(t){var c=t.messageApi,r=t.setUserMessage,N=t.sendValue,y=t.agentList,m=t.scrollDomRef,D=t.upButtonDom,x=t.setDisableInput,S=t.setIsStop,w=t.setTruncatable,f=t.setSendValue,R=t.isRoomSuccess,b=(0,k.useIntl)(),g=(0,s.useState)([]),h=I()(g,2),T=h[0],a=h[1],E=(0,s.useState)(!1),p=I()(E,2),z=p[0],B=p[1];return(0,s.useEffect)(function(){z&&(r(function(v){return[].concat(Z()(v),Z()(T))}),a([]),setTimeout(function(){B(!1),m.current.scrollTop=m.current.scrollHeight},200))},[z]),(0,e.jsxs)(e.Fragment,{children:[T.length?T.map(function(v,L){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(v.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:v.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",v.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(L),children:[(0,e.jsx)("div",{className:"text-left font-[500] text-[14px] text-[#213044] pb-[8px]",children:v.name?v.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:v.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"currentChilContent".concat(L),children:(0,e.jsx)(he.U,{rehypePlugins:[ge.Z],components:ve(L,b),children:v.content})}),v.is_agent==1?(0,e.jsx)(ye,{messageApi:c,index:L,idName:"currentContent",cidName:"currentChilContent"}):(0,e.jsx)(e.Fragment,{})]})]},L)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(st,{messageApi:c,setCurrentMessageContent:a,sendValue:N,agentList:y,scrollDomRef:m,upButtonDom:D,setDisableInput:x,setIsStop:S,setTruncatable:w,setisEnd:B,setSendValue:f,isRoomSuccess:R})]})}),st=(0,s.memo)(function(t){var c=t.messageApi,r=t.setCurrentMessageContent,N=t.sendValue,y=t.agentList,m=t.scrollDomRef,D=t.upButtonDom,x=t.setDisableInput,S=t.setIsStop,w=t.setTruncatable,f=t.setisEnd,R=t.setSendValue,b=t.isRoomSuccess,g=(0,k.useIntl)(),h=(0,k.useParams)(),T=h.id,a=(0,s.useState)({}),E=I()(a,2),p=E[0],z=E[1],B=(0,s.useRef)(!1),v=(0,s.useRef)(""),L=function(se){var O=se.data;if(O.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var U=JSON.parse(O.slice(22,-2));switch(U[0]){case"ERROR":x(!1),S(!1),R(""),c.open({type:"error",content:"webSocket-".concat(U[1]),duration:10});break;case"CHAT":var ae={content:"".concat(U[1]),is_agent:0};r(function(l){return[].concat(Z()(l),[ae])}),setTimeout(function(){m.current.scrollTop=m.current.scrollHeight,D.current.style.display="none"});break;case"STOPPABLE":S(U[1]);break;case"TRUNCATABLE":w(U[1]),U[1]||c.open({type:"success",content:"".concat(g.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":c.open({type:"success",content:"".concat(g.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(O.indexOf("REPLY")!==-1&&O.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var C=JSON.parse(O.slice(22,-2))[1];v.current="",B.current=!0;var u=y.current.filter(function(l){return l.agent_id==C})[0];Object.keys(p).length&&r(function(l){return[].concat(Z()(l),[p])}),z(function(l){return M()(M()({},l),{},{is_agent:1,icon:u==null?void 0:u.icon,name:u==null?void 0:u.name})}),S(!0),w(!1)}O.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&B.current&&(m.current.scrollTop=m.current.scrollHeight,D.current.style.display="none",v.current+=O,z(function(l){return M()(M()({},l),{},{content:v.current})})),O.indexOf("ENDCHAT")!==-1&&(B.current=!1,v.current="",x(!1),S(!1),w(!0),Object.keys(p).length&&r(function(l){return[].concat(Z()(l),[p])}),z({}),f(!0),R(""))},V=(0,Ae.Z)("chat",L),J=V.runSocket,K=V.sendMessage,H=V.readyState;return(0,s.useEffect)(function(){H==1&&T&&b&&K(JSON.stringify(["ENTER",parseInt(T)]))},[H,b]),(0,s.useEffect)(function(){N&&H==1&&K(N)},[N]),(0,s.useEffect)(function(){J()},[]),(0,e.jsx)(e.Fragment,{children:p.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(p.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:p.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",p.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"text-left font-[500] text-[14px] text-[#213044] pb-[8px]",children:p.name?p.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:p.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"addchilContent",children:(0,e.jsx)(he.U,{rehypePlugins:[ge.Z],components:ve("add",g),children:p.content})})]})]}):(0,e.jsx)(e.Fragment,{})})}),at=(0,s.memo)(function(){var t=(0,k.useParams)(),c=t.id,r=(0,s.useRef)([]),N=Be.ZP.useMessage(),y=I()(N,2),m=y[0],D=y[1],x=(0,s.useRef)(null),S=(0,s.useRef)(null),w=(0,s.useState)([]),f=I()(w,2),R=f[0],b=f[1],g=(0,s.useState)(!1),h=I()(g,2),T=h[0],a=h[1],E=(0,s.useState)(!1),p=I()(E,2),z=p[0],B=p[1],v=(0,s.useState)(!1),L=I()(v,2),V=L[0],J=L[1],K=(0,s.useRef)(null),H=(0,s.useState)(!1),$=I()(H,2),se=$[0],O=$[1],U=function(u,l){b([u,l])},ae=function(){var C=G()(A()().mark(function u(){var l;return A()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!c){F.next=5;break}return F.next=3,(0,te.cH)({id:c});case 3:l=F.sent,l.code==0?(O(!0),K.current=l.data,r.current=l.data.agent_list):k.history.replace("/meeting");case 5:case"end":return F.stop()}},u)}));return function(){return C.apply(this,arguments)}}();return(0,s.useEffect)(function(){ae()},[]),(0,e.jsxs)(e.Fragment,{children:[D,(0,e.jsxs)("div",{className:"w-full flex bg-[#fff]",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(Qe,{roomDetail:K.current,messageApi:m,setsendMessage:U,truncatable:V,disableInput:T,setAgent:r}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px]   overflow-auto",style:{height:"calc(100% )"},children:(0,e.jsxs)("div",{className:"flex flex-col w-full",children:[(0,e.jsx)(et,{instruction:R,setInstruction:b,messageApi:m,scrollDomRef:x,setDisableInput:a,setIsStop:B,setTruncatable:J,upButtonDom:S,agentList:r,isRoomSuccess:se}),(0,e.jsx)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:(0,e.jsx)(Ye,{disableInput:T,setsendMessage:U,setDisableInput:a,messageApi:m,isStop:z,upButtonDom:S,scrollDomRef:x})})]})})})]})]})}),nt=at}}]);
