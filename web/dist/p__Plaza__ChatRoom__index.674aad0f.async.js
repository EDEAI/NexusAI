"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{86:function(st,De,f){var Ze=f(5574),D=f.n(Ze),Be=f(32332),ae=f(38703),ve=f(67294),m=f(85893),pe=function(a){var X=a.subtitle,ze=a.handleClick,ie=a.lineClamp,ge=ie===void 0?2:ie,G=a.textDetails,he=a.title,Ie=a.icon,Ae=a.iconType,Ce=Ae===void 0?"":Ae,Ee=a.operation,be=Ee===void 0?"":Ee,_e=a.progress,fe=a.status,Pe=a.backlogTips,Me=(0,ve.useState)(0),je=D()(Me,2),Se=je[0],Re=je[1],Oe=function(){Re(_e)},Ue=function(){Re(0)},Te=function(e){return"rounded-[4px] border-l-[4px] ".concat(e==1?"border-[#1B64F3]":e==2?"border-[#52C41C]":"border-[#F04444]"," ")};return(0,m.jsxs)("div",{className:"flex  p-[10px] cursor-pointer overflow-hidden relative bg-[#fff] ".concat(fe!==void 0?Te(fe):"graphicbox"),onClick:ze,onMouseEnter:function(){_e!=null&&Oe()},onMouseLeave:function(){_e!=null&&Ue()},children:[fe!==void 0&&(0,m.jsx)("div",{style:{width:"".concat(Se,"%"),transition:"width 0.5s "},className:"absolute bottom-0 left-0 top-0 bottom-0 h-full ".concat(fe==1?"bg-[#1B64F3]/[.03]":fe==2?"bg-[#52c41c]/[.05]":"bg-[#FAFAFA]"," ")}),(0,m.jsxs)("div",{className:"flex gap-x-[20px] w-full relative z-20",children:[(0,m.jsx)("div",{className:"shrink-0 flex gap-x-[7px] items-center",style:{fontSize:0},children:(0,m.jsxs)("div",{className:"w-[40px] h-[40px] rounded-[6px] flex items-center justify-center bg-[#F4F8F1] relative",children:[(0,m.jsx)("img",{src:(0,Be.s9)("single",Ie),className:"w-[22px] h-[22px]"}),Ce&&(0,m.jsx)("div",{className:"w-[16px] h-[16px] absolute top-[28px] left-[28px] flex items-center justify-center bg-[#fff] rounded-[3px]",style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,m.jsx)("img",{src:"/icons/".concat(Ce,".svg"),alt:"",className:"w-[12px] h-[12px]"})})]})}),(0,m.jsx)("div",{className:"flex flex-1 min-w-0",children:(0,m.jsxs)("div",{className:"flex justify-center flex-col gap-y-[5px] flex-1 min-w-0",children:[(0,m.jsxs)("span",{className:"text-[12px] flex items-center",style:{color:"#213044"},children:[(0,m.jsx)("span",{className:"truncate",children:he}),(0,m.jsx)("span",{className:"flex items-center flex-1",children:X})]}),(0,m.jsx)("span",{className:"text-[12px] max-w-full truncate",style:{color:"#999999"},children:G})]})}),Pe||(0,m.jsx)(m.Fragment,{}),be&&(0,m.jsx)("div",{className:"flex items-center w-[24px]",children:(0,m.jsx)("span",{className:"operation",children:be})}),_e!=null&&(0,m.jsx)("div",{className:"graphic_progress flex items-center pl-[30px]",children:(0,m.jsx)(ae.Z,{type:"circle",percent:_e,size:29})})]})]})};De.Z=pe},39873:function(st,De,f){var Ze=f(5574),D=f.n(Ze),Be=f(42881),ae=f(67294),ve=f(85893),m=function(ce){var a=ce.children,X=ce.className,ze=X===void 0?"":X,ie=ce.dragDirection,ge=ie===void 0?"left":ie,G=ce.minWidth,he=G===void 0?415:G,Ie=ce.maxWidth,Ae=Ie===void 0?820:Ie,Ce=ce.minHeight,Ee=Ce===void 0?200:Ce,be=ce.maxHeight,_e=be===void 0?800:be,fe=ce.defaultWidth,Pe=fe===void 0?415:fe,Me=ce.defaultHeight,je=Me===void 0?300:Me,Se=ce.onChange,Re=(0,ae.useState)(Pe),Oe=D()(Re,2),Ue=Oe[0],Te=Oe[1],K=(0,ae.useState)(je),e=D()(K,2),Xe=e[0],Ge=e[1],qe=(0,ae.useCallback)(function(Je,We){Te(Je),We&&Ge(We),Se==null||Se(Je,We)},[Te,Ge,Se]),Ke=(0,Be.W)({direction:["left","right"].includes(ge)?"horizontal":"vertical",triggerDirection:ge,minWidth:he,maxWidth:Ae,minHeight:Ee,maxHeight:_e,onResize:qe}),$e=Ke.triggerRef,xe=Ke.containerRef;return(0,ve.jsxs)("div",{ref:xe,style:{width:["left","right"].includes(ge)?"".concat(Ue,"px"):void 0,height:["top","bottom"].includes(ge)?"".concat(Xe,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(ze),children:[ge==="left"&&(0,ve.jsx)("div",{ref:$e,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ve.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ge==="right"&&(0,ve.jsx)("div",{ref:$e,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ve.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ge==="top"&&(0,ve.jsx)("div",{ref:$e,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ve.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ge==="bottom"&&(0,ve.jsx)("div",{ref:$e,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ve.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),a]})};De.Z=(0,ae.memo)(m)},23987:function(st,De,f){f.r(De),f.d(De,{default:function(){return ka}});var Ze=f(15009),D=f.n(Ze),Be=f(99289),ae=f.n(Be),ve=f(5574),m=f.n(ve),pe=f(43722),ce=f(32983),a=f(67294),X=f(35312),ze=f(19632),ie=f.n(ze),ge=f(97857),G=f.n(ge),he=f(32332),Ie=f(82114),Ae=f(82826),Ce=f(63783),Ee=f(3471),be=f(45360),_e=f(85576),fe=f(28036),Pe=f(83062),Me=f(72269),je=f(74330),Se=f(96486),Re=f(44010),Oe=f(73445),Ue=f(782),Te=(0,Oe.Ue)((0,Ue.mW)(function(o,n){return{clearMemory:null,truncatable:!1,disableInput:!1,summaryParams:null,runsSummaryShow:!1,summaryClick:!0,setClearMemory:function(p){o({clearMemory:p})},setTruncatable:function(p){o({truncatable:p})},setDisableInput:function(p){o({disableInput:p})},setSummaryParams:function(p){o({summaryParams:p})},setRunsSummaryShow:function(p){o({runsSummaryShow:p})},setSummaryClick:function(p){console.log(p),o({summaryClick:p})}}})),K=Te,e=f(85893),Xe=function(n){var i=(0,X.useIntl)(),p=n.roomDetail,S=n.setAgent,d=be.ZP.useMessage(),h=m()(d,2),v=h[0],I=h[1],y=(0,X.useParams)(),g=y.id,u=K(function(r){return r.disableInput}),_=K(function(r){return r.truncatable}),b=K(function(r){return r.setClearMemory}),k=(0,a.useState)([]),P=m()(k,2),x=P[0],H=P[1],q=(0,a.useState)(G()({},p)),$=m()(q,2),t=$[0],Z=$[1],W=(0,a.useState)([]),J=m()(W,2),B=J[0],A=J[1],Y=(0,a.useRef)(!1),ne=(0,a.useRef)(!1),te=(0,a.useState)(!1),V=m()(te,2),O=V[0],z=V[1],T=function(){var s=_e.Z.confirm;s({title:i.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Ie.Z,{}),content:i.formatMessage({id:"app.chatroom.clear.tips"}),okText:i.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:i.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){b(["TRUNCATE","0"])}})},C=function(){var r=ae()(D()().mark(function s(){var l;return D()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!g){j.next=5;break}return j.next=3,(0,pe.cH)({id:g});case 3:if(l=j.sent,l.code==0)try{Z(function(){return G()(G()({},l.data.chat_info),{},{max_round:l.data.max_round,smart_selection:l.data.smart_selection})}),H(l.data.agent_list),Y.current=!0}catch(w){}case 5:case"end":return j.stop()}},s)}));return function(){return r.apply(this,arguments)}}(),se=function(){var r=ae()(D()().mark(function s(){var l;return D()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,pe.j2)({id:g});case 2:l=j.sent,l.code==0&&(A(l.data.list),ne.current=!0);case 4:case"end":return j.stop()}},s)}));return function(){return r.apply(this,arguments)}}(),le=function(){var r=ae()(D()().mark(function s(l){var c,j,w;return D()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!g){F.next=11;break}if(c=l.active==1?0:1,c!=0){F.next=7;break}if(j=x.filter(function(L){return L.active==1}),j.length-1!=0){F.next=7;break}return v.open({type:"error",content:i.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),F.abrupt("return",!1);case 7:return F.next=9,(0,pe.sT)({active:c},g,l.agent_id);case 9:w=F.sent,w.code==0&&H(function(L){return L.map(function(oe){return G()(G()({},oe),{},{active:oe.agent_id==l.agent_id?c:oe.active})})});case 11:case"end":return F.stop()}},s)}));return function(l){return r.apply(this,arguments)}}(),me=function(s){return s.length>6?s.length=6:s.lenth,s},U=function(s){s.type=="my_agent"?X.history.push("/Agents?app_id=".concat(s.app_id,"&type=false&from=chat_room")):X.history.push("/ReadOnlyAgent?app_id=".concat(s.app_id,"&type=true&from=chat_room"))},E=function(s){X.history.replace("/chat_room/".concat(s.chatroom_id)),window.location.reload()},ee=function(){z(!0)},Q=function(){z(!1)},M=function(){var r=ae()(D()().mark(function s(l){var c,j,w;return D()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!(l.checkItem&&l.checkItem.length==0)){F.next=3;break}return v.open({type:"error",content:i.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),F.abrupt("return");case 3:return c=ie()(l.checkItem).map(function(L){var oe=L.agent_id,re=L.active,ue=re===void 0?1:re;return{agent_id:oe,active:ue}}),j={description:t.description,name:t.name,max_round:t.max_round},F.next=7,(0,pe.sI)(G()(G()({},j),{},{agent:c}),g);case 7:w=F.sent,w.code==0?(l.checkItem.map(function(L){L.active=L.active==null?1:L.active}),H(ie()(l.checkItem)),S.current=ie()(l.checkItem),v.open({type:"success",content:i.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):v.open({type:"error",content:i.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return F.stop()}},s)}));return function(l){return r.apply(this,arguments)}}(),N=function(){var r=ae()(D()().mark(function s(){var l;return D()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return l=t.smart_selection==1?0:1,j.next=3,(0,pe.r5)({smart_selection:l},g);case 3:Z(function(w){return G()(G()({},w),{},{smart_selection:l})});case 4:case"end":return j.stop()}},s)}));return function(){return r.apply(this,arguments)}}();return(0,a.useEffect)(function(){C(),se()},[]),(0,e.jsxs)(e.Fragment,{children:[I,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){X.history.go(-1)},children:[(0,e.jsx)(fe.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(Ae.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:i.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:t.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:i.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(Pe.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:i.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ce.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:i.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Me.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:t.smart_selection==1,onChange:N,disabled:u})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:Y.current?(0,e.jsx)("div",{className:"flex flex-col",children:x&&x.length>0?x.map(function(r){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,he.s9)("single",r.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:r.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:r.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){U(r)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Me.Z,{size:"small",disabled:u,defaultChecked:!0,className:"w-[28px]",checked:r.active==1,onChange:function(){le(r)}})]})]},r.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ce.Z,{image:ce.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(je.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:ee,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:i.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:_&&!u?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Se.throttle)(function(){_&&!u&&T()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:i.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:i.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:ne.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:B&&B.length>0?B.map(function(r){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){E(r)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:r.name}),r.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:i.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:i.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:r.agent_list&&r.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[me(r.agent_list).map(function(s,l){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,he.s9)("single",s.icon),alt:"",className:"w-[18px]  h-[18px]"})})},l)}),r.agent_list.length>=6?(0,e.jsx)(Ee.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},r.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ce.Z,{image:ce.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(je.Z,{})})})})]})]}),(0,e.jsx)(Re.Z,{show:O,popupClose:Q,popupSave:M,checkList:x,zIndex:99})]})]})},Ge=(0,a.memo)(Xe),qe=f(13769),Ke=f.n(qe),$e=f(47635),xe=f(1413),Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},We=Je,Fe=f(91146),vt=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:We}))},ht=a.forwardRef(vt),gt=ht,jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},yt=jt,St=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:yt}))},_t=a.forwardRef(St),Nt=_t,wt=f(2068),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},Ct=bt,Mt=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:Ct}))},Rt=a.forwardRef(Mt),Ft=Rt,it=f(26915),kt=f(20640),lt=f.n(kt),Ne=f(22683),we=f(97807),Dt=["node","className","children"],It=it.Z.TextArea,At=(0,a.memo)(function(o){var n=o.setInstruction,i=o.messageApi,p=o.isStop,S=o.scrollDomRef,d=o.upButtonDom,h=(0,X.useIntl)(),v=K(function(P){return P.disableInput}),I=K(function(P){return P.setDisableInput}),y=(0,a.useState)(""),g=m()(y,2),u=g[0],_=g[1],b=function(x){!x.shiftKey&&x.target.value==""&&(i.open({type:"warning",content:h.formatMessage({id:"app.chatroom.content.input"}),duration:10}),_(""),x.preventDefault()),!x.shiftKey&&x.keyCode==13&&x.target.value!=""&&(I(!0),_(""),n(["INPUT",x.target.value]),x.preventDefault())},k=(0,Se.throttle)(function(){n(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:d,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(x){S.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(gt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(It,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:u,disabled:v,onChange:function(x){_(x.target.value)},onPressEnter:b,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(h.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),p?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:k,children:(0,e.jsx)(Nt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(v||!u?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Se.throttle)(function(){if(v||!u)return!1;u||i.open({type:"warning",content:h.formatMessage({id:"app.chatroom.content.input"}),duration:10}),I(!0),n(["INPUT",u]),_("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),Et=function o(n){return typeof n=="string"?n:Array.isArray(n)?n.map(o).join(""):a.isValidElement(n)?o(n.props.children):""},Pt=function(n){return Et(n)},et=function(n,i){return{code:function(S){var d=S.node,h=S.className,v=S.children,I=Ke()(S,Dt),y=/language-(\w+)/.exec(h||"");if(y!=null&&y.length){var g=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:y[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var u=ae()(D()().mark(function _(b){var k;return D()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,k=b.currentTarget,x.next=4,lt()(Pt(v));case 4:k&&(k.children[1].innerText=i.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){k&&(k.children[1].innerText=i.formatMessage({id:"app.chatroom.content.copycode"}))},200),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(0),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},_,null,[[0,8]])}));return function(_){return u.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:i.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(g).concat(n),className:"p-4",children:v})})]})}else return(0,e.jsx)("code",G()(G()({},I),{},{children:v}))}}},ct=(0,a.memo)(function(o){var n=o.messageApi,i=o.index,p=o.idName,S=o.cidName,d=(0,X.useIntl)(),h=(0,a.useState)(!1),v=m()(h,2),I=v[0],y=v[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){y(!0)},onMouseLeave:function(){y(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var g=ae()(D()().mark(function u(_){var b,k;return D()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return b=_.target.closest("#".concat(p).concat(i)),k=b.querySelector("#".concat(S).concat(i)),x.prev=2,x.next=5,lt()(k.innerText);case 5:n.open({type:"success",content:d.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(2),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},u,null,[[2,8]])}));return function(u){return g.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(I?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(I?" text-[#1B64F3]":"text-[#666]"),children:d.formatMessage({id:"app.chatroom.content.copy"})})]})})}),ot=function(n){var i=n.id,p=n.index,S=n.idName,d=n.cidName,h=(0,X.useIntl)(),v=K(function(k){return k.setSummaryClick}),I=(0,a.useState)(!0),y=m()(I,2),g=y[0],u=y[1],_=K(function(k){return k.summaryClick});(0,a.useEffect)(function(){u(_)},[_]);var b=K(function(k){return k.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(g?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(P){if(g){var x=P.target.closest("#".concat(S).concat(p)),H=x.querySelector("#".concat(d).concat(p));b({id:i,message:H.innerText}),v(!1)}},children:[(0,e.jsx)(wt.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:h.formatMessage({id:"app.chatroom.content.summary"})})]})})},Ot=function(n){var i=n.roomid,p=(0,X.useIntl)(),S=K(function(u){return u.setSummaryClick}),d=(0,a.useState)(!0),h=m()(d,2),v=h[0],I=h[1],y=K(function(u){return u.summaryClick});(0,a.useEffect)(function(){I(y)},[y]);var g=K(function(u){return u.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(v?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){v&&(g({id:i}),S(!1))},children:[(0,e.jsx)(Ft,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:p.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Tt=(0,a.memo)(function(o){var n=o.messageApi,i=o.setCurrentMessageContent,p=o.sendValue,S=o.agentList,d=o.scrollDomRef,h=o.upButtonDom,v=o.setIsStop,I=o.setisEnd,y=o.setSendValue,g=(0,X.useIntl)(),u=(0,X.useParams)(),_=u.id,b=K(function(Y){return Y.setDisableInput}),k=(0,a.useState)({}),P=m()(k,2),x=P[0],H=P[1],q=(0,a.useRef)(!1),$=(0,a.useRef)(""),t=K(function(Y){return Y.setTruncatable}),Z=function(ne){var te=ne.data;if(te.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var V=JSON.parse(te.slice(22,-2));switch(V[0]){case"ERROR":b(!1),v(!1),y(""),n.open({type:"error",content:"webSocket-".concat(V[1]),duration:10});break;case"CHAT":var O={content:"".concat(V[1]),is_agent:0};i(function(C){return[].concat(ie()(C),[O])}),setTimeout(function(){d.current.scrollTop=0,h.current.style.display="none"});break;case"STOPPABLE":v(V[1]);break;case"TRUNCATABLE":t(V[1]),V[1]||n.open({type:"success",content:"".concat(g.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":n.open({type:"success",content:"".concat(g.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(te.indexOf("REPLY")!==-1&&te.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var z=JSON.parse(te.slice(22,-2))[1];$.current="",q.current=!0;var T=S.current.filter(function(C){return C.agent_id==z})[0];Object.keys(x).length&&i(function(C){return[].concat(ie()(C),[x])}),H(function(C){return G()(G()({},C),{},{is_agent:1,icon:T==null?void 0:T.icon,name:T==null?void 0:T.name})}),v(!0),t(!1)}te.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&q.current&&(d.current.scrollTop=0,h.current.style.display="none",$.current+=te,H(function(C){return G()(G()({},C),{},{content:$.current})})),te.indexOf("ENDCHAT")!==-1&&(q.current=!1,$.current="",b(!1),v(!1),t(!0),Object.keys(x).length&&i(function(C){return[].concat(ie()(C),[x])}),H({}),I(!0),y(""))},W=(0,$e.Z)("chat",Z),J=W.runSocket,B=W.sendMessage,A=W.readyState;return(0,a.useEffect)(function(){A==1&&_&&B(JSON.stringify(["ENTER",parseInt(_)]))},[A]),(0,a.useEffect)(function(){p&&A==1&&B(p)},[p]),(0,a.useEffect)(function(){J()},[]),(0,e.jsx)(e.Fragment,{children:x.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(x.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:x.is_agent==1?(0,e.jsx)("img",{src:(0,he.s9)("single",x.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(x.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:x.name?x.name:(0,he.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(x.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:x.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],components:et("add",g),children:x.content})})})]})]}):(0,e.jsx)(e.Fragment,{})})}),$t=(0,a.memo)(function(o){var n=o.messageApi,i=o.setUserMessage,p=o.sendValue,S=o.agentList,d=o.scrollDomRef,h=o.upButtonDom,v=o.setIsStop,I=o.setSendValue,y=(0,X.useIntl)(),g=(0,a.useState)([]),u=m()(g,2),_=u[0],b=u[1],k=(0,a.useState)(!1),P=m()(k,2),x=P[0],H=P[1],q=(0,X.useParams)(),$=q.id;return(0,a.useEffect)(function(){x&&(i(function(t){return[].concat(ie()(_.reverse()),ie()(t))}),b([]),setTimeout(function(){H(!1),d.current.scrollTop=0},200))},[x]),(0,e.jsxs)(e.Fragment,{children:[_.length?_.map(function(t,Z){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(t.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:t.is_agent==1?(0,e.jsx)("img",{src:(0,he.s9)("single",t.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(Z),children:[(0,e.jsx)("div",{className:"".concat(t.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:t.name?t.name:(0,he.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(t.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:t.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(Z),children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],components:et(Z,y),children:t.content})})}),t.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(ct,{messageApi:n,index:Z,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(ot,{id:$,index:Z,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},Z)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Tt,{messageApi:n,setCurrentMessageContent:b,sendValue:p,agentList:S,scrollDomRef:d,upButtonDom:h,setIsStop:v,setisEnd:H,setSendValue:I})]})}),Lt=(0,a.memo)(function(o){var n=o.messageApi,i=o.scrollDomRef,p=o.instruction,S=o.setIsStop,d=o.upButtonDom,h=o.setInstruction,v=o.agentList,I=(0,X.useIntl)(),y=(0,X.useParams)(),g=y.id,u=(0,a.useState)([]),_=m()(u,2),b=_[0],k=_[1],P=(0,a.useRef)(!1),x=(0,a.useState)(""),H=m()(x,2),q=H[0],$=H[1],t=(0,a.useRef)(null),Z=(0,a.useRef)(!0),W=(0,a.useRef)(2),J=(0,a.useRef)(1),B=(0,a.useRef)(0),A=function(){var O=ae()(D()().mark(function z(T){var C,se,le=arguments;return D()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(C=le.length>1&&le[1]!==void 0?le[1]:function(){},!g){U.next=6;break}return U.next=4,(0,pe.KH)(g,{page:J.current,page_size:10});case 4:se=U.sent,se.code==0&&(W.current=se.data.total_pages,T||(t.current.style.display="none"),k(function(E){return T?ie()(se.data.list.reverse()):[].concat(ie()(E),ie()(se.data.list.reverse()))}),T?setTimeout(function(){i.current.scrollTop=0,d.current.style.display="none"}):B.current=se.data.list.length,Z.current=!0);case 6:case"end":return U.stop()}},z)}));return function(T){return O.apply(this,arguments)}}(),Y=function(z){var T=z.target.scrollHeight+(z.target.scrollTop-z.target.clientHeight);P.current!==Math.ceil(z.target.scrollTop)<-50&&(P.current=Math.ceil(z.target.scrollTop)<-50,d.current.style.display=P.current?"flex":"none"),T<10&&Z.current&&(Z.current=!1,J.current=J.current+1,t.current.style.display="flex",W.current>=J.current?A(!1):t.current.style.display="none")},ne=function(z,T){T==="0"&&(T=Number(T));var C=["".concat(z),T===0||T?T:null];$(JSON.stringify(C))},te=K(function(O){return O.disableInput}),V=K(function(O){return O.clearMemory});return(0,a.useEffect)(function(){V&&V.length&&ne(V[0],V[1])},[V]),(0,a.useEffect)(function(){p&&p.length&&(ne(p[0],p[1]?p[1]:""),h([]))},[p]),(0,a.useEffect)(function(){J.current=1,A(!0)},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:i,onScroll:Y,children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:b&&b.length?b.map(function(O,z){return(0,e.jsxs)("div",{id:"c".concat(O.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(O.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:O.is_agent==1?(0,e.jsx)("img",{src:(0,he.s9)("single",O.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(z),children:[(0,e.jsx)("div",{className:"".concat(O.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:O.name?O.name:(0,he.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(O.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:O.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(z),children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],components:et(z,I),children:O.content})})}),O.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(ct,{messageApi:n,idName:"content",cidName:"chilContent",index:z}),(0,e.jsx)(ot,{id:g,index:z,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},z)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)($t,{messageApi:n,setUserMessage:k,sendValue:q,agentList:v,scrollDomRef:i,upButtonDom:d,setIsStop:S,setSendValue:$})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!te&&b.length?(0,e.jsx)(Ot,{roomid:g}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:t,children:(0,e.jsx)(je.Z,{})})]})})}),Ht=(0,a.memo)(function(o){var n=o.agentList,i=(0,a.useRef)(null),p=(0,a.useRef)(null),S=(0,a.useState)(!1),d=m()(S,2),h=d[0],v=d[1],I=(0,a.useState)([]),y=m()(I,2),g=y[0],u=y[1],_=be.ZP.useMessage(),b=m()(_,2),k=b[0],P=b[1];return(0,e.jsxs)(e.Fragment,{children:[P,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full",children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(Lt,{instruction:g,setInstruction:u,messageApi:k,scrollDomRef:i,setIsStop:v,upButtonDom:p,agentList:n}),(0,e.jsx)(At,{setInstruction:u,messageApi:k,isStop:h,upButtonDom:p,scrollDomRef:i})]})})]})}),Zt=f(39873),Bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},zt=Bt,Ut=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:zt}))},Wt=a.forwardRef(Ut),Vt=Wt,Gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},Kt=Gt,Jt=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:Kt}))},Yt=a.forwardRef(Jt),Qt=Yt,Xt=f(83159),qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},ea=qt,ta=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:ea}))},aa=a.forwardRef(ta),na=aa,Ye=f(86),ut=f(34994),dt=f(2216),ra=f(85877),sa=f(29432),ia=f(39944),la=f(11551),tt=f(55927),ca=function(n){var i,p,S,d=n.selectApp,h=n.runid,v=n.setBoxLoading,I=n.setinputShow,y=n.appId,g=n.id,u=n.setisRun,_=(0,X.useIntl)(),b=(0,a.useRef)(""),k=(0,a.useRef)(""),P=(0,a.useRef)(null),x=(0,a.useState)(""),H=m()(x,2),q=H[0],$=H[1],t=(0,a.useState)(null),Z=m()(t,2),W=Z[0],J=Z[1],B=(0,a.useState)([]),A=m()(B,2),Y=A[0],ne=A[1],te=(0,a.useState)(""),V=m()(te,2),O=V[0],z=V[1],T=(0,tt.Z)(function(U){return U.flowMessage}),C=function(E){k.current=se(E);var ee={user:{value:se(E)}};z(new ia.z(ee))},se=function U(E){return E.map(function(ee){return ee.type==="mention"?ee.id:ee.children?U(ee.children):ee.text}).join("")},le=function(){var U=ae()(D()().mark(function E(ee){var Q,M;return D()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return v(!0),Q=Object.keys(ee),Q.forEach(function(s){P.current.properties[s]&&(P.current.properties[s].value=ee[s])}),r.next=5,(0,la.LH)({agent_id:d.checkItem[0].agent_id,ability_id:0,input_dict:P.current,prompt:O,data_source_run_id:b.current});case 5:M=r.sent,M.code==0&&($(M.data.outputs_md),v(!1),u(!1));case 7:case"end":return r.stop()}},E)}));return function(ee){return U.apply(this,arguments)}}(),me=function(){var U=ae()(D()().mark(function E(ee,Q){var M,N;return D()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,pe.xT)(ee,Q);case 2:M=s.sent,(M==null?void 0:M.code)==0&&(b.current=M==null||(N=M.data)===null||N===void 0?void 0:N.app_run_id);case 4:case"end":return s.stop()}},E)}));return function(ee,Q){return U.apply(this,arguments)}}();return(0,a.useEffect)(function(){d&&d.checkItem.length&&(u(!0),me(g,{app_id:y,app_run_id:h,status:1,corrected_parameter:""}))},[d]),(0,a.useEffect)(function(){var U=T.filter(function(r){return r.data.app_run_id==h&&r.type.indexOf("generate_meeting_action_items")!==-1});if(U.length!=0){var E,ee=(E=U[U.length-1])===null||E===void 0||(E=E.data)===null||E===void 0||(E=E.exec_data)===null||E===void 0||(E=E.outputs)===null||E===void 0?void 0:E.value;if(ee){var Q=JSON.parse(ee);P.current=Q;var M=Object.keys(Q.properties);if(M.length){J(Q.properties);var N=M.map(function(r){return{value:"<<".concat(sa.qX,".inputs.").concat(r,">>"),label:r}});ne(N)}I(!1),v(!1)}}},[T]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ye.Z,{icon:d==null||(i=d.checkItem[0])===null||i===void 0?void 0:i.icon,title:d==null||(p=d.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:d==null||(S=d.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"robot_icon",handleClick:function(){}})}),W!=null?(0,e.jsxs)(ut.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!k.current},searchConfig:{submitText:_.formatMessage({id:"workflow.button.run"})}},onFinish:function(E){le(E)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(dt._,{data:W})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ra.Z,{onChange:function(E){C(E)},options:Y,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),q?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:q})})}):(0,e.jsx)(e.Fragment,{})]})},oa=(0,a.memo)(ca),ua=f(66309),pt=f(42237),da=f(93696),pa=function(n,i){return a.createElement(Fe.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:i,icon:da.Z}))},xa=a.forwardRef(pa),fa=xa,ma=f(4981),at=f(29608),va=(0,a.memo)(function(o){var n=o.progressObj,i=function(){return parseFloat(n.elapsed_time).toFixed(6)},p=function(d){var h=new Date(d),v=h.getFullYear(),I=(h.getMonth()+1).toString().padStart(2,"0"),y=h.getDate().toString().padStart(2,"0"),g=h.getHours().toString().padStart(2,"0"),u=h.getMinutes().toString().padStart(2,"0"),_=h.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(v,".").concat(I,".").concat(y," ").concat(g,":").concat(u,":").concat(_)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&p(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[i(),"S"]})]})]})})}),ha=function(n){var i,p,S,d=n.selectApp,h=n.runid,v=n.setBoxLoading,I=n.setinputShow,y=n.appId,g=n.id,u=n.setisRun,_=(0,X.useIntl)(),b=(0,a.useRef)(""),k=(0,a.useRef)(null),P=(0,a.useState)(null),x=m()(P,2),H=x[0],q=x[1],$=(0,a.useState)(!1),t=m()($,2),Z=t[0],W=t[1],J=(0,a.useState)(null),B=m()(J,2),A=B[0],Y=B[1],ne=(0,a.useState)(null),te=m()(ne,2),V=te[0],O=te[1],z=(0,a.useState)(null),T=m()(z,2),C=T[0],se=T[1],le=(0,at.Z)(function(s){return s.setDealtWithData}),me=(0,at.Z)(function(s){return s.setRunPanelLogRecord}),U=function(){var s=ae()(D()().mark(function l(c){var j,w,R,F,L;return D()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return v(!0),j=Object.keys(c),w={},j.forEach(function(ue){k.current.properties[ue]&&(k.current.properties[ue].value=c[ue]),V&&V.forEach(function(ye){ye.node_id==ue&&(w[ue]=c[ue])})}),R={inputs:k.current,node_confirm_users:w,run_name:"chatroom-".concat(g,"-run-").concat(b.current,"-driven"),run_type:1,data_source_run_id:b.current},re.next=7,(0,pt.UE)(y,R);case 7:F=re.sent,F.code==0&&(b.current=F==null||(L=F.data)===null||L===void 0?void 0:L.app_run_id,W(!0),u(!1));case 9:case"end":return re.stop()}},l)}));return function(c){return s.apply(this,arguments)}}(),E=function(){var s=ae()(D()().mark(function l(){var c,j;return D()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:c=r==null?void 0:r.filter(function(F){return F.type=="workflow_run_progress"&&F.data.app_run_id==b.current}).map(function(F){var L=F.data;return L}),c&&c.length&&(j=c[c.length-1],q(j),v(!1));case 2:case"end":return R.stop()}},l)}));return function(){return s.apply(this,arguments)}}(),ee=function(){var s=ae()(D()().mark(function l(){var c,j,w,R,F;return D()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:j=r==null?void 0:r.filter(function(re){return re.type=="workflow_need_human_confirm"&&re.data.app_run_id==b.current}),w=(c=j.map(function(re){var ue=re.data,ye=re.need_human_confirm;return{data:ue,need_human_confirm:ye}}))===null||c===void 0?void 0:c.filter(function(re){return re.data.type!==1}),w&&w.length&&(F=w[w.length-1].data,F.exec_id=F==null||(R=F.node_exec_data)===null||R===void 0?void 0:R.node_exec_id,se(w[w.length-1]),v(!1));case 3:case"end":return oe.stop()}},l)}));return function(){return s.apply(this,arguments)}}(),Q=function(l){return l.completed_progress?parseInt(l.completed_progress.slice(0,-1)):!1},M=function(){var s=ae()(D()().mark(function l(c,j){var w,R;return D()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,(0,pe.xT)(c,j);case 2:w=L.sent,(w==null?void 0:w.code)==0&&(b.current=w==null||(R=w.data)===null||R===void 0?void 0:R.app_run_id);case 4:case"end":return L.stop()}},l)}));return function(c,j){return s.apply(this,arguments)}}(),N=function(){var s=ae()(D()().mark(function l(){var c,j;return D()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return console.log(y),R.next=3,(0,pt.zO)(y);case 3:c=R.sent,c.code==0&&O(c==null||(j=c.data)===null||j===void 0?void 0:j.need_confirm_nodes),M(g,{app_id:y,app_run_id:h,status:1,corrected_parameter:""});case 6:case"end":return R.stop()}},l)}));return function(){return s.apply(this,arguments)}}();(0,a.useEffect)(function(){d&&d.checkItem.length&&(u(!0),N())},[d]);var r=(0,tt.Z)(function(s){return s.flowMessage});return(0,a.useEffect)(function(){E(),ee();var s=r.filter(function(R){return R.data.app_run_id==h&&R.type.indexOf("generate_meeting_action_items")!==-1});if(s.length!=0){var l,c=(l=s[s.length-1])===null||l===void 0||(l=l.data)===null||l===void 0||(l=l.exec_data)===null||l===void 0||(l=l.outputs)===null||l===void 0?void 0:l.value;if(c){var j=JSON.parse(c);k.current=j;var w=Object.keys(j.properties);w.length&&(console.log(j.properties),Y(j.properties)),I(!1),v(!1)}}},[r]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ye.Z,{icon:d==null||(i=d.checkItem[0])===null||i===void 0?void 0:i.icon,title:d==null||(p=d.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:d==null||(S=d.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"workflow_icon",handleClick:function(){}})}),!Z&&A!=null?(0,e.jsxs)(ut.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:_.formatMessage({id:"workflow.button.run"})}},onFinish:U,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(dt._,{data:A})}),(0,e.jsx)(ma.e,{data:V})]}):(0,e.jsx)(e.Fragment,{children:A!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[_.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(A).map(function(s){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:s.display_name||s.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:s.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),C&&C.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){le(C.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(fa,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:_.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),H?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Ye.Z,{status:H.status,icon:H.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:H.run_name}),H.need_human_confirm==1?(0,e.jsx)(ua.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:_.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(va,{progressObj:H}),handleClick:function(){me(H)},progress:Q(H)})}):(0,e.jsx)(e.Fragment,{})]})},ga=(0,a.memo)(ha),ja=function(n){var i,p,S,d=(0,X.useIntl)(),h=n.runid,v=n.id,I=n.setBoxLoading,y=n.scrollDom,g=n.setinputShow,u=(0,a.useRef)("agent"),_=(0,a.useRef)(""),b=(0,a.useState)(!1),k=m()(b,2),P=k[0],x=k[1],H=(0,a.useState)({type:"agent",checkItem:[],show:!1}),q=m()(H,2),$=q[0],t=q[1],Z=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(A){return G()(G()({},A),{},{type:"agent",show:!0})})},children:d.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(A){return G()(G()({},A),{},{type:"workflow",show:!0})})},children:d.formatMessage({id:"app.summary.SelectWorkflow"})})}],W=function(){t(function(A){return G()(G()({},A),{},{show:!1})})},J=function(A){I(!0),t(function(Y){return G()(G()({},Y),{},{checkItem:A.checkItem})}),u.current=$.type,_.current=A.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:$!=null&&(i=$.checkItem)!==null&&i!==void 0&&i.length?y==null||(p=y.current)===null||p===void 0?void 0:p.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:d.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:P?(0,e.jsx)(Xt.Z,{menu:{items:Z},children:(0,e.jsx)(na,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:$!=null&&(S=$.checkItem)!==null&&S!==void 0&&S.length?(0,e.jsx)(e.Fragment,{children:u.current=="agent"?(0,e.jsx)(oa,{id:v,appId:_.current,selectApp:$,runid:h,setBoxLoading:I,scrollDom:y,setinputShow:g,setisRun:x}):(0,e.jsx)(ga,{id:v,appId:_.current,selectApp:$,runid:h,setBoxLoading:I,scrollDom:y,setinputShow:g,setisRun:x})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(A){return G()(G()({},A),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),d.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(A){return G()(G()({},A),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),d.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(Re.Z,{show:$.show,nodetype:$.type,popupClose:W,popupSave:J,checkList:u.current==$.type?$.checkItem:[],zIndex:99,radio:!0})]})},ya=(0,a.memo)(ja),xt=f(87740),ft=(0,a.memo)(function(o){var n=o.id,i=o.message,p=(0,X.useIntl)(),S=K(function(u){return u.setSummaryClick}),d=(0,a.useState)(!0),h=m()(d,2),v=h[0],I=h[1],y=K(function(u){return u.summaryClick}),g=K(function(u){return u.setSummaryParams});return(0,a.useEffect)(function(){I(y)},[y]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(_){v&&(g({id:n,message:i}),S(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(xt.Z,{className:"text-[14px]"})]})})}),Sa=function(n){var i,p,S,d,h=n.setShow,v=n.inputShow,I=n.setBoxLoading,y=n.setAppRunId,g=n.scrollDom,u=(0,X.useIntl)(),_=(0,a.useState)(!1),b=m()(_,2),k=b[0],P=b[1],x=(0,a.useState)(""),H=m()(x,2),q=H[0],$=H[1],t=(0,a.useState)(""),Z=m()(t,2),W=Z[0],J=Z[1],B=(0,a.useRef)(""),A=(0,a.useRef)(""),Y=(0,a.useRef)(!1),ne=(0,a.useState)(!1),te=m()(ne,2),V=te[0],O=te[1],z=(0,a.useState)(null),T=m()(z,2),C=T[0],se=T[1],le=K(function(N){return N.setSummaryClick}),me=function(){var N=ae()(D()().mark(function r(s){var l,c,j,w,R=arguments;return D()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return l=R.length>1&&R[1]!==void 0?R[1]:{app_run_id:"",corrected_parameter:""},L.next=3,(0,pe.Rp)(s,l);case 3:c=L.sent,(c==null?void 0:c.code)==0&&(y(c==null||(j=c.data)===null||j===void 0?void 0:j.app_run_id),A.current=c==null||(w=c.data)===null||w===void 0?void 0:w.app_run_id,l.app_run_id&&(Y.current=!0));case 5:case"end":return L.stop()}},r)}));return function(s){return N.apply(this,arguments)}}(),U=function(){var N=ae()(D()().mark(function r(s,l){var c,j,w,R,F;return D()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,(0,pe.xM)(s,{message:l});case 2:c=oe.sent,(c==null?void 0:c.code)==0&&(A.current=c==null||(j=c.data)===null||j===void 0?void 0:j.app_run_id,y(c==null||(w=c.data)===null||w===void 0?void 0:w.app_run_id),c!=null&&(R=c.data)!==null&&R!==void 0&&(R=R.outputs)!==null&&R!==void 0&&R.value&&($(c==null||(F=c.data)===null||F===void 0||(F=F.outputs)===null||F===void 0?void 0:F.value),h(!0),I(!1),le(!0),g.current.scrollTo({top:0})));case 4:case"end":return oe.stop()}},r)}));return function(s,l){return N.apply(this,arguments)}}(),E=function(){var N=ae()(D()().mark(function r(){var s;return D()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,pe.Gh)({chatroom_id:B.current,app_run_id:A.current});case 2:s=c.sent,s&&s!==null&&s!==void 0&&s.data&&se(s.data);case 4:case"end":return c.stop()}},r)}));return function(){return N.apply(this,arguments)}}(),ee=function(r){var s=new Date(r),l=s.getMonth()+1,c=s.getDate(),j=s.getHours(),w=s.getMinutes(),R=s.getSeconds();return s.getFullYear()+"-"+(l<10?"0"+l:l)+"-"+(c<10?"0"+c:c)+" "+(j<10?"0"+j:j)+":"+(w<10?"0"+w:w)+":"+(R<10?"0"+R:R)},Q=(0,tt.Z)(function(N){return N.flowMessage});(0,a.useEffect)(function(){var N=Q.filter(function(l){return l.data.app_run_id==A.current&&l.type.indexOf("generate_meeting_summary")!==-1});if(N.length!=0){var r,s=(r=N[N.length-1])===null||r===void 0||(r=r.data)===null||r===void 0||(r=r.exec_data)===null||r===void 0||(r=r.outputs)===null||r===void 0?void 0:r.value;s&&(Y.current&&E(),$(s),O(!1),h(!0),le(!0),I(!1),g.current.scrollTo({top:0}))}},[Q]);var M=K(function(N){return N.summaryParams});return(0,a.useEffect)(function(){M&&M.id&&(B.current=M.id,C&&se(null),V&&O(!1),q&&$(""),P(!0),M.message?(I(!0),U(M.id,M.message)):me(M.id))},[M]),(0,e.jsx)(e.Fragment,{children:k?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:u.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:q?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:C?C==null||(i=C.source_run)===null||i===void 0?void 0:i.summary:q})}),C&&(C==null||(p=C.source_corrections)===null||p===void 0?void 0:p.length)>0||!v?(0,e.jsx)(ft,{id:B.current,message:C?C==null||(S=C.source_run)===null||S===void 0?void 0:S.summary:q}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(je.Z,{size:"large"})})}),C&&(C==null||(d=C.source_corrections)===null||d===void 0?void 0:d.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[u.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),C.source_corrections.map(function(N,r){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(C.source_corrections.length-1==r?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[u.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",N.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[u.formatMessage({id:"app.summaryhistory.time"}),": ",ee(N.created_time)]}),(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:N==null?void 0:N.corrected_summary})]})},N.created_time),!v||C.source_corrections.length-1!=r?(0,e.jsx)(ft,{id:B.current,message:N==null?void 0:N.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},N.created_time)})]}):(0,e.jsx)(e.Fragment,{}),v?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(it.Z.TextArea,{onChange:function(r){J(r.target.value)},value:W,disabled:!q||V,rows:4,placeholder:u.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(fe.ZP,{type:"primary",disabled:!q||!W,loading:V,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){me(B.current,{app_run_id:String(A.current),corrected_parameter:W}),O(!0),J(""),h("")},children:u.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},_a=(0,a.memo)(Sa),Na=(0,a.memo)(function(o){var n=o.progressObj;console.log(n);var i=function(){return parseFloat(n.elapsed_time).toFixed(6)},p=function(d){var h=new Date(d),v=h.getFullYear(),I=(h.getMonth()+1).toString().padStart(2,"0"),y=h.getDate().toString().padStart(2,"0"),g=h.getHours().toString().padStart(2,"0"),u=h.getMinutes().toString().padStart(2,"0"),_=h.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(v,".").concat(I,".").concat(y," ").concat(g,":").concat(u,":").concat(_)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&p(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[i(),"S"]})]})]})})}),mt=(0,a.memo)(function(o){var n=o.id,i=o.message,p=(0,X.useIntl)(),S=K(function(u){return u.setSummaryClick}),d=(0,a.useState)(!0),h=m()(d,2),v=h[0],I=h[1],y=K(function(u){return u.summaryClick}),g=K(function(u){return u.setSummaryParams});return(0,a.useEffect)(function(){I(y)},[y]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(_){v&&(g({id:n,message:i}),S(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(xt.Z,{className:"text-[14px]"})]})})}),wa=function(n){var i=n.list,p=n.scrollDom,S=n.historyHeight,d=n.id,h=n.runid,v=(0,X.useIntl)(),I=(0,a.useState)([]),y=m()(I,2),g=y[0],u=y[1],_=(0,a.useRef)("100%"),b=(0,a.useState)(0),k=m()(b,2),P=k[0],x=k[1],H=(0,at.Z)(function(t){return t.setRunPanelLogRecord}),q=function(Z){var W=new Date(Z),J=W.getMonth()+1,B=W.getDate(),A=W.getHours(),Y=W.getMinutes(),ne=W.getSeconds();return W.getFullYear()+"-"+(J<10?"0"+J:J)+"-"+(B<10?"0"+B:B)+" "+(A<10?"0"+A:A)+":"+(Y<10?"0"+Y:Y)+":"+(ne<10?"0"+ne:ne)},$=function(Z){var W=Object.keys(Z),J=[];return W.forEach(function(B){J.push(Z[B])}),J};return(0,a.useEffect)(function(){if(p){var t;_.current=p==null||(t=p.current)===null||t===void 0?void 0:t.offsetHeight}},[p]),(0,a.useEffect)(function(){S&&(_.current="auto")},[S]),(0,a.useEffect)(function(){u(ie()(i))},[i]),(0,a.useEffect)(function(){console.log(h),x(h)},[h]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"px-4",style:{minHeight:_.current},children:g&&g.length?g.map(function(t){var Z,W,J,B,A,Y,ne,te,V,O,z,T,C,se,le,me,U,E,ee,Q;return t!=null&&t.source_run&&t!==null&&t!==void 0&&t.source_run.summary&&(!P||P!=(t==null||(Z=t.source_run)===null||Z===void 0?void 0:Z.id))?(0,e.jsx)("div",{className:"pt-[16px] border-b-[1px] border-color-[#eee] ",children:(0,e.jsxs)("div",{className:"pb-[60px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pb-[8px] flex items-center",children:(0,e.jsx)("span",{className:"flex-1",children:v.formatMessage({id:"app.summary.title"})})}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:q(t==null||(W=t.source_run)===null||W===void 0?void 0:W.created_time)}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] ".concat(t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?"bg-[#F7F7F7]":"bg-blue-100 rounded-[4px]"),children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:t==null||(J=t.source_run)===null||J===void 0?void 0:J.summary})}),(0,e.jsx)(mt,{id:d,message:t==null||(B=t.source_run)===null||B===void 0?void 0:B.summary})]}),t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[v.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),t==null?void 0:t.source_corrections.map(function(M,N){return(0,e.jsxs)("div",{className:"mb-[16px] last-of-type:mb-0",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat((t==null?void 0:t.source_corrections.length)-1!=N?"bg-[#F7F7F7]":"bg-blue-100"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[v.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",M.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[v.formatMessage({id:"app.summaryhistory.time"}),":"," ",q(M.created_time)]}),(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:M==null?void 0:M.corrected_summary})]})}),(0,e.jsx)(mt,{id:d,message:M==null?void 0:M.corrected_summary})]},M.created_time)})]}):(0,e.jsx)(e.Fragment,{}),t!=null&&t.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[v.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:t!=null&&(A=t.target_run)!==null&&A!==void 0&&A.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:t==null||(Y=t.target_run)===null||Y===void 0||(Y=Y.app)===null||Y===void 0?void 0:Y.name})]})}),(0,e.jsx)("div",{children:t!=null&&(ne=t.target_run)!==null&&ne!==void 0&&(ne=ne.inputs)!==null&&ne!==void 0&&ne.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[v.formatMessage({id:"app.summaryhistory.input"}),":"]}),$(t==null||(te=t.target_run)===null||te===void 0||(te=te.inputs)===null||te===void 0?void 0:te.properties).map(function(M){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:M.display_name||M.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:M.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:t!=null&&(V=t.target_run)!==null&&V!==void 0&&V.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[v.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:t==null||(O=t.target_run)===null||O===void 0?void 0:O.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[v.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(t==null||(z=t.target_run)===null||z===void 0?void 0:z.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(Ne.U,{rehypePlugins:[we.Z],children:t==null||(T=t.target_run)===null||T===void 0||(T=T.outputs)===null||T===void 0?void 0:T.value})}):(0,e.jsx)(Ye.Z,{status:t==null||(C=t.target_run)===null||C===void 0?void 0:C.status,icon:t==null||(se=t.target_run)===null||se===void 0?void 0:se.icon,title:t==null||(le=t.target_run)===null||le===void 0?void 0:le.name,textDetails:(0,e.jsx)(Na,{progressObj:{created_time:t==null||(me=t.target_run)===null||me===void 0?void 0:me.created_time,elapsed_time:t==null||(U=t.target_run)===null||U===void 0?void 0:U.elapsed_time,app_name:t==null||(E=t.target_run)===null||E===void 0?void 0:E.app.name,status:t==null||(ee=t.target_run)===null||ee===void 0?void 0:ee.status}}),handleClick:function(){var N,r,s,l,c,j,w,R,F,L;H({app_id:t==null||(N=t.target_run)===null||N===void 0||(N=N.app)===null||N===void 0?void 0:N.id,app_name:t==null||(r=t.target_run)===null||r===void 0||(r=r.app)===null||r===void 0?void 0:r.name,icon:t==null||(s=t.target_run)===null||s===void 0?void 0:s.icon,workflow_id:t==null||(l=t.target_run)===null||l===void 0?void 0:l.workflow_id,type:2,app_run_id:t==null||(c=t.target_run)===null||c===void 0?void 0:c.id,run_name:t==null||(j=t.target_run)===null||j===void 0?void 0:j.name,status:t==null||(w=t.target_run)===null||w===void 0?void 0:w.status,created_time:t==null||(R=t.target_run)===null||R===void 0?void 0:R.created_time,elapsed_time:t==null||(F=t.target_run)===null||F===void 0?void 0:F.elapsed_time,completed_progress:"".concat(t==null||(L=t.target_run)===null||L===void 0?void 0:L.percentage,"%")})},progress:t==null||(Q=t.target_run)===null||Q===void 0?void 0:Q.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]})},t.source_run.id):(0,e.jsx)(e.Fragment,{})}):(0,e.jsx)(e.Fragment,{})})})},ba=(0,a.memo)(wa),Ca=function(n){var i,p=n.id,S=(0,a.useState)(""),d=m()(S,2),h=d[0],v=d[1],I=(0,a.useState)(!1),y=m()(I,2),g=y[0],u=y[1],_=(0,a.useState)([]),b=m()(_,2),k=b[0],P=b[1],x=(0,a.useState)(!1),H=m()(x,2),q=H[0],$=H[1],t=(0,a.useState)(!1),Z=m()(t,2),W=Z[0],J=Z[1],B=(0,a.useState)(""),A=m()(B,2),Y=A[0],ne=A[1],te=(0,a.useState)(!1),V=m()(te,2),O=V[0],z=V[1],T=(0,a.useState)(!1),C=m()(T,2),se=C[0],le=C[1],me=(0,a.useState)(!0),U=m()(me,2),E=U[0],ee=U[1],Q=(0,a.useRef)(null),M=(0,a.useRef)(1),N=(0,a.useRef)(!1),r=(0,a.useRef)(!0),s=(0,a.useRef)(0),l=(0,a.useState)(!1),c=m()(l,2),j=c[0],w=c[1],R=K(function(re){return re.summaryParams}),F=K(function(re){return re.setSummaryParams}),L=function(){var re=ae()(D()().mark(function ue(){var ye,Qe,de,nt,Le,rt,He=arguments;return D()().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:if(ye=He.length>0&&He[0]!==void 0?He[0]:!0,Qe=He.length>1&&He[1]!==void 0?He[1]:!0,!(s.current!=0&&s.current<M.current)){ke.next=5;break}return w(!1),ke.abrupt("return");case 5:return ke.next=8,(0,pe.sh)({chatroom_id:p,page:M.current,page_size:10});case 8:de=ke.sent,de.code==0&&(de!=null&&(nt=de.data)!==null&&nt!==void 0&&nt.list&&de!==null&&de!==void 0&&(Le=de.data)!==null&&Le!==void 0&&(Le=Le.list)!==null&&Le!==void 0&&Le.length&&(s.current=de==null||(rt=de.data)===null||rt===void 0?void 0:rt.total_pages,P(function(Ve){return Qe?ie()(de.data.list.reverse()):[].concat(ie()(de.data.list.reverse()),ie()(Ve))}),u(!0),w(!0),setTimeout(function(){r.current=!0},500)),Qe&&setTimeout(function(){var Ve;Q==null||(Ve=Q.current)===null||Ve===void 0||Ve.scrollTo({top:0})},200),ye||(v(R.id),F({})));case 10:case"end":return ke.stop()}},ue)}));return function(){return re.apply(this,arguments)}}(),oe=function(){var re=ae()(D()().mark(function ue(ye){return D()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:ye.target.scrollHeight+(ye.target.scrollTop-ye.target.clientHeight)<400&&r.current&&(r.current=!1,w(!0),M.current=M.current+=1,L(!0,!1));case 1:case"end":return de.stop()}},ue)}));return function(ye){return re.apply(this,arguments)}}();return(0,a.useEffect)(function(){M.current=1,L()},[p]),(0,a.useEffect)(function(){R&&R.id&&(u(!0),E||ee(!0),q&&$(!1),O&&z(!1),M.current=1,J(!0),L(!1),N.current=!0)},[R]),(0,e.jsx)(e.Fragment,{children:g?(0,e.jsxs)(Zt.Z,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(O?"translate-x-full flex-[0]":""),children:[se?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(je.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){z(function(ue){return!ue})},className:`
                                        `.concat(O?"fixed right-[100%] top-[60px]":"absolute right-[99%] top-[60px]",`
                                        history_packup
                                        hover:text-[#1B64F3]
                                         w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                                    `),children:O?(0,e.jsx)(Qt,{className:"text-[18px]"}):(0,e.jsx)(Vt,{className:"text-[18px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:oe,ref:Q,children:[(0,e.jsxs)("div",{children:[k.length?(0,e.jsx)(ba,{id:p,runid:Y,scrollDom:Q,list:k,historyHeight:N.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:W?Q==null||(i=Q.current)===null||i===void 0?void 0:i.offsetHeight:""},children:[(0,e.jsx)(_a,{setShow:$,inputShow:E,setBoxLoading:le,setAppRunId:ne,scrollDom:Q}),q?(0,e.jsx)(ya,{id:h,runid:Y,setBoxLoading:le,scrollDom:Q,setinputShow:ee}):(0,e.jsx)(e.Fragment,{})]})]}),j?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(je.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},Ma=(0,a.memo)(Ca),Ra=function(n){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(ce.Z,{image:ce.Z.PRESENTED_IMAGE_SIMPLE})})},Fa=(0,a.memo)(function(){var o=(0,X.useParams)(),n=o.id,i=(0,a.useRef)([]),p=(0,a.useRef)(null),S=(0,a.useState)(!1),d=m()(S,2),h=d[0],v=d[1],I=function(){var y=ae()(D()().mark(function g(){var u;return D()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!n){b.next=5;break}return b.next=3,(0,pe.cH)({id:n});case 3:u=b.sent,u.code==0?(v(!0),p.current=u.data,i.current=u.data.agent_list):X.history.replace("/meeting");case 5:case"end":return b.stop()}},g)}));return function(){return y.apply(this,arguments)}}();return(0,a.useEffect)(function(){I()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(Ge,{roomDetail:p.current,setAgent:i}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:h?(0,e.jsx)(Ht,{agentList:i}):(0,e.jsx)(Ra,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ma,{id:n})})]})})}),ka=Fa}}]);
