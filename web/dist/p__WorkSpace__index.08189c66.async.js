"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[316],{66212:function(ue,W,t){var O=t(1413),$=t(67294),n=t(99011),L=t(91146),C=function(B,_){return $.createElement(L.Z,(0,O.Z)((0,O.Z)({},B),{},{ref:_,icon:n.Z}))},A=$.forwardRef(C);W.Z=A},11475:function(ue,W,t){t.d(W,{Z:function(){return B}});var O=t(1413),$=t(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},L=n,C=t(91146),A=function(R,F){return $.createElement(C.Z,(0,O.Z)((0,O.Z)({},R),{},{ref:F,icon:L}))},k=$.forwardRef(A),B=k},2068:function(ue,W,t){t.d(W,{Z:function(){return B}});var O=t(1413),$=t(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},L=n,C=t(91146),A=function(R,F){return $.createElement(C.Z,(0,O.Z)((0,O.Z)({},R),{},{ref:F,icon:L}))},k=$.forwardRef(A),B=k},35790:function(ue,W,t){var O=t(1413),$=t(67294),n=t(19369),L=t(91146),C=function(B,_){return $.createElement(L.Z,(0,O.Z)((0,O.Z)({},B),{},{ref:_,icon:n.Z}))},A=$.forwardRef(C);W.Z=A},88864:function(ue,W,t){var O=t(32332),$=t(67294),n=t(85893);W.Z=(0,$.memo)(function(L){var C=L.agentList,A=L.size,k=A===void 0?"sm":A,B=L.rounded,_=B===void 0?!1:B,R=C==null?void 0:C.map(function(ie){return ie.avatar?ie.avatar:(0,O.s9)("single",ie.icon)}),F={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},ce={sm:"w-[47%] h-[47%]",md:"w-[47%] h-[47%]",lg:"w-[47%] h-[47%]"},Y=function(){var ne=(R==null?void 0:R.length)||0;if(!ne||!R)return(0,n.jsx)("div",{className:"bg-gray-200 w-full h-full ".concat(_?"rounded-full":"")});if(ne===1)return(0,n.jsx)("div",{className:"w-full h-full overflow-hidden ".concat(_?"rounded-full":""),children:(0,n.jsx)("img",{src:R[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover"})});if(ne===2)return(0,n.jsxs)("div",{className:"w-full h-full flex flex-wrap",children:[(0,n.jsx)("div",{className:"w-1/2 h-full pr-[2%]",children:(0,n.jsx)("img",{src:R[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?"rounded-l-full":"")})}),(0,n.jsx)("div",{className:"w-1/2 h-full pl-[2%]",children:(0,n.jsx)("img",{src:R[1],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?"rounded-r-full":"")})})]});if(ne===3)return(0,n.jsxs)("div",{className:"w-full h-full flex flex-wrap",children:[(0,n.jsx)("div",{className:"w-1/2 h-full pr-[2%] flex items-center justify-center",children:(0,n.jsx)("img",{src:R[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?"rounded-l-full":"")})}),(0,n.jsxs)("div",{className:"w-1/2 h-full pl-[2%] flex flex-col",children:[(0,n.jsx)("div",{className:"h-1/2 pb-[2%]",children:(0,n.jsx)("img",{src:R[1],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?"rounded-tr-full":"")})}),(0,n.jsx)("div",{className:"h-1/2 pt-[2%]",children:(0,n.jsx)("img",{src:R[2],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?"rounded-br-full":"")})})]})]});if(ne===4)return(0,n.jsx)("div",{className:"w-full h-full flex flex-wrap",children:R.slice(0,4).map(function(H,K){return(0,n.jsx)("div",{className:"".concat(ce[k]," p-[3%] ").concat(K===0?"pl-0 pt-0":K===1?"pr-0 pt-0":K===2?"pl-0 pb-0":"pr-0 pb-0"),children:(0,n.jsx)("img",{src:H,alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(_?K===0?"rounded-tl-full":K===1?"rounded-tr-full":K===2?"rounded-bl-full":"rounded-br-full":"")})},K)})});for(var pe=R.slice(0,9),ge=[],re=0;re<Math.min(9,pe.length);re++)ge.push((0,n.jsx)("div",{className:"w-1/3 h-1/3",style:{padding:"1.5%"},children:(0,n.jsx)("img",{src:pe[re],alt:"\u5934\u50CF",className:"w-full h-full object-cover"})},re));return(0,n.jsx)("div",{className:"w-full h-full flex flex-wrap",children:ge})};return(0,n.jsx)("div",{className:"".concat(F[k]," overflow-hidden bg-white ").concat(_?"rounded-full":""),children:Y()})})},83961:function(ue,W,t){t.r(W),t.d(W,{default:function(){return ta}});var O=t(56264),$=t(64456),n=t(67294),L=t(15009),C=t.n(L),A=t(99289),k=t.n(A),B=t(97857),_=t.n(B),R=t(5574),F=t.n(R),ce=t(42237),Y=t(29608),ie=t(35790),ne=t(11475),pe=t(8751),ge=t(97578),re=t(77598),H=t(97582),K=t(22638),De=t(3917),ze=function(D,u){var w;u===void 0&&(u={});var c=u.defaultPageSize,i=c===void 0?10:c,h=u.defaultCurrent,p=h===void 0?1:h,g=(0,H._T)(u,["defaultPageSize","defaultCurrent"]),Z=(0,De.Z)(D,(0,H.pi)({defaultParams:[{current:p,pageSize:i}],refreshDepsAction:function(){J(1)}},g)),v=Z.params[0]||{},y=v.current,f=y===void 0?1:y,x=v.pageSize,I=x===void 0?i:x,S=((w=Z.data)===null||w===void 0?void 0:w.total)||0,te=(0,n.useMemo)(function(){return Math.ceil(S/I)},[I,S]),z=function(E,m){var G=E<=0?1:E,P=m<=0?1:m,ee=Math.ceil(S/P);G>ee&&(G=Math.max(1,ee));var ae=(0,H.CR)(Z.params||[]),b=ae[0],Q=b===void 0?{}:b,a=ae.slice(1);Z.run.apply(Z,(0,H.ev)([(0,H.pi)((0,H.pi)({},Q),{current:G,pageSize:P})],(0,H.CR)(a),!1))},J=function(E){z(E,I)},N=function(E){z(f,E)};return(0,H.pi)((0,H.pi)({},Z),{pagination:{current:f,pageSize:I,total:S,totalPage:te,onChange:(0,K.Z)(z),changeCurrent:(0,K.Z)(J),changePageSize:(0,K.Z)(N)}})},he=ze,xe=t(78697),je=t(32332),q=t(76772),we=t(74330),Ze=t(83062),ye=t(32983),Me=t(88864),be=t(29432),Ee=t(78818),fe=t(71471),e=t(85893),Ce=function(u){var w=u.iconSrc,c=u.titleText,i=u.pagination,h=u.showTotal,p=h===void 0?!0:h,g=u.titleAfter,Z=g===void 0?null:g,v=(0,q.useIntl)();return(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("img",{src:w,alt:""}),(0,e.jsx)("div",{children:c}),(0,e.jsx)("div",{children:(0,e.jsx)(Ee.Z,{size:"small",simple:!0,showTotal:function(f,x){return p?"".concat(v.formatMessage({id:"app.workflow.title.1"})).concat(x[0],"-").concat(x[1]).concat(v.formatMessage({id:"app.workflow.title.2"})," / ").concat(v.formatMessage({id:"app.workflow.title.3"})).concat(f," ").concat(v.formatMessage({id:"app.workflow.title.2"})):null},current:i.current,pageSize:i.pageSize,onShowSizeChange:null,total:i.total,onChange:i.onChange})}),Z]})},Oe=function(u){var w,c=u.item;console.log(c);var i=(0,q.useIntl)(),h="/icons/creation/",p="",g="";switch(c.type){case 1:g=i.formatMessage({id:"app.itemHeader.agent"}),p="Agent";break;case 2:g=i.formatMessage({id:"app.itemHeader.chatRoom"}),p="ChatRoom";break;case 3:g=i.formatMessage({id:"app.itemHeader.workFlow"}),p="WorkFlow";break;default:break}return h+=be.Le[p],(0,e.jsxs)("div",{className:"flex gap-5 shrink-0",children:[(0,e.jsx)("div",{className:"shrink-0",children:((w=c.agents_data)===null||w===void 0?void 0:w.length)>0?(0,e.jsx)(Me.Z,{agentList:c.agents_data,size:"sm"}):(0,e.jsx)(xe.Z,{Image:c.type==2?"/icons/chat_room.svg":(0,je.s9)("single",c.icon),avatar:c.avatar,icon:"".concat(h,".svg")})}),(0,e.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,e.jsx)("div",{className:"text-sm text-[#213044]",children:(0,e.jsx)(fe.Z.Paragraph,{ellipsis:{rows:2,tooltip:c.name},className:"!mb-0",children:c.name})}),(0,e.jsx)("div",{className:"text-xs text-[#999999]",children:g})]})]})},$e=function(){var D,u,w=(0,Y.Z)(function(o){return o.setDealtWithData}),c=(0,Y.Z)(function(o){return o.prevConfirmDealtWith}),i=(0,Y.Z)(function(o){return o.dealtWithData}),h=(0,Y.Z)(function(o){return o.setRunPanelLogRecord}),p=(0,Y.Z)(function(o){return o.submitPromptId}),g=(0,q.useIntl)(),Z=(0,n.useRef)(null),v=(0,n.useState)(null),y=F()(v,2),f=y[0],x=y[1],I=(0,ge.Z)("pageNumber"),S=F()(I,2),te=S[0],z=S[1],J=function(M){w(M)};(0,re.Z)(function(){var o=b.list.map(function(M){return M.exec_id==c.exec_id&&(M.need_human_confirm=0),M});Q(_()(_()({},b),{},{list:o}))},[c]);var N=function(){var o=k()(C()().mark(function M(se){var de,s,r;return C()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return de=se.current,s=se.pageSize,j.next=3,(0,ce.VE)({current:de,pageSize:s});case 3:return r=j.sent,j.abrupt("return",{list:r.data.list,success:!0,total:r.data.total_count});case 5:case"end":return j.stop()}},M)}));return function(se){return o.apply(this,arguments)}}(),E=he(N,{defaultPageSize:10}),m=E.data,G=E.loading,P=E.pagination,ee=(0,n.useState)(m),ae=F()(ee,2),b=ae[0],Q=ae[1];(0,n.useEffect)(function(){Q(m)},[m]),(0,re.Z)(function(){Z.current&&Z.current.reload()},[p]);var a=(0,n.useCallback)(function(o){var M=o.item;return(0,e.jsxs)("div",{className:"flex flex-col gap-1 truncate flex-1",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:M.app_name})," ",(0,e.jsx)(ie.Z,{}),(0,e.jsx)("span",{className:M.need_human_confirm==1?"text-[#1B64F3]":"text-[#808183]",children:M.node_name})]}),(0,e.jsx)("div",{className:"text-[#999999] text-xs truncate",children:M.app_run_name})]})},[b]);return(0,e.jsx)(we.Z,{spinning:G,children:(0,e.jsxs)("div",{className:"min-h-[300px]",style:{height:"calc(100vh - 596px)"},children:[(0,e.jsx)(Ce,{iconSrc:"/icons/back_log.svg",titleText:g.formatMessage({id:"app.workflow.backlogs.title"}),pagination:P}),(0,e.jsxs)("div",{className:"bg-white rounded-lg p-2.5 mt-4 overflow-y-auto h-full",style:{boxShadow:" 0px 2px 4px 0px rgba(0,0,0,0.05)"},children:[b==null||(D=b.list)===null||D===void 0?void 0:D.map(function(o,M){return o.type=3,(0,e.jsxs)("div",{onClick:function(){o.need_human_confirm&&(w(o),x(o),h(!1))},className:"flex items-center gap-5 cursor-pointer duration-200 rounded-lg  p-2.5 hover:bg-[#fafafa]",children:[(0,e.jsx)(xe.Z,{Image:(0,je.s9)("single",o.icon),avatar:o.avatar}),(0,e.jsx)(a,{item:o}),(0,e.jsx)("div",{children:o.need_human_confirm?(0,e.jsx)(Ze.Z,{title:g.formatMessage({id:"workflow.needHumanConfirm"}),children:(0,e.jsx)(ne.Z,{className:"text-[#1B64F3]"})}):(0,e.jsx)(Ze.Z,{title:g.formatMessage({id:"workflow.noHumanConfirm"}),children:(0,e.jsx)(pe.Z,{className:"text-[#52C41C]"})})})]},o.exec_id)}),!G&&(b==null||(u=b.list)===null||u===void 0?void 0:u.length)===0&&(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:"/images/empty.svg",description:g.formatMessage({id:"app.workflow.backlogs.empty"})})})]})]})})},_e=t(29933),Ie=t(4393),la=Ie.Z.Meta,Te=function(){var D,u,w=(0,q.useIntl)(),c=function(y){var f=y.app_id||y.apps_id;switch(y.type){case 1:q.history.push("/Agents?app_id=".concat(f));break;case 2:q.history.push("/chat_room/".concat(y.chatroom_id));break;case 3:q.history.push("/workspace/workflow?app_id=".concat(f));break;default:break}},i=function(){var v=k()(C()().mark(function y(f){var x,I,S;return C()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return x=f.current,I=f.pageSize,z.next=3,(0,ce.vu)({current:x,pageSize:I});case 3:return S=z.sent,z.abrupt("return",{list:S.data.list,success:!0,total:S.data.total_count});case 5:case"end":return z.stop()}},y)}));return function(f){return v.apply(this,arguments)}}(),h=he(i,{defaultPageSize:8}),p=h.data,g=h.loading,Z=h.pagination;return(0,e.jsxs)("div",{className:"flex-grow-0",children:[(0,e.jsx)(Ce,{iconSrc:"/icons/recently_active.svg",titleText:w.formatMessage({id:"app.workflow.ra.title"}),pagination:Z}),(0,e.jsx)("div",{className:"grid grid-cols-4  gap-4 mt-4",children:p==null||(D=p.list)===null||D===void 0?void 0:D.map(function(v,y){var f=v.type==3?v.process_name:v.last_agent_name;return(0,e.jsx)(_e.Z,{className:"h-[160px] cursor-pointer transition shadow-lg shadow-gray-100 hover:shadow-gray-200",title:(0,e.jsx)(Oe,{item:v}),onClick:function(){return c(v)},bodyStyle:{padding:"15px 20px"},children:(0,e.jsx)(fe.Z.Paragraph,{ellipsis:{rows:2,tooltip:f},children:f})},v.app_id)})}),!(p!=null&&(u=p.list)!==null&&u!==void 0&&u.length)&&(0,e.jsxs)("div",{className:"h-[400px] w-full flex items-center justify-center",children:[!g&&(0,e.jsx)(ye.Z,{imageStyle:{display:"flex",justifyContent:"center"},image:"/images/empty.svg",description:w.formatMessage({id:"app.workflow.ra.empty"})}),(0,e.jsx)(we.Z,{spinning:g})]})]})},Fe=t(37369),Le=t(43722),ke=t(39873),We=t(28508),me=t(66309),Ae=t(83622),oe=t(26412),Se=t(98486),Ne=t(97807),Be=t(86),Re=t(38027),Ue=(0,n.memo)(function(D){var u,w,c,i,h,p,g,Z,v,y,f,x,I,S,te,z,J,N=D.data,E=D.onClose,m=(0,q.useIntl)(),G=(0,n.useState)(500),P=F()(G,2),ee=P[0],ae=P[1],b=(0,Y.Z)(function(s){return s.setRunPanelLogRecord}),Q=(0,De.Z)(function(){var s=k()(C()().mark(function r(d,j){var l;return C()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(0,Le.Gh)({chatroom_id:d,app_run_id:j});case 2:return l=T.sent,T.abrupt("return",l.data);case 4:case"end":return T.stop()}},r)}));return function(r,d){return s.apply(this,arguments)}}(),{manual:!0}),a=Q.data,o=Q.loading,M=Q.run;(0,n.useEffect)(function(){N!=null&&N.chatroom_id&&N!==null&&N!==void 0&&N.app_run_id&&M(N.chatroom_id,N.app_run_id)},[N==null?void 0:N.chatroom_id,N==null?void 0:N.app_run_id,M]);var se=function(r){var d={1:{color:"processing",text:m.formatMessage({id:"workflow.running"})},2:{color:"success",text:m.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:m.formatMessage({id:"workflow.runF"})}},j=d[r]||{color:"default",text:"Unknown"};return(0,e.jsx)(me.Z,{color:j.color,children:j.text})},de=function(r){ae(r)};return(0,e.jsx)(ke.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:ee,onChange:de,children:(0,e.jsx)(_e.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,e.jsx)(Ae.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:E,icon:(0,e.jsx)(We.Z,{})}),title:(0,e.jsx)(fe.Z.Title,{level:5,children:m.formatMessage({id:"app.chatroom.log.title"})}),loading:o,children:(0,e.jsx)("div",{className:"space-y-6",children:o?(0,e.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,e.jsx)(we.Z,{})}):a!=null&&a.source_run?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(oe.Z,{column:1,bordered:!0,size:"small",children:[(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"app.chatroom.log.name"}),children:a.source_run.name}),(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"workflow.created_time"}),children:a.source_run.created_time}),(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"workflow.finished_time"}),children:a.source_run.finished_time}),(0,e.jsxs)(oe.Z.Item,{label:m.formatMessage({id:"workflow.elapsed_time"}),children:[a.source_run.elapsed_time,"s"]}),(0,e.jsx)(oe.Z.Item,{label:"Tokens",children:a.source_run.total_tokens})]}),(0,e.jsxs)("div",{className:"mt-4",children:[(0,e.jsx)(fe.Z.Title,{level:5,children:"\u8BA8\u8BBA\u603B\u7ED3"}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:a.source_run.created_time}),(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] bg-gray-50 rounded mt-2",children:(0,e.jsx)(Se.UG,{rehypePlugins:[Ne.Z],children:a==null||(u=a.source_run)===null||u===void 0?void 0:u.summary})})})]}),a!=null&&a.source_corrections&&(a==null?void 0:a.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),a==null?void 0:a.source_corrections.map(function(s,r){return(0,e.jsx)("div",{className:"mb-[16px] last-of-type:mb-0",children:(0,e.jsx)("div",{className:"rounded-[4px]  ".concat((a==null?void 0:a.source_corrections.length)-1!=r?"bg-[#F7F7F7]":"bg-blue-100"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",s.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),": ",s.created_time]}),(0,e.jsx)(Se.UG,{rehypePlugins:[Ne.Z],children:s==null?void 0:s.corrected_summary})]})})},s.created_time)})]}):(0,e.jsx)(e.Fragment,{}),a!=null&&a.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:a!=null&&(w=a.target_run)!==null&&w!==void 0&&w.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:a==null||(c=a.target_run)===null||c===void 0||(c=c.app)===null||c===void 0?void 0:c.name})]})}),(0,e.jsx)("div",{children:a!=null&&(i=a.target_run)!==null&&i!==void 0&&(i=i.inputs)!==null&&i!==void 0&&i.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[m.formatMessage({id:"app.summaryhistory.input"}),":"]}),(0,Re.vw)(a==null||(h=a.target_run)===null||h===void 0||(h=h.inputs)===null||h===void 0?void 0:h.properties).map(function(s){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:s.display_name||s.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:s.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:a!=null&&(p=a.target_run)!==null&&p!==void 0&&p.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[m.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:a==null||(g=a.target_run)===null||g===void 0?void 0:g.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(a==null||(Z=a.target_run)===null||Z===void 0?void 0:Z.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(Se.UG,{rehypePlugins:[Ne.Z],children:a==null||(v=a.target_run)===null||v===void 0||(v=v.outputs)===null||v===void 0?void 0:v.value})}):(0,e.jsx)(Be.Z,{status:a==null||(y=a.target_run)===null||y===void 0?void 0:y.status,icon:a==null||(f=a.target_run)===null||f===void 0?void 0:f.icon,title:a==null||(x=a.target_run)===null||x===void 0?void 0:x.name,textDetails:(0,e.jsx)(Re.p1,{progressObj:{created_time:a==null||(I=a.target_run)===null||I===void 0?void 0:I.created_time,elapsed_time:a==null||(S=a.target_run)===null||S===void 0?void 0:S.elapsed_time,app_name:a==null||(te=a.target_run)===null||te===void 0?void 0:te.app.name,status:a==null||(z=a.target_run)===null||z===void 0?void 0:z.status}}),handleClick:function(){var r,d,j,l,V,T,X,le,U,ve;b({app_id:a==null||(r=a.target_run)===null||r===void 0||(r=r.app)===null||r===void 0?void 0:r.id,app_name:a==null||(d=a.target_run)===null||d===void 0||(d=d.app)===null||d===void 0?void 0:d.name,icon:a==null||(j=a.target_run)===null||j===void 0?void 0:j.icon,workflow_id:a==null||(l=a.target_run)===null||l===void 0?void 0:l.workflow_id,type:2,app_run_id:a==null||(V=a.target_run)===null||V===void 0?void 0:V.id,run_name:a==null||(T=a.target_run)===null||T===void 0?void 0:T.name,status:a==null||(X=a.target_run)===null||X===void 0?void 0:X.status,created_time:a==null||(le=a.target_run)===null||le===void 0?void 0:le.created_time,elapsed_time:a==null||(U=a.target_run)===null||U===void 0?void 0:U.elapsed_time,completed_progress:"".concat(a==null||(ve=a.target_run)===null||ve===void 0?void 0:ve.percentage,"%")})},progress:a==null||(J=a.target_run)===null||J===void 0?void 0:J.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]}):null})})})}),He=t(4730),Ke=t(66212),Ge=t(88284),Ve=t(28058),Ye=t(2068),Je=t(44720),Qe=t(38703),Xe=t(55241),qe=t(34041),ea=(0,n.memo)(function(){var D,u,w=(0,Y.Z)(function(s){return s.setDealtWithData}),c=(0,Y.Z)(function(s){return s.setRunPanelLogRecord}),i=(0,q.useIntl)(),h=(0,n.useState)(0),p=F()(h,2),g=p[0],Z=p[1],v=function(r){var d=r.text;switch(d){case 1:return(0,e.jsx)(Ke.Z,{className:"text-blue-500"});case 2:return(0,e.jsx)(Ge.Z,{className:"text-green-500"});case 3:return(0,e.jsx)(Ve.Z,{className:"text-red-500"})}return(0,e.jsx)("span",{children:d})},y=function(){var s=k()(C()().mark(function r(d){var j,l,V,T,X;return C()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return j=d.current,l=d.pageSize,V=d.showStatus,T=V===void 0?0:V,U.next=3,(0,ce.PE)({current:j,pageSize:l,showStatus:T});case 3:return X=U.sent,U.abrupt("return",{list:X.data.list,success:!0,total:X.data.total_count});case 5:case"end":return U.stop()}},r)}));return function(d){return s.apply(this,arguments)}}(),f=he(function(s){var r=s.current,d=s.pageSize;return y({current:r,pageSize:d,showStatus:g})},{defaultPageSize:10,refreshDeps:[g]}),x=f.data,I=f.loading,S=f.pagination,te=f.run,z=(0,n.useState)(!1),J=F()(z,2),N=J[0],E=J[1],m=(0,n.useState)(null),G=F()(m,2),P=G[0],ee=G[1],ae=(0,n.useState)(!1),b=F()(ae,2),Q=b[0],a=b[1],o=function(){E(!1),a(!1)},M=function(r){switch(r.show_status){case 1:ee(r),E(!1),a(!0);break;case 2:ee(r),a(!1),E(!0);break;case 3:c(r),w(null);break;default:break}},se=function(r){var d=r.type;switch(d){case 1:return(0,e.jsx)(me.Z,{color:"blue",children:i.formatMessage({id:"app.workflow.log.type.roundtable"})});case 2:return(0,e.jsx)(me.Z,{color:"green",children:i.formatMessage({id:"app.workflow.log.type.agent"})});case 3:return(0,e.jsx)(me.Z,{color:"purple",children:i.formatMessage({id:"app.workflow.log.type.workflow"})})}},de=(0,n.memo)(function(s){var r,d,j,l=s.item,V=l.status==1?"#1B64F3":l.status==2?"#22C55F":"#F04444",T=l.status==1?"#f9fafe":l.status==2?"#f6fcf3":"#fafafa",X=(0,n.useRef)(null),le=(0,Je.Z)(X),U=function(){return l.show_status==1?l.chat_room_name:l.show_status==2?l.app_runs_name:l.show_status==3?l.associated_chat_room_name!=""?i.formatMessage({id:"app.workflow.log.roundtable.guidance"},{name:l.associated_chat_room_name}):l.app_runs_name:l.apps_name},ve=function(){return l.show_status==1&&l.apps_name?i.formatMessage({id:"app.workflow.log.guidance.execution"},{type:l.model==1?i.formatMessage({id:"app.workflow.log.type.agent.simple"}):i.formatMessage({id:"app.workflow.log.type.workflow.simple"}),name:l.apps_name}):l.apps_name};return(0,e.jsxs)("div",{onClick:function(){M(l)},ref:X,className:"flex relative rounded truncate gap-5  items-center shrink-0 cursor-pointer duration-200  box-border py-2.5 pr-5 ",children:[(0,e.jsx)("div",{style:{backgroundColor:le?T:"",width:le?"".concat(l.completed_steps/l.total_steps*100,"%"):"0%",transition:"0.5s"},className:"w-full h-full absolute left-0 duration-500"}),(0,e.jsx)("div",{style:{backgroundColor:V},className:"w-[4px] h-full z-10 mr-[10px] absolute"}),(0,e.jsx)("div",{className:"ml-5",children:((r=l.agents_data)===null||r===void 0?void 0:r.length)>0?(0,e.jsx)("div",{className:"ml-2",children:(0,e.jsx)(Me.Z,{agentList:l.agents_data,size:"sm"})}):(0,e.jsx)(xe.Z,{Image:(0,je.s9)("single",l.icon),avatar:l.avatar})}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 truncate flex-1  z-10",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("span",{children:[(0,e.jsx)(se,{type:l.show_status}),(0,e.jsx)(U,{})]})}),(0,e.jsx)("div",{className:"text-[#999999] text-xs truncate  max-w-7/8",children:(0,e.jsxs)("div",{className:"flex items-center truncate",children:[(0,e.jsxs)("span",{children:[" ",l.created_time," "]}),(0,e.jsx)("span",{style:{maxWidth:"calc(100% - 200px)"},className:"truncate ml-2 ",children:(0,e.jsx)(ve,{})}),(l.show_status==3||l.show_status==2)&&(0,e.jsxs)("span",{className:"inline-flex items-center ml-2 gap-2",children:[(0,e.jsx)("span",{style:{backgroundColor:V},className:"inline-block w-1 h-1 rounded-sm"}),(d=l.elapsed_time)===null||d===void 0?void 0:d.toFixed(6),"S"]})]})})]}),l.total_steps!=l.completed_steps&&(0,e.jsx)("div",{className:"flex items-center justify-center",children:(0,e.jsx)(Qe.Z,{type:"circle",size:30,percent:parseInt(l.completed_steps/l.total_steps*100)})}),l.show_status==3&&(l==null||(j=l.file_list)===null||j===void 0?void 0:j.length)>0&&(0,e.jsx)("div",{className:"flex items-center justify-center z-20",children:(0,e.jsx)(Xe.Z,{content:(0,e.jsx)(Fe.Z,{files:l==null?void 0:l.file_list}),placement:"leftTop",title:i.formatMessage({id:"app.workflow.log.output.files"}),children:(0,e.jsx)(Ye.Z,{className:"text-[22px] text-green-600"})})})]},l.app_run_id)});return(0,e.jsxs)("div",{className:"min-h-[300px]",style:{height:"calc(100vh - 596px)"},children:[(0,e.jsx)(Ce,{iconSrc:"/icons/workflows.svg",titleText:i.formatMessage({id:"app.workflow.log.title"}),pagination:S,showTotal:!1,titleAfter:(0,e.jsx)("div",{className:"flex-1 flex justify-end",children:(0,e.jsx)(qe.Z,{defaultValue:0,className:"w-full max-w-[120px]",allowClear:!0,style:{maxWidth:"120px"},onChange:function(r){var d;Z(r),(d=S.onChange)===null||d===void 0||d.call(S,1,S.pageSize)},size:"small",options:[{label:i.formatMessage({id:"app.workflow.log.filter.all"}),value:0},{label:i.formatMessage({id:"app.workflow.log.filter.roundtable"}),value:1},{label:i.formatMessage({id:"app.workflow.log.filter.agent"}),value:2},{label:i.formatMessage({id:"app.workflow.log.filter.workflow"}),value:3}]})})}),(0,e.jsxs)("div",{className:"bg-white rounded-lg p-4 h-full mt-4 overflow-y-auto box-border relative flex flex-col gap-5",style:{boxShadow:" 0px 2px 4px 0px rgba(0,0,0,0.05)"},children:[x==null||(D=x.list)===null||D===void 0?void 0:D.map(function(s,r){return(0,e.jsx)(de,{item:s})}),!I&&(x==null||(u=x.list)===null||u===void 0?void 0:u.length)===0&&(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:"/images/empty.svg",description:i.formatMessage({id:"app.workflow.log.empty"})})})]}),N&&(P==null?void 0:P.app_run_id)&&(0,e.jsx)(He.Z,{data:P,onClose:o}),Q&&(0,e.jsx)(Ue,{data:{chatroom_id:P==null?void 0:P.chatroom_id,app_run_id:P==null?void 0:P.app_run_id},onClose:o})]})}),aa=function(){return(0,e.jsxs)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full p-[30px] flex flex-col gap-6 overflow-x-auto box-border",children:[(0,e.jsx)(Te,{}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-6 flex-1",children:[(0,e.jsx)($e,{}),(0,e.jsx)(ea,{})]}),(0,e.jsx)(O.$_,{}),(0,e.jsx)($.Z,{})]})},ta=aa}}]);
