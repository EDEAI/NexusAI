"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[375],{80459:function(yt,We,l){var Ue=l(32332),_=l(67294),Ze=l(85893),T=function(oe){var g=oe.width,Re=g===void 0?"40px":g,re=oe.bg,De=re===void 0?"#F4F8F1":re,te=oe.rounded,Be=te===void 0?"6px":te,H=oe.data,X=oe.imgWidth,de=X===void 0?"18px":X,S=oe.background;H!=null&&H.avatar&&(de=Re);var B=S||De;return(0,Ze.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Re,height:Re,backgroundColor:B,borderRadius:Be},children:(0,Ze.jsx)("img",{src:H!=null&&H.avatar?H.avatar:(0,Ue.s9)("single",H==null?void 0:H.icon),style:{width:de,height:de,borderRadius:Be},alt:""})})};We.Z=(0,_.memo)(T)},61806:function(yt,We,l){l.d(We,{F:function(){return zn}});var Ue=l(97857),_=l.n(Ue),Ze=l(5574),T=l.n(Ze),Se=l(45360),oe=l(55026),g=l(67294),Re=l(15009),re=l.n(Re),De=l(19632),te=l.n(De),Be=l(99289),H=l.n(Be),X=l(9783),de=l.n(X),S=l(43722),B=l(39e3),w=l(35312),se=l(74330),q=l(41428),t=l(85893),lt=function(e){var n=e.roomid,a=(0,w.useIntl)(),r=(0,B.Z)(function(v){return v.setSummaryClick}),o=(0,g.useState)(!0),u=T()(o,2),s=u[0],c=u[1],x=(0,B.Z)(function(v){return v.summaryClick});(0,g.useEffect)(function(){c(x)},[x]);var m=(0,B.Z)(function(v){return v.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(s?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){s&&(m({id:n}),r(!1))},children:[(0,t.jsx)(q.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},He=l(80459),ze=l(32332),Ee=l(55060),xe=l(28036),ke=l(69753),Ie=l(97245),Ve=l(77295),Je=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},R=function(e){var n=e.fileList,a=e.onDownload,r=a===void 0?Je:a,o=e.className,u=o===void 0?"":o,s=e.showInGrid,c=s===void 0?!1:s,x=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(u),style:{maxHeight:x,overflow:x?"auto":"visible"},children:(0,t.jsx)(Ee.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(c?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(m,v){var f=m.path_show||m.url,j=(0,Ve.CO)(m.name);return(0,t.jsx)("div",{className:"".concat(c?"":"mb-2"),children:j?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(Ee.Z,{src:f,alt:m.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(xe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(d){d.stopPropagation(),r(f,m.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Ie.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:m.name})]}),(0,t.jsx)(xe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(){return r(f,m.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(m.uid||m.file_id||v))})})})})},W=R,ie=l(22683),ve=l(97807),le=l(4958),me=l(13769),he=l.n(me),qe=function(){var i=H()(re()().mark(function e(n){return re()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",ht(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",ht(n));case 12:case"end":return r.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),ht=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},nt=l(52677),ee=l.n(nt),Ae=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},ut=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):g.isValidElement(e)?i(e.props.children):""},rt=function(e){return ut(e)},Ce=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||ee()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,u=o===void 0?!0:o,s=n.checkMCPTools,c=s===void 0?!0:s,x=n.checkStreaming,m=x===void 0?!0:x,v=n.minTextLength,f=v===void 0?1:v,j=function(){if(!r)return!1;try{var b=e.content;return b&&typeof b=="string"&&b.trim().length>=f}catch(L){return console.warn("Error checking text content:",L),!1}},M=function(){if(!u)return!1;try{var b=e.fileList||e.file_list;return b&&Array.isArray(b)&&b.length>0}catch(L){return console.warn("Error checking file content:",L),!1}},d=function(){if(!c)return!1;try{var b;if((b=e.parsedContent)!==null&&b!==void 0&&b.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var L=e.contentBlocks.some(function(J){return J&&J.type==="mcp"&&J.toolId});if(L)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(J){return console.warn("Error checking MCP content:",J),!1}},I=function(){if(!m)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(b){return b&&b.type==="text"&&b.content&&b.content.trim().length>=f}):!1}catch(b){return console.warn("Error checking streaming content:",b),!1}};return j()||M()||d()||I()}catch(N){return console.error("hasMessageContent unexpected error:",N),!0}},Ge=function(e){try{var n=(e==null?void 0:e.content)||"",a=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],r=(e==null?void 0:e.parsedContent)||{},o=(e==null?void 0:e.contentBlocks)||[],u=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(s){return(s==null?void 0:s.type)==="mcp"}),hasActiveMCP:Array.isArray(u)&&u.length>0,hasStreamingText:o.some(function(s){var c;return(s==null?void 0:s.type)==="text"&&(s==null||(c=s.content)===null||c===void 0?void 0:c.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(u)?u.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(s){return console.error("analyzeMessageContent error:",s),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},ct=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var a=e[0];return a.is_agent===1&&a.content!=""?a:null}catch(r){return console.error("checkLastAgentMessage error:",r),null}},dt=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},gt=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},Ye=function(e,n){try{var a=_()(_()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),r=e.contentBlocks;if(!r&&e.parsedContent?r=dt(e.parsedContent):!r&&e.content&&(r=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&r){var o=gt(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(u){return console.error("prepareHistoryMessageForCurrent error:",u),e}},mt=["node","className","children"],xt=["node"],ae=["node","children"],jt=["node","children"],V=["node","children"],at=["node","children"],At=["node","children"],kt=["node","children"],Ct=function(e,n){var a=function(o,u){try{var s=document.createElement("a");s.href=o,s.download=u,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(c){}};return{code:function(o){var u=o.node,s=o.className,c=o.children,x=he()(o,mt),m=/language-(\w+)/.exec(s||"");if(m!=null&&m.length){var v=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:m[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var f=H()(re()().mark(function j(M){var d,I;return re()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,d=M.currentTarget,b.next=4,qe(rt(c));case 4:I=b.sent,I&&d?(d.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){d&&(d.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):d&&(d.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){d&&(d.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),b.next=11;break;case 8:b.prev=8,b.t0=b.catch(0),console.error("Failed to copy text: ",b.t0);case 11:case"end":return b.stop()}},j,null,[[0,8]])}));return function(j){return f.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(v).concat(e),className:"p-4",children:c})})]})}else return(0,t.jsx)("code",_()(_()({},x),{},{children:c}))},img:function(o){var u=o.node,s=he()(o,xt);return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(Ee.Z,{src:s.src,alt:s.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(xe.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(x){x.stopPropagation(),a(s.src||"",s.alt||"image.png")}})})]},s.src)},table:function(o){var u=o.node,s=o.children,c=he()(o,ae);return(0,t.jsx)("div",{className:"overflow-x-auto my-4 border border-gray-300 rounded-lg",children:(0,t.jsx)("table",_()(_()({className:"min-w-full"},c),{},{children:s}))})},thead:function(o){var u=o.node,s=o.children,c=he()(o,jt);return(0,t.jsx)("thead",_()(_()({className:"bg-gray-50"},c),{},{children:s}))},tbody:function(o){var u=o.node,s=o.children,c=he()(o,V);return(0,t.jsx)("tbody",_()(_()({className:"bg-white"},c),{},{children:s}))},tr:function(o){var u=o.node,s=o.children,c=he()(o,at);return(0,t.jsx)("tr",_()(_()({className:"border-b border-gray-200 hover:bg-gray-50"},c),{},{children:s}))},th:function(o){var u=o.node,s=o.children,c=he()(o,At);return(0,t.jsx)("th",_()(_()({className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},c),{},{children:s}))},td:function(o){var u=o.node,s=o.children,c=he()(o,kt);return(0,t.jsx)("td",_()(_()({className:"px-4 py-3 text-sm text-gray-900 border-r border-gray-200 last:border-r-0"},c),{},{children:s}))}}},Wt=l(61227),It=l.n(Wt),Pt=l(29608),$e=l(97175),Tt=l(4161),Mt=l(49354),Ft=l(45699),Nt=l(8751),Ot=l(79090),E=l(66212),ne=l(16596),Me=l(11475),bt=l(2830),ot=l(87547),st=l(71471),et=l(47221),_t=l(66309),St=l(4393),O=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i.WAITING_FILE_UPLOAD="waiting_file_upload",i}({}),Dt=function(e,n){if(e){if(e.status==="waiting_confirm")return O.WAITING_CONFIRMATION;if(n===null)return O.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return O.FAILED}catch(r){}else if(ee()(n)==="object"&&n.status==="failed")return O.FAILED;return O.COMPLETED}return O.PENDING},Zt=(0,g.createContext)(void 0),Jt=function(e){var n=e.children,a=e.agentChatRoomId,r=(0,g.useRef)(null),o=(0,g.useRef)(null),u=(0,g.useState)(!1),s=T()(u,2),c=s[0],x=s[1],m=(0,g.useState)([]),v=T()(m,2),f=v[0],j=v[1],M=(0,w.useParams)(),d=M.id,I=(0,w.useLocation)(),N=new URLSearchParams(I.search),b=N.get("id"),L=a||d||b,J={scrollDomRef:r,upButtonDom:o,isStop:c,setIsStop:x,instruction:f,setInstruction:j,id:L};return(0,t.jsx)(Zt.Provider,{value:J,children:n})},ft=function(){var e=(0,g.useContext)(Zt);if(e===void 0)throw new Error("useChatRoomContext must be used within a ChatRoomProvider");return e},Yt=function(e){var n,a=e.fileConfig,r=e.value,o=e.onChange,u=(0,Ve.ZP)({maxSizeMB:a.maxSize||10,acceptedFileTypes:((n=a.accepted_types)===null||n===void 0?void 0:n.join(","))||void 0,multiple:!1}),s=u.uploadedFiles,c=u.handleUpload,x=u.removeFile,m=u.clearFiles,v=u.isUploading,f=(0,w.useIntl)();return(0,g.useEffect)(function(){if(s.length>0){var j=s[s.length-1],M={file_name:j.name,file_path:j.path_show,size:0,type:"",id:j.file_id,status:"done"};o(M)}else o(null)},[s]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[a.name,a.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),a.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:a.description}),a.accepted_types&&a.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",a.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:s.length===0?(0,t.jsx)(xe.ZP,{type:"dashed",onClick:c,loading:v,disabled:v,className:"w-48",children:v?f.formatMessage({id:"app.chatroom.mcptool.uploading"}):f.formatMessage({id:"app.chatroom.mcptool.uploadFile"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:s[s.length-1].name}),(0,t.jsx)(xe.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return x(s[s.length-1].uid)},disabled:v,children:f.formatMessage({id:"app.chatroom.mcptool.remove"})})]})})]})},$t=Yt,Qt=function(e){var n=e.toolData,a=e.onFileUploadComplete,r=e.onFileUploadError,o=n.files_to_upload||[],u=(0,g.useState)({}),s=T()(u,2),c=s[0],x=s[1],m=(0,w.useIntl)(),v=o.every(function(d){return d.required===!1||c[d.variable_name]&&c[d.variable_name].status==="done"}),f=function(I,N){x(function(b){var L=_()({},b);return N?L[I]=N:delete L[I],L})},j=function(){return o.map(function(I){var N=c[I.variable_name];return _()(_()({},I),N)})},M=function(){if(!v){Se.ZP.warning(m.formatMessage({id:"app.chatroom.mcptool.pleaseUploadAllRequiredFiles"}));return}var I=j();a(I)};return(0,g.useEffect)(function(){},[v,c,a]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-blue-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:m.formatMessage({id:"app.chatroom.mcptool.requiredFiles"})})}),o.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:m.formatMessage({id:"app.chatroom.mcptool.noFilesRequired"})}),o.map(function(d){return(0,t.jsx)($t,{fileConfig:d,value:c[d.variable_name],onChange:function(N){return f(d.variable_name,N)}},d.variable_name)}),(0,t.jsx)(xe.ZP,{type:"primary",className:"mt-2 w-full",disabled:!v,onClick:M,children:m.formatMessage({id:"app.chatroom.mcptool.completeUpload"})})]})},Xt=Qt,Qe=st.Z.Text,Vn=st.Z.Paragraph,Lt=et.Z.Panel,qt=function(e){var n=e.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)($e.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,t.jsx)(Tt.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,t.jsx)(Mt.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(Ft.Z,{className:"text-purple-600 ".concat(a)});default:return(0,t.jsx)(Ie.Z,{className:"text-gray-600 ".concat(a)})}},Ht=function(e){var n=e.fileList,a=e.intl,r=function(u,s){try{var c=document.createElement("a");c.href=u,c.download=s,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(x){console.error("Download file failed",x)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(o,u){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:qt(o.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,t.jsx)(xe.ZP,{type:"text",size:"small",icon:(0,t.jsx)(ke.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},u)})})},en=function(e){var n=e.status;switch(n){case O.COMPLETED:return(0,t.jsx)(Nt.Z,{className:"text-green-500"});case O.RUNNING:return(0,t.jsx)(Ot.Z,{className:"text-blue-500"});case O.WAITING_CONFIRMATION:return(0,t.jsx)(E.Z,{className:"text-orange-500"});case O.WAITING_FILE_UPLOAD:return(0,t.jsx)(ne.Z,{className:"text-purple-500"});case O.FAILED:return(0,t.jsx)(Me.Z,{className:"text-red-500"});default:return(0,t.jsx)(E.Z,{className:"text-gray-500"})}},tn=function(e){var n=e.status,a=e.intl,r=function(s){switch(s){case O.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case O.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case O.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case O.WAITING_FILE_UPLOAD:return{color:"purple",text:a.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case O.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,t.jsx)(_t.Z,{color:o.color,children:o.text})},wt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(a){return e}try{return JSON.stringify(e,null,2)}catch(a){return String(e)}},nn=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},rn=function(e){if(!e||ee()(e)!=="object")return{specialFields:{},regularFields:e};var n={},a={};return Object.keys(e).forEach(function(r){r==="input_variables"?n[r]=e[r]:a[r]=e[r]}),{specialFields:n,regularFields:a}},an=function(e){var n=e.inputVariables,a=e.intl;return!n||ee()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=T()(r,2),u=o[0],s=o[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[u,":"]}),(0,t.jsx)(Qe,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof s=="string"?s:JSON.stringify(s)})]},u)})})]})},on=function(e){var n=e.args,a=e.intl;try{var r=rn(n),o=r.specialFields,u=r.regularFields,s=o.input_variables&&Object.keys(o.input_variables).length>0,c=u&&Object.keys(u).length>0;return!s&&!c?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[s&&(0,t.jsx)(an,{inputVariables:o.input_variables,intl:a}),c&&(0,t.jsxs)("div",{children:[s&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(u)})})]})]})}catch(x){return console.warn("Failed to parse parameters for enhanced display:",x),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(n)})})}},sn=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(a){return[]}return n&&ee()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(a){return console.warn("Failed to extract file list from result data:",a),[]}},ln=function(e){var n=e.resultData,a=e.intl,r=e.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(x){o=n}var u=o&&ee()(o)==="object"&&o.status==="success"&&o.outputs&&ee()(o.outputs)==="object";if(u){var s=o.outputs,c=Object.keys(s).length>0;return c?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Qe,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(s).map(function(x){var m=T()(x,2),v=m[0],f=m[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Qe,{strong:!0,className:"text-xs text-gray-700",children:[v,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof f=="string"?(0,t.jsx)(ie.U,{rehypePlugins:[ve.Z],components:Ct(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:f}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:wt(f)})})]},v)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===O.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:wt(n)})})},Ut=function(e){var n=e.toolData,a=e.intl,r=e.runtimeData,o=e.updateMCPTool,u=ft(),s=u.setInstruction,c=(r==null?void 0:r.status)||Dt(n.workflow_confirmation_status,n.result),x=nn(n.name,a),m=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,v=(0,Pt.Z)(function(Y){return Y.setDealtWithData}),f=(r==null?void 0:r.result)||n.result,j=null;if(typeof f=="string")try{var M=JSON.parse(f);M.status==="failed"&&(j=M.message)}catch(Y){}else ee()(f)==="object"&&(f==null?void 0:f.status)==="failed"&&(j=f.message);var d=function(){v(_()(_()({},m),{},{exec_id:m.node_exec_id}))},I=function Y($,Ne){if(s){if($.length===0){Ne&&Ne();return}var ge=It()($),tt=ge[0],be=ge.slice(1);s(tt),setTimeout(function(){Y(be,Ne)},100)}},N=function($){if(!o){console.warn("updateMCPTool function not available");return}try{if(o(n.id,{uploaded_files:$,status:O.RUNNING}),s){var Ne=[["MCPTOOLFILES",{id:n.id,files_to_upload:$}]];I(Ne)}debugger}catch(ge){console.error("Error handling file upload completion:",ge),Se.ZP.error("Failed to process file upload completion")}},b=function($){console.error("File upload error:",$),Se.ZP.error($),o&&o(n.id,{status:O.FAILED,error:$})},L=sn(f),J=L&&Array.isArray(L)&&L.length>0,ue=((r==null?void 0:r.uploaded_files)||[]).map(function(Y){return{file_name:Y.file_name||Y.name,file_path:Y.file_path||"",variable_name:Y.variable_name}}),Te=ue&&Array.isArray(ue)&&ue.length>0;return(0,t.jsxs)(St.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(bt.Z,{className:"text-blue-500"}),(0,t.jsx)(Qe,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(_t.Z,{color:"blue",children:x}),(0,t.jsx)(en,{status:c}),(0,t.jsx)(tn,{status:c,intl:a})]}),m&&c!==O.COMPLETED&&c!==O.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ot.Z,{className:"text-orange-500"}),(0,t.jsxs)(Qe,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),m.confirmer_name&&(0,t.jsxs)(Qe,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",m.confirmer_name]})]}),m.show_todo_button&&(0,t.jsx)(xe.ZP,{size:"small",type:"primary",onClick:d,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),j&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(Qe,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",j]})}),(r==null?void 0:r.status)===O.WAITING_FILE_UPLOAD&&(0,t.jsx)(Xt,{toolData:r,onFileUploadComplete:N,onFileUploadError:b}),(0,t.jsxs)(et.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,t.jsxs)(Lt,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(on,{args:(r==null?void 0:r.args)||n.args,intl:a}),Te&&(0,t.jsx)(Ht,{fileList:ue,intl:a})]},"params"),f&&(0,t.jsx)(Lt,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(ln,{resultData:f,intl:a,status:c})},"result"),J&&(0,t.jsx)(Lt,{header:a.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Ht,{fileList:L,intl:a})},"files")]})]})},Rt="<<<mcp-tool-start>>>",Et="<<<mcp-tool-end>>>",Jn=function(e){var n,a=e.files_to_upload&&Array.isArray(e.files_to_upload)&&e.files_to_upload.length>0,r=((n=e.args)===null||n===void 0?void 0:n.input_variables)&&Object.values(e.args.input_variables).some(function(o){return o==="need_upload"});return(a||r)&&!e.result?MCPToolStatus.WAITING_FILE_UPLOAD:getMCPToolStatus(e.workflow_confirmation_status,e.result)},un=function(e){return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.map(function(n){return{name:n.name||"",variable_name:n.variable_name||"",id:n.id||0,file_name:n.file_name||null,file_path:n.file_path||null,required:!0,accept:void 0,maxSize:void 0,description:void 0,accepted_types:void 0}})},cn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],a=0;;){var r=e.indexOf(Rt,a);if(r===-1)break;var o=e.indexOf(Et,r);if(o===-1)break;var u=r+Rt.length,s=e.substring(u,o).trim();try{var c=JSON.parse(s),x=un(c),m={id:c.id,name:c.name||"",skill_or_workflow_name:c.skill_or_workflow_name||"",workflow_run_id:c.workflow_run_id||0,workflow_confirmation_status:c.workflow_confirmation_status||null,args:c.args||{},result:c.result||null,files_to_upload:x};x.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(m.id,":"),x),n.push({toolData:m,startIndex:r,endIndex:o+Et.length})}catch(v){console.error("Failed to parse MCP tool JSON:",v)}a=o+Et.length}return n},dn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=cn(e);if(n.length===0)return[{type:"text",content:e}];var a=[],r=0;if(n.forEach(function(u){if(u.startIndex>r){var s=e.substring(r,u.startIndex).trim();s&&a.push({type:"text",content:s})}a.push({type:"mcp-tool",content:e.substring(u.startIndex,u.endIndex),toolData:u.toolData}),r=u.endIndex}),r<e.length){var o=e.substring(r).trim();o&&a.push({type:"text",content:o})}return a},Pe=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=dn(e),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},Yn=function(e,n,a){var r=_objectSpread({},e);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(u){return u.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},$n=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(a){return a.id===n})||null},Qn=function(e,n){var a=_objectSpread({},e);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},Xn=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},mn=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload},a=JSON.stringify(n,null,0);return"".concat(Rt).concat(a).concat(Et)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},fn=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(n){return!n||ee()(n)!=="object"?(console.warn("Invalid file object in files_to_upload:",n),!1):n.file_path&&typeof n.file_path=="string"&&n.file_path.trim()!==""&&(n.file_path.startsWith("http")||n.file_path.startsWith("/"))})}catch(n){return console.error("Error inferring uploaded files:",n),[]}},Bt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return e.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var u=mn(o);a+=u}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},pn=l(27484),vn=l.n(pn),Gt=function(e){var n,a=e.content,r=e.fileList,o=e.index,u=e.intl,s=e.isAgent,c=e.contentId,x=e.mcpTools,m=e.updateMCPTool,v=e.getMCPTool,f=e.item,j=e.contentBlocks,M=(f==null?void 0:f.parsedContent)||Pe(a);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:s?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:c,children:[r&&r.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(W,{fileList:r,onDownload:Ae})}),j&&j.length>0?(0,t.jsx)("div",{children:j.map(function(d,I){var N,b,L,J,ue,Te;return(0,t.jsx)("div",{children:d.type==="text"?d.content&&(0,t.jsx)(ie.U,{remarkPlugins:[le.Z],rehypePlugins:[ve.Z],components:Ct(o,u),children:d.content}):d.toolId&&v&&(0,t.jsx)(Ut,{toolData:{id:d.toolId,name:((N=v(d.toolId))===null||N===void 0?void 0:N.name)||"",skill_or_workflow_name:((b=v(d.toolId))===null||b===void 0?void 0:b.skill_or_workflow_name)||"",workflow_run_id:(L=v(d.toolId))===null||L===void 0?void 0:L.workflow_run_id,workflow_confirmation_status:(J=v(d.toolId))===null||J===void 0?void 0:J.workflow_confirmation_status,args:((ue=v(d.toolId))===null||ue===void 0?void 0:ue.args)||{},result:(Te=v(d.toolId))===null||Te===void 0?void 0:Te.result},intl:u,runtimeData:v(d.toolId),updateMCPTool:m})},"content-block-".concat(I))})}):M.hasMCPTools?(0,t.jsx)("div",{children:M.blocks.map(function(d,I){return(0,t.jsx)("div",{children:d.type==="text"?(0,t.jsx)(ie.U,{remarkPlugins:[le.Z],rehypePlugins:[ve.Z],components:Ct(o,u),children:d.content}):d.toolData&&(0,t.jsx)(Ut,{toolData:d.toolData,intl:u,runtimeData:v?v(d.toolData.id):null,updateMCPTool:m})},I)})}):(0,t.jsx)(ie.U,{remarkPlugins:[le.Z],rehypePlugins:[ve.Z],components:Ct(o,u),children:a}),e.isCurrentMessage&&!j&&(f==null||(n=f.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:f.activeMCPTools.map(function(d){return v?v(d):null}).filter(Boolean).map(function(d){return(0,t.jsx)(Ut,{toolData:{name:d.name,skill_or_workflow_name:d.skill_or_workflow_name,workflow_run_id:d.workflow_run_id,workflow_confirmation_status:d.workflow_confirmation_status,args:d.args,result:d.result,id:d.id},intl:u,runtimeData:d,updateMCPTool:m},"current-tool-".concat(d.id))})}),f.created_time&&f.is_agent==1&&(0,t.jsx)("div",{className:"text-xs text-gray-300  text-right -mr-2 mb-1",children:vn()(f.created_time).format("YYYY-MM-DD HH:mm:ss")})]})},hn=(0,g.memo)(function(i){var e=i.messageApi,n=i.index,a=i.idName,r=i.cidName,o=(0,w.useIntl)(),u=(0,g.useState)(!1),s=T()(u,2),c=s[0],x=s[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){x(!0)},onMouseLeave:function(){x(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var m=H()(re()().mark(function v(f){var j,M,d;return re()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return j=f.target.closest("#".concat(a).concat(n)),M=j.querySelector("#".concat(r).concat(n)),N.prev=2,N.next=5,qe(M.innerText);case 5:d=N.sent,d?e.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),N.next=13;break;case 9:N.prev=9,N.t0=N.catch(2),console.error("Failed to copy text: ",N.t0),e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return N.stop()}},v,null,[[2,9]])}));return function(v){return m.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(c?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(c?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),gn=l(2068),xn=function(e){var n=e.id,a=e.index,r=e.idName,o=e.cidName,u=(0,w.useIntl)(),s=(0,B.Z)(function(M){return M.setSummaryClick}),c=(0,g.useState)(!0),x=T()(c,2),m=x[0],v=x[1],f=(0,B.Z)(function(M){return M.summaryClick});(0,g.useEffect)(function(){v(f)},[f]);var j=(0,B.Z)(function(M){return M.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(m?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(d){if(m){var I=d.target.closest("#".concat(r).concat(a)),N=I.querySelector("#".concat(o).concat(a));j({id:n,message:N.innerText}),s(!1)}},children:[(0,t.jsx)(gn.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:u.formatMessage({id:"app.chatroom.content.summary"})})]})})},_n=function(e){var n=e.messageApi,a=e.index,r=e.idName,o=e.cidName,u=e.id,s=e.agentChatRoomId,c=e.isAgent;return c?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(hn,{messageApi:n,index:a,idName:r,cidName:o}),!s&&(0,t.jsx)(xn,{id:u,index:a,idName:r,cidName:o})]}):null},Kt=function(e){var n,a=e.item,r=e.index,o=e.agentChatRoomId,u=e.abilitiesList,s=e.messageApi,c=e.id,x=e.idName,m=e.cidName,v=e.mcpTools,f=e.updateMCPTool,j=e.getMCPTool,M=(0,w.useIntl)(),d=a.is_agent===1;return Ce(a)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(d?"":"flex-row-reverse"),children:[d?(0,t.jsx)(He.Z,{data:a}):(0,t.jsx)(He.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(x).concat(r),children:[(0,t.jsxs)("div",{className:"".concat(d?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,ze.Qy)("GET").nickname,a.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(u==null||(n=u.find(function(I){return a.ability_id==I.value}))===null||n===void 0?void 0:n.label)||M.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(d?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Gt,{content:a.content,fileList:a.file_list,index:r,intl:M,isAgent:d,contentId:"".concat(m).concat(r),mcpTools:v,updateMCPTool:f,getMCPTool:j,item:a})}),(0,t.jsx)(_n,{messageApi:s,index:r,idName:x,cidName:m,id:c,agentChatRoomId:o,isAgent:d})]})]}):null},yn=l(47635),Cn=function(e,n,a,r,o,u,s,c,x,m,v,f,j,M,d,I,N){var b=(0,w.useIntl)(),L=(0,B.Z)(function(k){return k.setTruncatable}),J=function(p){try{var h=JSON.parse(p.slice(22,-2));return Array.isArray(h)&&h.length>=2?[h[0],h[1]]:null}catch(y){return console.warn("Failed to parse instruction:",y),null}},ue=function(p){return p.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},Te=function(p){return!p||!p.input_variables?!1:Object.values(p.input_variables).some(function(h){return h==="need_upload"})},Y=function(p){x(function(h){var y=h.contentBlocks||[],C=p(y);return _()(_()({},h),{},{contentBlocks:C})})},$=function(p){Y(function(h){var y=h[h.length-1];return y&&y.type==="text"?h.map(function(C,P){return P===h.length-1?_()(_()({},C),{},{content:(C.content||"")+p}):C}):[].concat(te()(h),[{type:"text",content:p,timestamp:Date.now()}])})},Ne=function(p){Y(function(h){return[].concat(te()(h),[{type:"mcp",toolId:p,timestamp:Date.now()}])})},ge=function(p){return!(p!=null&&p.blocks)||!Array.isArray(p.blocks)?[]:p.blocks.map(function(h){var y;return h.type==="text"?{type:"text",content:h.content||"",timestamp:Date.now()}:h.type==="mcp-tool"&&(y=h.toolData)!==null&&y!==void 0&&y.id?{type:"mcp",toolId:h.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},tt=function(p){return p.filter(function(h){return h.type==="mcp"&&h.toolId}).map(function(h){return h.toolId})},be=function(p,h){j&&j(p,h),f.current&&Object.keys(m).length>0&&x(function(y){var C=y.activeMCPTools||[],P=C.includes(p)?C:[].concat(te()(C),[p]);return _()(_()({},y),{},{activeMCPTools:P})})},Fe=function(p,h,y){try{if(!p||!Array.isArray(p))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!y)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),p;var C=p.filter(function(G){return G.type==="mcp"&&G.toolId}).map(function(G){return G.toolId}),P=h.filter(function(G){return!C.includes(G)}),Z=P.map(function(G){return{type:"mcp",toolId:G,timestamp:Date.now()}});return[].concat(te()(p),te()(Z))}catch(G){return console.error("Failed to sync MCP tool states to contentBlocks:",G),p}},Le={ERROR:function(p){e(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(p),duration:10})},CHAT:function(p){if(Object.keys(m).length&&Ce(m,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var h,y,C=_()({},m);if(((h=C.activeMCPTools)===null||h===void 0?void 0:h.length)>0||((y=C.contentBlocks)===null||y===void 0?void 0:y.length)>0){var P=Fe(C.contentBlocks||[],C.activeMCPTools||[],I);if(I&&P.length>0){var Z=Bt(P,I);Z?(C.content=Z,C.parsedContent=Pe(Z)):C.content&&(C.parsedContent=Pe(C.content))}else C.content&&(C.parsedContent=Pe(C.content));C.contentBlocks=P}else C.content&&(C.parsedContent=Pe(C.content));o(function(_e){return _e.concat(C)}),x({})}var G={content:"".concat(p),is_agent:0};o(function(_e){return _e.concat(G)}),d&&d(!0),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),s.current&&(s.current.style.display="none")})},WITHFILELIST:function(p){o(function(h){if(h.length===0)return h;var y=h.length-1;return h.map(function(C,P){return P===y?_()(_()({},C),{},{file_list:p}):C})}),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),s.current&&(s.current.style.display="none")})},STOPPABLE:function(p){n(p)},TRUNCATABLE:function(p){L(p),p||r.open({type:"success",content:"".concat(b.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(p){r.open({type:"success",content:"".concat(b.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(p){var h=p.id,y=p.name,C=p.skill_or_workflow_name,P=p.args,Z=p.files_to_upload,G=C&&C.toLowerCase().includes("workflow"),_e=Z&&Array.isArray(Z)&&Z.length>0,Xe=_e||Te(P),ye=Xe?O.WAITING_FILE_UPLOAD:O.RUNNING;be(h,{name:y,skill_or_workflow_name:C||y,args:P,status:ye,isWorkflow:G,files_to_upload:Z||[],uploaded_files:[]}),Ne(h)},WITHMCPTOOLRESULT:function(p){var h=p.id,y=p.result,C=O.COMPLETED;if(typeof y=="string")try{var P=JSON.parse(y);P.status==="failed"&&(C=O.FAILED)}catch(Z){}else ee()(y)==="object"&&(y==null?void 0:y.status)==="failed"&&(C=O.FAILED);be(h,{result:y,status:C})},WITHWFSTATUS:function(p){var h=p.id,y=p.status,C={id:y.id,status:y.status,app_run_id:y.app_run_id,node_exec_id:y.node_exec_id,workflow_name:y.workflow_name,need_user_confirm:y.need_user_confirm,show_todo_button:y.show_todo_button,confirmer_name:y.confirmer_name},P;switch(y.status){case"running":P=O.RUNNING;break;case"waiting_confirm":P=O.WAITING_CONFIRMATION;break;case"completed":P=O.COMPLETED;break;case"failed":P=O.FAILED;break;default:P=O.RUNNING;break}be(h,{workflow_confirmation:C,status:P,isWorkflow:!0})},WITHMCPTOOLFILES:function(p){var h=p.id,y=p.files_to_upload,C=p.args;be(h,_()({uploaded_files:y||[],status:O.COMPLETED},C?{args:C}:{}))}},je=function(p,h){Le[p]=h},fe=function(p){var h=p.data,y=J(h),C=ue(h),P=h.indexOf("REPLY")!==-1&&h.indexOf("ENDREPLY")===-1,Z=h.indexOf("ABILITY")!==-1,G=h.indexOf("ENDCHAT")!==-1;if(C){if(!y)return;var _e=y[0],Xe=y[1],ye=Le[_e];ye?ye(Xe):console.warn("Unknown message type: ".concat(_e))}if(C||console.log(f.current,p),!C&&f.current&&(v.current+=h,requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),s.current&&(s.current.style.display="none")}),x(function(Q){var pe=v.current,we=_()(_()({},Q),{},{content:pe});return pe&&(we.parsedContent=Pe(pe)),we}),$(h)),P&&C){var K=y[1];d&&d(!1);var D=c.current.filter(function(Q){return Q.agent_id==K})[0];o(function(Q){var pe=Q;if(Object.keys(m).length&&Ce(m,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var we,it,F=_()({},m);if(((we=F.activeMCPTools)===null||we===void 0?void 0:we.length)>0||((it=F.contentBlocks)===null||it===void 0?void 0:it.length)>0){var pt=Fe(F.contentBlocks||[],F.activeMCPTools||[],I);if(I&&pt.length>0){var vt=Bt(pt,I);vt?(F.content=vt,F.parsedContent=Pe(vt)):F.content&&(F.parsedContent=Pe(F.content))}else F.content&&(F.parsedContent=Pe(F.content));F.contentBlocks=pt}else F.content&&(F.parsedContent=Pe(F.content));pe=Q.concat(F)}return v.current="",x({is_agent:1,icon:D==null?void 0:D.icon,name:D==null?void 0:D.name,content:"",activeMCPTools:[],agent_id:K,parsedContent:null,contentBlocks:[]}),f.current=!0,n(!0),L(!1),pe})}if(Z&&C){var ce=y[1];x(function(Q){return _()(_()({},Q),{},{is_agent:1,ability_id:ce})})}if(G){if(f.current=!1,v.current="",e(!1),n(!1),L(!0),Object.keys(m).length){var Ke,Oe,A=_()({},m);if(((Ke=A.activeMCPTools)===null||Ke===void 0?void 0:Ke.length)>0||((Oe=A.contentBlocks)===null||Oe===void 0?void 0:Oe.length)>0){var U=Fe(A.contentBlocks||[],A.activeMCPTools||[],I);if(I&&U.length>0){var z=Bt(U,I);z?(A.content=z,A.parsedContent=Pe(z)):A.content&&(A.parsedContent=Pe(A.content))}else A.content&&(A.parsedContent=Pe(A.content));A.contentBlocks=U}else A.content&&(A.parsedContent=Pe(A.content));console.log(A),o(function(Q){return Q.concat(A)})}x({}),a("")}};return{getSocketMessage:fe,addMessageHandler:je}},Mn=function(e){var n=e.currentMessage,a=e.agentChatRoomId,r=e.intl,o=e.mcpTools,u=o===void 0?{}:o,s=e.updateMCPTool,c=s===void 0?function(){}:s,x=e.getMCPTool,m=x===void 0?function(){return null}:x,v=ft(),f=v.setInstruction;return!n.name||!Ce(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(He.Z,{data:n}):(0,t.jsx)(He.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,ze.Qy)("GET").nickname}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Gt,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:u,updateMCPTool:c,getMCPTool:m,item:_()(_()({},n),{},{parsedContent:Pe(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},bn=(0,g.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,s=i.setIsStop,c=i.setisEnd,x=i.setSendValue,m=i.agentChatRoomId,v=i.updateMCPTool,f=i.getCurrentMessageList,j=i.mcpTools,M=j===void 0?{}:j,d=i.getMCPTool,I=d===void 0?function(){return null}:d,N=i.setIsWaitingReply,b=i.removeHistoryMessage,L=i.setCurrentMessageFromHistory,J=ft(),ue=J.setInstruction,Te=(0,w.useIntl)(),Y=(0,w.useParams)(),$=Y.id,Ne=(0,w.useLocation)(),ge=new URLSearchParams(Ne.search),tt=ge.get("id"),be=m||$||tt,Fe=(0,B.Z)(function(ye){return ye.setDisableInput}),Le=(0,g.useState)({}),je=T()(Le,2),fe=je[0],k=je[1],p=(0,g.useRef)(!1),h=(0,g.useRef)(""),y=(0,g.useCallback)(function(ye){try{if(!ye||ee()(ye)!=="object"){console.warn("Invalid history message provided:",ye);return}if(ye.is_agent!==1){console.warn("Attempted to set non-agent message as current:",ye);return}var K=Ye(ye,I);if(!K){console.warn("Failed to prepare history message:",ye);return}k(K),p.current=!0,h.current=K.content||""}catch(D){console.error("Failed to set current message from history:",D)}},[I]);(0,g.useEffect)(function(){L&&L(y)},[L,y]);var C=Cn(Fe,s,x,e,n,o,u,r,k,fe,h,p,v,f,N,I,b),P=C.getSocketMessage,Z=(0,yn.Z)("chat",P),G=Z.runSocket,_e=Z.sendMessage,Xe=Z.readyState;return(0,g.useEffect)(function(){Xe==1&&be&&_e(JSON.stringify(["ENTER",parseInt(be)]))},[Xe]),(0,g.useEffect)(function(){a&&Xe==1&&_e(a)},[a]),(0,g.useEffect)(function(){G()},[]),(0,t.jsx)(Mn,{currentMessage:fe,agentChatRoomId:m,intl:Te,mcpTools:M,updateMCPTool:v,getMCPTool:I})}),jn=function(e){var n=e.type,a=n===void 0?"typing":n,r=e.size,o=r===void 0?"medium":r;if(a==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var u={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(s,c){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:_()(_()({},u),{},{animationDelay:"".concat(s,"s")})},c)})})]})}return a==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},In=function(e){var n=e.autoRotate,a=n===void 0?!1:n,r=e.rotateInterval,o=r===void 0?3e3:r,u=e.initialType,s=u===void 0?"wave":u,c=e.size,x=c===void 0?"medium":c,m=(0,g.useState)(s),v=T()(m,2),f=v[0],j=v[1],M=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(jn,{type:f,size:x})})},Pn=function(e){var n=e.isVisible,a=e.animationType,r=a===void 0?"pulse":a,o=e.enableAutoRotate,u=o===void 0?!0:o,s=(0,w.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(In,{initialType:r,autoRotate:u,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:s.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},Tn=(0,g.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,s=i.setIsStop,c=i.setSendValue,x=i.agentChatRoomId,m=i.abilitiesList,v=i.mcpTools,f=i.updateMCPTool,j=i.getMCPTool,M=i.userMessage,d=ft(),I=d.setInstruction,N=(0,g.useState)([]),b=T()(N,2),L=b[0],J=b[1],ue=(0,g.useState)(!1),Te=T()(ue,2),Y=Te[0],$=Te[1],Ne=(0,g.useState)(!1),ge=T()(Ne,2),tt=ge[0],be=ge[1],Fe=(0,g.useRef)(!1),Le=(0,g.useRef)(null),je=(0,w.useParams)(),fe=je.id,k=(0,w.useLocation)(),p=new URLSearchParams(k.search),h=p.get("id"),y=fe||h;(0,g.useEffect)(function(){Y&&(n(function(P){return[].concat(te()(L.reverse()),te()(P))}),J([]),setTimeout(function(){$(!1),o.current.scrollTop=0},200))},[Y]),(0,g.useEffect)(function(){if(!Fe.current&&!(!M||!Array.isArray(M)||M.length===0)){if(!Le.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var P=ct(M);if(P){if(!P.id){console.warn("Found agent message without ID, skipping:",P),Fe.current=!0;return}if(Le.current(P),n){var Z=M.filter(function(G){return G!==P});n(Z)}else console.warn("setUserMessage not available for history update");Fe.current=!0}}catch(G){console.error("Failed to process history message:",G,{userMessageLength:M==null?void 0:M.length,hasCallback:!!Le.current}),Fe.current=!0}}},[M,n]),(0,g.useEffect)(function(){Fe.current=!1},[y]);var C=function(Z){if(n&&M){var G=M.filter(function(_e){return _e!==Z});n(G)}};return(0,t.jsxs)(t.Fragment,{children:[L.length?L.map(function(P,Z){return(0,t.jsx)(Kt,{item:P,index:Z,agentChatRoomId:x,abilitiesList:m,messageApi:e,id:y,idName:"currentContent",cidName:"currentChilContent",mcpTools:v,updateMCPTool:f,setInstruction:I,getMCPTool:j},Z)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(Pn,{isVisible:tt}),(0,t.jsx)(bn,{messageApi:e,setCurrentMessageContent:J,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:u,setIsStop:s,setisEnd:$,setSendValue:c,agentChatRoomId:x,updateMCPTool:f,getCurrentMessageList:function(){return M||[]},mcpTools:v,getMCPTool:j,setIsWaitingReply:be,removeHistoryMessage:C,setCurrentMessageFromHistory:function(Z){Le.current=Z},setInstruction:I})]})}),Nn=(0,g.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,a=i.instruction,r=i.setIsStop,o=i.upButtonDom,u=i.agentList,s=i.agentChatRoomId,c=i.abilitiesList,x=ft(),m=x.setInstruction,v=(0,w.useIntl)(),f=(0,g.useState)(860),j=T()(f,2),M=j[0],d=j[1],I=(0,w.useParams)(),N=I.id,b=(0,w.useLocation)(),L=new URLSearchParams(b.search),J=L.get("id"),ue=s||N||J,Te=(0,g.useState)([]),Y=T()(Te,2),$=Y[0],Ne=Y[1],ge=(0,g.useRef)(!1),tt=(0,g.useState)(""),be=T()(tt,2),Fe=be[0],Le=be[1],je=(0,g.useRef)(null),fe=(0,g.useRef)(!0),k=(0,g.useState)({}),p=T()(k,2),h=p[0],y=p[1],C=(0,g.useRef)(2),P=(0,g.useRef)(1),Z=(0,g.useRef)(0),G=function(U,z){y(function(Q){var pe=Q[U];return pe?_()(_()({},Q),{},de()({},U,_()(_()({},pe),z))):_()(_()({},Q),{},de()({},U,_()({id:U,status:O.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},z)))})},_e=function(U){return h[U]||null},Xe=function(U){var z,Q=U.files_to_upload&&Array.isArray(U.files_to_upload)&&U.files_to_upload.length>0,pe=((z=U.args)===null||z===void 0?void 0:z.input_variables)&&Object.values(U.args.input_variables).some(function(we){return we==="need_upload"});return(Q||pe)&&!U.result?O.WAITING_FILE_UPLOAD:Dt(U.workflow_confirmation_status,U.result)},ye=function(U){var z=U.map(function(Q){var pe=_()({},Q);if(Q.is_agent===1&&Q.content){var we=Pe(Q.content);pe.parsedContent=we,we.hasMCPTools&&we.blocks.forEach(function(it){if(it.type==="mcp-tool"&&it.toolData){var F=it.toolData;if(!h[F.id]){var pt=Xe(F);y(function(vt){return _()(_()({},vt),{},de()({},F.id,{id:F.id,name:F.name,skill_or_workflow_name:F.skill_or_workflow_name||F.name,workflow_run_id:F.workflow_run_id||0,workflow_confirmation_status:F.workflow_confirmation_status||null,args:F.args||{},result:F.result||null,status:pt,isWorkflow:F.skill_or_workflow_name?F.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:F.files_to_upload||[],uploaded_files:fn(F)}))})}}})}return pe});return z},K=function(){var A=H()(re()().mark(function U(z){var Q,pe,we=arguments;return re()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(Q=we.length>1&&we[1]!==void 0?we[1]:function(){},!ue){F.next=6;break}return F.next=4,(0,S.KH)(ue,{page:P.current,page_size:10});case 4:pe=F.sent,pe.code==0&&(C.current=pe.data.total_pages,z||(je.current.style.display="none"),Ne(function(pt){var vt=pe.data.list.reverse(),Vt=ye(vt);return z?te()(Vt):[].concat(te()(pt),te()(Vt))}),z?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):Z.current=pe.data.list.length,fe.current=!0);case 6:case"end":return F.stop()}},U)}));return function(z){return A.apply(this,arguments)}}(),D=function(U){var z=U.target.scrollHeight+(U.target.scrollTop-U.target.clientHeight);ge.current!==Math.ceil(U.target.scrollTop)<-50&&(ge.current=Math.ceil(U.target.scrollTop)<-50,o.current.style.display=ge.current?"flex":"none"),z<10&&fe.current&&(fe.current=!1,P.current=P.current+1,je.current.style.display="flex",C.current>=P.current?K(!1):je.current.style.display="none")},ce=function(U,z){z==="0"&&(z=Number(z));var Q=["".concat(U),z!==""&&z!==null&&z!==void 0?z:null];Le(JSON.stringify(Q))},Ke=(0,B.Z)(function(A){return A.disableInput}),Oe=(0,B.Z)(function(A){return A.clearMemory});return(0,g.useEffect)(function(){Oe&&Oe.length&&ce(Oe[0],Oe[1])},[Oe]),(0,g.useEffect)(function(){a&&a.length&&(ce(a[0],a[1]!==void 0?a[1]:""),m([]))},[a]),(0,g.useEffect)(function(){P.current=1,K(!0)},[]),(0,g.useEffect)(function(){var A=function(){window.innerWidth<1280||d(window.innerWidth-320-(window.innerWidth-320)/2-88)};return A(),window.addEventListener("resize",A),function(){window.removeEventListener("resize",A)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:D,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:s?"":"".concat(M,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:$&&$.length?$.map(function(A,U){return(0,t.jsx)(Kt,{item:_()(_()({},A),{},{id:"c".concat(A.id)}),index:U,agentChatRoomId:s,abilitiesList:c,messageApi:e,id:ue,idName:"content",cidName:"chilContent",mcpTools:h,updateMCPTool:G,getMCPTool:_e},U)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(Tn,{messageApi:e,setUserMessage:Ne,sendValue:Fe,agentList:u,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:Le,agentChatRoomId:s,abilitiesList:c,mcpTools:h,updateMCPTool:G,getMCPTool:_e,userMessage:$})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!s&&!Ke&&$.length?(0,t.jsx)(lt,{roomid:ue}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:je,children:(0,t.jsx)(se.Z,{})})]})})}),wn=l(82114),En=l(77171),An=l(85576),zt=l(96486),Fn=l(58299),On=l(38008),Sn=l(83062),Dn=function(e){var n=e.uploadedFiles,a=e.handleRemoveFile;return n.length?(0,t.jsx)(Ee.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,t.jsx)(_t.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Sn.Z,{title:r.name,children:(0,t.jsx)("div",{className:"flex items-center",children:r.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(Ee.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(ke.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),Ae(r.path_show||r.url,r.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Ie.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(ke.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),Ae(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},Ln=l(52645),Un=l(64317),Rn=function(e){var n=e.agentChatRoomId,a=e.abilitiesList,r=e.abilityId,o=e.setAbilityId,u=e.clearContext,s=(0,w.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,t.jsx)(Un.Z,{label:s.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:s.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(x){o(x)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(xe.ZP,{size:"small",color:"danger",variant:"outlined",onClick:u,icon:(0,t.jsx)(Ln.Z,{}),children:s.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},Bn=l(88484),kn=l(30159),Wn=l(26915),Zn=Wn.Z.TextArea,Hn=function(e){var n=e.userSendvalue,a=e.setUserSendvalue,r=e.disableInput,o=e.isUploading,u=e.isStop,s=e.userSendmessage,c=e.handleFileUpload,x=e.sendMessage,m=e.stopChatRoom,v=(0,w.useIntl)(),f=(0,zt.throttle)(function(){if(r||!n)return!1;x(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(xe.ZP,{type:"text",icon:(0,t.jsx)(Bn.Z,{}),onClick:c,disabled:r||o,loading:o}),(0,t.jsx)(Zn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(M){a(M.target.value)},onPressEnter:s,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(v.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:m,children:(0,t.jsx)(kn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:f,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Gn=(0,g.memo)(function(i){var e,n=i.messageApi,a=i.isStop,r=i.scrollDomRef,o=i.upButtonDom,u=i.agentList,s=i.abilitiesList,c=i.agentChatRoomId,x=i.chatStatus,m=ft(),v=m.setInstruction,f=(0,w.useIntl)(),j=(0,B.Z)(function(K){return K.disableInput}),M=(0,B.Z)(function(K){return K.setDisableInput}),d=(0,B.Z)(function(K){return K.setClearMemory}),I=(0,Fn.m)(),N=I.options,b=c?(0,On.Zc)().isImageSupportModel:function(){return!1},L=(0,g.useState)(null),J=T()(L,2),ue=J[0],Te=J[1],Y=(0,g.useState)(""),$=T()(Y,2),Ne=$[0],ge=$[1],tt=(0,g.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),be=T()(tt,2),Fe=be[0],Le=be[1],je=(0,Ve.ZP)({maxSizeMB:15,acceptedFileTypes:Fe,multiple:!0}),fe=je.uploadedFiles,k=je.handleUpload,p=je.removeFile,h=je.clearFiles,y=je.isUploading;(0,g.useEffect)(function(){var K,D;if(c&&(u==null||(K=u.current)===null||K===void 0?void 0:K.length)>0&&u!==null&&u!==void 0&&(D=u.current[0])!==null&&D!==void 0&&(D=D.agent)!==null&&D!==void 0&&D.m_config_id){var ce,Ke=u==null||(ce=u.current[0])===null||ce===void 0||(ce=ce.agent)===null||ce===void 0?void 0:ce.m_config_id,Oe=b(Ke),A=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(Oe?",.jpg,.png,.jpeg":"");Le(A)}},[u,N,u==null||(e=u.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,b]);var C=function(){var D=An.Z.confirm;D({title:f.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(wn.Z,{}),content:f.formatMessage({id:"app.chatroom.clear.tips"}),okText:f.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:f.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){d(["TRUNCATE","0"])}})},P=function K(D,ce){if(D.length===0){ce&&ce();return}var Ke=It()(D),Oe=Ke[0],A=Ke.slice(1);v(Oe),setTimeout(function(){K(A,ce)},100)},Z=function(D){var ce=[];(fe==null?void 0:fe.length)>0&&ce.push(["FILELIST",fe.map(function(Oe){return Oe.file_id})]);var Ke=ue||0;ce.push(["SETABILITY",Ke]),ce.push(["INPUT",D]),P(ce,function(){(fe==null?void 0:fe.length)>0&&h()})},G=function(D){!D.shiftKey&&D.target.value==""&&(n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),ge(""),D.preventDefault()),!D.shiftKey&&D.keyCode==13&&D.target.value!=""&&(M(!0),ge(""),Z(D.target.value),D.preventDefault())},_e=(0,zt.throttle)(function(){v(["STOP",null])},300),Xe=function(){j||k()},ye=function(D){if(!D){n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}M(!0),Z(D),ge("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:o,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(D){r.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(En.Z,{className:"text-[16px]"})}),(0,t.jsx)(Dn,{uploadedFiles:fe,handleRemoveFile:p}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(fe.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(Rn,{agentChatRoomId:c,abilitiesList:s,abilityId:ue,setAbilityId:Te,clearContext:C}),(0,t.jsx)(Hn,{userSendvalue:Ne,setUserSendvalue:ge,disableInput:j,isUploading:y,isStop:a,userSendmessage:G,handleFileUpload:Xe,sendMessage:ye,stopChatRoom:_e})]})]})}),Kn=(0,g.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,a=i.abilitiesList,r=i.chatStatus,o=ft(),u=o.scrollDomRef,s=o.upButtonDom,c=o.isStop,x=o.setIsStop,m=o.instruction,v=o.setInstruction;(0,g.useEffect)(function(){console.log(r),r==1&&x(!0)},[r]);var f=Se.ZP.useMessage(),j=T()(f,2),M=j[0],d=j[1];return(0,t.jsxs)(t.Fragment,{children:[d,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(Nn,{instruction:m,messageApi:M,scrollDomRef:u,setIsStop:x,upButtonDom:s,agentList:e,agentChatRoomId:n,abilitiesList:a}),(0,t.jsx)(Gn,{messageApi:M,isStop:c,upButtonDom:s,scrollDomRef:u,agentList:e,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})}),zn=(0,g.memo)(function(i){return(0,t.jsx)(Jt,{agentChatRoomId:i.agentChatRoomId,children:(0,t.jsx)(Kn,_()({},i))})})},85877:function(yt,We,l){var Ue=l(19632),_=l.n(Ue),Ze=l(97857),T=l.n(Ze),Se=l(5574),oe=l.n(Se),g=l(52677),Re=l.n(g),re=l(35312),De=l(78234),te=l(77598),Be=l(96486),H=l.n(Be),X=l(67294),de=l(73935),S=l(43413),B=l(92858),w=l(16845),se=l(15425),q=l(85893),t=function(R){var W=R.children;return(typeof document=="undefined"?"undefined":Re()(document))==="object"?de.createPortal(W,document.body):null},lt=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),He=function(R){var W=R.value,ie=R.onChange,ve=R.id,le=R.placeholder,me=R.options,he=(0,re.useIntl)(),qe=(0,X.useRef)(),ht=(0,X.useState)(),nt=oe()(ht,2),ee=nt[0],Ae=nt[1],ut=(0,X.useState)(0),rt=oe()(ut,2),Ce=rt[0],Ge=rt[1],ct=(0,X.useState)(""),dt=oe()(ct,2),gt=dt[0],Ye=dt[1],mt=(0,X.useCallback)(function(E){return(0,q.jsx)(ke,T()({},E))},[]),xt=(0,X.useCallback)(function(E){return(0,q.jsx)(xe,T()({},E))},[]),ae=(0,X.useMemo)(function(){return ze((0,w.BU)((0,B.VC)((0,S.Jh)())))},[]),jt=(0,X.useState)(null),V=oe()(jt,2),at=V[0],At=V[1],kt=(0,se.Z)(function(E){return E.selectedNode}),Ct=(0,se.Z)(function(E){return E.getOutputVariables}),Wt=(0,se.Z)(function(E){return E.getInputVariables}),It=(0,X.useState)([]),Pt=oe()(It,2),$e=Pt[0],Tt=Pt[1];(0,De.Z)(function(){W&&W.length>0&&Mt(W),me!=null&&me.length&&Tt(me.map(function(E){return T()(T()({},E),{},{name:E.label,id:E.value})}))}),(0,te.Z)(function(){var E=H().isEqual(at,W);E||(W&&W.length>0?Mt(W):W&&H().isArray(W)&&W.length==0&&Mt([{type:"paragraph",children:[]}]))},[W,ve]),(0,te.Z)(function(){me.length&&Tt(me.map(function(E){return T()(T()({},E),{},{name:E.label,id:E.value})})),console.log(me)},[me]);var Mt=function(ne){At(ne),Nt(ae,{nodes:[{type:"paragraph",children:[]}]}),Nt(ae,{nodes:ne})},Ft=(0,X.useCallback)(function(E){if(ee&&$e.length>0)switch(E.key){case"ArrowDown":E.preventDefault();var ne=Ce>=$e.length-1?0:Ce+1;Ge(ne);return;case"ArrowUp":E.preventDefault();var Me=Ce<=0?$e.length-1:Ce-1;Ge(Me);return;case"Tab":case"Enter":E.preventDefault(),S.YR.select(ae,ee),Ee(ae,$e[Ce]),Ae(null);return;case"Escape":E.preventDefault(),Ae(null);return}else if(E.key==="@"){setTimeout(function(){return Ot()},10);return}Ae(null)},[$e,ae,Ce,ee]),Nt=function(ne){var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},bt=_()(ne.children);if(bt.forEach(function(et){return ne.apply({type:"remove_node",path:[0],node:et})}),Me.nodes){var ot=S.NB.isNode(Me.nodes)?[Me.nodes]:Me.nodes;ot.forEach(function(et,_t){return ne.apply({type:"insert_node",path:[_t],node:et})})}var st=Me.at&&S.E9.isPoint(Me.at)?Me.at:S.ML.end(ne,[]);st&&S.YR.select(ne,st)};(0,X.useEffect)(function(){if(ee&&$e.length>0){var E=qe.current,ne=w.F3.toDOMRange(ae,ee),Me=ne.getBoundingClientRect();E.style.top="".concat(Me.top+window.pageYOffset+24,"px"),E.style.left="".concat(Me.left+window.pageXOffset,"px")}},[$e.length,ae,Ce,gt,ee]);var Ot=function(){var ne=ae.selection;if(ne&&S.e6.isCollapsed(ne)){var Me=S.e6.edges(ne),bt=oe()(Me,1),ot=bt[0],st=S.ML.before(ae,ot),et=st&&S.ML.range(ae,st,ot),_t=et&&S.ML.string(ae,et),St=S.ML.after(ae,ot),O=S.ML.range(ae,ot,St),Dt=S.ML.string(ae,O);Ae(et),Ye(""),Ge(0);return}Ae(null)};return(0,q.jsxs)(w.mH,{editor:ae,initialValue:Ve,onChange:function(ne){ie==null||ie(ne),Ae(null)},children:[(0,q.jsx)(w.CX,{renderElement:mt,renderLeaf:xt,onKeyDown:Ft,className:"!outline-none",placeholder:le!=null?le:he.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),ee&&(0,q.jsx)(t,{children:(0,q.jsx)("div",{ref:qe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:$e.length?$e.map(function(E,ne){return(0,q.jsx)("div",{onClick:function(){console.log(E),S.YR.select(ae,ee),Ee(ae,E),Ae(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:ne===Ce?"#B4D5FF":""},children:(0,q.jsx)("span",{children:E.name})},E.name+ne)}):(0,q.jsx)(q.Fragment,{children:he.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},ze=function(R){var W=R.isInline,ie=R.isVoid,ve=R.markableVoid;return R.isInline=function(le){return le.type==="mention"?!0:W(le)},R.isVoid=function(le){return le.type==="mention"?!0:ie(le)},R.markableVoid=function(le){return le.type==="mention"||ve(le)},R},Ee=function(R,W){var ie={type:"mention",id:(W==null?void 0:W.id)||"",character:W.name,base:W,children:[{bold:!0,text:"11111"}]};S.YR.insertNodes(R,ie),S.YR.move(R)},xe=function(R){var W=R.attributes,ie=R.children,ve=R.leaf;return(0,q.jsx)("span",T()(T()({},W),{},{children:ie}))},ke=function(R){var W=R.attributes,ie=R.children,ve=R.element;switch(ve.type){case"mention":return(0,q.jsx)(Ie,T()({},R));default:return(0,q.jsx)("p",T()(T()({},W),{},{children:ie}))}},Ie=function(R){var W=R.attributes,ie=R.children,ve=R.element,le=(0,w.vt)(),me=(0,w.UE)(),he={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:le&&me?"0 0 0 2px #B4D5FF":"none"};return ve.children[0].bold&&(he.fontWeight="bold"),ve.children[0].italic&&(he.fontStyle="italic"),(0,q.jsx)("span",T()(T()({},W),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(ve.character.replace(" ","-")),style:he,children:lt?(0,q.jsxs)(X.Fragment,{children:["1",ie,"/",ve.character]}):(0,q.jsxs)(X.Fragment,{children:[(0,q.jsx)("span",{children:ve.character}),ie]})}))},Ve=[{type:"paragraph",children:[{text:""}]}];We.Z=He},38008:function(yt,We,l){l.d(We,{Zc:function(){return g},aS:function(){return oe}});var Ue=l(67294),_=l(85750),Ze=l(58299),T=l(85893),Se=(0,Ue.createContext)(void 0),oe=function(De){var te=De.children,Be=(0,Ze.m)(),H=Be.options,X=(0,Ue.useMemo)(function(){var de=function(w){if(!w||!H)return!1;var se=(0,_.ti)(w,{options:H});return(se==null?void 0:se.support_image)===1},S=function(w){return de(w)};return{isImageSupportModel:de,getCurrentModelImageSupport:S}},[H]);return(0,T.jsx)(Se.Provider,{value:X,children:te})},g=function(){var De=(0,Ue.useContext)(Se);if(De===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return De},Re=null},77295:function(yt,We,l){l.d(We,{CO:function(){return H}});var Ue=l(15009),_=l.n(Ue),Ze=l(19632),T=l.n(Ze),Se=l(99289),oe=l.n(Se),g=l(5574),Re=l.n(g),re=l(45360),De=l(35312),te=l(67294),Be=l(83065),H=function(S){var B,w=S==null||(B=S.split(".").pop())===null||B===void 0?void 0:B.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(w||"")},X=function(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=(0,De.useIntl)(),w=(0,te.useState)([]),se=Re()(w,2),q=se[0],t=se[1],lt=(0,te.useState)(!1),He=Re()(lt,2),ze=He[0],Ee=He[1],xe=S.maxSizeMB,ke=xe===void 0?15:xe,Ie=S.acceptedFileTypes,Ve=Ie===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Ie,Je=S.multiple,R=Je===void 0?!0:Je,W=function(){var me=document.createElement("input");me.type="file",me.accept=Ve,me.multiple=R,me.onchange=function(){var he=oe()(_()().mark(function qe(ht){var nt,ee,Ae,ut,rt,Ce,Ge,ct,dt,gt,Ye,mt,xt,ae;return _()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(nt=ht.target,!(nt.files&&nt.files.length>0)){V.next=37;break}if(Ee(!0),ee=Array.from(nt.files),Ae=ee.filter(function(at){return at.size/1024/1024>ke}),!(Ae.length>0)){V.next=9;break}return re.ZP.error("".concat(Ae.map(function(at){return at.name}).join(", ")," ").concat(B.formatMessage({id:"workflow.uploadFileErrorText"}))),Ee(!1),V.abrupt("return");case 9:ut=[],rt=0,Ce=ee;case 11:if(!(rt<Ce.length)){V.next=35;break}return Ge=Ce[rt],ct=new FormData,ct.append("file",Ge),V.prev=15,V.next=18,(0,Be.M$)();case 18:return dt=V.sent,V.next=21,fetch(dt,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:ct});case 21:return gt=V.sent,V.next=24,gt.json();case 24:Ye=V.sent,Ye.code===0?(re.ZP.success("".concat(Ge.name," ").concat(B.formatMessage({id:"workflow.uploadSuccess"}))),(mt=Ye.data)!==null&&mt!==void 0&&mt.file_id&&(xt=H(Ge.name),ae={name:Ge.name,url:Ye.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:xt,file_id:Ye.data.file_id,path_show:Ye.data.file_url||Ye.data.path_show||""},ut.push(ae))):re.ZP.error("".concat(Ge.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"}))),V.next=32;break;case 28:V.prev=28,V.t0=V.catch(15),console.error("Upload error:",V.t0),re.ZP.error("".concat(Ge.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"})));case 32:rt++,V.next=11;break;case 35:t(function(at){return[].concat(T()(at),ut)}),Ee(!1);case 37:case"end":return V.stop()}},qe,null,[[15,28]])}));return function(qe){return he.apply(this,arguments)}}(),me.click()},ie=function(me){t(function(he){return he.filter(function(qe){return qe.uid!==me})})},ve=function(){t([])};return{uploadedFiles:q,setUploadedFiles:t,handleUpload:W,removeFile:ie,clearFiles:ve,isUploading:ze}};We.ZP=X},58299:function(yt,We,l){l.d(We,{m:function(){return X}});var Ue=l(64599),_=l.n(Ue),Ze=l(97857),T=l.n(Ze),Se=l(15009),oe=l.n(Se),g=l(99289),Re=l.n(g),re=l(73445),De=l(42237),te=l(45360),Be=l(67294),H=(0,re.Ue)(function(de){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var S=Re()(oe()().mark(function w(){var se;return oe()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,de({loading:!0}),t.next=4,(0,De.fZ)();case 4:if(se=t.sent,se.code!==0){t.next=9;break}de({models:Array.isArray(se.data.data)?se.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(se.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),de({error:t.t0.message}),te.ZP.error("Failed to fetch models");case 16:return t.prev=16,de({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},w,null,[[0,12,16,19]])}));function B(){return S.apply(this,arguments)}return B}()}}),X=function(){var S=H(function(t){return t.models}),B=H(function(t){return t.loading}),w=H(function(t){return t.initialized}),se=H(function(t){return t.fetchModels});(0,Be.useEffect)(function(){w||se()},[w,se]);var q=(0,Be.useMemo)(function(){var t=Array.isArray(S)?S:[],lt=t.map(function(Ie){return{label:Ie.supplier_name,options:Array.isArray(Ie.model_list)?Ie.model_list.map(function(Ve){return T()({label:Ve.model_name,value:Ve.model_config_id},Ve)}):[]}}),He,ze=_()(t),Ee;try{for(ze.s();!(Ee=ze.n()).done;){var xe=Ee.value;if(Array.isArray(xe.model_list)){var ke=xe.model_list.find(function(Ie){return Ie.model_default_used===1});if(ke){He=ke.model_config_id;break}}}}catch(Ie){ze.e(Ie)}finally{ze.f()}return{options:lt,defaultValue:He}},[S]);return T()(T()({},q),{},{loading:B})}}}]);
