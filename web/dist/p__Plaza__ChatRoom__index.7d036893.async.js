"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9057],{82826:function(bt,He,a){a.d(He,{Z:function(){return U}});var $e=a(1413),m=a(67294),Ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},g=Ue,de=a(91146),f=function(t,Y){return m.createElement(de.Z,(0,$e.Z)((0,$e.Z)({},t),{},{ref:Y,icon:g}))},se=m.forwardRef(f),U=se},39873:function(bt,He,a){var $e=a(5574),m=a.n($e),Ue=a(42881),g=a(67294),de=a(85893),f=function(U){var it=U.children,t=U.className,Y=t===void 0?"":t,Je=U.dragDirection,q=Je===void 0?"left":Je,ee=U.minWidth,F=ee===void 0?115:ee,H=U.maxWidth,lt=H===void 0?820:H,Me=U.minHeight,Ve=Me===void 0?200:Me,z=U.maxHeight,ot=z===void 0?800:z,Qe=U.defaultWidth,ke=Qe===void 0?415:Qe,qe=U.defaultHeight,Ke=qe===void 0?300:qe,Se=U.onChange,ut=(0,g.useState)(ke),Ge=m()(ut,2),pe=Ge[0],e=Ge[1],S=(0,g.useState)(Ke),b=m()(S,2),te=b[0],ie=b[1],L=(0,g.useCallback)(function(et,We){e(et),We&&ie(We),Se==null||Se(et,We)},[e,ie,Se]),fe=(0,Ue.W)({direction:["left","right"].includes(q)?"horizontal":"vertical",triggerDirection:q,minWidth:F,maxWidth:lt,minHeight:Ve,maxHeight:ot,onResize:L}),ge=fe.triggerRef,Fe=fe.containerRef;return(0,de.jsxs)("div",{ref:Fe,style:{width:["left","right"].includes(q)?"".concat(pe,"px"):void 0,height:["top","bottom"].includes(q)?"".concat(te,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(Y),children:[q==="left"&&(0,de.jsx)("div",{ref:ge,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,de.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),q==="right"&&(0,de.jsx)("div",{ref:ge,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,de.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),q==="top"&&(0,de.jsx)("div",{ref:ge,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,de.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),q==="bottom"&&(0,de.jsx)("div",{ref:ge,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,de.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),it]})};He.Z=(0,g.memo)(f)},85877:function(bt,He,a){var $e=a(19632),m=a.n($e),Ue=a(97857),g=a.n(Ue),de=a(5574),f=a.n(de),se=a(52677),U=a.n(se),it=a(35312),t=a(78234),Y=a(77598),Je=a(96486),q=a.n(Je),ee=a(67294),F=a(73935),H=a(43413),lt=a(92858),Me=a(16845),Ve=a(15425),z=a(85893),ot=function(S){var b=S.children;return(typeof document=="undefined"?"undefined":U()(document))==="object"?F.createPortal(b,document.body):null},Qe=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),ke=function(S){var b=S.value,te=S.onChange,ie=S.id,L=S.placeholder,fe=S.options,ge=(0,it.useIntl)(),Fe=(0,ee.useRef)(),et=(0,ee.useState)(),We=f()(et,2),Re=We[0],Le=We[1],Mt=(0,ee.useState)(0),mt=f()(Mt,2),De=mt[0],ct=mt[1],Nt=(0,ee.useState)(""),ht=f()(Nt,2),Rt=ht[0],Dt=ht[1],Et=(0,ee.useCallback)(function(x){return(0,z.jsx)(ut,g()({},x))},[]),Ct=(0,ee.useCallback)(function(x){return(0,z.jsx)(Se,g()({},x))},[]),V=(0,ee.useMemo)(function(){return qe((0,Me.BU)((0,lt.VC)((0,H.Jh)())))},[]),xt=(0,ee.useState)(null),dt=f()(xt,2),At=dt[0],It=dt[1],Bt=(0,Ve.Z)(function(x){return x.selectedNode}),Ht=(0,Ve.Z)(function(x){return x.getOutputVariables}),gt=(0,Ve.Z)(function(x){return x.getInputVariables}),pt=(0,ee.useState)([]),tt=f()(pt,2),Ne=tt[0],jt=tt[1];(0,t.Z)(function(){b&&b.length>0&&ft(b),fe!=null&&fe.length&&jt(fe.map(function(x){return g()(g()({},x),{},{name:x.label,id:x.value})}))}),(0,Y.Z)(function(){var x=q().isEqual(At,b);x||(b&&b.length>0?ft(b):b&&q().isArray(b)&&b.length==0&&ft([{type:"paragraph",children:[]}]))},[b,ie]),(0,Y.Z)(function(){fe.length&&jt(fe.map(function(x){return g()(g()({},x),{},{name:x.label,id:x.value})})),console.log(fe)},[fe]);var ft=function($){It($),yt(V,{nodes:[{type:"paragraph",children:[]}]}),yt(V,{nodes:$})},_t=(0,ee.useCallback)(function(x){if(Re&&Ne.length>0)switch(x.key){case"ArrowDown":x.preventDefault();var $=De>=Ne.length-1?0:De+1;ct($);return;case"ArrowUp":x.preventDefault();var le=De<=0?Ne.length-1:De-1;ct(le);return;case"Tab":case"Enter":x.preventDefault(),H.YR.select(V,Re),Ke(V,Ne[De]),Le(null);return;case"Escape":x.preventDefault(),Le(null);return}else if(x.key==="@"){setTimeout(function(){return Ot()},10);return}Le(null)},[Ne,V,De,Re]),yt=function($){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},at=m()($.children);if(at.forEach(function(Ze){return $.apply({type:"remove_node",path:[0],node:Ze})}),le.nodes){var ze=H.NB.isNode(le.nodes)?[le.nodes]:le.nodes;ze.forEach(function(Ze,St){return $.apply({type:"insert_node",path:[St],node:Ze})})}var Ye=le.at&&H.E9.isPoint(le.at)?le.at:H.ML.end($,[]);Ye&&H.YR.select($,Ye)};(0,ee.useEffect)(function(){if(Re&&Ne.length>0){var x=Fe.current,$=Me.F3.toDOMRange(V,Re),le=$.getBoundingClientRect();x.style.top="".concat(le.top+window.pageYOffset+24,"px"),x.style.left="".concat(le.left+window.pageXOffset,"px")}},[Ne.length,V,De,Rt,Re]);var Ot=function(){var $=V.selection;if($&&H.e6.isCollapsed($)){var le=H.e6.edges($),at=f()(le,1),ze=at[0],Ye=H.ML.before(V,ze),Ze=Ye&&H.ML.range(V,Ye,ze),St=Ze&&H.ML.string(V,Ze),Pt=H.ML.after(V,ze),kt=H.ML.range(V,ze,Pt),$t=H.ML.string(V,kt);Le(Ze),Dt(""),ct(0);return}Le(null)};return(0,z.jsxs)(Me.mH,{editor:V,initialValue:pe,onChange:function($){te==null||te($),Le(null)},children:[(0,z.jsx)(Me.CX,{renderElement:Et,renderLeaf:Ct,onKeyDown:_t,className:"!outline-none",placeholder:L!=null?L:ge.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),Re&&(0,z.jsx)(ot,{children:(0,z.jsx)("div",{ref:Fe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:Ne.length?Ne.map(function(x,$){return(0,z.jsx)("div",{onClick:function(){console.log(x),H.YR.select(V,Re),Ke(V,x),Le(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:$===De?"#B4D5FF":""},children:(0,z.jsx)("span",{children:x.name})},x.name+$)}):(0,z.jsx)(z.Fragment,{children:ge.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},qe=function(S){var b=S.isInline,te=S.isVoid,ie=S.markableVoid;return S.isInline=function(L){return L.type==="mention"?!0:b(L)},S.isVoid=function(L){return L.type==="mention"?!0:te(L)},S.markableVoid=function(L){return L.type==="mention"||ie(L)},S},Ke=function(S,b){var te={type:"mention",id:(b==null?void 0:b.id)||"",character:b.name,base:b,children:[{bold:!0,text:"11111"}]};H.YR.insertNodes(S,te),H.YR.move(S)},Se=function(S){var b=S.attributes,te=S.children,ie=S.leaf;return(0,z.jsx)("span",g()(g()({},b),{},{children:te}))},ut=function(S){var b=S.attributes,te=S.children,ie=S.element;switch(ie.type){case"mention":return(0,z.jsx)(Ge,g()({},S));default:return(0,z.jsx)("p",g()(g()({},b),{},{children:te}))}},Ge=function(S){var b=S.attributes,te=S.children,ie=S.element,L=(0,Me.vt)(),fe=(0,Me.UE)(),ge={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:L&&fe?"0 0 0 2px #B4D5FF":"none"};return ie.children[0].bold&&(ge.fontWeight="bold"),ie.children[0].italic&&(ge.fontStyle="italic"),(0,z.jsx)("span",g()(g()({},b),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(ie.character.replace(" ","-")),style:ge,children:Qe?(0,z.jsxs)(ee.Fragment,{children:["1",te,"/",ie.character]}):(0,z.jsxs)(ee.Fragment,{children:[(0,z.jsx)("span",{children:ie.character}),te]})}))},pe=[{type:"paragraph",children:[{text:""}]}];He.Z=ke},88872:function(bt,He,a){a.r(He),a.d(He,{default:function(){return Qt}});var $e=a(15009),m=a.n($e),Ue=a(99289),g=a.n(Ue),de=a(5574),f=a.n(de),se=a(43722),U=a(32983),it=a(55026),t=a(67294),Y=a(35312),Je=a(19632),q=a.n(Je),ee=a(97857),F=a.n(ee),H=a(80459),lt=a(82114),Me=a(82826),Ve=a(63783),z=a(3471),ot=a(45360),Qe=a(85576),ke=a(28036),qe=a(83062),Ke=a(72269),Se=a(74330),ut=a(96486),Ge=a(44010),pe=a(39e3),e=a(85893),S=function(u){var c=(0,Y.useIntl)(),E=u.roomDetail,Z=u.setAgent,R=ot.ZP.useMessage(),o=f()(R,2),O=o[0],P=o[1],T=(0,Y.useParams)(),N=T.id,j=(0,pe.Z)(function(s){return s.disableInput}),X=(0,pe.Z)(function(s){return s.truncatable}),W=(0,pe.Z)(function(s){return s.setClearMemory}),J=(0,t.useState)([]),ue=f()(J,2),Q=ue[0],ce=ue[1],k=(0,t.useState)(F()({},E)),C=f()(k,2),K=C[0],ve=C[1],me=(0,t.useState)([]),he=f()(me,2),G=he[0],A=he[1],ae=(0,t.useRef)(!1),Ee=(0,t.useRef)(!1),Ce=(0,t.useState)(!1),xe=f()(Ce,2),ne=xe[0],je=xe[1],Ae=function(){var i=Qe.Z.confirm;i({title:c.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(lt.Z,{}),content:c.formatMessage({id:"app.chatroom.clear.tips"}),okText:c.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:c.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){W(["TRUNCATE","0"])}})},M=function(){var s=g()(m()().mark(function i(){var n;return m()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!N){l.next=5;break}return l.next=3,(0,se.cH)({id:N});case 3:if(n=l.sent,n.code==0)try{ve(function(){return F()(F()({},n.data.chat_info),{},{max_round:n.data.max_round,smart_selection:n.data.smart_selection})}),ce(n.data.agent_list),ae.current=!0}catch(v){}case 5:case"end":return l.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),we=function(){var s=g()(m()().mark(function i(){var n;return m()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,se.j2)({id:N});case 2:n=l.sent,n.code==0&&(A(n.data.list),Ee.current=!0);case 4:case"end":return l.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),be=function(){var s=g()(m()().mark(function i(n){var r,l,v;return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!N){d.next=11;break}if(r=n.active==1?0:1,r!=0){d.next=7;break}if(l=Q.filter(function(_){return _.active==1}),l.length-1!=0){d.next=7;break}return O.open({type:"error",content:c.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),d.abrupt("return",!1);case 7:return d.next=9,(0,se.sT)({active:r},N,n.agent_id);case 9:v=d.sent,v.code==0&&ce(function(_){return _.map(function(I){return F()(F()({},I),{},{active:I.agent_id==n.agent_id?r:I.active})})});case 11:case"end":return d.stop()}},i)}));return function(n){return s.apply(this,arguments)}}(),Ie=function(i){return i.length>6?i.length=6:i.lenth,i},Oe=function(i){i.type=="my_agent"?Y.history.push("/Agents?app_id=".concat(i.app_id,"&type=false&from=chat_room")):Y.history.push("/ReadOnlyAgent?app_id=".concat(i.app_id,"&type=true&from=chat_room"))},B=function(i){Y.history.replace("/chat_room/".concat(i.chatroom_id)),window.location.reload()},y=function(){je(!0)},w=function(){je(!1)},D=function(){var s=g()(m()().mark(function i(n){var r,l,v;return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(n.checkItem&&n.checkItem.length==0)){d.next=3;break}return O.open({type:"error",content:c.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),d.abrupt("return");case 3:return r=q()(n.checkItem).map(function(_){var I=_.agent_id,Te=_.active,re=Te===void 0?1:Te;return{agent_id:I,active:re}}),l={description:K.description,name:K.name,max_round:K.max_round},d.next=7,(0,se.sI)(F()(F()({},l),{},{agent:r}),N);case 7:v=d.sent,v.code==0?(n.checkItem.map(function(_){_.active=_.active==null?1:_.active}),ce(q()(n.checkItem)),Z.current=q()(n.checkItem),O.open({type:"success",content:c.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):O.open({type:"error",content:c.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return d.stop()}},i)}));return function(n){return s.apply(this,arguments)}}(),p=function(){var s=g()(m()().mark(function i(){var n;return m()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=K.smart_selection==1?0:1,l.next=3,(0,se.r5)({smart_selection:n},N);case 3:ve(function(v){return F()(F()({},v),{},{smart_selection:n})});case 4:case"end":return l.stop()}},i)}));return function(){return s.apply(this,arguments)}}();return(0,t.useEffect)(function(){M(),we()},[]),(0,e.jsxs)(e.Fragment,{children:[P,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){Y.history.go(-1)},children:[(0,e.jsx)(ke.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(Me.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:c.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:K.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:c.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(qe.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:c.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ve.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:c.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ke.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:K.smart_selection==1,onChange:p,disabled:j})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:ae.current?(0,e.jsx)("div",{className:"flex flex-col",children:Q&&Q.length>0?Q.map(function(s){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)(H.Z,{data:s}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:s.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:s.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){Oe(s)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ke.Z,{size:"small",disabled:j,defaultChecked:!0,className:"w-[28px]",checked:s.active==1,onChange:function(){be(s)}})]})]},s.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(U.Z,{image:U.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Se.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:y,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:c.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:X&&!j?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,ut.throttle)(function(){X&&!j&&Ae()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:c.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:c.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:Ee.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:G&&G.length>0?G.map(function(s){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){B(s)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:s.name}),s.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:c.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:c.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:s.agent_list&&s.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[Ie(s.agent_list).map(function(i,n){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)(H.Z,{data:i,width:"30px"})},n)}),s.agent_list.length>=6?(0,e.jsx)(z.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},s.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(U.Z,{image:U.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Se.Z,{})})})})]})]}),(0,e.jsx)(Ge.Z,{show:ne,popupClose:w,popupSave:D,checkList:Q,zIndex:99})]})]})},b=(0,t.memo)(S),te=a(18304),ie=a(39873),L=a(1413),fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},ge=fe,Fe=a(91146),et=function(u,c){return t.createElement(Fe.Z,(0,L.Z)((0,L.Z)({},u),{},{ref:c,icon:ge}))},We=t.forwardRef(et),Re=We,Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},Mt=Le,mt=function(u,c){return t.createElement(Fe.Z,(0,L.Z)((0,L.Z)({},u),{},{ref:c,icon:Mt}))},De=t.forwardRef(mt),ct=De,Nt=a(83159),ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},Rt=ht,Dt=function(u,c){return t.createElement(Fe.Z,(0,L.Z)((0,L.Z)({},u),{},{ref:c,icon:Rt}))},Et=t.forwardRef(Dt),Ct=Et,V=a(86),xt=a(34994),dt=a(2216),At=a(85877),It=a(29432),Bt=a(39944),Ht=a(11551),gt=a(55927),pt=a(22683),tt=a(97807),Ne=function(u){var c,E,Z,R,o=u.selectApp,O=u.runid,P=u.setBoxLoading,T=u.setinputShow,N=u.appId,j=u.id,X=u.setisRun,W=(0,Y.useIntl)(),J=(0,t.useRef)(""),ue=(0,t.useRef)(""),Q=(0,t.useRef)(null),ce=(0,t.useState)(""),k=f()(ce,2),C=k[0],K=k[1],ve=(0,t.useState)(null),me=f()(ve,2),he=me[0],G=me[1],A=(0,t.useState)([]),ae=f()(A,2),Ee=ae[0],Ce=ae[1],xe=(0,t.useState)(""),ne=f()(xe,2),je=ne[0],Ae=ne[1],M=(0,gt.Z)(function(B){return B.flowMessage}),we=function(y){ue.current=be(y);var w={user:{value:be(y)}};Ae(new Bt.z(w))},be=function B(y){return y.map(function(w){return w.type==="mention"?w.id:w.children?B(w.children):w.text}).join("")},Ie=function(){var B=g()(m()().mark(function y(w){var D,p;return m()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return P(!0),D=Object.keys(w),D.forEach(function(n){Q.current.properties[n]&&(Q.current.properties[n].value=w[n])}),i.next=5,(0,Ht.LH)({agent_id:o.checkItem[0].agent_id,ability_id:0,input_dict:Q.current,prompt:je,data_source_run_id:J.current});case 5:p=i.sent,p.code==0&&(K(p.data.outputs_md),P(!1),X(!1));case 7:case"end":return i.stop()}},y)}));return function(w){return B.apply(this,arguments)}}(),Oe=function(){var B=g()(m()().mark(function y(w,D){var p,s;return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,se.xT)(w,D);case 2:p=n.sent,(p==null?void 0:p.code)==0&&(J.current=p==null||(s=p.data)===null||s===void 0?void 0:s.app_run_id);case 4:case"end":return n.stop()}},y)}));return function(w,D){return B.apply(this,arguments)}}();return(0,t.useEffect)(function(){o&&o.checkItem.length&&(X(!0),Oe(j,{app_id:N,app_run_id:O,status:1,corrected_parameter:""}))},[o]),(0,t.useEffect)(function(){var B=M.filter(function(i){return i.data.app_run_id==O&&i.type.indexOf("generate_meeting_action_items")!==-1});if(B.length!=0){var y,w=(y=B[B.length-1])===null||y===void 0||(y=y.data)===null||y===void 0||(y=y.exec_data)===null||y===void 0||(y=y.outputs)===null||y===void 0?void 0:y.value;if(w){var D=JSON.parse(w);Q.current=D;var p=Object.keys(D.properties);if(p.length){G(D.properties);var s=p.map(function(i){return{value:"<<".concat(It.qX,".inputs.").concat(i,">>"),label:i}});Ce(s)}T(!1),P(!1)}}},[M]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(V.Z,{icon:o==null||(c=o.checkItem[0])===null||c===void 0?void 0:c.icon,title:o==null||(E=o.checkItem[0])===null||E===void 0?void 0:E.name,textDetails:o==null||(Z=o.checkItem[0])===null||Z===void 0?void 0:Z.description,iconType:"robot_icon",avatar:o==null||(R=o.checkItem[0])===null||R===void 0?void 0:R.avatar,handleClick:function(){}})}),he!=null?(0,e.jsxs)(xt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!ue.current},searchConfig:{submitText:W.formatMessage({id:"workflow.button.run"})}},onFinish:function(y){Ie(y)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(dt._,{data:he})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(At.Z,{onChange:function(y){we(y)},options:Ee,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),C?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(pt.U,{rehypePlugins:[tt.Z],children:C})})}):(0,e.jsx)(e.Fragment,{})]})},jt=(0,t.memo)(Ne),ft=a(66309),_t=a(42237),yt=a(93696),Ot=function(u,c){return t.createElement(Fe.Z,(0,L.Z)((0,L.Z)({},u),{},{ref:c,icon:yt.Z}))},x=t.forwardRef(Ot),$=x,le=a(4981),at=a(29608),ze=(0,t.memo)(function(oe){var u=oe.progressObj,c=function(){return parseFloat(u.elapsed_time).toFixed(6)},E=function(R){var o=new Date(R),O=o.getFullYear(),P=(o.getMonth()+1).toString().padStart(2,"0"),T=o.getDate().toString().padStart(2,"0"),N=o.getHours().toString().padStart(2,"0"),j=o.getMinutes().toString().padStart(2,"0"),X=o.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(O,".").concat(P,".").concat(T," ").concat(N,":").concat(j,":").concat(X)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:u.created_time&&E(u.created_time)}),(0,e.jsx)("div",{className:"truncate",children:u.apps_name||u.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(u.status==1?"bg-blue-600":u.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[c(),"S"]})]})]})})}),Ye=function(u){var c,E,Z,R,o=u.selectApp,O=u.runid,P=u.setBoxLoading,T=u.setinputShow,N=u.appId,j=u.id,X=u.setisRun,W=(0,Y.useIntl)(),J=(0,t.useRef)(""),ue=(0,t.useRef)(null),Q=(0,t.useState)(null),ce=f()(Q,2),k=ce[0],C=ce[1],K=(0,t.useState)(!1),ve=f()(K,2),me=ve[0],he=ve[1],G=(0,t.useState)(null),A=f()(G,2),ae=A[0],Ee=A[1],Ce=(0,t.useState)(null),xe=f()(Ce,2),ne=xe[0],je=xe[1],Ae=(0,t.useState)(null),M=f()(Ae,2),we=M[0],be=M[1],Ie=(0,at.Z)(function(n){return n.setDealtWithData}),Oe=(0,at.Z)(function(n){return n.setRunPanelLogRecord}),B=function(){var n=g()(m()().mark(function r(l){var v,h,d,_,I;return m()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return P(!0),v=Object.keys(l),h={},v.forEach(function(Pe){ue.current.properties[Pe]&&(ue.current.properties[Pe].value=l[Pe]),ne&&ne.forEach(function(nt){nt.node_id==Pe&&(h[Pe]=l[Pe])})}),d={inputs:ue.current,node_confirm_users:h,run_name:"chatroom-".concat(j,"-run-").concat(J.current,"-driven"),run_type:1,data_source_run_id:J.current},re.next=7,(0,_t.UE)(N,d);case 7:_=re.sent,_.code==0&&(J.current=_==null||(I=_.data)===null||I===void 0?void 0:I.app_run_id,he(!0),X(!1));case 9:case"end":return re.stop()}},r)}));return function(l){return n.apply(this,arguments)}}(),y=function(){var n=g()(m()().mark(function r(){var l,v;return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:l=i==null?void 0:i.filter(function(_){return _.type=="workflow_run_progress"&&_.data.app_run_id==J.current}).map(function(_){var I=_.data;return I}),l&&l.length&&(v=l[l.length-1],C(v),P(!1));case 2:case"end":return d.stop()}},r)}));return function(){return n.apply(this,arguments)}}(),w=function(){var n=g()(m()().mark(function r(){var l,v,h,d,_;return m()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:v=i==null?void 0:i.filter(function(re){return re.type=="workflow_need_human_confirm"&&re.data.app_run_id==J.current}),h=(l=v.map(function(re){var Pe=re.data,nt=re.need_human_confirm;return{data:Pe,need_human_confirm:nt}}))===null||l===void 0?void 0:l.filter(function(re){return re.data.type!==1}),h&&h.length&&(_=h[h.length-1].data,_.exec_id=_==null||(d=_.node_exec_data)===null||d===void 0?void 0:d.node_exec_id,be(h[h.length-1]),P(!1));case 3:case"end":return Te.stop()}},r)}));return function(){return n.apply(this,arguments)}}(),D=function(r){return r.completed_progress?parseInt(r.completed_progress.slice(0,-1)):!1},p=function(){var n=g()(m()().mark(function r(l,v){var h,d;return m()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,se.xT)(l,v);case 2:h=I.sent,(h==null?void 0:h.code)==0&&(J.current=h==null||(d=h.data)===null||d===void 0?void 0:d.app_run_id);case 4:case"end":return I.stop()}},r)}));return function(l,v){return n.apply(this,arguments)}}(),s=function(){var n=g()(m()().mark(function r(){var l,v;return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,_t.zO)(N);case 2:l=d.sent,l.code==0&&je(l==null||(v=l.data)===null||v===void 0?void 0:v.need_confirm_nodes),p(j,{app_id:N,app_run_id:O,status:1,corrected_parameter:""});case 5:case"end":return d.stop()}},r)}));return function(){return n.apply(this,arguments)}}();(0,t.useEffect)(function(){o&&o.checkItem.length&&(X(!0),s())},[o]);var i=(0,gt.Z)(function(n){return n.flowMessage});return(0,t.useEffect)(function(){y(),w();var n=i.filter(function(d){return d.data.app_run_id==O&&d.type.indexOf("generate_meeting_action_items")!==-1});if(n.length!=0){var r,l=(r=n[n.length-1])===null||r===void 0||(r=r.data)===null||r===void 0||(r=r.exec_data)===null||r===void 0||(r=r.outputs)===null||r===void 0?void 0:r.value;if(l){var v=JSON.parse(l);ue.current=v;var h=Object.keys(v.properties);h.length&&Ee(v.properties),T(!1),P(!1)}}},[i]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(V.Z,{icon:o==null||(c=o.checkItem[0])===null||c===void 0?void 0:c.icon,title:o==null||(E=o.checkItem[0])===null||E===void 0?void 0:E.name,textDetails:o==null||(Z=o.checkItem[0])===null||Z===void 0?void 0:Z.description,iconType:"workflow_icon",avatar:o==null||(R=o.checkItem[0])===null||R===void 0?void 0:R.avatar,handleClick:function(){}})}),!me&&ae!=null?(0,e.jsxs)(xt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:W.formatMessage({id:"workflow.button.run"})}},onFinish:B,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(dt._,{data:ae})}),(0,e.jsx)(le.e,{data:ne})]}):(0,e.jsx)(e.Fragment,{children:ae!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[W.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(ae).map(function(n){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:n.display_name||n.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:n.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),we&&we.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){Ie(we.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)($,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:W.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),k?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(V.Z,{status:k.status,icon:k.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:k.run_name}),k.need_human_confirm==1?(0,e.jsx)(ft.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:W.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(ze,{progressObj:k}),handleClick:function(){Oe(k)},progress:D(k)})}):(0,e.jsx)(e.Fragment,{})]})},Ze=(0,t.memo)(Ye),St=function(u){var c,E,Z,R=(0,Y.useIntl)(),o=u.runid,O=u.id,P=u.setBoxLoading,T=u.scrollDom,N=u.setinputShow,j=(0,t.useRef)("agent"),X=(0,t.useRef)(""),W=(0,t.useState)(!1),J=f()(W,2),ue=J[0],Q=J[1],ce=(0,t.useState)({type:"agent",checkItem:[],show:!1}),k=f()(ce,2),C=k[0],K=k[1],ve=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){K(function(A){return F()(F()({},A),{},{type:"agent",show:!0})})},children:R.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){K(function(A){return F()(F()({},A),{},{type:"workflow",show:!0})})},children:R.formatMessage({id:"app.summary.SelectWorkflow"})})}],me=function(){K(function(A){return F()(F()({},A),{},{show:!1})})},he=function(A){P(!0),K(function(ae){return F()(F()({},ae),{},{checkItem:A.checkItem})}),j.current=C.type,X.current=A.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:C!=null&&(c=C.checkItem)!==null&&c!==void 0&&c.length?T==null||(E=T.current)===null||E===void 0?void 0:E.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:R.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:ue?(0,e.jsx)(Nt.Z,{menu:{items:ve},children:(0,e.jsx)(Ct,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:C!=null&&(Z=C.checkItem)!==null&&Z!==void 0&&Z.length?(0,e.jsx)(e.Fragment,{children:j.current=="agent"?(0,e.jsx)(jt,{id:O,appId:X.current,selectApp:C,runid:o,setBoxLoading:P,scrollDom:T,setinputShow:N,setisRun:Q}):(0,e.jsx)(Ze,{id:O,appId:X.current,selectApp:C,runid:o,setBoxLoading:P,scrollDom:T,setinputShow:N,setisRun:Q})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(ke.ZP,{className:"flex-1 text-[14px]",onClick:function(){K(function(A){return F()(F()({},A),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),R.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(ke.ZP,{className:"flex-1 text-[14px]",onClick:function(){K(function(A){return F()(F()({},A),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),R.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(Ge.Z,{show:C.show,nodetype:C.type,popupClose:me,popupSave:he,checkList:j.current==C.type?C.checkItem:[],zIndex:99,radio:!0})]})},Pt=(0,t.memo)(St),kt=a(26915),$t=a(87740),Wt=(0,t.memo)(function(oe){var u=oe.id,c=oe.message,E=(0,Y.useIntl)(),Z=(0,pe.Z)(function(j){return j.setSummaryClick}),R=(0,t.useState)(!0),o=f()(R,2),O=o[0],P=o[1],T=(0,pe.Z)(function(j){return j.summaryClick}),N=(0,pe.Z)(function(j){return j.setSummaryParams});return(0,t.useEffect)(function(){P(T)},[T]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(ke.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(X){O&&(N({id:u,message:c}),Z(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:E.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)($t.Z,{className:"text-[14px]"})]})})}),Ut=function(u){var c,E,Z,R,o=u.setShow,O=u.inputShow,P=u.setBoxLoading,T=u.setAppRunId,N=u.scrollDom,j=(0,Y.useIntl)(),X=(0,t.useState)(!1),W=f()(X,2),J=W[0],ue=W[1],Q=(0,t.useState)(""),ce=f()(Q,2),k=ce[0],C=ce[1],K=(0,t.useState)(""),ve=f()(K,2),me=ve[0],he=ve[1],G=(0,t.useRef)(""),A=(0,t.useRef)(""),ae=(0,t.useRef)(!1),Ee=(0,t.useState)(!1),Ce=f()(Ee,2),xe=Ce[0],ne=Ce[1],je=(0,t.useState)(null),Ae=f()(je,2),M=Ae[0],we=Ae[1],be=(0,pe.Z)(function(p){return p.setSummaryClick}),Ie=function(){var p=g()(m()().mark(function s(i){var n,r,l,v,h=arguments;return m()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return n=h.length>1&&h[1]!==void 0?h[1]:{app_run_id:"",corrected_parameter:""},_.next=3,(0,se.Rp)(i,n);case 3:r=_.sent,(r==null?void 0:r.code)==0&&(T(r==null||(l=r.data)===null||l===void 0?void 0:l.app_run_id),A.current=r==null||(v=r.data)===null||v===void 0?void 0:v.app_run_id,n.app_run_id&&(ae.current=!0));case 5:case"end":return _.stop()}},s)}));return function(i){return p.apply(this,arguments)}}(),Oe=function(){var p=g()(m()().mark(function s(i,n){var r,l,v,h,d;return m()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,se.xM)(i,{message:n});case 2:r=I.sent,(r==null?void 0:r.code)==0&&(A.current=r==null||(l=r.data)===null||l===void 0?void 0:l.app_run_id,T(r==null||(v=r.data)===null||v===void 0?void 0:v.app_run_id),r!=null&&(h=r.data)!==null&&h!==void 0&&(h=h.outputs)!==null&&h!==void 0&&h.value&&(C(r==null||(d=r.data)===null||d===void 0||(d=d.outputs)===null||d===void 0?void 0:d.value),o(!0),P(!1),be(!0),N.current.scrollTo({top:0})));case 4:case"end":return I.stop()}},s)}));return function(i,n){return p.apply(this,arguments)}}(),B=function(){var p=g()(m()().mark(function s(){var i;return m()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,se.Gh)({chatroom_id:G.current,app_run_id:A.current});case 2:i=r.sent,i&&i!==null&&i!==void 0&&i.data&&we(i.data);case 4:case"end":return r.stop()}},s)}));return function(){return p.apply(this,arguments)}}(),y=function(s){var i=new Date(s),n=i.getMonth()+1,r=i.getDate(),l=i.getHours(),v=i.getMinutes(),h=i.getSeconds();return i.getFullYear()+"-"+(n<10?"0"+n:n)+"-"+(r<10?"0"+r:r)+" "+(l<10?"0"+l:l)+":"+(v<10?"0"+v:v)+":"+(h<10?"0"+h:h)},w=(0,gt.Z)(function(p){return p.flowMessage});(0,t.useEffect)(function(){var p=w.filter(function(n){return n.data.app_run_id==A.current&&n.type.indexOf("generate_meeting_summary")!==-1});if(p.length!=0){var s,i=(s=p[p.length-1])===null||s===void 0||(s=s.data)===null||s===void 0||(s=s.exec_data)===null||s===void 0||(s=s.outputs)===null||s===void 0?void 0:s.value;i&&(ae.current&&B(),C(i),ne(!1),o(!0),be(!0),P(!1),N.current.scrollTo({top:0}))}},[w]);var D=(0,pe.Z)(function(p){return p.summaryParams});return(0,t.useEffect)(function(){D&&D.id&&(G.current=D.id,M&&we(null),xe&&ne(!1),k&&C(""),ue(!0),D.message?(P(!0),Oe(D.id,D.message)):Ie(D.id))},[D]),(0,e.jsx)(e.Fragment,{children:J?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:j.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:k?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(pt.U,{rehypePlugins:[tt.Z],children:M?M==null||(c=M.source_run)===null||c===void 0?void 0:c.summary:k})}),M&&(M==null||(E=M.source_corrections)===null||E===void 0?void 0:E.length)>0||!O?(0,e.jsx)(Wt,{id:G.current,message:M?M==null||(Z=M.source_run)===null||Z===void 0?void 0:Z.summary:k}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(Se.Z,{size:"large"})})}),M&&(M==null||(R=M.source_corrections)===null||R===void 0?void 0:R.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[j.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),M.source_corrections.map(function(p,s){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(M.source_corrections.length-1==s?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[j.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",p.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[j.formatMessage({id:"app.summaryhistory.time"}),": ",y(p.created_time)]}),(0,e.jsx)(pt.U,{rehypePlugins:[tt.Z],children:p==null?void 0:p.corrected_summary})]})},p.created_time),!O||M.source_corrections.length-1!=s?(0,e.jsx)(Wt,{id:G.current,message:p==null?void 0:p.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},p.created_time)})]}):(0,e.jsx)(e.Fragment,{}),O?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(kt.Z.TextArea,{onChange:function(s){he(s.target.value)},value:me,disabled:!k||xe,rows:4,placeholder:j.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(ke.ZP,{type:"primary",disabled:!k||!me,loading:xe,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){Ie(G.current,{app_run_id:String(A.current),corrected_parameter:me}),ne(!0),he(""),o("")},children:j.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},Vt=(0,t.memo)(Ut),Kt=a(38027),Gt=function(u){var c,E=u.id,Z=(0,t.useState)(""),R=f()(Z,2),o=R[0],O=R[1],P=(0,t.useState)(!1),T=f()(P,2),N=T[0],j=T[1],X=(0,t.useState)([]),W=f()(X,2),J=W[0],ue=W[1],Q=(0,t.useState)(!1),ce=f()(Q,2),k=ce[0],C=ce[1],K=(0,t.useState)(!1),ve=f()(K,2),me=ve[0],he=ve[1],G=(0,t.useState)(""),A=f()(G,2),ae=A[0],Ee=A[1],Ce=(0,t.useState)(!1),xe=f()(Ce,2),ne=xe[0],je=xe[1],Ae=(0,t.useState)(!1),M=f()(Ae,2),we=M[0],be=M[1],Ie=(0,t.useState)(!0),Oe=f()(Ie,2),B=Oe[0],y=Oe[1],w=(0,t.useRef)(null),D=(0,t.useRef)(1),p=(0,t.useRef)(!1),s=(0,t.useRef)(!0),i=(0,t.useRef)(0),n=(0,t.useState)(!1),r=f()(n,2),l=r[0],v=r[1],h=(0,t.useState)(800),d=f()(h,2),_=d[0],I=d[1],Te=(0,t.useState)(!1),re=f()(Te,2),Pe=re[0],nt=re[1],wt=(0,pe.Z)(function(_e){return _e.summaryParams}),qt=(0,pe.Z)(function(_e){return _e.setSummaryParams}),Ft=function(){var _e=g()(m()().mark(function Be(){var zt,Lt,ye,Zt,rt,Tt,st=arguments;return m()().wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(zt=st.length>0&&st[0]!==void 0?st[0]:!0,Lt=st.length>1&&st[1]!==void 0?st[1]:!0,!(i.current!=0&&i.current<D.current)){Xe.next=5;break}return v(!1),Xe.abrupt("return");case 5:return Xe.next=8,(0,se.sh)({chatroom_id:E,page:D.current,page_size:10});case 8:ye=Xe.sent,ye.code==0&&(ye!=null&&(Zt=ye.data)!==null&&Zt!==void 0&&Zt.list&&ye!==null&&ye!==void 0&&(rt=ye.data)!==null&&rt!==void 0&&(rt=rt.list)!==null&&rt!==void 0&&rt.length&&(i.current=ye==null||(Tt=ye.data)===null||Tt===void 0?void 0:Tt.total_pages,ue(function(vt){return Lt?q()(ye.data.list.reverse()):[].concat(q()(ye.data.list.reverse()),q()(vt))}),s.current=!0,j(!0),v(!0)),Lt&&setTimeout(function(){var vt;w==null||(vt=w.current)===null||vt===void 0||vt.scrollTo({top:0})},200),zt||(O(wt.id),qt({})));case 10:case"end":return Xe.stop()}},Be)}));return function(){return _e.apply(this,arguments)}}(),ea=function(Be){Be.target.scrollHeight+(Be.target.scrollTop-Be.target.clientHeight)<400&&s.current&&(s.current=!1,v(!0),D.current=D.current+=1,Ft(!0,!1))};(0,t.useEffect)(function(){D.current=1,Ft()},[E]),(0,t.useEffect)(function(){wt&&wt.id&&(j(!0),B||y(!0),k&&C(!1),ne&&je(!1),D.current=1,he(!0),Ft(!1),p.current=!0)},[wt]);var ta=(0,pe.Z)(function(_e){return _e.setOrientationShow});return(0,t.useEffect)(function(){N&&ta(!0)},[N]),(0,t.useEffect)(function(){var _e=function(){window.innerWidth<1280?(I(400),nt(!0),setTimeout(function(){je(!0)},200)):(I((window.innerWidth-320)/2),nt(!1),je(!1))};return _e(),window.addEventListener("resize",_e),function(){window.removeEventListener("resize",_e)}},[]),(0,e.jsx)(e.Fragment,{children:N?(0,e.jsxs)("div",{style:{overflow:ne?"hidden":"initial"},className:"pl-[32px] box-border ".concat(Pe?"fixed  right-0 bottom-0 top-[56px]":"relative"),children:[(0,e.jsx)("div",{onClick:function(){je(function(Be){return!Be})},className:`
                                `.concat(ne?"absolute left-[2px]  top-[60px]":"absolute left-[2px] top-[60px]",`
                                history_packup
                                hover:text-[#1B64F3]
                                w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                            `),children:ne?(0,e.jsx)(ct,{className:"text-[18px]"}):(0,e.jsx)(Re,{className:"text-[18px]"})}),(0,e.jsxs)(ie.Z,{minWidth:400,maxWidth:_,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(ne?"hidden flex-[0]":"block"),children:[we?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(Se.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:ea,ref:w,children:[(0,e.jsxs)("div",{children:[J.length?(0,e.jsx)(Kt.ZP,{id:E,runid:ae,scrollDom:w,list:J,historyHeight:p.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:me?w==null||(c=w.current)===null||c===void 0?void 0:c.offsetHeight:""},children:[(0,e.jsx)(Vt,{setShow:C,inputShow:B,setBoxLoading:be,setAppRunId:Ee,scrollDom:w}),k?(0,e.jsx)(Pt,{id:o,runid:ae,setBoxLoading:be,scrollDom:w,setinputShow:y}):(0,e.jsx)(e.Fragment,{})]})]}),l?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(Se.Z,{})}):(0,e.jsx)(e.Fragment,{})]})})]})]}):(0,e.jsx)(e.Fragment,{})})},Yt=(0,t.memo)(Gt),Xt=function(u){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(U.Z,{image:U.Z.PRESENTED_IMAGE_SIMPLE})})},Jt=(0,t.memo)(function(){var oe=(0,Y.useParams)(),u=oe.id,c=(0,t.useRef)([]),E=(0,t.useRef)(null),Z=(0,t.useState)(!1),R=f()(Z,2),o=R[0],O=R[1],P=function(){var T=g()(m()().mark(function N(){var j;return m()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(!u){W.next=5;break}return W.next=3,(0,se.cH)({id:u});case 3:j=W.sent,j.code==0?(O(!0),E.current=j.data,c.current=j.data.agent_list):Y.history.replace("/meeting");case 5:case"end":return W.stop()}},N)}));return function(){return T.apply(this,arguments)}}();return(0,t.useEffect)(function(){P()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden overflow-x-auto",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(b,{roomDetail:E.current,setAgent:c}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:o?(0,e.jsx)(te.F,{agentList:c}):(0,e.jsx)(Xt,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Yt,{id:u})})]})})}),Qt=Jt}}]);
