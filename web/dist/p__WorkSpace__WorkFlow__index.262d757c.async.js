"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9142,7735],{39873:function(Le,te,e){var pe=e(5574),N=e.n(pe),ge=e(42881),K=e(67294),U=e(85893),w=function(x){var we=x.children,Z=x.className,A=Z===void 0?"":Z,F=x.dragDirection,V=F===void 0?"left":F,ae=x.minWidth,de=ae===void 0?115:ae,Q=x.maxWidth,M=Q===void 0?820:Q,z=x.minHeight,d=z===void 0?200:z,B=x.maxHeight,ne=B===void 0?800:B,I=x.defaultWidth,re=I===void 0?415:I,r=x.defaultHeight,G=r===void 0?300:r,t=x.onChange,O=(0,K.useState)(re),se=N()(O,2),xe=se[0],q=se[1],Pe=(0,K.useState)(G),$=N()(Pe,2),Ie=$[0],Se=$[1],Te=(0,K.useCallback)(function(De,ye){q(De),ye&&Se(ye),t==null||t(De,ye)},[q,Se,t]),je=(0,ge.W)({direction:["left","right"].includes(V)?"horizontal":"vertical",triggerDirection:V,minWidth:de,maxWidth:M,minHeight:d,maxHeight:ne,onResize:Te}),ce=je.triggerRef,ke=je.containerRef;return(0,U.jsxs)("div",{ref:ke,style:{width:["left","right"].includes(V)?"".concat(xe,"px"):void 0,height:["top","bottom"].includes(V)?"".concat(Ie,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(A),children:[V==="left"&&(0,U.jsx)("div",{ref:ce,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,U.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),V==="right"&&(0,U.jsx)("div",{ref:ce,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,U.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),V==="top"&&(0,U.jsx)("div",{ref:ce,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,U.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),V==="bottom"&&(0,U.jsx)("div",{ref:ce,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,U.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),we]})};te.Z=(0,K.memo)(w)},36711:function(Le,te,e){e.r(te),e.d(te,{waitTime:function(){return Q},waitTimePromise:function(){return de}});var pe=e(97857),N=e.n(pe),ge=e(5574),K=e.n(ge),U=e(15009),w=e.n(U),Ce=e(99289),x=e.n(Ce),we=e(42237),Z=e(29608),A=e(46944),F=e(35312),V=e(67294),ae=e(85893),de=function(){var M=x()(w()().mark(function z(){var d,B=arguments;return w()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return d=B.length>0&&B[0]!==void 0?B[0]:100,I.abrupt("return",new Promise(function(re){setTimeout(function(){re(!0)},d)}));case 2:case"end":return I.stop()}},z)}));return function(){return M.apply(this,arguments)}}(),Q=function(){var M=x()(w()().mark(function z(){var d,B=arguments;return w()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return d=B.length>0&&B[0]!==void 0?B[0]:100,I.next=3,de(d);case 3:case"end":return I.stop()}},z)}));return function(){return M.apply(this,arguments)}}();te.default=function(){var M=(0,F.useIntl)(),z=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:M.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(t){var O;r==null||(O=r.current)===null||O===void 0||O.submit()}}},{title:M.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:M.formatMessage({id:"workflow.created_time_des",defaultMessage:M.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:M.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(t){var O;r==null||(O=r.current)===null||O===void 0||O.submit()}},valueEnum:{1:{text:M.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:M.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:M.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(M.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:M.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:M.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],d=(0,F.useSearchParams)(),B=K()(d,1),ne=B[0],I=(0,Z.Z)(function(G){return G.setRunPanelLogRecord}),re=ne.get("app_id"),r=(0,V.useRef)(null);return(0,ae.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,ae.jsx)("div",{children:(0,ae.jsx)(A.Z,{columns:z,formRef:r,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var G=x()(w()().mark(function t(O,se,xe){var q;return w()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return console.log(O,se,xe),$.next=3,(0,we.bB)(N()(N()({app_runs_name:"",app_runs_status:0},O),{},{app_id:re}));case 3:return q=$.sent,console.log(q),$.abrupt("return",{data:q.data.list,success:!0,total:q.data.total_count});case 6:case"end":return $.stop()}},t)}));return function(t,O,se){return G.apply(this,arguments)}}(),onRow:function(t){return{onClick:function(){console.log("Row clicked:",t),I(t)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:M.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},47815:function(Le,te,e){e.r(te),e.d(te,{default:function(){return wt}});var pe=e(15009),N=e.n(pe),ge=e(99289),K=e.n(ge),U=e(97857),w=e.n(U),Ce=e(5574),x=e.n(Ce),we=e(32060),Z=e(42237),A=e(35312),F=e(63648),V=e(16091),ae=e(13118),de=e(78234),Q=e(77598),M=e(45360),z=e(85576),d=e(67294),B=e(64599),ne=e.n(B),I=e(7493),re=e(34559),r=e(15425),G=e(96906),t=e(85893),O=function(i){return{nodes:i.nodes,edges:i.edges,onNodesChange:i.onNodesChange,onEdgesChange:i.onEdgesChange,onConnect:i.onConnect,nodeTypes:i.nodeTypes,connectionLineStyle:i.connectionLineStyle,defaultViewport:i.defaultViewport,onDrop:i.onDrop,onDragOver:i.onDragOver,setSelect:i.setSelect,preventScrolling:i.preventScrolling}},se=(0,d.memo)(function(c){var i=c.children,l=(0,A.useIntl)(),h=(0,r.Z)(function(o){return o.nodes}),_=(0,r.Z)(function(o){return o.getEdges}),v=(0,r.Z)(function(o){return o.edges}),T=(0,r.Z)(function(o){return o.setEdges}),n=(0,r.Z)(function(o){return o.onNodesChange}),a=(0,r.Z)(function(o){return o.onEdgesChange}),y=(0,r.Z)(function(o){return o.onConnect}),L=(0,r.Z)(function(o){return o.nodeTypes}),C=(0,r.Z)(function(o){return o.connectionLineStyle}),k=(0,r.Z)(function(o){return o.defaultViewport}),W=(0,r.Z)(function(o){return o.onDrop}),P=(0,r.Z)(function(o){return o.onDragOver}),D=(0,r.Z)(function(o){return o.setSelect}),S=(0,r.Z)(function(o){return o.preventScrolling}),j=(0,d.useCallback)(function(o){var b=h.find(function(p){return p.id===o.target}),u=function p(E){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(f.has(E.id))return!1;f.add(E.id);var g=ne()((0,I.xA)(E,h,v)),m;try{for(g.s();!(m=g.n()).done;){var Y=m.value;if(Y.id===o.source||p(Y,f))return!0}}catch(ee){g.e(ee)}finally{g.f()}};return b.id===o.source?!1:!u(b)},[h,v]),ie=function(){},R=(0,d.useCallback)(function(o,b){console.log(o,b,_(),(0,I.Kz)(o,b,v)),T((0,I.Kz)(o,b,_()))},[]);return(0,Q.Z)(function(){},[h]),(0,t.jsx)(re.tV,{children:(0,t.jsx)(F.x$,{onViewportChange:ie,nodes:h,edges:v,onNodesChange:n,onEdgesChange:a,onEdgesDelete:function(b){},onConnect:y,onReconnect:R,nodeTypes:L,minZoom:.3,maxZoom:1,connectionLineStyle:C,snapToGrid:!1,isValidConnection:j,connectionRadius:30,preventScrolling:S,onDragOver:P,onPaneClick:function(){D("")},onPaneContextMenu:function(b){b.preventDefault()},onSelectionChange:function(b){},onNodeClick:function(b,u){D(u.id)},onEdgeClick:function(b,u){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(b){},onBeforeDelete:function(){var o=K()(N()().mark(function b(u){var p;return N()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if((u==null||(p=u.nodes)===null||p===void 0||(p=p[0])===null||p===void 0?void 0:p.type)!=G.vW.Start){f.next=3;break}return M.ZP.error(l.formatMessage({id:"workflow.delStartNodeError"})),f.abrupt("return",Promise.reject(l.formatMessage({id:"workflow.delStartNodeError"})));case 3:return D(""),f.abrupt("return",Promise.resolve(u));case 5:case"end":return f.stop()}},b)}));return function(b){return o.apply(this,arguments)}}(),fitView:!0,children:i})})}),xe=function(i){var l=(0,d.useCallback)(function(v){v.preventDefault(),v.dataTransfer.dropEffect="move"},[]),h=(0,d.useCallback)(function(v){v.preventDefault();var T=v.dataTransfer.getData("application/reactflow");if(!T)return null;var n=JSON.parse(T),a=n.type,y=n.item;if(!a||!y)return null;var L=i({x:v.clientX,y:v.clientY});return{position:L,type:a,item:y}},[i]),_=(0,d.useCallback)(function(v){var T=function(a){var y=h(a);y&&v(y.position,y.type,y.item)};return document.addEventListener("dragover",l),document.addEventListener("drop",T),function(){document.removeEventListener("dragover",l),document.removeEventListener("drop",T)}},[l,h]);return{onDnD:_}},q=xe,Pe=function(){var i=(0,r.Z)(function(n){return n.setAgentData}),l=(0,r.Z)(function(n){return n.setSkillData}),h=(0,r.Z)(function(n){return n.setToolData}),_=(0,r.Z)(function(n){return n.setDatasetData}),v=(0,r.Z)(function(n){return n.setTeamDatasetData}),T=(0,r.Z)(function(n){return n.setModelOptionsData});(0,d.useEffect)(function(){(0,Z.x$)(2).then(function(n){n.code===0&&i({team:n.data})}),(0,Z.x$)(3).then(function(n){n.code===0&&i({user:n.data})}),(0,Z.w)(2).then(function(n){n.code===0&&l({team:n.data})}),(0,Z.w)(3).then(function(n){n.code===0&&l({user:n.data})}),(0,Z.GZ)().then(function(n){n.code===0&&h({list:Object.values(n.data)})}),(0,Z.fZ)().then(function(n){var a,y=Array.isArray(n==null||(a=n.data)===null||a===void 0?void 0:a.data)?n.data.data:[],L=y.map(function(S){return{label:S.supplier_name,options:Array.isArray(S.model_list)?S.model_list.map(function(j){return w()(w()({},j),{},{label:j.model_name,value:j.model_config_id})}):[]}}),C,k=ne()(y),W;try{for(k.s();!(W=k.n()).done;){var P=W.value;if(Array.isArray(P.model_list)){var D=P.model_list.find(function(S){return S.model_default_used===1});if(D){C=D.model_config_id;break}}}}catch(S){k.e(S)}finally{k.f()}T({options:L,defaultValue:C})}),(0,Z.mG)().then(function(n){n.code==0&&_({list:n.data.data.map(function(a){return w()(w()({},a),{},{label:a.name,value:a.dataset_id})})})}),(0,Z.mG)(2).then(function(n){n.code==0&&v({list:n.data.data.map(function(a){return w()(w()({},a),{},{label:a.name,value:a.dataset_id})})})})},[i,l,h])},$=Pe,Ie=e(18032),Se=(0,d.memo)(function(c){var i=c.onSubmit,l=c.onClose;return(0,t.jsx)(Ie.default,{onSubmit:i,onClose:l})}),Te=e(39873),je=e(47520),ce=e(36711),ke=e(82826),De=e(43425),ye=e(48869),$e=e(69243),Ye=e(91806),Re=e(34994),Ee=e(52688),Je=e(55241),Xe=e(50136),Ze=e(43586),Qe=function(){var i,l=(0,A.useIntl)(),h=(0,d.useState)(!0),_=x()(h,2),v=_[0],T=_[1],n=(0,r.Z)(function(f){return f.setWorkflowEditInfo}),a=(0,r.Z)(function(f){return f.workFlowInfo}),y=(0,r.Z)(function(f){return f.setSelect}),L=(0,d.useState)("1"),C=x()(L,2),k=C[0],W=C[1],P=(0,d.useState)(!1),D=x()(P,2),S=D[0],j=D[1],ie=(0,Ze.Z)(),R=(0,d.useRef)(null),o=function(){var g,m;return(0,t.jsx)("div",{className:"",children:(0,t.jsx)("div",{className:"w-[240px]  ",children:(0,t.jsxs)(Re.A,{formRef:R,submitter:{render:function(){return null}},onValuesChange:u,layout:"horizontal",children:[(0,t.jsx)(Ee.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,t.jsx)(Ee.Z,{tooltip:(a==null||(g=a.app)===null||g===void 0?void 0:g.publish_status)!="1"?{title:l.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(a==null||(m=a.app)===null||m===void 0?void 0:m.publish_status)!="1",name:"enable_api",label:"API"})]})})})},b=[{key:"4",icon:(0,t.jsx)(ke.Z,{}),label:l.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:a!=null&&a.isProd?(0,t.jsx)(De.Z,{}):(0,t.jsx)(Je.Z,{content:o,trigger:"click",forceRender:!0,placement:"rightTop",title:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,t.jsx)(De.Z,{})}),label:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:a==null?void 0:a.isProd},{key:"1",icon:(0,t.jsx)(ye.Z,{}),label:l.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,t.jsx)($e.Z,{}),label:l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:S?l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):l.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!S},{key:"3",icon:(0,t.jsx)(Ye.Z,{}),label:l.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,Q.Z)(function(){if(a){var f,g,m,Y,ee=a==null||(f=a.app)===null||f===void 0?void 0:f.is_public,be=a==null||(g=a.app)===null||g===void 0?void 0:g.enable_api,X={};X.is_public=!!ee,X.enable_api=(a==null||(m=a.app)===null||m===void 0?void 0:m.publish_status)=="1"?!!be:!1,console.log(X),j(X.enable_api),R==null||(Y=R.current)===null||Y===void 0||Y.setFieldsValue(X)}},[a]);var u=function(g,m){console.log(g,m),p(m.enable_api),n(m),setTimeout(ie,300)},p=function(g){j(!!g)},E=function(g){var m;switch(g.key){case"4":A.history.go(-1);break;case"0":break;case"2":window.open(je._n+(a==null||(m=a.app)===null||m===void 0?void 0:m.api_url),"_blank");break;default:y(""),W(g.key)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(k==="3"?" !-left-[14px]":""),children:[(0,t.jsx)(Xe.Z,{defaultSelectedKeys:["1"],selectedKeys:[k],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:v,items:b,onClick:E}),k=="0"&&(0,t.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,t.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,t.jsxs)(Re.A,{formRef:R,submitter:{render:function(){return null}},onValuesChange:u,layout:"horizontal",children:[(0,t.jsx)(Ee.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,t.jsx)(Ee.Z,{disabled:!(a!=null&&(i=a.app)!==null&&i!==void 0&&i.api_url),name:"enable_api",label:"API"})]})})})]}),k=="3"&&(0,t.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,t.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,t.jsx)(ce.default,{})})})]})},qe=Qe,Ne=e(71471),et=(0,d.memo)(function(c){var i=c.name,l=c.description,h=c.publishStatus,_=(0,A.useIntl)();return(0,t.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,t.jsx)(Ne.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:i}),h&&(0,t.jsxs)(Ne.Z.Text,{className:"whitespace-normal",children:["(",_.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,t.jsx)(Ne.Z.Text,{className:"whitespace-normal text-gray-500",children:l})]})}),tt=e(79398),at=(0,d.memo)(function(c){var i=c.visibleTabs,l=c.defaultActiveTab,h=c.showTeamSwitch,_=h===void 0?!0:h,v=c.workflowName,T=c.workflowDesc,n=c.publishStatus,a=c.onWidthChange,y=c.onItemClick,L=(0,d.useState)(!1),C=x()(L,2),k=C[0],W=C[1],P=(0,d.useState)(!1),D=x()(P,2),S=D[0],j=D[1];return(0,t.jsx)(Te.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:S?100:315,onChange:function(R,o){requestAnimationFrame(function(){W(R<100),a==null||a(R);var b=document.querySelectorAll(".overflow-y-auto");b.forEach(function(u){if(u instanceof HTMLElement){var p=u.clientHeight,E=new CustomEvent("containerResize",{detail:{height:p,width:R}});u.dispatchEvent(E)}})})},children:(0,t.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,t.jsx)(tt.Z,{visibleTabs:i,defaultActiveTab:l,showTeamSwitch:_,isMinWidth:k,isCollapsed:S,onItemClick:y}),(0,t.jsx)(qe,{}),(0,t.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,t.jsx)(et,{name:v,description:T,publishStatus:n})})]})})}),nt=e(74842),ot=e(98165),rt=e(58638),_e=e(28036),st=e(27484),it=e.n(st),Fe=e(70681),lt=200,ut=80,dt={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ct=function(){var i=(0,F._K)(),l=i.getNodes,h=i.getEdges,_=i.setNodes,v=function(a){return{width:a.width||lt,height:a.height||ut}},T=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",y=l(),L=h();if(y.length){var C=new Fe.graphlib.Graph;C.setDefaultEdgeLabel(function(){return{}});var k=w()(w()({},dt),{},{rankdir:a});C.setGraph(k),y.forEach(function(P){var D=v(P),S=D.width,j=D.height;C.setNode(P.id,{width:S,height:j})}),L.forEach(function(P){C.setEdge(P.source,P.target)}),Fe.layout(C);var W=y.map(function(P){var D=C.node(P.id);return w()(w()({},P),{},{position:{x:D.x-D.width/2,y:D.y-D.height/2}})});_(W)}};return{autoLayout:T}},ft=ct,vt=(0,d.memo)(function(){var c=(0,A.useIntl)(),i=(0,A.useSearchParams)(),l=x()(i,1),h=l[0],_=(0,r.Z)(function(u){return u.setWorkFlowInfo}),v=(0,r.Z)(function(u){return u.workFlowInfo}),T=(0,r.Z)(function(u){return u.setRunPanelShow}),n=h.get("type")=="true",a=(0,Ze.Z)(),y=ft(),L=y.autoLayout,C=M.ZP.useMessage(),k=x()(C,2),W=k[0],P=k[1],D=(0,r.Z)(function(u){return u.loadingWorkflowData}),S=function(){var u=K()(N()().mark(function p(){var E;return N()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,a();case 2:E=h.get("app_id"),(0,Z.aJ)(E).then(function(m){console.log(m),m.code==0&&(_(w()(w()({},v),{},{app:w()(w()({},v==null?void 0:v.app),{},{publish_status:"1"})})),W.open({type:"success",content:c.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return g.stop()}},p)}));return function(){return u.apply(this,arguments)}}(),j=function(){T(!0)},ie=function(){var u=K()(N()().mark(function p(){var E,f;return N()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return E=h.get("app_id"),m.next=3,(0,Z.Uq)(E);case 3:f=m.sent;case 4:case"end":return m.stop()}},p)}));return function(){return u.apply(this,arguments)}}(),R=function(){var u=K()(N()().mark(function p(){var E,f,g,m;return N()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:f=h.get("app_id"),g=(v==null||(E=v.app)===null||E===void 0?void 0:E.name)||"workflow",m=it()().format("YYYY_MM_DD-HH_mm_ss"),(0,Z.w8)(f,n==!0?1:0).then(function(be){var X=be,fe=new Blob([X],{type:"text/yaml"}),ve=URL.createObjectURL(fe),oe=document.createElement("a");oe.href=ve,oe.download="".concat(g,"_").concat(m,".yml"),document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(ve)});case 4:case"end":return ee.stop()}},p)}));return function(){return u.apply(this,arguments)}}(),o=function(p){L(p),W.open({type:"success",content:c.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},b=[{key:"TB",label:c.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return o("TB")}},{key:"LR",label:c.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return o("LR")}}];return(0,t.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!n&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(_e.ZP,{type:"primary",disabled:D,onClick:S,children:c.formatMessage({id:"workflow.release"})}),(0,t.jsx)(_e.ZP,{icon:(0,t.jsx)(nt.Z,{}),disabled:D,onClick:j,children:c.formatMessage({id:"workflow.run"})}),(0,t.jsx)(_e.ZP,{icon:(0,t.jsx)(ot.Z,{}),type:"dashed",disabled:D,onClick:a,children:c.formatMessage({id:"workflow.save"})})]}),(0,t.jsx)(_e.ZP,{icon:(0,t.jsx)(rt.Z,{}),type:"dashed",onClick:R,disabled:D,children:c.formatMessage({id:"workflow.export",defaultMessage:""})}),P]})}),Be=e(64458),mt=e(50079),ht=function(){var i,l,h=(0,A.useIntl)(),_=(0,d.useRef)(null),v=(0,r.Z)(function(s){return s.resetNodes}),T=(0,r.Z)(function(s){return s.setNodeTypes}),n=(0,r.Z)(function(s){return s.addNode}),a=(0,r.Z)(function(s){return s.createNode}),y=(0,r.Z)(function(s){return s.setNodes}),L=(0,r.Z)(function(s){return s.setEdges}),C=(0,r.Z)(function(s){return s.setAppId}),k=(0,r.Z)(function(s){return s.setRunPanelShow}),W=(0,r.Z)(function(s){return s.runPanelShow}),P=(0,r.Z)(function(s){return s.getModelData}),D=(0,r.Z)(function(s){return s.setWorkFlowInfo}),S=(0,r.Z)(function(s){return s.setHandleList}),j=(0,r.Z)(function(s){return s.workFlowInfo}),ie=(0,r.Z)(function(s){return s.setWorkflowEditInfo}),R=M.ZP.useMessage(),o=x()(R,2),b=o[0],u=o[1],p=(0,F._K)(),E=p.screenToFlowPosition,f=p.getNodes,g=p.setViewport,m=q(E),Y=m.onDnD,ee=(0,A.useSearchParams)(),be=x()(ee,1),X=be[0],fe=X.get("type")=="true",ve=(0,r.Z)(function(s){return s.setLoadingWorkflowData}),oe=(0,F.B)({includeHiddenNodes:!1}),He=(0,ae.Z)(),xt=(0,Ze.Z)(),Dt=(0,d.useState)(null),Ue=x()(Dt,2),Ke=Ue[0],yt=Ue[1],bt=(0,d.useState)(!1),ze=x()(bt,2),Mt=ze[0],We=ze[1],Ct=(0,d.useState)(""),Ve=x()(Ct,2),Ae=Ve[0],Pt=Ve[1],_t=null;(0,F.CV)({onEnd:function(H){}}),(0,de.Z)(function(){T((0,mt.$P)()),v(),(0,we.b6)(),St(),S([])}),$(),(0,d.useEffect)(function(){if(Ke){A.history.push(Ae);return}var s=A.history.block(function(H,me){if(W){Pt(H.location.pathname),We(!0);return}});return W||s==null||s(),function(){s==null||s()}},[W,Ke]),(0,Q.Z)(function(){if(oe){var s=f(),H=s[s.length-1];H.data.drag&&(H.position={x:H.position.x-H.measured.width/2,y:H.position.y-H.measured.height/2},y(s))}},[oe]),(0,d.useEffect)(function(){var s=Y(function(H,me,Me){var le,ue=w()(w()({drag:!0},Me.data),{},{baseData:Me.baseData});if((le=Me.baseData)!==null&&le!==void 0&&le.output){var he;ue.outputInfo=(he=Me.baseData)===null||he===void 0?void 0:he.output}a(me,{position:H,data:ue})});return s},[Y,n]),(0,Q.Z)(function(){He=="hidden"&&xt()},[He]);var St=function(){var s=K()(N()().mark(function H(){var me;return N()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:me=X.get("app_id"),fe&&b.open({type:"warning",content:h.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),ve(!0),C(me),(0,Z.kE)(me,fe?1:0).then(function(ue){if(ue.code==0){if(D(w()(w()({},ue.data),{},{isProd:fe})),!ue.data.workflow.graph){ve(!1),a(G.vW.Start);return}var he=ue.data,Oe=he.workflow.graph,It=Oe.edges,Tt=Oe.nodes,J=Oe.views,Ge=he.app;ie({enable_api:!!Ge.enable_api,is_public:!!Ge.is_public}),J!=null&&J.nodes&&y(J.nodes),J!=null&&J.edges&&L(J.edges),J!=null&&J.viewPort,setTimeout(function(){ve(!1)},1e3)}}),P();case 6:case"end":return le.stop()}},H)}));return function(){return s.apply(this,arguments)}}(),jt=function(){yt(!0),console.log(Ae),A.history.push(Ae),We(!1)},Et=function(){We(!1)};return(0,t.jsxs)("div",{className:"dndflow",children:[u,(0,t.jsx)(z.Z,{title:h.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Mt,onOk:jt,onCancel:Et,children:h.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,t.jsx)("div",{className:"reactflow-wrapper",ref:_,children:(0,t.jsxs)(se,{children:[(0,t.jsx)(F.Aq,{}),(0,t.jsx)("div",{children:(0,t.jsx)(F.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,t.jsx)(at,{workflowName:j==null||(i=j.app)===null||i===void 0?void 0:i.name,workflowDesc:j==null||(l=j.app)===null||l===void 0?void 0:l.description,publishStatus:fe}),(0,t.jsx)(vt,{}),(0,t.jsx)(Be.s_,{}),(0,t.jsx)(Be.Jf,{}),(0,t.jsx)(Se,{})]})},pt=(0,d.memo)(function(){return(0,t.jsx)(F.tV,{children:(0,t.jsx)(ht,{})})}),gt=function(){return(0,t.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,t.jsx)(pt,{})})},wt=gt}}]);
