"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[654],{81644:function(q,C,a){a.d(C,{Z:function(){return g}});var j=a(1413),l=a(67294),L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"},b=L,N=a(91146),S=function(Z,w){return l.createElement(N.Z,(0,j.Z)((0,j.Z)({},Z),{},{ref:w,icon:b}))},B=l.forwardRef(S),g=B},24805:function(q,C,a){a.d(C,{Hb:function(){return Z},Ur:function(){return J},cN:function(){return z},ej:function(){return w}});var j=a(15009),l=a.n(j),L=a(99289),b=a.n(L),N=a(47520),S="/v1/skill/skill_info/",B="/v1/skill/skill_update/",g="/v1/skill/skill_publish/",x="/v1/skill/skill_run",Z=function(){var k=b()(l()().mark(function f(i,p){var O;return l()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,N.ZP)("".concat(S).concat(i),{method:"GET",data:{publish_status:p=="true"?1:0}});case 2:return O=R.sent,R.abrupt("return",O);case 4:case"end":return R.stop()}},f)}));return function(i,p){return k.apply(this,arguments)}}(),w=function(){var k=b()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(B).concat(i.app_id),{method:"PUT",data:i.data});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}(),z=function(){var k=b()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(g).concat(i),{method:"PUT"});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}(),J=function(){var k=b()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(x),{method:"POST",data:i});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}()},18449:function(q,C,a){a.d(C,{Z:function(){return Re}});var j=a(15009),l=a.n(j),L=a(97857),b=a.n(L),N=a(99289),S=a.n(N),B=a(5574),g=a.n(B),x=a(24805),Z=a(37369),w=a(60271),z=a(24216),J=a(2216),k=a(34994),f=a(35312),i=a(45360),p=a(28036),O=a(47221),n=a(96486),R=a.n(n),V=a(67294),ve=a(19632),Q=a.n(ve),ee=function(r){return r.filter(function(e,d){return r.indexOf(e)!==d})},he=function(r){var e=[];if(!r)return e.push({field:"input_variables",message:"Input variables cannot be empty",type:"error",code:"INPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!r.properties||R().isEmpty(r.properties))return e.push({field:"input_variables.properties",message:"At least one input variable must be defined",type:"error",code:"INPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(r.properties),P=ee(d);return P.length>0&&e.push({field:"input_variables.properties",message:"Duplicate variable names: ".concat(P.join(", ")),type:"error",code:"INPUT_VARIABLES_DUPLICATE"}),Object.entries(r.properties).forEach(function(T){var M=g()(T,2),s=M[0],c=M[1];(!c.name||c.name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},ge=function(r){var e=[];if(!r)return e.push({field:"output_variables",message:"Output variables cannot be empty",type:"error",code:"OUTPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!r.properties||R().isEmpty(r.properties))return e.push({field:"output_variables.properties",message:"At least one output variable must be defined",type:"error",code:"OUTPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(r.properties),P=ee(d);return P.length>0&&e.push({field:"output_variables.properties",message:"Duplicate variable names: ".concat(P.join(", ")),type:"error",code:"OUTPUT_VARIABLES_DUPLICATE"}),Object.entries(r.properties).forEach(function(T){var M=g()(T,2),s=M[0],c=M[1];(!c.name||c.name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},ye=function(r){var e=[];if(!r||r.trim()==="")return e.push({field:"code",message:"Code cannot be empty",type:"error",code:"CODE_REQUIRED"}),{isValid:!1,errors:e};try{var d=JSON.parse(r);(!d.python3||d.python3.trim()==="")&&e.push({field:"code.python3",message:"Python code cannot be empty",type:"error",code:"PYTHON_CODE_REQUIRED"}),d.python3&&!d.python3.includes("def main(")&&e.push({field:"code.python3",message:"Code must contain main function definition",type:"warning",code:"MAIN_FUNCTION_MISSING"})}catch(P){e.push({field:"code",message:"Code format is incorrect, cannot parse JSON",type:"error",code:"CODE_INVALID_JSON"})}return{isValid:e.length===0,errors:e}},Ee=function(r){var e=[];return(!r.name||r.name.trim()==="")&&e.push({field:"name",message:"Skill name cannot be empty",type:"error",code:"NAME_REQUIRED"}),{isValid:e.length===0,errors:e}},be=function(r){var e=[],d=Ee(r);e.push.apply(e,Q()(d.errors));var P=he(r.input_variables);e.push.apply(e,Q()(P.errors));var T=ge(r.output_variables);if(e.push.apply(e,Q()(T.errors)),r.code){var M=ye(r.code);e.push.apply(e,Q()(M.errors))}return{isValid:e.length===0,errors:e}},Ie=function(r){var e={INPUT_VARIABLES_REQUIRED:"skill.message.inputerror1",INPUT_VARIABLES_EMPTY:"skill.message.inputerror1",OUTPUT_VARIABLES_REQUIRED:"skill.message.inputerror2",OUTPUT_VARIABLES_EMPTY:"skill.message.inputerror2",INPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",OUTPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",VARIABLE_NAME_REQUIRED:"skill.rules.name",VARIABLE_DISPLAY_NAME_REQUIRED:"skill.rules.displayname",VARIABLE_NAME_INVALID:"skill.rules.verifydescription",CODE_REQUIRED:"skill.message.codeerror",PYTHON_CODE_REQUIRED:"skill.message.codeerror",NAME_REQUIRED:"skill.message.nameerror",MAIN_FUNCTION_MISSING:"skill.message.mainfunction.missing"};return e[r]||"skill.message.defaulterror"},t=a(85893),Ae=function(r){var e,d,P=r.FourthlyValue,T=r.Fourthlyref,M=r.handleBack,s=r.Skillinfo,c=r.Operationbentate,ke=r.skillid,G=r.app_id,Pe=r.skillupdata,Fe=r.isCreate,_e=r.setSkillInfo,re=r.readOnly,ae=re===void 0?!1:re,o=(0,f.useIntl)(),Ne=(0,V.useState)(null),se=g()(Ne,2),te=se[0],Se=se[1],Me=(0,V.useState)(!1),ne=g()(Me,2),Ue=ne[0],H=ne[1],Oe=(0,V.useState)(["input"]),ie=g()(Oe,2),Ve=ie[0],le=ie[1],De=(0,V.useState)([]),oe=g()(De,2),ue=oe[0],je=oe[1],Te=(0,V.useState)(!1),de=g()(Te,2),Ce=de[0],ce=de[1],Le=(0,V.useRef)();(0,V.useEffect)(function(){},[]);var Be=function(){var U=S()(l()().mark(function I(){var y;return l()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,x.cN)(G||s.app_id);case 2:y=h.sent,y.code==0?(i.ZP.success(o.formatMessage({id:"skill.publishsuccess"})),_e(b()(b()({},s),{},{publish_status:1,app_publish_status:1}))):i.ZP.error(o.formatMessage({id:"skill.select.value"}));case 4:case"end":return h.stop()}},I)}));return function(){return U.apply(this,arguments)}}(),xe=function(){var U=S()(l()().mark(function I(y){var v,h,A,W,u,E,K,F;return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("Form values:",y),H(!0),m.next=4,pe();case 4:if(v=m.sent,!(v===!1||!v||v.code!==0)){m.next=8;break}return H(!1),m.abrupt("return");case 8:return h=v.skill_id||ke||s.id,A=R().cloneDeep((s==null?void 0:s.input_variables)||{}),Object.entries(y).forEach(function(we){var $,X,me=g()(we,2),Y=me[0],fe=me[1];if(A!=null&&($=A.properties)!==null&&$!==void 0&&(X=$.hasOwnProperty)!==null&&X!==void 0&&X.call($,Y))if(A.properties[Y].type==="file"){var _;A.properties[Y].value=(_=fe[0])===null||_===void 0||(_=_.response)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.file_id}else A.properties[Y].value=fe}),W=b()(b()({},s),{},{code:JSON.stringify((s==null?void 0:s.code)||{}),test_input:A}),m.prev=12,console.log("Using skill_id for debug run:",h),m.next=16,(0,x.Ur)({skill_id:h,input_dict:W.test_input});case 16:F=m.sent,i.ZP.success(o.formatMessage({id:"skill.run.success"})),Se((u=F.data)===null||u===void 0?void 0:u.outputs),je(((E=F.data)===null||E===void 0?void 0:E.file_list)||[]),ce(!0),le([]),H(!1),(K=F.data)!==null&&K!==void 0&&K.error&&i.ZP.error(o.formatMessage({id:"skill.debug.run.error"},{error:F.data.error})),m.next=32;break;case 26:m.prev=26,m.t0=m.catch(12),H(!1),ce(!1),i.ZP.error(o.formatMessage({id:"skill.debug.run.failed"})),console.error("Skill run error:",m.t0);case 32:case"end":return m.stop()}},I,null,[[12,26]])}));return function(y){return U.apply(this,arguments)}}(),Qe=function(){var U=S()(l()().mark(function I(){return l()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:f.history.push("/Skill?app_id=".concat(G||(s==null?void 0:s.app_id),"&type=false")),location.reload();case 2:case"end":return v.stop()}},I)}));return function(){return U.apply(this,arguments)}}(),pe=function(){var U=S()(l()().mark(function I(){var y,v,h,A;return l()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(y=be(s),y.isValid){u.next=8;break}if(v=y.errors.filter(function(E){return E.type==="error"}).map(function(E){try{return o.formatMessage({id:Ie(E.code)})}catch(K){return E.message}}),!(v.length>0)){u.next=6;break}return i.ZP.error(o.formatMessage({id:"skill.message.save.failed.validation"},{errors:v.join(`
`)})),u.abrupt("return",!1);case 6:h=y.errors.filter(function(E){return E.type==="warning"}).map(function(E){return E.message}),h.length>0&&i.ZP.warning(o.formatMessage({id:"skill.message.save.failed.warnings"},{warnings:h.join(`
`)}));case 8:return u.prev=8,u.next=11,Pe();case 11:return A=u.sent,u.abrupt("return",A);case 15:return u.prev=15,u.t0=u.catch(8),i.ZP.error(o.formatMessage({id:"skill.conserve.failed"})),console.error("Save skill error:",u.t0),u.abrupt("return",!1);case 20:case"end":return u.stop()}},I,null,[[8,15]])}));return function(){return U.apply(this,arguments)}}(),Ze=[{key:"input",label:o.formatMessage({id:"skill.inputsetting"}),children:(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:s!=null&&(e=s.input_variables)!==null&&e!==void 0&&e.properties&&Object.keys(s.input_variables.properties).length>0?(0,t.jsxs)(k.A,{formRef:Le,onFinish:xe,submitter:!1,children:[(0,t.jsx)(J.Z,{data:s==null||(d=s.input_variables)===null||d===void 0?void 0:d.properties}),(0,t.jsx)("div",{className:"flex gap-3 mt-6",children:(0,t.jsx)(p.ZP,{type:"primary",htmlType:"submit",loading:Ue,className:"flex-1",children:o.formatMessage({id:"skill.run"})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,t.jsx)(w.Z,{hasHover:!1,icon:"/icons/agent_skill.svg",title:o.formatMessage({id:"skill.debug.title"}),loadingText:o.formatMessage({id:"skill.debug.no.input.parameters"})})})})}];return(0,t.jsxs)("div",{style:{height:"calc(100vh-100px)",width:"100%"},children:[(0,t.jsxs)("div",{className:"flex align-center justify-between my-5 px-4",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[o.formatMessage({id:"skill.operationrun"}),ae&&(0,t.jsxs)("span",{className:"ml-2 text-sm text-gray-500 font-normal",children:["- ",o.formatMessage({id:"readonly.mode"})]})]}),!ae&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(p.ZP,{type:"primary",className:"min-w-24",onClick:pe,children:o.formatMessage({id:"skill.btn.save"})})}),(0,t.jsx)(p.ZP,{type:"primary",onClick:Be,className:"ml-4 min-w-24",children:o.formatMessage({id:"skill.publish"})})]})]}),(0,t.jsxs)("div",{className:"h-[calc(100vh-160px)] overflow-y-auto px-4 relative flex flex-col gap-4",children:[(0,t.jsx)(O.Z,{activeKey:Ve,onChange:le,items:Ze,size:"small",className:"[&_.ant-collapse-content-box]:bg-transparent [&_.ant-collapse-content-box]:p-0"}),Ce&&(0,t.jsxs)("div",{className:" bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-[#555555] text-sm font-medium mb-4",children:o.formatMessage({id:"skill.runpreview"})}),(0,t.jsxs)("div",{className:"min-h-[calc(100vh-400px)] flex flex-col overflow-y-auto",children:[(0,t.jsx)("div",{className:"mb-4 h-[calc(100vh-400px)]",children:(0,t.jsx)(z.Z,{language:"python3",value:te&&te,showMaximize:!1,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:(0,t.jsx)("div",{children:o.formatMessage({id:"skill.debug.output.title"})})})}),ue.length>0&&(0,t.jsx)("div",{children:(0,t.jsx)(Z.Z,{files:ue,title:o.formatMessage({id:"agent.file.output"}),className:"mb-8 !mt-2"})})]})]})]}),(0,t.jsx)("div",{className:"h-[30px] w-1"})]})},Re=Ae}}]);
