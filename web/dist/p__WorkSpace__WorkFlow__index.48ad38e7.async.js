"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,be,t){var Re=t(5574),H=t.n(Re),Be=t(42881),q=t(67294),ie=t(85893),p=function(D){var $e=D.children,J=D.className,_=J===void 0?"":J,te=D.dragDirection,ve=te===void 0?"left":te,we=D.minWidth,Ee=we===void 0?115:we,he=D.maxWidth,F=he===void 0?820:he,ue=D.minHeight,l=ue===void 0?200:ue,ae=D.maxHeight,xe=ae===void 0?800:ae,Y=D.defaultWidth,Ce=Y===void 0?415:Y,v=D.defaultHeight,K=v===void 0?300:v,e=D.onChange,ee=(0,q.useState)(Ce),ke=H()(ee,2),He=ke[0],pe=ke[1],Ye=(0,q.useState)(K),fe=H()(Ye,2),rt=fe[0],Xe=fe[1],it=(0,q.useCallback)(function(Fe,Ue){pe(Fe),Ue&&Xe(Ue),e==null||e(Fe,Ue)},[pe,Xe,e]),Qe=(0,Be.W)({direction:["left","right"].includes(ve)?"horizontal":"vertical",triggerDirection:ve,minWidth:Ee,maxWidth:F,minHeight:l,maxHeight:xe,onResize:it}),Ze=Qe.triggerRef,lt=Qe.containerRef;return(0,ie.jsxs)("div",{ref:lt,style:{width:["left","right"].includes(ve)?"".concat(He,"px"):void 0,height:["top","bottom"].includes(ve)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(_),children:[ve==="left"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="right"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="top"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ve==="bottom"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),$e]})};be.Z=(0,q.memo)(p)},36711:function(bt,be,t){t.r(be),t.d(be,{waitTime:function(){return he},waitTimePromise:function(){return Ee}});var Re=t(97857),H=t.n(Re),Be=t(5574),q=t.n(Be),ie=t(15009),p=t.n(ie),Je=t(99289),D=t.n(Je),$e=t(42237),J=t(29608),_=t(83535),te=t(35312),ve=t(67294),we=t(85893),Ee=function(){var F=D()(p()().mark(function ue(){var l,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return l=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.abrupt("return",new Promise(function(Ce){setTimeout(function(){Ce(!0)},l)}));case 2:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}(),he=function(){var F=D()(p()().mark(function ue(){var l,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return l=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.next=3,Ee(l);case 3:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}();be.default=function(){var F=(0,te.useIntl)(),ue=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:F.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ee;v==null||(ee=v.current)===null||ee===void 0||ee.submit()}}},{title:F.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:F.formatMessage({id:"workflow.created_time_des",defaultMessage:F.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:F.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ee;v==null||(ee=v.current)===null||ee===void 0||ee.submit()}},valueEnum:{1:{text:F.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:F.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:F.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(F.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:F.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:F.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],l=(0,te.useSearchParams)(),ae=q()(l,1),xe=ae[0],Y=(0,J.Z)(function(K){return K.setRunPanelLogRecord}),Ce=xe.get("app_id"),v=(0,ve.useRef)(null);return(0,we.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,we.jsx)("div",{children:(0,we.jsx)(_.Z,{columns:ue,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var K=D()(p()().mark(function e(ee,ke,He){var pe;return p()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return console.log(ee,ke,He),fe.next=3,(0,$e.bB)(H()(H()({app_runs_name:"",app_runs_status:0},ee),{},{app_id:Ce}));case 3:return pe=fe.sent,console.log(pe),fe.abrupt("return",{data:pe.data.list,success:!0,total:pe.data.total_count});case 6:case"end":return fe.stop()}},e)}));return function(e,ee,ke){return K.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),Y(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:F.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(bt,be,t){t.r(be),t.d(be,{default:function(){return xa}});var Re=t(15009),H=t.n(Re),Be=t(99289),q=t.n(Be),ie=t(97857),p=t.n(ie),Je=t(5574),D=t.n(Je),$e=t(32060),J=t(42237),_=t(35312),te=t(63648),ve=t(16091),we=t(13118),Ee=t(78234),he=t(77598),F=t(45360),ue=t(85576),l=t(67294),ae=t(64599),xe=t.n(ae),Y=t(7493),Ce=t(34559),v=t(15425),K=t(96906),e=t(85893),ee=function(s){return{nodes:s.nodes,edges:s.edges,onNodesChange:s.onNodesChange,onEdgesChange:s.onEdgesChange,onConnect:s.onConnect,nodeTypes:s.nodeTypes,connectionLineStyle:s.connectionLineStyle,defaultViewport:s.defaultViewport,onDrop:s.onDrop,onDragOver:s.onDragOver,setSelect:s.setSelect,preventScrolling:s.preventScrolling}},ke=(0,l.memo)(function(r){var s=r.children,u=(0,_.useIntl)(),f=(0,v.Z)(function(c){return c.nodes}),b=(0,v.Z)(function(c){return c.getEdges}),a=(0,v.Z)(function(c){return c.edges}),C=(0,v.Z)(function(c){return c.setEdges}),i=(0,v.Z)(function(c){return c.onNodesChange}),n=(0,v.Z)(function(c){return c.onEdgesChange}),g=(0,v.Z)(function(c){return c.onConnect}),x=(0,v.Z)(function(c){return c.nodeTypes}),I=(0,v.Z)(function(c){return c.connectionLineStyle}),k=(0,v.Z)(function(c){return c.defaultViewport}),$=(0,v.Z)(function(c){return c.onDrop}),E=(0,v.Z)(function(c){return c.onDragOver}),d=(0,v.Z)(function(c){return c.setSelect}),m=(0,v.Z)(function(c){return c.preventScrolling}),L=(0,l.useCallback)(function(c){var W=f.find(function(N){return N.id===c.target}),h=function N(O){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(S.has(O.id))return!1;S.add(O.id);var T=xe()((0,Y.xA)(O,f,a)),j;try{for(T.s();!(j=T.n()).done;){var le=j.value;if(le.id===c.source||N(le,S))return!0}}catch(ce){T.e(ce)}finally{T.f()}};return W.id===c.source?!1:!h(W)},[f,a]),ge=function(){},U=(0,l.useCallback)(function(c,W){console.log(c,W,b(),(0,Y.Kz)(c,W,a)),C((0,Y.Kz)(c,W,b()))},[]);return(0,he.Z)(function(){},[f]),(0,e.jsx)(Ce.tV,{children:(0,e.jsx)(te.x$,{onViewportChange:ge,nodes:f,edges:a,onNodesChange:i,onEdgesChange:n,onEdgesDelete:function(W){},onConnect:g,onReconnect:U,nodeTypes:x,minZoom:.3,maxZoom:1,connectionLineStyle:I,snapToGrid:!1,isValidConnection:L,connectionRadius:30,preventScrolling:m,onDragOver:E,onPaneClick:function(){d("")},onPaneContextMenu:function(W){W.preventDefault()},onSelectionChange:function(W){},onNodeClick:function(W,h){d(h.id)},onEdgeClick:function(W,h){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(W){},onBeforeDelete:function(){var c=q()(H()().mark(function W(h){var N;return H()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if((h==null||(N=h.nodes)===null||N===void 0||(N=N[0])===null||N===void 0?void 0:N.type)!=K.vW.Start){S.next=3;break}return F.ZP.error(u.formatMessage({id:"workflow.delStartNodeError"})),S.abrupt("return",Promise.reject(u.formatMessage({id:"workflow.delStartNodeError"})));case 3:return d(""),S.abrupt("return",Promise.resolve(h));case 5:case"end":return S.stop()}},W)}));return function(W){return c.apply(this,arguments)}}(),fitView:!0,children:s})})}),He=function(s){var u=(0,l.useCallback)(function(a){a.preventDefault(),a.dataTransfer.dropEffect="move"},[]),f=(0,l.useCallback)(function(a){a.preventDefault();var C=a.dataTransfer.getData("application/reactflow");if(!C)return null;var i=JSON.parse(C),n=i.type,g=i.item;if(!n||!g)return null;var x=s({x:a.clientX,y:a.clientY});return{position:x,type:n,item:g}},[s]),b=(0,l.useCallback)(function(a){var C=function(n){var g=f(n);g&&a(g.position,g.type,g.item)};return document.addEventListener("dragover",u),document.addEventListener("drop",C),function(){document.removeEventListener("dragover",u),document.removeEventListener("drop",C)}},[u,f]);return{onDnD:b}},pe=He,Ye=function(){var s=(0,v.Z)(function(i){return i.setAgentData}),u=(0,v.Z)(function(i){return i.setSkillData}),f=(0,v.Z)(function(i){return i.setToolData}),b=(0,v.Z)(function(i){return i.setDatasetData}),a=(0,v.Z)(function(i){return i.setTeamDatasetData}),C=(0,v.Z)(function(i){return i.setModelOptionsData});(0,l.useEffect)(function(){(0,J.x$)(2).then(function(i){i.code===0&&s({team:i.data})}),(0,J.x$)(3).then(function(i){i.code===0&&s({user:i.data})}),(0,J.w)(2).then(function(i){i.code===0&&u({team:i.data})}),(0,J.w)(3).then(function(i){i.code===0&&u({user:i.data})}),(0,J.GZ)().then(function(i){i.code===0&&f({list:Object.values(i.data)})}),(0,J.fZ)().then(function(i){var n,g=Array.isArray(i==null||(n=i.data)===null||n===void 0?void 0:n.data)?i.data.data:[],x=g.map(function(m){return{label:m.supplier_name,options:Array.isArray(m.model_list)?m.model_list.map(function(L){return p()(p()({},L),{},{label:L.model_name,value:L.model_config_id})}):[]}}),I,k=xe()(g),$;try{for(k.s();!($=k.n()).done;){var E=$.value;if(Array.isArray(E.model_list)){var d=E.model_list.find(function(m){return m.model_default_used===1});if(d){I=d.model_config_id;break}}}}catch(m){k.e(m)}finally{k.f()}C({options:x,defaultValue:I})}),(0,J.mG)().then(function(i){i.code==0&&b({list:i.data.data.map(function(n){return p()(p()({},n),{},{label:n.name,value:n.dataset_id})})})}),(0,J.mG)(2).then(function(i){i.code==0&&a({list:i.data.data.map(function(n){return p()(p()({},n),{},{label:n.name,value:n.dataset_id})})})})},[s,u,f])},fe=Ye,rt=t(18032),Xe=(0,l.memo)(function(r){var s=r.onSubmit,u=r.onClose;return(0,e.jsx)(rt.default,{onSubmit:s,onClose:u})}),it=t(39873),Qe=t(47520),Ze=t(36711),lt=t(82826),Fe=t(43425),Ue=t(48869),Tt=t(69243),Pt=t(91806),st=t(34994),qe=t(52688),Et=t(55241),Zt=t(50136),dt=t(43586),Wt=function(){var s,u=(0,_.useIntl)(),f=(0,l.useState)(!0),b=D()(f,2),a=b[0],C=b[1],i=(0,v.Z)(function(S){return S.setWorkflowEditInfo}),n=(0,v.Z)(function(S){return S.workFlowInfo}),g=(0,v.Z)(function(S){return S.setSelect}),x=(0,l.useState)("1"),I=D()(x,2),k=I[0],$=I[1],E=(0,l.useState)(!1),d=D()(E,2),m=d[0],L=d[1],ge=(0,dt.Z)(),U=(0,l.useRef)(null),c=function(){var T,j;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(qe.Z,{tooltip:(n==null||(T=n.app)===null||T===void 0?void 0:T.publish_status)!="1"?{title:u.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(n==null||(j=n.app)===null||j===void 0?void 0:j.publish_status)!="1",name:"enable_api",label:"API"})]})})})},W=[{key:"4",icon:(0,e.jsx)(lt.Z,{}),label:u.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:n!=null&&n.isProd?(0,e.jsx)(Fe.Z,{}):(0,e.jsx)(Et.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Fe.Z,{})}),label:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:n==null?void 0:n.isProd},{key:"1",icon:(0,e.jsx)(Ue.Z,{}),label:u.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Tt.Z,{}),label:u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:m?u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):u.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!m},{key:"3",icon:(0,e.jsx)(Pt.Z,{}),label:u.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,he.Z)(function(){if(n){var S,T,j,le,ce=n==null||(S=n.app)===null||S===void 0?void 0:S.is_public,je=n==null||(T=n.app)===null||T===void 0?void 0:T.enable_api,se={};se.is_public=!!ce,se.enable_api=(n==null||(j=n.app)===null||j===void 0?void 0:j.publish_status)=="1"?!!je:!1,console.log(se),L(se.enable_api),U==null||(le=U.current)===null||le===void 0||le.setFieldsValue(se)}},[n]);var h=function(T,j){console.log(T,j),N(j.enable_api),i(j),setTimeout(ge,300)},N=function(T){L(!!T)},O=function(T){var j;switch(T.key){case"4":_.history.go(-1);break;case"0":break;case"2":window.open(Qe._n+(n==null||(j=n.app)===null||j===void 0?void 0:j.api_url),"_blank");break;default:g(""),$(T.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(k==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Zt.Z,{defaultSelectedKeys:["1"],selectedKeys:[k],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:a,items:W,onClick:O}),k=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(qe.Z,{disabled:!(n!=null&&(s=n.app)!==null&&s!==void 0&&s.api_url),name:"enable_api",label:"API"})]})})})]}),k=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(Ze.default,{})})})]})},At=Wt,ut=t(71471),Lt=(0,l.memo)(function(r){var s=r.name,u=r.description,f=r.publishStatus,b=(0,_.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ut.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:s}),f&&(0,e.jsxs)(ut.Z.Text,{className:"whitespace-normal",children:["(",b.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ut.Z.Text,{className:"whitespace-normal text-gray-500",children:u})]})}),Ot=t(19632),wt=t.n(Ot),Rt=t(9783),et=t.n(Rt),Bt=t(22352),ct=t(2302),$t=t(26474),Ht=t(40110),Ft=t(86615),Ut=t(5966),Kt=t(62370),zt=t(96638),_t=t(74330),Vt=t(11941),vt=t(69386),Gt=t(96486),Jt=t(87718),Yt=t(63783),tt=t(83062),ft=t(99510),mt=(0,l.memo)(function(r){var s=r.children,u=r.onDragStart,f=r.onClick,b=r.type,a=r.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(i){return u(i,b,a)},onClick:f,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:s})}),Xt=(0,l.memo)(function(r){var s,u,f,b,a=r.item,C=r.onDragStart,i=r.typeBadge,n=r.onItemClick;return(0,e.jsx)(tt.Z,{placement:"right",title:(a==null||(s=a.baseData)===null||s===void 0?void 0:s.description)||(a==null||(u=a.data)===null||u===void 0?void 0:u.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:C,type:a.type,item:a,onClick:function(){return n==null?void 0:n(a)},children:(0,e.jsx)(ft.Z,{title:a.data.title,icon:(a==null||(f=a.baseData)===null||f===void 0?void 0:f.avatar)||(a==null||(b=a.baseData)===null||b===void 0?void 0:b.icon)||a.type,typeBadge:i})})})})}),Qt=(0,l.memo)(function(r){var s,u=r.item,f=r.onDragStart,b=r.typeBadge,a=r.onItemClick;return(0,e.jsx)(tt.Z,{placement:"right",title:(s=u.baseData)===null||s===void 0?void 0:s.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:f,type:u.type,item:u,onClick:function(){return a==null?void 0:a(u)},children:(0,e.jsx)(ft.Z,{title:u.baseData.name,icon:u.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:u.baseData.nickname}),typeBadge:b})})})})}),qt=(0,l.memo)(function(r){var s,u,f,b,a,C,i,n,g,x,I,k,$,E,d=r.tool,m=r.category,L=r.onDragStart,ge=r.typeBadge,U=r.onItemClick,c=r.categoryIndex,W=r.toolIndex,h=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans",N=(0,ct.o6)()[K.vW.Tool],O=p()(p()({},d),{},{authorization_status:m==null?void 0:m.authorization_status,title:d==null||(s=d.identity)===null||s===void 0?void 0:s.label[h],icon:m==null||(u=m.identity)===null||u===void 0?void 0:u.icon,groupName:m==null||(f=m.identity)===null||f===void 0?void 0:f.name,credentials_for_provider:m==null?void 0:m.credentials_for_provider}),S={title:d==null||(b=d.identity)===null||b===void 0?void 0:b.label[h],desc:(d==null||(a=d.description)===null||a===void 0||(a=a.human)===null||a===void 0?void 0:a[h])||(d==null||(C=d.description)===null||C===void 0?void 0:C.llm),icon:m==null||(i=m.identity)===null||i===void 0?void 0:i.icon,data:{title:d==null||(n=d.identity)===null||n===void 0?void 0:n.label[h],desc:(d==null||(g=d.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[h])||(d==null||(x=d.description)===null||x===void 0?void 0:x.llm),icon:m==null||(I=m.identity)===null||I===void 0?void 0:I.icon,optput:d==null?void 0:d.output},baseData:O};return(0,e.jsx)(tt.Z,{placement:"right",title:d==null||(k=d.description)===null||k===void 0||(k=k.human)===null||k===void 0?void 0:k[h],children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:L,type:K.vW.Tool,item:S,onClick:function(){return U==null?void 0:U(m,d,c,W)},children:(0,e.jsx)("div",{className:"text-sm py-2 pl-2 text-gray-600",children:(d==null||($=d.identity)===null||$===void 0?void 0:$.label[h])||(d==null||(E=d.identity)===null||E===void 0?void 0:E.label.en_US)})})})})}),ea=(0,l.memo)(function(r){var s,u,f,b,a=r.category,C=r.onDragStart,i=r.typeBadge,n=r.onItemClick,g=r.categoryIndex,x=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{className:"flex flex-col pb-2",children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2 flex items-center",children:[(0,e.jsx)(ft.Z,{title:(a==null||(s=a.identity)===null||s===void 0?void 0:s.label[x])||(a==null||(u=a.identity)===null||u===void 0?void 0:u.label.en_US),icon:a==null||(f=a.identity)===null||f===void 0?void 0:f.icon,typeBadge:i}),(0,e.jsx)(tt.Z,{placement:"right",title:a==null||(b=a.identity)===null||b===void 0?void 0:b.description[x],children:(0,e.jsx)(Yt.Z,{className:"cursor-pointer ml-1"})})]}),a.tools.map(function(I,k){return(0,e.jsx)("div",{className:"pl-6",children:(0,e.jsx)(qt,{tool:I,category:a,onDragStart:C,typeBadge:i,onItemClick:function(E,d,m,L){return n==null?void 0:n(E,d,m,L)},categoryIndex:g,toolIndex:k},k)})})]})}),ta=function(s){var u=s.list,f=s.onDragStart,b=s.type,a=b===void 0?"normal":b,C=s.typeBadge,i=C===void 0?null:C,n=s.onItemClick;return u!=null&&u.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:a==="tools"?u.map(function(g,x){return(0,e.jsx)(ea,{category:g,typeBadge:i,onDragStart:f,onItemClick:n,categoryIndex:x},x)}):a==="workflow"?u.map(function(g,x){return(0,e.jsx)(Qt,{item:g,onDragStart:f,typeBadge:i,onItemClick:n},x)}):u.map(function(g,x){return(0,e.jsx)(Xt,{item:g,onDragStart:f,typeBadge:i,onItemClick:n},x)})}):null},aa=(0,l.memo)(ta),na=(0,l.memo)(function(r){var s=r.visibleTabs,u=r.defaultActiveTab,f=r.showTeamSwitch,b=f===void 0?!0:f,a=r.isMinWidth,C=a===void 0?!1:a,i=r.isCollapsed,n=i===void 0?!1:i,g=r.onItemClick,x=(0,_.useIntl)(),I=(0,_.getLocale)()=="en-US"?"en_US":"zh_Hans",k=(0,ct.o6)(),$=(0,l.useMemo)(function(){return Object.values(k).filter(function(w){return![K.vW.Start,K.vW.Agent,K.vW.Tool,K.vW.Skill].includes(w.base.type)}).map(function(w){return w.base})},[k]),E=(0,l.useState)(u||"1"),d=D()(E,2),m=d[0],L=d[1],ge=(0,l.useState)($),U=D()(ge,2),c=U[0],W=U[1],h=(0,l.useState)([]),N=D()(h,2),O=N[0],S=N[1],T=(0,$t.v)(),j=T.tags,le=(0,zt.Z)(et()(et()(et()({},K.vW.Agent,[]),K.vW.Skill,[]),"workflow",[])),ce=D()(le,2),je=ce[0],se=ce[1],De=(0,l.useState)({team:1,keyword:"",tag:[]}),ye=D()(De,2),y=ye[0],ze=ye[1],_e=(0,l.useRef)({}),gt=6e4,Me=(0,v.Z)(function(w){return w.toolData});(0,l.useEffect)(function(){S((Me==null?void 0:Me.list)||[])},[Me]);var We=(0,l.useCallback)(function(w,B,Z){w.dataTransfer.setData("application/reactflow",JSON.stringify({type:B,item:Z})),w.dataTransfer.effectAllowed="move"},[]),at=(0,l.useCallback)(function(w,B){if(!B)return w;var Z=new vt.Z(w,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),ne=Z.search(B);return ne.map(function(o){return o.item})},[]),nt=(0,l.useCallback)(function(w,B){if(!B)return w;var Z=w.map(function(P){var M;return p()(p()({},P),{},{tools:(M=P.tools)===null||M===void 0?void 0:M.map(function(X){var z,oe;return p()(p()({},X),{},{categoryName:(z=P.identity)===null||z===void 0||(z=z.label)===null||z===void 0?void 0:z[I],categoryIcon:(oe=P.identity)===null||oe===void 0?void 0:oe.icon})})})}),ne=new vt.Z(Z,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),o=ne.search(B);return o.map(function(P){return p()(p()({},P.item),{},{tools:P.item.tools.filter(function(M){var X=new vt.Z([M],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return X.search(B).length>0})})}).filter(function(P){return P.tools.length>0})},[I]),Ae=(0,l.useCallback)(function(){var w=q()(H()().mark(function B(Z){var ne,o,P,M,X,z;return H()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(ne="".concat(Z,"-").concat(y.team,"-").concat(y.keyword,"-").concat(y.tag.join(",")),o=_e.current[ne],!(o&&Date.now()-o.timestamp<gt&&JSON.stringify(o.params)===JSON.stringify(y))){R.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(Z)),R.abrupt("return",o.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(Z)),R.prev=6,R.next=9,(0,J.RE)(Z,{search_type:y.team,apps_name:y.keyword,tag_ids:((P=y.tag)===null||P===void 0?void 0:P.join(","))||""});case 9:if(M=R.sent,!((M==null?void 0:M.code)===0&&M!==null&&M!==void 0&&M.data&&Array.isArray(M.data.list)&&M.data.list.length>0)){R.next=16;break}return X=M.data.list,z=X.filter(function(me){return me.publish_status==1}).map(function(me){var Ne,Oe;return p()(p()({},(Ne=k[Z])===null||Ne===void 0?void 0:Ne.base),{},{data:p()(p()({},(Oe=k[Z])===null||Oe===void 0?void 0:Oe.base.data),{},{title:me.name,desc:me.description}),baseData:me})}),_e.current[ne]={data:z,timestamp:Date.now(),params:p()({},y)},se(et()({},Z,z)),R.abrupt("return",z);case 16:return R.abrupt("return",[]);case 19:return R.prev=19,R.t0=R.catch(6),console.error("Failed to fetch ".concat(Z," data:"),R.t0),R.abrupt("return",[]);case 23:case"end":return R.stop()}},B,null,[[6,19]])}));return function(B){return w.apply(this,arguments)}}(),[y,k,se]),Ie=(0,l.useMemo)(function(){var w=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return y.keyword?at(c,y.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Ae(K.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return y.keyword?nt(O,y.keyword):O}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var Z=q()(H()().mark(function o(){return H()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Ae(K.vW.Skill);case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},o)}));function ne(){return Z.apply(this,arguments)}return ne}()}],B=s!=null&&s.length?w.filter(function(Z){return s.includes(Z.tabKey)}):w;return B.map(function(Z,ne){return p()(p()({},Z),{},{key:ne+1+""})})},[c,je,O,s,y,at,nt,Ae]),Ve=(0,l.useMemo)(function(){return Ie.map(function(w){return{key:w.key,label:x.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}})},[Ie,x]),ot=(0,l.useCallback)(function(w){var B=w.tabIndex,Z=w.showName,ne=Z===void 0?!0:Z,o=Ie.find(function(A){return A.key===B}),P=(0,l.useState)([]),M=D()(P,2),X=M[0],z=M[1],oe=(0,l.useState)(!0),R=D()(oe,2),me=R[0],Ne=R[1],Oe=(0,l.useState)([]),re=D()(Oe,2),Se=re[0],St=re[1],Da=(0,l.useState)(20),Sa=D()(Da,1),pt=Sa[0],Ca=(0,l.useState)(500),Ct=D()(Ca,2),kt=Ct[0],jt=Ct[1],Te=(0,l.useRef)(null),yt=(0,l.useRef)(!1),ka=54;(0,l.useEffect)(function(){var A=function(){if(Te.current){var Q=Te.current.clientHeight;jt(Q)}},V=function(Q){jt(Q.detail.height)};return A(),Te.current&&Te.current.addEventListener("containerResize",V),window.addEventListener("resize",A),function(){Te.current&&Te.current.removeEventListener("containerResize",V),window.removeEventListener("resize",A)}},[]),(0,l.useEffect)(function(){return function(){yt.current=!1}},[o==null?void 0:o.tabKey]),(0,l.useEffect)(function(){var A=function(){var V=q()(H()().mark(function de(){var Q,Pe;return H()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!(yt.current&&!y.keyword&&y.tag.length===0)){G.next=2;break}return G.abrupt("return");case 2:if(Ne(!0),G.prev=3,o){G.next=6;break}return G.abrupt("return");case 6:return G.next=8,o.getData();case 8:Q=G.sent,Pe=(Q==null?void 0:Q.map(function(Ma,Ia){return p()(p()({},Ma),{},{id:"".concat(o.tabKey,"-").concat(Ia)})}))||[],z(Pe),St(Pe.slice(0,pt)),yt.current=!0,G.next=18;break;case 15:G.prev=15,G.t0=G.catch(3),console.error("Failed to fetch data:",G.t0);case 18:return G.prev=18,Ne(!1),G.finish(18);case 21:case"end":return G.stop()}},de,null,[[3,15,18,21]])}));return function(){return V.apply(this,arguments)}}();A()},[o,y,pt]);var ja=function(V){if(V.currentTarget.scrollHeight-V.currentTarget.scrollTop===kt){var de=Se.length;if(de<X.length){var Q=X.slice(de,de+pt);St(function(Pe){return[].concat(wt()(Pe),wt()(Q))})}}},Mt=(0,l.useCallback)(function(A){var V,de,Q;if(o){switch(console.log("Clicked item:",A),o.tabKey){case"tool":console.log("Tool ".concat((V=A.identity)===null||V===void 0||(V=V.label)===null||V===void 0?void 0:V[I]));break;case"workflow":console.log("Workflow ".concat((de=A.data)===null||de===void 0?void 0:de.title));break;case"agent":console.log("Agent ".concat((Q=A.data)===null||Q===void 0?void 0:Q.title));break;default:console.log("Clicked ".concat(o.tabKey," item:"),A)}g&&g(A,o.tabKey)}},[o,I,g]),It=(0,l.memo)(function(A){var V=A.data,de=A.index,Q=A.onDragStart,Pe=A.onItemClick,Nt=A.type,G=A.typeBadge;return(0,e.jsx)(aa,{typeBadge:G,list:[V],onDragStart:Q,type:Nt,onItemClick:Pe})});return o?(0,e.jsx)("div",{ref:Te,className:"overflow-y-auto h-full",children:(0,e.jsx)(_t.Z,{spinning:me,children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:Se.map(function(A){return(0,e.jsx)(It,{data:A,index:Se.indexOf(A),onDragStart:We,onItemClick:Mt,type:o.type,typeBadge:y!=null&&y.keyword&&o.tabKey!="node"?{icon:"/icons/".concat(o.tabKey,".svg"),tooltip:o.tabKey,color:"#1b64f3"}:void 0},A.id)})}):(0,e.jsx)(Jt.Z,{data:Se,height:kt,itemHeight:ka,itemKey:"id",onScroll:ja,children:function(V){return(0,e.jsx)(It,{data:V,index:Se.indexOf(V),onDragStart:We,onItemClick:Mt,type:o.type,typeBadge:y!=null&&y.keyword&&o.tabKey!="node"?{icon:"/icons/".concat(o.tabKey,".svg"),tooltip:o.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[m,y,C,Ie,We,I,g]),Ge=(0,l.useCallback)((0,Gt.debounce)(function(w){ze(w)},500),[]),Le=(0,l.useCallback)(function(){_e.current={}},[]);(0,l.useEffect)(function(){Le()},[y.team,Le]);var ht=(0,l.useCallback)(function(w,B){"team"in w?ze(B):("tag"in w||"keyword"in w)&&Ge(B)},[Ge]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!n&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(st.A,{submitter:!1,initialValues:y,onValuesChange:ht,children:[b&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[x.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Ft.Z.Group,{name:"team",fieldProps:{options:[{label:x.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:x.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Ut.Z,{fieldProps:{prefix:(0,e.jsx)(Ht.Z,{}),placeholder:x.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Kt.Z,{name:"tag",children:(0,e.jsx)(Bt.O,{className:"w-full",options:j,listStyle:C?"horizontal":"vertical",allowClear:!0,placeholder:x.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(B){}})})})]}),y!=null&&y.keyword?null:(0,e.jsx)(Vt.Z,{activeKey:m,items:Ve,onChange:function(B){L(B)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ie.map(function(w,B){return(0,e.jsxs)("div",{className:"space-y-2",children:[!n&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:x.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}),(0,e.jsx)(ot,{tabIndex:B+1+"",showName:!C},w.key)]},w.key)})}):(0,e.jsx)(ot,{tabIndex:m,showName:!C})})]})}),oa=(0,l.memo)(function(r){var s=r.visibleTabs,u=r.defaultActiveTab,f=r.showTeamSwitch,b=f===void 0?!0:f,a=r.workflowName,C=r.workflowDesc,i=r.publishStatus,n=r.onWidthChange,g=r.onItemClick,x=(0,l.useState)(!1),I=D()(x,2),k=I[0],$=I[1],E=(0,l.useState)(!1),d=D()(E,2),m=d[0],L=d[1];return(0,e.jsx)(it.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:m?100:315,onChange:function(U,c){requestAnimationFrame(function(){$(U<100),n==null||n(U);var W=document.querySelectorAll(".overflow-y-auto");W.forEach(function(h){if(h instanceof HTMLElement){var N=h.clientHeight,O=new CustomEvent("containerResize",{detail:{height:N,width:U}});h.dispatchEvent(O)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(na,{visibleTabs:s,defaultActiveTab:u,showTeamSwitch:b,isMinWidth:k,isCollapsed:m,onItemClick:g}),(0,e.jsx)(At,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Lt,{name:a,description:C,publishStatus:i})})]})})}),ra=t(74842),ia=t(98165),la=t(83456),sa=t(58638),Ke=t(28036),da=t(83159),ua=t(27484),ca=t.n(ua),xt=t(70681),va=200,fa=80,ma={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ga=function(){var s=(0,te._K)(),u=s.getNodes,f=s.getEdges,b=s.setNodes,a=function(n){return{width:n.width||va,height:n.height||fa}},C=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",g=u(),x=f();if(g.length){var I=new xt.graphlib.Graph;I.setDefaultEdgeLabel(function(){return{}});var k=p()(p()({},ma),{},{rankdir:n});I.setGraph(k),g.forEach(function(E){var d=a(E),m=d.width,L=d.height;I.setNode(E.id,{width:m,height:L})}),x.forEach(function(E){I.setEdge(E.source,E.target)}),xt.layout(I);var $=g.map(function(E){var d=I.node(E.id);return p()(p()({},E),{},{position:{x:d.x-d.width/2,y:d.y-d.height/2}})});b($)}};return{autoLayout:C}},ha=ga,pa=(0,l.memo)(function(){var r=(0,_.useIntl)(),s=(0,_.useSearchParams)(),u=D()(s,1),f=u[0],b=(0,v.Z)(function(h){return h.setWorkFlowInfo}),a=(0,v.Z)(function(h){return h.workFlowInfo}),C=(0,v.Z)(function(h){return h.setRunPanelShow}),i=f.get("type")=="true",n=(0,dt.Z)(),g=ha(),x=g.autoLayout,I=F.ZP.useMessage(),k=D()(I,2),$=k[0],E=k[1],d=(0,v.Z)(function(h){return h.loadingWorkflowData}),m=function(){var h=q()(H()().mark(function N(){var O;return H()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,n();case 2:O=f.get("app_id"),(0,J.aJ)(O).then(function(j){console.log(j),j.code==0&&(b(p()(p()({},a),{},{app:p()(p()({},a==null?void 0:a.app),{},{publish_status:"1"})})),$.open({type:"success",content:r.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return T.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),L=function(){C(!0)},ge=function(){var h=q()(H()().mark(function N(){var O,S;return H()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return O=f.get("app_id"),j.next=3,(0,J.Uq)(O);case 3:S=j.sent;case 4:case"end":return j.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),U=function(){var h=q()(H()().mark(function N(){var O,S,T,j;return H()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:S=f.get("app_id"),T=(a==null||(O=a.app)===null||O===void 0?void 0:O.name)||"workflow",j=ca()().format("YYYY_MM_DD-HH_mm_ss"),(0,J.w8)(S,i==!0?1:0).then(function(je){var se=je,De=new Blob([se],{type:"text/yaml"}),ye=URL.createObjectURL(De),y=document.createElement("a");y.href=ye,y.download="".concat(T,"_").concat(j,".yml"),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(ye)});case 4:case"end":return ce.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),c=function(N){x(N),$.open({type:"success",content:r.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},W=[{key:"TB",label:r.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:r.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}];return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!i&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Ke.ZP,{type:"primary",disabled:d,onClick:m,children:r.formatMessage({id:"workflow.release"})}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(ra.Z,{}),disabled:d,onClick:L,children:r.formatMessage({id:"workflow.run"})}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(ia.Z,{}),type:"dashed",disabled:d,onClick:n,children:r.formatMessage({id:"workflow.save"})}),(0,e.jsx)(da.Z,{menu:{items:W},placement:"bottomRight",children:(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(la.Z,{}),type:"dashed",disabled:d,children:r.formatMessage({id:"workflow.autoLayout",defaultMessage:"Auto Layout"})})})]}),(0,e.jsx)(Ke.ZP,{icon:(0,e.jsx)(sa.Z,{}),type:"dashed",onClick:U,disabled:d,children:r.formatMessage({id:"workflow.export",defaultMessage:""})}),E]})}),Dt=t(64458),ya=function(){var s,u,f=(0,_.useIntl)(),b=(0,l.useRef)(null),a=(0,v.Z)(function(o){return o.resetNodes}),C=(0,v.Z)(function(o){return o.setNodeTypes}),i=(0,v.Z)(function(o){return o.addNode}),n=(0,v.Z)(function(o){return o.createNode}),g=(0,v.Z)(function(o){return o.setNodes}),x=(0,v.Z)(function(o){return o.setEdges}),I=(0,v.Z)(function(o){return o.setAppId}),k=(0,v.Z)(function(o){return o.setRunPanelShow}),$=(0,v.Z)(function(o){return o.runPanelShow}),E=(0,v.Z)(function(o){return o.getModelData}),d=(0,v.Z)(function(o){return o.setWorkFlowInfo}),m=(0,v.Z)(function(o){return o.setHandleList}),L=(0,v.Z)(function(o){return o.workFlowInfo}),ge=(0,v.Z)(function(o){return o.setWorkflowEditInfo}),U=F.ZP.useMessage(),c=D()(U,2),W=c[0],h=c[1],N=(0,te._K)(),O=N.screenToFlowPosition,S=N.getNodes,T=N.setViewport,j=pe(O),le=j.onDnD,ce=(0,_.useSearchParams)(),je=D()(ce,1),se=je[0],De=se.get("type")=="true",ye=(0,v.Z)(function(o){return o.setLoadingWorkflowData}),y=(0,te.B)({includeHiddenNodes:!1}),ze=(0,we.Z)(),_e=(0,dt.Z)(),gt=(0,l.useState)(null),Me=D()(gt,2),We=Me[0],at=Me[1],nt=(0,l.useState)(!1),Ae=D()(nt,2),Ie=Ae[0],Ve=Ae[1],ot=(0,l.useState)(""),Ge=D()(ot,2),Le=Ge[0],ht=Ge[1],w=null;(0,te.CV)({onEnd:function(P){}}),(0,Ee.Z)(function(){C((0,ct.$P)()),a(),(0,$e.b6)(),B(),m([])}),fe(),(0,l.useEffect)(function(){if(We){_.history.push(Le);return}var o=_.history.block(function(P,M){if($){ht(P.location.pathname),Ve(!0);return}});return $||o==null||o(),function(){o==null||o()}},[$,We]),(0,he.Z)(function(){if(y){var o=S(),P=o[o.length-1];P.data.drag&&(P.position={x:P.position.x-P.measured.width/2,y:P.position.y-P.measured.height/2},g(o))}},[y]),(0,l.useEffect)(function(){var o=le(function(P,M,X){var z;console.log(P,M,X);var oe=p()(p()({drag:!0},X.data),{},{baseData:X.baseData});if((z=X.baseData)!==null&&z!==void 0&&z.output){var R;oe.outputInfo=(R=X.baseData)===null||R===void 0?void 0:R.output}debugger;n(M,{position:P,data:oe})});return o},[le,i]),(0,he.Z)(function(){ze=="hidden"&&_e()},[ze]);var B=function(){var o=q()(H()().mark(function P(){var M;return H()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:M=se.get("app_id"),De&&W.open({type:"warning",content:f.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),ye(!0),I(M),(0,J.kE)(M,De?1:0).then(function(oe){if(oe.code==0){if(d(p()(p()({},oe.data),{},{isProd:De})),!oe.data.workflow.graph){ye(!1),n(K.vW.Start);return}var R=oe.data,me=R.workflow.graph,Ne=me.edges,Oe=me.nodes,re=me.views,Se=R.app;ge({enable_api:!!Se.enable_api,is_public:!!Se.is_public}),re!=null&&re.nodes&&g(re.nodes),re!=null&&re.edges&&x(re.edges),re!=null&&re.viewPort,setTimeout(function(){ye(!1)},1e3)}}),E();case 6:case"end":return z.stop()}},P)}));return function(){return o.apply(this,arguments)}}(),Z=function(){at(!0),console.log(Le),_.history.push(Le),Ve(!1)},ne=function(){Ve(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[h,(0,e.jsx)(ue.Z,{title:f.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ie,onOk:Z,onCancel:ne,children:f.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:b,children:(0,e.jsxs)(ke,{children:[(0,e.jsx)(te.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(te.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(oa,{workflowName:L==null||(s=L.app)===null||s===void 0?void 0:s.name,workflowDesc:L==null||(u=L.app)===null||u===void 0?void 0:u.description,publishStatus:De}),(0,e.jsx)(pa,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Xe,{})]})},ba=(0,l.memo)(function(){return(0,e.jsx)(te.tV,{children:(0,e.jsx)(ya,{})})}),wa=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(ba,{})})},xa=wa}}]);
