"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[615],{13085:function(Ke,ce,t){t.d(ce,{Z:function(){return Pe}});var me=t(19632),O=t.n(me),ve=t(97857),Q=t.n(ve),fe=t(15009),_=t.n(fe),ge=t(99289),w=t.n(ge),_e=t(5574),T=t.n(_e),C=t(11551),u=t(67294),B=t(74330),X=t(35312),a=t(85893),q=function(s){var o=s.children,m=s.onLoadMore,v=s.onLoadPrevious,y=s.hasMore,b=s.hasPrevious,M=b===void 0?!1:b,H=s.threshold,N=H===void 0?100:H,Ee=s.className,Ie=Ee===void 0?"":Ee,Y=s.loadingComponent,ee=Y===void 0?(0,a.jsx)(B.Z,{size:"small"}):Y,$e=s.errorComponent,xe=s.initialScrollPosition,He=xe===void 0?"bottom":xe,ae=s.preserveScrollPosition,Ge=ae===void 0?!0:ae,be=s.scrollBehavior,ke=be===void 0?"smooth":be,Ze=(0,X.useIntl)(),$=(0,u.useRef)(null),De=(0,u.useState)(!1),Te=T()(De,2),oe=Te[0],Le=Te[1],we=(0,u.useState)(!1),Me=T()(we,2),de=Me[0],Se=Me[1],Ne=(0,u.useState)(null),ue=T()(Ne,2),je=ue[0],ze=ue[1],J=(0,u.useRef)(!1),Re=(0,u.useRef)(!0),Oe=function(){$.current&&($.current.scrollTop=$.current.scrollHeight)};(0,u.useEffect)(function(){Re.current&&$.current&&($.current.scrollTop=$.current.scrollHeight,Re.current=!1)},[]),(0,u.useEffect)(function(){var I=$.current;if(I){var ye=function(){var se=w()(_()().mark(function G(){var Z,W,Ce,Ae,Be;return _()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!J.current){D.next=2;break}return D.abrupt("return");case 2:if(Z=I.scrollTop,W=I.scrollHeight,Ce=I.clientHeight,!(M&&!de&&Z<N)){D.next=16;break}return D.prev=4,J.current=!0,Se(!0),Ae=I.scrollHeight,Be=I.scrollTop,D.next=11,v==null?void 0:v();case 11:requestAnimationFrame(function(){var We=I.scrollHeight,n=We-Ae;I.scrollTop=Be+n});case 12:return D.prev=12,J.current=!1,Se(!1),D.finish(12);case 16:if(!(y&&!oe&&W-Z-Ce<N)){D.next=27;break}return D.prev=17,J.current=!0,Le(!0),D.next=22,m==null?void 0:m();case 22:I.scrollTop=I.scrollHeight;case 23:return D.prev=23,J.current=!1,Le(!1),D.finish(23);case 27:case"end":return D.stop()}},G,null,[[4,,12,16],[17,,23,27]])}));return function(){return se.apply(this,arguments)}}(),h=te(ye,150);return I.addEventListener("scroll",h),function(){return I.removeEventListener("scroll",h)}}},[y,M,m,v,N,oe,de]);function te(I,ye){var h;return function(){for(var se=this,G=arguments.length,Z=new Array(G),W=0;W<G;W++)Z[W]=arguments[W];clearTimeout(h),h=setTimeout(function(){return I.apply(se,Z)},ye)}}return(0,a.jsxs)("div",{ref:$,className:"relative overflow-y-auto ".concat(Ie),children:[(0,a.jsxs)("div",{className:"flex flex-col-reverse min-h-full",children:[de&&(0,a.jsx)("div",{className:"sticky top-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:ee}),o,oe&&(0,a.jsx)("div",{className:"sticky bottom-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:ee})]}),je&&(0,a.jsx)("div",{className:"sticky top-0 w-full text-center py-2 text-red-500",children:$e||je.message})]})},S=q,P=t(39944),U=t(55927),l=t(82114),k=t(27496),z=t(82061),E=t(34994),re=t(90672),c=t(64317),he=t(77598),K=t(45360),ne=t(85576),F=t(28036),V=t(22683),j=t(97807),le=(0,u.memo)(function(e){var s=e.message;return(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("div",{className:"max-w-[70%] rounded-lg p-3 bg-blue-100 text-blue-900",children:s.message})})}),ie=(0,u.memo)(function(e){var s,o=e.message,m=e.detailList,v=e.abilitiesList,y=(0,X.useIntl)(),b=v==null?void 0:v.find(function(M){return M.value===o.ability_id});return(0,a.jsx)("div",{className:"flex justify-start pb-4",children:(0,a.jsxs)("div",{className:"max-w-full",children:[(0,a.jsxs)("div",{className:"text-sm font-bold mb-2",children:[m==null||(s=m.app)===null||s===void 0?void 0:s.name," ",(b==null?void 0:b.label)&&(0,a.jsxs)("span",{className:"text-gray-500 font-normal text-xs",children:["(",b==null?void 0:b.label,")"]})]}),(0,a.jsxs)("div",{className:"max-w-[90%] rounded-lg  relative bg-white text-gray-900 border border-gray-200",children:[o.message&&(0,a.jsx)("div",{className:"p-3 child  max-w-full [&_p]:mb-0 [&_div]:max-w-full break-words",children:(0,a.jsx)(V.U,{rehypePlugins:[j.Z],children:o.message})}),o.error&&(0,a.jsxs)("div",{className:"p-3 text-red-500",children:[(0,a.jsx)("div",{children:y.formatMessage({id:"agent.chat.error.message"})}),o.error]}),(0,a.jsx)("div",{className:"absolute w-full mt-1",children:(0,a.jsxs)("div",{className:"text-xs text-gray-500 flex justify-between",children:[(0,a.jsx)("div",{children:o.created_time}),(0,a.jsx)("div",{})]})})]})]})})}),pe=(0,u.memo)(function(e){var s,o=e.detailList,m=(0,X.useIntl)();return(0,a.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[70%]",children:(0,a.jsxs)("div",{className:"max-w-full",children:[(0,a.jsx)("div",{className:"text-sm font-bold mb-2",children:o==null||(s=o.app)===null||s===void 0?void 0:s.name}),(0,a.jsx)("div",{className:"max-w-[90%] min-w-[200px] rounded-lg relative bg-white text-gray-900 border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 pr-4",children:[(0,a.jsx)(B.Z,{size:"small"}),(0,a.jsx)("span",{className:"text-gray-500",children:m.formatMessage({id:"agent.chat.waiting"})})]})})]})})}),Pe=(0,u.memo)(function(e){var s,o,m,v,y,b,M,H,N,Ee=(0,u.useState)([]),Ie=T()(Ee,2),Y=Ie[0],ee=Ie[1],$e=(0,u.useState)(!0),xe=T()($e,2),He=xe[0],ae=xe[1],Ge=(0,u.useState)(1),be=T()(Ge,2),ke=be[0],Ze=be[1],$=(0,u.useState)(!1),De=T()($,2),Te=De[0],oe=De[1],Le=(0,u.useState)(!1),we=T()(Le,2),Me=we[0],de=we[1],Se=(0,u.useState)(!1),Ne=T()(Se,2),ue=Ne[0],je=Ne[1],ze=(0,u.useState)(!1),J=T()(ze,2),Re=J[0],Oe=J[1],te=(0,u.useRef)(),I=(0,u.useRef)(null),ye=(0,u.useRef)(null),h=(0,X.useIntl)(),se=(0,U.Z)(function(n){return n.getTypedMessages("chat_message_llm_return")}),G=(0,U.Z)(function(n){return n.getTypedLastMessage("chat_message_llm_return")});console.log(e.data);var Z=function(){var d;(d=I.current)===null||d===void 0||d.scrollIntoView({behavior:"smooth"})},W=function(){var n=w()(_()().mark(function d(){var r,g,f;return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e!=null&&(r=e.saveInfo)!==null&&r!==void 0&&r.firstjudgingcondition())){i.next=4;break}return i.abrupt("return",!0);case 4:if(!(e!=null&&(g=e.saveInfo)!==null&&g!==void 0&&g.secondjudgingcondition())){i.next=8;break}return i.abrupt("return",!0);case 8:return i.next=10,e==null||(f=e.saveInfo)===null||f===void 0?void 0:f.agentupdata();case 10:return i.abrupt("return",i.sent);case 11:case"end":return i.stop()}},d)}));return function(){return n.apply(this,arguments)}}();(0,he.Z)(function(){var n=G==null?void 0:G.data;if(n){var d=Q()(Q()({},n),{},{id:n.message_id});se&&se.length>0&&(Oe(!1),ee(function(r){return[].concat(O()(r),[d])}),setTimeout(Z,100))}},[se]);var Ce=function(){var n=w()(_()().mark(function d(r){var g,f,p,i,x,R,Ue,L,Ve;return _()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(console.log(r),i=(g=te.current)===null||g===void 0?void 0:g.getFieldsValue(),!(!i||!((f=r.content)!==null&&f!==void 0&&f.trim()))){A.next=4;break}return A.abrupt("return");case 4:return x=e.data.detailList.agent.agent_id,R=e.data.detailList.agent.input_variables,Ue=i.ability_id,L=new P.z({user:{value:i.content}}),Ve={id:Date.now(),content:r.content,isUser:!0,ability_id:Ue,agent_id:x,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:i.content,prompt_tokens:0,total_tokens:0},Oe(!0),ee(function(Ye){return[].concat(O()(Ye),[Ve])}),(p=te.current)===null||p===void 0||p.resetFields(["content"]),A.prev=12,A.next=15,(0,C.CY)({agent_id:x,input_dict:R,ability_id:Ue,prompt:L});case 15:A.next=21;break;case 17:A.prev=17,A.t0=A.catch(12),Oe(!1),K.ZP.error("\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 21:setTimeout(Z,100);case 22:case"end":return A.stop()}},d,null,[[12,17]])}));return function(r){return n.apply(this,arguments)}}(),Ae=function(){var n=w()(_()().mark(function d(){var r,g,f;return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if((r=e.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,je(!0),i.next=6,(0,C.CU)(String(e.data.detailList.agent.agent_id),1);case 6:f=i.sent,(g=f.data)!==null&&g!==void 0&&g.list&&(ee(f.data.list),ae(f.data.total_pages>1),Ze(1)),i.next=13;break;case 10:i.prev=10,i.t0=i.catch(2),console.error("Failed to fetch initial messages:",i.t0);case 13:return i.prev=13,je(!1),i.finish(13);case 16:case"end":return i.stop()}},d,null,[[2,10,13,16]])}));return function(){return n.apply(this,arguments)}}(),Be=function(){var n=w()(_()().mark(function d(){var r,g,f,p;return _()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(Te||!((r=e.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id))){x.next=2;break}return x.abrupt("return");case 2:return x.prev=2,oe(!0),f=ke+1,x.next=7,(0,C.CU)(String(e.data.detailList.agent.agent_id),f);case 7:p=x.sent,((g=p.data)===null||g===void 0||(g=g.list)===null||g===void 0?void 0:g.length)>0?(ee(function(R){return[].concat(O()(p.data.list),O()(R))}),Ze(f),ae(f<p.data.total_pages)):ae(!1),x.next=15;break;case 11:x.prev=11,x.t0=x.catch(2),console.error("Failed to load more messages:",x.t0),ae(!1);case 15:return x.prev=15,oe(!1),x.finish(15);case 18:case"end":return x.stop()}},d,null,[[2,11,15,18]])}));return function(){return n.apply(this,arguments)}}(),Fe=function(){var n=w()(_()().mark(function d(){var r;return _()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(!((r=e.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id)||Me||!Y.length)){f.next=2;break}return f.abrupt("return");case 2:ne.Z.confirm({title:h.formatMessage({id:"agent.chat.clear.memory.confirm.title"}),icon:(0,a.jsx)(l.Z,{}),content:h.formatMessage({id:"agent.chat.clear.memory.confirm.content"}),okText:h.formatMessage({id:"agent.chat.clear.memory.confirm.ok"}),cancelText:h.formatMessage({id:"agent.chat.clear.memory.confirm.cancel"}),onOk:function(){var p=w()(_()().mark(function x(){var R;return _()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.prev=0,de(!0),R=Y[Y.length-1].id,L.next=5,(0,C.Nj)(String(e.data.detailList.agent.agent_id),R);case 5:K.ZP.success(h.formatMessage({id:"agent.chat.clear.memory.success"})),L.next=11;break;case 8:L.prev=8,L.t0=L.catch(0),console.error("Failed to clear context memory:",L.t0);case 11:return L.prev=11,de(!1),L.finish(11);case 14:case"end":return L.stop()}},x,null,[[0,8,11,14]])}));function i(){return p.apply(this,arguments)}return i}()});case 3:case"end":return f.stop()}},d)}));return function(){return n.apply(this,arguments)}}();(0,u.useEffect)(function(){var n;(n=e.data)!==null&&n!==void 0&&(n=n.detailList)!==null&&n!==void 0&&(n=n.agent)!==null&&n!==void 0&&n.agent_id&&Ae()},[(s=e.data)===null||s===void 0||(s=s.detailList)===null||s===void 0||(s=s.agent)===null||s===void 0?void 0:s.agent_id]),(0,u.useEffect)(function(){!ue&&Y.length>0&&Z()},[ue]);var D=function(){return(0,a.jsxs)("div",{className:"flex items-center justify-center py-2 bg-white/80",children:[(0,a.jsx)(B.Z,{size:"small"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:h.formatMessage({id:"agent.chat.loading.more"})})]})};if(ue)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(B.Z,{})});var We=function(){var n=w()(_()().mark(function d(){return _()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,W();case 2:setTimeout(w()(_()().mark(function f(){var p,i;return _()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,C.Dh)((p=e.data)===null||p===void 0||(p=p.detailList)===null||p===void 0||(p=p.agent)===null||p===void 0?void 0:p.agent_id);case 2:i=R.sent,i.code==0?K.ZP.success(h.formatMessage({id:"agent.message.success.publish"})):K.ZP.error(h.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return R.stop()}},f)})),500);case 3:case"end":return g.stop()}},d)}));return function(){return n.apply(this,arguments)}}();return(0,a.jsx)("div",{className:"!h-[calc(100vh-65px)] p-4 !pb-0 box-border",children:(0,a.jsxs)(E.A,{formRef:te,submitter:!1,onFinish:Ce,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto ",children:[(0,a.jsxs)("div",{className:"pb-4 flex gap-[10px] ",style:{paddingBottom:"16px"},children:[(0,a.jsx)("div",{className:"flex-1 flex items-center font-bold text-base",children:(o=e.data)===null||o===void 0||(o=o.detailList)===null||o===void 0||(o=o.app)===null||o===void 0?void 0:o.name}),e.operationbentate=="false"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.ZP,{type:"primary",disabled:e.operationbentate!="false",onClick:W,className:"min-w-24",children:h.formatMessage({id:"agent.btn.savedebug"})}),(0,a.jsx)(F.ZP,{type:"primary",disabled:e.operationbentate!="false",onClick:We,className:"min-w-24",children:h.formatMessage({id:"agent.publish"})})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#ccc] flex-1 overflow-y-auto flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto ",ref:ye,children:(0,a.jsx)(S,{className:"h-full",onLoadPrevious:Be,hasPrevious:He,hasMore:!1,threshold:50,loadingComponent:(0,a.jsx)(D,{}),children:(0,a.jsxs)("div",{className:"px-4 py-2 space-y-4",children:[Y.map(function(n){var d,r;return n.agent_run_id===0?(0,a.jsx)(le,{message:n},n.id):(0,a.jsx)(ie,{detailList:e==null||(d=e.data)===null||d===void 0?void 0:d.detailList,abilitiesList:e==null||(r=e.data)===null||r===void 0?void 0:r.abilitiesList,message:n},n.id)}),Re&&(0,a.jsx)(pe,{detailList:e==null||(m=e.data)===null||m===void 0?void 0:m.detailList}),(0,a.jsx)("div",{ref:I})]})})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 bg-white  px-4 py-2 relative",children:[(0,a.jsxs)("div",{className:"flex items-center p-[8px] gap-[10px] box-border border bg-white rounded-[8px]",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(re.Z,{name:"content",placeholder:h.formatMessage({id:"agent.chat.input.placeholder"}),disabled:(e==null||(v=e.data)===null||v===void 0||(v=v.detailList)===null||v===void 0||(v=v.agent)===null||v===void 0?void 0:v.agent_id)==0,fieldProps:{autoSize:{minRows:1,maxRows:4},variant:"borderless",onPressEnter:function(d){if(!d.shiftKey){var r;d.preventDefault(),(r=te.current)===null||r===void 0||r.submit()}},size:"small",className:"",title:h.formatMessage({id:"agent.chat.input.shift.enter"})},formItemProps:{className:"mb-0"},className:"mb-0"})}),(0,a.jsx)(F.ZP,{onClick:function(){var d;return(d=te.current)===null||d===void 0?void 0:d.submit()},type:"primary",disabled:(e==null||(y=e.data)===null||y===void 0||(y=y.detailList)===null||y===void 0||(y=y.agent)===null||y===void 0?void 0:y.agent_id)==0,className:"min-w-[30px] h-[30px] flex items-center justify-center cursor-pointer rounded-[6px]",icon:(0,a.jsx)(k.Z,{}),title:h.formatMessage({id:"agent.chat.send"})})]}),(0,a.jsxs)("div",{className:"flex items-center mt-1 gap-2",children:[(0,a.jsx)(c.Z,{name:"ability_id",options:((b=e.data)===null||b===void 0?void 0:b.abilitiesList)||[{value:0,label:h.formatMessage({id:"agent.allability"})}],fieldProps:{placeholder:h.formatMessage({id:"agent.pleaseselect"}),size:"small"},disabled:(e==null||(M=e.data)===null||M===void 0||(M=M.detailList)===null||M===void 0||(M=M.agent)===null||M===void 0?void 0:M.agent_id)==0||!((H=e.data)!==null&&H!==void 0&&(H=H.abilitiesList)!==null&&H!==void 0&&H.length),formItemProps:{className:"mb-0"}}),(0,a.jsx)(F.ZP,{icon:(0,a.jsx)(z.Z,{}),disabled:(e==null||(N=e.data)===null||N===void 0||(N=N.detailList)===null||N===void 0||(N=N.agent)===null||N===void 0?void 0:N.agent_id)==0,loading:Me,onClick:Fe,size:"small",children:h.formatMessage({id:"agent.chat.clear.memory"})})]})]})]})]})})})},27842:function(Ke,ce,t){var me=t(5574),O=t.n(me),ve=t(15009),Q=t.n(ve),fe=t(99289),_=t.n(fe),ge=t(11551),w=t(29608),_e=t(32592),T=t(35312),C=t(67294),u=t(21076),B=t(85893),X=null,a=null;ce.ZP=function(q){var S=q.agent_id,P=(0,T.useIntl)(),U=(0,T.useSearchParams)(),l=O()(U,1),k=l[0],z=(0,C.useRef)(null),E=(0,C.useState)(null),re=O()(E,2),c=re[0],he=re[1],K=(0,C.useState)(!1),ne=O()(K,2),F=ne[0],V=ne[1],j=k.get("app_id"),le=function(){V(!1)},ie=function(s){he({app_id:j,app_run_id:s.id}),V(!0)},pe=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:P.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:P.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:P.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:P.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:P.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:P.formatMessage({id:"workflow.created_time_des",defaultMessage:P.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(P.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:P.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:P.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],Pe=(0,w.Z)(function(e){return e.setRunPanelLogRecord});return(0,B.jsxs)("div",{className:"h-full",children:[(0,B.jsx)(_e.Z,{columns:pe,formRef:z,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var e=_()(Q()().mark(function s(o,m,v){var y;return Q()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return console.log(o,m,v),M.next=3,(0,ge.My)(j,{page:o.current,page_size:o.pageSize});case 3:return y=M.sent,console.log(y),M.abrupt("return",{data:y.data.list,success:!0,total:y.data.total_count});case 6:case"end":return M.stop()}},s)}));return function(s,o,m){return e.apply(this,arguments)}}(),onRow:function(s){return{onClick:function(){ie(s)},className:(c==null?void 0:c.app_run_id)===s.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:P.formatMessage({id:"agent.log.list"})}),F&&(c==null?void 0:c.app_id)&&(c==null?void 0:c.app_run_id)&&(0,B.jsx)(u.Z,{data:c,onClose:le})]})}},21076:function(Ke,ce,t){var me=t(15009),O=t.n(me),ve=t(99289),Q=t.n(ve),fe=t(5574),_=t.n(fe),ge=t(11551),w=t(39873),_e=t(28508),T=t(29933),C=t(35312),u=t(3917),B=t(66309),X=t(28036),a=t(71471),q=t(74330),S=t(26412),P=t(12845),U=t(67294),l=t(85893);ce.Z=(0,U.memo)(function(k){var z,E=k.data,re=k.onClose,c=(0,C.useIntl)(),he=(0,U.useState)(500),K=_()(he,2),ne=K[0],F=K[1],V=(0,u.Z)(function(){var e=Q()(O()().mark(function s(o,m){var v;return O()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,ge.pC)(o,m);case 2:return v=b.sent,b.abrupt("return",v.data);case 4:case"end":return b.stop()}},s)}));return function(s,o){return e.apply(this,arguments)}}(),{manual:!0}),j=V.data,le=V.loading,ie=V.run;(0,U.useEffect)(function(){E!=null&&E.app_id&&E!==null&&E!==void 0&&E.app_run_id&&ie(E.app_id,E.app_run_id)},[E==null?void 0:E.app_id,E==null?void 0:E.app_run_id,ie]);var pe=function(s){var o={1:{color:"processing",text:c.formatMessage({id:"workflow.running"})},2:{color:"success",text:c.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:c.formatMessage({id:"workflow.runF"})}},m=o[s]||{color:"default",text:"Unknown"};return(0,l.jsx)(B.Z,{color:m.color,children:m.text})},Pe=function(s){F(s)};return(0,l.jsx)(w.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:ne,onChange:Pe,children:(0,l.jsx)(T.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,l.jsx)(X.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:re,icon:(0,l.jsx)(_e.Z,{})}),title:(0,l.jsx)(a.Z.Title,{level:5,children:c.formatMessage({id:"agent.log.detail"})}),loading:le,children:(0,l.jsx)("div",{className:"space-y-6",children:le?(0,l.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,l.jsx)(q.Z,{})}):j?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(S.Z,{column:1,bordered:!0,size:"small",children:[(0,l.jsx)(S.Z.Item,{label:c.formatMessage({id:"workflow.user"}),children:j.nickname}),(0,l.jsx)(S.Z.Item,{label:c.formatMessage({id:"workflow.status"}),children:pe(j.status)}),(0,l.jsx)(S.Z.Item,{label:c.formatMessage({id:"workflow.created_time"}),children:j.created_time}),(0,l.jsxs)(S.Z.Item,{label:c.formatMessage({id:"workflow.elapsed_time"}),children:[j.elapsed_time,"s"]}),(0,l.jsx)(S.Z.Item,{label:"Tokens",children:j.total_tokens})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)(a.Z.Title,{level:5,children:c.formatMessage({id:"agent.log.output"})}),j.outputs?(0,l.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:((z=j.outputs)===null||z===void 0?void 0:z.value)||""})}):j.error?(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,l.jsx)("div",{className:"text-red-500 font-medium mb-2",children:c.formatMessage({id:"agent.log.error"})}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:j.error})]}):(0,l.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,l.jsx)("div",{className:"text-sm text-gray-500",children:c.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(j==null?void 0:j.prompt_data)&&j.prompt_data.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)(a.Z.Title,{level:5,children:c.formatMessage({id:"agent.log.conversation"})}),(0,l.jsx)(P.Z,{className:"mt-2",children:j.prompt_data.map(function(e,s){var o=_()(e,2),m=o[0],v=o[1];return(0,l.jsx)(P.Z.Item,{color:m==="human"?"blue":"green",children:(0,l.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,l.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:m}),(0,l.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:v.value})]})},s)})})]})]}):null})})})})}}]);
