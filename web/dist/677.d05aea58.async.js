"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[677],{80459:function(gt,He,s){var Ue=s(32332),L=s(67294),Ne=s(85893),X=function(oe){var me=oe.width,Re=me===void 0?"40px":me,q=oe.bg,Ae=q===void 0?"#F4F8F1":q,xe=oe.rounded,Be=xe===void 0?"6px":xe,Z=oe.data,ee=oe.imgWidth,M=ee===void 0?"18px":ee,A=oe.background;Z!=null&&Z.avatar&&(M=Re);var U=A||Ae;return(0,Ne.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Re,height:Re,backgroundColor:U,borderRadius:Be},children:(0,Ne.jsx)("img",{src:Z!=null&&Z.avatar?Z.avatar:(0,Ue.s9)("single",Z==null?void 0:Z.icon),style:{width:M,height:M,borderRadius:Be},alt:""})})};He.Z=(0,L.memo)(X)},97767:function(gt,He,s){s.d(He,{F:function(){return Rn}});var Ue=s(5574),L=s.n(Ue),Ne=s(45360),X=s(55026),x=s(67294),oe=s(15009),me=s.n(oe),Re=s(19632),q=s.n(Re),Ae=s(99289),xe=s.n(Ae),Be=s(9783),Z=s.n(Be),ee=s(97857),M=s.n(ee),A=s(43722),U=s(39e3),N=s(35312),ie=s(74330),te=s(41428),t=s(85893),it=function(e){var n=e.roomid,a=(0,N.useIntl)(),r=(0,U.Z)(function(c){return c.setSummaryClick}),o=(0,x.useState)(!0),u=L()(o,2),l=u[0],d=u[1],m=(0,U.Z)(function(c){return c.summaryClick});(0,x.useEffect)(function(){d(m)},[m]);var g=(0,U.Z)(function(c){return c.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(g({id:n}),r(!1))},children:[(0,t.jsx)(te.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ge=s(80459),Je=s(32332),Fe=s(22683),Ke=s(97807),ze=s(55060),ne=s(28036),De=s(69753),ke=s(97245),F=s(77295),R=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},pe=function(e){var n=e.fileList,a=e.onDownload,r=a===void 0?R:a,o=e.className,u=o===void 0?"":o,l=e.showInGrid,d=l===void 0?!1:l,m=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(u),style:{maxHeight:m,overflow:m?"auto":"visible"},children:(0,t.jsx)(ze.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(d?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(g,c){var _=g.path_show||g.url,j=(0,F.CO)(g.name);return(0,t.jsx)("div",{className:"".concat(d?"":"mb-2"),children:j?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(ze.Z,{src:_,alt:g.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(De.Z,{}),onClick:function(b){b.stopPropagation(),r(_,g.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(ke.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:g.name})]}),(0,t.jsx)(ne.ZP,{type:"text",size:"small",icon:(0,t.jsx)(De.Z,{}),onClick:function(){return r(_,g.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(g.uid||g.file_id||c))})})})})},Me=pe,fe=s(13769),le=s.n(fe),We=function(){var i=xe()(me()().mark(function e(n){return me()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",Xe(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",Xe(n));case 12:case"end":return r.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),Xe=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},xt=s(64599),nt=s.n(xt),Oe=s(52677),re=s.n(Oe),rt=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},at=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):x.isValidElement(e)?i(e.props.children):""},Se=function(e){return at(e)},_e=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||re()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,u=o===void 0?!0:o,l=n.checkMCPTools,d=l===void 0?!0:l,m=n.checkStreaming,g=m===void 0?!0:m,c=n.minTextLength,_=c===void 0?1:c,j=function(){if(!r)return!1;try{var P=e.content;return P&&typeof P=="string"&&P.trim().length>=_}catch(V){return console.warn("Error checking text content:",V),!1}},y=function(){if(!u)return!1;try{var P=e.fileList||e.file_list;return P&&Array.isArray(P)&&P.length>0}catch(V){return console.warn("Error checking file content:",V),!1}},b=function(){if(!d)return!1;try{var P;if((P=e.parsedContent)!==null&&P!==void 0&&P.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var V=e.contentBlocks.some(function(H){return H&&H.type==="mcp"&&H.toolId});if(V)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(H){return console.warn("Error checking MCP content:",H),!1}},p=function(){if(!g)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(P){return P&&P.type==="text"&&P.content&&P.content.trim().length>=_}):!1}catch(P){return console.warn("Error checking streaming content:",P),!1}};return j()||y()||b()||p()}catch(I){return console.error("hasMessageContent unexpected error:",I),!0}},ft=function(e){try{var n=(e==null?void 0:e.content)||"",a=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],r=(e==null?void 0:e.parsedContent)||{},o=(e==null?void 0:e.contentBlocks)||[],u=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(u)&&u.length>0,hasStreamingText:o.some(function(l){var d;return(l==null?void 0:l.type)==="text"&&(l==null||(d=l.content)===null||d===void 0?void 0:d.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(u)?u.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},lt=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var a=nt()(e),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o&&o.is_agent===1&&_e(o,M()({checkText:!1,checkFiles:!0,checkMCPTools:!1,minTextLength:1},n)))return o}}catch(u){a.e(u)}finally{a.f()}return null}catch(u){return console.error("checkLastAgentMessage error:",u),null}},pt=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},$e=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},ut=function(e,n){try{var a=M()(M()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),r=e.contentBlocks;if(!r&&e.parsedContent?r=pt(e.parsedContent):!r&&e.content&&(r=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&r){var o=$e(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(u){return console.error("prepareHistoryMessageForCurrent error:",u),e}},vt=["node","className","children"],se=["node"],ct=function(e,n){return{code:function(r){var o=r.node,u=r.className,l=r.children,d=le()(r,vt),m=/language-(\w+)/.exec(u||"");if(m!=null&&m.length){var g=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:m[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var c=xe()(me()().mark(function _(j){var y,b;return me()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,y=j.currentTarget,I.next=4,We(Se(l));case 4:b=I.sent,b&&y?(y.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){y&&(y.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):y&&(y.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){y&&(y.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),I.next=11;break;case 8:I.prev=8,I.t0=I.catch(0),console.error("Failed to copy text: ",I.t0);case 11:case"end":return I.stop()}},_,null,[[0,8]])}));return function(_){return c.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(g).concat(e),className:"p-4",children:l})})]})}else return(0,t.jsx)("code",M()(M()({},d),{},{children:l}))},img:function(r){var o=r.node,u=le()(r,se),l=function(m,g){try{var c=document.createElement("a");c.href=m,c.download=g,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(_){}};return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(ze.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(De.Z,{}),onClick:function(m){m.stopPropagation(),l(u.src||"",u.alt||"image.png")}})})]})}}},z="<<<mcp-tool-start>>>",Ve="<<<mcp-tool-end>>>",Tt=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],a=0;;){var r=e.indexOf(z,a);if(r===-1)break;var o=e.indexOf(Ve,r);if(o===-1)break;var u=r+z.length,l=e.substring(u,o).trim();try{var d=JSON.parse(l),m={id:d.id,name:d.name||"",skill_or_workflow_name:d.skill_or_workflow_name||"",workflow_run_id:d.workflow_run_id||0,workflow_confirmation_status:d.workflow_confirmation_status||null,args:d.args||{},result:d.result||null,files_to_upload:d.files_to_upload||[]};d.files_to_upload&&Array.isArray(d.files_to_upload)&&d.files_to_upload.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(m.id,":"),d.files_to_upload),n.push({toolData:m,startIndex:r,endIndex:o+Ve.length})}catch(g){console.error("Failed to parse MCP tool JSON:",g)}a=o+Ve.length}return n},St=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=Tt(e);if(n.length===0)return[{type:"text",content:e}];var a=[],r=0;if(n.forEach(function(u){if(u.startIndex>r){var l=e.substring(r,u.startIndex).trim();l&&a.push({type:"text",content:l})}a.push({type:"mcp-tool",content:e.substring(u.startIndex,u.endIndex),toolData:u.toolData}),r=u.endIndex}),r<e.length){var o=e.substring(r).trim();o&&a.push({type:"text",content:o})}return a},ye=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=St(e),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},Kt=function(e,n,a){var r=_objectSpread({},e);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(u){return u.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},Lt=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(a){return a.id===n})||null},Nt=function(e,n){var a=_objectSpread({},e);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},qe=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},bt=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload},a=JSON.stringify(n,null,0);return"".concat(z).concat(a).concat(Ve)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},_t=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(n){return!n||re()(n)!=="object"?(console.warn("Invalid file object in files_to_upload:",n),!1):n.file_path&&typeof n.file_path=="string"&&n.file_path.trim()!==""&&(n.file_path.startsWith("http")||n.file_path.startsWith("/"))})}catch(n){return console.error("Error inferring uploaded files:",n),[]}},yt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return e.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var u=bt(o);a+=u}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},It=s(61227),jt=s.n(It),w=s(29608),ae=s(97175),Ce=s(4161),Ct=s(49354),st=s(45699),dt=s(8751),ot=s(79090),Mt=s(66212),wt=s(16596),Et=s(11475),Ut=s(2830),zt=s(87547),Rt=s(71471),Bt=s(47221),At=s(66309),Vt=s(4393),D=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i.WAITING_FILE_UPLOAD="waiting_file_upload",i}({}),kt=function(e,n){if(e){if(e.status==="waiting_confirm")return D.WAITING_CONFIRMATION;if(n===null)return D.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return D.FAILED}catch(r){}else if(re()(n)==="object"&&n.status==="failed")return D.FAILED;return D.COMPLETED}return D.PENDING},Jt=function(e){var n,a=e.fileConfig,r=e.value,o=e.onChange,u=(0,F.ZP)({maxSizeMB:a.maxSize||10,acceptedFileTypes:((n=a.accepted_types)===null||n===void 0?void 0:n.join(","))||void 0,multiple:!1}),l=u.uploadedFiles,d=u.handleUpload,m=u.removeFile,g=u.clearFiles,c=u.isUploading;return(0,x.useEffect)(function(){if(l.length>0){var _=l[l.length-1],j={file_name:_.name,file_path:_.path_show,size:0,type:"",id:_.file_id,status:"done"};o(j)}else o(null)},[l]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[a.name,a.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),a.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:a.description}),a.accepted_types&&a.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",a.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:l.length===0?(0,t.jsx)(ne.ZP,{type:"dashed",onClick:d,loading:c,disabled:c,className:"w-48",children:c?"Uploading...":"Upload File"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:l[l.length-1].name}),(0,t.jsx)(ne.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return m(l[l.length-1].uid)},disabled:c,children:"Remove"})]})})]})},$t=Jt,Yt=function(e){var n=e.toolData,a=e.onFileUploadComplete,r=e.onFileUploadError,o=n.files_to_upload||[],u=(0,x.useState)({}),l=L()(u,2),d=l[0],m=l[1],g=o.every(function(y){return y.required===!1||d[y.variable_name]&&d[y.variable_name].status==="done"}),c=function(b,p){m(function(I){var P=M()({},I);return p?P[b]=p:delete P[b],P})},_=function(){return o.map(function(b){var p=d[b.variable_name];return M()(M()({},b),p)})},j=function(){if(!g){Ne.ZP.warning("Please upload all required files.");return}var b=_();a(b)};return(0,x.useEffect)(function(){},[g,d,a]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Required Files"})}),o.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"No files required."}),o.map(function(y){return(0,t.jsx)($t,{fileConfig:y,value:d[y.variable_name],onChange:function(p){return c(y.variable_name,p)}},y.variable_name)}),(0,t.jsx)(ne.ZP,{type:"primary",className:"mt-2 w-full",disabled:!g,onClick:j,children:"Complete Upload"})]})},Qt=Yt,Ye=Rt.Z.Text,Bn=Rt.Z.Paragraph,Ft=Bt.Z.Panel,Xt=function(e){var n=e.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)(ae.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,t.jsx)(Ce.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,t.jsx)(Ct.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(st.Z,{className:"text-purple-600 ".concat(a)});default:return(0,t.jsx)(ke.Z,{className:"text-gray-600 ".concat(a)})}},Wt=function(e){var n=e.fileList,a=e.intl,r=function(u,l){try{var d=document.createElement("a");d.href=u,d.download=l,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(m){console.error("Download file failed",m)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(o,u){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Ye,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:Xt(o.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,t.jsx)(ne.ZP,{type:"text",size:"small",icon:(0,t.jsx)(De.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},u)})})},qt=function(e){var n=e.status;switch(n){case D.COMPLETED:return(0,t.jsx)(dt.Z,{className:"text-green-500"});case D.RUNNING:return(0,t.jsx)(ot.Z,{className:"text-blue-500"});case D.WAITING_CONFIRMATION:return(0,t.jsx)(Mt.Z,{className:"text-orange-500"});case D.WAITING_FILE_UPLOAD:return(0,t.jsx)(wt.Z,{className:"text-purple-500"});case D.FAILED:return(0,t.jsx)(Et.Z,{className:"text-red-500"});default:return(0,t.jsx)(Mt.Z,{className:"text-gray-500"})}},en=function(e){var n=e.status,a=e.intl,r=function(l){switch(l){case D.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case D.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case D.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case D.WAITING_FILE_UPLOAD:return{color:"purple",text:a.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case D.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,t.jsx)(At.Z,{color:o.color,children:o.text})},Pt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(a){return e}try{return JSON.stringify(e,null,2)}catch(a){return String(e)}},tn=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},nn=function(e){if(!e||re()(e)!=="object")return{specialFields:{},regularFields:e};var n={},a={};return Object.keys(e).forEach(function(r){r==="input_variables"?n[r]=e[r]:a[r]=e[r]}),{specialFields:n,regularFields:a}},rn=function(e){var n=e.inputVariables,a=e.intl;return!n||re()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ye,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=L()(r,2),u=o[0],l=o[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(Ye,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[u,":"]}),(0,t.jsx)(Ye,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},u)})})]})},an=function(e){var n=e.args,a=e.intl;try{var r=nn(n),o=r.specialFields,u=r.regularFields,l=o.input_variables&&Object.keys(o.input_variables).length>0,d=u&&Object.keys(u).length>0;return!l&&!d?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(rn,{inputVariables:o.input_variables,intl:a}),d&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ye,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(u)})})]})]})}catch(m){return console.warn("Failed to parse parameters for enhanced display:",m),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})}},on=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(a){return[]}return n&&re()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(a){return console.warn("Failed to extract file list from result data:",a),[]}},sn=function(e){var n=e.resultData,a=e.intl,r=e.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(m){o=n}var u=o&&re()(o)==="object"&&o.status==="success"&&o.outputs&&re()(o.outputs)==="object";if(u){var l=o.outputs,d=Object.keys(l).length>0;return d?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ye,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(m){var g=L()(m,2),c=g[0],_=g[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Ye,{strong:!0,className:"text-xs text-gray-700",children:[c,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof _=="string"?(0,t.jsx)(Fe.U,{rehypePlugins:[Ke.Z],components:ct(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:_}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:Pt(_)})})]},c)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===D.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})},Dt=function(e){var n=e.toolData,a=e.intl,r=e.runtimeData,o=e.updateMCPTool,u=e.setInstruction,l=(r==null?void 0:r.status)||kt(n.workflow_confirmation_status,n.result),d=tn(n.name,a),m=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,g=(0,w.Z)(function(G){return G.setDealtWithData}),c=(r==null?void 0:r.result)||n.result,_=null;if(typeof c=="string")try{var j=JSON.parse(c);j.status==="failed"&&(_=j.message)}catch(G){}else re()(c)==="object"&&(c==null?void 0:c.status)==="failed"&&(_=c.message);var y=function(){g(M()(M()({},m),{},{exec_id:m.node_exec_id}))},b=function G(k,Ie){if(u){if(k.length===0){Ie&&Ie();return}var ce=jt()(k),et=ce[0],Ze=ce.slice(1);u(et),setTimeout(function(){G(Ze,Ie)},100)}},p=function(k){if(!o){console.warn("updateMCPTool function not available");return}try{if(o(n.id,{uploaded_files:k,status:D.RUNNING}),u){var Ie=[["MCPTOOLFILES",{id:n.id,files_to_upload:k}]];b(Ie)}}catch(ce){console.error("Error handling file upload completion:",ce),Ne.ZP.error("Failed to process file upload completion")}},I=function(k){console.error("File upload error:",k),Ne.ZP.error(k),o&&o(n.id,{status:D.FAILED,error:k})},P=on(c),V=P&&Array.isArray(P)&&P.length>0,H=((r==null?void 0:r.uploaded_files)||[]).map(function(G){return{file_name:G.file_name||G.name,file_path:G.file_path||"",variable_name:G.variable_name}}),be=H&&Array.isArray(H)&&H.length>0;return(0,t.jsxs)(Vt.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Ut.Z,{className:"text-blue-500"}),(0,t.jsx)(Ye,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(At.Z,{color:"blue",children:d}),(0,t.jsx)(qt,{status:l}),(0,t.jsx)(en,{status:l,intl:a})]}),m&&l!==D.COMPLETED&&l!==D.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(zt.Z,{className:"text-orange-500"}),(0,t.jsxs)(Ye,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),m.confirmer_name&&(0,t.jsxs)(Ye,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",m.confirmer_name]})]}),m.show_todo_button&&(0,t.jsx)(ne.ZP,{size:"small",type:"primary",onClick:y,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),_&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(Ye,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",_]})}),(r==null?void 0:r.status)===D.WAITING_FILE_UPLOAD&&(0,t.jsx)(Qt,{toolData:r,onFileUploadComplete:p,onFileUploadError:I}),(0,t.jsxs)(Bt.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,t.jsxs)(Ft,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(an,{args:(r==null?void 0:r.args)||n.args,intl:a}),be&&(0,t.jsx)(Wt,{fileList:H,intl:a})]},"params"),c&&(0,t.jsx)(Ft,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(sn,{resultData:c,intl:a,status:l})},"result"),V&&(0,t.jsx)(Ft,{header:a.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Wt,{fileList:P,intl:a})},"files")]})]})},Zt=function(e){var n,a=e.content,r=e.fileList,o=e.index,u=e.intl,l=e.isAgent,d=e.contentId,m=e.mcpTools,g=e.updateMCPTool,c=e.getMCPTool,_=e.setInstruction,j=e.item,y=e.contentBlocks,b=(j==null?void 0:j.parsedContent)||ye(a);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:d,children:[r&&r.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(Me,{fileList:r,onDownload:rt})}),y&&y.length>0?(0,t.jsx)("div",{children:y.map(function(p,I){var P,V,H,be,G,k;return(0,t.jsx)("div",{children:p.type==="text"?p.content&&(0,t.jsx)(Fe.U,{rehypePlugins:[Ke.Z],components:ct(o,u),children:p.content}):p.toolId&&c&&(0,t.jsx)(Dt,{toolData:{id:p.toolId,name:((P=c(p.toolId))===null||P===void 0?void 0:P.name)||"",skill_or_workflow_name:((V=c(p.toolId))===null||V===void 0?void 0:V.skill_or_workflow_name)||"",workflow_run_id:(H=c(p.toolId))===null||H===void 0?void 0:H.workflow_run_id,workflow_confirmation_status:(be=c(p.toolId))===null||be===void 0?void 0:be.workflow_confirmation_status,args:((G=c(p.toolId))===null||G===void 0?void 0:G.args)||{},result:(k=c(p.toolId))===null||k===void 0?void 0:k.result},intl:u,runtimeData:c(p.toolId),updateMCPTool:g,setInstruction:_})},"content-block-".concat(I))})}):b.hasMCPTools?(0,t.jsx)("div",{children:b.blocks.map(function(p,I){return(0,t.jsx)("div",{children:p.type==="text"?(0,t.jsx)(Fe.U,{rehypePlugins:[Ke.Z],components:ct(o,u),children:p.content}):p.toolData&&(0,t.jsx)(Dt,{toolData:p.toolData,intl:u,runtimeData:c?c(p.toolData.id):null,updateMCPTool:g,setInstruction:_})},I)})}):(0,t.jsx)(Fe.U,{rehypePlugins:[Ke.Z],components:ct(o,u),children:a}),e.isCurrentMessage&&!y&&(j==null||(n=j.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:j.activeMCPTools.map(function(p){return c?c(p):null}).filter(Boolean).map(function(p){return(0,t.jsx)(Dt,{toolData:{name:p.name,skill_or_workflow_name:p.skill_or_workflow_name,workflow_run_id:p.workflow_run_id,workflow_confirmation_status:p.workflow_confirmation_status,args:p.args,result:p.result,id:p.id},intl:u,runtimeData:p,updateMCPTool:g,setInstruction:_},"current-tool-".concat(p.id))})})]})},ln=(0,x.memo)(function(i){var e=i.messageApi,n=i.index,a=i.idName,r=i.cidName,o=(0,N.useIntl)(),u=(0,x.useState)(!1),l=L()(u,2),d=l[0],m=l[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){m(!0)},onMouseLeave:function(){m(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var g=xe()(me()().mark(function c(_){var j,y,b;return me()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return j=_.target.closest("#".concat(a).concat(n)),y=j.querySelector("#".concat(r).concat(n)),I.prev=2,I.next=5,We(y.innerText);case 5:b=I.sent,b?e.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),I.next=13;break;case 9:I.prev=9,I.t0=I.catch(2),console.error("Failed to copy text: ",I.t0),e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return I.stop()}},c,null,[[2,9]])}));return function(c){return g.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(d?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(d?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),un=s(2068),cn=function(e){var n=e.id,a=e.index,r=e.idName,o=e.cidName,u=(0,N.useIntl)(),l=(0,U.Z)(function(y){return y.setSummaryClick}),d=(0,x.useState)(!0),m=L()(d,2),g=m[0],c=m[1],_=(0,U.Z)(function(y){return y.summaryClick});(0,x.useEffect)(function(){c(_)},[_]);var j=(0,U.Z)(function(y){return y.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(g?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(b){if(g){var p=b.target.closest("#".concat(r).concat(a)),I=p.querySelector("#".concat(o).concat(a));j({id:n,message:I.innerText}),l(!1)}},children:[(0,t.jsx)(un.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:u.formatMessage({id:"app.chatroom.content.summary"})})]})})},dn=function(e){var n=e.messageApi,a=e.index,r=e.idName,o=e.cidName,u=e.id,l=e.agentChatRoomId,d=e.isAgent;return d?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(ln,{messageApi:n,index:a,idName:r,cidName:o}),!l&&(0,t.jsx)(cn,{id:u,index:a,idName:r,cidName:o})]}):null},Ht=function(e){var n,a=e.item,r=e.index,o=e.agentChatRoomId,u=e.abilitiesList,l=e.messageApi,d=e.id,m=e.idName,g=e.cidName,c=e.mcpTools,_=e.updateMCPTool,j=e.getMCPTool,y=e.setInstruction,b=(0,N.useIntl)(),p=a.is_agent===1;return _e(a)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(p?"":"flex-row-reverse"),children:[p?(0,t.jsx)(Ge.Z,{data:a}):(0,t.jsx)(Ge.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(m).concat(r),children:[(0,t.jsxs)("div",{className:"".concat(p?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,Je.Qy)("GET").nickname,a.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(u==null||(n=u.find(function(I){return a.ability_id==I.value}))===null||n===void 0?void 0:n.label)||b.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(p?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Zt,{content:a.content,fileList:a.file_list,index:r,intl:b,isAgent:p,contentId:"".concat(g).concat(r),mcpTools:c,updateMCPTool:_,getMCPTool:j,item:a,setInstruction:y})}),(0,t.jsx)(dn,{messageApi:l,index:r,idName:m,cidName:g,id:d,agentChatRoomId:o,isAgent:p})]})]}):null},mn=s(47635),fn=function(e,n,a,r,o,u,l,d,m,g,c,_,j,y,b,p,I){var P=(0,N.useIntl)(),V=(0,U.Z)(function(S){return S.setTruncatable}),H=function(f){try{var v=JSON.parse(f.slice(22,-2));return Array.isArray(v)&&v.length>=2?[v[0],v[1]]:null}catch(C){return console.warn("Failed to parse instruction:",C),null}},be=function(f){return f.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},G=function(f){return!f||!f.input_variables?!1:Object.values(f.input_variables).some(function(v){return v==="need_upload"})},k=function(f){m(function(v){var C=v.contentBlocks||[],h=f(C);return M()(M()({},v),{},{contentBlocks:h})})},Ie=function(f){k(function(v){var C=v[v.length-1];return C&&C.type==="text"?v.map(function(h,T){return T===v.length-1?M()(M()({},h),{},{content:(h.content||"")+f}):h}):[].concat(q()(v),[{type:"text",content:f,timestamp:Date.now()}])})},ce=function(f){k(function(v){return[].concat(q()(v),[{type:"mcp",toolId:f,timestamp:Date.now()}])})},et=function(f){return!(f!=null&&f.blocks)||!Array.isArray(f.blocks)?[]:f.blocks.map(function(v){var C;return v.type==="text"?{type:"text",content:v.content||"",timestamp:Date.now()}:v.type==="mcp-tool"&&(C=v.toolData)!==null&&C!==void 0&&C.id?{type:"mcp",toolId:v.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},Ze=function(f){return f.filter(function(v){return v.type==="mcp"&&v.toolId}).map(function(v){return v.toolId})},je=function(f,v){j&&j(f,v),_.current&&Object.keys(g).length>0&&m(function(C){var h=C.activeMCPTools||[],T=h.includes(f)?h:[].concat(q()(h),[f]);return M()(M()({},C),{},{activeMCPTools:T})})},we=function(f,v,C){try{if(!f||!Array.isArray(f))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!C)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),f;var h=f.filter(function(Y){return Y.type==="mcp"&&Y.toolId}).map(function(Y){return Y.toolId}),T=v.filter(function(Y){return!h.includes(Y)}),$=T.map(function(Y){return{type:"mcp",toolId:Y,timestamp:Date.now()}});return[].concat(q()(f),q()($))}catch(Y){return console.error("Failed to sync MCP tool states to contentBlocks:",Y),f}},ve={ERROR:function(f){e(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(f),duration:10})},CHAT:function(f){if(Object.keys(g).length&&_e(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var v,C,h=M()({},g);if(((v=h.activeMCPTools)===null||v===void 0?void 0:v.length)>0||((C=h.contentBlocks)===null||C===void 0?void 0:C.length)>0){var T=we(h.contentBlocks||[],h.activeMCPTools||[],p);if(p&&T.length>0){var $=yt(T,p);$?(h.content=$,h.parsedContent=ye($)):h.content&&(h.parsedContent=ye(h.content))}else h.content&&(h.parsedContent=ye(h.content));h.contentBlocks=T}else h.content&&(h.parsedContent=ye(h.content));o(function(Pe){return Pe.concat(h)}),m({})}var Y={content:"".concat(f),is_agent:0};o(function(Pe){return Pe.concat(Y)}),b&&b(!0),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(f){o(function(v){if(v.length===0)return v;var C=v.length-1;return v.map(function(h,T){return T===C?M()(M()({},h),{},{file_list:f}):h})}),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(f){n(f)},TRUNCATABLE:function(f){V(f),f||r.open({type:"success",content:"".concat(P.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(f){r.open({type:"success",content:"".concat(P.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(f){var v=f.id,C=f.name,h=f.skill_or_workflow_name,T=f.args,$=f.files_to_upload,Y=h&&h.toLowerCase().includes("workflow"),Pe=$&&Array.isArray($)&&$.length>0,he=Pe||G(T),K=he?D.WAITING_FILE_UPLOAD:D.RUNNING;je(v,{name:C,skill_or_workflow_name:h||C,args:T,status:K,isWorkflow:Y,files_to_upload:$||[],uploaded_files:[]}),ce(v)},WITHMCPTOOLRESULT:function(f){var v=f.id,C=f.result,h=D.COMPLETED;if(typeof C=="string")try{var T=JSON.parse(C);T.status==="failed"&&(h=D.FAILED)}catch($){}else re()(C)==="object"&&(C==null?void 0:C.status)==="failed"&&(h=D.FAILED);je(v,{result:C,status:h})},WITHWFSTATUS:function(f){var v=f.id,C=f.status,h={id:C.id,status:C.status,app_run_id:C.app_run_id,node_exec_id:C.node_exec_id,workflow_name:C.workflow_name,need_user_confirm:C.need_user_confirm,show_todo_button:C.show_todo_button,confirmer_name:C.confirmer_name},T;switch(C.status){case"running":T=D.RUNNING;break;case"waiting_confirm":T=D.WAITING_CONFIRMATION;break;case"completed":T=D.COMPLETED;break;case"failed":T=D.FAILED;break;default:T=D.RUNNING;break}je(v,{workflow_confirmation:h,status:T,isWorkflow:!0})},WITHMCPTOOLFILES:function(f){var v=f.id,C=f.files_to_upload;je(v,{uploaded_files:C||[],status:D.COMPLETED})}},de=function(f,v){ve[f]=v},tt=function(f){var v=f.data,C=H(v),h=be(v),T=v.indexOf("REPLY")!==-1&&v.indexOf("ENDREPLY")===-1,$=v.indexOf("ABILITY")!==-1,Y=v.indexOf("ENDCHAT")!==-1;if(h){if(!C)return;var Pe=C[0],he=C[1],K=ve[Pe];K?K(he):console.warn("Unknown message type: ".concat(Pe))}if(h||console.log(_.current,f),!h&&_.current&&(c.current+=v,requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")}),m(function(ge){var Qe=c.current,W=M()(M()({},ge),{},{content:Qe});return Qe&&(W.parsedContent=ye(Qe)),W}),Ie(v)),T&&h){var O=C[1];b&&b(!1);var Q=d.current.filter(function(ge){return ge.agent_id==O})[0];o(function(ge){var Qe=ge;if(Object.keys(g).length&&_e(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var W,mt,ue=M()({},g);if(((W=ue.activeMCPTools)===null||W===void 0?void 0:W.length)>0||((mt=ue.contentBlocks)===null||mt===void 0?void 0:mt.length)>0){var ht=we(ue.contentBlocks||[],ue.activeMCPTools||[],p);if(p&&ht.length>0){var Ot=yt(ht,p);Ot?(ue.content=Ot,ue.parsedContent=ye(Ot)):ue.content&&(ue.parsedContent=ye(ue.content))}else ue.content&&(ue.parsedContent=ye(ue.content));ue.contentBlocks=ht}else ue.content&&(ue.parsedContent=ye(ue.content));Qe=ge.concat(ue)}return c.current="",m({is_agent:1,icon:Q==null?void 0:Q.icon,name:Q==null?void 0:Q.name,content:"",activeMCPTools:[],agent_id:O,parsedContent:null,contentBlocks:[]}),_.current=!0,n(!0),V(!1),Qe})}if($&&h){var Le=C[1];m(function(ge){return M()(M()({},ge),{},{is_agent:1,ability_id:Le})})}if(Y){if(_.current=!1,c.current="",e(!1),n(!1),V(!0),Object.keys(g).length){var J,B,E=M()({},g);if(((J=E.activeMCPTools)===null||J===void 0?void 0:J.length)>0||((B=E.contentBlocks)===null||B===void 0?void 0:B.length)>0){var Te=we(E.contentBlocks||[],E.activeMCPTools||[],p);if(p&&Te.length>0){var Ee=yt(Te,p);Ee?(E.content=Ee,E.parsedContent=ye(Ee)):E.content&&(E.parsedContent=ye(E.content))}else E.content&&(E.parsedContent=ye(E.content));E.contentBlocks=Te}else E.content&&(E.parsedContent=ye(E.content));console.log(E),o(function(ge){return ge.concat(E)})}m({}),a("")}};return{getSocketMessage:tt,addMessageHandler:de}},pn=function(e){var n=e.currentMessage,a=e.agentChatRoomId,r=e.intl,o=e.mcpTools,u=o===void 0?{}:o,l=e.updateMCPTool,d=l===void 0?function(){}:l,m=e.getMCPTool,g=m===void 0?function(){return null}:m,c=e.setInstruction;return!n.name||!_e(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(Ge.Z,{data:n}):(0,t.jsx)(Ge.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,Je.Qy)("GET").nickname}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Zt,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:u,updateMCPTool:d,getMCPTool:g,setInstruction:c,item:M()(M()({},n),{},{parsedContent:ye(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},vn=(0,x.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,d=i.setisEnd,m=i.setSendValue,g=i.agentChatRoomId,c=i.updateMCPTool,_=i.getCurrentMessageList,j=i.mcpTools,y=j===void 0?{}:j,b=i.getMCPTool,p=b===void 0?function(){return null}:b,I=i.setIsWaitingReply,P=i.removeHistoryMessage,V=i.setCurrentMessageFromHistory,H=i.setInstruction,be=(0,N.useIntl)(),G=(0,N.useParams)(),k=G.id,Ie=(0,N.useLocation)(),ce=new URLSearchParams(Ie.search),et=ce.get("id"),Ze=g||k||et,je=(0,U.Z)(function(he){return he.setDisableInput}),we=(0,x.useState)({}),ve=L()(we,2),de=ve[0],tt=ve[1],S=(0,x.useRef)(!1),f=(0,x.useRef)(""),v=(0,x.useCallback)(function(he){try{if(!he||re()(he)!=="object"){console.warn("Invalid history message provided:",he);return}if(he.is_agent!==1){console.warn("Attempted to set non-agent message as current:",he);return}var K=ut(he,p);if(!K){console.warn("Failed to prepare history message:",he);return}tt(K),S.current=!0,f.current=K.content||""}catch(O){console.error("Failed to set current message from history:",O)}},[p]);(0,x.useEffect)(function(){V&&V(v)},[V,v]);var C=fn(je,l,m,e,n,o,u,r,tt,de,f,S,c,_,I,p,P),h=C.getSocketMessage,T=(0,mn.Z)("chat",h),$=T.runSocket,Y=T.sendMessage,Pe=T.readyState;return(0,x.useEffect)(function(){Pe==1&&Ze&&Y(JSON.stringify(["ENTER",parseInt(Ze)]))},[Pe]),(0,x.useEffect)(function(){a&&Pe==1&&Y(a)},[a]),(0,x.useEffect)(function(){$()},[]),(0,t.jsx)(pn,{currentMessage:de,agentChatRoomId:g,intl:be,mcpTools:y,updateMCPTool:c,getMCPTool:p,setInstruction:H})}),hn=function(e){var n=e.type,a=n===void 0?"typing":n,r=e.size,o=r===void 0?"medium":r;if(a==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var u={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,d){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:M()(M()({},u),{},{animationDelay:"".concat(l,"s")})},d)})})]})}return a==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},gn=function(e){var n=e.autoRotate,a=n===void 0?!1:n,r=e.rotateInterval,o=r===void 0?3e3:r,u=e.initialType,l=u===void 0?"wave":u,d=e.size,m=d===void 0?"medium":d,g=(0,x.useState)(l),c=L()(g,2),_=c[0],j=c[1],y=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(hn,{type:_,size:m})})},xn=function(e){var n=e.isVisible,a=e.animationType,r=a===void 0?"pulse":a,o=e.enableAutoRotate,u=o===void 0?!0:o,l=(0,N.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(gn,{initialType:r,autoRotate:u,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},_n=(0,x.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,d=i.setSendValue,m=i.agentChatRoomId,g=i.abilitiesList,c=i.mcpTools,_=i.updateMCPTool,j=i.getMCPTool,y=i.setInstruction,b=i.userMessage,p=(0,x.useState)([]),I=L()(p,2),P=I[0],V=I[1],H=(0,x.useState)(!1),be=L()(H,2),G=be[0],k=be[1],Ie=(0,x.useState)(!1),ce=L()(Ie,2),et=ce[0],Ze=ce[1],je=(0,x.useRef)(!1),we=(0,x.useRef)(null),ve=(0,N.useParams)(),de=ve.id,tt=(0,N.useLocation)(),S=new URLSearchParams(tt.search),f=S.get("id"),v=de||f;(0,x.useEffect)(function(){G&&(n(function(h){return[].concat(q()(P.reverse()),q()(h))}),V([]),setTimeout(function(){k(!1),o.current.scrollTop=0},200))},[G]),(0,x.useEffect)(function(){if(!je.current&&!(!b||!Array.isArray(b)||b.length===0)){if(!we.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var h=lt(b);if(h){if(!h.id){console.warn("Found agent message without ID, skipping:",h),je.current=!0;return}if(we.current(h),n){var T=b.filter(function($){return $!==h});n(T)}else console.warn("setUserMessage not available for history update");je.current=!0}}catch($){console.error("Failed to process history message:",$,{userMessageLength:b==null?void 0:b.length,hasCallback:!!we.current}),je.current=!0}}},[b,n]),(0,x.useEffect)(function(){je.current=!1},[v]);var C=function(T){if(n&&b){var $=b.filter(function(Y){return Y!==T});n($)}};return(0,t.jsxs)(t.Fragment,{children:[P.length?P.map(function(h,T){return(0,t.jsx)(Ht,{item:h,index:T,agentChatRoomId:m,abilitiesList:g,messageApi:e,id:v,idName:"currentContent",cidName:"currentChilContent",mcpTools:c,updateMCPTool:_,getMCPTool:j},T)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(xn,{isVisible:et}),(0,t.jsx)(vn,{messageApi:e,setCurrentMessageContent:V,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:u,setIsStop:l,setisEnd:k,setSendValue:d,agentChatRoomId:m,updateMCPTool:_,getCurrentMessageList:function(){return b||[]},mcpTools:c,getMCPTool:j,setIsWaitingReply:Ze,removeHistoryMessage:C,setCurrentMessageFromHistory:function(T){we.current=T},setInstruction:y})]})}),yn=(0,x.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,a=i.instruction,r=i.setIsStop,o=i.upButtonDom,u=i.setInstruction,l=i.agentList,d=i.agentChatRoomId,m=i.abilitiesList,g=(0,N.useIntl)(),c=(0,x.useState)(860),_=L()(c,2),j=_[0],y=_[1],b=(0,N.useParams)(),p=b.id,I=(0,N.useLocation)(),P=new URLSearchParams(I.search),V=P.get("id"),H=d||p||V,be=(0,x.useState)([]),G=L()(be,2),k=G[0],Ie=G[1],ce=(0,x.useRef)(!1),et=(0,x.useState)(""),Ze=L()(et,2),je=Ze[0],we=Ze[1],ve=(0,x.useRef)(null),de=(0,x.useRef)(!0),tt=(0,x.useState)({}),S=L()(tt,2),f=S[0],v=S[1],C=(0,x.useRef)(2),h=(0,x.useRef)(1),T=(0,x.useRef)(0),$=function(B,E){v(function(Te){var Ee=Te[B];return Ee?M()(M()({},Te),{},Z()({},B,M()(M()({},Ee),E))):M()(M()({},Te),{},Z()({},B,M()({id:B,status:D.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},E)))})},Y=function(B){return f[B]||null},Pe=function(B){var E=B.map(function(Te){var Ee=M()({},Te);if(Te.is_agent===1&&Te.content){var ge=ye(Te.content);Ee.parsedContent=ge,ge.hasMCPTools&&ge.blocks.forEach(function(Qe){if(Qe.type==="mcp-tool"&&Qe.toolData){var W=Qe.toolData;if(!f[W.id]){var mt=kt(W.workflow_confirmation_status,W.result);v(function(ue){return M()(M()({},ue),{},Z()({},W.id,{id:W.id,name:W.name,skill_or_workflow_name:W.skill_or_workflow_name||W.name,workflow_run_id:W.workflow_run_id||0,workflow_confirmation_status:W.workflow_confirmation_status||null,args:W.args||{},result:W.result||null,status:mt,isWorkflow:W.skill_or_workflow_name?W.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:W.files_to_upload||[],uploaded_files:_t(W)}))})}}})}return Ee});return E},he=function(){var J=xe()(me()().mark(function B(E){var Te,Ee,ge=arguments;return me()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(Te=ge.length>1&&ge[1]!==void 0?ge[1]:function(){},!H){W.next=6;break}return W.next=4,(0,A.KH)(H,{page:h.current,page_size:10});case 4:Ee=W.sent,Ee.code==0&&(C.current=Ee.data.total_pages,E||(ve.current.style.display="none"),Ie(function(mt){var ue=Ee.data.list.reverse(),ht=Pe(ue);return E?q()(ht):[].concat(q()(mt),q()(ht))}),E?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):T.current=Ee.data.list.length,de.current=!0);case 6:case"end":return W.stop()}},B)}));return function(E){return J.apply(this,arguments)}}(),K=function(B){var E=B.target.scrollHeight+(B.target.scrollTop-B.target.clientHeight);ce.current!==Math.ceil(B.target.scrollTop)<-50&&(ce.current=Math.ceil(B.target.scrollTop)<-50,o.current.style.display=ce.current?"flex":"none"),E<10&&de.current&&(de.current=!1,h.current=h.current+1,ve.current.style.display="flex",C.current>=h.current?he(!1):ve.current.style.display="none")},O=function(B,E){E==="0"&&(E=Number(E));var Te=["".concat(B),E!==""&&E!==null&&E!==void 0?E:null];we(JSON.stringify(Te))},Q=(0,U.Z)(function(J){return J.disableInput}),Le=(0,U.Z)(function(J){return J.clearMemory});return(0,x.useEffect)(function(){Le&&Le.length&&O(Le[0],Le[1])},[Le]),(0,x.useEffect)(function(){a&&a.length&&(O(a[0],a[1]!==void 0?a[1]:""),u([]))},[a]),(0,x.useEffect)(function(){h.current=1,he(!0)},[]),(0,x.useEffect)(function(){var J=function(){window.innerWidth<1280||y(window.innerWidth-320-(window.innerWidth-320)/2-88)};return J(),window.addEventListener("resize",J),function(){window.removeEventListener("resize",J)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:K,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:d?"":"".concat(j,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:k&&k.length?k.map(function(J,B){return(0,t.jsx)(Ht,{item:M()(M()({},J),{},{id:"c".concat(J.id)}),index:B,agentChatRoomId:d,abilitiesList:m,messageApi:e,id:H,idName:"content",cidName:"chilContent",mcpTools:f,updateMCPTool:$,getMCPTool:Y},B)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(_n,{messageApi:e,setUserMessage:Ie,sendValue:je,agentList:l,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:we,agentChatRoomId:d,abilitiesList:m,mcpTools:f,updateMCPTool:$,getMCPTool:Y,userMessage:k,setInstruction:u})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!d&&!Q&&k.length?(0,t.jsx)(it,{roomid:H}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:ve,children:(0,t.jsx)(ie.Z,{})})]})})}),Cn=function(e){var n=(0,x.useRef)(null),a=(0,x.useRef)(null),r=(0,x.useState)(!1),o=L()(r,2),u=o[0],l=o[1],d=(0,x.useState)([]),m=L()(d,2),g=m[0],c=m[1],_=(0,N.useParams)(),j=_.id,y=(0,N.useLocation)(),b=new URLSearchParams(y.search),p=b.get("id"),I=e||j||p;return{scrollDomRef:n,upButtonDom:a,isStop:u,setIsStop:l,instruction:g,setInstruction:c,id:I}},Mn=s(82114),bn=s(77171),In=s(85576),Gt=s(96486),jn=s(58299),Pn=s(38008),Tn=s(83062),Nn=function(e){var n=e.uploadedFiles,a=e.handleRemoveFile;return n.length?(0,t.jsx)(ze.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,t.jsx)(At.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Tn.Z,{title:r.name,children:(0,t.jsx)("div",{className:"flex items-center",children:r.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(ze.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(De.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),rt(r.path_show||r.url,r.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(ke.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(De.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),rt(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},wn=s(52645),En=s(64317),An=function(e){var n=e.agentChatRoomId,a=e.abilitiesList,r=e.abilityId,o=e.setAbilityId,u=e.clearContext,l=(0,N.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,t.jsx)(En.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(m){o(m)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(ne.ZP,{size:"small",color:"danger",variant:"outlined",onClick:u,icon:(0,t.jsx)(wn.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},Fn=s(88484),Dn=s(30159),On=s(26915),Sn=On.Z.TextArea,Ln=function(e){var n=e.userSendvalue,a=e.setUserSendvalue,r=e.disableInput,o=e.isUploading,u=e.isStop,l=e.userSendmessage,d=e.handleFileUpload,m=e.sendMessage,g=e.stopChatRoom,c=(0,N.useIntl)(),_=(0,Gt.throttle)(function(){if(r||!n)return!1;m(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(ne.ZP,{type:"text",icon:(0,t.jsx)(Fn.Z,{}),onClick:d,disabled:r||o,loading:o}),(0,t.jsx)(Sn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(y){a(y.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(c.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:g,children:(0,t.jsx)(Dn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:_,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Un=(0,x.memo)(function(i){var e,n=i.setInstruction,a=i.messageApi,r=i.isStop,o=i.scrollDomRef,u=i.upButtonDom,l=i.agentList,d=i.abilitiesList,m=i.agentChatRoomId,g=i.chatStatus,c=(0,N.useIntl)(),_=(0,U.Z)(function(K){return K.disableInput}),j=(0,U.Z)(function(K){return K.setDisableInput}),y=(0,U.Z)(function(K){return K.setClearMemory}),b=(0,jn.m)(),p=b.options,I=m?(0,Pn.Zc)().isImageSupportModel:function(){return!1},P=(0,x.useState)(null),V=L()(P,2),H=V[0],be=V[1],G=(0,x.useState)(""),k=L()(G,2),Ie=k[0],ce=k[1],et=(0,x.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),Ze=L()(et,2),je=Ze[0],we=Ze[1],ve=(0,F.ZP)({maxSizeMB:15,acceptedFileTypes:je,multiple:!0}),de=ve.uploadedFiles,tt=ve.handleUpload,S=ve.removeFile,f=ve.clearFiles,v=ve.isUploading;(0,x.useEffect)(function(){var K,O;if(m&&(l==null||(K=l.current)===null||K===void 0?void 0:K.length)>0&&l!==null&&l!==void 0&&(O=l.current[0])!==null&&O!==void 0&&(O=O.agent)!==null&&O!==void 0&&O.m_config_id){var Q,Le=l==null||(Q=l.current[0])===null||Q===void 0||(Q=Q.agent)===null||Q===void 0?void 0:Q.m_config_id,J=I(Le),B=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(J?",.jpg,.png,.jpeg":"");we(B)}},[l,p,l==null||(e=l.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,I]);var C=function(){var O=In.Z.confirm;O({title:c.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(Mn.Z,{}),content:c.formatMessage({id:"app.chatroom.clear.tips"}),okText:c.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:c.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){y(["TRUNCATE","0"])}})},h=function K(O,Q){if(O.length===0){Q&&Q();return}var Le=jt()(O),J=Le[0],B=Le.slice(1);n(J),setTimeout(function(){K(B,Q)},100)},T=function(O){var Q=[];(de==null?void 0:de.length)>0&&Q.push(["FILELIST",de.map(function(J){return J.file_id})]);var Le=H||0;Q.push(["SETABILITY",Le]),Q.push(["INPUT",O]),h(Q,function(){(de==null?void 0:de.length)>0&&f()})},$=function(O){!O.shiftKey&&O.target.value==""&&(a.open({type:"warning",content:c.formatMessage({id:"app.chatroom.content.input"}),duration:10}),ce(""),O.preventDefault()),!O.shiftKey&&O.keyCode==13&&O.target.value!=""&&(j(!0),ce(""),T(O.target.value),O.preventDefault())},Y=(0,Gt.throttle)(function(){n(["STOP",null])},300),Pe=function(){_||tt()},he=function(O){if(!O){a.open({type:"warning",content:c.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}j(!0),T(O),ce("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:u,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(O){o.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(bn.Z,{className:"text-[16px]"})}),(0,t.jsx)(Nn,{uploadedFiles:de,handleRemoveFile:S}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(de.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(An,{agentChatRoomId:m,abilitiesList:d,abilityId:H,setAbilityId:be,clearContext:C}),(0,t.jsx)(Ln,{userSendvalue:Ie,setUserSendvalue:ce,disableInput:_,isUploading:v,isStop:r,userSendmessage:$,handleFileUpload:Pe,sendMessage:he,stopChatRoom:Y})]})]})}),Rn=(0,x.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,a=i.abilitiesList,r=i.chatStatus,o=Cn(n),u=o.scrollDomRef,l=o.upButtonDom,d=o.isStop,m=o.setIsStop,g=o.instruction,c=o.setInstruction;(0,x.useEffect)(function(){console.log(r),r==1&&m(!0)},[r]);var _=Ne.ZP.useMessage(),j=L()(_,2),y=j[0],b=j[1];return(0,t.jsxs)(t.Fragment,{children:[b,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(yn,{instruction:g,setInstruction:c,messageApi:y,scrollDomRef:u,setIsStop:m,upButtonDom:l,agentList:e,agentChatRoomId:n,abilitiesList:a}),(0,t.jsx)(Un,{setInstruction:c,messageApi:y,isStop:d,upButtonDom:l,scrollDomRef:u,agentList:e,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})})},85877:function(gt,He,s){var Ue=s(19632),L=s.n(Ue),Ne=s(97857),X=s.n(Ne),x=s(5574),oe=s.n(x),me=s(52677),Re=s.n(me),q=s(35312),Ae=s(78234),xe=s(77598),Be=s(96486),Z=s.n(Be),ee=s(67294),M=s(73935),A=s(43413),U=s(92858),N=s(16845),ie=s(15425),te=s(85893),t=function(F){var R=F.children;return(typeof document=="undefined"?"undefined":Re()(document))==="object"?M.createPortal(R,document.body):null},it=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ge=function(F){var R=F.value,pe=F.onChange,Me=F.id,fe=F.placeholder,le=F.options,We=(0,q.useIntl)(),Xe=(0,ee.useRef)(),xt=(0,ee.useState)(),nt=oe()(xt,2),Oe=nt[0],re=nt[1],rt=(0,ee.useState)(0),at=oe()(rt,2),Se=at[0],_e=at[1],ft=(0,ee.useState)(""),lt=oe()(ft,2),pt=lt[0],$e=lt[1],ut=(0,ee.useCallback)(function(w){return(0,te.jsx)(ze,X()({},w))},[]),vt=(0,ee.useCallback)(function(w){return(0,te.jsx)(Ke,X()({},w))},[]),se=(0,ee.useMemo)(function(){return Je((0,N.BU)((0,U.VC)((0,A.Jh)())))},[]),ct=(0,ee.useState)(null),z=oe()(ct,2),Ve=z[0],Tt=z[1],St=(0,ie.Z)(function(w){return w.selectedNode}),ye=(0,ie.Z)(function(w){return w.getOutputVariables}),Kt=(0,ie.Z)(function(w){return w.getInputVariables}),Lt=(0,ee.useState)([]),Nt=oe()(Lt,2),qe=Nt[0],bt=Nt[1];(0,Ae.Z)(function(){R&&R.length>0&&_t(R),le!=null&&le.length&&bt(le.map(function(w){return X()(X()({},w),{},{name:w.label,id:w.value})}))}),(0,xe.Z)(function(){var w=Z().isEqual(Ve,R);w||(R&&R.length>0?_t(R):R&&Z().isArray(R)&&R.length==0&&_t([{type:"paragraph",children:[]}]))},[R,Me]),(0,xe.Z)(function(){le.length&&bt(le.map(function(w){return X()(X()({},w),{},{name:w.label,id:w.value})})),console.log(le)},[le]);var _t=function(ae){Tt(ae),It(se,{nodes:[{type:"paragraph",children:[]}]}),It(se,{nodes:ae})},yt=(0,ee.useCallback)(function(w){if(Oe&&qe.length>0)switch(w.key){case"ArrowDown":w.preventDefault();var ae=Se>=qe.length-1?0:Se+1;_e(ae);return;case"ArrowUp":w.preventDefault();var Ce=Se<=0?qe.length-1:Se-1;_e(Ce);return;case"Tab":case"Enter":w.preventDefault(),A.YR.select(se,Oe),Fe(se,qe[Se]),re(null);return;case"Escape":w.preventDefault(),re(null);return}else if(w.key==="@"){setTimeout(function(){return jt()},10);return}re(null)},[qe,se,Se,Oe]),It=function(ae){var Ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ct=L()(ae.children);if(Ct.forEach(function(ot){return ae.apply({type:"remove_node",path:[0],node:ot})}),Ce.nodes){var st=A.NB.isNode(Ce.nodes)?[Ce.nodes]:Ce.nodes;st.forEach(function(ot,Mt){return ae.apply({type:"insert_node",path:[Mt],node:ot})})}var dt=Ce.at&&A.E9.isPoint(Ce.at)?Ce.at:A.ML.end(ae,[]);dt&&A.YR.select(ae,dt)};(0,ee.useEffect)(function(){if(Oe&&qe.length>0){var w=Xe.current,ae=N.F3.toDOMRange(se,Oe),Ce=ae.getBoundingClientRect();w.style.top="".concat(Ce.top+window.pageYOffset+24,"px"),w.style.left="".concat(Ce.left+window.pageXOffset,"px")}},[qe.length,se,Se,pt,Oe]);var jt=function(){var ae=se.selection;if(ae&&A.e6.isCollapsed(ae)){var Ce=A.e6.edges(ae),Ct=oe()(Ce,1),st=Ct[0],dt=A.ML.before(se,st),ot=dt&&A.ML.range(se,dt,st),Mt=ot&&A.ML.string(se,ot),wt=A.ML.after(se,st),Et=A.ML.range(se,st,wt),Ut=A.ML.string(se,Et);re(ot),$e(""),_e(0);return}re(null)};return(0,te.jsxs)(N.mH,{editor:se,initialValue:De,onChange:function(ae){pe==null||pe(ae),re(null)},children:[(0,te.jsx)(N.CX,{renderElement:ut,renderLeaf:vt,onKeyDown:yt,className:"!outline-none",placeholder:fe!=null?fe:We.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),Oe&&(0,te.jsx)(t,{children:(0,te.jsx)("div",{ref:Xe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:qe.length?qe.map(function(w,ae){return(0,te.jsx)("div",{onClick:function(){console.log(w),A.YR.select(se,Oe),Fe(se,w),re(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:ae===Se?"#B4D5FF":""},children:(0,te.jsx)("span",{children:w.name})},w.name+ae)}):(0,te.jsx)(te.Fragment,{children:We.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Je=function(F){var R=F.isInline,pe=F.isVoid,Me=F.markableVoid;return F.isInline=function(fe){return fe.type==="mention"?!0:R(fe)},F.isVoid=function(fe){return fe.type==="mention"?!0:pe(fe)},F.markableVoid=function(fe){return fe.type==="mention"||Me(fe)},F},Fe=function(F,R){var pe={type:"mention",id:(R==null?void 0:R.id)||"",character:R.name,base:R,children:[{bold:!0,text:"11111"}]};A.YR.insertNodes(F,pe),A.YR.move(F)},Ke=function(F){var R=F.attributes,pe=F.children,Me=F.leaf;return(0,te.jsx)("span",X()(X()({},R),{},{children:pe}))},ze=function(F){var R=F.attributes,pe=F.children,Me=F.element;switch(Me.type){case"mention":return(0,te.jsx)(ne,X()({},F));default:return(0,te.jsx)("p",X()(X()({},R),{},{children:pe}))}},ne=function(F){var R=F.attributes,pe=F.children,Me=F.element,fe=(0,N.vt)(),le=(0,N.UE)(),We={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:fe&&le?"0 0 0 2px #B4D5FF":"none"};return Me.children[0].bold&&(We.fontWeight="bold"),Me.children[0].italic&&(We.fontStyle="italic"),(0,te.jsx)("span",X()(X()({},R),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(Me.character.replace(" ","-")),style:We,children:it?(0,te.jsxs)(ee.Fragment,{children:["1",pe,"/",Me.character]}):(0,te.jsxs)(ee.Fragment,{children:[(0,te.jsx)("span",{children:Me.character}),pe]})}))},De=[{type:"paragraph",children:[{text:""}]}];He.Z=Ge},38008:function(gt,He,s){s.d(He,{Zc:function(){return me},aS:function(){return oe}});var Ue=s(67294),L=s(85750),Ne=s(58299),X=s(85893),x=(0,Ue.createContext)(void 0),oe=function(Ae){var xe=Ae.children,Be=(0,Ne.m)(),Z=Be.options,ee=(0,Ue.useMemo)(function(){var M=function(N){if(!N||!Z)return!1;var ie=(0,L.ti)(N,{options:Z});return(ie==null?void 0:ie.support_image)===1},A=function(N){return M(N)};return{isImageSupportModel:M,getCurrentModelImageSupport:A}},[Z]);return(0,X.jsx)(x.Provider,{value:ee,children:xe})},me=function(){var Ae=(0,Ue.useContext)(x);if(Ae===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return Ae},Re=null},77295:function(gt,He,s){s.d(He,{CO:function(){return Z}});var Ue=s(15009),L=s.n(Ue),Ne=s(19632),X=s.n(Ne),x=s(99289),oe=s.n(x),me=s(5574),Re=s.n(me),q=s(45360),Ae=s(35312),xe=s(67294),Be=s(83065),Z=function(A){var U,N=A==null||(U=A.split(".").pop())===null||U===void 0?void 0:U.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(N||"")},ee=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=(0,Ae.useIntl)(),N=(0,xe.useState)([]),ie=Re()(N,2),te=ie[0],t=ie[1],it=(0,xe.useState)(!1),Ge=Re()(it,2),Je=Ge[0],Fe=Ge[1],Ke=A.maxSizeMB,ze=Ke===void 0?15:Ke,ne=A.acceptedFileTypes,De=ne===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":ne,ke=A.multiple,F=ke===void 0?!0:ke,R=function(){var le=document.createElement("input");le.type="file",le.accept=De,le.multiple=F,le.onchange=function(){var We=oe()(L()().mark(function Xe(xt){var nt,Oe,re,rt,at,Se,_e,ft,lt,pt,$e,ut,vt,se;return L()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(nt=xt.target,!(nt.files&&nt.files.length>0)){z.next=37;break}if(Fe(!0),Oe=Array.from(nt.files),re=Oe.filter(function(Ve){return Ve.size/1024/1024>ze}),!(re.length>0)){z.next=9;break}return q.ZP.error("".concat(re.map(function(Ve){return Ve.name}).join(", ")," ").concat(U.formatMessage({id:"workflow.uploadFileErrorText"}))),Fe(!1),z.abrupt("return");case 9:rt=[],at=0,Se=Oe;case 11:if(!(at<Se.length)){z.next=35;break}return _e=Se[at],ft=new FormData,ft.append("file",_e),z.prev=15,z.next=18,(0,Be.M$)();case 18:return lt=z.sent,z.next=21,fetch(lt,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:ft});case 21:return pt=z.sent,z.next=24,pt.json();case 24:$e=z.sent,$e.code===0?(q.ZP.success("".concat(_e.name," ").concat(U.formatMessage({id:"workflow.uploadSuccess"}))),(ut=$e.data)!==null&&ut!==void 0&&ut.file_id&&(vt=Z(_e.name),se={name:_e.name,url:$e.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:vt,file_id:$e.data.file_id,path_show:$e.data.file_url||$e.data.path_show||""},rt.push(se))):q.ZP.error("".concat(_e.name," ").concat(U.formatMessage({id:"workflow.uploadFailed"}))),z.next=32;break;case 28:z.prev=28,z.t0=z.catch(15),console.error("Upload error:",z.t0),q.ZP.error("".concat(_e.name," ").concat(U.formatMessage({id:"workflow.uploadFailed"})));case 32:at++,z.next=11;break;case 35:t(function(Ve){return[].concat(X()(Ve),rt)}),Fe(!1);case 37:case"end":return z.stop()}},Xe,null,[[15,28]])}));return function(Xe){return We.apply(this,arguments)}}(),le.click()},pe=function(le){t(function(We){return We.filter(function(Xe){return Xe.uid!==le})})},Me=function(){t([])};return{uploadedFiles:te,setUploadedFiles:t,handleUpload:R,removeFile:pe,clearFiles:Me,isUploading:Je}};He.ZP=ee},58299:function(gt,He,s){s.d(He,{m:function(){return ee}});var Ue=s(64599),L=s.n(Ue),Ne=s(97857),X=s.n(Ne),x=s(15009),oe=s.n(x),me=s(99289),Re=s.n(me),q=s(73445),Ae=s(42237),xe=s(45360),Be=s(67294),Z=(0,q.Ue)(function(M){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var A=Re()(oe()().mark(function N(){var ie;return oe()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,M({loading:!0}),t.next=4,(0,Ae.fZ)();case 4:if(ie=t.sent,ie.code!==0){t.next=9;break}M({models:Array.isArray(ie.data.data)?ie.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(ie.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),M({error:t.t0.message}),xe.ZP.error("Failed to fetch models");case 16:return t.prev=16,M({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},N,null,[[0,12,16,19]])}));function U(){return A.apply(this,arguments)}return U}()}}),ee=function(){var A=Z(function(t){return t.models}),U=Z(function(t){return t.loading}),N=Z(function(t){return t.initialized}),ie=Z(function(t){return t.fetchModels});(0,Be.useEffect)(function(){N||ie()},[N,ie]);var te=(0,Be.useMemo)(function(){var t=Array.isArray(A)?A:[],it=t.map(function(ne){return{label:ne.supplier_name,options:Array.isArray(ne.model_list)?ne.model_list.map(function(De){return X()({label:De.model_name,value:De.model_config_id},De)}):[]}}),Ge,Je=L()(t),Fe;try{for(Je.s();!(Fe=Je.n()).done;){var Ke=Fe.value;if(Array.isArray(Ke.model_list)){var ze=Ke.model_list.find(function(ne){return ne.model_default_used===1});if(ze){Ge=ze.model_config_id;break}}}}catch(ne){Je.e(ne)}finally{Je.f()}return{options:it,defaultValue:Ge}},[A]);return X()(X()({},te),{},{loading:U})}}}]);
