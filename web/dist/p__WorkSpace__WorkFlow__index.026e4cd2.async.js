"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,we,t){var Be=t(5574),H=t.n(Be),$e=t(42881),q=t(67294),ie=t(85893),h=function(C){var He=C.children,J=C.className,_=J===void 0?"":J,te=C.dragDirection,ue=te===void 0?"left":te,xe=C.minWidth,Ze=xe===void 0?115:xe,pe=C.maxWidth,F=pe===void 0?820:pe,de=C.minHeight,r=de===void 0?200:de,ae=C.maxHeight,De=ae===void 0?800:ae,Y=C.defaultWidth,Me=Y===void 0?415:Y,f=C.defaultHeight,z=f===void 0?300:f,e=C.onChange,ee=(0,q.useState)(Me),Ie=H()(ee,2),Fe=Ie[0],ye=Ie[1],Ye=(0,q.useState)(z),ce=H()(Ye,2),rt=ce[0],Xe=ce[1],it=(0,q.useCallback)(function(Ke,ze){ye(Ke),ze&&Xe(ze),e==null||e(Ke,ze)},[ye,Xe,e]),Ue=(0,$e.W)({direction:["left","right"].includes(ue)?"horizontal":"vertical",triggerDirection:ue,minWidth:Ze,maxWidth:F,minHeight:r,maxHeight:De,onResize:it}),We=Ue.triggerRef,lt=Ue.containerRef;return(0,ie.jsxs)("div",{ref:lt,style:{width:["left","right"].includes(ue)?"".concat(Fe,"px"):void 0,height:["top","bottom"].includes(ue)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(_),children:[ue==="left"&&(0,ie.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ue==="right"&&(0,ie.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ue==="top"&&(0,ie.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ue==="bottom"&&(0,ie.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),He]})};we.Z=(0,q.memo)(h)},36711:function(bt,we,t){t.r(we),t.d(we,{waitTime:function(){return pe},waitTimePromise:function(){return Ze}});var Be=t(97857),H=t.n(Be),$e=t(5574),q=t.n($e),ie=t(15009),h=t.n(ie),Je=t(99289),C=t.n(Je),He=t(42237),J=t(29608),_=t(83535),te=t(35312),ue=t(67294),xe=t(85893),Ze=function(){var F=C()(h()().mark(function de(){var r,ae=arguments;return h()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return r=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.abrupt("return",new Promise(function(Me){setTimeout(function(){Me(!0)},r)}));case 2:case"end":return Y.stop()}},de)}));return function(){return F.apply(this,arguments)}}(),pe=function(){var F=C()(h()().mark(function de(){var r,ae=arguments;return h()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return r=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.next=3,Ze(r);case 3:case"end":return Y.stop()}},de)}));return function(){return F.apply(this,arguments)}}();we.default=function(){var F=(0,te.useIntl)(),de=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:F.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ee;f==null||(ee=f.current)===null||ee===void 0||ee.submit()}}},{title:F.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:F.formatMessage({id:"workflow.created_time_des",defaultMessage:F.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:F.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ee;f==null||(ee=f.current)===null||ee===void 0||ee.submit()}},valueEnum:{1:{text:F.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:F.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:F.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(F.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:F.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:F.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],r=(0,te.useSearchParams)(),ae=q()(r,1),De=ae[0],Y=(0,J.Z)(function(z){return z.setRunPanelLogRecord}),Me=De.get("app_id"),f=(0,ue.useRef)(null);return(0,xe.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,xe.jsx)("div",{children:(0,xe.jsx)(_.Z,{columns:de,formRef:f,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var z=C()(h()().mark(function e(ee,Ie,Fe){var ye;return h()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return console.log(ee,Ie,Fe),ce.next=3,(0,He.bB)(H()(H()({app_runs_name:"",app_runs_status:0},ee),{},{app_id:Me}));case 3:return ye=ce.sent,console.log(ye),ce.abrupt("return",{data:ye.data.list,success:!0,total:ye.data.total_count});case 6:case"end":return ce.stop()}},e)}));return function(e,ee,Ie){return z.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),Y(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:F.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(bt,we,t){t.r(we),t.d(we,{default:function(){return wa}});var Be=t(15009),H=t.n(Be),$e=t(99289),q=t.n($e),ie=t(97857),h=t.n(ie),Je=t(5574),C=t.n(Je),He=t(32060),J=t(42237),_=t(35312),te=t(63648),ue=t(16091),xe=t(13118),Ze=t(78234),pe=t(77598),F=t(45360),de=t(85576),r=t(67294),ae=t(64599),De=t.n(ae),Y=t(7493),Me=t(34559),f=t(15425),z=t(96906),e=t(85893),ee=function(o){return{nodes:o.nodes,edges:o.edges,onNodesChange:o.onNodesChange,onEdgesChange:o.onEdgesChange,onConnect:o.onConnect,nodeTypes:o.nodeTypes,connectionLineStyle:o.connectionLineStyle,defaultViewport:o.defaultViewport,onDrop:o.onDrop,onDragOver:o.onDragOver,setSelect:o.setSelect,preventScrolling:o.preventScrolling}},Ie=(0,r.memo)(function(i){var o=i.children,d=(0,_.useIntl)(),v=(0,f.Z)(function(c){return c.nodes}),x=(0,f.Z)(function(c){return c.getEdges}),l=(0,f.Z)(function(c){return c.edges}),D=(0,f.Z)(function(c){return c.setEdges}),s=(0,f.Z)(function(c){return c.onNodesChange}),a=(0,f.Z)(function(c){return c.onEdgesChange}),g=(0,f.Z)(function(c){return c.onConnect}),S=(0,f.Z)(function(c){return c.nodeTypes}),M=(0,f.Z)(function(c){return c.connectionLineStyle}),j=(0,f.Z)(function(c){return c.defaultViewport}),R=(0,f.Z)(function(c){return c.onDrop}),T=(0,f.Z)(function(c){return c.onDragOver}),u=(0,f.Z)(function(c){return c.setSelect}),m=(0,f.Z)(function(c){return c.preventScrolling}),B=(0,r.useCallback)(function(c){var L=v.find(function(w){return w.id===c.target}),E=function w(Z){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(b.has(Z.id))return!1;b.add(Z.id);var P=De()((0,Y.xA)(Z,v,l)),N;try{for(P.s();!(N=P.n()).done;){var $=N.value;if($.id===c.source||w($,b))return!0}}catch(be){P.e(be)}finally{P.f()}};return L.id===c.source?!1:!E(L)},[v,l]),ve=function(){},U=(0,r.useCallback)(function(c,L){console.log(c,L,x(),(0,Y.Kz)(c,L,l)),D((0,Y.Kz)(c,L,x()))},[]);return(0,pe.Z)(function(){},[v]),(0,e.jsx)(Me.tV,{children:(0,e.jsx)(te.x$,{onViewportChange:ve,nodes:v,edges:l,onNodesChange:s,onEdgesChange:a,onEdgesDelete:function(L){},onConnect:g,onReconnect:U,nodeTypes:S,minZoom:.3,maxZoom:1,connectionLineStyle:M,snapToGrid:!1,isValidConnection:B,connectionRadius:30,preventScrolling:m,onDragOver:T,onPaneClick:function(){u("")},onPaneContextMenu:function(L){L.preventDefault()},onSelectionChange:function(L){},onNodeClick:function(L,E){u(E.id)},onEdgeClick:function(L,E){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(L){},onBeforeDelete:function(){var c=q()(H()().mark(function L(E){var w;return H()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if((E==null||(w=E.nodes)===null||w===void 0||(w=w[0])===null||w===void 0?void 0:w.type)!=z.vW.Start){b.next=3;break}return F.ZP.error(d.formatMessage({id:"workflow.delStartNodeError"})),b.abrupt("return",Promise.reject(d.formatMessage({id:"workflow.delStartNodeError"})));case 3:return u(""),b.abrupt("return",Promise.resolve(E));case 5:case"end":return b.stop()}},L)}));return function(L){return c.apply(this,arguments)}}(),fitView:!0,children:o})})}),Fe=function(o){var d=(0,r.useCallback)(function(l){l.preventDefault(),l.dataTransfer.dropEffect="move"},[]),v=(0,r.useCallback)(function(l){l.preventDefault();var D=l.dataTransfer.getData("application/reactflow");if(!D)return null;var s=JSON.parse(D),a=s.type,g=s.item;if(!a||!g)return null;var S=o({x:l.clientX,y:l.clientY});return{position:S,type:a,item:g}},[o]),x=(0,r.useCallback)(function(l){var D=function(a){var g=v(a);g&&l(g.position,g.type,g.item)};return document.addEventListener("dragover",d),document.addEventListener("drop",D),function(){document.removeEventListener("dragover",d),document.removeEventListener("drop",D)}},[d,v]);return{onDnD:x}},ye=Fe,Ye=function(){var o=(0,f.Z)(function(s){return s.setAgentData}),d=(0,f.Z)(function(s){return s.setSkillData}),v=(0,f.Z)(function(s){return s.setToolData}),x=(0,f.Z)(function(s){return s.setDatasetData}),l=(0,f.Z)(function(s){return s.setTeamDatasetData}),D=(0,f.Z)(function(s){return s.setModelOptionsData});(0,r.useEffect)(function(){(0,J.x$)(2).then(function(s){s.code===0&&o({team:s.data})}),(0,J.x$)(3).then(function(s){s.code===0&&o({user:s.data})}),(0,J.w)(2).then(function(s){s.code===0&&d({team:s.data})}),(0,J.w)(3).then(function(s){s.code===0&&d({user:s.data})}),(0,J.GZ)().then(function(s){s.code===0&&v({list:Object.values(s.data)})}),(0,J.fZ)().then(function(s){var a,g=Array.isArray(s==null||(a=s.data)===null||a===void 0?void 0:a.data)?s.data.data:[],S=g.map(function(m){return{label:m.supplier_name,options:Array.isArray(m.model_list)?m.model_list.map(function(B){return h()(h()({},B),{},{label:B.model_name,value:B.model_config_id})}):[]}}),M,j=De()(g),R;try{for(j.s();!(R=j.n()).done;){var T=R.value;if(Array.isArray(T.model_list)){var u=T.model_list.find(function(m){return m.model_default_used===1});if(u){M=u.model_config_id;break}}}}catch(m){j.e(m)}finally{j.f()}D({options:S,defaultValue:M})}),(0,J.mG)().then(function(s){s.code==0&&x({list:s.data.data.map(function(a){return h()(h()({},a),{},{label:a.name,value:a.dataset_id})})})}),(0,J.mG)(2).then(function(s){s.code==0&&l({list:s.data.data.map(function(a){return h()(h()({},a),{},{label:a.name,value:a.dataset_id})})})})},[o,d,v])},ce=Ye,rt=t(18032),Xe=(0,r.memo)(function(i){var o=i.onSubmit,d=i.onClose;return(0,e.jsx)(rt.default,{onSubmit:o,onClose:d})}),it=t(39873),Ue=t(47520),We=t(36711),lt=t(82826),Ke=t(43425),ze=t(48869),Tt=t(69243),Et=t(91806),st=t(34994),Qe=t(52688),Pt=t(55241),Zt=t(50136),dt=t(43586),Wt=function(){var o,d=(0,_.useIntl)(),v=(0,r.useState)(!0),x=C()(v,2),l=x[0],D=x[1],s=(0,f.Z)(function(b){return b.setWorkflowEditInfo}),a=(0,f.Z)(function(b){return b.workFlowInfo}),g=(0,f.Z)(function(b){return b.setSelect}),S=(0,r.useState)("1"),M=C()(S,2),j=M[0],R=M[1],T=(0,r.useState)(!1),u=C()(T,2),m=u[0],B=u[1],ve=(0,dt.Z)(),U=(0,r.useRef)(null),c=function(){var P,N;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{tooltip:(a==null||(P=a.app)===null||P===void 0?void 0:P.publish_status)!="1"?{title:d.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(a==null||(N=a.app)===null||N===void 0?void 0:N.publish_status)!="1",name:"enable_api",label:"API"})]})})})},L=[{key:"4",icon:(0,e.jsx)(lt.Z,{}),label:d.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:a!=null&&a.isProd?(0,e.jsx)(Ke.Z,{}):(0,e.jsx)(Pt.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Ke.Z,{})}),label:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:a==null?void 0:a.isProd},{key:"1",icon:(0,e.jsx)(ze.Z,{}),label:d.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Tt.Z,{}),label:d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:m?d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):d.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!m},{key:"3",icon:(0,e.jsx)(Et.Z,{}),label:d.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,pe.Z)(function(){if(a){var b,P,N,$,be=a==null||(b=a.app)===null||b===void 0?void 0:b.is_public,he=a==null||(P=a.app)===null||P===void 0?void 0:P.enable_api,le={};le.is_public=!!be,le.enable_api=(a==null||(N=a.app)===null||N===void 0?void 0:N.publish_status)=="1"?!!he:!1,console.log(le),B(le.enable_api),U==null||($=U.current)===null||$===void 0||$.setFieldsValue(le)}},[a]);var E=function(P,N){console.log(P,N),w(N.enable_api),s(N),setTimeout(ve,300)},w=function(P){B(!!P)},Z=function(P){var N;switch(P.key){case"4":_.history.go(-1);break;case"0":break;case"2":window.open(Ue._n+(a==null||(N=a.app)===null||N===void 0?void 0:N.api_url),"_blank");break;default:g(""),R(P.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(j==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Zt.Z,{defaultSelectedKeys:["1"],selectedKeys:[j],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:l,items:L,onClick:Z}),j=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{disabled:!(a!=null&&(o=a.app)!==null&&o!==void 0&&o.api_url),name:"enable_api",label:"API"})]})})})]}),j=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(We.default,{})})})]})},At=Wt,ut=t(71471),Lt=(0,r.memo)(function(i){var o=i.name,d=i.description,v=i.publishStatus,x=(0,_.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ut.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:o}),v&&(0,e.jsxs)(ut.Z.Text,{className:"whitespace-normal",children:["(",x.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ut.Z.Text,{className:"whitespace-normal text-gray-500",children:d})]})}),Ot=t(19632),wt=t.n(Ot),Rt=t(9783),qe=t.n(Rt),ct=t(36628),Bt=t(22352),$t=t(26474),Ht=t(40110),Ft=t(86615),Ut=t(5966),Kt=t(62370),zt=t(96638),_t=t(78688),Vt=t(74330),Gt=t(11941),vt=t(69386),Jt=t(96486),Yt=t(87718),Xt=t(63783),et=t(83062),ft=t(99510),mt=(0,r.memo)(function(i){var o=i.children,d=i.onDragStart,v=i.onClick,x=i.type,l=i.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(s){return d(s,x,l)},onClick:v,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:o})}),Qt=(0,r.memo)(function(i){var o,d,v,x,l=i.item,D=i.onDragStart,s=i.typeBadge,a=i.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(l==null||(o=l.baseData)===null||o===void 0?void 0:o.description)||(l==null||(d=l.data)===null||d===void 0?void 0:d.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:D,type:l.type,item:l,onClick:function(){return a==null?void 0:a(l)},children:(0,e.jsx)(ft.Z,{title:l.data.title,icon:(l==null||(v=l.baseData)===null||v===void 0?void 0:v.avatar)||(l==null||(x=l.baseData)===null||x===void 0?void 0:x.icon)||l.type,typeBadge:s})})})})}),qt=(0,r.memo)(function(i){var o,d=i.item,v=i.onDragStart,x=i.typeBadge,l=i.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(o=d.baseData)===null||o===void 0?void 0:o.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:v,type:d.type,item:d,onClick:function(){return l==null?void 0:l(d)},children:(0,e.jsx)(ft.Z,{title:d.baseData.name,icon:d.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:d.baseData.nickname}),typeBadge:x})})})})}),ea=(0,r.memo)(function(i){var o,d,v,x,l,D,s,a,g,S,M,j,R,T,u=i.tool,m=i.category,B=i.onDragStart,ve=i.typeBadge,U=i.onItemClick,c=i.categoryIndex,L=i.toolIndex,E=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans",w=(0,ct.o6)()[z.vW.Tool],Z=h()(h()({},u),{},{authorization_status:m==null?void 0:m.authorization_status,title:u==null||(o=u.identity)===null||o===void 0?void 0:o.label[E],icon:m==null||(d=m.identity)===null||d===void 0?void 0:d.icon,groupName:m==null||(v=m.identity)===null||v===void 0?void 0:v.name,credentials_for_provider:m==null?void 0:m.credentials_for_provider}),b={title:u==null||(x=u.identity)===null||x===void 0?void 0:x.label[E],desc:(u==null||(l=u.description)===null||l===void 0||(l=l.human)===null||l===void 0?void 0:l[E])||(u==null||(D=u.description)===null||D===void 0?void 0:D.llm),icon:m==null||(s=m.identity)===null||s===void 0?void 0:s.icon,data:{title:u==null||(a=u.identity)===null||a===void 0?void 0:a.label[E],desc:(u==null||(g=u.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[E])||(u==null||(S=u.description)===null||S===void 0?void 0:S.llm),icon:m==null||(M=m.identity)===null||M===void 0?void 0:M.icon},baseData:Z};return(0,e.jsx)(et.Z,{placement:"right",title:u==null||(j=u.description)===null||j===void 0||(j=j.human)===null||j===void 0?void 0:j[E],children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:B,type:z.vW.Tool,item:b,onClick:function(){return U==null?void 0:U(m,u,c,L)},children:(0,e.jsx)(ft.Z,{title:u==null||(R=u.identity)===null||R===void 0?void 0:R.label[E],icon:m==null||(T=m.identity)===null||T===void 0?void 0:T.icon,typeBadge:ve})})})})}),ta=(0,r.memo)(function(i){var o,d,v=i.category,x=i.onDragStart,l=i.typeBadge,D=i.onItemClick,s=i.categoryIndex,a=(0,_.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[v==null||(o=v.identity)===null||o===void 0?void 0:o.label[a],(0,e.jsx)(et.Z,{placement:"right",title:v==null||(d=v.identity)===null||d===void 0?void 0:d.description[a],children:(0,e.jsx)(Xt.Z,{className:"cursor-pointer ml-1"})})]}),v.tools.map(function(g,S){return(0,e.jsx)(ea,{tool:g,category:v,onDragStart:x,typeBadge:l,onItemClick:function(j,R,T,u){return D==null?void 0:D(j,R,T,u)},categoryIndex:s,toolIndex:S},S)})]})}),aa=function(o){var d=o.list,v=o.onDragStart,x=o.type,l=x===void 0?"normal":x,D=o.typeBadge,s=D===void 0?null:D,a=o.onItemClick;return d!=null&&d.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:l==="tools"?d.map(function(g,S){return(0,e.jsx)(ta,{category:g,typeBadge:s,onDragStart:v,onItemClick:a,categoryIndex:S},S)}):l==="workflow"?d.map(function(g,S){return(0,e.jsx)(qt,{item:g,onDragStart:v,typeBadge:s,onItemClick:a},S)}):d.map(function(g,S){return(0,e.jsx)(Qt,{item:g,onDragStart:v,typeBadge:s,onItemClick:a},S)})}):null},na=(0,r.memo)(aa),oa=(0,r.memo)(function(i){var o=i.visibleTabs,d=i.defaultActiveTab,v=i.showTeamSwitch,x=v===void 0?!0:v,l=i.isMinWidth,D=l===void 0?!1:l,s=i.isCollapsed,a=s===void 0?!1:s,g=i.onItemClick,S=(0,_.useIntl)(),M=(0,_.getLocale)()=="en-US"?"en_US":"zh_Hans",j=(0,ct.o6)(),R=(0,r.useMemo)(function(){return Object.values(j).filter(function(y){return![z.vW.Start,z.vW.Agent,z.vW.Tool,z.vW.Skill].includes(y.base.type)}).map(function(y){return y.base})},[j]),T=(0,r.useState)(d||"1"),u=C()(T,2),m=u[0],B=u[1],ve=(0,r.useState)(R),U=C()(ve,2),c=U[0],L=U[1],E=(0,r.useState)([]),w=C()(E,2),Z=w[0],b=w[1],P=(0,$t.v)(),N=P.tags,$=(0,zt.Z)(qe()(qe()(qe()({},z.vW.Agent,[]),z.vW.Skill,[]),"workflow",[])),be=C()($,2),he=be[0],le=be[1],Se=(0,r.useState)({team:1,keyword:"",tag:[]}),Ce=C()(Se,2),p=Ce[0],fe=Ce[1],_e=(0,r.useRef)({}),gt=6e4,ke=(0,f.Z)(function(y){return y.toolData});(0,_t.Z)(function(y){console.log("toolData",y)},[ke,p,c,he,Z,o,d,x,D,a,g]),(0,r.useEffect)(function(){b((ke==null?void 0:ke.list)||[])},[ke]);var Ae=(0,r.useCallback)(function(y,O,W){y.dataTransfer.setData("application/reactflow",JSON.stringify({type:O,item:W})),y.dataTransfer.effectAllowed="move"},[]),at=(0,r.useCallback)(function(y,O){if(!O)return y;var W=new vt.Z(y,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),ne=W.search(O);return ne.map(function(n){return n.item})},[]),nt=(0,r.useCallback)(function(y,O){if(!O)return y;var W=y.map(function(I){var k;return h()(h()({},I),{},{tools:(k=I.tools)===null||k===void 0?void 0:k.map(function(oe){var X,me;return h()(h()({},oe),{},{categoryName:(X=I.identity)===null||X===void 0||(X=X.label)===null||X===void 0?void 0:X[M],categoryIcon:(me=I.identity)===null||me===void 0?void 0:me.icon})})})}),ne=new vt.Z(W,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),n=ne.search(O);return n.map(function(I){return h()(h()({},I.item),{},{tools:I.item.tools.filter(function(k){var oe=new vt.Z([k],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return oe.search(O).length>0})})}).filter(function(I){return I.tools.length>0})},[M]),Le=(0,r.useCallback)(function(){var y=q()(H()().mark(function O(W){var ne,n,I,k,oe,X;return H()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(ne="".concat(W,"-").concat(p.team,"-").concat(p.keyword,"-").concat(p.tag.join(",")),n=_e.current[ne],!(n&&Date.now()-n.timestamp<gt&&JSON.stringify(n.params)===JSON.stringify(p))){K.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(W)),K.abrupt("return",n.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(W)),K.prev=6,K.next=9,(0,J.RE)(W,{search_type:p.team,apps_name:p.keyword,tag_ids:((I=p.tag)===null||I===void 0?void 0:I.join(","))||""});case 9:if(k=K.sent,!((k==null?void 0:k.code)===0&&k!==null&&k!==void 0&&k.data&&Array.isArray(k.data.list)&&k.data.list.length>0)){K.next=16;break}return oe=k.data.list,X=oe.filter(function(ge){return ge.publish_status==1}).map(function(ge){var Te,Re;return h()(h()({},(Te=j[W])===null||Te===void 0?void 0:Te.base),{},{data:h()(h()({},(Re=j[W])===null||Re===void 0?void 0:Re.base.data),{},{title:ge.name,desc:ge.description}),baseData:ge})}),_e.current[ne]={data:X,timestamp:Date.now(),params:h()({},p)},le(qe()({},W,X)),K.abrupt("return",X);case 16:return K.abrupt("return",[]);case 19:return K.prev=19,K.t0=K.catch(6),console.error("Failed to fetch ".concat(W," data:"),K.t0),K.abrupt("return",[]);case 23:case"end":return K.stop()}},O,null,[[6,19]])}));return function(O){return y.apply(this,arguments)}}(),[p,j,le]),Ne=(0,r.useMemo)(function(){var y=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return p.keyword?at(c,p.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Le(z.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return p.keyword?nt(Z,p.keyword):Z}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var W=q()(H()().mark(function n(){return H()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,Le(z.vW.Skill);case 2:return k.abrupt("return",k.sent);case 3:case"end":return k.stop()}},n)}));function ne(){return W.apply(this,arguments)}return ne}()}],O=o!=null&&o.length?y.filter(function(W){return o.includes(W.tabKey)}):y;return O.map(function(W,ne){return h()(h()({},W),{},{key:ne+1+""})})},[c,he,Z,o,p,at,nt,Le]),Ve=(0,r.useMemo)(function(){return Ne.map(function(y){return{key:y.key,label:S.formatMessage({id:y.label,defaultMessage:y.defaultMessage})}})},[Ne,S]),ot=(0,r.useCallback)(function(y){var O=y.tabIndex,W=y.showName,ne=W===void 0?!0:W,n=Ne.find(function(A){return A.key===O}),I=(0,r.useState)([]),k=C()(I,2),oe=k[0],X=k[1],me=(0,r.useState)(!0),K=C()(me,2),ge=K[0],Te=K[1],Re=(0,r.useState)([]),re=C()(Re,2),je=re[0],St=re[1],xa=(0,r.useState)(20),Da=C()(xa,1),pt=Da[0],Sa=(0,r.useState)(500),Ct=C()(Sa,2),kt=Ct[0],jt=Ct[1],Ee=(0,r.useRef)(null),yt=(0,r.useRef)(!1),Ca=54;(0,r.useEffect)(function(){var A=function(){if(Ee.current){var Q=Ee.current.clientHeight;jt(Q)}},V=function(Q){jt(Q.detail.height)};return A(),Ee.current&&Ee.current.addEventListener("containerResize",V),window.addEventListener("resize",A),function(){Ee.current&&Ee.current.removeEventListener("containerResize",V),window.removeEventListener("resize",A)}},[]),(0,r.useEffect)(function(){return function(){yt.current=!1}},[n==null?void 0:n.tabKey]),(0,r.useEffect)(function(){var A=function(){var V=q()(H()().mark(function se(){var Q,Pe;return H()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!(yt.current&&!p.keyword&&p.tag.length===0)){G.next=2;break}return G.abrupt("return");case 2:if(Te(!0),G.prev=3,n){G.next=6;break}return G.abrupt("return");case 6:return G.next=8,n.getData();case 8:Q=G.sent,Pe=(Q==null?void 0:Q.map(function(ja,Ma){return h()(h()({},ja),{},{id:"".concat(n.tabKey,"-").concat(Ma)})}))||[],X(Pe),St(Pe.slice(0,pt)),yt.current=!0,G.next=18;break;case 15:G.prev=15,G.t0=G.catch(3),console.error("Failed to fetch data:",G.t0);case 18:return G.prev=18,Te(!1),G.finish(18);case 21:case"end":return G.stop()}},se,null,[[3,15,18,21]])}));return function(){return V.apply(this,arguments)}}();A()},[n,p,pt]);var ka=function(V){if(V.currentTarget.scrollHeight-V.currentTarget.scrollTop===kt){var se=je.length;if(se<oe.length){var Q=oe.slice(se,se+pt);St(function(Pe){return[].concat(wt()(Pe),wt()(Q))})}}},Mt=(0,r.useCallback)(function(A){var V,se,Q;if(n){switch(console.log("Clicked item:",A),n.tabKey){case"tool":console.log("Tool ".concat((V=A.identity)===null||V===void 0||(V=V.label)===null||V===void 0?void 0:V[M]));break;case"workflow":console.log("Workflow ".concat((se=A.data)===null||se===void 0?void 0:se.title));break;case"agent":console.log("Agent ".concat((Q=A.data)===null||Q===void 0?void 0:Q.title));break;default:console.log("Clicked ".concat(n.tabKey," item:"),A)}g&&g(A,n.tabKey)}},[n,M,g]),It=(0,r.memo)(function(A){var V=A.data,se=A.index,Q=A.onDragStart,Pe=A.onItemClick,Nt=A.type,G=A.typeBadge;return(0,e.jsx)(na,{typeBadge:G,list:[V],onDragStart:Q,type:Nt,onItemClick:Pe})});return n?(0,e.jsx)("div",{ref:Ee,className:"overflow-y-auto h-full",children:(0,e.jsx)(Vt.Z,{spinning:ge,children:p!=null&&p.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:je.map(function(A){return(0,e.jsx)(It,{data:A,index:je.indexOf(A),onDragStart:Ae,onItemClick:Mt,type:n.type,typeBadge:p!=null&&p.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0},A.id)})}):(0,e.jsx)(Yt.Z,{data:je,height:kt,itemHeight:Ca,itemKey:"id",onScroll:ka,children:function(V){return(0,e.jsx)(It,{data:V,index:je.indexOf(V),onDragStart:Ae,onItemClick:Mt,type:n.type,typeBadge:p!=null&&p.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[m,p,D,Ne,Ae,M,g]),Ge=(0,r.useCallback)((0,Jt.debounce)(function(y){fe(y)},500),[]),Oe=(0,r.useCallback)(function(){_e.current={}},[]);(0,r.useEffect)(function(){Oe()},[p.team,Oe]);var ht=(0,r.useCallback)(function(y,O){"team"in y?fe(O):("tag"in y||"keyword"in y)&&Ge(O)},[Ge]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!a&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(st.A,{submitter:!1,initialValues:p,onValuesChange:ht,children:[x&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[S.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Ft.Z.Group,{name:"team",fieldProps:{options:[{label:S.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:S.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Ut.Z,{fieldProps:{prefix:(0,e.jsx)(Ht.Z,{}),placeholder:S.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Kt.Z,{name:"tag",children:(0,e.jsx)(Bt.O,{className:"w-full",options:N,listStyle:D?"horizontal":"vertical",allowClear:!0,placeholder:S.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(O){}})})})]}),p!=null&&p.keyword?null:(0,e.jsx)(Gt.Z,{activeKey:m,items:Ve,onChange:function(O){B(O)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:p!=null&&p.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ne.map(function(y,O){return(0,e.jsxs)("div",{className:"space-y-2",children:[!a&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:S.formatMessage({id:y.label,defaultMessage:y.defaultMessage})}),(0,e.jsx)(ot,{tabIndex:O+1+"",showName:!D},y.key)]},y.key)})}):(0,e.jsx)(ot,{tabIndex:m,showName:!D})})]})}),ra=(0,r.memo)(function(i){var o=i.visibleTabs,d=i.defaultActiveTab,v=i.showTeamSwitch,x=v===void 0?!0:v,l=i.workflowName,D=i.workflowDesc,s=i.publishStatus,a=i.onWidthChange,g=i.onItemClick,S=(0,r.useState)(!1),M=C()(S,2),j=M[0],R=M[1],T=(0,r.useState)(!1),u=C()(T,2),m=u[0],B=u[1];return(0,e.jsx)(it.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:m?100:315,onChange:function(U,c){requestAnimationFrame(function(){R(U<100),a==null||a(U);var L=document.querySelectorAll(".overflow-y-auto");L.forEach(function(E){if(E instanceof HTMLElement){var w=E.clientHeight,Z=new CustomEvent("containerResize",{detail:{height:w,width:U}});E.dispatchEvent(Z)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(oa,{visibleTabs:o,defaultActiveTab:d,showTeamSwitch:x,isMinWidth:j,isCollapsed:m,onItemClick:g}),(0,e.jsx)(At,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Lt,{name:l,description:D,publishStatus:s})})]})})}),ia=t(74842),la=t(98165),sa=t(58638),tt=t(28036),da=t(27484),ua=t.n(da),xt=t(70681),ca=200,va=80,fa={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ma=function(){var o=(0,te._K)(),d=o.getNodes,v=o.getEdges,x=o.setNodes,l=function(a){return{width:a.width||ca,height:a.height||va}},D=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",g=d(),S=v();if(g.length){var M=new xt.graphlib.Graph;M.setDefaultEdgeLabel(function(){return{}});var j=h()(h()({},fa),{},{rankdir:a});M.setGraph(j),g.forEach(function(T){var u=l(T),m=u.width,B=u.height;M.setNode(T.id,{width:m,height:B})}),S.forEach(function(T){M.setEdge(T.source,T.target)}),xt.layout(M);var R=g.map(function(T){var u=M.node(T.id);return h()(h()({},T),{},{position:{x:u.x-u.width/2,y:u.y-u.height/2}})});x(R)}};return{autoLayout:D}},ga=ma,ha=(0,r.memo)(function(){var i=(0,_.useIntl)(),o=(0,_.useSearchParams)(),d=C()(o,1),v=d[0],x=(0,f.Z)(function(w){return w.setWorkFlowInfo}),l=(0,f.Z)(function(w){return w.workFlowInfo}),D=(0,f.Z)(function(w){return w.setRunPanelShow}),s=v.get("type")=="true",a=(0,dt.Z)(),g=ga(),S=g.autoLayout,M=F.ZP.useMessage(),j=C()(M,2),R=j[0],T=j[1],u=(0,f.Z)(function(w){return w.loadingWorkflowData}),m=function(){var w=q()(H()().mark(function Z(){var b;return H()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,a();case 2:b=v.get("app_id"),(0,J.aJ)(b).then(function($){console.log($),$.code==0&&(x(h()(h()({},l),{},{app:h()(h()({},l==null?void 0:l.app),{},{publish_status:"1"})})),R.open({type:"success",content:i.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return N.stop()}},Z)}));return function(){return w.apply(this,arguments)}}(),B=function(){D(!0)},ve=function(){var w=q()(H()().mark(function Z(){var b,P;return H()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return b=v.get("app_id"),$.next=3,(0,J.Uq)(b);case 3:P=$.sent;case 4:case"end":return $.stop()}},Z)}));return function(){return w.apply(this,arguments)}}(),U=function(){var w=q()(H()().mark(function Z(){var b,P,N,$;return H()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:P=v.get("app_id"),N=(l==null||(b=l.app)===null||b===void 0?void 0:b.name)||"workflow",$=ua()().format("YYYY_MM_DD-HH_mm_ss"),(0,J.w8)(P,s==!0?1:0).then(function(le){var Se=le,Ce=new Blob([Se],{type:"text/yaml"}),p=URL.createObjectURL(Ce),fe=document.createElement("a");fe.href=p,fe.download="".concat(N,"_").concat($,".yml"),document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(p)});case 4:case"end":return he.stop()}},Z)}));return function(){return w.apply(this,arguments)}}(),c=function(Z){S(Z),R.open({type:"success",content:i.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},L=[{key:"TB",label:i.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:i.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}],E={name:"file",fileList:null,action:Ue._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!s&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(tt.ZP,{type:"primary",disabled:u,onClick:m,children:i.formatMessage({id:"workflow.release"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(ia.Z,{}),disabled:u,onClick:B,children:i.formatMessage({id:"workflow.run"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(la.Z,{}),type:"dashed",disabled:u,onClick:a,children:i.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(sa.Z,{}),type:"dashed",onClick:U,disabled:u,children:i.formatMessage({id:"workflow.export",defaultMessage:""})}),T]})}),Dt=t(64458),pa=function(){var o,d,v=(0,_.useIntl)(),x=(0,r.useRef)(null),l=(0,f.Z)(function(n){return n.resetNodes}),D=(0,f.Z)(function(n){return n.setNodeTypes}),s=(0,f.Z)(function(n){return n.addNode}),a=(0,f.Z)(function(n){return n.createNode}),g=(0,f.Z)(function(n){return n.setNodes}),S=(0,f.Z)(function(n){return n.setEdges}),M=(0,f.Z)(function(n){return n.setAppId}),j=(0,f.Z)(function(n){return n.setRunPanelShow}),R=(0,f.Z)(function(n){return n.runPanelShow}),T=(0,f.Z)(function(n){return n.getModelData}),u=(0,f.Z)(function(n){return n.setWorkFlowInfo}),m=(0,f.Z)(function(n){return n.setHandleList}),B=(0,f.Z)(function(n){return n.workFlowInfo}),ve=(0,f.Z)(function(n){return n.setWorkflowEditInfo}),U=F.ZP.useMessage(),c=C()(U,2),L=c[0],E=c[1],w=(0,te._K)(),Z=w.screenToFlowPosition,b=w.getNodes,P=w.setViewport,N=ye(Z),$=N.onDnD,be=(0,_.useSearchParams)(),he=C()(be,1),le=he[0],Se=le.get("type")=="true",Ce=(0,f.Z)(function(n){return n.setLoadingWorkflowData}),p=(0,te.B)({includeHiddenNodes:!1}),fe=(0,xe.Z)(),_e=(0,dt.Z)(),gt=(0,r.useState)(null),ke=C()(gt,2),Ae=ke[0],at=ke[1],nt=(0,r.useState)(!1),Le=C()(nt,2),Ne=Le[0],Ve=Le[1],ot=(0,r.useState)(""),Ge=C()(ot,2),Oe=Ge[0],ht=Ge[1],y=null;(0,te.CV)({onEnd:function(I){}}),(0,Ze.Z)(function(){D((0,ct.$P)()),l(),(0,He.b6)(),O(),m([])}),ce(),(0,r.useEffect)(function(){if(Ae){_.history.push(Oe);return}var n=_.history.block(function(I,k){if(R){ht(I.location.pathname),Ve(!0);return}});return R||n==null||n(),function(){n==null||n()}},[R,Ae]),(0,pe.Z)(function(){if(p){var n=b(),I=n[n.length-1];I.data.drag&&(I.position={x:I.position.x-I.measured.width/2,y:I.position.y-I.measured.height/2},g(n))}},[p]),(0,r.useEffect)(function(){var n=$(function(I,k,oe){console.log(I,k,oe),a(k,{position:I,data:h()(h()({drag:!0},oe.data),{},{baseData:oe.baseData})})});return n},[$,s]),(0,pe.Z)(function(){fe=="hidden"&&_e()},[fe]);var O=function(){var n=q()(H()().mark(function I(){var k;return H()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:k=le.get("app_id"),Se&&L.open({type:"warning",content:v.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),Ce(!0),M(k),(0,J.kE)(k,Se?1:0).then(function(me){if(me.code==0){if(u(h()(h()({},me.data),{},{isProd:Se})),!me.data.workflow.graph){Ce(!1),a(z.vW.Start);return}var K=me.data,ge=K.workflow.graph,Te=ge.edges,Re=ge.nodes,re=ge.views,je=K.app;ve({enable_api:!!je.enable_api,is_public:!!je.is_public}),re!=null&&re.nodes&&g(re.nodes),re!=null&&re.edges&&S(re.edges),re!=null&&re.viewPort,setTimeout(function(){Ce(!1)},1e3)}}),T();case 6:case"end":return X.stop()}},I)}));return function(){return n.apply(this,arguments)}}(),W=function(){at(!0),console.log(Oe),_.history.push(Oe),Ve(!1)},ne=function(){Ve(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[E,(0,e.jsx)(de.Z,{title:v.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ne,onOk:W,onCancel:ne,children:v.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:x,children:(0,e.jsxs)(Ie,{children:[(0,e.jsx)(te.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(te.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(ra,{workflowName:B==null||(o=B.app)===null||o===void 0?void 0:o.name,workflowDesc:B==null||(d=B.app)===null||d===void 0?void 0:d.description,publishStatus:Se}),(0,e.jsx)(ha,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Xe,{})]})},ya=(0,r.memo)(function(){return(0,e.jsx)(te.tV,{children:(0,e.jsx)(pa,{})})}),ba=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(ya,{})})},wa=ba}}]);
