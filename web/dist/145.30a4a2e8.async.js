"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[145],{80459:function(gt,ke,s){var Se=s(32332),F=s(67294),We=s(85893),H=function(ee){var ce=ee.width,Fe=ce===void 0?"40px":ce,K=ee.bg,Ie=K===void 0?"#F4F8F1":K,fe=ee.rounded,Le=fe===void 0?"6px":fe,U=ee.data,G=ee.imgWidth,M=G===void 0?"18px":G,N=ee.background;U!=null&&U.avatar&&(M=Fe);var S=N||Ie;return(0,We.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Fe,height:Fe,backgroundColor:S,borderRadius:Le},children:(0,We.jsx)("img",{src:U!=null&&U.avatar?U.avatar:(0,Se.s9)("single",U==null?void 0:U.icon),style:{width:M,height:M,borderRadius:Le},alt:""})})};ke.Z=(0,F.memo)(H)},80279:function(gt,ke,s){s.d(ke,{F:function(){return An}});var Se=s(5574),F=s.n(Se),We=s(45360),H=s(55026),g=s(67294),ee=s(15009),ce=s.n(ee),Fe=s(19632),K=s.n(Fe),Ie=s(99289),fe=s.n(Ie),Le=s(9783),U=s.n(Le),G=s(97857),M=s.n(G),N=s(43722),S=s(39e3),T=s(35312),ae=s(74330),z=s(41428),t=s(85893),it=function(e){var n=e.roomid,a=(0,T.useIntl)(),r=(0,S.Z)(function(d){return d.setSummaryClick}),o=(0,g.useState)(!0),u=F()(o,2),l=u[0],m=u[1],c=(0,S.Z)(function(d){return d.summaryClick});(0,g.useEffect)(function(){m(c)},[c]);var x=(0,S.Z)(function(d){return d.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(x({id:n}),r(!1))},children:[(0,t.jsx)(z.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ze=s(80459),Ve=s(32332),Pe=s(22683),He=s(97807),Ke=s(55060),ie=s(28036),Te=s(69753),Re=s(97245),E=s(77295),L=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},me=function(e){var n=e.fileList,a=e.onDownload,r=a===void 0?L:a,o=e.className,u=o===void 0?"":o,l=e.showInGrid,m=l===void 0?!1:l,c=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(u),style:{maxHeight:c,overflow:c?"auto":"visible"},children:(0,t.jsx)(Ke.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(m?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(x,d){var C=x.path_show||x.url,P=(0,E.CO)(x.name);return(0,t.jsx)("div",{className:"".concat(m?"":"mb-2"),children:P?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(Ke.Z,{src:C,alt:x.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ie.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Te.Z,{}),onClick:function(f){f.stopPropagation(),r(C,x.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Re.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:x.name})]}),(0,t.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Te.Z,{}),onClick:function(){return r(C,x.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(x.uid||x.file_id||d))})})})})},_e=me,de=s(13769),oe=s.n(de),Ue=function(){var i=fe()(ce()().mark(function e(n){return ce()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",qe(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",qe(n));case 12:case"end":return r.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),qe=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},_t=s(64599),tt=s.n(_t),we=s(52677),te=s.n(we),nt=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},rt=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):g.isValidElement(e)?i(e.props.children):""},Ne=function(e){return rt(e)},ve=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||te()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,u=o===void 0?!0:o,l=n.checkMCPTools,m=l===void 0?!0:l,c=n.checkStreaming,x=c===void 0?!0:c,d=n.minTextLength,C=d===void 0?1:d,P=function(){if(!r)return!1;try{var O=e.content;return O&&typeof O=="string"&&O.trim().length>=C}catch(V){return console.warn("Error checking text content:",V),!1}},_=function(){if(!u)return!1;try{var O=e.fileList||e.file_list;return O&&Array.isArray(O)&&O.length>0}catch(V){return console.warn("Error checking file content:",V),!1}},f=function(){if(!m)return!1;try{var O;if((O=e.parsedContent)!==null&&O!==void 0&&O.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var V=e.contentBlocks.some(function(J){return J&&J.type==="mcp"&&J.toolId});if(V)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(J){return console.warn("Error checking MCP content:",J),!1}},D=function(){if(!x)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(O){return O&&O.type==="text"&&O.content&&O.content.trim().length>=C}):!1}catch(O){return console.warn("Error checking streaming content:",O),!1}};return P()||_()||f()||D()}catch(b){return console.error("hasMessageContent unexpected error:",b),!0}},vt=function(e){try{var n=(e==null?void 0:e.content)||"",a=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],r=(e==null?void 0:e.parsedContent)||{},o=(e==null?void 0:e.contentBlocks)||[],u=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(u)&&u.length>0,hasStreamingText:o.some(function(l){var m;return(l==null?void 0:l.type)==="text"&&(l==null||(m=l.content)===null||m===void 0?void 0:m.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(u)?u.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},lt=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var a=tt()(e),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o&&o.is_agent===1&&ve(o,M()({checkText:!1,checkFiles:!0,checkMCPTools:!0,minTextLength:1},n)))return o}}catch(u){a.e(u)}finally{a.f()}return null}catch(u){return console.error("checkLastAgentMessage error:",u),null}},pt=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},Je=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},ut=function(e,n){try{var a=M()(M()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),r=e.contentBlocks;if(!r&&e.parsedContent?r=pt(e.parsedContent):!r&&e.content&&(r=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&r){var o=Je(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(u){return console.error("prepareHistoryMessageForCurrent error:",u),e}},ht=["node","className","children"],ne=["node"],ct=function(e,n){return{code:function(r){var o=r.node,u=r.className,l=r.children,m=oe()(r,ht),c=/language-(\w+)/.exec(u||"");if(c!=null&&c.length){var x=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:c[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var d=fe()(ce()().mark(function C(P){var _,f;return ce()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,_=P.currentTarget,b.next=4,Ue(Ne(l));case 4:f=b.sent,f&&_?(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),b.next=11;break;case 8:b.prev=8,b.t0=b.catch(0),console.error("Failed to copy text: ",b.t0);case 11:case"end":return b.stop()}},C,null,[[0,8]])}));return function(C){return d.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(x).concat(e),className:"p-4",children:l})})]})}else return(0,t.jsx)("code",M()(M()({},m),{},{children:l}))},img:function(r){var o=r.node,u=oe()(r,ne),l=function(c,x){try{var d=document.createElement("a");d.href=c,d.download=x,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(C){}};return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(Ke.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ie.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Te.Z,{}),onClick:function(c){c.stopPropagation(),l(u.src||"",u.alt||"image.png")}})})]})}}},k="<<<mcp-tool-start>>>",Ge="<<<mcp-tool-end>>>",Tt=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],a=0;;){var r=e.indexOf(k,a);if(r===-1)break;var o=e.indexOf(Ge,r);if(o===-1)break;var u=r+k.length,l=e.substring(u,o).trim();try{var m=JSON.parse(l),c={id:m.id,name:m.name||"",skill_or_workflow_name:m.skill_or_workflow_name||"",workflow_run_id:m.workflow_run_id||0,workflow_confirmation_status:m.workflow_confirmation_status||null,args:m.args||{},result:m.result||null};n.push({toolData:c,startIndex:r,endIndex:o+Ge.length})}catch(x){console.error("Failed to parse MCP tool JSON:",x)}a=o+Ge.length}return n},Ot=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=Tt(e);if(n.length===0)return[{type:"text",content:e}];var a=[],r=0;if(n.forEach(function(u){if(u.startIndex>r){var l=e.substring(r,u.startIndex).trim();l&&a.push({type:"text",content:l})}a.push({type:"mcp-tool",content:e.substring(u.startIndex,u.endIndex),toolData:u.toolData}),r=u.endIndex}),r<e.length){var o=e.substring(r).trim();o&&a.push({type:"text",content:o})}return a},pe=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=Ot(e),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},kt=function(e,n,a){var r=_objectSpread({},e);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(u){return u.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},St=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(a){return a.id===n})||null},wt=function(e,n){var a=_objectSpread({},e);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},et=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},jt=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result},a=JSON.stringify(n,null,0);return"".concat(k).concat(a).concat(Ge)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},dt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return e.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var u=jt(o);a+=u}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},It=s(71471),yt=s(47221),Ct=s(66309),w=s(4393),X=s(97175),he=s(4161),Mt=s(49354),st=s(45699),mt=s(8751),at=s(79090),bt=s(66212),Nt=s(11475),Et=s(2830),Ft=s(87547),B=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i}({}),Lt=function(e,n){if(e){if(e.status==="waiting_confirm")return B.WAITING_CONFIRMATION;if(n===null)return B.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return B.FAILED}catch(r){}else if(te()(n)==="object"&&n.status==="failed")return B.FAILED;return B.COMPLETED}return B.PENDING},Wt=s(29608),$e=It.Z.Text,Dn=It.Z.Paragraph,At=yt.Z.Panel,Zt=function(e){var n=e.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)(X.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,t.jsx)(he.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,t.jsx)(Mt.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(st.Z,{className:"text-purple-600 ".concat(a)});default:return(0,t.jsx)(Re.Z,{className:"text-gray-600 ".concat(a)})}},Ht=function(e){var n=e.fileList,a=e.intl,r=function(u,l){try{var m=document.createElement("a");m.href=u,m.download=l,m.target="_blank",document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){console.error("Download file failed",c)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(o,u){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:Zt(o.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,t.jsx)(ie.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Te.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},u)})})},Kt=function(e){var n=e.status;switch(n){case B.COMPLETED:return(0,t.jsx)(mt.Z,{className:"text-green-500"});case B.RUNNING:return(0,t.jsx)(at.Z,{className:"text-blue-500"});case B.WAITING_CONFIRMATION:return(0,t.jsx)(bt.Z,{className:"text-orange-500"});case B.FAILED:return(0,t.jsx)(Nt.Z,{className:"text-red-500"});default:return(0,t.jsx)(bt.Z,{className:"text-gray-500"})}},Gt=function(e){var n=e.status,a=e.intl,r=function(l){switch(l){case B.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case B.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case B.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case B.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,t.jsx)(Ct.Z,{color:o.color,children:o.text})},Pt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(a){return e}try{return JSON.stringify(e,null,2)}catch(a){return String(e)}},zt=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},Vt=function(e){if(!e||te()(e)!=="object")return{specialFields:{},regularFields:e};var n={},a={};return Object.keys(e).forEach(function(r){r==="input_variables"?n[r]=e[r]:a[r]=e[r]}),{specialFields:n,regularFields:a}},Jt=function(e){var n=e.inputVariables,a=e.intl;return!n||te()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=F()(r,2),u=o[0],l=o[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[u,":"]}),(0,t.jsx)($e,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},u)})})]})},$t=function(e){var n=e.args,a=e.intl;try{var r=Vt(n),o=r.specialFields,u=r.regularFields,l=o.input_variables&&Object.keys(o.input_variables).length>0,m=u&&Object.keys(u).length>0;return!l&&!m?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(Jt,{inputVariables:o.input_variables,intl:a}),m&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(u)})})]})]})}catch(c){return console.warn("Failed to parse parameters for enhanced display:",c),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})}},Yt=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(a){return[]}return n&&te()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(a){return console.warn("Failed to extract file list from result data:",a),[]}},Xt=function(e){var n=e.resultData,a=e.intl,r=e.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(c){o=n}var u=o&&te()(o)==="object"&&o.status==="success"&&o.outputs&&te()(o.outputs)==="object";if(u){var l=o.outputs,m=Object.keys(l).length>0;return m?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(c){var x=F()(c,2),d=x[0],C=x[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700",children:[d,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof C=="string"?(0,t.jsx)(Pe.U,{rehypePlugins:[He.Z],components:ct(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:C}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:Pt(C)})})]},d)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===B.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})},Dt=function(e){var n=e.toolData,a=e.intl,r=e.runtimeData,o=(r==null?void 0:r.status)||Lt(n.workflow_confirmation_status,n.result),u=zt(n.name,a),l=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,m=(0,Wt.Z)(function(f){return f.setDealtWithData}),c=(r==null?void 0:r.result)||n.result,x=null;if(typeof c=="string")try{var d=JSON.parse(c);d.status==="failed"&&(x=d.message)}catch(f){}else te()(c)==="object"&&(c==null?void 0:c.status)==="failed"&&(x=c.message);var C=function(){m(M()(M()({},l),{},{exec_id:l.node_exec_id}))},P=Yt(c),_=P&&Array.isArray(P)&&P.length>0;return(0,t.jsxs)(w.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Et.Z,{className:"text-blue-500"}),(0,t.jsx)($e,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(Ct.Z,{color:"blue",children:u}),(0,t.jsx)(Kt,{status:o}),(0,t.jsx)(Gt,{status:o,intl:a})]}),l&&o!==B.COMPLETED&&o!==B.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Ft.Z,{className:"text-orange-500"}),(0,t.jsxs)($e,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),": ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),l.confirmer_name&&(0,t.jsxs)($e,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",l.confirmer_name]})]}),l.show_todo_button&&(0,t.jsx)(ie.ZP,{size:"small",type:"primary",onClick:C,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),x&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)($e,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",x]})}),(0,t.jsxs)(yt.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,t.jsx)(At,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:(0,t.jsx)($t,{args:(r==null?void 0:r.args)||n.args,intl:a})},"params"),c&&(0,t.jsx)(At,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(Xt,{resultData:c,intl:a,status:o})},"result"),_&&(0,t.jsx)(At,{header:a.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Ht,{fileList:P,intl:a})},"files")]})]})},Rt=function(e){var n,a=e.content,r=e.fileList,o=e.index,u=e.intl,l=e.isAgent,m=e.contentId,c=e.mcpTools,x=e.updateMCPTool,d=e.getMCPTool,C=e.item,P=e.contentBlocks,_=(C==null?void 0:C.parsedContent)||pe(a);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:m,children:[r&&r.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(_e,{fileList:r,onDownload:nt})}),P&&P.length>0?(0,t.jsx)("div",{children:P.map(function(f,D){var b,O,V,J,Ee,ye;return(0,t.jsx)("div",{children:f.type==="text"?f.content&&(0,t.jsx)(Pe.U,{rehypePlugins:[He.Z],components:ct(o,u),children:f.content}):f.toolId&&d&&(0,t.jsx)(Dt,{toolData:{id:f.toolId,name:((b=d(f.toolId))===null||b===void 0?void 0:b.name)||"",skill_or_workflow_name:((O=d(f.toolId))===null||O===void 0?void 0:O.skill_or_workflow_name)||"",workflow_run_id:(V=d(f.toolId))===null||V===void 0?void 0:V.workflow_run_id,workflow_confirmation_status:(J=d(f.toolId))===null||J===void 0?void 0:J.workflow_confirmation_status,args:((Ee=d(f.toolId))===null||Ee===void 0?void 0:Ee.args)||{},result:(ye=d(f.toolId))===null||ye===void 0?void 0:ye.result},intl:u,runtimeData:d(f.toolId)})},"content-block-".concat(D))})}):_.hasMCPTools?(0,t.jsx)("div",{children:_.blocks.map(function(f,D){return(0,t.jsx)("div",{children:f.type==="text"?(0,t.jsx)(Pe.U,{rehypePlugins:[He.Z],components:ct(o,u),children:f.content}):f.toolData&&(0,t.jsx)(Dt,{toolData:f.toolData,intl:u,runtimeData:d?d(f.toolData.id):null})},D)})}):(0,t.jsx)(Pe.U,{rehypePlugins:[He.Z],components:ct(o,u),children:a}),e.isCurrentMessage&&!P&&(C==null||(n=C.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:C.activeMCPTools.map(function(f){return d?d(f):null}).filter(Boolean).map(function(f){return(0,t.jsx)(Dt,{toolData:{name:f.name,skill_or_workflow_name:f.skill_or_workflow_name,workflow_run_id:f.workflow_run_id,workflow_confirmation_status:f.workflow_confirmation_status,args:f.args,result:f.result,id:f.id},intl:u,runtimeData:f},"current-tool-".concat(f.id))})})]})},Qt=(0,g.memo)(function(i){var e=i.messageApi,n=i.index,a=i.idName,r=i.cidName,o=(0,T.useIntl)(),u=(0,g.useState)(!1),l=F()(u,2),m=l[0],c=l[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var x=fe()(ce()().mark(function d(C){var P,_,f;return ce()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return P=C.target.closest("#".concat(a).concat(n)),_=P.querySelector("#".concat(r).concat(n)),b.prev=2,b.next=5,Ue(_.innerText);case 5:f=b.sent,f?e.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),b.next=13;break;case 9:b.prev=9,b.t0=b.catch(2),console.error("Failed to copy text: ",b.t0),e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return b.stop()}},d,null,[[2,9]])}));return function(d){return x.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(m?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(m?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),qt=s(2068),en=function(e){var n=e.id,a=e.index,r=e.idName,o=e.cidName,u=(0,T.useIntl)(),l=(0,S.Z)(function(_){return _.setSummaryClick}),m=(0,g.useState)(!0),c=F()(m,2),x=c[0],d=c[1],C=(0,S.Z)(function(_){return _.summaryClick});(0,g.useEffect)(function(){d(C)},[C]);var P=(0,S.Z)(function(_){return _.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(x?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(f){if(x){var D=f.target.closest("#".concat(r).concat(a)),b=D.querySelector("#".concat(o).concat(a));P({id:n,message:b.innerText}),l(!1)}},children:[(0,t.jsx)(qt.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:u.formatMessage({id:"app.chatroom.content.summary"})})]})})},tn=function(e){var n=e.messageApi,a=e.index,r=e.idName,o=e.cidName,u=e.id,l=e.agentChatRoomId,m=e.isAgent;return m?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(Qt,{messageApi:n,index:a,idName:r,cidName:o}),!l&&(0,t.jsx)(en,{id:u,index:a,idName:r,cidName:o})]}):null},Ut=function(e){var n,a=e.item,r=e.index,o=e.agentChatRoomId,u=e.abilitiesList,l=e.messageApi,m=e.id,c=e.idName,x=e.cidName,d=e.mcpTools,C=e.updateMCPTool,P=e.getMCPTool,_=(0,T.useIntl)(),f=a.is_agent===1;return ve(a)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(f?"":"flex-row-reverse"),children:[f?(0,t.jsx)(Ze.Z,{data:a}):(0,t.jsx)(Ze.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(c).concat(r),children:[(0,t.jsxs)("div",{className:"".concat(f?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,Ve.Qy)("GET").nickname,a.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(u==null||(n=u.find(function(D){return a.ability_id==D.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(f?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Rt,{content:a.content,fileList:a.file_list,index:r,intl:_,isAgent:f,contentId:"".concat(x).concat(r),mcpTools:d,updateMCPTool:C,getMCPTool:P,item:a})}),(0,t.jsx)(tn,{messageApi:l,index:r,idName:c,cidName:x,id:m,agentChatRoomId:o,isAgent:f})]})]}):null},nn=s(47635),rn=function(e,n,a,r,o,u,l,m,c,x,d,C,P,_,f,D,b){var O=(0,T.useIntl)(),V=(0,S.Z)(function(R){return R.setTruncatable}),J=function(h){try{var v=JSON.parse(h.slice(22,-2));return Array.isArray(v)&&v.length>=2?[v[0],v[1]]:null}catch(y){return console.warn("Failed to parse instruction:",y),null}},Ee=function(h){return h.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},ye=function(h){c(function(v){var y=v.contentBlocks||[],p=h(y);return M()(M()({},v),{},{contentBlocks:p})})},Ae=function(h){ye(function(v){var y=v[v.length-1];return y&&y.type==="text"?v.map(function(p,I){return I===v.length-1?M()(M()({},p),{},{content:(p.content||"")+h}):p}):[].concat(K()(v),[{type:"text",content:h,timestamp:Date.now()}])})},Ye=function(h){ye(function(v){return[].concat(K()(v),[{type:"mcp",toolId:h,timestamp:Date.now()}])})},Be=function(h){return!(h!=null&&h.blocks)||!Array.isArray(h.blocks)?[]:h.blocks.map(function(v){var y;return v.type==="text"?{type:"text",content:v.content||"",timestamp:Date.now()}:v.type==="mcp-tool"&&(y=v.toolData)!==null&&y!==void 0&&y.id?{type:"mcp",toolId:v.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},ot=function(h){return h.filter(function(v){return v.type==="mcp"&&v.toolId}).map(function(v){return v.toolId})},xe=function(h,v){P&&P(h,v),C.current&&Object.keys(x).length>0&&c(function(y){var p=y.activeMCPTools||[],I=p.includes(h)?p:[].concat(K()(p),[h]);return M()(M()({},y),{},{activeMCPTools:I})})},De=function(h,v,y){try{if(!h||!Array.isArray(h))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!y)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),h;var p=h.filter(function($){return $.type==="mcp"&&$.toolId}).map(function($){return $.toolId}),I=v.filter(function($){return!p.includes($)}),Q=I.map(function($){return{type:"mcp",toolId:$,timestamp:Date.now()}});return[].concat(K()(h),K()(Q))}catch($){return console.error("Failed to sync MCP tool states to contentBlocks:",$),h}},ze={ERROR:function(h){e(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(h),duration:10})},CHAT:function(h){if(Object.keys(x).length&&ve(x,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var v,y,p=M()({},x);if(((v=p.activeMCPTools)===null||v===void 0?void 0:v.length)>0||((y=p.contentBlocks)===null||y===void 0?void 0:y.length)>0){var I=De(p.contentBlocks||[],p.activeMCPTools||[],D);if(D&&I.length>0){var Q=dt(I,D);Q?(p.content=Q,p.parsedContent=pe(Q)):p.content&&(p.parsedContent=pe(p.content))}else p.content&&(p.parsedContent=pe(p.content));p.contentBlocks=I}else p.content&&(p.parsedContent=pe(p.content));o(function(be){return be.concat(p)}),c({})}var $={content:"".concat(h),is_agent:0};o(function(be){return be.concat($)}),f&&f(!0),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(h){o(function(v){if(v.length===0)return v;var y=v.length-1;return v.map(function(p,I){return I===y?M()(M()({},p),{},{file_list:h}):p})}),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(h){n(h)},TRUNCATABLE:function(h){V(h),h||r.open({type:"success",content:"".concat(O.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(h){r.open({type:"success",content:"".concat(O.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(h){var v=h.id,y=h.name,p=h.skill_or_workflow_name,I=h.args,Q=p&&p.toLowerCase().includes("workflow");xe(v,{name:y,skill_or_workflow_name:p||y,args:I,status:B.RUNNING,isWorkflow:Q}),Ye(v)},WITHMCPTOOLRESULT:function(h){var v=h.id,y=h.result,p=B.COMPLETED;if(typeof y=="string")try{var I=JSON.parse(y);I.status==="failed"&&(p=B.FAILED)}catch(Q){}else te()(y)==="object"&&(y==null?void 0:y.status)==="failed"&&(p=B.FAILED);xe(v,{result:y,status:p})},WITHWFSTATUS:function(h){var v=h.id,y=h.status,p={id:y.id,status:y.status,app_run_id:y.app_run_id,node_exec_id:y.node_exec_id,workflow_name:y.workflow_name,need_user_confirm:y.need_user_confirm,show_todo_button:y.show_todo_button,confirmer_name:y.confirmer_name},I;switch(y.status){case"running":I=B.RUNNING;break;case"waiting_confirm":I=B.WAITING_CONFIRMATION;break;case"completed":I=B.COMPLETED;break;case"failed":I=B.FAILED;break;default:I=B.RUNNING;break}xe(v,{workflow_confirmation:p,status:I,isWorkflow:!0})}},ge=function(h,v){ze[h]=v},le=function(h){var v=h.data,y=J(v),p=Ee(v),I=v.indexOf("REPLY")!==-1&&v.indexOf("ENDREPLY")===-1,Q=v.indexOf("ABILITY")!==-1,$=v.indexOf("ENDCHAT")!==-1;if(p){if(!y)return;var be=y[0],je=y[1],Xe=ze[be];Xe?Xe(je):console.warn("Unknown message type: ".concat(be))}if(p||console.log(C.current,h),!p&&C.current&&(d.current+=v,requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")}),c(function(re){var Oe=d.current,Qe=M()(M()({},re),{},{content:Oe});return Oe&&(Qe.parsedContent=pe(Oe)),Qe}),Ae(v)),I&&p){var Y=y[1];f&&f(!1);var A=m.current.filter(function(re){return re.agent_id==Y})[0];o(function(re){var Oe=re;if(Object.keys(x).length&&ve(x,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var Qe,Z,se=M()({},x);if(((Qe=se.activeMCPTools)===null||Qe===void 0?void 0:Qe.length)>0||((Z=se.contentBlocks)===null||Z===void 0?void 0:Z.length)>0){var ft=De(se.contentBlocks||[],se.activeMCPTools||[],D);if(D&&ft.length>0){var xt=dt(ft,D);xt?(se.content=xt,se.parsedContent=pe(xt)):se.content&&(se.parsedContent=pe(se.content))}else se.content&&(se.parsedContent=pe(se.content));se.contentBlocks=ft}else se.content&&(se.parsedContent=pe(se.content));Oe=re.concat(se)}return d.current="",c({is_agent:1,icon:A==null?void 0:A.icon,name:A==null?void 0:A.name,content:"",activeMCPTools:[],agent_id:Y,parsedContent:null,contentBlocks:[]}),C.current=!0,n(!0),V(!1),Oe})}if(Q&&p){var ue=y[1];c(function(re){return M()(M()({},re),{},{is_agent:1,ability_id:ue})})}if($){if(C.current=!1,d.current="",e(!1),n(!1),V(!0),Object.keys(x).length){var Ce,W,j=M()({},x);if(((Ce=j.activeMCPTools)===null||Ce===void 0?void 0:Ce.length)>0||((W=j.contentBlocks)===null||W===void 0?void 0:W.length)>0){var q=De(j.contentBlocks||[],j.activeMCPTools||[],D);if(D&&q.length>0){var Me=dt(q,D);Me?(j.content=Me,j.parsedContent=pe(Me)):j.content&&(j.parsedContent=pe(j.content))}else j.content&&(j.parsedContent=pe(j.content));j.contentBlocks=q}else j.content&&(j.parsedContent=pe(j.content));console.log(j),o(function(re){return re.concat(j)})}c({}),a("")}};return{getSocketMessage:le,addMessageHandler:ge}},an=function(e){var n=e.currentMessage,a=e.agentChatRoomId,r=e.intl,o=e.mcpTools,u=o===void 0?{}:o,l=e.updateMCPTool,m=l===void 0?function(){}:l,c=e.getMCPTool,x=c===void 0?function(){return null}:c;return!n.name||!ve(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(Ze.Z,{data:n}):(0,t.jsx)(Ze.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,Ve.Qy)("GET").nickname}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Rt,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:u,updateMCPTool:m,getMCPTool:x,item:M()(M()({},n),{},{parsedContent:pe(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},on=(0,g.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,m=i.setisEnd,c=i.setSendValue,x=i.agentChatRoomId,d=i.updateMCPTool,C=i.getCurrentMessageList,P=i.mcpTools,_=P===void 0?{}:P,f=i.getMCPTool,D=f===void 0?function(){return null}:f,b=i.setIsWaitingReply,O=i.removeHistoryMessage,V=i.setCurrentMessageFromHistory,J=(0,T.useIntl)(),Ee=(0,T.useParams)(),ye=Ee.id,Ae=(0,T.useLocation)(),Ye=new URLSearchParams(Ae.search),Be=Ye.get("id"),ot=x||ye||Be,xe=(0,S.Z)(function(je){return je.setDisableInput}),De=(0,g.useState)({}),ze=F()(De,2),ge=ze[0],le=ze[1],R=(0,g.useRef)(!1),h=(0,g.useRef)(""),v=(0,g.useCallback)(function(je){try{if(!je||te()(je)!=="object"){console.warn("Invalid history message provided:",je);return}if(je.is_agent!==1){console.warn("Attempted to set non-agent message as current:",je);return}var Xe=ut(je,D);if(!Xe){console.warn("Failed to prepare history message:",je);return}le(Xe),R.current=!0,h.current=Xe.content||""}catch(Y){console.error("Failed to set current message from history:",Y)}},[D]);(0,g.useEffect)(function(){V&&V(v)},[V,v]);var y=rn(xe,l,c,e,n,o,u,r,le,ge,h,R,d,C,b,D,O),p=y.getSocketMessage,I=(0,nn.Z)("chat",p),Q=I.runSocket,$=I.sendMessage,be=I.readyState;return(0,g.useEffect)(function(){be==1&&ot&&$(JSON.stringify(["ENTER",parseInt(ot)]))},[be]),(0,g.useEffect)(function(){a&&be==1&&$(a)},[a]),(0,g.useEffect)(function(){Q()},[]),(0,t.jsx)(an,{currentMessage:ge,agentChatRoomId:x,intl:J,mcpTools:_,updateMCPTool:d,getMCPTool:D})}),sn=function(e){var n=e.type,a=n===void 0?"typing":n,r=e.size,o=r===void 0?"medium":r;if(a==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var u={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,m){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:M()(M()({},u),{},{animationDelay:"".concat(l,"s")})},m)})})]})}return a==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},ln=function(e){var n=e.autoRotate,a=n===void 0?!1:n,r=e.rotateInterval,o=r===void 0?3e3:r,u=e.initialType,l=u===void 0?"wave":u,m=e.size,c=m===void 0?"medium":m,x=(0,g.useState)(l),d=F()(x,2),C=d[0],P=d[1],_=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(sn,{type:C,size:c})})},un=function(e){var n=e.isVisible,a=e.animationType,r=a===void 0?"pulse":a,o=e.enableAutoRotate,u=o===void 0?!0:o,l=(0,T.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(ln,{initialType:r,autoRotate:u,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},cn=(0,g.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,m=i.setSendValue,c=i.agentChatRoomId,x=i.abilitiesList,d=i.mcpTools,C=i.updateMCPTool,P=i.getMCPTool,_=i.userMessage,f=(0,g.useState)([]),D=F()(f,2),b=D[0],O=D[1],V=(0,g.useState)(!1),J=F()(V,2),Ee=J[0],ye=J[1],Ae=(0,g.useState)(!1),Ye=F()(Ae,2),Be=Ye[0],ot=Ye[1],xe=(0,g.useRef)(!1),De=(0,g.useRef)(null),ze=(0,T.useParams)(),ge=ze.id,le=(0,T.useLocation)(),R=new URLSearchParams(le.search),h=R.get("id"),v=ge||h;(0,g.useEffect)(function(){Ee&&(n(function(p){return[].concat(K()(b.reverse()),K()(p))}),O([]),setTimeout(function(){ye(!1),o.current.scrollTop=0},200))},[Ee]),(0,g.useEffect)(function(){if(!xe.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!De.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var p=lt(_);if(p){if(!p.id){console.warn("Found agent message without ID, skipping:",p),xe.current=!0;return}if(De.current(p),n){var I=_.filter(function(Q){return Q!==p});n(I)}else console.warn("setUserMessage not available for history update");xe.current=!0}}catch(Q){console.error("Failed to process history message:",Q,{userMessageLength:_==null?void 0:_.length,hasCallback:!!De.current}),xe.current=!0}}},[_,n]),(0,g.useEffect)(function(){xe.current=!1},[v]);var y=function(I){if(n&&_){var Q=_.filter(function($){return $!==I});n(Q)}};return(0,t.jsxs)(t.Fragment,{children:[b.length?b.map(function(p,I){return(0,t.jsx)(Ut,{item:p,index:I,agentChatRoomId:c,abilitiesList:x,messageApi:e,id:v,idName:"currentContent",cidName:"currentChilContent",mcpTools:d,updateMCPTool:C,getMCPTool:P},I)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(un,{isVisible:Be}),(0,t.jsx)(on,{messageApi:e,setCurrentMessageContent:O,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:u,setIsStop:l,setisEnd:ye,setSendValue:m,agentChatRoomId:c,updateMCPTool:C,getCurrentMessageList:function(){return _||[]},mcpTools:d,getMCPTool:P,setIsWaitingReply:ot,removeHistoryMessage:y,setCurrentMessageFromHistory:function(I){De.current=I}})]})}),dn=(0,g.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,a=i.instruction,r=i.setIsStop,o=i.upButtonDom,u=i.setInstruction,l=i.agentList,m=i.agentChatRoomId,c=i.abilitiesList,x=(0,T.useIntl)(),d=(0,g.useState)(860),C=F()(d,2),P=C[0],_=C[1],f=(0,T.useParams)(),D=f.id,b=(0,T.useLocation)(),O=new URLSearchParams(b.search),V=O.get("id"),J=m||D||V,Ee=(0,g.useState)([]),ye=F()(Ee,2),Ae=ye[0],Ye=ye[1],Be=(0,g.useRef)(!1),ot=(0,g.useState)(""),xe=F()(ot,2),De=xe[0],ze=xe[1],ge=(0,g.useRef)(null),le=(0,g.useRef)(!0),R=(0,g.useState)({}),h=F()(R,2),v=h[0],y=h[1],p=(0,g.useRef)(2),I=(0,g.useRef)(1),Q=(0,g.useRef)(0),$=function(j,q){y(function(Me){var re=Me[j];return re?M()(M()({},Me),{},U()({},j,M()(M()({},re),q))):M()(M()({},Me),{},U()({},j,M()({id:j,status:B.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},q)))})},be=function(j){return v[j]||null},je=function(j){var q=j.map(function(Me){var re=M()({},Me);if(Me.is_agent===1&&Me.content){var Oe=pe(Me.content);re.parsedContent=Oe,Oe.hasMCPTools&&Oe.blocks.forEach(function(Qe){if(Qe.type==="mcp-tool"&&Qe.toolData){var Z=Qe.toolData;if(!v[Z.id]){var se=Lt(Z.workflow_confirmation_status,Z.result);y(function(ft){return M()(M()({},ft),{},U()({},Z.id,{id:Z.id,name:Z.name,skill_or_workflow_name:Z.skill_or_workflow_name||Z.name,workflow_run_id:Z.workflow_run_id||0,workflow_confirmation_status:Z.workflow_confirmation_status||null,args:Z.args||{},result:Z.result||null,status:se,isWorkflow:Z.skill_or_workflow_name?Z.skill_or_workflow_name.toLowerCase().includes("workflow"):!1}))})}}})}return re});return q},Xe=function(){var W=fe()(ce()().mark(function j(q){var Me,re,Oe=arguments;return ce()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(Me=Oe.length>1&&Oe[1]!==void 0?Oe[1]:function(){},!J){Z.next=6;break}return Z.next=4,(0,N.KH)(J,{page:I.current,page_size:10});case 4:re=Z.sent,re.code==0&&(p.current=re.data.total_pages,q||(ge.current.style.display="none"),Ye(function(se){var ft=re.data.list.reverse(),xt=je(ft);return q?K()(xt):[].concat(K()(se),K()(xt))}),q?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):Q.current=re.data.list.length,le.current=!0);case 6:case"end":return Z.stop()}},j)}));return function(q){return W.apply(this,arguments)}}(),Y=function(j){var q=j.target.scrollHeight+(j.target.scrollTop-j.target.clientHeight);Be.current!==Math.ceil(j.target.scrollTop)<-50&&(Be.current=Math.ceil(j.target.scrollTop)<-50,o.current.style.display=Be.current?"flex":"none"),q<10&&le.current&&(le.current=!1,I.current=I.current+1,ge.current.style.display="flex",p.current>=I.current?Xe(!1):ge.current.style.display="none")},A=function(j,q){q==="0"&&(q=Number(q));var Me=["".concat(j),q!==""&&q!==null&&q!==void 0?q:null];ze(JSON.stringify(Me))},ue=(0,S.Z)(function(W){return W.disableInput}),Ce=(0,S.Z)(function(W){return W.clearMemory});return(0,g.useEffect)(function(){Ce&&Ce.length&&A(Ce[0],Ce[1])},[Ce]),(0,g.useEffect)(function(){a&&a.length&&(A(a[0],a[1]!==void 0?a[1]:""),u([]))},[a]),(0,g.useEffect)(function(){I.current=1,Xe(!0)},[]),(0,g.useEffect)(function(){var W=function(){window.innerWidth<1280||_(window.innerWidth-320-(window.innerWidth-320)/2-88)};return W(),window.addEventListener("resize",W),function(){window.removeEventListener("resize",W)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:Y,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:m?"":"".concat(P,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:Ae&&Ae.length?Ae.map(function(W,j){return(0,t.jsx)(Ut,{item:M()(M()({},W),{},{id:"c".concat(W.id)}),index:j,agentChatRoomId:m,abilitiesList:c,messageApi:e,id:J,idName:"content",cidName:"chilContent",mcpTools:v,updateMCPTool:$,getMCPTool:be},j)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(cn,{messageApi:e,setUserMessage:Ye,sendValue:De,agentList:l,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:ze,agentChatRoomId:m,abilitiesList:c,mcpTools:v,updateMCPTool:$,getMCPTool:be,userMessage:Ae})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!m&&!ue&&Ae.length?(0,t.jsx)(it,{roomid:J}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:ge,children:(0,t.jsx)(ae.Z,{})})]})})}),mn=function(e){var n=(0,g.useRef)(null),a=(0,g.useRef)(null),r=(0,g.useState)(!1),o=F()(r,2),u=o[0],l=o[1],m=(0,g.useState)([]),c=F()(m,2),x=c[0],d=c[1],C=(0,T.useParams)(),P=C.id,_=(0,T.useLocation)(),f=new URLSearchParams(_.search),D=f.get("id"),b=e||P||D;return{scrollDomRef:n,upButtonDom:a,isStop:u,setIsStop:l,instruction:x,setInstruction:d,id:b}},fn=s(61227),vn=s.n(fn),pn=s(82114),hn=s(77171),xn=s(85576),Bt=s(96486),gn=s(58299),_n=s(38008),yn=s(83062),Cn=function(e){var n=e.uploadedFiles,a=e.handleRemoveFile;return n.length?(0,t.jsx)(Ke.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,t.jsx)(Ct.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(yn.Z,{title:r.name,children:(0,t.jsx)("div",{className:"flex items-center",children:r.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(Ke.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Te.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),nt(r.path_show||r.url,r.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Re.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Te.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),nt(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},Mn=s(52645),bn=s(64317),jn=function(e){var n=e.agentChatRoomId,a=e.abilitiesList,r=e.abilityId,o=e.setAbilityId,u=e.clearContext,l=(0,T.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,t.jsx)(bn.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(c){o(c)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(ie.ZP,{size:"small",color:"danger",variant:"outlined",onClick:u,icon:(0,t.jsx)(Mn.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},In=s(88484),Pn=s(30159),Tn=s(26915),wn=Tn.Z.TextArea,Nn=function(e){var n=e.userSendvalue,a=e.setUserSendvalue,r=e.disableInput,o=e.isUploading,u=e.isStop,l=e.userSendmessage,m=e.handleFileUpload,c=e.sendMessage,x=e.stopChatRoom,d=(0,T.useIntl)(),C=(0,Bt.throttle)(function(){if(r||!n)return!1;c(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(ie.ZP,{type:"text",icon:(0,t.jsx)(In.Z,{}),onClick:m,disabled:r||o,loading:o}),(0,t.jsx)(wn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(_){a(_.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(d.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:x,children:(0,t.jsx)(Pn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:C,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},En=(0,g.memo)(function(i){var e,n=i.setInstruction,a=i.messageApi,r=i.isStop,o=i.scrollDomRef,u=i.upButtonDom,l=i.agentList,m=i.abilitiesList,c=i.agentChatRoomId,x=i.chatStatus,d=(0,T.useIntl)(),C=(0,S.Z)(function(Y){return Y.disableInput}),P=(0,S.Z)(function(Y){return Y.setDisableInput}),_=(0,S.Z)(function(Y){return Y.setClearMemory}),f=(0,gn.m)(),D=f.options,b=c?(0,_n.Zc)().isImageSupportModel:function(){return!1},O=(0,g.useState)(null),V=F()(O,2),J=V[0],Ee=V[1],ye=(0,g.useState)(""),Ae=F()(ye,2),Ye=Ae[0],Be=Ae[1],ot=(0,g.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),xe=F()(ot,2),De=xe[0],ze=xe[1],ge=(0,E.ZP)({maxSizeMB:15,acceptedFileTypes:De,multiple:!0}),le=ge.uploadedFiles,R=ge.handleUpload,h=ge.removeFile,v=ge.clearFiles,y=ge.isUploading;(0,g.useEffect)(function(){var Y,A;if(c&&(l==null||(Y=l.current)===null||Y===void 0?void 0:Y.length)>0&&l!==null&&l!==void 0&&(A=l.current[0])!==null&&A!==void 0&&(A=A.agent)!==null&&A!==void 0&&A.m_config_id){var ue,Ce=l==null||(ue=l.current[0])===null||ue===void 0||(ue=ue.agent)===null||ue===void 0?void 0:ue.m_config_id,W=b(Ce),j=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(W?",.jpg,.png,.jpeg":"");ze(j)}},[l,D,l==null||(e=l.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,b]);var p=function(){var A=xn.Z.confirm;A({title:d.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(pn.Z,{}),content:d.formatMessage({id:"app.chatroom.clear.tips"}),okText:d.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:d.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){_(["TRUNCATE","0"])}})},I=function Y(A,ue){if(A.length===0){ue&&ue();return}var Ce=vn()(A),W=Ce[0],j=Ce.slice(1);n(W),setTimeout(function(){Y(j,ue)},100)},Q=function(A){var ue=[];(le==null?void 0:le.length)>0&&ue.push(["FILELIST",le.map(function(W){return W.file_id})]);var Ce=J||0;ue.push(["SETABILITY",Ce]),ue.push(["INPUT",A]),I(ue,function(){(le==null?void 0:le.length)>0&&v()})},$=function(A){!A.shiftKey&&A.target.value==""&&(a.open({type:"warning",content:d.formatMessage({id:"app.chatroom.content.input"}),duration:10}),Be(""),A.preventDefault()),!A.shiftKey&&A.keyCode==13&&A.target.value!=""&&(P(!0),Be(""),Q(A.target.value),A.preventDefault())},be=(0,Bt.throttle)(function(){n(["STOP",null])},300),je=function(){C||R()},Xe=function(A){if(!A){a.open({type:"warning",content:d.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}P(!0),Q(A),Be("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:u,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(A){o.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(hn.Z,{className:"text-[16px]"})}),(0,t.jsx)(Cn,{uploadedFiles:le,handleRemoveFile:h}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(le.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(jn,{agentChatRoomId:c,abilitiesList:m,abilityId:J,setAbilityId:Ee,clearContext:p}),(0,t.jsx)(Nn,{userSendvalue:Ye,setUserSendvalue:Be,disableInput:C,isUploading:y,isStop:r,userSendmessage:$,handleFileUpload:je,sendMessage:Xe,stopChatRoom:be})]})]})}),An=(0,g.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,a=i.abilitiesList,r=i.chatStatus,o=mn(n),u=o.scrollDomRef,l=o.upButtonDom,m=o.isStop,c=o.setIsStop,x=o.instruction,d=o.setInstruction;(0,g.useEffect)(function(){console.log(r),r==1&&c(!0)},[r]);var C=We.ZP.useMessage(),P=F()(C,2),_=P[0],f=P[1];return(0,t.jsxs)(t.Fragment,{children:[f,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(dn,{instruction:x,setInstruction:d,messageApi:_,scrollDomRef:u,setIsStop:c,upButtonDom:l,agentList:e,agentChatRoomId:n,abilitiesList:a}),(0,t.jsx)(En,{setInstruction:d,messageApi:_,isStop:m,upButtonDom:l,scrollDomRef:u,agentList:e,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})})},85877:function(gt,ke,s){var Se=s(19632),F=s.n(Se),We=s(97857),H=s.n(We),g=s(5574),ee=s.n(g),ce=s(52677),Fe=s.n(ce),K=s(35312),Ie=s(78234),fe=s(77598),Le=s(96486),U=s.n(Le),G=s(67294),M=s(73935),N=s(43413),S=s(92858),T=s(16845),ae=s(15425),z=s(85893),t=function(E){var L=E.children;return(typeof document=="undefined"?"undefined":Fe()(document))==="object"?M.createPortal(L,document.body):null},it=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ze=function(E){var L=E.value,me=E.onChange,_e=E.id,de=E.placeholder,oe=E.options,Ue=(0,K.useIntl)(),qe=(0,G.useRef)(),_t=(0,G.useState)(),tt=ee()(_t,2),we=tt[0],te=tt[1],nt=(0,G.useState)(0),rt=ee()(nt,2),Ne=rt[0],ve=rt[1],vt=(0,G.useState)(""),lt=ee()(vt,2),pt=lt[0],Je=lt[1],ut=(0,G.useCallback)(function(w){return(0,z.jsx)(Ke,H()({},w))},[]),ht=(0,G.useCallback)(function(w){return(0,z.jsx)(He,H()({},w))},[]),ne=(0,G.useMemo)(function(){return Ve((0,T.BU)((0,S.VC)((0,N.Jh)())))},[]),ct=(0,G.useState)(null),k=ee()(ct,2),Ge=k[0],Tt=k[1],Ot=(0,ae.Z)(function(w){return w.selectedNode}),pe=(0,ae.Z)(function(w){return w.getOutputVariables}),kt=(0,ae.Z)(function(w){return w.getInputVariables}),St=(0,G.useState)([]),wt=ee()(St,2),et=wt[0],jt=wt[1];(0,Ie.Z)(function(){L&&L.length>0&&dt(L),oe!=null&&oe.length&&jt(oe.map(function(w){return H()(H()({},w),{},{name:w.label,id:w.value})}))}),(0,fe.Z)(function(){var w=U().isEqual(Ge,L);w||(L&&L.length>0?dt(L):L&&U().isArray(L)&&L.length==0&&dt([{type:"paragraph",children:[]}]))},[L,_e]),(0,fe.Z)(function(){oe.length&&jt(oe.map(function(w){return H()(H()({},w),{},{name:w.label,id:w.value})})),console.log(oe)},[oe]);var dt=function(X){Tt(X),yt(ne,{nodes:[{type:"paragraph",children:[]}]}),yt(ne,{nodes:X})},It=(0,G.useCallback)(function(w){if(we&&et.length>0)switch(w.key){case"ArrowDown":w.preventDefault();var X=Ne>=et.length-1?0:Ne+1;ve(X);return;case"ArrowUp":w.preventDefault();var he=Ne<=0?et.length-1:Ne-1;ve(he);return;case"Tab":case"Enter":w.preventDefault(),N.YR.select(ne,we),Pe(ne,et[Ne]),te(null);return;case"Escape":w.preventDefault(),te(null);return}else if(w.key==="@"){setTimeout(function(){return Ct()},10);return}te(null)},[et,ne,Ne,we]),yt=function(X){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Mt=F()(X.children);if(Mt.forEach(function(at){return X.apply({type:"remove_node",path:[0],node:at})}),he.nodes){var st=N.NB.isNode(he.nodes)?[he.nodes]:he.nodes;st.forEach(function(at,bt){return X.apply({type:"insert_node",path:[bt],node:at})})}var mt=he.at&&N.E9.isPoint(he.at)?he.at:N.ML.end(X,[]);mt&&N.YR.select(X,mt)};(0,G.useEffect)(function(){if(we&&et.length>0){var w=qe.current,X=T.F3.toDOMRange(ne,we),he=X.getBoundingClientRect();w.style.top="".concat(he.top+window.pageYOffset+24,"px"),w.style.left="".concat(he.left+window.pageXOffset,"px")}},[et.length,ne,Ne,pt,we]);var Ct=function(){var X=ne.selection;if(X&&N.e6.isCollapsed(X)){var he=N.e6.edges(X),Mt=ee()(he,1),st=Mt[0],mt=N.ML.before(ne,st),at=mt&&N.ML.range(ne,mt,st),bt=at&&N.ML.string(ne,at),Nt=N.ML.after(ne,st),Et=N.ML.range(ne,st,Nt),Ft=N.ML.string(ne,Et);te(at),Je(""),ve(0);return}te(null)};return(0,z.jsxs)(T.mH,{editor:ne,initialValue:Te,onChange:function(X){me==null||me(X),te(null)},children:[(0,z.jsx)(T.CX,{renderElement:ut,renderLeaf:ht,onKeyDown:It,className:"!outline-none",placeholder:de!=null?de:Ue.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),we&&(0,z.jsx)(t,{children:(0,z.jsx)("div",{ref:qe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:et.length?et.map(function(w,X){return(0,z.jsx)("div",{onClick:function(){console.log(w),N.YR.select(ne,we),Pe(ne,w),te(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:X===Ne?"#B4D5FF":""},children:(0,z.jsx)("span",{children:w.name})},w.name+X)}):(0,z.jsx)(z.Fragment,{children:Ue.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Ve=function(E){var L=E.isInline,me=E.isVoid,_e=E.markableVoid;return E.isInline=function(de){return de.type==="mention"?!0:L(de)},E.isVoid=function(de){return de.type==="mention"?!0:me(de)},E.markableVoid=function(de){return de.type==="mention"||_e(de)},E},Pe=function(E,L){var me={type:"mention",id:(L==null?void 0:L.id)||"",character:L.name,base:L,children:[{bold:!0,text:"11111"}]};N.YR.insertNodes(E,me),N.YR.move(E)},He=function(E){var L=E.attributes,me=E.children,_e=E.leaf;return(0,z.jsx)("span",H()(H()({},L),{},{children:me}))},Ke=function(E){var L=E.attributes,me=E.children,_e=E.element;switch(_e.type){case"mention":return(0,z.jsx)(ie,H()({},E));default:return(0,z.jsx)("p",H()(H()({},L),{},{children:me}))}},ie=function(E){var L=E.attributes,me=E.children,_e=E.element,de=(0,T.vt)(),oe=(0,T.UE)(),Ue={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:de&&oe?"0 0 0 2px #B4D5FF":"none"};return _e.children[0].bold&&(Ue.fontWeight="bold"),_e.children[0].italic&&(Ue.fontStyle="italic"),(0,z.jsx)("span",H()(H()({},L),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(_e.character.replace(" ","-")),style:Ue,children:it?(0,z.jsxs)(G.Fragment,{children:["1",me,"/",_e.character]}):(0,z.jsxs)(G.Fragment,{children:[(0,z.jsx)("span",{children:_e.character}),me]})}))},Te=[{type:"paragraph",children:[{text:""}]}];ke.Z=Ze},38008:function(gt,ke,s){s.d(ke,{Zc:function(){return ce},aS:function(){return ee}});var Se=s(67294),F=s(85750),We=s(58299),H=s(85893),g=(0,Se.createContext)(void 0),ee=function(Ie){var fe=Ie.children,Le=(0,We.m)(),U=Le.options,G=(0,Se.useMemo)(function(){var M=function(T){if(!T||!U)return!1;var ae=(0,F.ti)(T,{options:U});return(ae==null?void 0:ae.support_image)===1},N=function(T){return M(T)};return{isImageSupportModel:M,getCurrentModelImageSupport:N}},[U]);return(0,H.jsx)(g.Provider,{value:G,children:fe})},ce=function(){var Ie=(0,Se.useContext)(g);if(Ie===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return Ie},Fe=null},77295:function(gt,ke,s){s.d(ke,{CO:function(){return U}});var Se=s(15009),F=s.n(Se),We=s(19632),H=s.n(We),g=s(99289),ee=s.n(g),ce=s(5574),Fe=s.n(ce),K=s(45360),Ie=s(35312),fe=s(67294),Le=s(83065),U=function(N){var S,T=N==null||(S=N.split(".").pop())===null||S===void 0?void 0:S.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(T||"")},G=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},S=(0,Ie.useIntl)(),T=(0,fe.useState)([]),ae=Fe()(T,2),z=ae[0],t=ae[1],it=(0,fe.useState)(!1),Ze=Fe()(it,2),Ve=Ze[0],Pe=Ze[1],He=N.maxSizeMB,Ke=He===void 0?15:He,ie=N.acceptedFileTypes,Te=ie===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":ie,Re=N.multiple,E=Re===void 0?!0:Re,L=function(){var oe=document.createElement("input");oe.type="file",oe.accept=Te,oe.multiple=E,oe.onchange=function(){var Ue=ee()(F()().mark(function qe(_t){var tt,we,te,nt,rt,Ne,ve,vt,lt,pt,Je,ut,ht,ne;return F()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(tt=_t.target,!(tt.files&&tt.files.length>0)){k.next=37;break}if(Pe(!0),we=Array.from(tt.files),te=we.filter(function(Ge){return Ge.size/1024/1024>Ke}),!(te.length>0)){k.next=9;break}return K.ZP.error("".concat(te.map(function(Ge){return Ge.name}).join(", ")," ").concat(S.formatMessage({id:"workflow.uploadFileErrorText"}))),Pe(!1),k.abrupt("return");case 9:nt=[],rt=0,Ne=we;case 11:if(!(rt<Ne.length)){k.next=35;break}return ve=Ne[rt],vt=new FormData,vt.append("file",ve),k.prev=15,k.next=18,(0,Le.M$)();case 18:return lt=k.sent,k.next=21,fetch(lt,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:vt});case 21:return pt=k.sent,k.next=24,pt.json();case 24:Je=k.sent,Je.code===0?(K.ZP.success("".concat(ve.name," ").concat(S.formatMessage({id:"workflow.uploadSuccess"}))),(ut=Je.data)!==null&&ut!==void 0&&ut.file_id&&(ht=U(ve.name),ne={name:ve.name,url:Je.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:ht,file_id:Je.data.file_id,path_show:Je.data.file_url||Je.data.path_show||""},nt.push(ne))):K.ZP.error("".concat(ve.name," ").concat(S.formatMessage({id:"workflow.uploadFailed"}))),k.next=32;break;case 28:k.prev=28,k.t0=k.catch(15),console.error("Upload error:",k.t0),K.ZP.error("".concat(ve.name," ").concat(S.formatMessage({id:"workflow.uploadFailed"})));case 32:rt++,k.next=11;break;case 35:t(function(Ge){return[].concat(H()(Ge),nt)}),Pe(!1);case 37:case"end":return k.stop()}},qe,null,[[15,28]])}));return function(qe){return Ue.apply(this,arguments)}}(),oe.click()},me=function(oe){t(function(Ue){return Ue.filter(function(qe){return qe.uid!==oe})})},_e=function(){t([])};return{uploadedFiles:z,setUploadedFiles:t,handleUpload:L,removeFile:me,clearFiles:_e,isUploading:Ve}};ke.ZP=G},58299:function(gt,ke,s){s.d(ke,{m:function(){return G}});var Se=s(64599),F=s.n(Se),We=s(97857),H=s.n(We),g=s(15009),ee=s.n(g),ce=s(99289),Fe=s.n(ce),K=s(73445),Ie=s(42237),fe=s(45360),Le=s(67294),U=(0,K.Ue)(function(M){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var N=Fe()(ee()().mark(function T(){var ae;return ee()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,M({loading:!0}),t.next=4,(0,Ie.fZ)();case 4:if(ae=t.sent,ae.code!==0){t.next=9;break}M({models:Array.isArray(ae.data.data)?ae.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(ae.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),M({error:t.t0.message}),fe.ZP.error("Failed to fetch models");case 16:return t.prev=16,M({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},T,null,[[0,12,16,19]])}));function S(){return N.apply(this,arguments)}return S}()}}),G=function(){var N=U(function(t){return t.models}),S=U(function(t){return t.loading}),T=U(function(t){return t.initialized}),ae=U(function(t){return t.fetchModels});(0,Le.useEffect)(function(){T||ae()},[T,ae]);var z=(0,Le.useMemo)(function(){var t=Array.isArray(N)?N:[],it=t.map(function(ie){return{label:ie.supplier_name,options:Array.isArray(ie.model_list)?ie.model_list.map(function(Te){return H()({label:Te.model_name,value:Te.model_config_id},Te)}):[]}}),Ze,Ve=F()(t),Pe;try{for(Ve.s();!(Pe=Ve.n()).done;){var He=Pe.value;if(Array.isArray(He.model_list)){var Ke=He.model_list.find(function(ie){return ie.model_default_used===1});if(Ke){Ze=Ke.model_config_id;break}}}}catch(ie){Ve.e(ie)}finally{Ve.f()}return{options:it,defaultValue:Ze}},[N]);return H()(H()({},z),{},{loading:S})}}}]);
