"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[375],{80459:function(gt,He,i){var De=i(32332),b=i(67294),Ge=i(85893),N=function(ae){var x=ae.width,Le=x===void 0?"40px":x,ne=ae.bg,Oe=ne===void 0?"#F4F8F1":ne,ee=ae.rounded,Ue=ee===void 0?"6px":ee,H=ae.data,X=ae.imgWidth,ce=X===void 0?"18px":X,S=ae.background;H!=null&&H.avatar&&(ce=Le);var B=S||Oe;return(0,Ge.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Le,height:Le,backgroundColor:B,borderRadius:Ue},children:(0,Ge.jsx)("img",{src:H!=null&&H.avatar?H.avatar:(0,De.s9)("single",H==null?void 0:H.icon),style:{width:ce,height:ce,borderRadius:Ue},alt:""})})};He.Z=(0,b.memo)(N)},61806:function(gt,He,i){i.d(He,{F:function(){return Bn}});var De=i(97857),b=i.n(De),Ge=i(5574),N=i.n(Ge),Fe=i(45360),ae=i(55026),x=i(67294),Le=i(15009),ne=i.n(Le),Oe=i(19632),ee=i.n(Oe),Ue=i(99289),H=i.n(Ue),X=i(9783),ce=i.n(X),S=i(43722),B=i(39e3),E=i(35312),oe=i(74330),q=i(41428),t=i(85893),it=function(e){var n=e.roomid,a=(0,E.useIntl)(),r=(0,B.Z)(function(d){return d.setSummaryClick}),o=(0,x.useState)(!0),l=N()(o,2),u=l[0],c=l[1],h=(0,B.Z)(function(d){return d.summaryClick});(0,x.useEffect)(function(){c(h)},[h]);var f=(0,B.Z)(function(d){return d.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(u?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){u&&(f({id:n}),r(!1))},children:[(0,t.jsx)(q.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ke=i(80459),Je=i(32332),Ne=i(55060),ge=i(28036),Re=i(69753),Me=i(97245),Ye=i(77295),$e=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},R=function(e){var n=e.fileList,a=e.onDownload,r=a===void 0?$e:a,o=e.className,l=o===void 0?"":o,u=e.showInGrid,c=u===void 0?!1:u,h=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(l),style:{maxHeight:h,overflow:h?"auto":"visible"},children:(0,t.jsx)(Ne.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(c?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(f,d){var p=f.path_show||f.url,I=(0,Ye.CO)(f.name);return(0,t.jsx)("div",{className:"".concat(c?"":"mb-2"),children:I?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(Ne.Z,{src:p,alt:f.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ge.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Re.Z,{}),onClick:function(m){m.stopPropagation(),r(p,f.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Me.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:f.name})]}),(0,t.jsx)(ge.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Re.Z,{}),onClick:function(){return r(p,f.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(f.uid||f.file_id||d))})})})})},W=R,se=i(22683),fe=i(97807),pe=i(13769),ie=i.n(pe),Be=function(){var s=H()(ne()().mark(function e(n){return ne()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",tt(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",tt(n));case 12:case"end":return r.stop()}},e,null,[[0,8]])}));return function(n){return s.apply(this,arguments)}}(),tt=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},xt=i(52677),ve=i.n(xt),be=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},ke=function s(e){return typeof e=="string"?e:Array.isArray(e)?e.map(s).join(""):x.isValidElement(e)?s(e.props.children):""},lt=function(e){return ke(e)},ze=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||ve()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,l=o===void 0?!0:o,u=n.checkMCPTools,c=u===void 0?!0:u,h=n.checkStreaming,f=h===void 0?!0:h,d=n.minTextLength,p=d===void 0?1:d,I=function(){if(!r)return!1;try{var A=e.content;return A&&typeof A=="string"&&A.trim().length>=p}catch(L){return console.warn("Error checking text content:",L),!1}},_=function(){if(!l)return!1;try{var A=e.fileList||e.file_list;return A&&Array.isArray(A)&&A.length>0}catch(L){return console.warn("Error checking file content:",L),!1}},m=function(){if(!c)return!1;try{var A;if((A=e.parsedContent)!==null&&A!==void 0&&A.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var L=e.contentBlocks.some(function(J){return J&&J.type==="mcp"&&J.toolId});if(L)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(J){return console.warn("Error checking MCP content:",J),!1}},T=function(){if(!f)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(A){return A&&A.type==="text"&&A.content&&A.content.trim().length>=p}):!1}catch(A){return console.warn("Error checking streaming content:",A),!1}};return I()||_()||m()||T()}catch(M){return console.error("hasMessageContent unexpected error:",M),!0}},We=function(e){try{var n=(e==null?void 0:e.content)||"",a=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],r=(e==null?void 0:e.parsedContent)||{},o=(e==null?void 0:e.contentBlocks)||[],l=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(u){return(u==null?void 0:u.type)==="mcp"}),hasActiveMCP:Array.isArray(l)&&l.length>0,hasStreamingText:o.some(function(u){var c;return(u==null?void 0:u.type)==="text"&&(u==null||(c=u.content)===null||c===void 0?void 0:c.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(l)?l.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(u){return console.error("analyzeMessageContent error:",u),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},Ze=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var a=e[0];return a.is_agent===1&&a.content!=""?a:null}catch(r){return console.error("checkLastAgentMessage error:",r),null}},ut=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},ct=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},vt=function(e,n){try{var a=b()(b()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),r=e.contentBlocks;if(!r&&e.parsedContent?r=ut(e.parsedContent):!r&&e.content&&(r=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&r){var o=ct(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(l){return console.error("prepareHistoryMessageForCurrent error:",l),e}},Qe=["node","className","children"],dt=["node"],rt=function(e,n){return{code:function(r){var o=r.node,l=r.className,u=r.children,c=ie()(r,Qe),h=/language-(\w+)/.exec(l||"");if(h!=null&&h.length){var f=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:h[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var d=H()(ne()().mark(function p(I){var _,m;return ne()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.prev=0,_=I.currentTarget,M.next=4,Be(lt(u));case 4:m=M.sent,m&&_?(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),M.next=11;break;case 8:M.prev=8,M.t0=M.catch(0),console.error("Failed to copy text: ",M.t0);case 11:case"end":return M.stop()}},p,null,[[0,8]])}));return function(p){return d.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(f).concat(e),className:"p-4",children:u})})]})}else return(0,t.jsx)("code",b()(b()({},c),{},{children:u}))},img:function(r){var o=r.node,l=ie()(r,dt),u=function(h,f){try{var d=document.createElement("a");d.href=h,d.download=f,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(p){}};return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(Ne.Z,{src:l.src,alt:l.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ge.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Re.Z,{}),onClick:function(h){h.stopPropagation(),u(l.src||"",l.alt||"image.png")}})})]})}}},re=i(61227),_t=i.n(re),V=i(29608),at=i(97175),Nt=i(4161),Ut=i(49354),Rt=i(45699),Bt=i(8751),Et=i(79090),yt=i(66212),Xe=i(16596),bt=i(11475),Ct=i(2830),wt=i(87547),Mt=i(71471),jt=i(47221),w=i(66309),te=i(4393),j=function(s){return s.PENDING="pending",s.RUNNING="running",s.COMPLETED="completed",s.FAILED="failed",s.WAITING_CONFIRMATION="waiting_confirmation",s.WAITING_FILE_UPLOAD="waiting_file_upload",s}({}),ht=function(e,n){if(e){if(e.status==="waiting_confirm")return j.WAITING_CONFIRMATION;if(n===null)return j.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return j.FAILED}catch(r){}else if(ve()(n)==="object"&&n.status==="failed")return j.FAILED;return j.COMPLETED}return j.PENDING},ot=(0,x.createContext)(void 0),mt=function(e){var n=e.children,a=e.agentChatRoomId,r=(0,x.useRef)(null),o=(0,x.useRef)(null),l=(0,x.useState)(!1),u=N()(l,2),c=u[0],h=u[1],f=(0,x.useState)([]),d=N()(f,2),p=d[0],I=d[1],_=(0,E.useParams)(),m=_.id,T=(0,E.useLocation)(),M=new URLSearchParams(T.search),A=M.get("id"),L=a||m||A,J={scrollDomRef:r,upButtonDom:o,isStop:c,setIsStop:h,instruction:p,setInstruction:I,id:L};return(0,t.jsx)(ot.Provider,{value:J,children:n})},Ee=function(){var e=(0,x.useContext)(ot);if(e===void 0)throw new Error("useChatRoomContext must be used within a ChatRoomProvider");return e},It=function(e){var n,a=e.fileConfig,r=e.value,o=e.onChange,l=(0,Ye.ZP)({maxSizeMB:a.maxSize||10,acceptedFileTypes:((n=a.accepted_types)===null||n===void 0?void 0:n.join(","))||void 0,multiple:!1}),u=l.uploadedFiles,c=l.handleUpload,h=l.removeFile,f=l.clearFiles,d=l.isUploading,p=(0,E.useIntl)();return(0,x.useEffect)(function(){if(u.length>0){var I=u[u.length-1],_={file_name:I.name,file_path:I.path_show,size:0,type:"",id:I.file_id,status:"done"};o(_)}else o(null)},[u]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[a.name,a.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),a.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:a.description}),a.accepted_types&&a.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",a.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:u.length===0?(0,t.jsx)(ge.ZP,{type:"dashed",onClick:c,loading:d,disabled:d,className:"w-48",children:d?p.formatMessage({id:"app.chatroom.mcptool.uploading"}):p.formatMessage({id:"app.chatroom.mcptool.uploadFile"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:u[u.length-1].name}),(0,t.jsx)(ge.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return h(u[u.length-1].uid)},disabled:d,children:p.formatMessage({id:"app.chatroom.mcptool.remove"})})]})})]})},At=It,Ft=function(e){var n=e.toolData,a=e.onFileUploadComplete,r=e.onFileUploadError,o=n.files_to_upload||[],l=(0,x.useState)({}),u=N()(l,2),c=u[0],h=u[1],f=(0,E.useIntl)(),d=o.every(function(m){return m.required===!1||c[m.variable_name]&&c[m.variable_name].status==="done"}),p=function(T,M){h(function(A){var L=b()({},A);return M?L[T]=M:delete L[T],L})},I=function(){return o.map(function(T){var M=c[T.variable_name];return b()(b()({},T),M)})},_=function(){if(!d){Fe.ZP.warning(f.formatMessage({id:"app.chatroom.mcptool.pleaseUploadAllRequiredFiles"}));return}var T=I();a(T)};return(0,x.useEffect)(function(){},[d,c,a]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-blue-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:f.formatMessage({id:"app.chatroom.mcptool.requiredFiles"})})}),o.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:f.formatMessage({id:"app.chatroom.mcptool.noFilesRequired"})}),o.map(function(m){return(0,t.jsx)(At,{fileConfig:m,value:c[m.variable_name],onChange:function(M){return p(m.variable_name,M)}},m.variable_name)}),(0,t.jsx)(ge.ZP,{type:"primary",className:"mt-2 w-full",disabled:!d,onClick:_,children:f.formatMessage({id:"app.chatroom.mcptool.completeUpload"})})]})},kt=Ft,qe=Mt.Z.Text,kn=Mt.Z.Paragraph,Ot=jt.Z.Panel,zt=function(e){var n=e.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)(at.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,t.jsx)(Nt.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,t.jsx)(Ut.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(Rt.Z,{className:"text-purple-600 ".concat(a)});default:return(0,t.jsx)(Me.Z,{className:"text-gray-600 ".concat(a)})}},Wt=function(e){var n=e.fileList,a=e.intl,r=function(l,u){try{var c=document.createElement("a");c.href=l,c.download=u,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(h){console.error("Download file failed",h)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(o,l){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(qe,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:zt(o.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,t.jsx)(ge.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Re.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},l)})})},Vt=function(e){var n=e.status;switch(n){case j.COMPLETED:return(0,t.jsx)(Bt.Z,{className:"text-green-500"});case j.RUNNING:return(0,t.jsx)(Et.Z,{className:"text-blue-500"});case j.WAITING_CONFIRMATION:return(0,t.jsx)(yt.Z,{className:"text-orange-500"});case j.WAITING_FILE_UPLOAD:return(0,t.jsx)(Xe.Z,{className:"text-purple-500"});case j.FAILED:return(0,t.jsx)(bt.Z,{className:"text-red-500"});default:return(0,t.jsx)(yt.Z,{className:"text-gray-500"})}},Jt=function(e){var n=e.status,a=e.intl,r=function(u){switch(u){case j.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case j.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case j.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case j.WAITING_FILE_UPLOAD:return{color:"purple",text:a.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case j.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,t.jsx)(w.Z,{color:o.color,children:o.text})},Pt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(a){return e}try{return JSON.stringify(e,null,2)}catch(a){return String(e)}},Yt=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},$t=function(e){if(!e||ve()(e)!=="object")return{specialFields:{},regularFields:e};var n={},a={};return Object.keys(e).forEach(function(r){r==="input_variables"?n[r]=e[r]:a[r]=e[r]}),{specialFields:n,regularFields:a}},Qt=function(e){var n=e.inputVariables,a=e.intl;return!n||ve()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(qe,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=N()(r,2),l=o[0],u=o[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(qe,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[l,":"]}),(0,t.jsx)(qe,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof u=="string"?u:JSON.stringify(u)})]},l)})})]})},Xt=function(e){var n=e.args,a=e.intl;try{var r=$t(n),o=r.specialFields,l=r.regularFields,u=o.input_variables&&Object.keys(o.input_variables).length>0,c=l&&Object.keys(l).length>0;return!u&&!c?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[u&&(0,t.jsx)(Qt,{inputVariables:o.input_variables,intl:a}),c&&(0,t.jsxs)("div",{children:[u&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(qe,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(l)})})]})]})}catch(h){return console.warn("Failed to parse parameters for enhanced display:",h),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})}},qt=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(a){return[]}return n&&ve()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(a){return console.warn("Failed to extract file list from result data:",a),[]}},en=function(e){var n=e.resultData,a=e.intl,r=e.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(h){o=n}var l=o&&ve()(o)==="object"&&o.status==="success"&&o.outputs&&ve()(o.outputs)==="object";if(l){var u=o.outputs,c=Object.keys(u).length>0;return c?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(qe,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(u).map(function(h){var f=N()(h,2),d=f[0],p=f[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(qe,{strong:!0,className:"text-xs text-gray-700",children:[d,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof p=="string"?(0,t.jsx)(se.U,{rehypePlugins:[fe.Z],components:rt(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:p}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:Pt(p)})})]},d)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===j.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Pt(n)})})},St=function(e){var n=e.toolData,a=e.intl,r=e.runtimeData,o=e.updateMCPTool,l=Ee(),u=l.setInstruction,c=(r==null?void 0:r.status)||ht(n.workflow_confirmation_status,n.result),h=Yt(n.name,a),f=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,d=(0,V.Z)(function(Y){return Y.setDealtWithData}),p=(r==null?void 0:r.result)||n.result,I=null;if(typeof p=="string")try{var _=JSON.parse(p);_.status==="failed"&&(I=_.message)}catch(Y){}else ve()(p)==="object"&&(p==null?void 0:p.status)==="failed"&&(I=p.message);var m=function(){d(b()(b()({},f),{},{exec_id:f.node_exec_id}))},T=function Y($,Pe){if(u){if($.length===0){Pe&&Pe();return}var he=_t()($),nt=he[0],ye=he.slice(1);u(nt),setTimeout(function(){Y(ye,Pe)},100)}},M=function($){if(!o){console.warn("updateMCPTool function not available");return}try{if(o(n.id,{uploaded_files:$,status:j.RUNNING}),u){var Pe=[["MCPTOOLFILES",{id:n.id,files_to_upload:$}]];T(Pe)}debugger}catch(he){console.error("Error handling file upload completion:",he),Fe.ZP.error("Failed to process file upload completion")}},A=function($){console.error("File upload error:",$),Fe.ZP.error($),o&&o(n.id,{status:j.FAILED,error:$})},L=qt(p),J=L&&Array.isArray(L)&&L.length>0,le=((r==null?void 0:r.uploaded_files)||[]).map(function(Y){return{file_name:Y.file_name||Y.name,file_path:Y.file_path||"",variable_name:Y.variable_name}}),Ie=le&&Array.isArray(le)&&le.length>0;return(0,t.jsxs)(te.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Ct.Z,{className:"text-blue-500"}),(0,t.jsx)(qe,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(w.Z,{color:"blue",children:h}),(0,t.jsx)(Vt,{status:c}),(0,t.jsx)(Jt,{status:c,intl:a})]}),f&&c!==j.COMPLETED&&c!==j.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(wt.Z,{className:"text-orange-500"}),(0,t.jsxs)(qe,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),f.confirmer_name&&(0,t.jsxs)(qe,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",f.confirmer_name]})]}),f.show_todo_button&&(0,t.jsx)(ge.ZP,{size:"small",type:"primary",onClick:m,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),I&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(qe,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",I]})}),(r==null?void 0:r.status)===j.WAITING_FILE_UPLOAD&&(0,t.jsx)(kt,{toolData:r,onFileUploadComplete:M,onFileUploadError:A}),(0,t.jsxs)(jt.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,t.jsxs)(Ot,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(Xt,{args:(r==null?void 0:r.args)||n.args,intl:a}),Ie&&(0,t.jsx)(Wt,{fileList:le,intl:a})]},"params"),p&&(0,t.jsx)(Ot,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(en,{resultData:p,intl:a,status:c})},"result"),J&&(0,t.jsx)(Ot,{header:a.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Wt,{fileList:L,intl:a})},"files")]})]})},Dt="<<<mcp-tool-start>>>",Tt="<<<mcp-tool-end>>>",Wn=function(e){var n,a=e.files_to_upload&&Array.isArray(e.files_to_upload)&&e.files_to_upload.length>0,r=((n=e.args)===null||n===void 0?void 0:n.input_variables)&&Object.values(e.args.input_variables).some(function(o){return o==="need_upload"});return(a||r)&&!e.result?MCPToolStatus.WAITING_FILE_UPLOAD:getMCPToolStatus(e.workflow_confirmation_status,e.result)},tn=function(e){return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.map(function(n){return{name:n.name||"",variable_name:n.variable_name||"",id:n.id||0,file_name:n.file_name||null,file_path:n.file_path||null,required:!0,accept:void 0,maxSize:void 0,description:void 0,accepted_types:void 0}})},nn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],a=0;;){var r=e.indexOf(Dt,a);if(r===-1)break;var o=e.indexOf(Tt,r);if(o===-1)break;var l=r+Dt.length,u=e.substring(l,o).trim();try{var c=JSON.parse(u),h=tn(c),f={id:c.id,name:c.name||"",skill_or_workflow_name:c.skill_or_workflow_name||"",workflow_run_id:c.workflow_run_id||0,workflow_confirmation_status:c.workflow_confirmation_status||null,args:c.args||{},result:c.result||null,files_to_upload:h};h.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(f.id,":"),h),n.push({toolData:f,startIndex:r,endIndex:o+Tt.length})}catch(d){console.error("Failed to parse MCP tool JSON:",d)}a=o+Tt.length}return n},rn=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=nn(e);if(n.length===0)return[{type:"text",content:e}];var a=[],r=0;if(n.forEach(function(l){if(l.startIndex>r){var u=e.substring(r,l.startIndex).trim();u&&a.push({type:"text",content:u})}a.push({type:"mcp-tool",content:e.substring(l.startIndex,l.endIndex),toolData:l.toolData}),r=l.endIndex}),r<e.length){var o=e.substring(r).trim();o&&a.push({type:"text",content:o})}return a},je=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=rn(e),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},Zn=function(e,n,a){var r=_objectSpread({},e);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(l){return l.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},Hn=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(a){return a.id===n})||null},Gn=function(e,n){var a=_objectSpread({},e);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},Kn=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},an=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload},a=JSON.stringify(n,null,0);return"".concat(Dt).concat(a).concat(Tt)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},on=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(n){return!n||ve()(n)!=="object"?(console.warn("Invalid file object in files_to_upload:",n),!1):n.file_path&&typeof n.file_path=="string"&&n.file_path.trim()!==""&&(n.file_path.startsWith("http")||n.file_path.startsWith("/"))})}catch(n){return console.error("Error inferring uploaded files:",n),[]}},Lt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return e.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var l=an(o);a+=l}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},sn=i(27484),ln=i.n(sn),Zt=function(e){var n,a=e.content,r=e.fileList,o=e.index,l=e.intl,u=e.isAgent,c=e.contentId,h=e.mcpTools,f=e.updateMCPTool,d=e.getMCPTool,p=e.item,I=e.contentBlocks,_=(p==null?void 0:p.parsedContent)||je(a);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:u?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:c,children:[r&&r.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(W,{fileList:r,onDownload:be})}),I&&I.length>0?(0,t.jsx)("div",{children:I.map(function(m,T){var M,A,L,J,le,Ie;return(0,t.jsx)("div",{children:m.type==="text"?m.content&&(0,t.jsx)(se.U,{rehypePlugins:[fe.Z],components:rt(o,l),children:m.content}):m.toolId&&d&&(0,t.jsx)(St,{toolData:{id:m.toolId,name:((M=d(m.toolId))===null||M===void 0?void 0:M.name)||"",skill_or_workflow_name:((A=d(m.toolId))===null||A===void 0?void 0:A.skill_or_workflow_name)||"",workflow_run_id:(L=d(m.toolId))===null||L===void 0?void 0:L.workflow_run_id,workflow_confirmation_status:(J=d(m.toolId))===null||J===void 0?void 0:J.workflow_confirmation_status,args:((le=d(m.toolId))===null||le===void 0?void 0:le.args)||{},result:(Ie=d(m.toolId))===null||Ie===void 0?void 0:Ie.result},intl:l,runtimeData:d(m.toolId),updateMCPTool:f})},"content-block-".concat(T))})}):_.hasMCPTools?(0,t.jsx)("div",{children:_.blocks.map(function(m,T){return(0,t.jsx)("div",{children:m.type==="text"?(0,t.jsx)(se.U,{rehypePlugins:[fe.Z],components:rt(o,l),children:m.content}):m.toolData&&(0,t.jsx)(St,{toolData:m.toolData,intl:l,runtimeData:d?d(m.toolData.id):null,updateMCPTool:f})},T)})}):(0,t.jsx)(se.U,{rehypePlugins:[fe.Z],components:rt(o,l),children:a}),e.isCurrentMessage&&!I&&(p==null||(n=p.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:p.activeMCPTools.map(function(m){return d?d(m):null}).filter(Boolean).map(function(m){return(0,t.jsx)(St,{toolData:{name:m.name,skill_or_workflow_name:m.skill_or_workflow_name,workflow_run_id:m.workflow_run_id,workflow_confirmation_status:m.workflow_confirmation_status,args:m.args,result:m.result,id:m.id},intl:l,runtimeData:m,updateMCPTool:f},"current-tool-".concat(m.id))})}),p.created_time&&p.is_agent==1&&(0,t.jsx)("div",{className:"text-xs text-gray-300  text-right -mr-2 mb-1",children:ln()(p.created_time).format("YYYY-MM-DD HH:mm:ss")})]})},un=(0,x.memo)(function(s){var e=s.messageApi,n=s.index,a=s.idName,r=s.cidName,o=(0,E.useIntl)(),l=(0,x.useState)(!1),u=N()(l,2),c=u[0],h=u[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){h(!0)},onMouseLeave:function(){h(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var f=H()(ne()().mark(function d(p){var I,_,m;return ne()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return I=p.target.closest("#".concat(a).concat(n)),_=I.querySelector("#".concat(r).concat(n)),M.prev=2,M.next=5,Be(_.innerText);case 5:m=M.sent,m?e.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),M.next=13;break;case 9:M.prev=9,M.t0=M.catch(2),console.error("Failed to copy text: ",M.t0),e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return M.stop()}},d,null,[[2,9]])}));return function(d){return f.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(c?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(c?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),cn=i(2068),dn=function(e){var n=e.id,a=e.index,r=e.idName,o=e.cidName,l=(0,E.useIntl)(),u=(0,B.Z)(function(_){return _.setSummaryClick}),c=(0,x.useState)(!0),h=N()(c,2),f=h[0],d=h[1],p=(0,B.Z)(function(_){return _.summaryClick});(0,x.useEffect)(function(){d(p)},[p]);var I=(0,B.Z)(function(_){return _.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(f?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(m){if(f){var T=m.target.closest("#".concat(r).concat(a)),M=T.querySelector("#".concat(o).concat(a));I({id:n,message:M.innerText}),u(!1)}},children:[(0,t.jsx)(cn.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:l.formatMessage({id:"app.chatroom.content.summary"})})]})})},mn=function(e){var n=e.messageApi,a=e.index,r=e.idName,o=e.cidName,l=e.id,u=e.agentChatRoomId,c=e.isAgent;return c?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(un,{messageApi:n,index:a,idName:r,cidName:o}),!u&&(0,t.jsx)(dn,{id:l,index:a,idName:r,cidName:o})]}):null},Ht=function(e){var n,a=e.item,r=e.index,o=e.agentChatRoomId,l=e.abilitiesList,u=e.messageApi,c=e.id,h=e.idName,f=e.cidName,d=e.mcpTools,p=e.updateMCPTool,I=e.getMCPTool,_=(0,E.useIntl)(),m=a.is_agent===1;return ze(a)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(m?"":"flex-row-reverse"),children:[m?(0,t.jsx)(Ke.Z,{data:a}):(0,t.jsx)(Ke.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(h).concat(r),children:[(0,t.jsxs)("div",{className:"".concat(m?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,Je.Qy)("GET").nickname,a.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(l==null||(n=l.find(function(T){return a.ability_id==T.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(m?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Zt,{content:a.content,fileList:a.file_list,index:r,intl:_,isAgent:m,contentId:"".concat(f).concat(r),mcpTools:d,updateMCPTool:p,getMCPTool:I,item:a})}),(0,t.jsx)(mn,{messageApi:u,index:r,idName:h,cidName:f,id:c,agentChatRoomId:o,isAgent:m})]})]}):null},fn=i(47635),pn=function(e,n,a,r,o,l,u,c,h,f,d,p,I,_,m,T,M){var A=(0,E.useIntl)(),L=(0,B.Z)(function(k){return k.setTruncatable}),J=function(v){try{var g=JSON.parse(v.slice(22,-2));return Array.isArray(g)&&g.length>=2?[g[0],g[1]]:null}catch(y){return console.warn("Failed to parse instruction:",y),null}},le=function(v){return v.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},Ie=function(v){return!v||!v.input_variables?!1:Object.values(v.input_variables).some(function(g){return g==="need_upload"})},Y=function(v){h(function(g){var y=g.contentBlocks||[],C=v(y);return b()(b()({},g),{},{contentBlocks:C})})},$=function(v){Y(function(g){var y=g[g.length-1];return y&&y.type==="text"?g.map(function(C,P){return P===g.length-1?b()(b()({},C),{},{content:(C.content||"")+v}):C}):[].concat(ee()(g),[{type:"text",content:v,timestamp:Date.now()}])})},Pe=function(v){Y(function(g){return[].concat(ee()(g),[{type:"mcp",toolId:v,timestamp:Date.now()}])})},he=function(v){return!(v!=null&&v.blocks)||!Array.isArray(v.blocks)?[]:v.blocks.map(function(g){var y;return g.type==="text"?{type:"text",content:g.content||"",timestamp:Date.now()}:g.type==="mcp-tool"&&(y=g.toolData)!==null&&y!==void 0&&y.id?{type:"mcp",toolId:g.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},nt=function(v){return v.filter(function(g){return g.type==="mcp"&&g.toolId}).map(function(g){return g.toolId})},ye=function(v,g){I&&I(v,g),p.current&&Object.keys(f).length>0&&h(function(y){var C=y.activeMCPTools||[],P=C.includes(v)?C:[].concat(ee()(C),[v]);return b()(b()({},y),{},{activeMCPTools:P})})},we=function(v,g,y){try{if(!v||!Array.isArray(v))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!y)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),v;var C=v.filter(function(G){return G.type==="mcp"&&G.toolId}).map(function(G){return G.toolId}),P=g.filter(function(G){return!C.includes(G)}),Z=P.map(function(G){return{type:"mcp",toolId:G,timestamp:Date.now()}});return[].concat(ee()(v),ee()(Z))}catch(G){return console.error("Failed to sync MCP tool states to contentBlocks:",G),v}},Se={ERROR:function(v){e(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(v),duration:10})},CHAT:function(v){if(Object.keys(f).length&&ze(f,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var g,y,C=b()({},f);if(((g=C.activeMCPTools)===null||g===void 0?void 0:g.length)>0||((y=C.contentBlocks)===null||y===void 0?void 0:y.length)>0){var P=we(C.contentBlocks||[],C.activeMCPTools||[],T);if(T&&P.length>0){var Z=Lt(P,T);Z?(C.content=Z,C.parsedContent=je(Z)):C.content&&(C.parsedContent=je(C.content))}else C.content&&(C.parsedContent=je(C.content));C.contentBlocks=P}else C.content&&(C.parsedContent=je(C.content));o(function(xe){return xe.concat(C)}),h({})}var G={content:"".concat(v),is_agent:0};o(function(xe){return xe.concat(G)}),m&&m(!0),requestAnimationFrame(function(){l.current&&(l.current.scrollTop=0),u.current&&(u.current.style.display="none")})},WITHFILELIST:function(v){o(function(g){if(g.length===0)return g;var y=g.length-1;return g.map(function(C,P){return P===y?b()(b()({},C),{},{file_list:v}):C})}),requestAnimationFrame(function(){l.current&&(l.current.scrollTop=0),u.current&&(u.current.style.display="none")})},STOPPABLE:function(v){n(v)},TRUNCATABLE:function(v){L(v),v||r.open({type:"success",content:"".concat(A.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(v){r.open({type:"success",content:"".concat(A.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(v){var g=v.id,y=v.name,C=v.skill_or_workflow_name,P=v.args,Z=v.files_to_upload,G=C&&C.toLowerCase().includes("workflow"),xe=Z&&Array.isArray(Z)&&Z.length>0,et=xe||Ie(P),_e=et?j.WAITING_FILE_UPLOAD:j.RUNNING;ye(g,{name:y,skill_or_workflow_name:C||y,args:P,status:_e,isWorkflow:G,files_to_upload:Z||[],uploaded_files:[]}),Pe(g)},WITHMCPTOOLRESULT:function(v){var g=v.id,y=v.result,C=j.COMPLETED;if(typeof y=="string")try{var P=JSON.parse(y);P.status==="failed"&&(C=j.FAILED)}catch(Z){}else ve()(y)==="object"&&(y==null?void 0:y.status)==="failed"&&(C=j.FAILED);ye(g,{result:y,status:C})},WITHWFSTATUS:function(v){var g=v.id,y=v.status,C={id:y.id,status:y.status,app_run_id:y.app_run_id,node_exec_id:y.node_exec_id,workflow_name:y.workflow_name,need_user_confirm:y.need_user_confirm,show_todo_button:y.show_todo_button,confirmer_name:y.confirmer_name},P;switch(y.status){case"running":P=j.RUNNING;break;case"waiting_confirm":P=j.WAITING_CONFIRMATION;break;case"completed":P=j.COMPLETED;break;case"failed":P=j.FAILED;break;default:P=j.RUNNING;break}ye(g,{workflow_confirmation:C,status:P,isWorkflow:!0})},WITHMCPTOOLFILES:function(v){var g=v.id,y=v.files_to_upload,C=v.args;ye(g,b()({uploaded_files:y||[],status:j.COMPLETED},C?{args:C}:{}))}},Ce=function(v,g){Se[v]=g},de=function(v){var g=v.data,y=J(g),C=le(g),P=g.indexOf("REPLY")!==-1&&g.indexOf("ENDREPLY")===-1,Z=g.indexOf("ABILITY")!==-1,G=g.indexOf("ENDCHAT")!==-1;if(C){if(!y)return;var xe=y[0],et=y[1],_e=Se[xe];_e?_e(et):console.warn("Unknown message type: ".concat(xe))}if(C||console.log(p.current,v),!C&&p.current&&(d.current+=g,requestAnimationFrame(function(){l.current&&(l.current.scrollTop=0),u.current&&(u.current.style.display="none")}),h(function(Q){var me=d.current,Te=b()(b()({},Q),{},{content:me});return me&&(Te.parsedContent=je(me)),Te}),$(g)),P&&C){var K=y[1];m&&m(!1);var D=c.current.filter(function(Q){return Q.agent_id==K})[0];o(function(Q){var me=Q;if(Object.keys(f).length&&ze(f,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var Te,st,O=b()({},f);if(((Te=O.activeMCPTools)===null||Te===void 0?void 0:Te.length)>0||((st=O.contentBlocks)===null||st===void 0?void 0:st.length)>0){var ft=we(O.contentBlocks||[],O.activeMCPTools||[],T);if(T&&ft.length>0){var pt=Lt(ft,T);pt?(O.content=pt,O.parsedContent=je(pt)):O.content&&(O.parsedContent=je(O.content))}else O.content&&(O.parsedContent=je(O.content));O.contentBlocks=ft}else O.content&&(O.parsedContent=je(O.content));me=Q.concat(O)}return d.current="",h({is_agent:1,icon:D==null?void 0:D.icon,name:D==null?void 0:D.name,content:"",activeMCPTools:[],agent_id:K,parsedContent:null,contentBlocks:[]}),p.current=!0,n(!0),L(!1),me})}if(Z&&C){var ue=y[1];h(function(Q){return b()(b()({},Q),{},{is_agent:1,ability_id:ue})})}if(G){if(p.current=!1,d.current="",e(!1),n(!1),L(!0),Object.keys(f).length){var Ve,Ae,F=b()({},f);if(((Ve=F.activeMCPTools)===null||Ve===void 0?void 0:Ve.length)>0||((Ae=F.contentBlocks)===null||Ae===void 0?void 0:Ae.length)>0){var U=we(F.contentBlocks||[],F.activeMCPTools||[],T);if(T&&U.length>0){var z=Lt(U,T);z?(F.content=z,F.parsedContent=je(z)):F.content&&(F.parsedContent=je(F.content))}else F.content&&(F.parsedContent=je(F.content));F.contentBlocks=U}else F.content&&(F.parsedContent=je(F.content));console.log(F),o(function(Q){return Q.concat(F)})}h({}),a("")}};return{getSocketMessage:de,addMessageHandler:Ce}},vn=function(e){var n=e.currentMessage,a=e.agentChatRoomId,r=e.intl,o=e.mcpTools,l=o===void 0?{}:o,u=e.updateMCPTool,c=u===void 0?function(){}:u,h=e.getMCPTool,f=h===void 0?function(){return null}:h,d=Ee(),p=d.setInstruction;return!n.name||!ze(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(Ke.Z,{data:n}):(0,t.jsx)(Ke.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,Je.Qy)("GET").nickname}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Zt,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:l,updateMCPTool:c,getMCPTool:f,item:b()(b()({},n),{},{parsedContent:je(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},hn=(0,x.memo)(function(s){var e=s.messageApi,n=s.setCurrentMessageContent,a=s.sendValue,r=s.agentList,o=s.scrollDomRef,l=s.upButtonDom,u=s.setIsStop,c=s.setisEnd,h=s.setSendValue,f=s.agentChatRoomId,d=s.updateMCPTool,p=s.getCurrentMessageList,I=s.mcpTools,_=I===void 0?{}:I,m=s.getMCPTool,T=m===void 0?function(){return null}:m,M=s.setIsWaitingReply,A=s.removeHistoryMessage,L=s.setCurrentMessageFromHistory,J=Ee(),le=J.setInstruction,Ie=(0,E.useIntl)(),Y=(0,E.useParams)(),$=Y.id,Pe=(0,E.useLocation)(),he=new URLSearchParams(Pe.search),nt=he.get("id"),ye=f||$||nt,we=(0,B.Z)(function(_e){return _e.setDisableInput}),Se=(0,x.useState)({}),Ce=N()(Se,2),de=Ce[0],k=Ce[1],v=(0,x.useRef)(!1),g=(0,x.useRef)(""),y=(0,x.useCallback)(function(_e){try{if(!_e||ve()(_e)!=="object"){console.warn("Invalid history message provided:",_e);return}if(_e.is_agent!==1){console.warn("Attempted to set non-agent message as current:",_e);return}var K=vt(_e,T);if(!K){console.warn("Failed to prepare history message:",_e);return}k(K),v.current=!0,g.current=K.content||""}catch(D){console.error("Failed to set current message from history:",D)}},[T]);(0,x.useEffect)(function(){L&&L(y)},[L,y]);var C=pn(we,u,h,e,n,o,l,r,k,de,g,v,d,p,M,T,A),P=C.getSocketMessage,Z=(0,fn.Z)("chat",P),G=Z.runSocket,xe=Z.sendMessage,et=Z.readyState;return(0,x.useEffect)(function(){et==1&&ye&&xe(JSON.stringify(["ENTER",parseInt(ye)]))},[et]),(0,x.useEffect)(function(){a&&et==1&&xe(a)},[a]),(0,x.useEffect)(function(){G()},[]),(0,t.jsx)(vn,{currentMessage:de,agentChatRoomId:f,intl:Ie,mcpTools:_,updateMCPTool:d,getMCPTool:T})}),gn=function(e){var n=e.type,a=n===void 0?"typing":n,r=e.size,o=r===void 0?"medium":r;if(a==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var l={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(u,c){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:b()(b()({},l),{},{animationDelay:"".concat(u,"s")})},c)})})]})}return a==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},xn=function(e){var n=e.autoRotate,a=n===void 0?!1:n,r=e.rotateInterval,o=r===void 0?3e3:r,l=e.initialType,u=l===void 0?"wave":l,c=e.size,h=c===void 0?"medium":c,f=(0,x.useState)(u),d=N()(f,2),p=d[0],I=d[1],_=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(gn,{type:p,size:h})})},_n=function(e){var n=e.isVisible,a=e.animationType,r=a===void 0?"pulse":a,o=e.enableAutoRotate,l=o===void 0?!0:o,u=(0,E.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(xn,{initialType:r,autoRotate:l,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:u.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},yn=(0,x.memo)(function(s){var e=s.messageApi,n=s.setUserMessage,a=s.sendValue,r=s.agentList,o=s.scrollDomRef,l=s.upButtonDom,u=s.setIsStop,c=s.setSendValue,h=s.agentChatRoomId,f=s.abilitiesList,d=s.mcpTools,p=s.updateMCPTool,I=s.getMCPTool,_=s.userMessage,m=Ee(),T=m.setInstruction,M=(0,x.useState)([]),A=N()(M,2),L=A[0],J=A[1],le=(0,x.useState)(!1),Ie=N()(le,2),Y=Ie[0],$=Ie[1],Pe=(0,x.useState)(!1),he=N()(Pe,2),nt=he[0],ye=he[1],we=(0,x.useRef)(!1),Se=(0,x.useRef)(null),Ce=(0,E.useParams)(),de=Ce.id,k=(0,E.useLocation)(),v=new URLSearchParams(k.search),g=v.get("id"),y=de||g;(0,x.useEffect)(function(){Y&&(n(function(P){return[].concat(ee()(L.reverse()),ee()(P))}),J([]),setTimeout(function(){$(!1),o.current.scrollTop=0},200))},[Y]),(0,x.useEffect)(function(){if(!we.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!Se.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var P=Ze(_);if(P){if(!P.id){console.warn("Found agent message without ID, skipping:",P),we.current=!0;return}if(Se.current(P),n){var Z=_.filter(function(G){return G!==P});n(Z)}else console.warn("setUserMessage not available for history update");we.current=!0}}catch(G){console.error("Failed to process history message:",G,{userMessageLength:_==null?void 0:_.length,hasCallback:!!Se.current}),we.current=!0}}},[_,n]),(0,x.useEffect)(function(){we.current=!1},[y]);var C=function(Z){if(n&&_){var G=_.filter(function(xe){return xe!==Z});n(G)}};return(0,t.jsxs)(t.Fragment,{children:[L.length?L.map(function(P,Z){return(0,t.jsx)(Ht,{item:P,index:Z,agentChatRoomId:h,abilitiesList:f,messageApi:e,id:y,idName:"currentContent",cidName:"currentChilContent",mcpTools:d,updateMCPTool:p,setInstruction:T,getMCPTool:I},Z)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(_n,{isVisible:nt}),(0,t.jsx)(hn,{messageApi:e,setCurrentMessageContent:J,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:l,setIsStop:u,setisEnd:$,setSendValue:c,agentChatRoomId:h,updateMCPTool:p,getCurrentMessageList:function(){return _||[]},mcpTools:d,getMCPTool:I,setIsWaitingReply:ye,removeHistoryMessage:C,setCurrentMessageFromHistory:function(Z){Se.current=Z},setInstruction:T})]})}),Cn=(0,x.memo)(function(s){var e=s.messageApi,n=s.scrollDomRef,a=s.instruction,r=s.setIsStop,o=s.upButtonDom,l=s.agentList,u=s.agentChatRoomId,c=s.abilitiesList,h=Ee(),f=h.setInstruction,d=(0,E.useIntl)(),p=(0,x.useState)(860),I=N()(p,2),_=I[0],m=I[1],T=(0,E.useParams)(),M=T.id,A=(0,E.useLocation)(),L=new URLSearchParams(A.search),J=L.get("id"),le=u||M||J,Ie=(0,x.useState)([]),Y=N()(Ie,2),$=Y[0],Pe=Y[1],he=(0,x.useRef)(!1),nt=(0,x.useState)(""),ye=N()(nt,2),we=ye[0],Se=ye[1],Ce=(0,x.useRef)(null),de=(0,x.useRef)(!0),k=(0,x.useState)({}),v=N()(k,2),g=v[0],y=v[1],C=(0,x.useRef)(2),P=(0,x.useRef)(1),Z=(0,x.useRef)(0),G=function(U,z){y(function(Q){var me=Q[U];return me?b()(b()({},Q),{},ce()({},U,b()(b()({},me),z))):b()(b()({},Q),{},ce()({},U,b()({id:U,status:j.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},z)))})},xe=function(U){return g[U]||null},et=function(U){var z,Q=U.files_to_upload&&Array.isArray(U.files_to_upload)&&U.files_to_upload.length>0,me=((z=U.args)===null||z===void 0?void 0:z.input_variables)&&Object.values(U.args.input_variables).some(function(Te){return Te==="need_upload"});return(Q||me)&&!U.result?j.WAITING_FILE_UPLOAD:ht(U.workflow_confirmation_status,U.result)},_e=function(U){var z=U.map(function(Q){var me=b()({},Q);if(Q.is_agent===1&&Q.content){var Te=je(Q.content);me.parsedContent=Te,Te.hasMCPTools&&Te.blocks.forEach(function(st){if(st.type==="mcp-tool"&&st.toolData){var O=st.toolData;if(!g[O.id]){var ft=et(O);y(function(pt){return b()(b()({},pt),{},ce()({},O.id,{id:O.id,name:O.name,skill_or_workflow_name:O.skill_or_workflow_name||O.name,workflow_run_id:O.workflow_run_id||0,workflow_confirmation_status:O.workflow_confirmation_status||null,args:O.args||{},result:O.result||null,status:ft,isWorkflow:O.skill_or_workflow_name?O.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:O.files_to_upload||[],uploaded_files:on(O)}))})}}})}return me});return z},K=function(){var F=H()(ne()().mark(function U(z){var Q,me,Te=arguments;return ne()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(Q=Te.length>1&&Te[1]!==void 0?Te[1]:function(){},!le){O.next=6;break}return O.next=4,(0,S.KH)(le,{page:P.current,page_size:10});case 4:me=O.sent,me.code==0&&(C.current=me.data.total_pages,z||(Ce.current.style.display="none"),Pe(function(ft){var pt=me.data.list.reverse(),Kt=_e(pt);return z?ee()(Kt):[].concat(ee()(ft),ee()(Kt))}),z?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):Z.current=me.data.list.length,de.current=!0);case 6:case"end":return O.stop()}},U)}));return function(z){return F.apply(this,arguments)}}(),D=function(U){var z=U.target.scrollHeight+(U.target.scrollTop-U.target.clientHeight);he.current!==Math.ceil(U.target.scrollTop)<-50&&(he.current=Math.ceil(U.target.scrollTop)<-50,o.current.style.display=he.current?"flex":"none"),z<10&&de.current&&(de.current=!1,P.current=P.current+1,Ce.current.style.display="flex",C.current>=P.current?K(!1):Ce.current.style.display="none")},ue=function(U,z){z==="0"&&(z=Number(z));var Q=["".concat(U),z!==""&&z!==null&&z!==void 0?z:null];Se(JSON.stringify(Q))},Ve=(0,B.Z)(function(F){return F.disableInput}),Ae=(0,B.Z)(function(F){return F.clearMemory});return(0,x.useEffect)(function(){Ae&&Ae.length&&ue(Ae[0],Ae[1])},[Ae]),(0,x.useEffect)(function(){a&&a.length&&(ue(a[0],a[1]!==void 0?a[1]:""),f([]))},[a]),(0,x.useEffect)(function(){P.current=1,K(!0)},[]),(0,x.useEffect)(function(){var F=function(){window.innerWidth<1280||m(window.innerWidth-320-(window.innerWidth-320)/2-88)};return F(),window.addEventListener("resize",F),function(){window.removeEventListener("resize",F)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:D,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:u?"":"".concat(_,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:$&&$.length?$.map(function(F,U){return(0,t.jsx)(Ht,{item:b()(b()({},F),{},{id:"c".concat(F.id)}),index:U,agentChatRoomId:u,abilitiesList:c,messageApi:e,id:le,idName:"content",cidName:"chilContent",mcpTools:g,updateMCPTool:G,getMCPTool:xe},U)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(yn,{messageApi:e,setUserMessage:Pe,sendValue:we,agentList:l,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:Se,agentChatRoomId:u,abilitiesList:c,mcpTools:g,updateMCPTool:G,getMCPTool:xe,userMessage:$})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!u&&!Ve&&$.length?(0,t.jsx)(it,{roomid:le}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:Ce,children:(0,t.jsx)(oe.Z,{})})]})})}),Mn=i(82114),bn=i(77171),jn=i(85576),Gt=i(96486),In=i(58299),Pn=i(38008),Tn=i(83062),Nn=function(e){var n=e.uploadedFiles,a=e.handleRemoveFile;return n.length?(0,t.jsx)(Ne.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,t.jsx)(w.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Tn.Z,{title:r.name,children:(0,t.jsx)("div",{className:"flex items-center",children:r.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(Ne.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Re.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(l){l.stopPropagation(),be(r.path_show||r.url,r.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Me.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Re.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(l){l.stopPropagation(),be(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},En=i(52645),wn=i(64317),An=function(e){var n=e.agentChatRoomId,a=e.abilitiesList,r=e.abilityId,o=e.setAbilityId,l=e.clearContext,u=(0,E.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,t.jsx)(wn.Z,{label:u.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:u.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(h){o(h)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(ge.ZP,{size:"small",color:"danger",variant:"outlined",onClick:l,icon:(0,t.jsx)(En.Z,{}),children:u.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},Fn=i(88484),On=i(30159),Sn=i(26915),Dn=Sn.Z.TextArea,Ln=function(e){var n=e.userSendvalue,a=e.setUserSendvalue,r=e.disableInput,o=e.isUploading,l=e.isStop,u=e.userSendmessage,c=e.handleFileUpload,h=e.sendMessage,f=e.stopChatRoom,d=(0,E.useIntl)(),p=(0,Gt.throttle)(function(){if(r||!n)return!1;h(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(ge.ZP,{type:"text",icon:(0,t.jsx)(Fn.Z,{}),onClick:c,disabled:r||o,loading:o}),(0,t.jsx)(Dn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(_){a(_.target.value)},onPressEnter:u,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(d.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),l?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:f,children:(0,t.jsx)(On.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:p,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Un=(0,x.memo)(function(s){var e,n=s.messageApi,a=s.isStop,r=s.scrollDomRef,o=s.upButtonDom,l=s.agentList,u=s.abilitiesList,c=s.agentChatRoomId,h=s.chatStatus,f=Ee(),d=f.setInstruction,p=(0,E.useIntl)(),I=(0,B.Z)(function(K){return K.disableInput}),_=(0,B.Z)(function(K){return K.setDisableInput}),m=(0,B.Z)(function(K){return K.setClearMemory}),T=(0,In.m)(),M=T.options,A=c?(0,Pn.Zc)().isImageSupportModel:function(){return!1},L=(0,x.useState)(null),J=N()(L,2),le=J[0],Ie=J[1],Y=(0,x.useState)(""),$=N()(Y,2),Pe=$[0],he=$[1],nt=(0,x.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),ye=N()(nt,2),we=ye[0],Se=ye[1],Ce=(0,Ye.ZP)({maxSizeMB:15,acceptedFileTypes:we,multiple:!0}),de=Ce.uploadedFiles,k=Ce.handleUpload,v=Ce.removeFile,g=Ce.clearFiles,y=Ce.isUploading;(0,x.useEffect)(function(){var K,D;if(c&&(l==null||(K=l.current)===null||K===void 0?void 0:K.length)>0&&l!==null&&l!==void 0&&(D=l.current[0])!==null&&D!==void 0&&(D=D.agent)!==null&&D!==void 0&&D.m_config_id){var ue,Ve=l==null||(ue=l.current[0])===null||ue===void 0||(ue=ue.agent)===null||ue===void 0?void 0:ue.m_config_id,Ae=A(Ve),F=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(Ae?",.jpg,.png,.jpeg":"");Se(F)}},[l,M,l==null||(e=l.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,A]);var C=function(){var D=jn.Z.confirm;D({title:p.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(Mn.Z,{}),content:p.formatMessage({id:"app.chatroom.clear.tips"}),okText:p.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:p.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){m(["TRUNCATE","0"])}})},P=function K(D,ue){if(D.length===0){ue&&ue();return}var Ve=_t()(D),Ae=Ve[0],F=Ve.slice(1);d(Ae),setTimeout(function(){K(F,ue)},100)},Z=function(D){var ue=[];(de==null?void 0:de.length)>0&&ue.push(["FILELIST",de.map(function(Ae){return Ae.file_id})]);var Ve=le||0;ue.push(["SETABILITY",Ve]),ue.push(["INPUT",D]),P(ue,function(){(de==null?void 0:de.length)>0&&g()})},G=function(D){!D.shiftKey&&D.target.value==""&&(n.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),he(""),D.preventDefault()),!D.shiftKey&&D.keyCode==13&&D.target.value!=""&&(_(!0),he(""),Z(D.target.value),D.preventDefault())},xe=(0,Gt.throttle)(function(){d(["STOP",null])},300),et=function(){I||k()},_e=function(D){if(!D){n.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}_(!0),Z(D),he("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:o,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(D){r.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(bn.Z,{className:"text-[16px]"})}),(0,t.jsx)(Nn,{uploadedFiles:de,handleRemoveFile:v}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(de.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(An,{agentChatRoomId:c,abilitiesList:u,abilityId:le,setAbilityId:Ie,clearContext:C}),(0,t.jsx)(Ln,{userSendvalue:Pe,setUserSendvalue:he,disableInput:I,isUploading:y,isStop:a,userSendmessage:G,handleFileUpload:et,sendMessage:_e,stopChatRoom:xe})]})]})}),Rn=(0,x.memo)(function(s){var e=s.agentList,n=s.agentChatRoomId,a=s.abilitiesList,r=s.chatStatus,o=Ee(),l=o.scrollDomRef,u=o.upButtonDom,c=o.isStop,h=o.setIsStop,f=o.instruction,d=o.setInstruction;(0,x.useEffect)(function(){console.log(r),r==1&&h(!0)},[r]);var p=Fe.ZP.useMessage(),I=N()(p,2),_=I[0],m=I[1];return(0,t.jsxs)(t.Fragment,{children:[m,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(Cn,{instruction:f,messageApi:_,scrollDomRef:l,setIsStop:h,upButtonDom:u,agentList:e,agentChatRoomId:n,abilitiesList:a}),(0,t.jsx)(Un,{messageApi:_,isStop:c,upButtonDom:u,scrollDomRef:l,agentList:e,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})}),Bn=(0,x.memo)(function(s){return(0,t.jsx)(mt,{agentChatRoomId:s.agentChatRoomId,children:(0,t.jsx)(Rn,b()({},s))})})},85877:function(gt,He,i){var De=i(19632),b=i.n(De),Ge=i(97857),N=i.n(Ge),Fe=i(5574),ae=i.n(Fe),x=i(52677),Le=i.n(x),ne=i(35312),Oe=i(78234),ee=i(77598),Ue=i(96486),H=i.n(Ue),X=i(67294),ce=i(73935),S=i(43413),B=i(92858),E=i(16845),oe=i(15425),q=i(85893),t=function(R){var W=R.children;return(typeof document=="undefined"?"undefined":Le()(document))==="object"?ce.createPortal(W,document.body):null},it=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ke=function(R){var W=R.value,se=R.onChange,fe=R.id,pe=R.placeholder,ie=R.options,Be=(0,ne.useIntl)(),tt=(0,X.useRef)(),xt=(0,X.useState)(),ve=ae()(xt,2),be=ve[0],ke=ve[1],lt=(0,X.useState)(0),ze=ae()(lt,2),We=ze[0],Ze=ze[1],ut=(0,X.useState)(""),ct=ae()(ut,2),vt=ct[0],Qe=ct[1],dt=(0,X.useCallback)(function(w){return(0,q.jsx)(Re,N()({},w))},[]),rt=(0,X.useCallback)(function(w){return(0,q.jsx)(ge,N()({},w))},[]),re=(0,X.useMemo)(function(){return Je((0,E.BU)((0,B.VC)((0,S.Jh)())))},[]),_t=(0,X.useState)(null),V=ae()(_t,2),at=V[0],Nt=V[1],Ut=(0,oe.Z)(function(w){return w.selectedNode}),Rt=(0,oe.Z)(function(w){return w.getOutputVariables}),Bt=(0,oe.Z)(function(w){return w.getInputVariables}),Et=(0,X.useState)([]),yt=ae()(Et,2),Xe=yt[0],bt=yt[1];(0,Oe.Z)(function(){W&&W.length>0&&Ct(W),ie!=null&&ie.length&&bt(ie.map(function(w){return N()(N()({},w),{},{name:w.label,id:w.value})}))}),(0,ee.Z)(function(){var w=H().isEqual(at,W);w||(W&&W.length>0?Ct(W):W&&H().isArray(W)&&W.length==0&&Ct([{type:"paragraph",children:[]}]))},[W,fe]),(0,ee.Z)(function(){ie.length&&bt(ie.map(function(w){return N()(N()({},w),{},{name:w.label,id:w.value})})),console.log(ie)},[ie]);var Ct=function(te){Nt(te),Mt(re,{nodes:[{type:"paragraph",children:[]}]}),Mt(re,{nodes:te})},wt=(0,X.useCallback)(function(w){if(be&&Xe.length>0)switch(w.key){case"ArrowDown":w.preventDefault();var te=We>=Xe.length-1?0:We+1;Ze(te);return;case"ArrowUp":w.preventDefault();var j=We<=0?Xe.length-1:We-1;Ze(j);return;case"Tab":case"Enter":w.preventDefault(),S.YR.select(re,be),Ne(re,Xe[We]),ke(null);return;case"Escape":w.preventDefault(),ke(null);return}else if(w.key==="@"){setTimeout(function(){return jt()},10);return}ke(null)},[Xe,re,We,be]),Mt=function(te){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ht=b()(te.children);if(ht.forEach(function(Ee){return te.apply({type:"remove_node",path:[0],node:Ee})}),j.nodes){var ot=S.NB.isNode(j.nodes)?[j.nodes]:j.nodes;ot.forEach(function(Ee,It){return te.apply({type:"insert_node",path:[It],node:Ee})})}var mt=j.at&&S.E9.isPoint(j.at)?j.at:S.ML.end(te,[]);mt&&S.YR.select(te,mt)};(0,X.useEffect)(function(){if(be&&Xe.length>0){var w=tt.current,te=E.F3.toDOMRange(re,be),j=te.getBoundingClientRect();w.style.top="".concat(j.top+window.pageYOffset+24,"px"),w.style.left="".concat(j.left+window.pageXOffset,"px")}},[Xe.length,re,We,vt,be]);var jt=function(){var te=re.selection;if(te&&S.e6.isCollapsed(te)){var j=S.e6.edges(te),ht=ae()(j,1),ot=ht[0],mt=S.ML.before(re,ot),Ee=mt&&S.ML.range(re,mt,ot),It=Ee&&S.ML.string(re,Ee),At=S.ML.after(re,ot),Ft=S.ML.range(re,ot,At),kt=S.ML.string(re,Ft);ke(Ee),Qe(""),Ze(0);return}ke(null)};return(0,q.jsxs)(E.mH,{editor:re,initialValue:Ye,onChange:function(te){se==null||se(te),ke(null)},children:[(0,q.jsx)(E.CX,{renderElement:dt,renderLeaf:rt,onKeyDown:wt,className:"!outline-none",placeholder:pe!=null?pe:Be.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),be&&(0,q.jsx)(t,{children:(0,q.jsx)("div",{ref:tt,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:Xe.length?Xe.map(function(w,te){return(0,q.jsx)("div",{onClick:function(){console.log(w),S.YR.select(re,be),Ne(re,w),ke(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:te===We?"#B4D5FF":""},children:(0,q.jsx)("span",{children:w.name})},w.name+te)}):(0,q.jsx)(q.Fragment,{children:Be.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Je=function(R){var W=R.isInline,se=R.isVoid,fe=R.markableVoid;return R.isInline=function(pe){return pe.type==="mention"?!0:W(pe)},R.isVoid=function(pe){return pe.type==="mention"?!0:se(pe)},R.markableVoid=function(pe){return pe.type==="mention"||fe(pe)},R},Ne=function(R,W){var se={type:"mention",id:(W==null?void 0:W.id)||"",character:W.name,base:W,children:[{bold:!0,text:"11111"}]};S.YR.insertNodes(R,se),S.YR.move(R)},ge=function(R){var W=R.attributes,se=R.children,fe=R.leaf;return(0,q.jsx)("span",N()(N()({},W),{},{children:se}))},Re=function(R){var W=R.attributes,se=R.children,fe=R.element;switch(fe.type){case"mention":return(0,q.jsx)(Me,N()({},R));default:return(0,q.jsx)("p",N()(N()({},W),{},{children:se}))}},Me=function(R){var W=R.attributes,se=R.children,fe=R.element,pe=(0,E.vt)(),ie=(0,E.UE)(),Be={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:pe&&ie?"0 0 0 2px #B4D5FF":"none"};return fe.children[0].bold&&(Be.fontWeight="bold"),fe.children[0].italic&&(Be.fontStyle="italic"),(0,q.jsx)("span",N()(N()({},W),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(fe.character.replace(" ","-")),style:Be,children:it?(0,q.jsxs)(X.Fragment,{children:["1",se,"/",fe.character]}):(0,q.jsxs)(X.Fragment,{children:[(0,q.jsx)("span",{children:fe.character}),se]})}))},Ye=[{type:"paragraph",children:[{text:""}]}];He.Z=Ke},38008:function(gt,He,i){i.d(He,{Zc:function(){return x},aS:function(){return ae}});var De=i(67294),b=i(85750),Ge=i(58299),N=i(85893),Fe=(0,De.createContext)(void 0),ae=function(Oe){var ee=Oe.children,Ue=(0,Ge.m)(),H=Ue.options,X=(0,De.useMemo)(function(){var ce=function(E){if(!E||!H)return!1;var oe=(0,b.ti)(E,{options:H});return(oe==null?void 0:oe.support_image)===1},S=function(E){return ce(E)};return{isImageSupportModel:ce,getCurrentModelImageSupport:S}},[H]);return(0,N.jsx)(Fe.Provider,{value:X,children:ee})},x=function(){var Oe=(0,De.useContext)(Fe);if(Oe===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return Oe},Le=null},77295:function(gt,He,i){i.d(He,{CO:function(){return H}});var De=i(15009),b=i.n(De),Ge=i(19632),N=i.n(Ge),Fe=i(99289),ae=i.n(Fe),x=i(5574),Le=i.n(x),ne=i(45360),Oe=i(35312),ee=i(67294),Ue=i(83065),H=function(S){var B,E=S==null||(B=S.split(".").pop())===null||B===void 0?void 0:B.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(E||"")},X=function(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=(0,Oe.useIntl)(),E=(0,ee.useState)([]),oe=Le()(E,2),q=oe[0],t=oe[1],it=(0,ee.useState)(!1),Ke=Le()(it,2),Je=Ke[0],Ne=Ke[1],ge=S.maxSizeMB,Re=ge===void 0?15:ge,Me=S.acceptedFileTypes,Ye=Me===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Me,$e=S.multiple,R=$e===void 0?!0:$e,W=function(){var ie=document.createElement("input");ie.type="file",ie.accept=Ye,ie.multiple=R,ie.onchange=function(){var Be=ae()(b()().mark(function tt(xt){var ve,be,ke,lt,ze,We,Ze,ut,ct,vt,Qe,dt,rt,re;return b()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(ve=xt.target,!(ve.files&&ve.files.length>0)){V.next=37;break}if(Ne(!0),be=Array.from(ve.files),ke=be.filter(function(at){return at.size/1024/1024>Re}),!(ke.length>0)){V.next=9;break}return ne.ZP.error("".concat(ke.map(function(at){return at.name}).join(", ")," ").concat(B.formatMessage({id:"workflow.uploadFileErrorText"}))),Ne(!1),V.abrupt("return");case 9:lt=[],ze=0,We=be;case 11:if(!(ze<We.length)){V.next=35;break}return Ze=We[ze],ut=new FormData,ut.append("file",Ze),V.prev=15,V.next=18,(0,Ue.M$)();case 18:return ct=V.sent,V.next=21,fetch(ct,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:ut});case 21:return vt=V.sent,V.next=24,vt.json();case 24:Qe=V.sent,Qe.code===0?(ne.ZP.success("".concat(Ze.name," ").concat(B.formatMessage({id:"workflow.uploadSuccess"}))),(dt=Qe.data)!==null&&dt!==void 0&&dt.file_id&&(rt=H(Ze.name),re={name:Ze.name,url:Qe.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:rt,file_id:Qe.data.file_id,path_show:Qe.data.file_url||Qe.data.path_show||""},lt.push(re))):ne.ZP.error("".concat(Ze.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"}))),V.next=32;break;case 28:V.prev=28,V.t0=V.catch(15),console.error("Upload error:",V.t0),ne.ZP.error("".concat(Ze.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"})));case 32:ze++,V.next=11;break;case 35:t(function(at){return[].concat(N()(at),lt)}),Ne(!1);case 37:case"end":return V.stop()}},tt,null,[[15,28]])}));return function(tt){return Be.apply(this,arguments)}}(),ie.click()},se=function(ie){t(function(Be){return Be.filter(function(tt){return tt.uid!==ie})})},fe=function(){t([])};return{uploadedFiles:q,setUploadedFiles:t,handleUpload:W,removeFile:se,clearFiles:fe,isUploading:Je}};He.ZP=X},58299:function(gt,He,i){i.d(He,{m:function(){return X}});var De=i(64599),b=i.n(De),Ge=i(97857),N=i.n(Ge),Fe=i(15009),ae=i.n(Fe),x=i(99289),Le=i.n(x),ne=i(73445),Oe=i(42237),ee=i(45360),Ue=i(67294),H=(0,ne.Ue)(function(ce){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var S=Le()(ae()().mark(function E(){var oe;return ae()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,ce({loading:!0}),t.next=4,(0,Oe.fZ)();case 4:if(oe=t.sent,oe.code!==0){t.next=9;break}ce({models:Array.isArray(oe.data.data)?oe.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(oe.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),ce({error:t.t0.message}),ee.ZP.error("Failed to fetch models");case 16:return t.prev=16,ce({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},E,null,[[0,12,16,19]])}));function B(){return S.apply(this,arguments)}return B}()}}),X=function(){var S=H(function(t){return t.models}),B=H(function(t){return t.loading}),E=H(function(t){return t.initialized}),oe=H(function(t){return t.fetchModels});(0,Ue.useEffect)(function(){E||oe()},[E,oe]);var q=(0,Ue.useMemo)(function(){var t=Array.isArray(S)?S:[],it=t.map(function(Me){return{label:Me.supplier_name,options:Array.isArray(Me.model_list)?Me.model_list.map(function(Ye){return N()({label:Ye.model_name,value:Ye.model_config_id},Ye)}):[]}}),Ke,Je=b()(t),Ne;try{for(Je.s();!(Ne=Je.n()).done;){var ge=Ne.value;if(Array.isArray(ge.model_list)){var Re=ge.model_list.find(function(Me){return Me.model_default_used===1});if(Re){Ke=Re.model_config_id;break}}}}catch(Me){Je.e(Me)}finally{Je.f()}return{options:it,defaultValue:Ke}},[S]);return N()(N()({},q),{},{loading:B})}}}]);
