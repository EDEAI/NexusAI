"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[106],{85422:function(je,X,e){var q=e(15009),O=e.n(q),ee=e(99289),b=e.n(ee),ae=e(5574),I=e.n(ae),te=e(11551),L=e(39873),se=e(28508),j=e(29933),R=e(76772),ne=e(3917),W=e(66309),oe=e(28036),z=e(71471),C=e(74330),f=e(26412),M=e(12845),w=e(67294),G=e(22683),J=e(97807),re=e(620),r=e(85893);X.Z=(0,w.memo)(function(N){var S,B,Z,h=N.data,le=N.onClose,m=(0,R.useIntl)(),H=(0,w.useState)(500),V=I()(H,2),K=V[0],ie=V[1],g=(0,ne.Z)(function(){var u=b()(O()().mark(function _(v,P){var k;return O()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,te.pC)(v,P);case 2:return k=U.sent,U.abrupt("return",k.data);case 4:case"end":return U.stop()}},_)}));return function(_,v){return u.apply(this,arguments)}}(),{manual:!0}),a=g.data,y=g.loading,s=g.run;(0,w.useEffect)(function(){h!=null&&h.app_id&&h!==null&&h!==void 0&&h.app_run_id&&s(h.app_id,h.app_run_id)},[h==null?void 0:h.app_id,h==null?void 0:h.app_run_id,s]);var d=function(_){var v={1:{color:"processing",text:m.formatMessage({id:"workflow.running"})},2:{color:"success",text:m.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:m.formatMessage({id:"workflow.runF"})}},P=v[_]||{color:"default",text:"Unknown"};return(0,r.jsx)(W.Z,{color:P.color,children:P.text})},c=function(_){ie(_)};return(0,r.jsx)(L.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:K,onChange:c,children:(0,r.jsx)(j.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,r.jsx)(oe.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:le,icon:(0,r.jsx)(se.Z,{})}),title:(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.detail"})}),loading:y,children:(0,r.jsx)("div",{className:"space-y-6",children:y?(0,r.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,r.jsx)(C.Z,{})}):a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.Z,{column:1,bordered:!0,size:"small",children:[(0,r.jsx)(f.Z.Item,{label:m.formatMessage({id:"workflow.user"}),children:a.nickname}),(0,r.jsx)(f.Z.Item,{label:m.formatMessage({id:"workflow.status"}),children:d(a.status)}),(0,r.jsx)(f.Z.Item,{label:m.formatMessage({id:"workflow.created_time"}),children:a.created_time}),(0,r.jsxs)(f.Z.Item,{label:m.formatMessage({id:"workflow.elapsed_time"}),children:[a.elapsed_time,"s"]}),(0,r.jsx)(f.Z.Item,{label:"Tokens",children:a.total_tokens})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.output"})}),a.outputs?(0,r.jsx)("div",{children:(a==null||(S=a.outputs)===null||S===void 0?void 0:S.type)=="json"?(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(re.Z,{language:"python3",value:JSON.parse((B=a.outputs)===null||B===void 0?void 0:B.value)||"{}",readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"JSON"})}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)(G.U,{rehypePlugins:[J.Z],children:((Z=a.outputs)===null||Z===void 0?void 0:Z.value)||""})})}):a.error?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,r.jsx)("div",{className:"text-red-500 font-medium mb-2",children:m.formatMessage({id:"agent.log.error"})}),(0,r.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:a.error})]}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:m.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(a==null?void 0:a.prompt_data)&&a.prompt_data.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.conversation"})}),(0,r.jsx)(M.Z,{className:"mt-2",children:a.prompt_data.map(function(u,_){var v=I()(u,2),P=v[0],k=v[1];return(0,r.jsx)(M.Z.Item,{color:P==="human"?"blue":"green",children:(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:P}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:k.value})]})},_)})})]})]}):null})})})})},68709:function(je,X,e){e.d(X,{Z:function(){return y}});var q=e(19632),O=e.n(q),ee=e(15009),b=e.n(ee),ae=e(99289),I=e.n(ae),te=e(97857),L=e.n(te),se=e(5574),j=e.n(se),R=e(11551),ne=e(61806),W=e(38008),oe=e(77295),z=e(39944),C=e(55927),f="agent_fullscreen_states",M=function(d){try{var c=localStorage.getItem(f);if(!c)return!1;var u=JSON.parse(c);return u[String(d)]||!1}catch(_){return console.warn("Failed to get agent fullscreen state:",_),!1}},w=function(d,c){try{var u=localStorage.getItem(f),_=u?JSON.parse(u):{};_[String(d)]=c,localStorage.setItem(f,JSON.stringify(_)),console.log("Agent ".concat(d," fullscreen state saved: ").concat(c))}catch(v){console.warn("Failed to save agent fullscreen state:",v)}},G=function(d){try{var c=localStorage.getItem(f);if(!c)return;var u=JSON.parse(c);delete u[String(d)],localStorage.setItem(f,JSON.stringify(u)),console.log("Agent ".concat(d," fullscreen state cleared"))}catch(_){console.warn("Failed to clear agent fullscreen state:",_)}},J=function(){try{var d=localStorage.getItem(f);return d?JSON.parse(d):{}}catch(c){return console.warn("Failed to get all agent fullscreen states:",c),{}}},re=function(){try{localStorage.removeItem(f),console.log("All agent fullscreen states cleared")}catch(d){console.warn("Failed to clear all agent fullscreen states:",d)}},r=e(58299),N=e(85750),S=e(19078),B=e(5785),Z=e(34994),h=e(76772),le=e(77598),m=e(45360),H=e(74330),V=e(66309),K=e(28036),ie=e(32983),g=e(67294),a=e(85893),y=(0,g.memo)(function(s){var d,c,u,_,v,P,k=(0,g.useState)([]),de=j()(k,2),U=de[0],ce=de[1],Ze=(0,g.useState)(!0),Se=j()(Ze,2),ma=Se[0],Ke=Se[1],$e=(0,g.useState)(1),be=j()($e,2),_a=be[0],ze=be[1],Ge=(0,g.useState)(!0),Pe=j()(Ge,2),Je=Pe[0],He=Pe[1],Ve=(0,g.useState)(!1),ye=j()(Ve,2),ge=ye[0],De=ye[1],ke=(0,g.useState)(!1),Ie=j()(ke,2),va=Ie[0],me=Ie[1],Ye=(0,g.useState)(!1),Oe=j()(Ye,2),Re=Oe[0],we=Oe[1],Qe=(0,g.useState)(!1),Ae=j()(Qe,2),Xe=Ae[0],_e=Ae[1],qe=(0,g.useState)(!1),Te=j()(qe,2),A=Te[0],ve=Te[1],fe=(0,g.useRef)(),ea=(0,g.useRef)(null),aa=(0,g.useRef)(null),F=(0,h.useIntl)(),he=(0,C.Z)(function(i){return i.getTypedMessages("chat_message_llm_return")}),ta=(0,g.useState)(null),Le=j()(ta,2),Ce=Le[0],sa=Le[1],pe=(0,C.Z)(function(i){return i.getTypedLastMessage("chat_message_llm_return")}),na=(0,g.useState)(null),Ne=j()(na,2),Y=Ne[0],ra=Ne[1],la=(0,r.m)(),ue=la.options,ia=function(n){if(!n||!ue)return"\u672A\u77E5\u6A21\u578B";var l=(0,N.ti)(n,{options:ue});return(l==null?void 0:l.label)||"\u672A\u77E5\u6A21\u578B"},oa=function(n){if(!n||!ue)return!1;var l=(0,N.ti)(n,{options:ue});return(l==null?void 0:l.support_image)===1},ua=function(){var n,l=(n=s.data)===null||n===void 0||(n=n.detailList)===null||n===void 0||(n=n.agent)===null||n===void 0?void 0:n.agent_id;if(l){var o=!A;ve(o),w(l,o)}else console.warn("Cannot save fullscreen state: agentId is not available"),ve(function(E){return!E})};(0,g.useEffect)(function(){var i;if(((i=s.data)===null||i===void 0||(i=i.detailList)===null||i===void 0||(i=i.app)===null||i===void 0?void 0:i.name)!=null){var n;console.log(s.data);var l=s.data.detailList.agent_chatroom_id,o=s.data.detailList.agent.agent_id;if(l){var E=window.location.search,x=new URLSearchParams(E);sa(l),x.set("id",String(l));var t="".concat(window.location.pathname,"?").concat(x.toString()).concat(window.location.hash);window.history.replaceState({},"",t)}var T=L()(L()({},s.data.detailList.app),{},{agent:s.data.detailList.agent,agent_id:o});if(console.log("AgentInfo updated:",{m_config_id:(n=T.agent)===null||n===void 0?void 0:n.m_config_id,agent_id:T.agent_id,name:T.name}),ra(T),o){var p=M(o);console.log("Restoring fullscreen state for agent ".concat(o,": ").concat(p)),ve(p)}setTimeout(function(){He(!1)},500)}},[(d=s.data)===null||d===void 0||(d=d.detailList)===null||d===void 0||(d=d.app)===null||d===void 0?void 0:d.name,(c=s.data)===null||c===void 0||(c=c.detailList)===null||c===void 0||(c=c.agent)===null||c===void 0?void 0:c.m_config_id]);var Q=(0,oe.ZP)(),Ue=Q.uploadedFiles,fa=Q.setUploadedFiles,ha=Q.handleUpload,pa=Q.removeFile,da=Q.clearFiles,Ma=Q.isUploading,Me=function(){var n;(n=ea.current)===null||n===void 0||n.scrollIntoView({behavior:"smooth"})},Fe=function(){var i=I()(b()().mark(function n(){var l,o,E;return b()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,we(!0),!(s!=null&&(l=s.saveInfo)!==null&&l!==void 0&&l.firstjudgingcondition())){t.next=6;break}return t.abrupt("return",!0);case 6:if(!(s!=null&&(o=s.saveInfo)!==null&&o!==void 0&&o.secondjudgingcondition())){t.next=10;break}return t.abrupt("return",!0);case 10:return t.next=12,s==null||(E=s.saveInfo)===null||E===void 0?void 0:E.agentupdata();case 12:return t.abrupt("return",t.sent);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(0),console.error("Failed to save info:",t.t0),t.abrupt("return",!1);case 19:return t.prev=19,we(!1),t.finish(19);case 22:case"end":return t.stop()}},n,null,[[0,15,19,22]])}));return function(){return i.apply(this,arguments)}}();(0,le.Z)(function(){var i,n=pe==null?void 0:pe.data;if(n&&!((n==null?void 0:n.agent_id)!==((i=s.data)===null||i===void 0||(i=i.detailList)===null||i===void 0||(i=i.agent)===null||i===void 0?void 0:i.agent_id)&&!m.ZP.error)){var l=L()(L()({},n),{},{id:n.message_id});he&&he.length>0&&(me(!1),ce(function(o){return[].concat(O()(o),[l])}),setTimeout(Me,100))}},[he]),(0,g.useEffect)(function(){!ge&&U.length>0&&Me()},[ge]);var ca=function(){var i=I()(b()().mark(function n(l){var o,E,x,t,T,p,Ee,We,xe,Be;return b()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(console.log(l),t=(o=fe.current)===null||o===void 0?void 0:o.getFieldsValue(),!(!t||!((E=l.content)!==null&&E!==void 0&&E.trim()))){D.next=4;break}return D.abrupt("return");case 4:return T=s.data.detailList.agent.agent_id,p=s.data.detailList.agent.input_variables,Ee=t.ability_id,We=new z.z({user:{value:t.content}}),xe=Ue.map(function($){return{name:$.name,url:$.url||$.path_show||""}}),Be={id:Date.now(),content:l.content,isUser:!0,ability_id:Ee,agent_id:T,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:t.content,prompt_tokens:0,total_tokens:0,file_list:xe.length>0?xe:void 0},me(!0),ce(function($){return[].concat(O()($),[Be])}),(x=fe.current)===null||x===void 0||x.resetFields(["content"]),D.prev=13,D.next=16,(0,R.CY)({agent_id:T,input_dict:p,ability_id:Ee,prompt:We,file_list:Ue.map(function($){return $.file_id})});case 16:da(),D.next=23;break;case 19:D.prev=19,D.t0=D.catch(13),me(!1),m.ZP.error(F.formatMessage({id:"agent.chat.send.failed"}));case 23:setTimeout(Me,100);case 24:case"end":return D.stop()}},n,null,[[13,19]])}));return function(l){return i.apply(this,arguments)}}(),Ea=function(){var i=I()(b()().mark(function n(){var l,o,E;return b()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((l=s.data)!==null&&l!==void 0&&(l=l.detailList)!==null&&l!==void 0&&(l=l.agent)!==null&&l!==void 0&&l.agent_id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,De(!0),t.next=6,(0,R.CU)(String(s.data.detailList.agent.agent_id),1);case 6:E=t.sent,(o=E.data)!==null&&o!==void 0&&o.list&&(ce(E.data.list),Ke(E.data.total_pages>1),ze(1)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("Failed to fetch initial messages:",t.t0);case 13:return t.prev=13,De(!1),t.finish(13);case 16:case"end":return t.stop()}},n,null,[[2,10,13,16]])}));return function(){return i.apply(this,arguments)}}();if(ge)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(H.Z,{})});var ga=function(){var i=I()(b()().mark(function n(){return b()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,_e(!0),o.next=4,Fe();case 4:setTimeout(I()(b()().mark(function E(){var x,t;return b()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,(0,R.Dh)((x=s.data)===null||x===void 0||(x=x.detailList)===null||x===void 0||(x=x.agent)===null||x===void 0?void 0:x.agent_id);case 3:t=p.sent,t.code==0?m.ZP.success(F.formatMessage({id:"agent.message.success.publish"})):m.ZP.error(F.formatMessage({id:"agent.message.fail.publish"})),p.next=11;break;case 7:p.prev=7,p.t0=p.catch(0),console.error("Failed to publish agent:",p.t0),m.ZP.error(F.formatMessage({id:"agent.message.fail.publish"}));case 11:return p.prev=11,_e(!1),p.finish(11);case 14:case"end":return p.stop()}},E,null,[[0,7,11,14]])})),500),o.next=11;break;case 7:o.prev=7,o.t0=o.catch(0),console.error("Failed to save before publish:",o.t0),_e(!1);case 11:case"end":return o.stop()}},n,null,[[0,7]])}));return function(){return i.apply(this,arguments)}}();return Je?null:(0,a.jsx)("div",{ref:aa,className:"".concat(A?"fixed inset-0 z-50 !h-screen  border border-gray-300 top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:A?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,a.jsxs)(Z.A,{formRef:fe,submitter:!1,onFinish:ca,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[(0,a.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,a.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(u=s.data)===null||u===void 0||(u=u.detailList)===null||u===void 0||(u=u.app)===null||u===void 0?void 0:u.name,A&&(Y==null||(_=Y.agent)===null||_===void 0?void 0:_.m_config_id)&&(0,a.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[ia(Y.agent.m_config_id),oa(Y.agent.m_config_id)&&(0,a.jsx)(V.Z,{color:"blue",className:"text-xs",children:F.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})})]})})]}),(0,a.jsx)(K.ZP,{type:"text",icon:A?(0,a.jsx)(S.Z,{}):(0,a.jsx)(B.Z,{}),onClick:ua,title:F.formatMessage({id:A?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),s.operationbentate=="false"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.ZP,{type:"primary",disabled:s.operationbentate!="false",loading:Re,onClick:Fe,className:"min-w-24",children:F.formatMessage({id:"agent.btn.savedebug"})}),(0,a.jsx)(K.ZP,{type:"primary",disabled:s.operationbentate!="false",loading:Xe||Re,onClick:ga,className:"min-w-24",children:F.formatMessage({id:"agent.publish"})})]})]}),Ce?(0,a.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(A?"max-w-[1400px] mx-auto justify-center":""),style:{height:A?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,a.jsx)(W.aS,{children:(0,a.jsx)(ne.F,{agentList:{current:[Y]},abilitiesList:(v=s.data)===null||v===void 0?void 0:v.abilitiesList,agentChatRoomId:Ce,chatStatus:(P=s.data)===null||P===void 0||(P=P.detailList)===null||P===void 0?void 0:P.chat_status})})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(ie.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})},27842:function(je,X,e){var q=e(5574),O=e.n(q),ee=e(15009),b=e.n(ee),ae=e(99289),I=e.n(ae),te=e(11551),L=e(29608),se=e(83535),j=e(76772),R=e(67294),ne=e(85422),W=e(85893),oe=null,z=null;X.ZP=function(C){var f=C.agent_id,M=(0,j.useIntl)(),w=(0,j.useSearchParams)(),G=O()(w,1),J=G[0],re=(0,R.useRef)(null),r=(0,R.useState)(null),N=O()(r,2),S=N[0],B=N[1],Z=(0,R.useState)(!1),h=O()(Z,2),le=h[0],m=h[1],H=J.get("app_id"),V=function(){m(!1)},K=function(y){B({app_id:H,app_run_id:y.id}),m(!0)},ie=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:M.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:M.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:M.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:M.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:M.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:M.formatMessage({id:"workflow.created_time_des",defaultMessage:M.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(M.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:M.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:M.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],g=(0,L.Z)(function(a){return a.setRunPanelLogRecord});return(0,W.jsxs)("div",{className:"h-full",children:[(0,W.jsx)(se.Z,{columns:ie,formRef:re,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var a=I()(b()().mark(function y(s,d,c){var u;return b()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return console.log(s,d,c),v.next=3,(0,te.My)(H,{page:s.current,page_size:s.pageSize});case 3:return u=v.sent,console.log(u),v.abrupt("return",{data:u.data.list,success:!0,total:u.data.total_count});case 6:case"end":return v.stop()}},y)}));return function(y,s,d){return a.apply(this,arguments)}}(),onRow:function(y){return{onClick:function(){K(y)},className:(S==null?void 0:S.app_run_id)===y.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:M.formatMessage({id:"agent.log.list"})}),le&&(S==null?void 0:S.app_id)&&(S==null?void 0:S.app_run_id)&&(0,W.jsx)(ne.Z,{data:S,onClose:V})]})}}}]);
