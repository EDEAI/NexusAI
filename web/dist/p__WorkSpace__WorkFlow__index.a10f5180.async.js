"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(wt,ye,t){var We=t(5574),Z=t.n(We),Ae=t(42881),Y=t(67294),ne=t(85893),y=function(w){var Oe=w.children,V=w.className,K=V===void 0?"":V,oe=w.dragDirection,le=oe===void 0?"left":oe,we=w.minWidth,Me=we===void 0?415:we,pe=w.maxWidth,B=pe===void 0?820:pe,re=w.minHeight,i=re===void 0?200:re,ae=w.maxHeight,be=ae===void 0?800:ae,G=w.defaultWidth,Se=G===void 0?415:G,u=w.defaultHeight,H=u===void 0?300:u,e=w.onChange,Q=(0,Y.useState)(Se),Ce=Z()(Q,2),Re=Ce[0],he=Ce[1],_e=(0,Y.useState)(H),se=Z()(_e,2),rt=se[0],Ve=se[1],it=(0,Y.useCallback)(function(Ge,Be){he(Ge),Be&&Ve(Be),e==null||e(Ge,Be)},[he,Ve,e]),Le=(0,Ae.W)({direction:["left","right"].includes(le)?"horizontal":"vertical",triggerDirection:le,minWidth:Me,maxWidth:B,minHeight:i,maxHeight:be,onResize:it}),Ie=Le.triggerRef,Pe=Le.containerRef;return(0,ne.jsxs)("div",{ref:Pe,style:{width:["left","right"].includes(le)?"".concat(Re,"px"):void 0,height:["top","bottom"].includes(le)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(K),children:[le==="left"&&(0,ne.jsx)("div",{ref:Ie,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ne.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),le==="right"&&(0,ne.jsx)("div",{ref:Ie,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ne.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),le==="top"&&(0,ne.jsx)("div",{ref:Ie,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ne.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),le==="bottom"&&(0,ne.jsx)("div",{ref:Ie,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ne.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),Oe]})};ye.Z=(0,Y.memo)(y)},36711:function(wt,ye,t){t.r(ye),t.d(ye,{waitTime:function(){return pe},waitTimePromise:function(){return Me}});var We=t(97857),Z=t.n(We),Ae=t(5574),Y=t.n(Ae),ne=t(15009),y=t.n(ne),Ke=t(99289),w=t.n(Ke),Oe=t(42237),V=t(29608),K=t(32592),oe=t(35312),le=t(67294),we=t(85893),Me=function(){var B=w()(y()().mark(function re(){var i,ae=arguments;return y()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return i=ae.length>0&&ae[0]!==void 0?ae[0]:100,G.abrupt("return",new Promise(function(Se){setTimeout(function(){Se(!0)},i)}));case 2:case"end":return G.stop()}},re)}));return function(){return B.apply(this,arguments)}}(),pe=function(){var B=w()(y()().mark(function re(){var i,ae=arguments;return y()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return i=ae.length>0&&ae[0]!==void 0?ae[0]:100,G.next=3,Me(i);case 3:case"end":return G.stop()}},re)}));return function(){return B.apply(this,arguments)}}();ye.default=function(){var B=(0,oe.useIntl)(),re=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:B.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var Q;u==null||(Q=u.current)===null||Q===void 0||Q.submit()}}},{title:B.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:B.formatMessage({id:"workflow.created_time_des",defaultMessage:B.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:B.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var Q;u==null||(Q=u.current)===null||Q===void 0||Q.submit()}},valueEnum:{1:{text:B.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:B.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:B.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(B.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:B.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:B.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],i=(0,oe.useSearchParams)(),ae=Y()(i,1),be=ae[0],G=(0,V.Z)(function(H){return H.setRunPanelLogRecord}),Se=be.get("app_id"),u=(0,le.useRef)(null);return(0,we.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,we.jsx)("div",{children:(0,we.jsx)(K.Z,{columns:re,formRef:u,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var H=w()(y()().mark(function e(Q,Ce,Re){var he;return y()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return console.log(Q,Ce,Re),se.next=3,(0,Oe.bB)(Z()(Z()({app_runs_name:"",app_runs_status:0},Q),{},{app_id:Se}));case 3:return he=se.sent,console.log(he),se.abrupt("return",{data:he.data.list,success:!0,total:he.data.total_count});case 6:case"end":return se.stop()}},e)}));return function(e,Q,Ce){return H.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),G(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:B.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},53971:function(wt,ye,t){t.r(ye),t.d(ye,{default:function(){return pa}});var We=t(15009),Z=t.n(We),Ae=t(99289),Y=t.n(Ae),ne=t(97857),y=t.n(ne),Ke=t(5574),w=t.n(Ke),Oe=t(32060),V=t(42237),K=t(35312),oe=t(63648),le=t(16091),we=t(13118),Me=t(78234),pe=t(77598),B=t(45360),re=t(85576),i=t(67294),ae=t(64599),be=t.n(ae),G=t(7493),Se=t(34559),u=t(15425),H=t(96906),e=t(85893),Q=function(r){return{nodes:r.nodes,edges:r.edges,onNodesChange:r.onNodesChange,onEdgesChange:r.onEdgesChange,onConnect:r.onConnect,nodeTypes:r.nodeTypes,connectionLineStyle:r.connectionLineStyle,defaultViewport:r.defaultViewport,onDrop:r.onDrop,onDragOver:r.onDragOver,setSelect:r.setSelect,preventScrolling:r.preventScrolling}},Ce=(0,i.memo)(function(d){var r=d.children,l=(0,K.useIntl)(),c=(0,u.Z)(function(s){return s.nodes}),g=(0,u.Z)(function(s){return s.getEdges}),v=(0,u.Z)(function(s){return s.edges}),k=(0,u.Z)(function(s){return s.setEdges}),o=(0,u.Z)(function(s){return s.onNodesChange}),n=(0,u.Z)(function(s){return s.onEdgesChange}),p=(0,u.Z)(function(s){return s.onConnect}),S=(0,u.Z)(function(s){return s.nodeTypes}),U=(0,u.Z)(function(s){return s.connectionLineStyle}),W=(0,u.Z)(function(s){return s.defaultViewport}),F=(0,u.Z)(function(s){return s.onDrop}),_=(0,u.Z)(function(s){return s.onDragOver}),f=(0,u.Z)(function(s){return s.setSelect}),h=(0,u.Z)(function(s){return s.preventScrolling}),z=(0,i.useCallback)(function(s){var D=c.find(function(N){return N.id===s.target}),M=function N(A){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(j.has(A.id))return!1;j.add(A.id);var E=be()((0,G.xA)(A,c,v)),O;try{for(E.s();!(O=E.n()).done;){var X=O.value;if(X.id===s.source||N(X,j))return!0}}catch(fe){E.e(fe)}finally{E.f()}};return D.id===s.source?!1:!M(D)},[c,v]),de=function(){},C=(0,i.useCallback)(function(s,D){console.log(s,D,g(),(0,G.Kz)(s,D,v)),k((0,G.Kz)(s,D,g()))},[]);return(0,pe.Z)(function(){},[c]),(0,e.jsx)(Se.tV,{children:(0,e.jsx)(oe.x$,{onViewportChange:de,nodes:c,edges:v,onNodesChange:o,onEdgesChange:n,onEdgesDelete:function(D){},onConnect:p,onReconnect:C,nodeTypes:S,minZoom:.3,maxZoom:1,connectionLineStyle:U,snapToGrid:!1,isValidConnection:z,connectionRadius:30,preventScrolling:h,onDragOver:_,onPaneClick:function(){f("")},onPaneContextMenu:function(D){D.preventDefault()},onSelectionChange:function(D){},onNodeClick:function(D,M){f(M.id)},onEdgeClick:function(D,M){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(D){},onBeforeDelete:function(){var s=Y()(Z()().mark(function D(M){var N;return Z()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if((M==null||(N=M.nodes)===null||N===void 0||(N=N[0])===null||N===void 0?void 0:N.type)!=H.vW.Start){j.next=3;break}return B.ZP.error(l.formatMessage({id:"workflow.delStartNodeError"})),j.abrupt("return",Promise.reject(l.formatMessage({id:"workflow.delStartNodeError"})));case 3:return f(""),j.abrupt("return",Promise.resolve(M));case 5:case"end":return j.stop()}},D)}));return function(D){return s.apply(this,arguments)}}(),fitView:!0,children:r})})}),Re=function(r){var l=(0,i.useCallback)(function(v){v.preventDefault(),v.dataTransfer.dropEffect="move"},[]),c=(0,i.useCallback)(function(v){v.preventDefault();var k=v.dataTransfer.getData("application/reactflow");if(!k)return null;var o=JSON.parse(k),n=o.type,p=o.item;if(!n||!p)return null;var S=r({x:v.clientX,y:v.clientY});return{position:S,type:n,item:p}},[r]),g=(0,i.useCallback)(function(v){var k=function(n){var p=c(n);p&&v(p.position,p.type,p.item)};return document.addEventListener("dragover",l),document.addEventListener("drop",k),function(){document.removeEventListener("dragover",l),document.removeEventListener("drop",k)}},[l,c]);return{onDnD:g}},he=Re,_e=function(){var r=(0,u.Z)(function(o){return o.setAgentData}),l=(0,u.Z)(function(o){return o.setSkillData}),c=(0,u.Z)(function(o){return o.setToolData}),g=(0,u.Z)(function(o){return o.setDatasetData}),v=(0,u.Z)(function(o){return o.setTeamDatasetData}),k=(0,u.Z)(function(o){return o.setModelOptionsData});(0,i.useEffect)(function(){(0,V.x$)(2).then(function(o){o.code===0&&r({team:o.data})}),(0,V.x$)(3).then(function(o){o.code===0&&r({user:o.data})}),(0,V.w)(2).then(function(o){o.code===0&&l({team:o.data})}),(0,V.w)(3).then(function(o){o.code===0&&l({user:o.data})}),(0,V.GZ)().then(function(o){o.code===0&&c({list:Object.values(o.data)})}),(0,V.fZ)().then(function(o){var n,p=Array.isArray(o==null||(n=o.data)===null||n===void 0?void 0:n.data)?o.data.data:[],S=p.map(function(h){return{label:h.supplier_name,options:Array.isArray(h.model_list)?h.model_list.map(function(z){return{label:z.model_name,value:z.model_config_id}}):[]}}),U,W=be()(p),F;try{for(W.s();!(F=W.n()).done;){var _=F.value;if(Array.isArray(_.model_list)){var f=_.model_list.find(function(h){return h.model_default_used===1});if(f){U=f.model_config_id;break}}}}catch(h){W.e(h)}finally{W.f()}k({options:S,defaultValue:U})}),(0,V.mG)().then(function(o){o.code==0&&g({list:o.data.data.map(function(n){return y()(y()({},n),{},{label:n.name,value:n.dataset_id})})})}),(0,V.mG)(2).then(function(o){o.code==0&&v({list:o.data.data.map(function(n){return y()(y()({},n),{},{label:n.name,value:n.dataset_id})})})})},[r,l,c])},se=_e,rt=t(18032),Ve=(0,i.memo)(function(d){var r=d.onSubmit,l=d.onClose;return(0,e.jsx)(rt.default,{onSubmit:r,onClose:l})}),it=t(19632),Le=t.n(it),Ie=t(9783),Pe=t.n(Ie),Ge=t(39873),Be=t(22352),Zt=t(40110),lt=t(34994),Wt=t(86615),At=t(5966),Ot=t(62370),Rt=t(96638),Lt=t(74330),Bt=t(11941),Ft=t(87718),st=t(69386),Ht=t(96486),dt=t(63680),$t=t(63783),Je=t(83062),ut=t(99510),ct=(0,i.memo)(function(d){var r=d.children,l=d.onDragStart,c=d.onClick,g=d.type,v=d.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(o){return l(o,g,v)},onClick:c,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:r})}),Ut=(0,i.memo)(function(d){var r,l,c,g=d.item,v=d.onDragStart,k=d.typeBadge,o=d.onItemClick;return(0,e.jsx)(Je.Z,{placement:"right",title:(g==null||(r=g.baseData)===null||r===void 0?void 0:r.description)||(g==null||(l=g.data)===null||l===void 0?void 0:l.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(ct,{onDragStart:v,type:g.type,item:g,onClick:function(){return o==null?void 0:o(g)},children:(0,e.jsx)(ut.Z,{title:g.data.title,icon:(g==null||(c=g.baseData)===null||c===void 0?void 0:c.icon)||g.type,typeBadge:k})})})})}),zt=(0,i.memo)(function(d){var r,l=d.item,c=d.onDragStart,g=d.typeBadge,v=d.onItemClick;return(0,e.jsx)(Je.Z,{placement:"right",title:(r=l.baseData)===null||r===void 0?void 0:r.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(ct,{onDragStart:c,type:l.type,item:l,onClick:function(){return v==null?void 0:v(l)},children:(0,e.jsx)(ut.Z,{title:l.baseData.name,icon:l.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:l.baseData.nickname}),typeBadge:g})})})})}),Kt=(0,i.memo)(function(d){var r,l,c,g,v,k,o,n,p,S,U,W,F,_,f=d.tool,h=d.category,z=d.onDragStart,de=d.typeBadge,C=d.onItemClick,s=d.categoryIndex,D=d.toolIndex,M=(0,K.getLocale)()==="en-US"?"en_US":"zh_Hans",N=(0,dt.o6)()[H.vW.Tool],A=y()(y()({},f),{},{authorization_status:h==null?void 0:h.authorization_status,title:f==null||(r=f.identity)===null||r===void 0?void 0:r.label[M],icon:h==null||(l=h.identity)===null||l===void 0?void 0:l.icon,groupName:h==null||(c=h.identity)===null||c===void 0?void 0:c.name,credentials_for_provider:h==null?void 0:h.credentials_for_provider}),j={title:f==null||(g=f.identity)===null||g===void 0?void 0:g.label[M],desc:(f==null||(v=f.description)===null||v===void 0||(v=v.human)===null||v===void 0?void 0:v[M])||(f==null||(k=f.description)===null||k===void 0?void 0:k.llm),icon:h==null||(o=h.identity)===null||o===void 0?void 0:o.icon,data:{title:f==null||(n=f.identity)===null||n===void 0?void 0:n.label[M],desc:(f==null||(p=f.description)===null||p===void 0||(p=p.human)===null||p===void 0?void 0:p[M])||(f==null||(S=f.description)===null||S===void 0?void 0:S.llm),icon:h==null||(U=h.identity)===null||U===void 0?void 0:U.icon},baseData:A};return(0,e.jsx)(Je.Z,{placement:"right",title:f==null||(W=f.description)===null||W===void 0||(W=W.human)===null||W===void 0?void 0:W[M],children:(0,e.jsx)("div",{children:(0,e.jsx)(ct,{onDragStart:z,type:H.vW.Tool,item:j,onClick:function(){return C==null?void 0:C(h,f,s,D)},children:(0,e.jsx)(ut.Z,{title:f==null||(F=f.identity)===null||F===void 0?void 0:F.label[M],icon:h==null||(_=h.identity)===null||_===void 0?void 0:_.icon,typeBadge:de})})})})}),_t=(0,i.memo)(function(d){var r,l,c=d.category,g=d.onDragStart,v=d.typeBadge,k=d.onItemClick,o=d.categoryIndex,n=(0,K.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[c==null||(r=c.identity)===null||r===void 0?void 0:r.label[n],(0,e.jsx)(Je.Z,{placement:"right",title:c==null||(l=c.identity)===null||l===void 0?void 0:l.description[n],children:(0,e.jsx)($t.Z,{className:"cursor-pointer ml-1"})})]}),c.tools.map(function(p,S){return(0,e.jsx)(Kt,{tool:p,category:c,onDragStart:g,typeBadge:v,onItemClick:function(W,F,_,f){return k==null?void 0:k(W,F,_,f)},categoryIndex:o,toolIndex:S},S)})]})}),Vt=function(r){var l=r.list,c=r.onDragStart,g=r.type,v=g===void 0?"normal":g,k=r.typeBadge,o=k===void 0?null:k,n=r.onItemClick;return l!=null&&l.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:v==="tools"?l.map(function(p,S){return(0,e.jsx)(_t,{category:p,typeBadge:o,onDragStart:c,onItemClick:n,categoryIndex:S},S)}):v==="workflow"?l.map(function(p,S){return(0,e.jsx)(zt,{item:p,onDragStart:c,typeBadge:o,onItemClick:n},S)}):l.map(function(p,S){return(0,e.jsx)(Ut,{item:p,onDragStart:c,typeBadge:o,onItemClick:n},S)})}):null},Gt=(0,i.memo)(Vt),Jt=t(26474),bt=t(47520),Yt=t(36711),Qt=t(82826),xt=t(43425),Xt=t(48869),qt=t(69243),ea=t(91806),Ye=t(52688),ta=t(55241),aa=t(50136),vt=t(43586),na=function(){var r,l=(0,K.useIntl)(),c=(0,i.useState)(!0),g=w()(c,2),v=g[0],k=g[1],o=(0,u.Z)(function(j){return j.setWorkflowEditInfo}),n=(0,u.Z)(function(j){return j.workFlowInfo}),p=(0,u.Z)(function(j){return j.setSelect}),S=(0,i.useState)("1"),U=w()(S,2),W=U[0],F=U[1],_=(0,i.useState)(!1),f=w()(_,2),h=f[0],z=f[1],de=(0,vt.Z)(),C=(0,i.useRef)(null),s=function(){var E,O;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(lt.A,{formRef:C,submitter:{render:function(){return null}},onValuesChange:M,layout:"horizontal",children:[(0,e.jsx)(Ye.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Ye.Z,{tooltip:(n==null||(E=n.app)===null||E===void 0?void 0:E.publish_status)!="1"?{title:l.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(n==null||(O=n.app)===null||O===void 0?void 0:O.publish_status)!="1",name:"enable_api",label:"API"})]})})})},D=[{key:"4",icon:(0,e.jsx)(Qt.Z,{}),label:l.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:n!=null&&n.isProd?(0,e.jsx)(xt.Z,{}):(0,e.jsx)(ta.Z,{content:s,trigger:"click",forceRender:!0,placement:"rightTop",title:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(xt.Z,{})}),label:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:n==null?void 0:n.isProd},{key:"1",icon:(0,e.jsx)(Xt.Z,{}),label:l.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(qt.Z,{}),label:l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:h?l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):l.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!h},{key:"3",icon:(0,e.jsx)(ea.Z,{}),label:l.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,pe.Z)(function(){if(n){var j,E,O,X,fe=n==null||(j=n.app)===null||j===void 0?void 0:j.is_public,ue=n==null||(E=n.app)===null||E===void 0?void 0:E.enable_api,me={};me.is_public=!!fe,me.enable_api=(n==null||(O=n.app)===null||O===void 0?void 0:O.publish_status)=="1"?!!ue:!1,console.log(me),z(me.enable_api),C==null||(X=C.current)===null||X===void 0||X.setFieldsValue(me)}},[n]);var M=function(E,O){console.log(E,O),N(O.enable_api),o(O),setTimeout(de,300)},N=function(E){z(!!E)},A=function(E){var O;switch(E.key){case"4":K.history.go(-1);break;case"0":break;case"2":window.open(bt._n+(n==null||(O=n.app)===null||O===void 0?void 0:O.api_url),"_blank");break;default:p(""),F(E.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(W==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(aa.Z,{defaultSelectedKeys:["1"],selectedKeys:[W],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:v,items:D,onClick:A}),W=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(lt.A,{formRef:C,submitter:{render:function(){return null}},onValuesChange:M,layout:"horizontal",children:[(0,e.jsx)(Ye.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Ye.Z,{disabled:!(n!=null&&(r=n.app)!==null&&r!==void 0&&r.api_url),name:"enable_api",label:"API"})]})})})]}),W=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(Yt.default,{})})})]})},oa=na,ft=t(71471),ra=(0,i.memo)(function(d){var r=d.name,l=d.description,c=d.publishStatus,g=(0,K.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ft.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:r}),c&&(0,e.jsxs)(ft.Z.Text,{className:"whitespace-normal",children:["(",g.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ft.Z.Text,{className:"whitespace-normal text-gray-500",children:l})]})}),ia=(0,i.memo)(function(d){var r=d.visibleTabs,l=d.defaultActiveTab,c=d.showTeamSwitch,g=c===void 0?!0:c,v=d.workflowName,k=d.workflowDesc,o=d.publishStatus,n=d.onWidthChange,p=(0,K.useIntl)(),S=(0,K.getLocale)()=="en-US"?"en_US":"zh_Hans",U=(0,dt.o6)(),W=Object.values(U).filter(function(a){return![H.vW.Start,H.vW.Agent,H.vW.Tool,H.vW.Skill].includes(a.base.type)}).map(function(a){return a.base}),F=(0,i.useState)(l||"1"),_=w()(F,2),f=_[0],h=_[1],z=(0,i.useState)(W),de=w()(z,2),C=de[0],s=de[1],D=(0,i.useState)([]),M=w()(D,2),N=M[0],A=M[1],j=(0,Jt.v)(),E=j.tags,O=(0,Rt.Z)(Pe()(Pe()(Pe()({},H.vW.Agent,[]),H.vW.Skill,[]),"workflow",[])),X=w()(O,2),fe=X[0],ue=X[1],me=(0,i.useState)({team:1,keyword:"",tag:[]}),je=w()(me,2),I=je[0],Fe=je[1],Xe=(0,i.useState)(!1),qe=w()(Xe,2),Ne=qe[0],et=qe[1],tt=(0,i.useState)(!1),at=w()(tt,2),He=at[0],mt=at[1],Te=(0,u.Z)(function(a){return a.toolData});(0,i.useEffect)(function(){A((Te==null?void 0:Te.list)||[])},[Te]);var Ee=(0,i.useCallback)(function(a,m,x){console.log("onDragStart",a,m,x),a.dataTransfer.setData("application/reactflow",JSON.stringify({type:m,item:x})),a.dataTransfer.effectAllowed="move"},[]),nt=(0,i.useCallback)(function(a,m){if(!m)return a;var x=new st.Z(a,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),$=x.search(m);return $.map(function(b){return b.item})},[]),$e=(0,i.useCallback)(function(a,m){if(!m)return a;var x=a.map(function(T){var P;return y()(y()({},T),{},{tools:(P=T.tools)===null||P===void 0?void 0:P.map(function(ce){var R,ge;return y()(y()({},ce),{},{categoryName:(R=T.identity)===null||R===void 0||(R=R.label)===null||R===void 0?void 0:R[S],categoryIcon:(ge=T.identity)===null||ge===void 0?void 0:ge.icon})})})}),$=new st.Z(x,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),b=$.search(m);return b.map(function(T){return y()(y()({},T.item),{},{tools:T.item.tools.filter(function(P){var ce=new st.Z([P],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return ce.search(m).length>0})})}).filter(function(T){return T.tools.length>0})},[S]),xe=(0,i.useMemo)(function(){var a=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return I.keyword?nt(C,I.keyword):C}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Ue(H.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return I.keyword?$e(N,I.keyword):N}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var x=Y()(Z()().mark(function b(){return Z()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,Ue(H.vW.Skill);case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}},b)}));function $(){return x.apply(this,arguments)}return $}()},{tabKey:"workflow",label:"workflow.list",defaultMessage:"Workflow",type:"workflow",getData:function(){var x=Y()(Z()().mark(function b(){return Z()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,Ue("workflow");case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}},b)}));function $(){return x.apply(this,arguments)}return $}()}],m=r!=null&&r.length?a.filter(function(x){return r.includes(x.tabKey)}):a;return m.map(function(x,$){return y()(y()({},x),{},{key:$+1+""})})},[C,fe,N,r,I,nt,$e]),gt=(0,i.useMemo)(function(){return xe.map(function(a,m){return{key:a.key,label:p.formatMessage({id:a.label,defaultMessage:a.defaultMessage})}})},[xe]),pt=(0,i.useCallback)(function(a){var m=a.tabIndex,x=a.showName,$=x===void 0?!0:x,b=xe.find(function(L){return L.key===m}),T=(0,i.useState)([]),P=w()(T,2),ce=P[0],R=P[1],ge=(0,i.useState)(!0),J=w()(ge,2),De=J[0],St=J[1],ha=(0,i.useState)([]),Ct=w()(ha,2),ze=Ct[0],jt=Ct[1],ya=(0,i.useState)(20),wa=w()(ya,1),kt=wa[0],ba=(0,i.useState)(500),Mt=w()(ba,2),It=Mt[0],Pt=Mt[1],ke=(0,i.useRef)(null),xa=54;(0,i.useEffect)(function(){var L=function(){if(ke.current){var ee=ke.current.clientHeight;Pt(ee)}},q=function(ee){Pt(ee.detail.height)};return L(),ke.current&&ke.current.addEventListener("containerResize",q),window.addEventListener("resize",L),function(){ke.current&&ke.current.removeEventListener("containerResize",q),window.removeEventListener("resize",L)}},[]),(0,i.useEffect)(function(){var L=function(){var q=Y()(Z()().mark(function ie(){var ee,ve;return Z()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return St(!0),te.prev=1,te.next=4,b.getData();case 4:ee=te.sent,ve=(ee==null?void 0:ee.map(function(Et,yt){return y()(y()({},Et),{},{id:"".concat(b.tabKey,"-").concat(yt)})}))||[],R(ve),jt(ve.slice(0,kt)),te.next=13;break;case 10:te.prev=10,te.t0=te.catch(1),console.error("Failed to fetch data:",te.t0);case 13:return te.prev=13,St(!1),te.finish(13);case 16:case"end":return te.stop()}},ie,null,[[1,10,13,16]])}));return function(){return q.apply(this,arguments)}}();L()},[b,I]);var Da=function(q){if(q.currentTarget.scrollHeight-q.currentTarget.scrollTop===It){var ie=ze.length;if(ie<ce.length){var ee=ce.slice(ie,ie+kt);jt(function(ve){return[].concat(Le()(ve),Le()(ee))})}}},Nt=(0,i.useCallback)(function(L,q,ie,ee){switch(console.log("Clicked category:",L),console.log("Clicked item:",q),console.log("Indices:",ie,ee),b.tabKey){case"tool":if(ie!==void 0&&ee!==void 0){var ve,Ze;console.log("Tool ".concat((ve=q.identity)===null||ve===void 0?void 0:ve.label[S]," in category ").concat((Ze=L.identity)===null||Ze===void 0?void 0:Ze.label[S]))}break;case"workflow":break;case"agent":break}},[b.tabKey,S]),Tt=(0,i.memo)(function(L){var q=L.data,ie=L.index,ee=L.onDragStart,ve=L.onItemClick,Ze=L.type,te=L.typeBadge;return(0,e.jsx)(Gt,{typeBadge:te,list:[q],onDragStart:ee,type:Ze,onItemClick:function(yt){return ve(yt)}})});return(0,e.jsx)("div",{ref:ke,className:"overflow-y-auto h-full",children:(0,e.jsx)(Lt.Z,{spinning:De,children:I!=null&&I.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:ze.map(function(L){return(0,e.jsx)(Tt,{data:L,index:ze.indexOf(L),onDragStart:Ee,onItemClick:Nt,type:b.type,typeBadge:I!=null&&I.keyword&&b.tabKey!="node"?{icon:"/icons/".concat(b.tabKey,".svg"),tooltip:b.tabKey,color:"#1b64f3"}:void 0},L.id)})}):(0,e.jsx)(Ft.Z,{data:ze,height:It,itemHeight:xa,itemKey:"id",onScroll:Da,children:function(q){return(0,e.jsx)(Tt,{data:q,index:ze.indexOf(q),onDragStart:Ee,onItemClick:Nt,type:b.type,typeBadge:I!=null&&I.keyword&&b.tabKey!="node"?{icon:"/icons/".concat(b.tabKey,".svg"),tooltip:b.tabKey,color:"#1b64f3"}:void 0})}})})})},[f,I,Ne]),Ue=(0,i.useCallback)(function(){var a=Y()(Z()().mark(function m(x){var $,b,T,P;return Z()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,(0,V.RE)(x,{search_type:I.team,apps_name:I.keyword,tag_ids:(($=I.tag)===null||$===void 0?void 0:$.join(","))||""});case 3:if(T=R.sent,!((T==null?void 0:T.code)===0&&T!==null&&T!==void 0&&(b=T.data)!==null&&b!==void 0&&(b=b.list)!==null&&b!==void 0&&b.length)){R.next=8;break}return P=T.data.list.map(function(ge){var J,De;return y()(y()({},(J=U[x])===null||J===void 0?void 0:J.base),{},{data:y()(y()({},(De=U[x])===null||De===void 0?void 0:De.base.data),{},{title:ge.name,desc:ge.description}),baseData:ge})}),ue(Pe()({},x,P)),R.abrupt("return",P);case 8:R.next=13;break;case 10:R.prev=10,R.t0=R.catch(0),console.error("Failed to fetch ".concat(x," data:"),R.t0);case 13:case"end":return R.stop()}},m,null,[[0,10]])}));return function(m){return a.apply(this,arguments)}}(),[I]),ot=(0,i.useCallback)((0,Ht.debounce)(function(a){Fe(a)},500),[]),ht=(0,i.useCallback)(function(a,m){"team"in a?(Fe(m),m.team==2):("tag"in a||"keyword"in a)&&ot(m)},[ot]);return(0,e.jsx)(Ge.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:He?100:315,onChange:function(m,x){requestAnimationFrame(function(){et(m<100),n==null||n(m);var $=document.querySelectorAll(".overflow-y-auto");$.forEach(function(b){if(b instanceof HTMLElement){var T=b.clientHeight,P=new CustomEvent("containerResize",{detail:{height:T,width:m}});b.dispatchEvent(P)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[!He&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(lt.A,{submitter:!1,initialValues:I,onValuesChange:ht,children:[g&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[p.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Wt.Z.Group,{name:"team",fieldProps:{options:[{label:p.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:p.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(At.Z,{fieldProps:{prefix:(0,e.jsx)(Zt.Z,{}),placeholder:p.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Ot.Z,{name:"tag",children:(0,e.jsx)(Be.O,{className:"w-full",options:E,listStyle:Ne?"horizontal":"vertical",allowClear:!0,placeholder:p.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(m){}})})})]}),I!=null&&I.keyword?null:(0,e.jsx)(Bt.Z,{activeKey:f,items:gt,onChange:function(m){h(m)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:I!=null&&I.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:xe.map(function(a,m){return(0,e.jsxs)("div",{className:"space-y-2",children:[!He&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:p.formatMessage({id:a.label,defaultMessage:a.defaultMessage})}),(0,e.jsx)(pt,{tabIndex:m+1+"",showName:!Ne},a.key)]},a.key)})}):(0,e.jsx)(pt,{tabIndex:f,showName:!Ne})}),(0,e.jsx)(oa,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(ra,{name:v,description:k,publishStatus:o})})]})})}),la=t(74842),sa=t(98165),da=t(58638),Qe=t(28036),ua=t(27484),ca=t.n(ua),va=(0,i.memo)(function(){var d=(0,K.useIntl)(),r=(0,K.useSearchParams)(),l=w()(r,1),c=l[0],g=(0,u.Z)(function(C){return C.setWorkFlowInfo}),v=(0,u.Z)(function(C){return C.workFlowInfo}),k=(0,u.Z)(function(C){return C.setRunPanelShow}),o=c.get("type")=="true",n=(0,vt.Z)(),p=B.ZP.useMessage(),S=w()(p,2),U=S[0],W=S[1],F=(0,u.Z)(function(C){return C.loadingWorkflowData}),_=function(){var C=Y()(Z()().mark(function s(){var D;return Z()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,n();case 2:D=c.get("app_id"),(0,V.aJ)(D).then(function(A){console.log(A),A.code==0&&(g(y()(y()({},v),{},{app:y()(y()({},v==null?void 0:v.app),{},{publish_status:"1"})})),U.open({type:"success",content:d.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return N.stop()}},s)}));return function(){return C.apply(this,arguments)}}(),f=function(){k(!0)},h=function(){var C=Y()(Z()().mark(function s(){var D,M;return Z()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return D=c.get("app_id"),A.next=3,(0,V.Uq)(D);case 3:M=A.sent;case 4:case"end":return A.stop()}},s)}));return function(){return C.apply(this,arguments)}}(),z=function(){var C=Y()(Z()().mark(function s(){var D,M,N,A;return Z()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:M=c.get("app_id"),N=(v==null||(D=v.app)===null||D===void 0?void 0:D.name)||"workflow",A=ca()().format("YYYY_MM_DD-HH_mm_ss"),(0,V.w8)(M,o==!0?1:0).then(function(O){var X=new Blob([O],{type:"text/yaml"}),fe=URL.createObjectURL(X),ue=document.createElement("a");ue.href=fe,ue.download="".concat(N,"_").concat(A,".yml"),document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(fe)});case 4:case"end":return E.stop()}},s)}));return function(){return C.apply(this,arguments)}}(),de={name:"file",fileList:null,action:bt._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!o&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Qe.ZP,{type:"primary",disabled:F,onClick:_,children:d.formatMessage({id:"workflow.release"})}),(0,e.jsx)(Qe.ZP,{icon:(0,e.jsx)(la.Z,{}),disabled:F,onClick:f,children:d.formatMessage({id:"workflow.run"})}),(0,e.jsx)(Qe.ZP,{icon:(0,e.jsx)(sa.Z,{}),type:"dashed",disabled:F,onClick:n,children:d.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(Qe.ZP,{icon:(0,e.jsx)(da.Z,{}),type:"dashed",onClick:z,disabled:F,children:d.formatMessage({id:"workflow.export",defaultMessage:""})}),W]})}),Dt=t(64458),fa=function(){var r,l,c=(0,K.useIntl)(),g=(0,i.useRef)(null),v=(0,u.Z)(function(a){return a.resetNodes}),k=(0,u.Z)(function(a){return a.setNodeTypes}),o=(0,u.Z)(function(a){return a.addNode}),n=(0,u.Z)(function(a){return a.createNode}),p=(0,u.Z)(function(a){return a.setNodes}),S=(0,u.Z)(function(a){return a.setEdges}),U=(0,u.Z)(function(a){return a.setAppId}),W=(0,u.Z)(function(a){return a.setRunPanelShow}),F=(0,u.Z)(function(a){return a.runPanelShow}),_=(0,u.Z)(function(a){return a.getModelData}),f=(0,u.Z)(function(a){return a.setWorkFlowInfo}),h=(0,u.Z)(function(a){return a.setHandleList}),z=(0,u.Z)(function(a){return a.workFlowInfo}),de=(0,u.Z)(function(a){return a.setWorkflowEditInfo}),C=B.ZP.useMessage(),s=w()(C,2),D=s[0],M=s[1],N=(0,oe._K)(),A=N.screenToFlowPosition,j=N.getNodes,E=N.setViewport,O=he(A),X=O.onDnD,fe=(0,K.useSearchParams)(),ue=w()(fe,1),me=ue[0],je=me.get("type")=="true",I=(0,u.Z)(function(a){return a.setLoadingWorkflowData}),Fe=(0,oe.B)({includeHiddenNodes:!1}),Xe=(0,we.Z)(),qe=(0,vt.Z)(),Ne=(0,i.useState)(null),et=w()(Ne,2),tt=et[0],at=et[1],He=(0,i.useState)(!1),mt=w()(He,2),Te=mt[0],Ee=mt[1],nt=(0,i.useState)(""),$e=w()(nt,2),xe=$e[0],gt=$e[1],pt=null;(0,oe.CV)({onEnd:function(m){}}),(0,Me.Z)(function(){k((0,dt.$P)()),v(),(0,Oe.b6)(),Ue(),h([])}),se(),(0,i.useEffect)(function(){if(tt){K.history.push(xe);return}var a=K.history.block(function(m,x){if(F){gt(m.location.pathname),Ee(!0);return}});return F||a==null||a(),function(){a==null||a()}},[F,tt]),(0,pe.Z)(function(){if(Fe){var a=j(),m=a[a.length-1];m.data.drag&&(m.position={x:m.position.x-m.measured.width/2,y:m.position.y-m.measured.height/2},p(a))}},[Fe]),(0,i.useEffect)(function(){var a=X(function(m,x,$){console.log(m,x,$),n(x,{position:m,data:y()(y()({drag:!0},$.data),{},{baseData:$.baseData})})});return a},[X,o]),(0,pe.Z)(function(){Xe=="hidden"&&qe()},[Xe]);var Ue=function(){var a=Y()(Z()().mark(function m(){var x;return Z()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:x=me.get("app_id"),je&&D.open({type:"warning",content:c.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),I(!0),U(x),(0,V.kE)(x,je?1:0).then(function(T){if(T.code==0){if(f(y()(y()({},T.data),{},{isProd:je})),!T.data.workflow.graph){I(!1),n(H.vW.Start);return}var P=T.data,ce=P.workflow.graph,R=ce.edges,ge=ce.nodes,J=ce.views,De=P.app;de({enable_api:!!De.enable_api,is_public:!!De.is_public}),J!=null&&J.nodes&&p(J.nodes),J!=null&&J.edges&&S(J.edges),J!=null&&J.viewPort,setTimeout(function(){I(!1)},1e3)}}),_();case 6:case"end":return b.stop()}},m)}));return function(){return a.apply(this,arguments)}}(),ot=function(){at(!0),console.log(xe),K.history.push(xe),Ee(!1)},ht=function(){Ee(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[M,(0,e.jsx)(re.Z,{title:c.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Te,onOk:ot,onCancel:ht,children:c.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:g,children:(0,e.jsxs)(Ce,{children:[(0,e.jsx)(oe.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(oe.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(ia,{visibleTabs:["node","agent","skill","tool"],workflowName:z==null||(r=z.app)===null||r===void 0?void 0:r.name,workflowDesc:z==null||(l=z.app)===null||l===void 0?void 0:l.description,publishStatus:je}),(0,e.jsx)(va,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Ve,{})]})},ma=(0,i.memo)(function(){return(0,e.jsx)(oe.tV,{children:(0,e.jsx)(fa,{})})}),ga=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(ma,{})})},pa=ga}}]);
