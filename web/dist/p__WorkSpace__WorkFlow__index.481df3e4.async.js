"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(kt,xe,a){var Be=a(5574),_=a.n(Be),He=a(42881),ee=a(67294),se=a(85893),y=function(C){var $e=C.children,Q=C.className,X=Q===void 0?"":Q,ae=C.dragDirection,me=ae===void 0?"left":ae,De=C.minWidth,Ze=De===void 0?115:De,ye=C.maxWidth,K=ye===void 0?820:ye,ce=C.minHeight,i=ce===void 0?200:ce,ne=C.maxHeight,Se=ne===void 0?800:ne,q=C.defaultWidth,ke=q===void 0?415:q,v=C.defaultHeight,z=v===void 0?300:v,e=C.onChange,te=(0,ee.useState)(ke),je=_()(te,2),Fe=je[0],be=je[1],Qe=(0,ee.useState)(z),ge=_()(Qe,2),dt=ge[0],qe=ge[1],ut=(0,ee.useCallback)(function(Ue,_e){be(Ue),_e&&qe(_e),e==null||e(Ue,_e)},[be,qe,e]),et=(0,He.W)({direction:["left","right"].includes(me)?"horizontal":"vertical",triggerDirection:me,minWidth:Ze,maxWidth:K,minHeight:i,maxHeight:Se,onResize:ut}),We=et.triggerRef,ct=et.containerRef;return(0,se.jsxs)("div",{ref:ct,style:{width:["left","right"].includes(me)?"".concat(Fe,"px"):void 0,height:["top","bottom"].includes(me)?"".concat(dt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(X),children:[me==="left"&&(0,se.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,se.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),me==="right"&&(0,se.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,se.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),me==="top"&&(0,se.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,se.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),me==="bottom"&&(0,se.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,se.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),$e]})};xe.Z=(0,ee.memo)(y)},36711:function(kt,xe,a){a.r(xe),a.d(xe,{waitTime:function(){return ye},waitTimePromise:function(){return Ze}});var Be=a(97857),_=a.n(Be),He=a(5574),ee=a.n(He),se=a(15009),y=a.n(se),Xe=a(99289),C=a.n(Xe),$e=a(42237),Q=a(29608),X=a(83535),ae=a(35312),me=a(67294),De=a(85893),Ze=function(){var K=C()(y()().mark(function ce(){var i,ne=arguments;return y()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return i=ne.length>0&&ne[0]!==void 0?ne[0]:100,q.abrupt("return",new Promise(function(ke){setTimeout(function(){ke(!0)},i)}));case 2:case"end":return q.stop()}},ce)}));return function(){return K.apply(this,arguments)}}(),ye=function(){var K=C()(y()().mark(function ce(){var i,ne=arguments;return y()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return i=ne.length>0&&ne[0]!==void 0?ne[0]:100,q.next=3,Ze(i);case 3:case"end":return q.stop()}},ce)}));return function(){return K.apply(this,arguments)}}();xe.default=function(){var K=(0,ae.useIntl)(),ce=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:K.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var te;v==null||(te=v.current)===null||te===void 0||te.submit()}}},{title:K.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:K.formatMessage({id:"workflow.created_time_des",defaultMessage:K.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:K.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var te;v==null||(te=v.current)===null||te===void 0||te.submit()}},valueEnum:{1:{text:K.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:K.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:K.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(K.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:K.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:K.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],i=(0,ae.useSearchParams)(),ne=ee()(i,1),Se=ne[0],q=(0,Q.Z)(function(z){return z.setRunPanelLogRecord}),ke=Se.get("app_id"),v=(0,me.useRef)(null);return(0,De.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,De.jsx)("div",{children:(0,De.jsx)(X.Z,{columns:ce,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var z=C()(y()().mark(function e(te,je,Fe){var be;return y()().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return console.log(te,je,Fe),ge.next=3,(0,$e.bB)(_()(_()({app_runs_name:"",app_runs_status:0},te),{},{app_id:ke}));case 3:return be=ge.sent,console.log(be),ge.abrupt("return",{data:be.data.list,success:!0,total:be.data.total_count});case 6:case"end":return ge.stop()}},e)}));return function(e,te,je){return z.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),q(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:K.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(kt,xe,a){a.r(xe),a.d(xe,{default:function(){return Ca}});var Be=a(15009),_=a.n(Be),He=a(99289),ee=a.n(He),se=a(97857),y=a.n(se),Xe=a(5574),C=a.n(Xe),$e=a(32060),Q=a(42237),X=a(35312),ae=a(63648),me=a(16091),De=a(13118),Ze=a(78234),ye=a(77598),K=a(45360),ce=a(85576),i=a(67294),ne=a(64599),Se=a.n(ne),q=a(7493),ke=a(34559),v=a(15425),z=a(96906),e=a(85893),te=function(s){return{nodes:s.nodes,edges:s.edges,onNodesChange:s.onNodesChange,onEdgesChange:s.onEdgesChange,onConnect:s.onConnect,nodeTypes:s.nodeTypes,connectionLineStyle:s.connectionLineStyle,defaultViewport:s.defaultViewport,onDrop:s.onDrop,onDragOver:s.onDragOver,setSelect:s.setSelect,preventScrolling:s.preventScrolling}},je=(0,i.memo)(function(l){var s=l.children,d=(0,X.useIntl)(),f=(0,v.Z)(function(c){return c.nodes}),b=(0,v.Z)(function(c){return c.getEdges}),r=(0,v.Z)(function(c){return c.edges}),S=(0,v.Z)(function(c){return c.setEdges}),n=(0,v.Z)(function(c){return c.onNodesChange}),o=(0,v.Z)(function(c){return c.onEdgesChange}),m=(0,v.Z)(function(c){return c.onConnect}),D=(0,v.Z)(function(c){return c.nodeTypes}),N=(0,v.Z)(function(c){return c.connectionLineStyle}),j=(0,v.Z)(function(c){return c.defaultViewport}),$=(0,v.Z)(function(c){return c.onDrop}),Z=(0,v.Z)(function(c){return c.onDragOver}),u=(0,v.Z)(function(c){return c.setSelect}),g=(0,v.Z)(function(c){return c.preventScrolling}),L=(0,i.useCallback)(function(c){var O=f.find(function(T){return T.id===c.target}),p=function T(R){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(k.has(R.id))return!1;k.add(R.id);var E=Se()((0,q.xA)(R,f,r)),M;try{for(E.s();!(M=E.n()).done;){var de=M.value;if(de.id===c.source||T(de,k))return!0}}catch(fe){E.e(fe)}finally{E.f()}};return O.id===c.source?!1:!p(O)},[f,r]),ve=function(){},F=(0,i.useCallback)(function(c,O){console.log(c,O,b(),(0,q.Kz)(c,O,r)),S((0,q.Kz)(c,O,b()))},[]);return(0,ye.Z)(function(){},[f]),(0,e.jsx)(ke.tV,{children:(0,e.jsx)(ae.x$,{onViewportChange:ve,nodes:f,edges:r,onNodesChange:n,onEdgesChange:o,onEdgesDelete:function(O){},onConnect:m,onReconnect:F,nodeTypes:D,minZoom:.3,maxZoom:1,connectionLineStyle:N,snapToGrid:!1,isValidConnection:L,connectionRadius:30,preventScrolling:g,onDragOver:Z,onPaneClick:function(){u("")},onPaneContextMenu:function(O){O.preventDefault()},onSelectionChange:function(O){},onNodeClick:function(O,p){u(p.id)},onEdgeClick:function(O,p){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(O){},onBeforeDelete:function(){var c=ee()(_()().mark(function O(p){var T;return _()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if((p==null||(T=p.nodes)===null||T===void 0||(T=T[0])===null||T===void 0?void 0:T.type)!=z.vW.Start){k.next=3;break}return K.ZP.error(d.formatMessage({id:"workflow.delStartNodeError"})),k.abrupt("return",Promise.reject(d.formatMessage({id:"workflow.delStartNodeError"})));case 3:return u(""),k.abrupt("return",Promise.resolve(p));case 5:case"end":return k.stop()}},O)}));return function(O){return c.apply(this,arguments)}}(),fitView:!0,children:s})})}),Fe=function(s){var d=(0,i.useCallback)(function(r){r.preventDefault(),r.dataTransfer.dropEffect="move"},[]),f=(0,i.useCallback)(function(r){r.preventDefault();var S=r.dataTransfer.getData("application/reactflow");if(!S)return null;var n=JSON.parse(S),o=n.type,m=n.item;if(!o||!m)return null;var D=s({x:r.clientX,y:r.clientY});return{position:D,type:o,item:m}},[s]),b=(0,i.useCallback)(function(r){var S=function(o){var m=f(o);m&&r(m.position,m.type,m.item)};return document.addEventListener("dragover",d),document.addEventListener("drop",S),function(){document.removeEventListener("dragover",d),document.removeEventListener("drop",S)}},[d,f]);return{onDnD:b}},be=Fe,Qe=function(){var s=(0,v.Z)(function(n){return n.setAgentData}),d=(0,v.Z)(function(n){return n.setSkillData}),f=(0,v.Z)(function(n){return n.setToolData}),b=(0,v.Z)(function(n){return n.setDatasetData}),r=(0,v.Z)(function(n){return n.setTeamDatasetData}),S=(0,v.Z)(function(n){return n.setModelOptionsData});(0,i.useEffect)(function(){(0,Q.x$)(2).then(function(n){n.code===0&&s({team:n.data})}),(0,Q.x$)(3).then(function(n){n.code===0&&s({user:n.data})}),(0,Q.w)(2).then(function(n){n.code===0&&d({team:n.data})}),(0,Q.w)(3).then(function(n){n.code===0&&d({user:n.data})}),(0,Q.GZ)().then(function(n){n.code===0&&f({list:Object.values(n.data)})}),(0,Q.fZ)().then(function(n){var o,m=Array.isArray(n==null||(o=n.data)===null||o===void 0?void 0:o.data)?n.data.data:[],D=m.map(function(g){return{label:g.supplier_name,options:Array.isArray(g.model_list)?g.model_list.map(function(L){return y()(y()({},L),{},{label:L.model_name,value:L.model_config_id})}):[]}}),N,j=Se()(m),$;try{for(j.s();!($=j.n()).done;){var Z=$.value;if(Array.isArray(Z.model_list)){var u=Z.model_list.find(function(g){return g.model_default_used===1});if(u){N=u.model_config_id;break}}}}catch(g){j.e(g)}finally{j.f()}S({options:D,defaultValue:N})}),(0,Q.mG)().then(function(n){n.code==0&&b({list:n.data.data.map(function(o){return y()(y()({},o),{},{label:o.name,value:o.dataset_id})})})}),(0,Q.mG)(2).then(function(n){n.code==0&&r({list:n.data.data.map(function(o){return y()(y()({},o),{},{label:o.name,value:o.dataset_id})})})})},[s,d,f])},ge=Qe,dt=a(18032),qe=(0,i.memo)(function(l){var s=l.onSubmit,d=l.onClose;return(0,e.jsx)(dt.default,{onSubmit:s,onClose:d})}),ut=a(39873),et=a(47520),We=a(36711),ct=a(82826),Ue=a(43425),_e=a(48869),Lt=a(69243),Ot=a(91806),vt=a(34994),tt=a(52688),Rt=a(55241),Bt=a(50136),ft=a(43586),Ht=function(){var s,d=(0,X.useIntl)(),f=(0,i.useState)(!0),b=C()(f,2),r=b[0],S=b[1],n=(0,v.Z)(function(k){return k.setWorkflowEditInfo}),o=(0,v.Z)(function(k){return k.workFlowInfo}),m=(0,v.Z)(function(k){return k.setSelect}),D=(0,i.useState)("1"),N=C()(D,2),j=N[0],$=N[1],Z=(0,i.useState)(!1),u=C()(Z,2),g=u[0],L=u[1],ve=(0,ft.Z)(),F=(0,i.useRef)(null),c=function(){var E,M;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(vt.A,{formRef:F,submitter:{render:function(){return null}},onValuesChange:p,layout:"horizontal",children:[(0,e.jsx)(tt.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(tt.Z,{tooltip:(o==null||(E=o.app)===null||E===void 0?void 0:E.publish_status)!="1"?{title:d.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(o==null||(M=o.app)===null||M===void 0?void 0:M.publish_status)!="1",name:"enable_api",label:"API"})]})})})},O=[{key:"4",icon:(0,e.jsx)(ct.Z,{}),label:d.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:o!=null&&o.isProd?(0,e.jsx)(Ue.Z,{}):(0,e.jsx)(Rt.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Ue.Z,{})}),label:d.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:o==null?void 0:o.isProd},{key:"1",icon:(0,e.jsx)(_e.Z,{}),label:d.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Lt.Z,{}),label:d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:g?d.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):d.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!g},{key:"3",icon:(0,e.jsx)(Ot.Z,{}),label:d.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,ye.Z)(function(){if(o){var k,E,M,de,fe=o==null||(k=o.app)===null||k===void 0?void 0:k.is_public,Me=o==null||(E=o.app)===null||E===void 0?void 0:E.enable_api,ue={};ue.is_public=!!fe,ue.enable_api=(o==null||(M=o.app)===null||M===void 0?void 0:M.publish_status)=="1"?!!Me:!1,console.log(ue),L(ue.enable_api),F==null||(de=F.current)===null||de===void 0||de.setFieldsValue(ue)}},[o]);var p=function(E,M){console.log(E,M),T(M.enable_api),n(M),setTimeout(ve,300)},T=function(E){L(!!E)},R=function(E){var M;switch(E.key){case"4":X.history.go(-1);break;case"0":break;case"2":window.open(et._n+(o==null||(M=o.app)===null||M===void 0?void 0:M.api_url),"_blank");break;default:m(""),$(E.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(j==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Bt.Z,{defaultSelectedKeys:["1"],selectedKeys:[j],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:r,items:O,onClick:R}),j=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(vt.A,{formRef:F,submitter:{render:function(){return null}},onValuesChange:p,layout:"horizontal",children:[(0,e.jsx)(tt.Z,{name:"is_public",label:d.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(tt.Z,{disabled:!(o!=null&&(s=o.app)!==null&&s!==void 0&&s.api_url),name:"enable_api",label:"API"})]})})})]}),j=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(We.default,{})})})]})},$t=Ht,mt=a(71471),Ft=(0,i.memo)(function(l){var s=l.name,d=l.description,f=l.publishStatus,b=(0,X.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(mt.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:s}),f&&(0,e.jsxs)(mt.Z.Text,{className:"whitespace-normal",children:["(",b.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(mt.Z.Text,{className:"whitespace-normal text-gray-500",children:d})]})}),Ut=a(19632),jt=a.n(Ut),_t=a(9783),at=a.n(_t),Kt=a(22352),gt=a(2302),zt=a(26474),Vt=a(40110),Gt=a(86615),Jt=a(5966),Yt=a(62370),Xt=a(96638),Qt=a(74330),qt=a(11941),ht=a(69386),Mt=a(96486),ea=a(87718),ta=a(63783),nt=a(83062),pt=a(99510),yt=(0,i.memo)(function(l){var s=l.children,d=l.onDragStart,f=l.onClick,b=l.type,r=l.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(n){return d(n,b,r)},onClick:f,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:s})}),aa=(0,i.memo)(function(l){var s,d,f,b,r=l.item,S=l.onDragStart,n=l.typeBadge,o=l.onItemClick;return(0,e.jsx)(nt.Z,{placement:"right",title:(r==null||(s=r.baseData)===null||s===void 0?void 0:s.description)||(r==null||(d=r.data)===null||d===void 0?void 0:d.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:S,type:r.type,item:r,onClick:function(){return o==null?void 0:o(r)},children:(0,e.jsx)(pt.Z,{title:r.data.title,icon:(r==null||(f=r.baseData)===null||f===void 0?void 0:f.avatar)||(r==null||(b=r.baseData)===null||b===void 0?void 0:b.icon)||r.type,typeBadge:n})})})})}),na=(0,i.memo)(function(l){var s,d=l.item,f=l.onDragStart,b=l.typeBadge,r=l.onItemClick;return(0,e.jsx)(nt.Z,{placement:"right",title:(s=d.baseData)===null||s===void 0?void 0:s.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:f,type:d.type,item:d,onClick:function(){return r==null?void 0:r(d)},children:(0,e.jsx)(pt.Z,{title:d.baseData.name,icon:d.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:d.baseData.nickname}),typeBadge:b})})})})}),oa=(0,i.memo)(function(l){var s,d,f,b,r,S,n,o,m,D,N,j,$,Z,u=l.tool,g=l.category,L=l.onDragStart,ve=l.typeBadge,F=l.onItemClick,c=l.categoryIndex,O=l.toolIndex,p=(0,X.getLocale)()==="en-US"?"en_US":"zh_Hans",T=(0,gt.o6)()[z.vW.Tool],R=y()(y()({},u),{},{authorization_status:g==null?void 0:g.authorization_status,title:u==null||(s=u.identity)===null||s===void 0?void 0:s.label[p],icon:g==null||(d=g.identity)===null||d===void 0?void 0:d.icon,groupName:g==null||(f=g.identity)===null||f===void 0?void 0:f.name,credentials_for_provider:g==null?void 0:g.credentials_for_provider}),k={title:u==null||(b=u.identity)===null||b===void 0?void 0:b.label[p],desc:(u==null||(r=u.description)===null||r===void 0||(r=r.human)===null||r===void 0?void 0:r[p])||(u==null||(S=u.description)===null||S===void 0?void 0:S.llm),icon:g==null||(n=g.identity)===null||n===void 0?void 0:n.icon,data:{title:u==null||(o=u.identity)===null||o===void 0?void 0:o.label[p],desc:(u==null||(m=u.description)===null||m===void 0||(m=m.human)===null||m===void 0?void 0:m[p])||(u==null||(D=u.description)===null||D===void 0?void 0:D.llm),icon:g==null||(N=g.identity)===null||N===void 0?void 0:N.icon,optput:u==null?void 0:u.output},baseData:R};return(0,e.jsx)(nt.Z,{placement:"right",title:u==null||(j=u.description)===null||j===void 0||(j=j.human)===null||j===void 0?void 0:j[p],children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:L,type:z.vW.Tool,item:k,onClick:function(){return F==null?void 0:F(g,u,c,O)},children:(0,e.jsx)("div",{className:"text-sm py-2 pl-2 text-gray-600",children:(u==null||($=u.identity)===null||$===void 0?void 0:$.label[p])||(u==null||(Z=u.identity)===null||Z===void 0?void 0:Z.label.en_US)})})})})}),ra=(0,i.memo)(function(l){var s,d,f,b,r,S,n=l.category,o=l.onDragStart,m=l.typeBadge,D=l.onItemClick,N=l.categoryIndex,j=(0,X.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{className:"flex flex-col pb-2",children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2 flex items-center",children:[(0,e.jsx)(pt.Z,{title:(n==null||(s=n.identity)===null||s===void 0?void 0:s.label[j])||(n==null||(d=n.identity)===null||d===void 0?void 0:d.label.en_US),icon:n==null||(f=n.identity)===null||f===void 0?void 0:f.icon,typeBadge:m}),(0,e.jsx)(nt.Z,{placement:"right",title:(n==null||(b=n.identity)===null||b===void 0||(b=b.description)===null||b===void 0?void 0:b[j])||(n==null||(r=n.identity)===null||r===void 0||(r=r.description)===null||r===void 0?void 0:r.en_US),children:(0,e.jsx)(ta.Z,{className:"cursor-pointer ml-1"})})]}),n==null||(S=n.tools)===null||S===void 0?void 0:S.map(function($,Z){return(0,e.jsx)("div",{className:"pl-6",children:(0,e.jsx)(oa,{tool:$,category:n,onDragStart:o,typeBadge:m,onItemClick:function(g,L,ve,F){return D==null?void 0:D(g,L,ve,F)},categoryIndex:N,toolIndex:Z},Z)})})]})}),ia=function(s){var d=s.list,f=s.onDragStart,b=s.type,r=b===void 0?"normal":b,S=s.typeBadge,n=S===void 0?null:S,o=s.onItemClick;return d!=null&&d.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:r==="tools"?d.map(function(m,D){return(0,e.jsx)(ra,{category:m,typeBadge:n,onDragStart:f,onItemClick:o,categoryIndex:D},D)}):r==="workflow"?d.map(function(m,D){return(0,e.jsx)(na,{item:m,onDragStart:f,typeBadge:n,onItemClick:o},D)}):d.map(function(m,D){return(0,e.jsx)(aa,{item:m,onDragStart:f,typeBadge:n,onItemClick:o},D)})}):null},la=(0,i.memo)(ia),sa=(0,i.memo)(function(l){var s=l.visibleTabs,d=l.defaultActiveTab,f=l.showTeamSwitch,b=f===void 0?!0:f,r=l.isMinWidth,S=r===void 0?!1:r,n=l.isCollapsed,o=n===void 0?!1:n,m=l.onItemClick,D=(0,X.useIntl)(),N=(0,X.getLocale)()=="en-US"?"en_US":"zh_Hans",j=(0,gt.o6)(),$=(0,i.useMemo)(function(){return Object.values(j).filter(function(x){return![z.vW.Start,z.vW.Agent,z.vW.Tool,z.vW.Skill].includes(x.base.type)}).map(function(x){return x.base})},[j]),Z=(0,i.useState)(d||"1"),u=C()(Z,2),g=u[0],L=u[1],ve=(0,i.useState)($),F=C()(ve,2),c=F[0],O=F[1],p=(0,i.useState)([]),T=C()(p,2),R=T[0],k=T[1],E=(0,zt.v)(),M=E.tags,de=(0,Xt.Z)(at()(at()(at()({},z.vW.Agent,[]),z.vW.Skill,[]),"workflow",[])),fe=C()(de,2),Me=fe[0],ue=fe[1],Ce=(0,i.useState)({team:1,keyword:"",tag:[]}),we=C()(Ce,2),h=we[0],Ke=we[1],ze=(0,i.useRef)({}),bt=6e4,Ie=(0,v.Z)(function(x){return x.toolData});(0,i.useEffect)(function(){k((Ie==null?void 0:Ie.list)||[])},[Ie]);var Ne=(0,i.useCallback)(function(x,H,W){x.dataTransfer.setData("application/reactflow",JSON.stringify({type:H,item:W})),x.dataTransfer.effectAllowed="move"},[]),rt=(0,i.useCallback)(function(x,H){if(!H)return x;var W=new ht.Z(x,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),oe=W.search(H);return oe.map(function(t){return t.item})},[]),it=(0,i.useCallback)(function(x,H){if(!H)return x;var W=x.map(function(P){var I;return y()(y()({},P),{},{tools:(I=P.tools)===null||I===void 0?void 0:I.map(function(V){var G,re;return y()(y()({},V),{},{categoryName:(G=P.identity)===null||G===void 0||(G=G.label)===null||G===void 0?void 0:G[N],categoryIcon:(re=P.identity)===null||re===void 0?void 0:re.icon})})})}),oe=new ht.Z(W,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),t=oe.search(H);return t.map(function(P){return y()(y()({},P.item),{},{tools:P.item.tools.filter(function(I){var V=new ht.Z([I],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return V.search(H).length>0})})}).filter(function(P){return P.tools.length>0})},[N]),Ae=(0,i.useCallback)(function(){var x=ee()(_()().mark(function H(W){var oe,t,P,I,V,G;return _()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(oe="".concat(W,"-").concat(h.team,"-").concat(h.keyword,"-").concat(h.tag.join(",")),t=ze.current[oe],!(t&&Date.now()-t.timestamp<bt&&JSON.stringify(t.params)===JSON.stringify(h))){B.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(W)),B.abrupt("return",t.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(W)),B.prev=6,B.next=9,(0,Q.RE)(W,{search_type:h.team,apps_name:h.keyword,tag_ids:((P=h.tag)===null||P===void 0?void 0:P.join(","))||""});case 9:if(I=B.sent,!((I==null?void 0:I.code)===0&&I!==null&&I!==void 0&&I.data&&Array.isArray(I.data.list)&&I.data.list.length>0)){B.next=16;break}return V=I.data.list,G=V.filter(function(he){return he.publish_status==1}).map(function(he){var Ee,Oe;return y()(y()({},(Ee=j[W])===null||Ee===void 0?void 0:Ee.base),{},{data:y()(y()({},(Oe=j[W])===null||Oe===void 0?void 0:Oe.base.data),{},{title:he.name,desc:he.description}),baseData:he})}),ze.current[oe]={data:G,timestamp:Date.now(),params:y()({},h)},ue(at()({},W,G)),B.abrupt("return",G);case 16:return B.abrupt("return",[]);case 19:return B.prev=19,B.t0=B.catch(6),console.error("Failed to fetch ".concat(W," data:"),B.t0),B.abrupt("return",[]);case 23:case"end":return B.stop()}},H,null,[[6,19]])}));return function(H){return x.apply(this,arguments)}}(),[h,j,ue]),Te=(0,i.useMemo)(function(){var x=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return h.keyword?rt(c,h.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Ae(z.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return h.keyword?it(R,h.keyword):R}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var W=ee()(_()().mark(function t(){return _()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,Ae(z.vW.Skill);case 2:return I.abrupt("return",I.sent);case 3:case"end":return I.stop()}},t)}));function oe(){return W.apply(this,arguments)}return oe}()}],H=s!=null&&s.length?x.filter(function(W){return s.includes(W.tabKey)}):x;return H.map(function(W,oe){return y()(y()({},W),{},{key:oe+1+""})})},[c,Me,R,s,h,rt,it,Ae]),Ve=(0,i.useMemo)(function(){return Te.map(function(x){return{key:x.key,label:D.formatMessage({id:x.label,defaultMessage:x.defaultMessage})}})},[Te,D]),lt=(0,i.useCallback)(function(x){var H=x.tabIndex,W=x.showName,oe=W===void 0?!0:W,t=Te.find(function(w){return w.key===H}),P=(0,i.useState)([]),I=C()(P,2),V=I[0],G=I[1],re=(0,i.useState)(!0),B=C()(re,2),he=B[0],Ee=B[1],Oe=(0,i.useState)([]),ie=C()(Oe,2),le=ie[0],Tt=ie[1],ka=(0,i.useState)(20),ja=C()(ka,1),st=ja[0],Ma=(0,i.useState)(500),Et=C()(Ma,2),Pt=Et[0],Zt=Et[1],Pe=(0,i.useRef)(null),xt=(0,i.useRef)(!1),Je=(0,i.useCallback)(function(w){if((t==null?void 0:t.type)==="tools"&&w){var A,J=60,Y=36,pe=((A=w.tools)===null||A===void 0?void 0:A.length)||0;return J+pe*Y}return 54},[t==null?void 0:t.type]),Ta=(0,i.useCallback)(function(){return(t==null?void 0:t.type)==="tools"?V.reduce(function(w,A){return w+Je(A)},0):V.length*Je()},[t==null?void 0:t.type,V,Je]);(0,i.useEffect)(function(){var w=function(){if(Pe.current){var Y=Pe.current.clientHeight;Zt(Y)}},A=function(Y){Zt(Y.detail.height)};return w(),Pe.current&&Pe.current.addEventListener("containerResize",A),window.addEventListener("resize",w),function(){Pe.current&&Pe.current.removeEventListener("containerResize",A),window.removeEventListener("resize",w)}},[]),(0,i.useEffect)(function(){return function(){xt.current=!1}},[t==null?void 0:t.tabKey]),(0,i.useEffect)(function(){var w=function(){var A=ee()(_()().mark(function J(){var Y,pe;return _()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(!(xt.current&&!h.keyword&&h.tag.length===0)){U.next=2;break}return U.abrupt("return");case 2:if(Ee(!0),U.prev=3,t){U.next=6;break}return U.abrupt("return");case 6:return U.next=8,t.getData();case 8:Y=U.sent,pe=(Y==null?void 0:Y.map(function(Ye,Ct){return y()(y()({},Ye),{},{id:"".concat(t.tabKey,"-").concat(Ct)})}))||[],G(pe),Tt(pe.slice(0,st)),xt.current=!0,U.next=18;break;case 15:U.prev=15,U.t0=U.catch(3),console.error("Failed to fetch data:",U.t0);case 18:return U.prev=18,Ee(!1),U.finish(18);case 21:case"end":return U.stop()}},J,null,[[3,15,18,21]])}));return function(){return A.apply(this,arguments)}}();w()},[t,h,st]);var Wt=(0,i.useCallback)(function(){var w=le.length;if(w<V.length){var A=V.slice(w,w+st);Tt(function(J){return[].concat(jt()(J),jt()(A))})}},[le.length,V,st]),At=(0,i.useCallback)((0,Mt.debounce)(Wt,100),[Wt]),Ia=function(A){var J=A.currentTarget,Y=J.scrollTop,pe=J.scrollHeight,Re=J.clientHeight,U=pe-Y-Re<10;U&&At()},Na=function(A){for(var J=A.currentTarget,Y=J.scrollTop,pe=J.scrollHeight,Re=J.clientHeight,U=0,Ye=0;Ye<le.length;Ye++)U+=Je(le[Ye]);var Ct=Y+Re>=U-50;Ct&&le.length<V.length&&At()},Dt=(0,i.useCallback)(function(w){var A,J,Y;if(t){switch(console.log("Clicked item:",w),t.tabKey){case"tool":console.log("Tool ".concat((A=w.identity)===null||A===void 0||(A=A.label)===null||A===void 0?void 0:A[N]));break;case"workflow":console.log("Workflow ".concat((J=w.data)===null||J===void 0?void 0:J.title));break;case"agent":console.log("Agent ".concat((Y=w.data)===null||Y===void 0?void 0:Y.title));break;default:console.log("Clicked ".concat(t.tabKey," item:"),w)}m&&m(w,t.tabKey)}},[t,N,m]),St=(0,i.memo)(function(w){var A=w.data,J=w.index,Y=w.onDragStart,pe=w.onItemClick,Re=w.type,U=w.typeBadge;return(0,e.jsx)(la,{typeBadge:U,list:[A],onDragStart:Y,type:Re,onItemClick:pe})});return t?(0,e.jsx)("div",{ref:Pe,className:"overflow-y-auto h-full",children:(0,e.jsx)(Qt.Z,{spinning:he,children:h!=null&&h.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:le.map(function(w){return(0,e.jsx)(St,{data:w,index:le.indexOf(w),onDragStart:Ne,onItemClick:Dt,type:t.type,typeBadge:h!=null&&h.keyword&&t.tabKey!="node"?{icon:"/icons/".concat(t.tabKey,".svg"),tooltip:t.tabKey,color:"#1b64f3"}:void 0},w.id)})}):t.type==="tools"?(0,e.jsx)("div",{className:"overflow-y-auto",style:{height:Pt},onScroll:Na,children:(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:le.map(function(w){return(0,e.jsx)(St,{data:w,index:le.indexOf(w),onDragStart:Ne,onItemClick:Dt,type:t.type,typeBadge:h!=null&&h.keyword&&t.tabKey!="node"?{icon:"/icons/".concat(t.tabKey,".svg"),tooltip:t.tabKey,color:"#1b64f3"}:void 0},w.id)})})}):(0,e.jsx)(ea.Z,{data:le,height:Pt,itemHeight:Je(),itemKey:"id",onScroll:Ia,children:function(A){return(0,e.jsx)(St,{data:A,index:le.indexOf(A),onDragStart:Ne,onItemClick:Dt,type:t.type,typeBadge:h!=null&&h.keyword&&t.tabKey!="node"?{icon:"/icons/".concat(t.tabKey,".svg"),tooltip:t.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[g,h,S,Te,Ne,N,m]),Ge=(0,i.useCallback)((0,Mt.debounce)(function(x){Ke(x)},500),[]),Le=(0,i.useCallback)(function(){ze.current={}},[]);(0,i.useEffect)(function(){Le()},[h.team,Le]);var wt=(0,i.useCallback)(function(x,H){"team"in x?Ke(H):("tag"in x||"keyword"in x)&&Ge(H)},[Ge]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!o&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(vt.A,{submitter:!1,initialValues:h,onValuesChange:wt,children:[b&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[D.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Gt.Z.Group,{name:"team",fieldProps:{options:[{label:D.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:D.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Jt.Z,{fieldProps:{prefix:(0,e.jsx)(Vt.Z,{}),placeholder:D.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Yt.Z,{name:"tag",children:(0,e.jsx)(Kt.O,{className:"w-full",options:M,listStyle:S?"horizontal":"vertical",allowClear:!0,placeholder:D.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(H){}})})})]}),h!=null&&h.keyword?null:(0,e.jsx)(qt.Z,{activeKey:g,items:Ve,onChange:function(H){L(H)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:h!=null&&h.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Te.map(function(x,H){return(0,e.jsxs)("div",{className:"space-y-2",children:[!o&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:D.formatMessage({id:x.label,defaultMessage:x.defaultMessage})}),(0,e.jsx)(lt,{tabIndex:H+1+"",showName:!S},x.key)]},x.key)})}):(0,e.jsx)(lt,{tabIndex:g,showName:!S})})]})}),da=(0,i.memo)(function(l){var s=l.visibleTabs,d=l.defaultActiveTab,f=l.showTeamSwitch,b=f===void 0?!0:f,r=l.workflowName,S=l.workflowDesc,n=l.publishStatus,o=l.onWidthChange,m=l.onItemClick,D=(0,i.useState)(!1),N=C()(D,2),j=N[0],$=N[1],Z=(0,i.useState)(!1),u=C()(Z,2),g=u[0],L=u[1];return(0,e.jsx)(ut.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:g?100:315,onChange:function(F,c){requestAnimationFrame(function(){$(F<100),o==null||o(F);var O=document.querySelectorAll(".overflow-y-auto");O.forEach(function(p){if(p instanceof HTMLElement){var T=p.clientHeight,R=new CustomEvent("containerResize",{detail:{height:T,width:F}});p.dispatchEvent(R)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(sa,{visibleTabs:s,defaultActiveTab:d,showTeamSwitch:b,isMinWidth:j,isCollapsed:g,onItemClick:m}),(0,e.jsx)($t,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Ft,{name:r,description:S,publishStatus:n})})]})})}),ua=a(74842),ca=a(98165),va=a(58638),ot=a(28036),fa=a(27484),ma=a.n(fa),It=a(70681),ga=200,ha=80,pa={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ya=function(){var s=(0,ae._K)(),d=s.getNodes,f=s.getEdges,b=s.setNodes,r=function(o){return{width:o.width||ga,height:o.height||ha}},S=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",m=d(),D=f();if(m.length){var N=new It.graphlib.Graph;N.setDefaultEdgeLabel(function(){return{}});var j=y()(y()({},pa),{},{rankdir:o});N.setGraph(j),m.forEach(function(Z){var u=r(Z),g=u.width,L=u.height;N.setNode(Z.id,{width:g,height:L})}),D.forEach(function(Z){N.setEdge(Z.source,Z.target)}),It.layout(N);var $=m.map(function(Z){var u=N.node(Z.id);return y()(y()({},Z),{},{position:{x:u.x-u.width/2,y:u.y-u.height/2}})});b($)}};return{autoLayout:S}},ba=ya,wa=(0,i.memo)(function(){var l=(0,X.useIntl)(),s=(0,X.useSearchParams)(),d=C()(s,1),f=d[0],b=(0,v.Z)(function(p){return p.setWorkFlowInfo}),r=(0,v.Z)(function(p){return p.workFlowInfo}),S=(0,v.Z)(function(p){return p.setRunPanelShow}),n=f.get("type")=="true",o=(0,ft.Z)(),m=ba(),D=m.autoLayout,N=K.ZP.useMessage(),j=C()(N,2),$=j[0],Z=j[1],u=(0,v.Z)(function(p){return p.loadingWorkflowData}),g=function(){var p=ee()(_()().mark(function T(){var R;return _()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,o();case 2:R=f.get("app_id"),(0,Q.aJ)(R).then(function(M){console.log(M),M.code==0&&(b(y()(y()({},r),{},{app:y()(y()({},r==null?void 0:r.app),{},{publish_status:"1"})})),$.open({type:"success",content:l.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return E.stop()}},T)}));return function(){return p.apply(this,arguments)}}(),L=function(){S(!0)},ve=function(){var p=ee()(_()().mark(function T(){var R,k;return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return R=f.get("app_id"),M.next=3,(0,Q.Uq)(R);case 3:k=M.sent;case 4:case"end":return M.stop()}},T)}));return function(){return p.apply(this,arguments)}}(),F=function(){var p=ee()(_()().mark(function T(){var R,k,E,M;return _()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:k=f.get("app_id"),E=(r==null||(R=r.app)===null||R===void 0?void 0:R.name)||"workflow",M=ma()().format("YYYY_MM_DD-HH_mm_ss"),(0,Q.w8)(k,n==!0?1:0).then(function(Me){var ue=Me,Ce=new Blob([ue],{type:"text/yaml"}),we=URL.createObjectURL(Ce),h=document.createElement("a");h.href=we,h.download="".concat(E,"_").concat(M,".yml"),document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(we)});case 4:case"end":return fe.stop()}},T)}));return function(){return p.apply(this,arguments)}}(),c=function(T){D(T),$.open({type:"success",content:l.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},O=[{key:"TB",label:l.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:l.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}];return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!n&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(ot.ZP,{type:"primary",disabled:u,onClick:g,children:l.formatMessage({id:"workflow.release"})}),(0,e.jsx)(ot.ZP,{icon:(0,e.jsx)(ua.Z,{}),disabled:u,onClick:L,children:l.formatMessage({id:"workflow.run"})}),(0,e.jsx)(ot.ZP,{icon:(0,e.jsx)(ca.Z,{}),type:"dashed",disabled:u,onClick:o,children:l.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(ot.ZP,{icon:(0,e.jsx)(va.Z,{}),type:"dashed",onClick:F,disabled:u,children:l.formatMessage({id:"workflow.export",defaultMessage:""})}),Z]})}),Nt=a(64458),xa=function(){var s,d,f=(0,X.useIntl)(),b=(0,i.useRef)(null),r=(0,v.Z)(function(t){return t.resetNodes}),S=(0,v.Z)(function(t){return t.setNodeTypes}),n=(0,v.Z)(function(t){return t.addNode}),o=(0,v.Z)(function(t){return t.createNode}),m=(0,v.Z)(function(t){return t.setNodes}),D=(0,v.Z)(function(t){return t.setEdges}),N=(0,v.Z)(function(t){return t.setAppId}),j=(0,v.Z)(function(t){return t.setRunPanelShow}),$=(0,v.Z)(function(t){return t.runPanelShow}),Z=(0,v.Z)(function(t){return t.getModelData}),u=(0,v.Z)(function(t){return t.setWorkFlowInfo}),g=(0,v.Z)(function(t){return t.setHandleList}),L=(0,v.Z)(function(t){return t.workFlowInfo}),ve=(0,v.Z)(function(t){return t.setWorkflowEditInfo}),F=K.ZP.useMessage(),c=C()(F,2),O=c[0],p=c[1],T=(0,ae._K)(),R=T.screenToFlowPosition,k=T.getNodes,E=T.setViewport,M=be(R),de=M.onDnD,fe=(0,X.useSearchParams)(),Me=C()(fe,1),ue=Me[0],Ce=ue.get("type")=="true",we=(0,v.Z)(function(t){return t.setLoadingWorkflowData}),h=(0,ae.B)({includeHiddenNodes:!1}),Ke=(0,De.Z)(),ze=(0,ft.Z)(),bt=(0,i.useState)(null),Ie=C()(bt,2),Ne=Ie[0],rt=Ie[1],it=(0,i.useState)(!1),Ae=C()(it,2),Te=Ae[0],Ve=Ae[1],lt=(0,i.useState)(""),Ge=C()(lt,2),Le=Ge[0],wt=Ge[1],x=null;(0,ae.CV)({onEnd:function(P){}}),(0,Ze.Z)(function(){S((0,gt.$P)()),r(),(0,$e.b6)(),H(),g([])}),ge(),(0,i.useEffect)(function(){if(Ne){X.history.push(Le);return}var t=X.history.block(function(P,I){if($){wt(P.location.pathname),Ve(!0);return}});return $||t==null||t(),function(){t==null||t()}},[$,Ne]),(0,ye.Z)(function(){if(h){var t=k(),P=t[t.length-1];P.data.drag&&(P.position={x:P.position.x-P.measured.width/2,y:P.position.y-P.measured.height/2},m(t))}},[h]),(0,i.useEffect)(function(){var t=de(function(P,I,V){var G;console.log(P,I,V);var re=y()(y()({drag:!0},V.data),{},{baseData:V.baseData});if((G=V.baseData)!==null&&G!==void 0&&G.output){var B;re.outputInfo=(B=V.baseData)===null||B===void 0?void 0:B.output}debugger;o(I,{position:P,data:re})});return t},[de,n]),(0,ye.Z)(function(){Ke=="hidden"&&ze()},[Ke]);var H=function(){var t=ee()(_()().mark(function P(){var I;return _()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:I=ue.get("app_id"),Ce&&O.open({type:"warning",content:f.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),we(!0),N(I),(0,Q.kE)(I,Ce?1:0).then(function(re){if(re.code==0){if(u(y()(y()({},re.data),{},{isProd:Ce})),!re.data.workflow.graph){we(!1),o(z.vW.Start);return}var B=re.data,he=B.workflow.graph,Ee=he.edges,Oe=he.nodes,ie=he.views,le=B.app;ve({enable_api:!!le.enable_api,is_public:!!le.is_public}),ie!=null&&ie.nodes&&m(ie.nodes),ie!=null&&ie.edges&&D(ie.edges),ie!=null&&ie.viewPort,setTimeout(function(){we(!1)},1e3)}}),Z();case 6:case"end":return G.stop()}},P)}));return function(){return t.apply(this,arguments)}}(),W=function(){rt(!0),console.log(Le),X.history.push(Le),Ve(!1)},oe=function(){Ve(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[p,(0,e.jsx)(ce.Z,{title:f.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Te,onOk:W,onCancel:oe,children:f.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:b,children:(0,e.jsxs)(je,{children:[(0,e.jsx)(ae.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(ae.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(da,{workflowName:L==null||(s=L.app)===null||s===void 0?void 0:s.name,workflowDesc:L==null||(d=L.app)===null||d===void 0?void 0:d.description,publishStatus:Ce}),(0,e.jsx)(wa,{}),(0,e.jsx)(Nt.s_,{}),(0,e.jsx)(Nt.Jf,{}),(0,e.jsx)(qe,{})]})},Da=(0,i.memo)(function(){return(0,e.jsx)(ae.tV,{children:(0,e.jsx)(xa,{})})}),Sa=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(Da,{})})},Ca=Sa}}]);
