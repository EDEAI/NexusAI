"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[145],{80459:function(pt,Be,s){var Ae=s(32332),F=s(67294),ke=s(85893),Z=function(q){var ue=q.width,Se=ue===void 0?"40px":ue,H=q.bg,be=H===void 0?"#F4F8F1":H,me=q.rounded,De=me===void 0?"6px":me,U=q.data,K=q.imgWidth,M=K===void 0?"18px":K,N=q.background;U!=null&&U.avatar&&(M=Se);var D=N||be;return(0,ke.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Se,height:Se,backgroundColor:D,borderRadius:De},children:(0,ke.jsx)("img",{src:U!=null&&U.avatar?U.avatar:(0,Ae.s9)("single",U==null?void 0:U.icon),style:{width:M,height:M,borderRadius:De},alt:""})})};Be.Z=(0,F.memo)(Z)},80279:function(pt,Be,s){s.d(Be,{F:function(){return An}});var Ae=s(5574),F=s.n(Ae),ke=s(45360),Z=s(55026),x=s(67294),q=s(15009),ue=s.n(q),Se=s(19632),H=s.n(Se),be=s(99289),me=s.n(be),De=s(9783),U=s.n(De),K=s(97857),M=s.n(K),N=s(43722),D=s(39e3),P=s(35312),re=s(74330),G=s(41428),t=s(85893),ot=function(e){var n=e.roomid,a=(0,P.useIntl)(),r=(0,D.Z)(function(d){return d.setSummaryClick}),o=(0,x.useState)(!0),u=F()(o,2),l=u[0],m=u[1],c=(0,D.Z)(function(d){return d.summaryClick});(0,x.useEffect)(function(){m(c)},[c]);var g=(0,D.Z)(function(d){return d.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(g({id:n}),r(!1))},children:[(0,t.jsx)(G.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},We=s(80459),ze=s(32332),je=s(22683),Ze=s(97807),He=s(55060),se=s(28036),Ie=s(69753),Oe=s(97245),E=s(77295),L=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},de=function(e){var n=e.fileList,a=e.onDownload,r=a===void 0?L:a,o=e.className,u=o===void 0?"":o,l=e.showInGrid,m=l===void 0?!1:l,c=e.maxHeight;return!n||n.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(u),style:{maxHeight:c,overflow:c?"auto":"visible"},children:(0,t.jsx)(He.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(m?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(g,d){var C=g.path_show||g.url,T=(0,E.CO)(g.name);return(0,t.jsx)("div",{className:"".concat(m?"":"mb-2"),children:T?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(He.Z,{src:C,alt:g.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(se.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Ie.Z,{}),onClick:function(f){f.stopPropagation(),r(C,g.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Oe.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:g.name})]}),(0,t.jsx)(se.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Ie.Z,{}),onClick:function(){return r(C,g.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(g.uid||g.file_id||d))})})})})},ge=de,ce=s(13769),ae=s.n(ce),Fe=function(){var i=me()(ue()().mark(function e(n){return ue()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",Xe(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",Xe(n));case 12:case"end":return r.stop()}},e,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),Xe=function(e){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},ht=s(64599),qe=s.n(ht),Te=s(52677),ee=s.n(Te),et=function(e,n){try{var a=document.createElement("a");a.href=e,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},tt=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):x.isValidElement(e)?i(e.props.children):""},Pe=function(e){return tt(e)},fe=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||ee()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,u=o===void 0?!0:o,l=n.checkMCPTools,m=l===void 0?!0:l,c=n.checkStreaming,g=c===void 0?!0:c,d=n.minTextLength,C=d===void 0?1:d,T=function(){if(!r)return!1;try{var S=e.content;return S&&typeof S=="string"&&S.trim().length>=C}catch(z){return console.warn("Error checking text content:",z),!1}},_=function(){if(!u)return!1;try{var S=e.fileList||e.file_list;return S&&Array.isArray(S)&&S.length>0}catch(z){return console.warn("Error checking file content:",z),!1}},f=function(){if(!m)return!1;try{var S;if((S=e.parsedContent)!==null&&S!==void 0&&S.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var z=e.contentBlocks.some(function(V){return V&&V.type==="mcp"&&V.toolId});if(z)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(V){return console.warn("Error checking MCP content:",V),!1}},O=function(){if(!g)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(S){return S&&S.type==="text"&&S.content&&S.content.trim().length>=C}):!1}catch(S){return console.warn("Error checking streaming content:",S),!1}};return T()||_()||f()||O()}catch(b){return console.error("hasMessageContent unexpected error:",b),!0}},dt=function(e){try{var n=(e==null?void 0:e.content)||"",a=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],r=(e==null?void 0:e.parsedContent)||{},o=(e==null?void 0:e.contentBlocks)||[],u=(e==null?void 0:e.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(u)&&u.length>0,hasStreamingText:o.some(function(l){var m;return(l==null?void 0:l.type)==="text"&&(l==null||(m=l.content)===null||m===void 0?void 0:m.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(u)?u.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},st=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var a=qe()(e),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o&&o.is_agent===1&&fe(o,M()({checkText:!0,checkFiles:!0,checkMCPTools:!0,minTextLength:1},n)))return o}}catch(u){a.e(u)}finally{a.f()}return null}catch(u){return console.error("checkLastAgentMessage error:",u),null}},mt=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},Ve=function(e){return e.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},it=function(e,n){try{var a=M()(M()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),r=e.contentBlocks;if(!r&&e.parsedContent?r=mt(e.parsedContent):!r&&e.content&&(r=[{type:"text",content:e.content,timestamp:Date.now()}]),n&&r){var o=Ve(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(u){return console.error("prepareHistoryMessageForCurrent error:",u),e}},ft=["node","className","children"],te=["node"],lt=function(e,n){return{code:function(r){var o=r.node,u=r.className,l=r.children,m=ae()(r,ft),c=/language-(\w+)/.exec(u||"");if(c!=null&&c.length){var g=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:c[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var d=me()(ue()().mark(function C(T){var _,f;return ue()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,_=T.currentTarget,b.next=4,Fe(Pe(l));case 4:f=b.sent,f&&_?(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),b.next=11;break;case 8:b.prev=8,b.t0=b.catch(0),console.error("Failed to copy text: ",b.t0);case 11:case"end":return b.stop()}},C,null,[[0,8]])}));return function(C){return d.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(g).concat(e),className:"p-4",children:l})})]})}else return(0,t.jsx)("code",M()(M()({},m),{},{children:l}))},img:function(r){var o=r.node,u=ae()(r,te),l=function(c,g){try{var d=document.createElement("a");d.href=c,d.download=g,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(C){}};return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(He.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(se.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(Ie.Z,{}),onClick:function(c){c.stopPropagation(),l(u.src||"",u.alt||"image.png")}})})]})}}},k="<<<mcp-tool-start>>>",Ke="<<<mcp-tool-end>>>",jt=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var n=[],a=0;;){var r=e.indexOf(k,a);if(r===-1)break;var o=e.indexOf(Ke,r);if(o===-1)break;var u=r+k.length,l=e.substring(u,o).trim();try{var m=JSON.parse(l),c={id:m.id,name:m.name||"",skill_or_workflow_name:m.skill_or_workflow_name||"",workflow_run_id:m.workflow_run_id||0,workflow_confirmation_status:m.workflow_confirmation_status||null,args:m.args||{},result:m.result||null};n.push({toolData:c,startIndex:r,endIndex:o+Ke.length})}catch(g){console.error("Failed to parse MCP tool JSON:",g)}a=o+Ke.length}return n},St=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var n=jt(e);if(n.length===0)return[{type:"text",content:e}];var a=[],r=0;if(n.forEach(function(u){if(u.startIndex>r){var l=e.substring(r,u.startIndex).trim();l&&a.push({type:"text",content:l})}a.push({type:"mcp-tool",content:e.substring(u.startIndex,u.endIndex),toolData:u.toolData}),r=u.endIndex}),r<e.length){var o=e.substring(r).trim();o&&a.push({type:"text",content:o})}return a},Le=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=St(e),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},kt=function(e,n,a){var r=_objectSpread({},e);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(u){return u.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},Dt=function(e,n){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(a){return a.id===n})||null},It=function(e,n){var a=_objectSpread({},e);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},Qe=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},Ct=function(e){try{var n={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result},a=JSON.stringify(n,null,0);return"".concat(k).concat(a).concat(Ke)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},vt=function(e,n){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return e.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var u=Ct(o);a+=u}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},Mt=s(71471),gt=s(47221),xt=s(66309),w=s(4393),Y=s(97175),ve=s(4161),_t=s(49354),at=s(45699),ut=s(8751),nt=s(79090),yt=s(66212),Tt=s(11475),Pt=s(2830),Ot=s(87547),B=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i}({}),Ft=function(e,n){if(e){if(e.status==="waiting_confirm")return B.WAITING_CONFIRMATION;if(n===null)return B.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return B.FAILED}catch(r){}else if(ee()(n)==="object"&&n.status==="failed")return B.FAILED;return B.COMPLETED}return B.PENDING},Wt=s(29608),$e=Mt.Z.Text,Sn=Mt.Z.Paragraph,wt=gt.Z.Panel,Zt=function(e){var n=e.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,t.jsx)(Y.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,t.jsx)(ve.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,t.jsx)(_t.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)(at.Z,{className:"text-purple-600 ".concat(a)});default:return(0,t.jsx)(Oe.Z,{className:"text-gray-600 ".concat(a)})}},Ht=function(e){var n=e.fileList,a=e.intl,r=function(u,l){try{var m=document.createElement("a");m.href=u,m.download=l,m.target="_blank",document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){console.error("Download file failed",c)}};return!n||n.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:n.map(function(o,u){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:Zt(o.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,t.jsx)(se.ZP,{type:"text",size:"small",icon:(0,t.jsx)(Ie.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},u)})})},Kt=function(e){var n=e.status;switch(n){case B.COMPLETED:return(0,t.jsx)(ut.Z,{className:"text-green-500"});case B.RUNNING:return(0,t.jsx)(nt.Z,{className:"text-blue-500"});case B.WAITING_CONFIRMATION:return(0,t.jsx)(yt.Z,{className:"text-orange-500"});case B.FAILED:return(0,t.jsx)(Tt.Z,{className:"text-red-500"});default:return(0,t.jsx)(yt.Z,{className:"text-gray-500"})}},Gt=function(e){var n=e.status,a=e.intl,r=function(l){switch(l){case B.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case B.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case B.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case B.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,t.jsx)(xt.Z,{color:o.color,children:o.text})},bt=function(e){if(e==null)return"null";if(typeof e=="string")try{var n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(a){return e}try{return JSON.stringify(e,null,2)}catch(a){return String(e)}},zt=function(e,n){return e.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},Vt=function(e){if(!e||ee()(e)!=="object")return{specialFields:{},regularFields:e};var n={},a={};return Object.keys(e).forEach(function(r){r==="input_variables"?n[r]=e[r]:a[r]=e[r]}),{specialFields:n,regularFields:a}},$t=function(e){var n=e.inputVariables,a=e.intl;return!n||ee()(n)!=="object"||Object.keys(n).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=F()(r,2),u=o[0],l=o[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[u,":"]}),(0,t.jsx)($e,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},u)})})]})},Jt=function(e){var n=e.args,a=e.intl;try{var r=Vt(n),o=r.specialFields,u=r.regularFields,l=o.input_variables&&Object.keys(o.input_variables).length>0,m=u&&Object.keys(u).length>0;return!l&&!m?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[l&&(0,t.jsx)($t,{inputVariables:o.input_variables,intl:a}),m&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:bt(u)})})]})]})}catch(c){return console.warn("Failed to parse parameters for enhanced display:",c),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:bt(n)})})}},Yt=function(e){try{var n=e;if(typeof e=="string")try{n=JSON.parse(e)}catch(a){return[]}return n&&ee()(n)==="object"&&n.status==="success"&&n.file_list&&Array.isArray(n.file_list)?n.file_list:[]}catch(a){return console.warn("Failed to extract file list from result data:",a),[]}},Xt=function(e){var n=e.resultData,a=e.intl,r=e.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(c){o=n}var u=o&&ee()(o)==="object"&&o.status==="success"&&o.outputs&&ee()(o.outputs)==="object";if(u){var l=o.outputs,m=Object.keys(l).length>0;return m?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)($e,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(c){var g=F()(c,2),d=g[0],C=g[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)($e,{strong:!0,className:"text-xs text-gray-700",children:[d,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof C=="string"?(0,t.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:C}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:bt(C)})})]},d)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===B.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:bt(n)})})},Nt=function(e){var n=e.toolData,a=e.intl,r=e.runtimeData,o=(r==null?void 0:r.status)||Ft(n.workflow_confirmation_status,n.result),u=zt(n.name,a),l=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,m=(0,Wt.Z)(function(f){return f.setDealtWithData}),c=(r==null?void 0:r.result)||n.result,g=null;if(typeof c=="string")try{var d=JSON.parse(c);d.status==="failed"&&(g=d.message)}catch(f){}else ee()(c)==="object"&&(c==null?void 0:c.status)==="failed"&&(g=c.message);var C=function(){m(M()(M()({},l),{},{exec_id:l.node_exec_id}))},T=Yt(c),_=T&&Array.isArray(T)&&T.length>0;return(0,t.jsxs)(w.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Pt.Z,{className:"text-blue-500"}),(0,t.jsx)($e,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,t.jsx)(xt.Z,{color:"blue",children:u}),(0,t.jsx)(Kt,{status:o}),(0,t.jsx)(Gt,{status:o,intl:a})]}),l&&o!==B.COMPLETED&&o!==B.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Ot.Z,{className:"text-orange-500"}),(0,t.jsxs)($e,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),": ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),l.confirmer_name&&(0,t.jsxs)($e,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",l.confirmer_name]})]}),l.show_todo_button&&(0,t.jsx)(se.ZP,{size:"small",type:"primary",onClick:C,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),g&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)($e,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",g]})}),(0,t.jsxs)(gt.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,t.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:(0,t.jsx)(Jt,{args:(r==null?void 0:r.args)||n.args,intl:a})},"params"),c&&(0,t.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(Xt,{resultData:c,intl:a,status:o})},"result"),_&&(0,t.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Ht,{fileList:T,intl:a})},"files")]})]})},Lt=function(e){var n,a=e.content,r=e.fileList,o=e.index,u=e.intl,l=e.isAgent,m=e.contentId,c=e.mcpTools,g=e.updateMCPTool,d=e.getMCPTool,C=e.item,T=e.contentBlocks,_=(C==null?void 0:C.parsedContent)||Le(a);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:m,children:[r&&r.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(ge,{fileList:r,onDownload:et})}),T&&T.length>0?(0,t.jsx)("div",{children:T.map(function(f,O){var b,S,z,V,we,xe;return(0,t.jsx)("div",{children:f.type==="text"?f.content&&(0,t.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:f.content}):f.toolId&&d&&(0,t.jsx)(Nt,{toolData:{id:f.toolId,name:((b=d(f.toolId))===null||b===void 0?void 0:b.name)||"",skill_or_workflow_name:((S=d(f.toolId))===null||S===void 0?void 0:S.skill_or_workflow_name)||"",workflow_run_id:(z=d(f.toolId))===null||z===void 0?void 0:z.workflow_run_id,workflow_confirmation_status:(V=d(f.toolId))===null||V===void 0?void 0:V.workflow_confirmation_status,args:((we=d(f.toolId))===null||we===void 0?void 0:we.args)||{},result:(xe=d(f.toolId))===null||xe===void 0?void 0:xe.result},intl:u,runtimeData:d(f.toolId)})},"content-block-".concat(O))})}):_.hasMCPTools?(0,t.jsx)("div",{children:_.blocks.map(function(f,O){return(0,t.jsx)("div",{children:f.type==="text"?(0,t.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:f.content}):f.toolData&&(0,t.jsx)(Nt,{toolData:f.toolData,intl:u,runtimeData:d?d(f.toolData.id):null})},O)})}):(0,t.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:a}),e.isCurrentMessage&&!T&&(C==null||(n=C.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:C.activeMCPTools.map(function(f){return d?d(f):null}).filter(Boolean).map(function(f){return(0,t.jsx)(Nt,{toolData:{name:f.name,skill_or_workflow_name:f.skill_or_workflow_name,workflow_run_id:f.workflow_run_id,workflow_confirmation_status:f.workflow_confirmation_status,args:f.args,result:f.result,id:f.id},intl:u,runtimeData:f},"current-tool-".concat(f.id))})})]})},Qt=(0,x.memo)(function(i){var e=i.messageApi,n=i.index,a=i.idName,r=i.cidName,o=(0,P.useIntl)(),u=(0,x.useState)(!1),l=F()(u,2),m=l[0],c=l[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var g=me()(ue()().mark(function d(C){var T,_,f;return ue()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return T=C.target.closest("#".concat(a).concat(n)),_=T.querySelector("#".concat(r).concat(n)),b.prev=2,b.next=5,Fe(_.innerText);case 5:f=b.sent,f?e.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),b.next=13;break;case 9:b.prev=9,b.t0=b.catch(2),console.error("Failed to copy text: ",b.t0),e.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return b.stop()}},d,null,[[2,9]])}));return function(d){return g.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(m?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(m?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),qt=s(2068),en=function(e){var n=e.id,a=e.index,r=e.idName,o=e.cidName,u=(0,P.useIntl)(),l=(0,D.Z)(function(_){return _.setSummaryClick}),m=(0,x.useState)(!0),c=F()(m,2),g=c[0],d=c[1],C=(0,D.Z)(function(_){return _.summaryClick});(0,x.useEffect)(function(){d(C)},[C]);var T=(0,D.Z)(function(_){return _.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(g?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(f){if(g){var O=f.target.closest("#".concat(r).concat(a)),b=O.querySelector("#".concat(o).concat(a));T({id:n,message:b.innerText}),l(!1)}},children:[(0,t.jsx)(qt.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:u.formatMessage({id:"app.chatroom.content.summary"})})]})})},tn=function(e){var n=e.messageApi,a=e.index,r=e.idName,o=e.cidName,u=e.id,l=e.agentChatRoomId,m=e.isAgent;return m?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(Qt,{messageApi:n,index:a,idName:r,cidName:o}),!l&&(0,t.jsx)(en,{id:u,index:a,idName:r,cidName:o})]}):null},Rt=function(e){var n,a=e.item,r=e.index,o=e.agentChatRoomId,u=e.abilitiesList,l=e.messageApi,m=e.id,c=e.idName,g=e.cidName,d=e.mcpTools,C=e.updateMCPTool,T=e.getMCPTool,_=(0,P.useIntl)(),f=a.is_agent===1;return fe(a)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(f?"":"flex-row-reverse"),children:[f?(0,t.jsx)(We.Z,{data:a}):(0,t.jsx)(We.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(c).concat(r),children:[(0,t.jsxs)("div",{className:"".concat(f?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,ze.Qy)("GET").nickname,a.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(u==null||(n=u.find(function(O){return a.ability_id==O.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(f?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Lt,{content:a.content,fileList:a.file_list,index:r,intl:_,isAgent:f,contentId:"".concat(g).concat(r),mcpTools:d,updateMCPTool:C,getMCPTool:T,item:a})}),(0,t.jsx)(tn,{messageApi:l,index:r,idName:c,cidName:g,id:m,agentChatRoomId:o,isAgent:f})]})]}):null},nn=s(47635),rn=function(e,n,a,r,o,u,l,m,c,g,d,C,T,_,f,O,b){var S=(0,P.useIntl)(),z=(0,D.Z)(function(R){return R.setTruncatable}),V=function(h){try{var v=JSON.parse(h.slice(22,-2));return Array.isArray(v)&&v.length>=2?[v[0],v[1]]:null}catch(y){return console.warn("Failed to parse instruction:",y),null}},we=function(h){return h.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},xe=function(h){c(function(v){var y=v.contentBlocks||[],p=h(y);return M()(M()({},v),{},{contentBlocks:p})})},Ne=function(h){xe(function(v){var y=v[v.length-1];return y&&y.type==="text"?v.map(function(p,j){return j===v.length-1?M()(M()({},p),{},{content:(p.content||"")+h}):p}):[].concat(H()(v),[{type:"text",content:h,timestamp:Date.now()}])})},Je=function(h){xe(function(v){return[].concat(H()(v),[{type:"mcp",toolId:h,timestamp:Date.now()}])})},Re=function(h){return!(h!=null&&h.blocks)||!Array.isArray(h.blocks)?[]:h.blocks.map(function(v){var y;return v.type==="text"?{type:"text",content:v.content||"",timestamp:Date.now()}:v.type==="mcp-tool"&&(y=v.toolData)!==null&&y!==void 0&&y.id?{type:"mcp",toolId:v.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},rt=function(h){return h.filter(function(v){return v.type==="mcp"&&v.toolId}).map(function(v){return v.toolId})},pe=function(h,v){T&&T(h,v),C.current&&Object.keys(g).length>0&&c(function(y){var p=y.activeMCPTools||[],j=p.includes(h)?p:[].concat(H()(p),[h]);return M()(M()({},y),{},{activeMCPTools:j})})},Ue=function(h,v,y){try{if(!h||!Array.isArray(h))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!y)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),h;var p=h.filter(function($){return $.type==="mcp"&&$.toolId}).map(function($){return $.toolId}),j=v.filter(function($){return!p.includes($)}),X=j.map(function($){return{type:"mcp",toolId:$,timestamp:Date.now()}});return[].concat(H()(h),H()(X))}catch($){return console.error("Failed to sync MCP tool states to contentBlocks:",$),h}},Ge={ERROR:function(h){e(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(h),duration:10})},CHAT:function(h){if(Object.keys(g).length&&fe(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var v,y,p=M()({},g);if(((v=p.activeMCPTools)===null||v===void 0?void 0:v.length)>0||((y=p.contentBlocks)===null||y===void 0?void 0:y.length)>0){var j=Ue(p.contentBlocks||[],p.activeMCPTools||[],O);if(O&&j.length>0){var X=vt(j,O);X?(p.content=X,p.parsedContent=Le(X)):p.content&&(p.parsedContent=Le(p.content))}else p.content&&(p.parsedContent=Le(p.content));p.contentBlocks=j}else p.content&&(p.parsedContent=Le(p.content));o(function(Ce){return Ce.concat(p)}),c({})}var $={content:"".concat(h),is_agent:0};o(function(Ce){return Ce.concat($)}),f&&f(!0),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(h){o(function(v){if(v.length===0)return v;var y=v.length-1;return v.map(function(p,j){return j===y?M()(M()({},p),{},{file_list:h}):p})}),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(h){n(h)},TRUNCATABLE:function(h){z(h),h||r.open({type:"success",content:"".concat(S.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(h){r.open({type:"success",content:"".concat(S.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(h){var v=h.id,y=h.name,p=h.skill_or_workflow_name,j=h.args,X=p&&p.toLowerCase().includes("workflow");pe(v,{name:y,skill_or_workflow_name:p||y,args:j,status:B.RUNNING,isWorkflow:X}),Je(v)},WITHMCPTOOLRESULT:function(h){var v=h.id,y=h.result,p=B.COMPLETED;if(typeof y=="string")try{var j=JSON.parse(y);j.status==="failed"&&(p=B.FAILED)}catch(X){}else ee()(y)==="object"&&(y==null?void 0:y.status)==="failed"&&(p=B.FAILED);pe(v,{result:y,status:p})},WITHWFSTATUS:function(h){var v=h.id,y=h.status,p={id:y.id,status:y.status,app_run_id:y.app_run_id,node_exec_id:y.node_exec_id,workflow_name:y.workflow_name,need_user_confirm:y.need_user_confirm,show_todo_button:y.show_todo_button,confirmer_name:y.confirmer_name},j;switch(y.status){case"running":j=B.RUNNING;break;case"waiting_confirm":j=B.WAITING_CONFIRMATION;break;case"completed":j=B.COMPLETED;break;case"failed":j=B.FAILED;break;default:j=B.RUNNING;break}pe(v,{workflow_confirmation:p,status:j,isWorkflow:!0})}},he=function(h,v){Ge[h]=v},ie=function(h){var v=h.data,y=V(v),p=we(v),j=v.indexOf("REPLY")!==-1&&v.indexOf("ENDREPLY")===-1,X=v.indexOf("ABILITY")!==-1,$=v.indexOf("ENDCHAT")!==-1;if(p){if(!y)return;var Ce=y[0],Me=y[1],Ye=Ge[Ce];Ye?Ye(Me):console.warn("Unknown message type: ".concat(Ce))}if(p||console.log(C.current,h),!p&&C.current&&(d.current+=v,requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")}),c(function(ne){var Ee=d.current,ct=M()(M()({},ne),{},{content:Ee});return Ee&&(ct.parsedContent=Le(Ee)),ct}),Ne(v)),j&&p){var J=y[1];f&&f(!1);var A=m.current.filter(function(ne){return ne.agent_id==J})[0];o(function(ne){var Ee=ne;return Object.keys(g).length&&fe(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})&&(Ee=ne.concat(g)),d.current="",c({is_agent:1,icon:A==null?void 0:A.icon,name:A==null?void 0:A.name,content:"",activeMCPTools:[],agent_id:J,parsedContent:null,contentBlocks:[]}),C.current=!0,n(!0),z(!1),Ee})}if(X&&p){var le=y[1];c(function(ne){return M()(M()({},ne),{},{is_agent:1,ability_id:le})})}if($){if(C.current=!1,d.current="",e(!1),n(!1),z(!0),Object.keys(g).length){var _e,W,I=M()({},g);if(((_e=I.activeMCPTools)===null||_e===void 0?void 0:_e.length)>0||((W=I.contentBlocks)===null||W===void 0?void 0:W.length)>0){var Q=Ue(I.contentBlocks||[],I.activeMCPTools||[],O);if(O&&Q.length>0){var ye=vt(Q,O);ye?(I.content=ye,I.parsedContent=Le(ye)):I.content&&(I.parsedContent=Le(I.content))}else I.content&&(I.parsedContent=Le(I.content));I.contentBlocks=Q}else I.content&&(I.parsedContent=Le(I.content));o(function(ne){return ne.concat(I)})}c({}),a("")}};return{getSocketMessage:ie,addMessageHandler:he}},an=function(e){var n=e.currentMessage,a=e.agentChatRoomId,r=e.intl,o=e.mcpTools,u=o===void 0?{}:o,l=e.updateMCPTool,m=l===void 0?function(){}:l,c=e.getMCPTool,g=c===void 0?function(){return null}:c;return!n.name||!fe(n)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,t.jsx)(We.Z,{data:n}):(0,t.jsx)(We.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,ze.Qy)("GET").nickname}),(0,t.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Lt,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:u,updateMCPTool:m,getMCPTool:g,item:M()(M()({},n),{},{parsedContent:Le(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},on=(0,x.memo)(function(i){var e=i.messageApi,n=i.setCurrentMessageContent,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,m=i.setisEnd,c=i.setSendValue,g=i.agentChatRoomId,d=i.updateMCPTool,C=i.getCurrentMessageList,T=i.mcpTools,_=T===void 0?{}:T,f=i.getMCPTool,O=f===void 0?function(){return null}:f,b=i.setIsWaitingReply,S=i.removeHistoryMessage,z=i.setCurrentMessageFromHistory,V=(0,P.useIntl)(),we=(0,P.useParams)(),xe=we.id,Ne=(0,P.useLocation)(),Je=new URLSearchParams(Ne.search),Re=Je.get("id"),rt=g||xe||Re,pe=(0,D.Z)(function(Me){return Me.setDisableInput}),Ue=(0,x.useState)({}),Ge=F()(Ue,2),he=Ge[0],ie=Ge[1],R=(0,x.useRef)(!1),h=(0,x.useRef)(""),v=(0,x.useCallback)(function(Me){try{if(!Me||ee()(Me)!=="object"){console.warn("Invalid history message provided:",Me);return}if(Me.is_agent!==1){console.warn("Attempted to set non-agent message as current:",Me);return}var Ye=it(Me,O);if(!Ye){console.warn("Failed to prepare history message:",Me);return}ie(Ye),R.current=!0,h.current=Ye.content||""}catch(J){console.error("Failed to set current message from history:",J)}},[O]);(0,x.useEffect)(function(){z&&z(v)},[z,v]);var y=rn(pe,l,c,e,n,o,u,r,ie,he,h,R,d,C,b,O,S),p=y.getSocketMessage,j=(0,nn.Z)("chat",p),X=j.runSocket,$=j.sendMessage,Ce=j.readyState;return(0,x.useEffect)(function(){Ce==1&&rt&&$(JSON.stringify(["ENTER",parseInt(rt)]))},[Ce]),(0,x.useEffect)(function(){a&&Ce==1&&$(a)},[a]),(0,x.useEffect)(function(){X()},[]),(0,t.jsx)(an,{currentMessage:he,agentChatRoomId:g,intl:V,mcpTools:_,updateMCPTool:d,getMCPTool:O})}),sn=function(e){var n=e.type,a=n===void 0?"typing":n,r=e.size,o=r===void 0?"medium":r;if(a==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var u={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,m){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:M()(M()({},u),{},{animationDelay:"".concat(l,"s")})},m)})})]})}return a==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},ln=function(e){var n=e.autoRotate,a=n===void 0?!1:n,r=e.rotateInterval,o=r===void 0?3e3:r,u=e.initialType,l=u===void 0?"wave":u,m=e.size,c=m===void 0?"medium":m,g=(0,x.useState)(l),d=F()(g,2),C=d[0],T=d[1],_=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(sn,{type:C,size:c})})},un=function(e){var n=e.isVisible,a=e.animationType,r=a===void 0?"pulse":a,o=e.enableAutoRotate,u=o===void 0?!0:o,l=(0,P.useIntl)();return n?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(ln,{initialType:r,autoRotate:u,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},cn=(0,x.memo)(function(i){var e=i.messageApi,n=i.setUserMessage,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,m=i.setSendValue,c=i.agentChatRoomId,g=i.abilitiesList,d=i.mcpTools,C=i.updateMCPTool,T=i.getMCPTool,_=i.userMessage,f=(0,x.useState)([]),O=F()(f,2),b=O[0],S=O[1],z=(0,x.useState)(!1),V=F()(z,2),we=V[0],xe=V[1],Ne=(0,x.useState)(!1),Je=F()(Ne,2),Re=Je[0],rt=Je[1],pe=(0,x.useRef)(!1),Ue=(0,x.useRef)(null),Ge=(0,P.useParams)(),he=Ge.id,ie=(0,P.useLocation)(),R=new URLSearchParams(ie.search),h=R.get("id"),v=he||h;(0,x.useEffect)(function(){we&&(n(function(p){return[].concat(H()(b.reverse()),H()(p))}),S([]),setTimeout(function(){xe(!1),o.current.scrollTop=0},200))},[we]),(0,x.useEffect)(function(){if(!pe.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!Ue.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var p=st(_);if(p){if(!p.id){console.warn("Found agent message without ID, skipping:",p),pe.current=!0;return}if(Ue.current(p),n){var j=_.filter(function(X){return X!==p});n(j)}else console.warn("setUserMessage not available for history update");pe.current=!0}}catch(X){console.error("Failed to process history message:",X,{userMessageLength:_==null?void 0:_.length,hasCallback:!!Ue.current}),pe.current=!0}}},[_,n]),(0,x.useEffect)(function(){pe.current=!1},[v]);var y=function(j){if(n&&_){var X=_.filter(function($){return $!==j});n(X)}};return(0,t.jsxs)(t.Fragment,{children:[b.length?b.map(function(p,j){return(0,t.jsx)(Rt,{item:p,index:j,agentChatRoomId:c,abilitiesList:g,messageApi:e,id:v,idName:"currentContent",cidName:"currentChilContent",mcpTools:d,updateMCPTool:C,getMCPTool:T},j)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(un,{isVisible:Re}),(0,t.jsx)(on,{messageApi:e,setCurrentMessageContent:S,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:u,setIsStop:l,setisEnd:xe,setSendValue:m,agentChatRoomId:c,updateMCPTool:C,getCurrentMessageList:function(){return _||[]},mcpTools:d,getMCPTool:T,setIsWaitingReply:rt,removeHistoryMessage:y,setCurrentMessageFromHistory:function(j){Ue.current=j}})]})}),dn=(0,x.memo)(function(i){var e=i.messageApi,n=i.scrollDomRef,a=i.instruction,r=i.setIsStop,o=i.upButtonDom,u=i.setInstruction,l=i.agentList,m=i.agentChatRoomId,c=i.abilitiesList,g=(0,P.useIntl)(),d=(0,x.useState)(860),C=F()(d,2),T=C[0],_=C[1],f=(0,P.useParams)(),O=f.id,b=(0,P.useLocation)(),S=new URLSearchParams(b.search),z=S.get("id"),V=m||O||z,we=(0,x.useState)([]),xe=F()(we,2),Ne=xe[0],Je=xe[1],Re=(0,x.useRef)(!1),rt=(0,x.useState)(""),pe=F()(rt,2),Ue=pe[0],Ge=pe[1],he=(0,x.useRef)(null),ie=(0,x.useRef)(!0),R=(0,x.useState)({}),h=F()(R,2),v=h[0],y=h[1],p=(0,x.useRef)(2),j=(0,x.useRef)(1),X=(0,x.useRef)(0),$=function(I,Q){y(function(ye){var ne=ye[I];return ne?M()(M()({},ye),{},U()({},I,M()(M()({},ne),Q))):M()(M()({},ye),{},U()({},I,M()({id:I,status:B.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},Q)))})},Ce=function(I){return v[I]||null},Me=function(I){var Q=I.map(function(ye){var ne=M()({},ye);if(ye.is_agent===1&&ye.content){var Ee=Le(ye.content);ne.parsedContent=Ee,Ee.hasMCPTools&&Ee.blocks.forEach(function(ct){if(ct.type==="mcp-tool"&&ct.toolData){var oe=ct.toolData;if(!v[oe.id]){var Et=Ft(oe.workflow_confirmation_status,oe.result);y(function(At){return M()(M()({},At),{},U()({},oe.id,{id:oe.id,name:oe.name,skill_or_workflow_name:oe.skill_or_workflow_name||oe.name,workflow_run_id:oe.workflow_run_id||0,workflow_confirmation_status:oe.workflow_confirmation_status||null,args:oe.args||{},result:oe.result||null,status:Et,isWorkflow:oe.skill_or_workflow_name?oe.skill_or_workflow_name.toLowerCase().includes("workflow"):!1}))})}}})}return ne});return Q},Ye=function(){var W=me()(ue()().mark(function I(Q){var ye,ne,Ee=arguments;return ue()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(ye=Ee.length>1&&Ee[1]!==void 0?Ee[1]:function(){},!V){oe.next=6;break}return oe.next=4,(0,N.KH)(V,{page:j.current,page_size:10});case 4:ne=oe.sent,ne.code==0&&(p.current=ne.data.total_pages,Q||(he.current.style.display="none"),Je(function(Et){var At=ne.data.list.reverse(),Bt=Me(At);return Q?H()(Bt):[].concat(H()(Et),H()(Bt))}),Q?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):X.current=ne.data.list.length,ie.current=!0);case 6:case"end":return oe.stop()}},I)}));return function(Q){return W.apply(this,arguments)}}(),J=function(I){var Q=I.target.scrollHeight+(I.target.scrollTop-I.target.clientHeight);Re.current!==Math.ceil(I.target.scrollTop)<-50&&(Re.current=Math.ceil(I.target.scrollTop)<-50,o.current.style.display=Re.current?"flex":"none"),Q<10&&ie.current&&(ie.current=!1,j.current=j.current+1,he.current.style.display="flex",p.current>=j.current?Ye(!1):he.current.style.display="none")},A=function(I,Q){Q==="0"&&(Q=Number(Q));var ye=["".concat(I),Q!==""&&Q!==null&&Q!==void 0?Q:null];Ge(JSON.stringify(ye))},le=(0,D.Z)(function(W){return W.disableInput}),_e=(0,D.Z)(function(W){return W.clearMemory});return(0,x.useEffect)(function(){_e&&_e.length&&A(_e[0],_e[1])},[_e]),(0,x.useEffect)(function(){a&&a.length&&(A(a[0],a[1]!==void 0?a[1]:""),u([]))},[a]),(0,x.useEffect)(function(){j.current=1,Ye(!0)},[]),(0,x.useEffect)(function(){var W=function(){window.innerWidth<1280||_(window.innerWidth-320-(window.innerWidth-320)/2-88)};return W(),window.addEventListener("resize",W),function(){window.removeEventListener("resize",W)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:J,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:m?"":"".concat(T,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:Ne&&Ne.length?Ne.map(function(W,I){return(0,t.jsx)(Rt,{item:M()(M()({},W),{},{id:"c".concat(W.id)}),index:I,agentChatRoomId:m,abilitiesList:c,messageApi:e,id:V,idName:"content",cidName:"chilContent",mcpTools:v,updateMCPTool:$,getMCPTool:Ce},I)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(cn,{messageApi:e,setUserMessage:Je,sendValue:Ue,agentList:l,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:Ge,agentChatRoomId:m,abilitiesList:c,mcpTools:v,updateMCPTool:$,getMCPTool:Ce,userMessage:Ne})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!m&&!le&&Ne.length?(0,t.jsx)(ot,{roomid:V}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:he,children:(0,t.jsx)(re.Z,{})})]})})}),mn=function(e){var n=(0,x.useRef)(null),a=(0,x.useRef)(null),r=(0,x.useState)(!1),o=F()(r,2),u=o[0],l=o[1],m=(0,x.useState)([]),c=F()(m,2),g=c[0],d=c[1],C=(0,P.useParams)(),T=C.id,_=(0,P.useLocation)(),f=new URLSearchParams(_.search),O=f.get("id"),b=e||T||O;return{scrollDomRef:n,upButtonDom:a,isStop:u,setIsStop:l,instruction:g,setInstruction:d,id:b}},fn=s(61227),vn=s.n(fn),pn=s(82114),hn=s(77171),gn=s(85576),Ut=s(96486),xn=s(58299),_n=s(38008),yn=s(83062),Cn=function(e){var n=e.uploadedFiles,a=e.handleRemoveFile;return n.length?(0,t.jsx)(He.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,t.jsx)(xt.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(yn.Z,{title:r.name,children:(0,t.jsx)("div",{className:"flex items-center",children:r.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(He.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Ie.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),et(r.path_show||r.url,r.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Oe.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,t.jsx)(Ie.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),et(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},Mn=s(52645),bn=s(64317),jn=function(e){var n=e.agentChatRoomId,a=e.abilitiesList,r=e.abilityId,o=e.setAbilityId,u=e.clearContext,l=(0,P.useIntl)();return n?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,t.jsx)(bn.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(c){o(c)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(se.ZP,{size:"small",color:"danger",variant:"outlined",onClick:u,icon:(0,t.jsx)(Mn.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},In=s(88484),Tn=s(30159),Pn=s(26915),wn=Pn.Z.TextArea,Nn=function(e){var n=e.userSendvalue,a=e.setUserSendvalue,r=e.disableInput,o=e.isUploading,u=e.isStop,l=e.userSendmessage,m=e.handleFileUpload,c=e.sendMessage,g=e.stopChatRoom,d=(0,P.useIntl)(),C=(0,Ut.throttle)(function(){if(r||!n)return!1;c(n)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(se.ZP,{type:"text",icon:(0,t.jsx)(In.Z,{}),onClick:m,disabled:r||o,loading:o}),(0,t.jsx)(wn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(_){a(_.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(d.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:g,children:(0,t.jsx)(Tn.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:C,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},En=(0,x.memo)(function(i){var e,n=i.setInstruction,a=i.messageApi,r=i.isStop,o=i.scrollDomRef,u=i.upButtonDom,l=i.agentList,m=i.abilitiesList,c=i.agentChatRoomId,g=i.chatStatus,d=(0,P.useIntl)(),C=(0,D.Z)(function(J){return J.disableInput}),T=(0,D.Z)(function(J){return J.setDisableInput}),_=(0,D.Z)(function(J){return J.setClearMemory}),f=(0,xn.m)(),O=f.options,b=c?(0,_n.Zc)().isImageSupportModel:function(){return!1},S=(0,x.useState)(null),z=F()(S,2),V=z[0],we=z[1],xe=(0,x.useState)(""),Ne=F()(xe,2),Je=Ne[0],Re=Ne[1],rt=(0,x.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),pe=F()(rt,2),Ue=pe[0],Ge=pe[1],he=(0,E.ZP)({maxSizeMB:15,acceptedFileTypes:Ue,multiple:!0}),ie=he.uploadedFiles,R=he.handleUpload,h=he.removeFile,v=he.clearFiles,y=he.isUploading;(0,x.useEffect)(function(){var J,A;if(c&&(l==null||(J=l.current)===null||J===void 0?void 0:J.length)>0&&l!==null&&l!==void 0&&(A=l.current[0])!==null&&A!==void 0&&(A=A.agent)!==null&&A!==void 0&&A.m_config_id){var le,_e=l==null||(le=l.current[0])===null||le===void 0||(le=le.agent)===null||le===void 0?void 0:le.m_config_id,W=b(_e),I=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(W?",.jpg,.png,.jpeg":"");Ge(I)}},[l,O,l==null||(e=l.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,b]);var p=function(){var A=gn.Z.confirm;A({title:d.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(pn.Z,{}),content:d.formatMessage({id:"app.chatroom.clear.tips"}),okText:d.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:d.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){_(["TRUNCATE","0"])}})},j=function J(A,le){if(A.length===0){le&&le();return}var _e=vn()(A),W=_e[0],I=_e.slice(1);n(W),setTimeout(function(){J(I,le)},100)},X=function(A){var le=[];(ie==null?void 0:ie.length)>0&&le.push(["FILELIST",ie.map(function(W){return W.file_id})]);var _e=V||0;le.push(["SETABILITY",_e]),le.push(["INPUT",A]),j(le,function(){(ie==null?void 0:ie.length)>0&&v()})},$=function(A){!A.shiftKey&&A.target.value==""&&(a.open({type:"warning",content:d.formatMessage({id:"app.chatroom.content.input"}),duration:10}),Re(""),A.preventDefault()),!A.shiftKey&&A.keyCode==13&&A.target.value!=""&&(T(!0),Re(""),X(A.target.value),A.preventDefault())},Ce=(0,Ut.throttle)(function(){n(["STOP",null])},300),Me=function(){C||R()},Ye=function(A){if(!A){a.open({type:"warning",content:d.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}T(!0),X(A),Re("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:u,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(A){o.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(hn.Z,{className:"text-[16px]"})}),(0,t.jsx)(Cn,{uploadedFiles:ie,handleRemoveFile:h}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(ie.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(jn,{agentChatRoomId:c,abilitiesList:m,abilityId:V,setAbilityId:we,clearContext:p}),(0,t.jsx)(Nn,{userSendvalue:Je,setUserSendvalue:Re,disableInput:C,isUploading:y,isStop:r,userSendmessage:$,handleFileUpload:Me,sendMessage:Ye,stopChatRoom:Ce})]})]})}),An=(0,x.memo)(function(i){var e=i.agentList,n=i.agentChatRoomId,a=i.abilitiesList,r=i.chatStatus,o=mn(n),u=o.scrollDomRef,l=o.upButtonDom,m=o.isStop,c=o.setIsStop,g=o.instruction,d=o.setInstruction;(0,x.useEffect)(function(){console.log(r),r==1&&c(!0)},[r]);var C=ke.ZP.useMessage(),T=F()(C,2),_=T[0],f=T[1];return(0,t.jsxs)(t.Fragment,{children:[f,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(dn,{instruction:g,setInstruction:d,messageApi:_,scrollDomRef:u,setIsStop:c,upButtonDom:l,agentList:e,agentChatRoomId:n,abilitiesList:a}),(0,t.jsx)(En,{setInstruction:d,messageApi:_,isStop:m,upButtonDom:l,scrollDomRef:u,agentList:e,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})})},85877:function(pt,Be,s){var Ae=s(19632),F=s.n(Ae),ke=s(97857),Z=s.n(ke),x=s(5574),q=s.n(x),ue=s(52677),Se=s.n(ue),H=s(35312),be=s(78234),me=s(77598),De=s(96486),U=s.n(De),K=s(67294),M=s(73935),N=s(43413),D=s(92858),P=s(16845),re=s(15425),G=s(85893),t=function(E){var L=E.children;return(typeof document=="undefined"?"undefined":Se()(document))==="object"?M.createPortal(L,document.body):null},ot=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),We=function(E){var L=E.value,de=E.onChange,ge=E.id,ce=E.placeholder,ae=E.options,Fe=(0,H.useIntl)(),Xe=(0,K.useRef)(),ht=(0,K.useState)(),qe=q()(ht,2),Te=qe[0],ee=qe[1],et=(0,K.useState)(0),tt=q()(et,2),Pe=tt[0],fe=tt[1],dt=(0,K.useState)(""),st=q()(dt,2),mt=st[0],Ve=st[1],it=(0,K.useCallback)(function(w){return(0,G.jsx)(He,Z()({},w))},[]),ft=(0,K.useCallback)(function(w){return(0,G.jsx)(Ze,Z()({},w))},[]),te=(0,K.useMemo)(function(){return ze((0,P.BU)((0,D.VC)((0,N.Jh)())))},[]),lt=(0,K.useState)(null),k=q()(lt,2),Ke=k[0],jt=k[1],St=(0,re.Z)(function(w){return w.selectedNode}),Le=(0,re.Z)(function(w){return w.getOutputVariables}),kt=(0,re.Z)(function(w){return w.getInputVariables}),Dt=(0,K.useState)([]),It=q()(Dt,2),Qe=It[0],Ct=It[1];(0,be.Z)(function(){L&&L.length>0&&vt(L),ae!=null&&ae.length&&Ct(ae.map(function(w){return Z()(Z()({},w),{},{name:w.label,id:w.value})}))}),(0,me.Z)(function(){var w=U().isEqual(Ke,L);w||(L&&L.length>0?vt(L):L&&U().isArray(L)&&L.length==0&&vt([{type:"paragraph",children:[]}]))},[L,ge]),(0,me.Z)(function(){ae.length&&Ct(ae.map(function(w){return Z()(Z()({},w),{},{name:w.label,id:w.value})})),console.log(ae)},[ae]);var vt=function(Y){jt(Y),gt(te,{nodes:[{type:"paragraph",children:[]}]}),gt(te,{nodes:Y})},Mt=(0,K.useCallback)(function(w){if(Te&&Qe.length>0)switch(w.key){case"ArrowDown":w.preventDefault();var Y=Pe>=Qe.length-1?0:Pe+1;fe(Y);return;case"ArrowUp":w.preventDefault();var ve=Pe<=0?Qe.length-1:Pe-1;fe(ve);return;case"Tab":case"Enter":w.preventDefault(),N.YR.select(te,Te),je(te,Qe[Pe]),ee(null);return;case"Escape":w.preventDefault(),ee(null);return}else if(w.key==="@"){setTimeout(function(){return xt()},10);return}ee(null)},[Qe,te,Pe,Te]),gt=function(Y){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_t=F()(Y.children);if(_t.forEach(function(nt){return Y.apply({type:"remove_node",path:[0],node:nt})}),ve.nodes){var at=N.NB.isNode(ve.nodes)?[ve.nodes]:ve.nodes;at.forEach(function(nt,yt){return Y.apply({type:"insert_node",path:[yt],node:nt})})}var ut=ve.at&&N.E9.isPoint(ve.at)?ve.at:N.ML.end(Y,[]);ut&&N.YR.select(Y,ut)};(0,K.useEffect)(function(){if(Te&&Qe.length>0){var w=Xe.current,Y=P.F3.toDOMRange(te,Te),ve=Y.getBoundingClientRect();w.style.top="".concat(ve.top+window.pageYOffset+24,"px"),w.style.left="".concat(ve.left+window.pageXOffset,"px")}},[Qe.length,te,Pe,mt,Te]);var xt=function(){var Y=te.selection;if(Y&&N.e6.isCollapsed(Y)){var ve=N.e6.edges(Y),_t=q()(ve,1),at=_t[0],ut=N.ML.before(te,at),nt=ut&&N.ML.range(te,ut,at),yt=nt&&N.ML.string(te,nt),Tt=N.ML.after(te,at),Pt=N.ML.range(te,at,Tt),Ot=N.ML.string(te,Pt);ee(nt),Ve(""),fe(0);return}ee(null)};return(0,G.jsxs)(P.mH,{editor:te,initialValue:Ie,onChange:function(Y){de==null||de(Y),ee(null)},children:[(0,G.jsx)(P.CX,{renderElement:it,renderLeaf:ft,onKeyDown:Mt,className:"!outline-none",placeholder:ce!=null?ce:Fe.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),Te&&(0,G.jsx)(t,{children:(0,G.jsx)("div",{ref:Xe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:Qe.length?Qe.map(function(w,Y){return(0,G.jsx)("div",{onClick:function(){console.log(w),N.YR.select(te,Te),je(te,w),ee(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:Y===Pe?"#B4D5FF":""},children:(0,G.jsx)("span",{children:w.name})},w.name+Y)}):(0,G.jsx)(G.Fragment,{children:Fe.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},ze=function(E){var L=E.isInline,de=E.isVoid,ge=E.markableVoid;return E.isInline=function(ce){return ce.type==="mention"?!0:L(ce)},E.isVoid=function(ce){return ce.type==="mention"?!0:de(ce)},E.markableVoid=function(ce){return ce.type==="mention"||ge(ce)},E},je=function(E,L){var de={type:"mention",id:(L==null?void 0:L.id)||"",character:L.name,base:L,children:[{bold:!0,text:"11111"}]};N.YR.insertNodes(E,de),N.YR.move(E)},Ze=function(E){var L=E.attributes,de=E.children,ge=E.leaf;return(0,G.jsx)("span",Z()(Z()({},L),{},{children:de}))},He=function(E){var L=E.attributes,de=E.children,ge=E.element;switch(ge.type){case"mention":return(0,G.jsx)(se,Z()({},E));default:return(0,G.jsx)("p",Z()(Z()({},L),{},{children:de}))}},se=function(E){var L=E.attributes,de=E.children,ge=E.element,ce=(0,P.vt)(),ae=(0,P.UE)(),Fe={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:ce&&ae?"0 0 0 2px #B4D5FF":"none"};return ge.children[0].bold&&(Fe.fontWeight="bold"),ge.children[0].italic&&(Fe.fontStyle="italic"),(0,G.jsx)("span",Z()(Z()({},L),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(ge.character.replace(" ","-")),style:Fe,children:ot?(0,G.jsxs)(K.Fragment,{children:["1",de,"/",ge.character]}):(0,G.jsxs)(K.Fragment,{children:[(0,G.jsx)("span",{children:ge.character}),de]})}))},Ie=[{type:"paragraph",children:[{text:""}]}];Be.Z=We},38008:function(pt,Be,s){s.d(Be,{Zc:function(){return ue},aS:function(){return q}});var Ae=s(67294),F=s(85750),ke=s(58299),Z=s(85893),x=(0,Ae.createContext)(void 0),q=function(be){var me=be.children,De=(0,ke.m)(),U=De.options,K=(0,Ae.useMemo)(function(){var M=function(P){if(!P||!U)return!1;var re=(0,F.ti)(P,{options:U});return(re==null?void 0:re.support_image)===1},N=function(P){return M(P)};return{isImageSupportModel:M,getCurrentModelImageSupport:N}},[U]);return(0,Z.jsx)(x.Provider,{value:K,children:me})},ue=function(){var be=(0,Ae.useContext)(x);if(be===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return be},Se=null},77295:function(pt,Be,s){s.d(Be,{CO:function(){return U}});var Ae=s(15009),F=s.n(Ae),ke=s(19632),Z=s.n(ke),x=s(99289),q=s.n(x),ue=s(5574),Se=s.n(ue),H=s(45360),be=s(35312),me=s(67294),De=s(83065),U=function(N){var D,P=N==null||(D=N.split(".").pop())===null||D===void 0?void 0:D.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(P||"")},K=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},D=(0,be.useIntl)(),P=(0,me.useState)([]),re=Se()(P,2),G=re[0],t=re[1],ot=(0,me.useState)(!1),We=Se()(ot,2),ze=We[0],je=We[1],Ze=N.maxSizeMB,He=Ze===void 0?15:Ze,se=N.acceptedFileTypes,Ie=se===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":se,Oe=N.multiple,E=Oe===void 0?!0:Oe,L=function(){var ae=document.createElement("input");ae.type="file",ae.accept=Ie,ae.multiple=E,ae.onchange=function(){var Fe=q()(F()().mark(function Xe(ht){var qe,Te,ee,et,tt,Pe,fe,dt,st,mt,Ve,it,ft,te;return F()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(qe=ht.target,!(qe.files&&qe.files.length>0)){k.next=37;break}if(je(!0),Te=Array.from(qe.files),ee=Te.filter(function(Ke){return Ke.size/1024/1024>He}),!(ee.length>0)){k.next=9;break}return H.ZP.error("".concat(ee.map(function(Ke){return Ke.name}).join(", ")," ").concat(D.formatMessage({id:"workflow.uploadFileErrorText"}))),je(!1),k.abrupt("return");case 9:et=[],tt=0,Pe=Te;case 11:if(!(tt<Pe.length)){k.next=35;break}return fe=Pe[tt],dt=new FormData,dt.append("file",fe),k.prev=15,k.next=18,(0,De.M$)();case 18:return st=k.sent,k.next=21,fetch(st,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:dt});case 21:return mt=k.sent,k.next=24,mt.json();case 24:Ve=k.sent,Ve.code===0?(H.ZP.success("".concat(fe.name," ").concat(D.formatMessage({id:"workflow.uploadSuccess"}))),(it=Ve.data)!==null&&it!==void 0&&it.file_id&&(ft=U(fe.name),te={name:fe.name,url:Ve.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:ft,file_id:Ve.data.file_id,path_show:Ve.data.file_url||Ve.data.path_show||""},et.push(te))):H.ZP.error("".concat(fe.name," ").concat(D.formatMessage({id:"workflow.uploadFailed"}))),k.next=32;break;case 28:k.prev=28,k.t0=k.catch(15),console.error("Upload error:",k.t0),H.ZP.error("".concat(fe.name," ").concat(D.formatMessage({id:"workflow.uploadFailed"})));case 32:tt++,k.next=11;break;case 35:t(function(Ke){return[].concat(Z()(Ke),et)}),je(!1);case 37:case"end":return k.stop()}},Xe,null,[[15,28]])}));return function(Xe){return Fe.apply(this,arguments)}}(),ae.click()},de=function(ae){t(function(Fe){return Fe.filter(function(Xe){return Xe.uid!==ae})})},ge=function(){t([])};return{uploadedFiles:G,setUploadedFiles:t,handleUpload:L,removeFile:de,clearFiles:ge,isUploading:ze}};Be.ZP=K},58299:function(pt,Be,s){s.d(Be,{m:function(){return K}});var Ae=s(64599),F=s.n(Ae),ke=s(97857),Z=s.n(ke),x=s(15009),q=s.n(x),ue=s(99289),Se=s.n(ue),H=s(73445),be=s(42237),me=s(45360),De=s(67294),U=(0,H.Ue)(function(M){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var N=Se()(q()().mark(function P(){var re;return q()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,M({loading:!0}),t.next=4,(0,be.fZ)();case 4:if(re=t.sent,re.code!==0){t.next=9;break}M({models:Array.isArray(re.data.data)?re.data.data:[],initialized:!0}),t.next=10;break;case 9:throw new Error(re.message||"Failed to fetch models");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),M({error:t.t0.message}),me.ZP.error("Failed to fetch models");case 16:return t.prev=16,M({loading:!1}),t.finish(16);case 19:case"end":return t.stop()}},P,null,[[0,12,16,19]])}));function D(){return N.apply(this,arguments)}return D}()}}),K=function(){var N=U(function(t){return t.models}),D=U(function(t){return t.loading}),P=U(function(t){return t.initialized}),re=U(function(t){return t.fetchModels});(0,De.useEffect)(function(){P||re()},[P,re]);var G=(0,De.useMemo)(function(){var t=Array.isArray(N)?N:[],ot=t.map(function(se){return{label:se.supplier_name,options:Array.isArray(se.model_list)?se.model_list.map(function(Ie){return Z()({label:Ie.model_name,value:Ie.model_config_id},Ie)}):[]}}),We,ze=F()(t),je;try{for(ze.s();!(je=ze.n()).done;){var Ze=je.value;if(Array.isArray(Ze.model_list)){var He=Ze.model_list.find(function(se){return se.model_default_used===1});if(He){We=He.model_config_id;break}}}}catch(se){ze.e(se)}finally{ze.f()}return{options:ot,defaultValue:We}},[N]);return Z()(Z()({},G),{},{loading:D})}}}]);
