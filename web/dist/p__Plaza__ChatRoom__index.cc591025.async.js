"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{86:function(it,Fe,m){var $e=m(5574),A=m.n($e),Le=m(32332),ne=m(38703),Ze=m(67294),f=m(85893),de=function(a){var ae=a.subtitle,He=a.handleClick,ce=a.lineClamp,Qe=ce===void 0?2:ce,Q=a.textDetails,ve=a.title,Be=a.icon,De=a.iconType,Ie=De===void 0?"":De,Ae=a.operation,Ce=Ae===void 0?"":Ae,Se=a.progress,fe=a.status,Pe=a.backlogTips,Ee=(0,Ze.useState)(0),he=A()(Ee,2),Re=he[0],ke=he[1],ze=function(){ke(Se)},Ve=function(){ke(0)},Ue=function(e){return"rounded-[4px] border-l-[4px] ".concat(e==1?"border-[#1B64F3]":e==2?"border-[#52C41C]":"border-[#F04444]"," ")};return(0,f.jsxs)("div",{className:"flex  p-[10px] cursor-pointer overflow-hidden relative bg-[#fff] ".concat(fe!==void 0?Ue(fe):"graphicbox"),onClick:He,onMouseEnter:function(){Se!=null&&ze()},onMouseLeave:function(){Se!=null&&Ve()},children:[fe!==void 0&&(0,f.jsx)("div",{style:{width:"".concat(Re,"%"),transition:"width 0.5s "},className:"absolute bottom-0 left-0 top-0 bottom-0 h-full ".concat(fe==1?"bg-[#1B64F3]/[.03]":fe==2?"bg-[#52c41c]/[.05]":"bg-[#FAFAFA]"," ")}),(0,f.jsxs)("div",{className:"flex gap-x-[20px] w-full relative z-20",children:[(0,f.jsx)("div",{className:"shrink-0 flex gap-x-[7px] items-center",style:{fontSize:0},children:(0,f.jsxs)("div",{className:"w-[40px] h-[40px] rounded-[6px] flex items-center justify-center bg-[#F4F8F1] relative",children:[(0,f.jsx)("img",{src:(0,Le.s9)("single",Be),className:"w-[22px] h-[22px]"}),Ie&&(0,f.jsx)("div",{className:"w-[16px] h-[16px] absolute top-[28px] left-[28px] flex items-center justify-center bg-[#fff] rounded-[3px]",style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,f.jsx)("img",{src:"/icons/".concat(Ie,".svg"),alt:"",className:"w-[12px] h-[12px]"})})]})}),(0,f.jsx)("div",{className:"flex flex-1 min-w-0",children:(0,f.jsxs)("div",{className:"flex justify-center flex-col gap-y-[5px] flex-1 min-w-0",children:[(0,f.jsxs)("span",{className:"text-[12px] flex items-center",style:{color:"#213044"},children:[(0,f.jsx)("span",{className:"truncate",children:ve}),(0,f.jsx)("span",{className:"flex items-center flex-1",children:ae})]}),(0,f.jsx)("span",{className:"text-[12px] max-w-full truncate",style:{color:"#999999"},children:Q})]})}),Pe||(0,f.jsx)(f.Fragment,{}),Ce&&(0,f.jsx)("div",{className:"flex items-center w-[24px]",children:(0,f.jsx)("span",{className:"operation",children:Ce})}),Se!=null&&(0,f.jsx)("div",{className:"graphic_progress flex items-center pl-[30px]",children:(0,f.jsx)(ne.Z,{type:"circle",percent:Se,size:29})})]})]})};Fe.Z=de},53885:function(it,Fe,m){m.r(Fe),m.d(Fe,{default:function(){return Da}});var $e=m(15009),A=m.n($e),Le=m(99289),ne=m.n(Le),Ze=m(5574),f=m.n(Ze),de=m(43722),ye=m(32983),a=m(67294),ae=m(35312),He=m(19632),ce=m.n(He),Qe=m(97857),Q=m.n(Qe),ve=m(32332),Be=m(82114),De=m(82826),Ie=m(63783),Ae=m(3471),Ce=m(45360),Se=m(85576),fe=m(28036),Pe=m(83062),Ee=m(72269),he=m(74330),Re=m(96486),ke=m(44010),ze=m(73445),Ve=m(782),Ue=(0,ze.Ue)((0,Ve.mW)(function(u,r){return{clearMemory:null,truncatable:!1,disableInput:!1,summaryParams:null,runsSummaryShow:!1,summaryClick:!0,setClearMemory:function(d){u({clearMemory:d})},setTruncatable:function(d){u({truncatable:d})},setDisableInput:function(d){u({disableInput:d})},setSummaryParams:function(d){u({summaryParams:d})},setRunsSummaryShow:function(d){u({runsSummaryShow:d})},setSummaryClick:function(d){console.log(d),u({summaryClick:d})}}})),q=Ue,e=m(85893),lt=function(r){var s=(0,ae.useIntl)(),d=r.roomDetail,N=r.setAgent,c=Ce.ZP.useMessage(),p=f()(c,2),h=p[0],I=p[1],v=(0,ae.useParams)(),y=v.id,x=q(function(l){return l.disableInput}),b=q(function(l){return l.truncatable}),_=q(function(l){return l.setClearMemory}),k=(0,a.useState)([]),t=f()(k,2),i=t[0],C=t[1],V=(0,a.useState)(Q()({},d)),M=f()(V,2),j=M[0],L=M[1],z=(0,a.useState)([]),X=f()(z,2),U=X[0],T=X[1],J=(0,a.useRef)(!1),se=(0,a.useRef)(!1),Y=(0,a.useState)(!1),W=f()(Y,2),ee=W[0],D=W[1],$=function(){var n=Se.Z.confirm;n({title:s.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Be.Z,{}),content:s.formatMessage({id:"app.chatroom.clear.tips"}),okText:s.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:s.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){_(["TRUNCATE","0"])}})},E=function(){var l=ne()(A()().mark(function n(){var o;return A()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!y){g.next=5;break}return g.next=3,(0,de.cH)({id:y});case 3:if(o=g.sent,o.code==0)try{L(function(){return Q()(Q()({},o.data.chat_info),{},{max_round:o.data.max_round,smart_selection:o.data.smart_selection})}),C(o.data.agent_list),J.current=!0}catch(P){}case 5:case"end":return g.stop()}},n)}));return function(){return l.apply(this,arguments)}}(),ie=function(){var l=ne()(A()().mark(function n(){var o;return A()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,de.j2)({id:y});case 2:o=g.sent,o.code==0&&(T(o.data.list),se.current=!0);case 4:case"end":return g.stop()}},n)}));return function(){return l.apply(this,arguments)}}(),G=function(){var l=ne()(A()().mark(function n(o){var R,g,P;return A()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!y){O.next=11;break}if(R=o.active==1?0:1,R!=0){O.next=7;break}if(g=i.filter(function(te){return te.active==1}),g.length-1!=0){O.next=7;break}return h.open({type:"error",content:s.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),O.abrupt("return",!1);case 7:return O.next=9,(0,de.sT)({active:R},y,o.agent_id);case 9:P=O.sent,P.code==0&&C(function(te){return te.map(function(xe){return Q()(Q()({},xe),{},{active:xe.agent_id==o.agent_id?R:xe.active})})});case 11:case"end":return O.stop()}},n)}));return function(o){return l.apply(this,arguments)}}(),le=function(n){return n.length>6?n.length=6:n.lenth,n},K=function(n){n.type=="my_agent"?ae.history.push("/Agents?app_id=".concat(n.app_id,"&type=false&from=chat_room")):ae.history.push("/ReadOnlyAgent?app_id=".concat(n.app_id,"&type=true&from=chat_room"))},F=function(n){ae.history.replace("/chat_room/".concat(n.chatroom_id)),window.location.reload()},H=function(){D(!0)},w=function(){D(!1)},S=function(){var l=ne()(A()().mark(function n(o){var R,g,P;return A()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!(o.checkItem&&o.checkItem.length==0)){O.next=3;break}return h.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),O.abrupt("return");case 3:return R=ce()(o.checkItem).map(function(te){var xe=te.agent_id,re=te.active,oe=re===void 0?1:re;return{agent_id:xe,active:oe}}),g={description:j.description,name:j.name,max_round:j.max_round},O.next=7,(0,de.sI)(Q()(Q()({},g),{},{agent:R}),y);case 7:P=O.sent,P.code==0?(o.checkItem.map(function(te){te.active=te.active==null?1:te.active}),C(ce()(o.checkItem)),N.current=ce()(o.checkItem),h.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):h.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return O.stop()}},n)}));return function(o){return l.apply(this,arguments)}}(),Z=function(){var l=ne()(A()().mark(function n(){var o;return A()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=j.smart_selection==1?0:1,g.next=3,(0,de.r5)({smart_selection:o},y);case 3:L(function(P){return Q()(Q()({},P),{},{smart_selection:o})});case 4:case"end":return g.stop()}},n)}));return function(){return l.apply(this,arguments)}}();return(0,a.useEffect)(function(){E(),ie()},[]),(0,e.jsxs)(e.Fragment,{children:[I,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){ae.history.go(-1)},children:[(0,e.jsx)(fe.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(De.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:s.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:j.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(Pe.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:s.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ie.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:s.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ee.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:j.smart_selection==1,onChange:Z,disabled:x})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:J.current?(0,e.jsx)("div",{className:"flex flex-col",children:i&&i.length>0?i.map(function(l){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",l.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:l.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:l.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){K(l)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ee.Z,{size:"small",disabled:x,defaultChecked:!0,className:"w-[28px]",checked:l.active==1,onChange:function(){G(l)}})]})]},l.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:H,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:b&&!x?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Re.throttle)(function(){b&&!x&&$()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:s.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:se.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:U&&U.length>0?U.map(function(l){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){F(l)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:l.name}),l.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:l.agent_list&&l.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[le(l.agent_list).map(function(n,o){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",n.icon),alt:"",className:"w-[18px]  h-[18px]"})})},o)}),l.agent_list.length>=6?(0,e.jsx)(Ae.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},l.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})})]})]}),(0,e.jsx)(ke.Z,{show:ee,popupClose:w,popupSave:S,checkList:i,zIndex:99})]})]})},ct=(0,a.memo)(lt),ot=m(13769),ut=m.n(ot),dt=m(47635),pe=m(1413),pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},xt=pt,Ne=m(91146),ft=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:xt}))},mt=a.forwardRef(ft),vt=mt,ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},gt=ht,jt=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:gt}))},yt=a.forwardRef(jt),St=yt,Nt=m(2068),wt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},_t=wt,bt=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:_t}))},Ct=a.forwardRef(bt),Rt=Ct,Xe=m(26915),kt=m(20640),qe=m.n(kt),ge=m(22683),je=m(97807),Mt=["node","className","children"],Ft=Xe.Z.TextArea,Dt=(0,a.memo)(function(u){var r=u.setInstruction,s=u.messageApi,d=u.isStop,N=u.scrollDomRef,c=u.upButtonDom,p=(0,ae.useIntl)(),h=q(function(t){return t.disableInput}),I=q(function(t){return t.setDisableInput}),v=(0,a.useState)(""),y=f()(v,2),x=y[0],b=y[1],_=function(i){!i.shiftKey&&i.target.value==""&&(s.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),b(""),i.preventDefault()),!i.shiftKey&&i.keyCode==13&&i.target.value!=""&&(I(!0),b(""),r(["INPUT",i.target.value]),i.preventDefault())},k=(0,Re.throttle)(function(){r(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:c,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(i){N.current.scrollTo({top:N.current.scrollHeight,behavior:"smooth"})},children:(0,e.jsx)(vt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(Ft,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:x,disabled:h,onChange:function(i){b(i.target.value)},onPressEnter:_,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(p.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),d?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:k,children:(0,e.jsx)(St,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(h||!x?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Re.throttle)(function(){if(h||!x)return!1;x||s.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),I(!0),r(["INPUT",x]),b("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),It=function u(r){return typeof r=="string"?r:Array.isArray(r)?r.map(u).join(""):a.isValidElement(r)?u(r.props.children):""},At=function(r){return It(r)},We=function(r,s){return{code:function(N){var c=N.node,p=N.className,h=N.children,I=ut()(N,Mt),v=/language-(\w+)/.exec(p||"");if(v!=null&&v.length){var y=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:v[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var x=ne()(A()().mark(function b(_){var k;return A()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,k=_.currentTarget,i.next=4,qe()(At(h));case 4:k&&(k.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){k&&(k.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copycode"}))},200),i.next=11;break;case 8:i.prev=8,i.t0=i.catch(0),console.error("Failed to copy text: ",i.t0);case 11:case"end":return i.stop()}},b,null,[[0,8]])}));return function(b){return x.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:s.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(y).concat(r),className:"p-4",children:h})})]})}else return(0,e.jsx)("code",Q()(Q()({},I),{},{children:h}))}}},et=(0,a.memo)(function(u){var r=u.messageApi,s=u.index,d=u.idName,N=u.cidName,c=(0,ae.useIntl)(),p=(0,a.useState)(!1),h=f()(p,2),I=h[0],v=h[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){v(!0)},onMouseLeave:function(){v(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var y=ne()(A()().mark(function x(b){var _,k;return A()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return _=b.target.closest("#".concat(d).concat(s)),k=_.querySelector("#".concat(N).concat(s)),i.prev=2,i.next=5,qe()(k.innerText);case 5:r.open({type:"success",content:c.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),i.next=11;break;case 8:i.prev=8,i.t0=i.catch(2),console.error("Failed to copy text: ",i.t0);case 11:case"end":return i.stop()}},x,null,[[2,8]])}));return function(x){return y.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(I?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(I?" text-[#1B64F3]":"text-[#666]"),children:c.formatMessage({id:"app.chatroom.content.copy"})})]})})}),tt=function(r){var s=r.id,d=r.index,N=r.idName,c=r.cidName,p=(0,ae.useIntl)(),h=q(function(k){return k.setSummaryClick}),I=(0,a.useState)(!0),v=f()(I,2),y=v[0],x=v[1],b=q(function(k){return k.summaryClick});(0,a.useEffect)(function(){x(b)},[b]);var _=q(function(k){return k.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(y?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(t){if(y){var i=t.target.closest("#".concat(N).concat(d)),C=i.querySelector("#".concat(c).concat(d));_({id:s,message:C.innerText}),h(!1)}},children:[(0,e.jsx)(Nt.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.chatroom.content.summary"})})]})})},Pt=function(r){var s=r.roomid,d=(0,ae.useIntl)(),N=q(function(x){return x.setSummaryClick}),c=(0,a.useState)(!0),p=f()(c,2),h=p[0],I=p[1],v=q(function(x){return x.summaryClick});(0,a.useEffect)(function(){I(v)},[v]);var y=q(function(x){return x.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(h?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){h&&(y({id:s}),N(!1))},children:[(0,e.jsx)(Rt,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:d.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Et=(0,a.memo)(function(u){var r=u.messageApi,s=u.setCurrentMessageContent,d=u.sendValue,N=u.agentList,c=u.scrollDomRef,p=u.upButtonDom,h=u.setIsStop,I=u.setisEnd,v=u.setSendValue,y=(0,ae.useIntl)(),x=(0,ae.useParams)(),b=x.id,_=q(function(J){return J.setDisableInput}),k=(0,a.useState)({}),t=f()(k,2),i=t[0],C=t[1],V=(0,a.useRef)(!1),M=(0,a.useRef)(""),j=q(function(J){return J.setTruncatable}),L=function(se){var Y=se.data;if(Y.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var W=JSON.parse(Y.slice(22,-2));switch(W[0]){case"ERROR":_(!1),h(!1),v(""),r.open({type:"error",content:"webSocket-".concat(W[1]),duration:10});break;case"CHAT":var ee={content:"".concat(W[1]),is_agent:0};s(function(E){return[].concat(ce()(E),[ee])}),setTimeout(function(){c.current.scrollTop=c.current.scrollHeight,p.current.style.display="none"});break;case"STOPPABLE":h(W[1]);break;case"TRUNCATABLE":j(W[1]),W[1]||r.open({type:"success",content:"".concat(y.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":r.open({type:"success",content:"".concat(y.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(Y.indexOf("REPLY")!==-1&&Y.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var D=JSON.parse(Y.slice(22,-2))[1];M.current="",V.current=!0;var $=N.current.filter(function(E){return E.agent_id==D})[0];Object.keys(i).length&&s(function(E){return[].concat(ce()(E),[i])}),C(function(E){return Q()(Q()({},E),{},{is_agent:1,icon:$==null?void 0:$.icon,name:$==null?void 0:$.name})}),h(!0),j(!1)}Y.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&V.current&&(c.current.scrollTop=c.current.scrollHeight,p.current.style.display="none",M.current+=Y,C(function(E){return Q()(Q()({},E),{},{content:M.current})})),Y.indexOf("ENDCHAT")!==-1&&(V.current=!1,M.current="",_(!1),h(!1),j(!0),Object.keys(i).length&&s(function(E){return[].concat(ce()(E),[i])}),C({}),I(!0),v(""))},z=(0,dt.Z)("chat",L),X=z.runSocket,U=z.sendMessage,T=z.readyState;return(0,a.useEffect)(function(){T==1&&b&&U(JSON.stringify(["ENTER",parseInt(b)]))},[T]),(0,a.useEffect)(function(){d&&T==1&&U(d)},[d]),(0,a.useEffect)(function(){X()},[]),(0,e.jsx)(e.Fragment,{children:i.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(i.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:i.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",i.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(i.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:i.name?i.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(i.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:i.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We("add",y),children:i.content})})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Ot=(0,a.memo)(function(u){var r=u.messageApi,s=u.setUserMessage,d=u.sendValue,N=u.agentList,c=u.scrollDomRef,p=u.upButtonDom,h=u.setIsStop,I=u.setSendValue,v=(0,ae.useIntl)(),y=(0,a.useState)([]),x=f()(y,2),b=x[0],_=x[1],k=(0,a.useState)(!1),t=f()(k,2),i=t[0],C=t[1],V=(0,ae.useParams)(),M=V.id;return(0,a.useEffect)(function(){i&&(s(function(j){return[].concat(ce()(j),ce()(b))}),_([]),setTimeout(function(){C(!1),c.current.scrollTop=c.current.scrollHeight},200))},[i]),(0,e.jsxs)(e.Fragment,{children:[b.length?b.map(function(j,L){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(j.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:j.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",j.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(L),children:[(0,e.jsx)("div",{className:"".concat(j.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:j.name?j.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(j.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:j.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(L),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We(L,v),children:j.content})})}),j.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:r,index:L,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(tt,{id:M,index:L,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},L)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Et,{messageApi:r,setCurrentMessageContent:_,sendValue:d,agentList:N,scrollDomRef:c,upButtonDom:p,setIsStop:h,setisEnd:C,setSendValue:I})]})}),Tt=(0,a.memo)(function(u){var r=u.messageApi,s=u.scrollDomRef,d=u.instruction,N=u.setIsStop,c=u.upButtonDom,p=u.setInstruction,h=u.agentList,I=(0,ae.useIntl)(),v=(0,ae.useParams)(),y=v.id,x=(0,a.useState)([]),b=f()(x,2),_=b[0],k=b[1],t=(0,a.useRef)(!1),i=(0,a.useState)(""),C=f()(i,2),V=C[0],M=C[1],j=(0,a.useRef)(null),L=(0,a.useRef)(null),z=(0,a.useRef)(!0),X=(0,a.useRef)(2),U=(0,a.useRef)(1),T=(0,a.useRef)(0),J=function(){var D=ne()(A()().mark(function $(E){var ie,G,le=arguments;return A()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(ie=le.length>1&&le[1]!==void 0?le[1]:function(){},!y){F.next=6;break}return F.next=4,(0,de.KH)(y,{page:U.current,page_size:20});case 4:G=F.sent,G.code==0&&(X.current=G.data.total_pages,k(function(H){return E?ce()(G.data.list):[].concat(ce()(G.data.list),ce()(H))}),E?setTimeout(function(){s.current.scrollTop=s.current.scrollHeight,c.current.style.display="none"}):T.current=G.data.list.length);case 6:case"end":return F.stop()}},$)}));return function(E){return D.apply(this,arguments)}}(),se=function($){var E=$.target.scrollHeight-$.target.scrollTop-$.target.clientHeight;if(t.current!==Math.ceil(E)>50&&(t.current=Math.ceil(E)>50,c.current.style.display=t.current?"flex":"none"),$.target.scrollTop==0&&z.current){z.current=!1;var ie=j.current.firstChild;U.current=U.current+1,L.current.style.display="flex",X.current,X.current>=U.current?J(!1):L.current.style.display="none"}},Y=function($,E){E==="0"&&(E=Number(E));var ie=["".concat($),E===0||E?E:null];M(JSON.stringify(ie))},W=q(function(D){return D.disableInput}),ee=q(function(D){return D.clearMemory});return(0,a.useEffect)(function(){ee&&ee.length&&Y(ee[0],ee[1])},[ee]),(0,a.useEffect)(function(){d&&d.length&&(Y(d[0],d[1]?d[1]:""),p([]))},[d]),(0,a.useEffect)(function(){T.current&&j.current.children[T.current]&&(s.current.scrollTop=j.current.children[T.current].offsetTop,z.current=!0)},[_]),(0,a.useEffect)(function(){U.current=1,J(!0)},[]),(0,e.jsxs)("div",{className:"flex-1 box-border relative overflow-y-auto chatroom overflow-x-hidden",ref:s,onScroll:se,children:[(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:L,children:(0,e.jsx)(he.Z,{})}),(0,e.jsxs)("div",{className:"max-w-[920px] mx-auto",style:{minHeight:"calc(100% - 50px)"},ref:j,children:[_.map(function(D,$){return(0,e.jsxs)("div",{id:"c".concat(D.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(D.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:D.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",D.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat($),children:[(0,e.jsx)("div",{className:"".concat(D.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:D.name?D.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(D.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:D.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat($),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We($,I),children:D.content})})}),D.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:r,idName:"content",cidName:"chilContent",index:$}),(0,e.jsx)(tt,{id:y,index:$,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},$)}),(0,e.jsx)(Ot,{messageApi:r,setUserMessage:k,sendValue:V,agentList:h,scrollDomRef:s,upButtonDom:c,setIsStop:N,setSendValue:M})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!W&&_.length?(0,e.jsx)(Pt,{roomid:y}):(0,e.jsx)(e.Fragment,{})})]})}),$t=(0,a.memo)(function(u){var r=u.agentList,s=(0,a.useRef)(null),d=(0,a.useRef)(null),N=(0,a.useState)(!1),c=f()(N,2),p=c[0],h=c[1],I=(0,a.useState)([]),v=f()(I,2),y=v[0],x=v[1],b=Ce.ZP.useMessage(),_=f()(b,2),k=_[0],t=_[1];return(0,e.jsxs)(e.Fragment,{children:[t,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px]   overflow-auto",style:{height:"calc(100% )"},children:(0,e.jsxs)("div",{className:"flex flex-col w-full",children:[(0,e.jsx)(Tt,{instruction:y,setInstruction:x,messageApi:k,scrollDomRef:s,setIsStop:h,upButtonDom:d,agentList:r}),(0,e.jsx)(Dt,{setInstruction:x,messageApi:k,isStop:p,upButtonDom:d,scrollDomRef:s})]})})]})}),Lt=m(42881),Zt=function(r){var s=r.children,d=r.className,N=d===void 0?"":d,c=r.dragDirection,p=c===void 0?"left":c,h=r.minWidth,I=h===void 0?415:h,v=r.maxWidth,y=v===void 0?820:v,x=r.minHeight,b=x===void 0?200:x,_=r.maxHeight,k=_===void 0?800:_,t=r.defaultWidth,i=t===void 0?415:t,C=r.defaultHeight,V=C===void 0?300:C,M=(0,a.useState)(i),j=f()(M,2),L=j[0],z=j[1],X=(0,a.useState)(V),U=f()(X,2),T=U[0],J=U[1],se=(0,a.useCallback)(function(D,$){z(D),$&&J($)},[z,J]),Y=(0,Lt.W)({direction:["left","right"].includes(p)?"horizontal":"vertical",triggerDirection:p,minWidth:I,maxWidth:y,minHeight:b,maxHeight:k,onResize:se}),W=Y.triggerRef,ee=Y.containerRef;return(0,e.jsxs)("div",{ref:ee,style:{width:["left","right"].includes(p)?"".concat(L,"px"):void 0,height:["top","bottom"].includes(p)?"".concat(T,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(N),children:[p==="left"&&(0,e.jsx)("div",{ref:W,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),p==="right"&&(0,e.jsx)("div",{ref:W,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),p==="top"&&(0,e.jsx)("div",{ref:W,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),p==="bottom"&&(0,e.jsx)("div",{ref:W,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),s]})},Ht=(0,a.memo)(Zt),Bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},zt=Bt,Vt=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:zt}))},Ut=a.forwardRef(Vt),Wt=Ut,Gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Kt=Gt,Jt=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:Kt}))},Yt=a.forwardRef(Jt),Qt=Yt,Xt=m(83159),qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},ea=qt,ta=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:ea}))},aa=a.forwardRef(ta),ra=aa,Oe=m(86),at=m(34994),rt=m(2216),na=m(85877),sa=m(29432),ia=m(39944),la=m(11551),Ge=m(55927),ca=function(r){var s,d,N,c=r.selectApp,p=r.runid,h=r.setBoxLoading,I=r.setinputShow,v=r.appId,y=r.id,x=r.setisRun,b=(0,ae.useIntl)(),_=(0,a.useRef)(""),k=(0,a.useRef)(""),t=(0,a.useRef)(null),i=(0,a.useState)(""),C=f()(i,2),V=C[0],M=C[1],j=(0,a.useState)(null),L=f()(j,2),z=L[0],X=L[1],U=(0,a.useState)([]),T=f()(U,2),J=T[0],se=T[1],Y=(0,a.useState)(""),W=f()(Y,2),ee=W[0],D=W[1],$=(0,Ge.Z)(function(K){return K.flowMessage}),E=function(F){k.current=ie(F);var H={user:{value:ie(F)}};D(new ia.z(H))},ie=function K(F){return F.map(function(H){return H.type==="mention"?H.id:H.children?K(H.children):H.text}).join("")},G=function(){var K=ne()(A()().mark(function F(H){var w,S;return A()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return h(!0),w=Object.keys(H),w.forEach(function(n){t.current.properties[n]&&(t.current.properties[n].value=H[n])}),l.next=5,(0,la.LH)({agent_id:c.checkItem[0].agent_id,ability_id:0,input_dict:t.current,prompt:ee,data_source_run_id:_.current});case 5:S=l.sent,S.code==0&&(M(S.data.outputs_md),h(!1),x(!1));case 7:case"end":return l.stop()}},F)}));return function(H){return K.apply(this,arguments)}}(),le=function(){var K=ne()(A()().mark(function F(H,w){var S,Z;return A()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,de.xT)(H,w);case 2:S=n.sent,(S==null?void 0:S.code)==0&&(_.current=S==null||(Z=S.data)===null||Z===void 0?void 0:Z.app_run_id);case 4:case"end":return n.stop()}},F)}));return function(H,w){return K.apply(this,arguments)}}();return(0,a.useEffect)(function(){c&&c.checkItem.length&&(x(!0),le(y,{app_id:v,app_run_id:p,status:1,corrected_parameter:""}))},[c]),(0,a.useEffect)(function(){var K=$.filter(function(l){return l.data.app_run_id==p&&l.type.indexOf("generate_meeting_action_items")!==-1});if(K.length!=0){var F,H=(F=K[K.length-1])===null||F===void 0||(F=F.data)===null||F===void 0||(F=F.exec_data)===null||F===void 0||(F=F.outputs)===null||F===void 0?void 0:F.value;if(H){var w=JSON.parse(H);t.current=w;var S=Object.keys(w.properties);if(S.length){X(w.properties);var Z=S.map(function(l){return{value:"<<".concat(sa.qX,".inputs.").concat(l,">>"),label:l}});se(Z)}I(!1),h(!1)}}},[$]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:c==null||(s=c.checkItem[0])===null||s===void 0?void 0:s.icon,title:c==null||(d=c.checkItem[0])===null||d===void 0?void 0:d.name,textDetails:c==null||(N=c.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"robot_icon",handleClick:function(){}})}),z!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!k.current},searchConfig:{submitText:b.formatMessage({id:"workflow.button.run"})}},onFinish:function(F){G(F)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(rt._,{data:z})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(na.Z,{onChange:function(F){E(F)},options:J,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),V?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:V})})}):(0,e.jsx)(e.Fragment,{})]})},oa=(0,a.memo)(ca),ua=m(66309),nt=m(42237),da=m(93696),pa=function(r,s){return a.createElement(Ne.Z,(0,pe.Z)((0,pe.Z)({},r),{},{ref:s,icon:da.Z}))},xa=a.forwardRef(pa),fa=xa,ma=m(4981),Ke=m(29608),va=(0,a.memo)(function(u){var r=u.progressObj,s=function(){return parseFloat(r.elapsed_time).toFixed(6)},d=function(c){var p=new Date(c),h=p.getFullYear(),I=(p.getMonth()+1).toString().padStart(2,"0"),v=p.getDate().toString().padStart(2,"0"),y=p.getHours().toString().padStart(2,"0"),x=p.getMinutes().toString().padStart(2,"0"),b=p.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(h,".").concat(I,".").concat(v," ").concat(y,":").concat(x,":").concat(b)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:r.created_time&&d(r.created_time)}),(0,e.jsx)("div",{className:"truncate",children:r.apps_name||r.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(r.status==1?"bg-blue-600":r.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[s(),"S"]})]})]})})}),ha=function(r){var s,d,N,c=r.selectApp,p=r.runid,h=r.setBoxLoading,I=r.setinputShow,v=r.appId,y=r.id,x=r.setisRun,b=(0,ae.useIntl)(),_=(0,a.useRef)(""),k=(0,a.useRef)(null),t=(0,a.useState)(null),i=f()(t,2),C=i[0],V=i[1],M=(0,a.useState)(!1),j=f()(M,2),L=j[0],z=j[1],X=(0,a.useState)(null),U=f()(X,2),T=U[0],J=U[1],se=(0,a.useState)(null),Y=f()(se,2),W=Y[0],ee=Y[1],D=(0,a.useState)(null),$=f()(D,2),E=$[0],ie=$[1],G=(0,Ke.Z)(function(n){return n.setDealtWithData}),le=(0,Ke.Z)(function(n){return n.setRunPanelLogRecord}),K=function(){var n=ne()(A()().mark(function o(R){var g,P,B,O,te;return A()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return h(!0),g=Object.keys(R),P={},g.forEach(function(oe){k.current.properties[oe]&&(k.current.properties[oe].value=R[oe]),W&&W.forEach(function(me){me.node_id==oe&&(P[oe]=R[oe])})}),B={inputs:k.current,node_confirm_users:P,run_name:"chatroom-".concat(y,"-run-").concat(_.current,"-driven"),run_type:1,data_source_run_id:_.current},re.next=7,(0,nt.UE)(v,B);case 7:O=re.sent,O.code==0&&(_.current=O==null||(te=O.data)===null||te===void 0?void 0:te.app_run_id,z(!0),x(!1));case 9:case"end":return re.stop()}},o)}));return function(R){return n.apply(this,arguments)}}(),F=function(){var n=ne()(A()().mark(function o(){var R,g;return A()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:R=l==null?void 0:l.filter(function(O){return O.type=="workflow_run_progress"&&O.data.app_run_id==_.current}).map(function(O){var te=O.data;return te}),R&&R.length&&(g=R[R.length-1],V(g),h(!1));case 2:case"end":return B.stop()}},o)}));return function(){return n.apply(this,arguments)}}(),H=function(){var n=ne()(A()().mark(function o(){var R,g,P,B,O;return A()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:g=l==null?void 0:l.filter(function(re){return re.type=="workflow_need_human_confirm"&&re.data.app_run_id==_.current}),P=(R=g.map(function(re){var oe=re.data,me=re.need_human_confirm;return{data:oe,need_human_confirm:me}}))===null||R===void 0?void 0:R.filter(function(re){return re.data.type!==1}),P&&P.length&&(O=P[P.length-1].data,O.exec_id=O==null||(B=O.node_exec_data)===null||B===void 0?void 0:B.node_exec_id,ie(P[P.length-1]),h(!1));case 3:case"end":return xe.stop()}},o)}));return function(){return n.apply(this,arguments)}}(),w=function(o){return o.completed_progress?parseInt(o.completed_progress.slice(0,-1)):!1},S=function(){var n=ne()(A()().mark(function o(R,g){var P,B;return A()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,(0,de.xT)(R,g);case 2:P=te.sent,(P==null?void 0:P.code)==0&&(_.current=P==null||(B=P.data)===null||B===void 0?void 0:B.app_run_id);case 4:case"end":return te.stop()}},o)}));return function(R,g){return n.apply(this,arguments)}}(),Z=function(){var n=ne()(A()().mark(function o(){var R,g;return A()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return console.log(v),B.next=3,(0,nt.zO)(v);case 3:R=B.sent,R.code==0&&ee(R==null||(g=R.data)===null||g===void 0?void 0:g.need_confirm_nodes),S(y,{app_id:v,app_run_id:p,status:1,corrected_parameter:""});case 6:case"end":return B.stop()}},o)}));return function(){return n.apply(this,arguments)}}();(0,a.useEffect)(function(){c&&c.checkItem.length&&(x(!0),Z())},[c]);var l=(0,Ge.Z)(function(n){return n.flowMessage});return(0,a.useEffect)(function(){F(),H();var n=l.filter(function(B){return B.data.app_run_id==p&&B.type.indexOf("generate_meeting_action_items")!==-1});if(n.length!=0){var o,R=(o=n[n.length-1])===null||o===void 0||(o=o.data)===null||o===void 0||(o=o.exec_data)===null||o===void 0||(o=o.outputs)===null||o===void 0?void 0:o.value;if(R){var g=JSON.parse(R);k.current=g;var P=Object.keys(g.properties);P.length&&(console.log(g.properties),J(g.properties)),I(!1),h(!1)}}},[l]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:c==null||(s=c.checkItem[0])===null||s===void 0?void 0:s.icon,title:c==null||(d=c.checkItem[0])===null||d===void 0?void 0:d.name,textDetails:c==null||(N=c.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"workflow_icon",handleClick:function(){}})}),!L&&T!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:b.formatMessage({id:"workflow.button.run"})}},onFinish:K,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(rt._,{data:T})}),(0,e.jsx)(ma.e,{data:W})]}):(0,e.jsx)(e.Fragment,{children:T!=null?Object.values(T).map(function(n){return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[b.formatMessage({id:"app.summaryhistory.input"}),":"]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:n.display_name||n.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:n.value})]})]})}):(0,e.jsx)(e.Fragment,{})}),E&&E.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){G(E.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(fa,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:b.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),C?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Oe.Z,{status:C.status,icon:C.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:C.run_name}),C.need_human_confirm==1?(0,e.jsx)(ua.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:b.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(va,{progressObj:C}),handleClick:function(){le(C)},progress:w(C)})}):(0,e.jsx)(e.Fragment,{})]})},ga=(0,a.memo)(ha),ja=function(r){var s,d,N,c=(0,ae.useIntl)(),p=r.runid,h=r.id,I=r.setBoxLoading,v=r.scrollDom,y=r.setinputShow,x=(0,a.useRef)("agent"),b=(0,a.useRef)(""),_=(0,a.useState)(!1),k=f()(_,2),t=k[0],i=k[1],C=(0,a.useState)({type:"agent",checkItem:[],show:!1}),V=f()(C,2),M=V[0],j=V[1],L=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){j(function(T){return Q()(Q()({},T),{},{type:"agent",show:!0})})},children:c.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){j(function(T){return Q()(Q()({},T),{},{type:"workflow",show:!0})})},children:c.formatMessage({id:"app.summary.SelectWorkflow"})})}],z=function(){j(function(T){return Q()(Q()({},T),{},{show:!1})})},X=function(T){I(!0),j(function(J){return Q()(Q()({},J),{},{checkItem:T.checkItem})}),x.current=M.type,b.current=T.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:M!=null&&(s=M.checkItem)!==null&&s!==void 0&&s.length?v==null||(d=v.current)===null||d===void 0?void 0:d.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:c.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:t?(0,e.jsx)(Xt.Z,{menu:{items:L},children:(0,e.jsx)(ra,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:M!=null&&(N=M.checkItem)!==null&&N!==void 0&&N.length?(0,e.jsx)(e.Fragment,{children:x.current=="agent"?(0,e.jsx)(oa,{id:h,appId:b.current,selectApp:M,runid:p,setBoxLoading:I,scrollDom:v,setinputShow:y,setisRun:i}):(0,e.jsx)(ga,{id:h,appId:b.current,selectApp:M,runid:p,setBoxLoading:I,scrollDom:v,setinputShow:y,setisRun:i})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){j(function(T){return Q()(Q()({},T),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),c.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){j(function(T){return Q()(Q()({},T),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),c.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(ke.Z,{show:M.show,nodetype:M.type,popupClose:z,popupSave:X,checkList:x.current==M.type?M.checkItem:[],zIndex:99,radio:!0})]})},ya=(0,a.memo)(ja),Sa=function(r){var s,d,N=r.setShow,c=r.inputShow,p=r.setBoxLoading,h=r.setAppRunId,I=r.scrollDom,v=(0,ae.useIntl)(),y=(0,a.useState)(!1),x=f()(y,2),b=x[0],_=x[1],k=(0,a.useState)(""),t=f()(k,2),i=t[0],C=t[1],V=(0,a.useState)(""),M=f()(V,2),j=M[0],L=M[1],z=(0,a.useRef)(""),X=(0,a.useRef)(""),U=(0,a.useRef)(!1),T=(0,a.useState)(!1),J=f()(T,2),se=J[0],Y=J[1],W=(0,a.useState)(null),ee=f()(W,2),D=ee[0],$=ee[1],E=q(function(w){return w.setSummaryClick}),ie=function(){var w=ne()(A()().mark(function S(Z){var l,n,o,R,g=arguments;return A()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return l=g.length>1&&g[1]!==void 0?g[1]:{app_run_id:"",corrected_parameter:""},B.next=3,(0,de.Rp)(Z,l);case 3:n=B.sent,(n==null?void 0:n.code)==0&&(h(n==null||(o=n.data)===null||o===void 0?void 0:o.app_run_id),X.current=n==null||(R=n.data)===null||R===void 0?void 0:R.app_run_id,l.app_run_id&&(U.current=!0));case 5:case"end":return B.stop()}},S)}));return function(Z){return w.apply(this,arguments)}}(),G=function(){var w=ne()(A()().mark(function S(Z,l){var n,o,R,g,P;return A()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,de.xM)(Z,{message:l});case 2:n=O.sent,(n==null?void 0:n.code)==0&&(X.current=n==null||(o=n.data)===null||o===void 0?void 0:o.app_run_id,h(n==null||(R=n.data)===null||R===void 0?void 0:R.app_run_id),n!=null&&(g=n.data)!==null&&g!==void 0&&(g=g.outputs)!==null&&g!==void 0&&g.value&&(C(n==null||(P=n.data)===null||P===void 0||(P=P.outputs)===null||P===void 0?void 0:P.value),N(!0),p(!1),E(!0)));case 4:case"end":return O.stop()}},S)}));return function(Z,l){return w.apply(this,arguments)}}(),le=function(){var w=ne()(A()().mark(function S(){var Z;return A()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,de.Gh)({chatroom_id:z.current,app_run_id:X.current});case 2:Z=n.sent,Z&&Z!==null&&Z!==void 0&&Z.data&&$(Z.data);case 4:case"end":return n.stop()}},S)}));return function(){return w.apply(this,arguments)}}(),K=function(S){var Z=new Date(S),l=Z.getMonth()+1,n=Z.getDate(),o=Z.getHours(),R=Z.getMinutes(),g=Z.getSeconds();return Z.getFullYear()+"-"+(l<10?"0"+l:l)+"-"+(n<10?"0"+n:n)+" "+(o<10?"0"+o:o)+":"+(R<10?"0"+R:R)+":"+(g<10?"0"+g:g)},F=(0,Ge.Z)(function(w){return w.flowMessage});(0,a.useEffect)(function(){var w=F.filter(function(l){return l.data.app_run_id==X.current&&l.type.indexOf("generate_meeting_summary")!==-1});if(w.length!=0){var S,Z=(S=w[w.length-1])===null||S===void 0||(S=S.data)===null||S===void 0||(S=S.exec_data)===null||S===void 0||(S=S.outputs)===null||S===void 0?void 0:S.value;Z&&(U.current&&le(),C(Z),Y(!1),N(!0),E(!0),p(!1))}},[F]);var H=q(function(w){return w.summaryParams});return(0,a.useEffect)(function(){H&&H.id&&(z.current=H.id,i&&C(""),_(!0),H.message?(p(!0),G(H.id,H.message)):ie(H.id))},[H]),(0,e.jsx)(e.Fragment,{children:b?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:v.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:i?(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:D?D==null||(s=D.source_run)===null||s===void 0?void 0:s.summary:i})}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(he.Z,{size:"large"})})}),D&&(D==null||(d=D.source_corrections)===null||d===void 0?void 0:d.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[v.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),D.source_corrections.map(function(w){return(0,e.jsx)("div",{className:"last-of-type:bg-blue-100 rounded-[4px] bg-[#F7F7F7] mb-[16px] ",children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[v.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",w.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[v.formatMessage({id:"app.summaryhistory.time"}),": ",K(w.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:w==null?void 0:w.corrected_summary})]})},w.created_time)})]}):(0,e.jsx)(e.Fragment,{}),c?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Xe.Z.TextArea,{onChange:function(S){L(S.target.value)},value:j,disabled:!i||se,rows:4,placeholder:v.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(fe.ZP,{type:"primary",disabled:!i||!j,loading:se,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){ie(z.current,{app_run_id:String(X.current),corrected_parameter:j}),Y(!0),L(""),N("")},children:v.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},Na=(0,a.memo)(Sa),wa=m(87740),_a=(0,a.memo)(function(u){var r=u.progressObj;console.log(r);var s=function(){return parseFloat(r.elapsed_time).toFixed(6)},d=function(c){var p=new Date(c),h=p.getFullYear(),I=(p.getMonth()+1).toString().padStart(2,"0"),v=p.getDate().toString().padStart(2,"0"),y=p.getHours().toString().padStart(2,"0"),x=p.getMinutes().toString().padStart(2,"0"),b=p.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(h,".").concat(I,".").concat(v," ").concat(y,":").concat(x,":").concat(b)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:r.created_time&&d(r.created_time)}),(0,e.jsx)("div",{className:"truncate",children:r.apps_name||r.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(r.status==1?"bg-blue-600":r.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[s(),"S"]})]})]})})}),st=(0,a.memo)(function(u){var r=u.id,s=u.message,d=(0,ae.useIntl)(),N=q(function(x){return x.setSummaryClick}),c=(0,a.useState)(!0),p=f()(c,2),h=p[0],I=p[1],v=q(function(x){return x.summaryClick}),y=q(function(x){return x.setSummaryParams});return(0,a.useEffect)(function(){I(v)},[v]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(b){h&&(y({id:r,message:s}),N(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:d.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(wa.Z,{className:"text-[14px]"})]})})}),ba=function(r){var s=r.list,d=r.scrollDom,N=r.historyHeight,c=r.id,p=(0,ae.useIntl)(),h=(0,a.useState)([]),I=f()(h,2),v=I[0],y=I[1],x=(0,a.useRef)("100%"),b=(0,Ke.Z)(function(t){return t.setRunPanelLogRecord}),_=function(i){var C=new Date(i),V=C.getMonth()+1,M=C.getDate(),j=C.getHours(),L=C.getMinutes(),z=C.getSeconds();return C.getFullYear()+"-"+(V<10?"0"+V:V)+"-"+(M<10?"0"+M:M)+" "+(j<10?"0"+j:j)+":"+(L<10?"0"+L:L)+":"+(z<10?"0"+z:z)},k=function(i){var C=Object.keys(i),V=[];return C.forEach(function(M){V.push(i[M])}),V};return(0,a.useEffect)(function(){if(d){var t;x.current=d==null||(t=d.current)===null||t===void 0?void 0:t.offsetHeight}},[d]),(0,a.useEffect)(function(){N&&(x.current="auto")},[N]),(0,a.useEffect)(function(){y(ce()(s))},[s]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"px-4",style:{minHeight:x.current},children:v&&v.length?v.map(function(t){var i,C,V,M,j,L,z,X,U,T,J,se,Y,W,ee,D,$,E,ie;return t!=null&&t.source_run&&t!==null&&t!==void 0&&t.source_run.summary?(0,e.jsx)("div",{className:"pt-[16px] border-b-[1px] border-color-[#eee] ",children:(0,e.jsxs)("div",{className:"pb-[60px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pb-[8px] flex items-center",children:(0,e.jsx)("span",{className:"flex-1",children:p.formatMessage({id:"app.summary.title"})})}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:_(t==null||(i=t.source_run)===null||i===void 0?void 0:i.created_time)}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] ".concat(t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?"bg-[#F7F7F7]":"bg-blue-100 rounded-[4px]"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(C=t.source_run)===null||C===void 0?void 0:C.summary})}),(0,e.jsx)(st,{id:c,message:t==null||(V=t.source_run)===null||V===void 0?void 0:V.summary})]}),t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),t==null?void 0:t.source_corrections.map(function(G){return(0,e.jsxs)("div",{className:"mb-[16px] last-of-type:mb-0",children:[(0,e.jsx)("div",{className:"last-of-type:bg-blue-100 rounded-[4px] bg-[#F7F7F7]",children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[p.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",G.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[p.formatMessage({id:"app.summaryhistory.time"}),":"," ",_(G.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:G==null?void 0:G.corrected_summary})]})}),(0,e.jsx)(st,{id:c,message:G==null?void 0:G.corrected_summary})]},G.created_time)})]}):(0,e.jsx)(e.Fragment,{}),t!=null&&t.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:t!=null&&(M=t.target_run)!==null&&M!==void 0&&M.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:t==null||(j=t.target_run)===null||j===void 0||(j=j.app)===null||j===void 0?void 0:j.name})]})}),(0,e.jsx)("div",{children:t!=null&&(L=t.target_run)!==null&&L!==void 0&&(L=L.inputs)!==null&&L!==void 0&&L.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[p.formatMessage({id:"app.summaryhistory.input"}),":"]}),k(t==null||(z=t.target_run)===null||z===void 0||(z=z.inputs)===null||z===void 0?void 0:z.properties).map(function(G){return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:G.display_name||G.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:G.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:t!=null&&(X=t.target_run)!==null&&X!==void 0&&X.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[p.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:t==null||(U=t.target_run)===null||U===void 0?void 0:U.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(t==null||(T=t.target_run)===null||T===void 0?void 0:T.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(J=t.target_run)===null||J===void 0||(J=J.outputs)===null||J===void 0?void 0:J.value})}):(0,e.jsx)(Oe.Z,{status:t==null||(se=t.target_run)===null||se===void 0?void 0:se.status,icon:t==null||(Y=t.target_run)===null||Y===void 0?void 0:Y.icon,title:t==null||(W=t.target_run)===null||W===void 0?void 0:W.name,textDetails:(0,e.jsx)(_a,{progressObj:{created_time:t==null||(ee=t.target_run)===null||ee===void 0?void 0:ee.created_time,elapsed_time:t==null||(D=t.target_run)===null||D===void 0?void 0:D.elapsed_time,app_name:t==null||($=t.target_run)===null||$===void 0?void 0:$.app.name,status:t==null||(E=t.target_run)===null||E===void 0?void 0:E.status}}),handleClick:function(){var le,K,F,H,w,S,Z,l,n,o;b({app_id:t==null||(le=t.target_run)===null||le===void 0||(le=le.app)===null||le===void 0?void 0:le.id,app_name:t==null||(K=t.target_run)===null||K===void 0||(K=K.app)===null||K===void 0?void 0:K.name,icon:t==null||(F=t.target_run)===null||F===void 0?void 0:F.icon,workflow_id:t==null||(H=t.target_run)===null||H===void 0?void 0:H.workflow_id,type:2,app_run_id:t==null||(w=t.target_run)===null||w===void 0?void 0:w.id,run_name:t==null||(S=t.target_run)===null||S===void 0?void 0:S.name,status:t==null||(Z=t.target_run)===null||Z===void 0?void 0:Z.status,created_time:t==null||(l=t.target_run)===null||l===void 0?void 0:l.created_time,elapsed_time:t==null||(n=t.target_run)===null||n===void 0?void 0:n.elapsed_time,completed_progress:"".concat(t==null||(o=t.target_run)===null||o===void 0?void 0:o.percentage,"%")})},progress:t==null||(ie=t.target_run)===null||ie===void 0?void 0:ie.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]})},t.source_run.id):(0,e.jsx)(e.Fragment,{})}):(0,e.jsx)(e.Fragment,{})})})},Ca=(0,a.memo)(ba),Ra=function(r){var s,d=r.id,N=(0,a.useState)(""),c=f()(N,2),p=c[0],h=c[1],I=(0,a.useState)(!1),v=f()(I,2),y=v[0],x=v[1],b=(0,a.useState)([]),_=f()(b,2),k=_[0],t=_[1],i=(0,a.useState)(!1),C=f()(i,2),V=C[0],M=C[1],j=(0,a.useState)(!1),L=f()(j,2),z=L[0],X=L[1],U=(0,a.useState)(""),T=f()(U,2),J=T[0],se=T[1],Y=(0,a.useState)(!1),W=f()(Y,2),ee=W[0],D=W[1],$=(0,a.useState)(!1),E=f()($,2),ie=E[0],G=E[1],le=(0,a.useState)(!0),K=f()(le,2),F=K[0],H=K[1],w=(0,a.useRef)(null),S=(0,a.useRef)(1),Z=(0,a.useRef)(!1),l=(0,a.useRef)(!0),n=(0,a.useRef)(0),o=(0,a.useState)(!1),R=f()(o,2),g=R[0],P=R[1],B=q(function(re){return re.summaryParams}),O=q(function(re){return re.setSummaryParams}),te=function(){var re=ne()(A()().mark(function oe(){var me,Te,ue,Je,_e,Ye,be=arguments;return A()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(me=be.length>0&&be[0]!==void 0?be[0]:!0,Te=be.length>1&&be[1]!==void 0?be[1]:!0,!(n.current!=0&&n.current<S.current)){we.next=5;break}return P(!1),we.abrupt("return");case 5:return we.next=8,(0,de.sh)({chatroom_id:d,page:S.current,page_size:10});case 8:ue=we.sent,ue.code==0&&(ue!=null&&(Je=ue.data)!==null&&Je!==void 0&&Je.list&&ue!==null&&ue!==void 0&&(_e=ue.data)!==null&&_e!==void 0&&(_e=_e.list)!==null&&_e!==void 0&&_e.length&&(n.current=ue==null||(Ye=ue.data)===null||Ye===void 0?void 0:Ye.total_pages,t(function(Me){return Te?ce()(ue.data.list.reverse()):[].concat(ce()(ue.data.list.reverse()),ce()(Me))}),x(!0),P(!0),setTimeout(function(){l.current=!0},300)),Te&&setTimeout(function(){var Me;w==null||(Me=w.current)===null||Me===void 0||Me.scrollTo({top:0})},200),me||(h(B.id),O({})));case 10:case"end":return we.stop()}},oe)}));return function(){return re.apply(this,arguments)}}(),xe=function(){var re=ne()(A()().mark(function oe(me){return A()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:me.target.scrollHeight+(me.target.scrollTop-me.target.clientHeight)<10&&l.current&&(l.current=!1,P(!0),S.current=S.current+=1,te(!0,!1));case 1:case"end":return ue.stop()}},oe)}));return function(me){return re.apply(this,arguments)}}();return(0,a.useEffect)(function(){S.current=1,te()},[d]),(0,a.useEffect)(function(){B&&B.id&&(x(!0),F||H(!0),V&&M(!1),ee&&D(!1),S.current=1,X(!0),te(!1),Z.current=!0)},[B]),(0,e.jsx)(e.Fragment,{children:y?(0,e.jsxs)(Ht,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(ee?"translate-x-full flex-[0]":""),children:[ie?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(he.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){D(function(oe){return!oe})},className:`
                                        `.concat(ee?"right-[100%] top-[4px]":"right-[6px] top-[60px]",`
                                        fixed w-[40px] h-[40px]  flex justify-center items-center cursor-pointer z-[99]
                                    `),children:ee?(0,e.jsx)(Qt,{className:"text-[20px]"}):(0,e.jsx)(Wt,{className:"text-[20px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:xe,ref:w,children:[(0,e.jsxs)("div",{children:[k.length?(0,e.jsx)(Ca,{id:d,scrollDom:w,list:k,historyHeight:Z.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:z?w==null||(s=w.current)===null||s===void 0?void 0:s.offsetHeight:""},children:[(0,e.jsx)(Na,{setShow:M,inputShow:F,setBoxLoading:G,setAppRunId:se,scrollDom:w}),V?(0,e.jsx)(ya,{id:p,runid:J,setBoxLoading:G,scrollDom:w,setinputShow:H}):(0,e.jsx)(e.Fragment,{})]})]}),g?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(he.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},ka=(0,a.memo)(Ra),Ma=function(r){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})},Fa=(0,a.memo)(function(){var u=(0,ae.useParams)(),r=u.id,s=(0,a.useRef)([]),d=(0,a.useRef)(null),N=(0,a.useState)(!1),c=f()(N,2),p=c[0],h=c[1],I=function(){var v=ne()(A()().mark(function y(){var x;return A()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!r){_.next=5;break}return _.next=3,(0,de.cH)({id:r});case 3:x=_.sent,x.code==0?(h(!0),d.current=x.data,s.current=x.data.agent_list):ae.history.replace("/meeting");case 5:case"end":return _.stop()}},y)}));return function(){return v.apply(this,arguments)}}();return(0,a.useEffect)(function(){I()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(ct,{roomDetail:d.current,setAgent:s}),(0,e.jsx)("div",{className:"flex-1",children:p?(0,e.jsx)($t,{agentList:s}):(0,e.jsx)(Ma,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ka,{id:r})})]})})}),Da=Fa}}]);
