"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{82826:function(Xe,ke,p){p.d(ke,{Z:function(){return xe}});var Me=p(1413),C=p(67294),Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},X=Ie,Ae=p(91146),y=function(Q,De){return C.createElement(Ae.Z,(0,Me.Z)((0,Me.Z)({},Q),{},{ref:De,icon:X}))},le=C.forwardRef(y),xe=le},51636:function(Xe,ke,p){p.r(ke),p.d(ke,{default:function(){return Ca}});var Me=p(15009),C=p.n(Me),Ie=p(99289),X=p.n(Ie),Ae=p(5574),y=p.n(Ae),le=p(43722),xe=p(32983),t=p(67294),Q=p(35312),De=p(19632),de=p.n(De),Ye=p(97857),U=p.n(Ye),ve=p(32332),qe=p(82114),et=p(82826),tt=p(63783),at=p(3471),Be=p(45360),nt=p(85576),Ce=p(28036),rt=p(83062),$e=p(72269),Se=p(74330),Ze=p(96486),He=p(44010),Y=p(39e3),e=p(85893),st=function(a){var s=(0,Q.useIntl)(),v=a.roomDetail,N=a.setAgent,o=Be.ZP.useMessage(),g=y()(o,2),m=g[0],A=g[1],h=(0,Q.useParams)(),x=h.id,u=(0,Y.Z)(function(r){return r.disableInput}),b=(0,Y.Z)(function(r){return r.truncatable}),j=(0,Y.Z)(function(r){return r.setClearMemory}),R=(0,t.useState)([]),D=y()(R,2),l=D[0],P=D[1],W=(0,t.useState)(U()({},v)),E=y()(W,2),F=E[0],V=E[1],ee=(0,t.useState)([]),te=y()(ee,2),G=te[0],Z=te[1],ae=(0,t.useRef)(!1),oe=(0,t.useRef)(!1),q=(0,t.useState)(!1),z=y()(q,2),T=z[0],H=z[1],$=function(){var n=nt.Z.confirm;n({title:s.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(qe.Z,{}),content:s.formatMessage({id:"app.chatroom.clear.tips"}),okText:s.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:s.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){j(["TRUNCATE","0"])}})},w=function(){var r=X()(C()().mark(function n(){var i;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!x){f.next=5;break}return f.next=3,(0,le.cH)({id:x});case 3:if(i=f.sent,i.code==0)try{V(function(){return U()(U()({},i.data.chat_info),{},{max_round:i.data.max_round,smart_selection:i.data.smart_selection})}),P(i.data.agent_list),ae.current=!0}catch(S){}case 5:case"end":return f.stop()}},n)}));return function(){return r.apply(this,arguments)}}(),re=function(){var r=X()(C()().mark(function n(){var i;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,le.j2)({id:x});case 2:i=f.sent,i.code==0&&(Z(i.data.list),oe.current=!0);case 4:case"end":return f.stop()}},n)}));return function(){return r.apply(this,arguments)}}(),ue=function(){var r=X()(C()().mark(function n(i){var c,f,S;return C()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!x){M.next=11;break}if(c=i.active==1?0:1,c!=0){M.next=7;break}if(f=l.filter(function(B){return B.active==1}),f.length-1!=0){M.next=7;break}return m.open({type:"error",content:s.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),M.abrupt("return",!1);case 7:return M.next=9,(0,le.sT)({active:c},x,i.agent_id);case 9:S=M.sent,S.code==0&&P(function(B){return B.map(function(se){return U()(U()({},se),{},{active:se.agent_id==i.agent_id?c:se.active})})});case 11:case"end":return M.stop()}},n)}));return function(i){return r.apply(this,arguments)}}(),fe=function(n){return n.length>6?n.length=6:n.lenth,n},_=function(n){n.type=="my_agent"?Q.history.push("/Agents?app_id=".concat(n.app_id,"&type=false&from=chat_room")):Q.history.push("/ReadOnlyAgent?app_id=".concat(n.app_id,"&type=true&from=chat_room"))},O=function(n){Q.history.replace("/chat_room/".concat(n.chatroom_id)),window.location.reload()},K=function(){H(!0)},J=function(){H(!1)},L=function(){var r=X()(C()().mark(function n(i){var c,f,S;return C()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!(i.checkItem&&i.checkItem.length==0)){M.next=3;break}return m.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),M.abrupt("return");case 3:return c=de()(i.checkItem).map(function(B){var se=B.agent_id,ie=B.active,ne=ie===void 0?1:ie;return{agent_id:se,active:ne}}),f={description:F.description,name:F.name,max_round:F.max_round},M.next=7,(0,le.sI)(U()(U()({},f),{},{agent:c}),x);case 7:S=M.sent,S.code==0?(i.checkItem.map(function(B){B.active=B.active==null?1:B.active}),P(de()(i.checkItem)),N.current=de()(i.checkItem),m.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):m.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return M.stop()}},n)}));return function(i){return r.apply(this,arguments)}}(),I=function(){var r=X()(C()().mark(function n(){var i;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return i=F.smart_selection==1?0:1,f.next=3,(0,le.r5)({smart_selection:i},x);case 3:V(function(S){return U()(U()({},S),{},{smart_selection:i})});case 4:case"end":return f.stop()}},n)}));return function(){return r.apply(this,arguments)}}();return(0,t.useEffect)(function(){w(),re()},[]),(0,e.jsxs)(e.Fragment,{children:[A,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){Q.history.go(-1)},children:[(0,e.jsx)(Ce.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(et.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:s.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:F.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(rt.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:s.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(tt.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:s.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)($e.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:F.smart_selection==1,onChange:I,disabled:u})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:ae.current?(0,e.jsx)("div",{className:"flex flex-col",children:l&&l.length>0?l.map(function(r){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",r.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:r.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:r.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){_(r)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)($e.Z,{size:"small",disabled:u,defaultChecked:!0,className:"w-[28px]",checked:r.active==1,onChange:function(){ue(r)}})]})]},r.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Se.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:K,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:b&&!u?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Ze.throttle)(function(){b&&!u&&$()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:s.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:oe.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:G&&G.length>0?G.map(function(r){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){O(r)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:r.name}),r.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:r.agent_list&&r.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[fe(r.agent_list).map(function(n,i){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",n.icon),alt:"",className:"w-[18px]  h-[18px]"})})},i)}),r.agent_list.length>=6?(0,e.jsx)(at.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},r.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Se.Z,{})})})})]})]}),(0,e.jsx)(He.Z,{show:T,popupClose:J,popupSave:L,checkList:l,zIndex:99})]})]})},it=(0,t.memo)(st),ct=p(13769),lt=p.n(ct),ot=p(47635),pe=p(1413),ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},dt=ut,he=p(91146),pt=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:dt}))},ft=t.forwardRef(pt),mt=ft,xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},vt=xt,ht=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:vt}))},gt=t.forwardRef(ht),jt=gt,St=p(2068),yt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},wt=yt,Nt=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:wt}))},bt=t.forwardRef(Nt),Ct=bt,_e=p(26915),Rt=p(20640),ze=p.n(Rt),ye=p(22683),we=p(97807),kt=["node","className","children"],Mt=_e.Z.TextArea,Ft=(0,t.memo)(function(d){var a=d.setInstruction,s=d.messageApi,v=d.isStop,N=d.scrollDomRef,o=d.upButtonDom,g=(0,Q.useIntl)(),m=(0,Y.Z)(function(D){return D.disableInput}),A=(0,Y.Z)(function(D){return D.setDisableInput}),h=(0,t.useState)(""),x=y()(h,2),u=x[0],b=x[1],j=function(l){!l.shiftKey&&l.target.value==""&&(s.open({type:"warning",content:g.formatMessage({id:"app.chatroom.content.input"}),duration:10}),b(""),l.preventDefault()),!l.shiftKey&&l.keyCode==13&&l.target.value!=""&&(A(!0),b(""),a(["INPUT",l.target.value]),l.preventDefault())},R=(0,Ze.throttle)(function(){a(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:o,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(l){N.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(mt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(Mt,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:u,disabled:m,onChange:function(l){b(l.target.value)},onPressEnter:j,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(g.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),v?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:R,children:(0,e.jsx)(jt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(m||!u?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Ze.throttle)(function(){if(m||!u)return!1;u||s.open({type:"warning",content:g.formatMessage({id:"app.chatroom.content.input"}),duration:10}),A(!0),a(["INPUT",u]),b("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),It=function d(a){return typeof a=="string"?a:Array.isArray(a)?a.map(d).join(""):t.isValidElement(a)?d(a.props.children):""},At=function(a){return It(a)},Oe=function(a,s){return{code:function(N){var o=N.node,g=N.className,m=N.children,A=lt()(N,kt),h=/language-(\w+)/.exec(g||"");if(h!=null&&h.length){var x=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:h[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var u=X()(C()().mark(function b(j){var R;return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,R=j.currentTarget,l.next=4,ze()(At(m));case 4:R&&(R.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){R&&(R.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copycode"}))},200),l.next=11;break;case 8:l.prev=8,l.t0=l.catch(0),console.error("Failed to copy text: ",l.t0);case 11:case"end":return l.stop()}},b,null,[[0,8]])}));return function(b){return u.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:s.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(x).concat(a),className:"p-4",children:m})})]})}else return(0,e.jsx)("code",U()(U()({},A),{},{children:m}))}}},Ve=(0,t.memo)(function(d){var a=d.messageApi,s=d.index,v=d.idName,N=d.cidName,o=(0,Q.useIntl)(),g=(0,t.useState)(!1),m=y()(g,2),A=m[0],h=m[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){h(!0)},onMouseLeave:function(){h(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var x=X()(C()().mark(function u(b){var j,R;return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return j=b.target.closest("#".concat(v).concat(s)),R=j.querySelector("#".concat(N).concat(s)),l.prev=2,l.next=5,ze()(R.innerText);case 5:a.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),l.next=11;break;case 8:l.prev=8,l.t0=l.catch(2),console.error("Failed to copy text: ",l.t0);case 11:case"end":return l.stop()}},u,null,[[2,8]])}));return function(u){return x.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(A?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(A?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Ue=function(a){var s=a.id,v=a.index,N=a.idName,o=a.cidName,g=(0,Q.useIntl)(),m=(0,Y.Z)(function(R){return R.setSummaryClick}),A=(0,t.useState)(!0),h=y()(A,2),x=h[0],u=h[1],b=(0,Y.Z)(function(R){return R.summaryClick});(0,t.useEffect)(function(){u(b)},[b]);var j=(0,Y.Z)(function(R){return R.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(x?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(D){if(x){var l=D.target.closest("#".concat(N).concat(v)),P=l.querySelector("#".concat(o).concat(v));j({id:s,message:P.innerText}),m(!1)}},children:[(0,e.jsx)(St.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:g.formatMessage({id:"app.chatroom.content.summary"})})]})})},Dt=function(a){var s=a.roomid,v=(0,Q.useIntl)(),N=(0,Y.Z)(function(u){return u.setSummaryClick}),o=(0,t.useState)(!0),g=y()(o,2),m=g[0],A=g[1],h=(0,Y.Z)(function(u){return u.summaryClick});(0,t.useEffect)(function(){A(h)},[h]);var x=(0,Y.Z)(function(u){return u.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(m?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){m&&(x({id:s}),N(!1))},children:[(0,e.jsx)(Ct,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:v.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Zt=(0,t.memo)(function(d){var a=d.messageApi,s=d.setCurrentMessageContent,v=d.sendValue,N=d.agentList,o=d.scrollDomRef,g=d.upButtonDom,m=d.setIsStop,A=d.setisEnd,h=d.setSendValue,x=(0,Q.useIntl)(),u=(0,Q.useParams)(),b=u.id,j=(0,Y.Z)(function(ae){return ae.setDisableInput}),R=(0,t.useState)({}),D=y()(R,2),l=D[0],P=D[1],W=(0,t.useRef)(!1),E=(0,t.useRef)(""),F=(0,Y.Z)(function(ae){return ae.setTruncatable}),V=function(oe){var q=oe.data;if(q.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var z=JSON.parse(q.slice(22,-2));switch(z[0]){case"ERROR":j(!1),m(!1),h(""),a.open({type:"error",content:"webSocket-".concat(z[1]),duration:10});break;case"CHAT":var T={content:"".concat(z[1]),is_agent:0};s(function(w){return[].concat(de()(w),[T])}),setTimeout(function(){o.current.scrollTop=0,g.current.style.display="none"});break;case"STOPPABLE":m(z[1]);break;case"TRUNCATABLE":F(z[1]),z[1]||a.open({type:"success",content:"".concat(x.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":a.open({type:"success",content:"".concat(x.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(q.indexOf("REPLY")!==-1&&q.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var H=JSON.parse(q.slice(22,-2))[1];E.current="",W.current=!0;var $=N.current.filter(function(w){return w.agent_id==H})[0];Object.keys(l).length&&s(function(w){return[].concat(de()(w),[l])}),P(function(w){return U()(U()({},w),{},{is_agent:1,icon:$==null?void 0:$.icon,name:$==null?void 0:$.name})}),m(!0),F(!1)}q.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&W.current&&(o.current.scrollTop=0,g.current.style.display="none",E.current+=q,P(function(w){return U()(U()({},w),{},{content:E.current})})),q.indexOf("ENDCHAT")!==-1&&(W.current=!1,E.current="",j(!1),m(!1),F(!0),Object.keys(l).length&&s(function(w){return[].concat(de()(w),[l])}),P({}),A(!0),h(""))},ee=(0,ot.Z)("chat",V),te=ee.runSocket,G=ee.sendMessage,Z=ee.readyState;return(0,t.useEffect)(function(){Z==1&&b&&G(JSON.stringify(["ENTER",parseInt(b)]))},[Z]),(0,t.useEffect)(function(){v&&Z==1&&G(v)},[v]),(0,t.useEffect)(function(){te()},[]),(0,e.jsx)(e.Fragment,{children:l.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(l.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:l.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",l.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(l.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:l.name?l.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(l.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],components:Oe("add",x),children:l.content})})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Ot=(0,t.memo)(function(d){var a=d.messageApi,s=d.setUserMessage,v=d.sendValue,N=d.agentList,o=d.scrollDomRef,g=d.upButtonDom,m=d.setIsStop,A=d.setSendValue,h=(0,Q.useIntl)(),x=(0,t.useState)([]),u=y()(x,2),b=u[0],j=u[1],R=(0,t.useState)(!1),D=y()(R,2),l=D[0],P=D[1],W=(0,Q.useParams)(),E=W.id;return(0,t.useEffect)(function(){l&&(s(function(F){return[].concat(de()(b.reverse()),de()(F))}),j([]),setTimeout(function(){P(!1),o.current.scrollTop=0},200))},[l]),(0,e.jsxs)(e.Fragment,{children:[b.length?b.map(function(F,V){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(F.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:F.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",F.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(V),children:[(0,e.jsx)("div",{className:"".concat(F.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:F.name?F.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(F.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:F.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(V),children:(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],components:Oe(V,h),children:F.content})})}),F.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(Ve,{messageApi:a,index:V,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(Ue,{id:E,index:V,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},V)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Zt,{messageApi:a,setCurrentMessageContent:j,sendValue:v,agentList:N,scrollDomRef:o,upButtonDom:g,setIsStop:m,setisEnd:P,setSendValue:A})]})}),Et=(0,t.memo)(function(d){var a=d.messageApi,s=d.scrollDomRef,v=d.instruction,N=d.setIsStop,o=d.upButtonDom,g=d.setInstruction,m=d.agentList,A=(0,Q.useIntl)(),h=(0,Q.useParams)(),x=h.id,u=(0,t.useState)([]),b=y()(u,2),j=b[0],R=b[1],D=(0,t.useRef)(!1),l=(0,t.useState)(""),P=y()(l,2),W=P[0],E=P[1],F=(0,t.useRef)(null),V=(0,t.useRef)(!0),ee=(0,t.useRef)(2),te=(0,t.useRef)(1),G=(0,t.useRef)(0),Z=function(){var T=X()(C()().mark(function H($){var w,re,ue=arguments;return C()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(w=ue.length>1&&ue[1]!==void 0?ue[1]:function(){},!x){_.next=6;break}return _.next=4,(0,le.KH)(x,{page:te.current,page_size:10});case 4:re=_.sent,re.code==0&&(ee.current=re.data.total_pages,$||(F.current.style.display="none"),R(function(O){return $?de()(re.data.list.reverse()):[].concat(de()(O),de()(re.data.list.reverse()))}),$?setTimeout(function(){s.current.scrollTop=0,o.current.style.display="none"}):G.current=re.data.list.length,V.current=!0);case 6:case"end":return _.stop()}},H)}));return function($){return T.apply(this,arguments)}}(),ae=function(H){var $=H.target.scrollHeight+(H.target.scrollTop-H.target.clientHeight);D.current!==Math.ceil(H.target.scrollTop)<-50&&(D.current=Math.ceil(H.target.scrollTop)<-50,o.current.style.display=D.current?"flex":"none"),$<10&&V.current&&(V.current=!1,te.current=te.current+1,F.current.style.display="flex",ee.current>=te.current?Z(!1):F.current.style.display="none")},oe=function(H,$){$==="0"&&($=Number($));var w=["".concat(H),$===0||$?$:null];E(JSON.stringify(w))},q=(0,Y.Z)(function(T){return T.disableInput}),z=(0,Y.Z)(function(T){return T.clearMemory});return(0,t.useEffect)(function(){z&&z.length&&oe(z[0],z[1])},[z]),(0,t.useEffect)(function(){v&&v.length&&(oe(v[0],v[1]?v[1]:""),g([]))},[v]),(0,t.useEffect)(function(){te.current=1,Z(!0)},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:s,onScroll:ae,children:[(0,e.jsxs)("div",{className:"min-w-[860px]",children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:j&&j.length?j.map(function(T,H){return(0,e.jsxs)("div",{id:"c".concat(T.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(T.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:T.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",T.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(H),children:[(0,e.jsx)("div",{className:"".concat(T.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:T.name?T.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(T.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:T.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(H),children:(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],components:Oe(H,A),children:T.content})})}),T.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(Ve,{messageApi:a,idName:"content",cidName:"chilContent",index:H}),(0,e.jsx)(Ue,{id:x,index:H,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},H)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(Ot,{messageApi:a,setUserMessage:R,sendValue:W,agentList:m,scrollDomRef:s,upButtonDom:o,setIsStop:N,setSendValue:E})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!q&&j.length?(0,e.jsx)(Dt,{roomid:x}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:F,children:(0,e.jsx)(Se.Z,{})})]})})}),Tt=(0,t.memo)(function(d){var a=d.agentList,s=(0,t.useRef)(null),v=(0,t.useRef)(null),N=(0,t.useState)(!1),o=y()(N,2),g=o[0],m=o[1],A=(0,t.useState)([]),h=y()(A,2),x=h[0],u=h[1],b=Be.ZP.useMessage(),j=y()(b,2),R=j[0],D=j[1];return(0,e.jsxs)(e.Fragment,{children:[D,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full",children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(Et,{instruction:x,setInstruction:u,messageApi:R,scrollDomRef:s,setIsStop:m,upButtonDom:v,agentList:a}),(0,e.jsx)(Ft,{setInstruction:u,messageApi:R,isStop:g,upButtonDom:v,scrollDomRef:s})]})})]})}),Pt=p(39873),Lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},Bt=Lt,$t=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:Bt}))},Ht=t.forwardRef($t),_t=Ht,zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},Vt=zt,Ut=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:Vt}))},Wt=t.forwardRef(Ut),Gt=Wt,Jt=p(83159),Kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},Qt=Kt,Xt=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:Qt}))},Yt=t.forwardRef(Xt),qt=Yt,Ee=p(86),We=p(34994),Ge=p(2216),ea=p(85877),ta=p(29432),aa=p(39944),na=p(11551),Te=p(55927),ra=function(a){var s,v,N,o=a.selectApp,g=a.runid,m=a.setBoxLoading,A=a.setinputShow,h=a.appId,x=a.id,u=a.setisRun,b=(0,Q.useIntl)(),j=(0,t.useRef)(""),R=(0,t.useRef)(""),D=(0,t.useRef)(null),l=(0,t.useState)(""),P=y()(l,2),W=P[0],E=P[1],F=(0,t.useState)(null),V=y()(F,2),ee=V[0],te=V[1],G=(0,t.useState)([]),Z=y()(G,2),ae=Z[0],oe=Z[1],q=(0,t.useState)(""),z=y()(q,2),T=z[0],H=z[1],$=(0,Te.Z)(function(_){return _.flowMessage}),w=function(O){R.current=re(O);var K={user:{value:re(O)}};H(new aa.z(K))},re=function _(O){return O.map(function(K){return K.type==="mention"?K.id:K.children?_(K.children):K.text}).join("")},ue=function(){var _=X()(C()().mark(function O(K){var J,L;return C()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return m(!0),J=Object.keys(K),J.forEach(function(n){D.current.properties[n]&&(D.current.properties[n].value=K[n])}),r.next=5,(0,na.LH)({agent_id:o.checkItem[0].agent_id,ability_id:0,input_dict:D.current,prompt:T,data_source_run_id:j.current});case 5:L=r.sent,L.code==0&&(E(L.data.outputs_md),m(!1),u(!1));case 7:case"end":return r.stop()}},O)}));return function(K){return _.apply(this,arguments)}}(),fe=function(){var _=X()(C()().mark(function O(K,J){var L,I;return C()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,le.xT)(K,J);case 2:L=n.sent,(L==null?void 0:L.code)==0&&(j.current=L==null||(I=L.data)===null||I===void 0?void 0:I.app_run_id);case 4:case"end":return n.stop()}},O)}));return function(K,J){return _.apply(this,arguments)}}();return(0,t.useEffect)(function(){o&&o.checkItem.length&&(u(!0),fe(x,{app_id:h,app_run_id:g,status:1,corrected_parameter:""}))},[o]),(0,t.useEffect)(function(){var _=$.filter(function(r){return r.data.app_run_id==g&&r.type.indexOf("generate_meeting_action_items")!==-1});if(_.length!=0){var O,K=(O=_[_.length-1])===null||O===void 0||(O=O.data)===null||O===void 0||(O=O.exec_data)===null||O===void 0||(O=O.outputs)===null||O===void 0?void 0:O.value;if(K){var J=JSON.parse(K);D.current=J;var L=Object.keys(J.properties);if(L.length){te(J.properties);var I=L.map(function(r){return{value:"<<".concat(ta.qX,".inputs.").concat(r,">>"),label:r}});oe(I)}A(!1),m(!1)}}},[$]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ee.Z,{icon:o==null||(s=o.checkItem[0])===null||s===void 0?void 0:s.icon,title:o==null||(v=o.checkItem[0])===null||v===void 0?void 0:v.name,textDetails:o==null||(N=o.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"robot_icon",handleClick:function(){}})}),ee!=null?(0,e.jsxs)(We.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!R.current},searchConfig:{submitText:b.formatMessage({id:"workflow.button.run"})}},onFinish:function(O){ue(O)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ge._,{data:ee})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ea.Z,{onChange:function(O){w(O)},options:ae,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),W?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],children:W})})}):(0,e.jsx)(e.Fragment,{})]})},sa=(0,t.memo)(ra),ia=p(66309),Je=p(42237),ca=p(93696),la=function(a,s){return t.createElement(he.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:s,icon:ca.Z}))},oa=t.forwardRef(la),ua=oa,da=p(4981),Ke=p(29608),pa=(0,t.memo)(function(d){var a=d.progressObj,s=function(){return parseFloat(a.elapsed_time).toFixed(6)},v=function(o){var g=new Date(o),m=g.getFullYear(),A=(g.getMonth()+1).toString().padStart(2,"0"),h=g.getDate().toString().padStart(2,"0"),x=g.getHours().toString().padStart(2,"0"),u=g.getMinutes().toString().padStart(2,"0"),b=g.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(m,".").concat(A,".").concat(h," ").concat(x,":").concat(u,":").concat(b)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:a.created_time&&v(a.created_time)}),(0,e.jsx)("div",{className:"truncate",children:a.apps_name||a.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(a.status==1?"bg-blue-600":a.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[s(),"S"]})]})]})})}),fa=function(a){var s,v,N,o=a.selectApp,g=a.runid,m=a.setBoxLoading,A=a.setinputShow,h=a.appId,x=a.id,u=a.setisRun,b=(0,Q.useIntl)(),j=(0,t.useRef)(""),R=(0,t.useRef)(null),D=(0,t.useState)(null),l=y()(D,2),P=l[0],W=l[1],E=(0,t.useState)(!1),F=y()(E,2),V=F[0],ee=F[1],te=(0,t.useState)(null),G=y()(te,2),Z=G[0],ae=G[1],oe=(0,t.useState)(null),q=y()(oe,2),z=q[0],T=q[1],H=(0,t.useState)(null),$=y()(H,2),w=$[0],re=$[1],ue=(0,Ke.Z)(function(n){return n.setDealtWithData}),fe=(0,Ke.Z)(function(n){return n.setRunPanelLogRecord}),_=function(){var n=X()(C()().mark(function i(c){var f,S,k,M,B;return C()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return m(!0),f=Object.keys(c),S={},f.forEach(function(ne){R.current.properties[ne]&&(R.current.properties[ne].value=c[ne]),z&&z.forEach(function(me){me.node_id==ne&&(S[ne]=c[ne])})}),k={inputs:R.current,node_confirm_users:S,run_name:"chatroom-".concat(x,"-run-").concat(j.current,"-driven"),run_type:1,data_source_run_id:j.current},ie.next=7,(0,Je.UE)(h,k);case 7:M=ie.sent,M.code==0&&(j.current=M==null||(B=M.data)===null||B===void 0?void 0:B.app_run_id,ee(!0),u(!1));case 9:case"end":return ie.stop()}},i)}));return function(c){return n.apply(this,arguments)}}(),O=function(){var n=X()(C()().mark(function i(){var c,f;return C()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:c=r==null?void 0:r.filter(function(M){return M.type=="workflow_run_progress"&&M.data.app_run_id==j.current}).map(function(M){var B=M.data;return B}),c&&c.length&&(f=c[c.length-1],W(f),m(!1));case 2:case"end":return k.stop()}},i)}));return function(){return n.apply(this,arguments)}}(),K=function(){var n=X()(C()().mark(function i(){var c,f,S,k,M;return C()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:f=r==null?void 0:r.filter(function(ie){return ie.type=="workflow_need_human_confirm"&&ie.data.app_run_id==j.current}),S=(c=f.map(function(ie){var ne=ie.data,me=ie.need_human_confirm;return{data:ne,need_human_confirm:me}}))===null||c===void 0?void 0:c.filter(function(ie){return ie.data.type!==1}),S&&S.length&&(M=S[S.length-1].data,M.exec_id=M==null||(k=M.node_exec_data)===null||k===void 0?void 0:k.node_exec_id,re(S[S.length-1]),m(!1));case 3:case"end":return se.stop()}},i)}));return function(){return n.apply(this,arguments)}}(),J=function(i){return i.completed_progress?parseInt(i.completed_progress.slice(0,-1)):!1},L=function(){var n=X()(C()().mark(function i(c,f){var S,k;return C()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,le.xT)(c,f);case 2:S=B.sent,(S==null?void 0:S.code)==0&&(j.current=S==null||(k=S.data)===null||k===void 0?void 0:k.app_run_id);case 4:case"end":return B.stop()}},i)}));return function(c,f){return n.apply(this,arguments)}}(),I=function(){var n=X()(C()().mark(function i(){var c,f;return C()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return console.log(h),k.next=3,(0,Je.zO)(h);case 3:c=k.sent,c.code==0&&T(c==null||(f=c.data)===null||f===void 0?void 0:f.need_confirm_nodes),L(x,{app_id:h,app_run_id:g,status:1,corrected_parameter:""});case 6:case"end":return k.stop()}},i)}));return function(){return n.apply(this,arguments)}}();(0,t.useEffect)(function(){o&&o.checkItem.length&&(u(!0),I())},[o]);var r=(0,Te.Z)(function(n){return n.flowMessage});return(0,t.useEffect)(function(){O(),K();var n=r.filter(function(k){return k.data.app_run_id==g&&k.type.indexOf("generate_meeting_action_items")!==-1});if(n.length!=0){var i,c=(i=n[n.length-1])===null||i===void 0||(i=i.data)===null||i===void 0||(i=i.exec_data)===null||i===void 0||(i=i.outputs)===null||i===void 0?void 0:i.value;if(c){var f=JSON.parse(c);R.current=f;var S=Object.keys(f.properties);S.length&&(console.log(f.properties),ae(f.properties)),A(!1),m(!1)}}},[r]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ee.Z,{icon:o==null||(s=o.checkItem[0])===null||s===void 0?void 0:s.icon,title:o==null||(v=o.checkItem[0])===null||v===void 0?void 0:v.name,textDetails:o==null||(N=o.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"workflow_icon",handleClick:function(){}})}),!V&&Z!=null?(0,e.jsxs)(We.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:b.formatMessage({id:"workflow.button.run"})}},onFinish:_,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Ge._,{data:Z})}),(0,e.jsx)(da.e,{data:z})]}):(0,e.jsx)(e.Fragment,{children:Z!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[b.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(Z).map(function(n){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:n.display_name||n.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:n.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),w&&w.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){ue(w.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(ua,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:b.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),P?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Ee.Z,{status:P.status,icon:P.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:P.run_name}),P.need_human_confirm==1?(0,e.jsx)(ia.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:b.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(pa,{progressObj:P}),handleClick:function(){fe(P)},progress:J(P)})}):(0,e.jsx)(e.Fragment,{})]})},ma=(0,t.memo)(fa),xa=function(a){var s,v,N,o=(0,Q.useIntl)(),g=a.runid,m=a.id,A=a.setBoxLoading,h=a.scrollDom,x=a.setinputShow,u=(0,t.useRef)("agent"),b=(0,t.useRef)(""),j=(0,t.useState)(!1),R=y()(j,2),D=R[0],l=R[1],P=(0,t.useState)({type:"agent",checkItem:[],show:!1}),W=y()(P,2),E=W[0],F=W[1],V=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){F(function(Z){return U()(U()({},Z),{},{type:"agent",show:!0})})},children:o.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){F(function(Z){return U()(U()({},Z),{},{type:"workflow",show:!0})})},children:o.formatMessage({id:"app.summary.SelectWorkflow"})})}],ee=function(){F(function(Z){return U()(U()({},Z),{},{show:!1})})},te=function(Z){A(!0),F(function(ae){return U()(U()({},ae),{},{checkItem:Z.checkItem})}),u.current=E.type,b.current=Z.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:E!=null&&(s=E.checkItem)!==null&&s!==void 0&&s.length?h==null||(v=h.current)===null||v===void 0?void 0:v.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:o.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:D?(0,e.jsx)(Jt.Z,{menu:{items:V},children:(0,e.jsx)(qt,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:E!=null&&(N=E.checkItem)!==null&&N!==void 0&&N.length?(0,e.jsx)(e.Fragment,{children:u.current=="agent"?(0,e.jsx)(sa,{id:m,appId:b.current,selectApp:E,runid:g,setBoxLoading:A,scrollDom:h,setinputShow:x,setisRun:l}):(0,e.jsx)(ma,{id:m,appId:b.current,selectApp:E,runid:g,setBoxLoading:A,scrollDom:h,setinputShow:x,setisRun:l})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(Ce.ZP,{className:"flex-1 text-[14px]",onClick:function(){F(function(Z){return U()(U()({},Z),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),o.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(Ce.ZP,{className:"flex-1 text-[14px]",onClick:function(){F(function(Z){return U()(U()({},Z),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),o.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(He.Z,{show:E.show,nodetype:E.type,popupClose:ee,popupSave:te,checkList:u.current==E.type?E.checkItem:[],zIndex:99,radio:!0})]})},va=(0,t.memo)(xa),ha=p(87740),Qe=(0,t.memo)(function(d){var a=d.id,s=d.message,v=(0,Q.useIntl)(),N=(0,Y.Z)(function(u){return u.setSummaryClick}),o=(0,t.useState)(!0),g=y()(o,2),m=g[0],A=g[1],h=(0,Y.Z)(function(u){return u.summaryClick}),x=(0,Y.Z)(function(u){return u.setSummaryParams});return(0,t.useEffect)(function(){A(h)},[h]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(Ce.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(b){m&&(x({id:a,message:s}),N(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:v.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(ha.Z,{className:"text-[14px]"})]})})}),ga=function(a){var s,v,N,o,g=a.setShow,m=a.inputShow,A=a.setBoxLoading,h=a.setAppRunId,x=a.scrollDom,u=(0,Q.useIntl)(),b=(0,t.useState)(!1),j=y()(b,2),R=j[0],D=j[1],l=(0,t.useState)(""),P=y()(l,2),W=P[0],E=P[1],F=(0,t.useState)(""),V=y()(F,2),ee=V[0],te=V[1],G=(0,t.useRef)(""),Z=(0,t.useRef)(""),ae=(0,t.useRef)(!1),oe=(0,t.useState)(!1),q=y()(oe,2),z=q[0],T=q[1],H=(0,t.useState)(null),$=y()(H,2),w=$[0],re=$[1],ue=(0,Y.Z)(function(I){return I.setSummaryClick}),fe=function(){var I=X()(C()().mark(function r(n){var i,c,f,S,k=arguments;return C()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return i=k.length>1&&k[1]!==void 0?k[1]:{app_run_id:"",corrected_parameter:""},B.next=3,(0,le.Rp)(n,i);case 3:c=B.sent,(c==null?void 0:c.code)==0&&(h(c==null||(f=c.data)===null||f===void 0?void 0:f.app_run_id),Z.current=c==null||(S=c.data)===null||S===void 0?void 0:S.app_run_id,i.app_run_id&&(ae.current=!0));case 5:case"end":return B.stop()}},r)}));return function(n){return I.apply(this,arguments)}}(),_=function(){var I=X()(C()().mark(function r(n,i){var c,f,S,k,M;return C()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.next=2,(0,le.xM)(n,{message:i});case 2:c=se.sent,(c==null?void 0:c.code)==0&&(Z.current=c==null||(f=c.data)===null||f===void 0?void 0:f.app_run_id,h(c==null||(S=c.data)===null||S===void 0?void 0:S.app_run_id),c!=null&&(k=c.data)!==null&&k!==void 0&&(k=k.outputs)!==null&&k!==void 0&&k.value&&(E(c==null||(M=c.data)===null||M===void 0||(M=M.outputs)===null||M===void 0?void 0:M.value),g(!0),A(!1),ue(!0),x.current.scrollTo({top:0})));case 4:case"end":return se.stop()}},r)}));return function(n,i){return I.apply(this,arguments)}}(),O=function(){var I=X()(C()().mark(function r(){var n;return C()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,le.Gh)({chatroom_id:G.current,app_run_id:Z.current});case 2:n=c.sent,n&&n!==null&&n!==void 0&&n.data&&re(n.data);case 4:case"end":return c.stop()}},r)}));return function(){return I.apply(this,arguments)}}(),K=function(r){var n=new Date(r),i=n.getMonth()+1,c=n.getDate(),f=n.getHours(),S=n.getMinutes(),k=n.getSeconds();return n.getFullYear()+"-"+(i<10?"0"+i:i)+"-"+(c<10?"0"+c:c)+" "+(f<10?"0"+f:f)+":"+(S<10?"0"+S:S)+":"+(k<10?"0"+k:k)},J=(0,Te.Z)(function(I){return I.flowMessage});(0,t.useEffect)(function(){var I=J.filter(function(i){return i.data.app_run_id==Z.current&&i.type.indexOf("generate_meeting_summary")!==-1});if(I.length!=0){var r,n=(r=I[I.length-1])===null||r===void 0||(r=r.data)===null||r===void 0||(r=r.exec_data)===null||r===void 0||(r=r.outputs)===null||r===void 0?void 0:r.value;n&&(ae.current&&O(),E(n),T(!1),g(!0),ue(!0),A(!1),x.current.scrollTo({top:0}))}},[J]);var L=(0,Y.Z)(function(I){return I.summaryParams});return(0,t.useEffect)(function(){L&&L.id&&(G.current=L.id,w&&re(null),z&&T(!1),W&&E(""),D(!0),L.message?(A(!0),_(L.id,L.message)):fe(L.id))},[L]),(0,e.jsx)(e.Fragment,{children:R?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:u.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:W?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],children:w?w==null||(s=w.source_run)===null||s===void 0?void 0:s.summary:W})}),w&&(w==null||(v=w.source_corrections)===null||v===void 0?void 0:v.length)>0||!m?(0,e.jsx)(Qe,{id:G.current,message:w?w==null||(N=w.source_run)===null||N===void 0?void 0:N.summary:W}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(Se.Z,{size:"large"})})}),w&&(w==null||(o=w.source_corrections)===null||o===void 0?void 0:o.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[u.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),w.source_corrections.map(function(I,r){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(w.source_corrections.length-1==r?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[u.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",I.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[u.formatMessage({id:"app.summaryhistory.time"}),": ",K(I.created_time)]}),(0,e.jsx)(ye.U,{rehypePlugins:[we.Z],children:I==null?void 0:I.corrected_summary})]})},I.created_time),!m||w.source_corrections.length-1!=r?(0,e.jsx)(Qe,{id:G.current,message:I==null?void 0:I.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},I.created_time)})]}):(0,e.jsx)(e.Fragment,{}),m?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(_e.Z.TextArea,{onChange:function(r){te(r.target.value)},value:ee,disabled:!W||z,rows:4,placeholder:u.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(Ce.ZP,{type:"primary",disabled:!W||!ee,loading:z,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){fe(G.current,{app_run_id:String(Z.current),corrected_parameter:ee}),T(!0),te(""),g("")},children:u.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},ja=(0,t.memo)(ga),Sa=p(38027),ya=function(a){var s,v=a.id,N=(0,t.useState)(""),o=y()(N,2),g=o[0],m=o[1],A=(0,t.useState)(!1),h=y()(A,2),x=h[0],u=h[1],b=(0,t.useState)([]),j=y()(b,2),R=j[0],D=j[1],l=(0,t.useState)(!1),P=y()(l,2),W=P[0],E=P[1],F=(0,t.useState)(!1),V=y()(F,2),ee=V[0],te=V[1],G=(0,t.useState)(""),Z=y()(G,2),ae=Z[0],oe=Z[1],q=(0,t.useState)(!1),z=y()(q,2),T=z[0],H=z[1],$=(0,t.useState)(!1),w=y()($,2),re=w[0],ue=w[1],fe=(0,t.useState)(!0),_=y()(fe,2),O=_[0],K=_[1],J=(0,t.useRef)(null),L=(0,t.useRef)(1),I=(0,t.useRef)(!1),r=(0,t.useRef)(!0),n=(0,t.useRef)(0),i=(0,t.useState)(!1),c=y()(i,2),f=c[0],S=c[1],k=(0,Y.Z)(function(ne){return ne.summaryParams}),M=(0,Y.Z)(function(ne){return ne.setSummaryParams}),B=function(){var ne=X()(C()().mark(function me(){var ge,Fe,ce,Pe,Ne,Le,be=arguments;return C()().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(ge=be.length>0&&be[0]!==void 0?be[0]:!0,Fe=be.length>1&&be[1]!==void 0?be[1]:!0,!(n.current!=0&&n.current<L.current)){je.next=5;break}return S(!1),je.abrupt("return");case 5:return je.next=8,(0,le.sh)({chatroom_id:v,page:L.current,page_size:10});case 8:ce=je.sent,ce.code==0&&(ce!=null&&(Pe=ce.data)!==null&&Pe!==void 0&&Pe.list&&ce!==null&&ce!==void 0&&(Ne=ce.data)!==null&&Ne!==void 0&&(Ne=Ne.list)!==null&&Ne!==void 0&&Ne.length&&(n.current=ce==null||(Le=ce.data)===null||Le===void 0?void 0:Le.total_pages,D(function(Re){return Fe?de()(ce.data.list.reverse()):[].concat(de()(ce.data.list.reverse()),de()(Re))}),u(!0),S(!0),setTimeout(function(){r.current=!0},500)),Fe&&setTimeout(function(){var Re;J==null||(Re=J.current)===null||Re===void 0||Re.scrollTo({top:0})},200),ge||(m(k.id),M({})));case 10:case"end":return je.stop()}},me)}));return function(){return ne.apply(this,arguments)}}(),se=function(){var ne=X()(C()().mark(function me(ge){return C()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:ge.target.scrollHeight+(ge.target.scrollTop-ge.target.clientHeight)<400&&r.current&&(r.current=!1,S(!0),L.current=L.current+=1,B(!0,!1));case 1:case"end":return ce.stop()}},me)}));return function(ge){return ne.apply(this,arguments)}}();(0,t.useEffect)(function(){L.current=1,B()},[v]),(0,t.useEffect)(function(){k&&k.id&&(u(!0),O||K(!0),W&&E(!1),T&&H(!1),L.current=1,te(!0),B(!1),I.current=!0)},[k]);var ie=(0,Y.Z)(function(ne){return ne.setOrientationShow});return(0,t.useEffect)(function(){x&&ie(!0)},[x]),(0,e.jsx)(e.Fragment,{children:x?(0,e.jsxs)(Pt.Z,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(T?"translate-x-full flex-[0]":""),children:[re?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(Se.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){H(function(me){return!me})},className:`
                                        `.concat(T?"fixed right-[100%] top-[60px]":"absolute right-[99%] top-[60px]",`
                                        history_packup
                                        hover:text-[#1B64F3]
                                         w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                                    `),children:T?(0,e.jsx)(Gt,{className:"text-[18px]"}):(0,e.jsx)(_t,{className:"text-[18px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:se,ref:J,children:[(0,e.jsxs)("div",{children:[R.length?(0,e.jsx)(Sa.ZP,{id:v,runid:ae,scrollDom:J,list:R,historyHeight:I.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:ee?J==null||(s=J.current)===null||s===void 0?void 0:s.offsetHeight:""},children:[(0,e.jsx)(ja,{setShow:E,inputShow:O,setBoxLoading:ue,setAppRunId:oe,scrollDom:J}),W?(0,e.jsx)(va,{id:g,runid:ae,setBoxLoading:ue,scrollDom:J,setinputShow:K}):(0,e.jsx)(e.Fragment,{})]})]}),f?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(Se.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},wa=(0,t.memo)(ya),Na=function(a){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})},ba=(0,t.memo)(function(){var d=(0,Q.useParams)(),a=d.id,s=(0,t.useRef)([]),v=(0,t.useRef)(null),N=(0,t.useState)(!1),o=y()(N,2),g=o[0],m=o[1],A=function(){var h=X()(C()().mark(function x(){var u;return C()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!a){j.next=5;break}return j.next=3,(0,le.cH)({id:a});case 3:u=j.sent,u.code==0?(m(!0),v.current=u.data,s.current=u.data.agent_list):Q.history.replace("/meeting");case 5:case"end":return j.stop()}},x)}));return function(){return h.apply(this,arguments)}}();return(0,t.useEffect)(function(){A()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden overflow-x-auto",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(it,{roomDetail:v.current,setAgent:s}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:g?(0,e.jsx)(Tt,{agentList:s}):(0,e.jsx)(Na,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(wa,{id:a})})]})})}),Ca=ba}}]);
