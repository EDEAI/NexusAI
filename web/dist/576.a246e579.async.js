"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[576],{81644:function(G,j,r){r.d(j,{Z:function(){return f}});var N=r(1413),n=r(67294),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"},g=D,R=r(91146),k=function(U,C){return n.createElement(R.Z,(0,N.Z)((0,N.Z)({},U),{},{ref:C,icon:g}))},V=n.forwardRef(k),f=V},2068:function(G,j,r){r.d(j,{Z:function(){return f}});var N=r(1413),n=r(67294),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},g=D,R=r(91146),k=function(U,C){return n.createElement(R.Z,(0,N.Z)((0,N.Z)({},U),{},{ref:C,icon:g}))},V=n.forwardRef(k),f=V},24805:function(G,j,r){r.d(j,{Hb:function(){return U},Ur:function(){return J},cN:function(){return Y},ej:function(){return C}});var N=r(15009),n=r.n(N),D=r(99289),g=r.n(D),R=r(47520),k="/v1/skill/skill_info/",V="/v1/skill/skill_update/",f="/v1/skill/skill_publish/",x="/v1/skill/skill_run",U=function(){var S=g()(n()().mark(function v(l,p){var T;return n()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,R.ZP)("".concat(k).concat(l),{method:"GET",data:{publish_status:p=="true"?1:0}});case 2:return T=P.sent,P.abrupt("return",T);case 4:case"end":return P.stop()}},v)}));return function(l,p){return S.apply(this,arguments)}}(),C=function(){var S=g()(n()().mark(function v(l){var p;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,R.ZP)("".concat(V).concat(l.app_id),{method:"PUT",data:l.data});case 2:return p=i.sent,i.abrupt("return",p);case 4:case"end":return i.stop()}},v)}));return function(l){return S.apply(this,arguments)}}(),Y=function(){var S=g()(n()().mark(function v(l){var p;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,R.ZP)("".concat(f).concat(l),{method:"PUT"});case 2:return p=i.sent,i.abrupt("return",p);case 4:case"end":return i.stop()}},v)}));return function(l){return S.apply(this,arguments)}}(),J=function(){var S=g()(n()().mark(function v(l){var p;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,R.ZP)("".concat(x),{method:"POST",data:l});case 2:return p=i.sent,i.abrupt("return",p);case 4:case"end":return i.stop()}},v)}));return function(l){return S.apply(this,arguments)}}()},18449:function(G,j,r){r.d(j,{Z:function(){return Ae}});var N=r(15009),n=r.n(N),D=r(97857),g=r.n(D),R=r(99289),k=r.n(R),V=r(5574),f=r.n(V),x=r(24805),U=r(37369),C=r(60271),Y=r(620),J=r(2216),S=r(34994),v=r(76772),l=r(45360),p=r(28036),T=r(47221),i=r(96486),P=r.n(i),L=r(67294),ve=r(19632),W=r.n(ve),ee=function(a){return a.filter(function(e,d){return a.indexOf(e)!==d})},he=function(a){var e=[];if(!a)return e.push({field:"input_variables",message:"Input variables cannot be empty",type:"error",code:"INPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!a.properties||P().isEmpty(a.properties))return e.push({field:"input_variables.properties",message:"At least one input variable must be defined",type:"error",code:"INPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(a.properties),_=ee(d);return _.length>0&&e.push({field:"input_variables.properties",message:"Duplicate variable names: ".concat(_.join(", ")),type:"error",code:"INPUT_VARIABLES_DUPLICATE"}),Object.entries(a.properties).forEach(function(Z){var w=f()(Z,2),s=w[0],c=w[1];(!c.name||c.name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},ge=function(a){var e=[];if(!a)return e.push({field:"output_variables",message:"Output variables cannot be empty",type:"error",code:"OUTPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!a.properties||P().isEmpty(a.properties))return e.push({field:"output_variables.properties",message:"At least one output variable must be defined",type:"error",code:"OUTPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(a.properties),_=ee(d);return _.length>0&&e.push({field:"output_variables.properties",message:"Duplicate variable names: ".concat(_.join(", ")),type:"error",code:"OUTPUT_VARIABLES_DUPLICATE"}),Object.entries(a.properties).forEach(function(Z){var w=f()(Z,2),s=w[0],c=w[1];(!c.name||c.name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},we=function(a){var e=[];if(!a||a.trim()==="")return e.push({field:"code",message:"Code cannot be empty",type:"error",code:"CODE_REQUIRED"}),{isValid:!1,errors:e};try{var d=JSON.parse(a);(!d.python3||d.python3.trim()==="")&&e.push({field:"code.python3",message:"Python code cannot be empty",type:"error",code:"PYTHON_CODE_REQUIRED"}),d.python3&&!d.python3.includes("def main(")&&e.push({field:"code.python3",message:"Code must contain main function definition",type:"warning",code:"MAIN_FUNCTION_MISSING"})}catch(_){e.push({field:"code",message:"Code format is incorrect, cannot parse JSON",type:"error",code:"CODE_INVALID_JSON"})}return{isValid:e.length===0,errors:e}},ye=function(a){var e=[];return(!a.name||a.name.trim()==="")&&e.push({field:"name",message:"Skill name cannot be empty",type:"error",code:"NAME_REQUIRED"}),{isValid:e.length===0,errors:e}},be=function(a){var e=[],d=ye(a);e.push.apply(e,W()(d.errors));var _=he(a.input_variables);e.push.apply(e,W()(_.errors));var Z=ge(a.output_variables);return e.push.apply(e,W()(Z.errors)),{isValid:e.length===0,errors:e}},Ee=function(a){var e={INPUT_VARIABLES_REQUIRED:"skill.message.inputerror1",INPUT_VARIABLES_EMPTY:"skill.message.inputerror1",OUTPUT_VARIABLES_REQUIRED:"skill.message.inputerror2",OUTPUT_VARIABLES_EMPTY:"skill.message.inputerror2",INPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",OUTPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",VARIABLE_NAME_REQUIRED:"skill.rules.name",VARIABLE_DISPLAY_NAME_REQUIRED:"skill.rules.displayname",VARIABLE_NAME_INVALID:"skill.rules.verifydescription",CODE_REQUIRED:"skill.message.codeerror",PYTHON_CODE_REQUIRED:"skill.message.codeerror",NAME_REQUIRED:"skill.message.nameerror",MAIN_FUNCTION_MISSING:"skill.message.mainfunction.missing"};return e[a]||"skill.message.defaulterror"},t=r(85893),Ie=function(a){var e,d,_=a.FourthlyValue,Z=a.Fourthlyref,w=a.handleBack,s=a.Skillinfo,c=a.Operationbentate,Re=a.skillid,Q=a.app_id,ke=a.skillupdata,Fe=a.isCreate,Pe=a.setSkillInfo,re=a.readOnly,ae=re===void 0?!1:re,u=(0,v.useIntl)(),Ne=(0,L.useState)(null),se=f()(Ne,2),te=se[0],Se=se[1],_e=(0,L.useState)(!1),ne=f()(_e,2),Oe=ne[0],z=ne[1],Me=(0,L.useState)(["input"]),ie=f()(Me,2),je=ie[0],le=ie[1],De=(0,L.useState)([]),ue=f()(De,2),oe=ue[0],Ve=ue[1],Ue=(0,L.useState)(!1),de=f()(Ue,2),Ce=de[0],ce=de[1],Te=(0,L.useRef)();(0,L.useEffect)(function(){},[]);var Le=function(){var M=k()(n()().mark(function E(){var I;return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,x.cN)(Q||s.app_id);case 2:I=y.sent,I.code==0?(l.ZP.success(u.formatMessage({id:"skill.publishsuccess"})),Pe(g()(g()({},s),{},{publish_status:1,app_publish_status:1}))):l.ZP.error(u.formatMessage({id:"skill.select.value"}));case 4:case"end":return y.stop()}},E)}));return function(){return M.apply(this,arguments)}}(),Be=function(){var M=k()(n()().mark(function E(I){var h,y,A,X,o,b,H,F;return n()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return z(!0),m.next=3,pe();case 3:if(h=m.sent,!(h===!1||!h||h.code!==0)){m.next=7;break}return z(!1),m.abrupt("return");case 7:return y=h.skill_id||Re||s.id,A=P().cloneDeep((s==null?void 0:s.input_variables)||{}),Object.entries(I).forEach(function(Ze){var K,q,me=f()(Ze,2),$=me[0],fe=me[1];if(A!=null&&(K=A.properties)!==null&&K!==void 0&&(q=K.hasOwnProperty)!==null&&q!==void 0&&q.call(K,$))if(A.properties[$].type==="file"){var O;A.properties[$].value=(O=fe[0])===null||O===void 0||(O=O.response)===null||O===void 0||(O=O.data)===null||O===void 0?void 0:O.file_id}else A.properties[$].value=fe}),X=g()(g()({},s),{},{code:JSON.stringify((s==null?void 0:s.code)||{}),test_input:A}),m.prev=11,console.log("Using skill_id for debug run:",y),m.next=15,(0,x.Ur)({skill_id:y,input_dict:X.test_input});case 15:F=m.sent,l.ZP.success(u.formatMessage({id:"skill.run.success"})),Se((o=F.data)===null||o===void 0?void 0:o.outputs),Ve(((b=F.data)===null||b===void 0?void 0:b.file_list)||[]),ce(!0),le([]),z(!1),(H=F.data)!==null&&H!==void 0&&H.error&&l.ZP.error(u.formatMessage({id:"skill.debug.run.error"},{error:F.data.error})),m.next=31;break;case 25:m.prev=25,m.t0=m.catch(11),z(!1),ce(!1),l.ZP.error(u.formatMessage({id:"skill.debug.run.failed"})),console.error("Skill run error:",m.t0);case 31:case"end":return m.stop()}},E,null,[[11,25]])}));return function(I){return M.apply(this,arguments)}}(),Qe=function(){var M=k()(n()().mark(function E(){return n()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:v.history.push("/Skill?app_id=".concat(Q||(s==null?void 0:s.app_id),"&type=false")),location.reload();case 2:case"end":return h.stop()}},E)}));return function(){return M.apply(this,arguments)}}(),pe=function(){var M=k()(n()().mark(function E(){var I,h,y,A;return n()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(I=be(s),I.isValid){o.next=8;break}if(h=I.errors.filter(function(b){return b.type==="error"}).map(function(b){try{return u.formatMessage({id:Ee(b.code)})}catch(H){return b.message}}),!(h.length>0)){o.next=6;break}return l.ZP.error(u.formatMessage({id:"skill.message.save.failed.validation"},{errors:h.join(`
`)})),o.abrupt("return",!1);case 6:y=I.errors.filter(function(b){return b.type==="warning"}).map(function(b){return b.message}),y.length>0&&l.ZP.warning(u.formatMessage({id:"skill.message.save.failed.warnings"},{warnings:y.join(`
`)}));case 8:return o.prev=8,o.next=11,ke();case 11:return A=o.sent,o.abrupt("return",A);case 15:return o.prev=15,o.t0=o.catch(8),l.ZP.error(u.formatMessage({id:"skill.conserve.failed"})),console.error("Save skill error:",o.t0),o.abrupt("return",!1);case 20:case"end":return o.stop()}},E,null,[[8,15]])}));return function(){return M.apply(this,arguments)}}(),xe=[{key:"input",label:u.formatMessage({id:"skill.inputsetting"}),children:(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:s!=null&&(e=s.input_variables)!==null&&e!==void 0&&e.properties&&Object.keys(s.input_variables.properties).length>0?(0,t.jsxs)(S.A,{formRef:Te,onFinish:Be,submitter:!1,children:[(0,t.jsx)(J.Z,{data:s==null||(d=s.input_variables)===null||d===void 0?void 0:d.properties}),(0,t.jsx)("div",{className:"flex gap-3 mt-6",children:(0,t.jsx)(p.ZP,{type:"primary",htmlType:"submit",loading:Oe,className:"flex-1",children:u.formatMessage({id:"skill.run"})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,t.jsx)(C.Z,{hasHover:!1,icon:"/icons/agent_skill.svg",title:u.formatMessage({id:"skill.debug.title"}),loadingText:u.formatMessage({id:"skill.debug.no.input.parameters"})})})})}];return(0,t.jsxs)("div",{style:{height:"calc(100vh-100px)",width:"100%"},children:[(0,t.jsxs)("div",{className:"flex align-center justify-between my-5 px-4",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[u.formatMessage({id:"skill.operationrun"}),ae&&(0,t.jsxs)("span",{className:"ml-2 text-sm text-gray-500 font-normal",children:["- ",u.formatMessage({id:"readonly.mode"})]})]}),!ae&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(p.ZP,{type:"primary",className:"min-w-24",onClick:pe,children:u.formatMessage({id:"skill.btn.save"})})}),(0,t.jsx)(p.ZP,{type:"primary",onClick:Le,className:"ml-4 min-w-24",children:u.formatMessage({id:"skill.publish"})})]})]}),(0,t.jsxs)("div",{className:"h-[calc(100vh-160px)] overflow-y-auto px-4 relative flex flex-col gap-4",children:[(0,t.jsx)(T.Z,{activeKey:je,onChange:le,items:xe,size:"small",className:"[&_.ant-collapse-content-box]:bg-transparent [&_.ant-collapse-content-box]:p-0"}),Ce&&(0,t.jsxs)("div",{className:" bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-[#555555] text-sm font-medium mb-4",children:u.formatMessage({id:"skill.runpreview"})}),(0,t.jsxs)("div",{className:"min-h-[calc(100vh-400px)] flex flex-col overflow-y-auto",children:[oe.length>0&&(0,t.jsx)("div",{children:(0,t.jsx)(U.Z,{files:oe,title:u.formatMessage({id:"agent.file.output"}),className:"mb-8 !mt-2"})}),(0,t.jsx)("div",{className:"mb-4 h-[calc(100vh-400px)]",children:(0,t.jsx)(Y.Z,{language:"python3",value:te&&te,showMaximize:!1,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:(0,t.jsx)("div",{children:u.formatMessage({id:"skill.debug.output.title"})})})})]})]})]}),(0,t.jsx)("div",{className:"h-[30px] w-1"})]})},Ae=Ie}}]);
