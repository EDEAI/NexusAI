"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[654],{81644:function(q,C,a){a.d(C,{Z:function(){return g}});var U=a(1413),l=a(67294),L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"},E=L,N=a(91146),S=function(Z,w){return l.createElement(N.Z,(0,U.Z)((0,U.Z)({},Z),{},{ref:w,icon:E}))},B=l.forwardRef(S),g=B},24805:function(q,C,a){a.d(C,{Hb:function(){return Z},Ur:function(){return H},cN:function(){return z},ej:function(){return w}});var U=a(15009),l=a.n(U),L=a(99289),E=a.n(L),N=a(47520),S="/v1/skill/skill_info/",B="/v1/skill/skill_update/",g="/v1/skill/skill_publish/",x="/v1/skill/skill_run",Z=function(){var k=E()(l()().mark(function f(i,p){var j;return l()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,N.ZP)("".concat(S).concat(i),{method:"GET",data:{publish_status:p=="true"?1:0}});case 2:return j=R.sent,R.abrupt("return",j);case 4:case"end":return R.stop()}},f)}));return function(i,p){return k.apply(this,arguments)}}(),w=function(){var k=E()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(B).concat(i.app_id),{method:"PUT",data:i.data});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}(),z=function(){var k=E()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(g).concat(i),{method:"PUT"});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}(),H=function(){var k=E()(l()().mark(function f(i){var p;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.ZP)("".concat(x),{method:"POST",data:i});case 2:return p=n.sent,n.abrupt("return",p);case 4:case"end":return n.stop()}},f)}));return function(i){return k.apply(this,arguments)}}()},18449:function(q,C,a){a.d(C,{Z:function(){return Ae}});var U=a(15009),l=a.n(U),L=a(97857),E=a.n(L),N=a(99289),S=a.n(N),B=a(5574),g=a.n(B),x=a(24805),Z=a(37369),w=a(60271),z=a(620),H=a(2216),k=a(34994),f=a(76772),i=a(45360),p=a(28036),j=a(47221),n=a(96486),R=a.n(n),O=a(67294),ve=a(19632),J=a.n(ve),ee=function(r){return r.filter(function(e,d){return r.indexOf(e)!==d})},he=function(r){var e=[];if(!r)return e.push({field:"input_variables",message:"Input variables cannot be empty",type:"error",code:"INPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!r.properties||R().isEmpty(r.properties))return e.push({field:"input_variables.properties",message:"At least one input variable must be defined",type:"error",code:"INPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(r.properties),_=ee(d);return _.length>0&&e.push({field:"input_variables.properties",message:"Duplicate variable names: ".concat(_.join(", ")),type:"error",code:"INPUT_VARIABLES_DUPLICATE"}),Object.entries(r.properties).forEach(function(D){var T=g()(D,2),s=T[0],c=T[1];(!c.name||c.name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"input_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"input_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},ge=function(r){var e=[];if(!r)return e.push({field:"output_variables",message:"Output variables cannot be empty",type:"error",code:"OUTPUT_VARIABLES_REQUIRED"}),{isValid:!1,errors:e};if(!r.properties||R().isEmpty(r.properties))return e.push({field:"output_variables.properties",message:"At least one output variable must be defined",type:"error",code:"OUTPUT_VARIABLES_EMPTY"}),{isValid:!1,errors:e};var d=Object.keys(r.properties),_=ee(d);return _.length>0&&e.push({field:"output_variables.properties",message:"Duplicate variable names: ".concat(_.join(", ")),type:"error",code:"OUTPUT_VARIABLES_DUPLICATE"}),Object.entries(r.properties).forEach(function(D){var T=g()(D,2),s=T[0],c=T[1];(!c.name||c.name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable ".concat(s," name cannot be empty"),type:"error",code:"VARIABLE_NAME_REQUIRED"}),(!c.display_name||c.display_name.trim()==="")&&e.push({field:"output_variables.properties.".concat(s,".display_name"),message:"Variable ".concat(s," display name cannot be empty"),type:"error",code:"VARIABLE_DISPLAY_NAME_REQUIRED"}),c.name&&!/^[a-zA-Z0-9_]+$/.test(c.name)&&e.push({field:"output_variables.properties.".concat(s,".name"),message:"Variable name ".concat(c.name," format is incorrect, can only contain letters, numbers and underscores"),type:"error",code:"VARIABLE_NAME_INVALID"})}),{isValid:e.length===0,errors:e}},we=function(r){var e=[];if(!r||r.trim()==="")return e.push({field:"code",message:"Code cannot be empty",type:"error",code:"CODE_REQUIRED"}),{isValid:!1,errors:e};try{var d=JSON.parse(r);(!d.python3||d.python3.trim()==="")&&e.push({field:"code.python3",message:"Python code cannot be empty",type:"error",code:"PYTHON_CODE_REQUIRED"}),d.python3&&!d.python3.includes("def main(")&&e.push({field:"code.python3",message:"Code must contain main function definition",type:"warning",code:"MAIN_FUNCTION_MISSING"})}catch(_){e.push({field:"code",message:"Code format is incorrect, cannot parse JSON",type:"error",code:"CODE_INVALID_JSON"})}return{isValid:e.length===0,errors:e}},ye=function(r){var e=[];return(!r.name||r.name.trim()==="")&&e.push({field:"name",message:"Skill name cannot be empty",type:"error",code:"NAME_REQUIRED"}),{isValid:e.length===0,errors:e}},be=function(r){var e=[],d=ye(r);e.push.apply(e,J()(d.errors));var _=he(r.input_variables);e.push.apply(e,J()(_.errors));var D=ge(r.output_variables);return e.push.apply(e,J()(D.errors)),{isValid:e.length===0,errors:e}},Ee=function(r){var e={INPUT_VARIABLES_REQUIRED:"skill.message.inputerror1",INPUT_VARIABLES_EMPTY:"skill.message.inputerror1",OUTPUT_VARIABLES_REQUIRED:"skill.message.inputerror2",OUTPUT_VARIABLES_EMPTY:"skill.message.inputerror2",INPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",OUTPUT_VARIABLES_DUPLICATE:"skill.message.inputerror5",VARIABLE_NAME_REQUIRED:"skill.rules.name",VARIABLE_DISPLAY_NAME_REQUIRED:"skill.rules.displayname",VARIABLE_NAME_INVALID:"skill.rules.verifydescription",CODE_REQUIRED:"skill.message.codeerror",PYTHON_CODE_REQUIRED:"skill.message.codeerror",NAME_REQUIRED:"skill.message.nameerror",MAIN_FUNCTION_MISSING:"skill.message.mainfunction.missing"};return e[r]||"skill.message.defaulterror"},t=a(85893),Ie=function(r){var e,d,_=r.FourthlyValue,D=r.Fourthlyref,T=r.handleBack,s=r.Skillinfo,c=r.Operationbentate,Re=r.skillid,Q=r.app_id,ke=r.skillupdata,Fe=r.isCreate,_e=r.setSkillInfo,re=r.readOnly,ae=re===void 0?!1:re,u=(0,f.useIntl)(),Pe=(0,O.useState)(null),se=g()(Pe,2),te=se[0],Ne=se[1],Se=(0,O.useState)(!1),ne=g()(Se,2),Me=ne[0],K=ne[1],je=(0,O.useState)(["input"]),ie=g()(je,2),Oe=ie[0],le=ie[1],Ve=(0,O.useState)([]),ue=g()(Ve,2),oe=ue[0],Ue=ue[1],De=(0,O.useState)(!1),de=g()(De,2),Te=de[0],ce=de[1],Ce=(0,O.useRef)();(0,O.useEffect)(function(){},[]);var Le=function(){var M=S()(l()().mark(function I(){var y;return l()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,x.cN)(Q||s.app_id);case 2:y=h.sent,y.code==0?(i.ZP.success(u.formatMessage({id:"skill.publishsuccess"})),_e(E()(E()({},s),{},{publish_status:1,app_publish_status:1}))):i.ZP.error(u.formatMessage({id:"skill.select.value"}));case 4:case"end":return h.stop()}},I)}));return function(){return M.apply(this,arguments)}}(),Be=function(){var M=S()(l()().mark(function I(y){var v,h,A,W,o,b,$,F;return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log("Form values:",y),K(!0),m.next=4,pe();case 4:if(v=m.sent,!(v===!1||!v||v.code!==0)){m.next=8;break}return K(!1),m.abrupt("return");case 8:return h=v.skill_id||Re||s.id,A=R().cloneDeep((s==null?void 0:s.input_variables)||{}),Object.entries(y).forEach(function(Ze){var G,X,me=g()(Ze,2),Y=me[0],fe=me[1];if(A!=null&&(G=A.properties)!==null&&G!==void 0&&(X=G.hasOwnProperty)!==null&&X!==void 0&&X.call(G,Y))if(A.properties[Y].type==="file"){var P;A.properties[Y].value=(P=fe[0])===null||P===void 0||(P=P.response)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.file_id}else A.properties[Y].value=fe}),W=E()(E()({},s),{},{code:JSON.stringify((s==null?void 0:s.code)||{}),test_input:A}),m.prev=12,console.log("Using skill_id for debug run:",h),m.next=16,(0,x.Ur)({skill_id:h,input_dict:W.test_input});case 16:F=m.sent,i.ZP.success(u.formatMessage({id:"skill.run.success"})),Ne((o=F.data)===null||o===void 0?void 0:o.outputs),Ue(((b=F.data)===null||b===void 0?void 0:b.file_list)||[]),ce(!0),le([]),K(!1),($=F.data)!==null&&$!==void 0&&$.error&&i.ZP.error(u.formatMessage({id:"skill.debug.run.error"},{error:F.data.error})),m.next=32;break;case 26:m.prev=26,m.t0=m.catch(12),K(!1),ce(!1),i.ZP.error(u.formatMessage({id:"skill.debug.run.failed"})),console.error("Skill run error:",m.t0);case 32:case"end":return m.stop()}},I,null,[[12,26]])}));return function(y){return M.apply(this,arguments)}}(),Qe=function(){var M=S()(l()().mark(function I(){return l()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:f.history.push("/Skill?app_id=".concat(Q||(s==null?void 0:s.app_id),"&type=false")),location.reload();case 2:case"end":return v.stop()}},I)}));return function(){return M.apply(this,arguments)}}(),pe=function(){var M=S()(l()().mark(function I(){var y,v,h,A;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(y=be(s),y.isValid){o.next=8;break}if(v=y.errors.filter(function(b){return b.type==="error"}).map(function(b){try{return u.formatMessage({id:Ee(b.code)})}catch($){return b.message}}),!(v.length>0)){o.next=6;break}return i.ZP.error(u.formatMessage({id:"skill.message.save.failed.validation"},{errors:v.join(`
`)})),o.abrupt("return",!1);case 6:h=y.errors.filter(function(b){return b.type==="warning"}).map(function(b){return b.message}),h.length>0&&i.ZP.warning(u.formatMessage({id:"skill.message.save.failed.warnings"},{warnings:h.join(`
`)}));case 8:return o.prev=8,o.next=11,ke();case 11:return A=o.sent,o.abrupt("return",A);case 15:return o.prev=15,o.t0=o.catch(8),i.ZP.error(u.formatMessage({id:"skill.conserve.failed"})),console.error("Save skill error:",o.t0),o.abrupt("return",!1);case 20:case"end":return o.stop()}},I,null,[[8,15]])}));return function(){return M.apply(this,arguments)}}(),xe=[{key:"input",label:u.formatMessage({id:"skill.inputsetting"}),children:(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:s!=null&&(e=s.input_variables)!==null&&e!==void 0&&e.properties&&Object.keys(s.input_variables.properties).length>0?(0,t.jsxs)(k.A,{formRef:Ce,onFinish:Be,submitter:!1,children:[(0,t.jsx)(H.Z,{data:s==null||(d=s.input_variables)===null||d===void 0?void 0:d.properties}),(0,t.jsx)("div",{className:"flex gap-3 mt-6",children:(0,t.jsx)(p.ZP,{type:"primary",htmlType:"submit",loading:Me,className:"flex-1",children:u.formatMessage({id:"skill.run"})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,t.jsx)(w.Z,{hasHover:!1,icon:"/icons/agent_skill.svg",title:u.formatMessage({id:"skill.debug.title"}),loadingText:u.formatMessage({id:"skill.debug.no.input.parameters"})})})})}];return(0,t.jsxs)("div",{style:{height:"calc(100vh-100px)",width:"100%"},children:[(0,t.jsxs)("div",{className:"flex align-center justify-between my-5 px-4",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[u.formatMessage({id:"skill.operationrun"}),ae&&(0,t.jsxs)("span",{className:"ml-2 text-sm text-gray-500 font-normal",children:["- ",u.formatMessage({id:"readonly.mode"})]})]}),!ae&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(p.ZP,{type:"primary",className:"min-w-24",onClick:pe,children:u.formatMessage({id:"skill.btn.save"})})}),(0,t.jsx)(p.ZP,{type:"primary",onClick:Le,className:"ml-4 min-w-24",children:u.formatMessage({id:"skill.publish"})})]})]}),(0,t.jsxs)("div",{className:"h-[calc(100vh-160px)] overflow-y-auto px-4 relative flex flex-col gap-4",children:[(0,t.jsx)(j.Z,{activeKey:Oe,onChange:le,items:xe,size:"small",className:"[&_.ant-collapse-content-box]:bg-transparent [&_.ant-collapse-content-box]:p-0"}),Te&&(0,t.jsxs)("div",{className:" bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-[#555555] text-sm font-medium mb-4",children:u.formatMessage({id:"skill.runpreview"})}),(0,t.jsxs)("div",{className:"min-h-[calc(100vh-400px)] flex flex-col overflow-y-auto",children:[oe.length>0&&(0,t.jsx)("div",{children:(0,t.jsx)(Z.Z,{files:oe,title:u.formatMessage({id:"agent.file.output"}),className:"mb-8 !mt-2"})}),(0,t.jsx)("div",{className:"mb-4 h-[calc(100vh-400px)]",children:(0,t.jsx)(z.Z,{language:"python3",value:te&&te,showMaximize:!1,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:(0,t.jsx)("div",{children:u.formatMessage({id:"skill.debug.output.title"})})})})]})]})]}),(0,t.jsx)("div",{className:"h-[30px] w-1"})]})},Ae=Ie}}]);
