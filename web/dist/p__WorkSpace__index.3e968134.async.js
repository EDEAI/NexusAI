"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[316],{66212:function(ve,K,t){var T=t(1413),F=t(67294),s=t(99011),k=t(91146),M=function(V,P){return F.createElement(k.Z,(0,T.Z)((0,T.Z)({},V),{},{ref:P,icon:s.Z}))},G=F.forwardRef(M);K.Z=G},2068:function(ve,K,t){t.d(K,{Z:function(){return V}});var T=t(1413),F=t(67294),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},k=s,M=t(91146),G=function(z,I){return F.createElement(M.Z,(0,T.Z)((0,T.Z)({},z),{},{ref:I,icon:k}))},W=F.forwardRef(G),V=W},35790:function(ve,K,t){var T=t(1413),F=t(67294),s=t(19369),k=t(91146),M=function(V,P){return F.createElement(k.Z,(0,T.Z)((0,T.Z)({},V),{},{ref:P,icon:s.Z}))},G=F.forwardRef(M);K.Z=G},88864:function(ve,K,t){var T=t(32332),F=t(67294),s=t(85893);K.Z=(0,F.memo)(function(k){var M=k.agentList,G=k.size,W=G===void 0?"sm":G,V=k.rounded,P=V===void 0?!1:V,z=M==null?void 0:M.map(function(ie){return ie.avatar?ie.avatar:(0,T.s9)("single",ie.icon)}),I={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},ue={sm:"w-[47%] h-[47%]",md:"w-[47%] h-[47%]",lg:"w-[47%] h-[47%]"},Y=function(){var se=(z==null?void 0:z.length)||0;if(!se||!z)return(0,s.jsx)("div",{className:"bg-gray-200 w-full h-full ".concat(P?"rounded-full":"")});if(se===1)return(0,s.jsx)("div",{className:"w-full h-full overflow-hidden ".concat(P?"rounded-full":""),children:(0,s.jsx)("img",{src:z[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover"})});if(se===2)return(0,s.jsxs)("div",{className:"w-full h-full flex flex-wrap",children:[(0,s.jsx)("div",{className:"w-1/2 h-full pr-[2%]",children:(0,s.jsx)("img",{src:z[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?"rounded-l-full":"")})}),(0,s.jsx)("div",{className:"w-1/2 h-full pl-[2%]",children:(0,s.jsx)("img",{src:z[1],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?"rounded-r-full":"")})})]});if(se===3)return(0,s.jsxs)("div",{className:"w-full h-full flex flex-wrap",children:[(0,s.jsx)("div",{className:"w-1/2 h-full pr-[2%] flex items-center justify-center",children:(0,s.jsx)("img",{src:z[0],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?"rounded-l-full":"")})}),(0,s.jsxs)("div",{className:"w-1/2 h-full pl-[2%] flex flex-col",children:[(0,s.jsx)("div",{className:"h-1/2 pb-[2%]",children:(0,s.jsx)("img",{src:z[1],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?"rounded-tr-full":"")})}),(0,s.jsx)("div",{className:"h-1/2 pt-[2%]",children:(0,s.jsx)("img",{src:z[2],alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?"rounded-br-full":"")})})]})]});if(se===4)return(0,s.jsx)("div",{className:"w-full h-full flex flex-wrap",children:z.slice(0,4).map(function(A,B){return(0,s.jsx)("div",{className:"".concat(ue[W]," p-[3%] ").concat(B===0?"pl-0 pt-0":B===1?"pr-0 pt-0":B===2?"pl-0 pb-0":"pr-0 pb-0"),children:(0,s.jsx)("img",{src:A,alt:"\u5934\u50CF",className:"w-full h-full object-cover ".concat(P?B===0?"rounded-tl-full":B===1?"rounded-tr-full":B===2?"rounded-bl-full":"rounded-br-full":"")})},B)})});for(var pe=z.slice(0,9),ge=[],ne=0;ne<Math.min(9,pe.length);ne++)ge.push((0,s.jsx)("div",{className:"w-1/3 h-1/3",style:{padding:"1.5%"},children:(0,s.jsx)("img",{src:pe[ne],alt:"\u5934\u50CF",className:"w-full h-full object-cover"})},ne));return(0,s.jsx)("div",{className:"w-full h-full flex flex-wrap",children:ge})};return(0,s.jsx)("div",{className:"".concat(I[W]," overflow-hidden bg-white ").concat(P?"rounded-full":""),children:Y()})})},83961:function(ve,K,t){t.r(K),t.d(K,{default:function(){return ta}});var T=t(56264),F=t(64456),s=t(67294),k=t(15009),M=t.n(k),G=t(99289),W=t.n(G),V=t(97857),P=t.n(V),z=t(5574),I=t.n(z),ue=t(42237),Y=t(29608),ie=t(35790),se=t(11475),pe=t(8751),ge=t(97578),ne=t(77598),A=t(97582),B=t(22638),De=t(3917),be=function(D,u){var y;u===void 0&&(u={});var c=u.defaultPageSize,i=c===void 0?10:c,h=u.defaultCurrent,g=h===void 0?1:h,p=(0,A._T)(u,["defaultPageSize","defaultCurrent"]),Z=(0,De.Z)(D,(0,A.pi)({defaultParams:[{current:g,pageSize:i}],refreshDepsAction:function(){J(1)}},p)),v=Z.params[0]||{},x=v.current,f=x===void 0?1:x,j=v.pageSize,E=j===void 0?i:j,S=((y=Z.data)===null||y===void 0?void 0:y.total)||0,te=(0,s.useMemo)(function(){return Math.ceil(S/E)},[E,S]),R=function($,m){var U=$<=0?1:$,_=m<=0?1:m,ee=Math.ceil(S/_);U>ee&&(U=Math.max(1,ee));var ae=(0,A.CR)(Z.params||[]),b=ae[0],Q=b===void 0?{}:b,a=ae.slice(1);Z.run.apply(Z,(0,A.ev)([(0,A.pi)((0,A.pi)({},Q),{current:U,pageSize:_})],(0,A.CR)(a),!1))},J=function($){R($,E)},C=function($){R(f,$)};return(0,A.pi)((0,A.pi)({},Z),{pagination:{current:f,pageSize:E,total:S,totalPage:te,onChange:(0,B.Z)(R),changeCurrent:(0,B.Z)(J),changePageSize:(0,B.Z)(C)}})},he=be,xe=t(78697),je=t(32332),q=t(35312),we=t(74330),Ze=t(83062),ye=t(32983),Me=t(88864),ze=t(29432),$e=t(72252),fe=t(71471),e=t(85893),Se=function(u){var y=u.iconSrc,c=u.titleText,i=u.pagination,h=u.showTotal,g=h===void 0?!0:h,p=u.titleAfter,Z=p===void 0?null:p,v=(0,q.useIntl)();return(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("img",{src:y,alt:""}),(0,e.jsx)("div",{children:c}),(0,e.jsx)("div",{children:(0,e.jsx)($e.Z,{size:"small",simple:!0,showTotal:function(f,j){return g?"".concat(v.formatMessage({id:"app.workflow.title.1"})).concat(j[0],"-").concat(j[1]).concat(v.formatMessage({id:"app.workflow.title.2"})," / ").concat(v.formatMessage({id:"app.workflow.title.3"})).concat(f," ").concat(v.formatMessage({id:"app.workflow.title.2"})):null},current:i.current,pageSize:i.pageSize,onShowSizeChange:null,total:i.total,onChange:i.onChange})}),Z]})},Ee=function(u){var y,c=u.item;console.log(c);var i=(0,q.useIntl)(),h="/icons/creation/",g="",p="";switch(c.type){case 1:p=i.formatMessage({id:"app.itemHeader.agent"}),g="Agent";break;case 2:p=i.formatMessage({id:"app.itemHeader.chatRoom"}),g="ChatRoom";break;case 3:p=i.formatMessage({id:"app.itemHeader.workFlow"}),g="WorkFlow";break;default:break}return h+=ze.Le[g],(0,e.jsxs)("div",{className:"flex gap-5 shrink-0",children:[(0,e.jsx)("div",{className:"shrink-0",children:((y=c.agents_data)===null||y===void 0?void 0:y.length)>0?(0,e.jsx)(Me.Z,{agentList:c.agents_data,size:"sm"}):(0,e.jsx)(xe.Z,{Image:c.type==2?"/icons/chat_room.svg":(0,je.s9)("single",c.icon),avatar:c.avatar,icon:"".concat(h,".svg")})}),(0,e.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,e.jsx)("div",{className:"text-sm text-[#213044]",children:(0,e.jsx)(fe.Z.Paragraph,{ellipsis:{rows:2,tooltip:c.name},className:"!mb-0",children:c.name})}),(0,e.jsx)("div",{className:"text-xs text-[#999999]",children:p})]})]})},Oe=function(){var D,u,y=(0,Y.Z)(function(o){return o.setDealtWithData}),c=(0,Y.Z)(function(o){return o.prevConfirmDealtWith}),i=(0,Y.Z)(function(o){return o.dealtWithData}),h=(0,Y.Z)(function(o){return o.setRunPanelLogRecord}),g=(0,Y.Z)(function(o){return o.submitPromptId}),p=(0,q.useIntl)(),Z=(0,s.useRef)(null),v=(0,s.useState)(null),x=I()(v,2),f=x[0],j=x[1],E=(0,ge.Z)("pageNumber"),S=I()(E,2),te=S[0],R=S[1],J=function(N){console.log(N),y(N)};(0,ne.Z)(function(){var o=b.list.map(function(N){return N.exec_id==c.exec_id&&(N.need_human_confirm=0),N});Q(P()(P()({},b),{},{list:o}))},[c]);var C=function(){var o=W()(M()().mark(function N(re){var de,r,n;return M()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return de=re.current,r=re.pageSize,w.next=3,(0,ue.VE)({current:de,pageSize:r});case 3:return n=w.sent,w.abrupt("return",{list:n.data.list,success:!0,total:n.data.total_count});case 5:case"end":return w.stop()}},N)}));return function(re){return o.apply(this,arguments)}}(),$=he(C,{defaultPageSize:10}),m=$.data,U=$.loading,_=$.pagination,ee=(0,s.useState)(m),ae=I()(ee,2),b=ae[0],Q=ae[1];(0,s.useEffect)(function(){Q(m)},[m]),(0,ne.Z)(function(){Z.current&&Z.current.reload()},[g]);var a=(0,s.useCallback)(function(o){var N=o.item;return(0,e.jsxs)("div",{className:"flex flex-col gap-1 truncate flex-1",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:N.app_name})," ",(0,e.jsx)(ie.Z,{}),(0,e.jsx)("span",{className:N.need_human_confirm==1?"text-[#1B64F3]":"text-[#808183]",children:N.node_name})]}),(0,e.jsx)("div",{className:"text-[#999999] text-xs truncate",children:N.app_run_name})]})},[b]);return(0,e.jsx)(we.Z,{spinning:U,children:(0,e.jsxs)("div",{className:"min-h-[300px]",style:{height:"calc(100vh - 596px)"},children:[(0,e.jsx)(Se,{iconSrc:"/icons/back_log.svg",titleText:p.formatMessage({id:"app.workflow.backlogs.title"}),pagination:_}),(0,e.jsxs)("div",{className:"bg-white rounded-lg p-2.5 mt-4 overflow-y-auto h-full",style:{boxShadow:" 0px 2px 4px 0px rgba(0,0,0,0.05)"},children:[b==null||(D=b.list)===null||D===void 0?void 0:D.map(function(o,N){return o.type=3,(0,e.jsxs)("div",{onClick:function(){console.log(o),o.need_human_confirm&&(y(o),j(o),h(!1))},className:"flex items-center gap-5 cursor-pointer duration-200 rounded-lg  p-2.5 hover:bg-[#fafafa]",children:[(0,e.jsx)(xe.Z,{Image:(0,je.s9)("single",o.icon),avatar:o.avatar}),(0,e.jsx)(a,{item:o}),(0,e.jsx)("div",{children:o.need_human_confirm?(0,e.jsx)(Ze.Z,{title:p.formatMessage({id:"workflow.needHumanConfirm"}),children:(0,e.jsx)(se.Z,{className:"text-[#1B64F3]"})}):(0,e.jsx)(Ze.Z,{title:p.formatMessage({id:"workflow.noHumanConfirm"}),children:(0,e.jsx)(pe.Z,{className:"text-[#52C41C]"})})})]},o.exec_id)}),!U&&(b==null||(u=b.list)===null||u===void 0?void 0:u.length)===0&&(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:"/images/empty.svg",description:p.formatMessage({id:"app.workflow.backlogs.empty"})})})]})]})})},_e=t(29933),Te=t(4393),la=Te.Z.Meta,Fe=function(){var D,u,y=(0,q.useIntl)(),c=function(x){console.log(x);var f=x.app_id||x.apps_id;switch(x.type){case 1:q.history.push("/Agents?app_id=".concat(f));break;case 2:q.history.push("/chat_room/".concat(x.chatroom_id));break;case 3:q.history.push("/workspace/workflow?app_id=".concat(f));break;default:break}},i=function(){var v=W()(M()().mark(function x(f){var j,E,S;return M()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return j=f.current,E=f.pageSize,R.next=3,(0,ue.vu)({current:j,pageSize:E});case 3:return S=R.sent,R.abrupt("return",{list:S.data.list,success:!0,total:S.data.total_count});case 5:case"end":return R.stop()}},x)}));return function(f){return v.apply(this,arguments)}}(),h=he(i,{defaultPageSize:8}),g=h.data,p=h.loading,Z=h.pagination;return console.log(p),(0,e.jsxs)("div",{className:"flex-grow-0",children:[(0,e.jsx)(Se,{iconSrc:"/icons/recently_active.svg",titleText:y.formatMessage({id:"app.workflow.ra.title"}),pagination:Z}),(0,e.jsx)("div",{className:"grid grid-cols-4  gap-4 mt-4",children:g==null||(D=g.list)===null||D===void 0?void 0:D.map(function(v,x){var f=v.type==3?v.process_name:v.last_agent_name;return(0,e.jsx)(_e.Z,{className:"h-[160px] cursor-pointer transition shadow-lg shadow-gray-100 hover:shadow-gray-200",title:(0,e.jsx)(Ee,{item:v}),onClick:function(){return c(v)},bodyStyle:{padding:"15px 20px"},children:(0,e.jsx)(fe.Z.Paragraph,{ellipsis:{rows:2,tooltip:f},children:f})},v.app_id)})}),!(g!=null&&(u=g.list)!==null&&u!==void 0&&u.length)&&(0,e.jsxs)("div",{className:"h-[400px] w-full flex items-center justify-center",children:[!p&&(0,e.jsx)(ye.Z,{imageStyle:{display:"flex",justifyContent:"center"},image:"/images/empty.svg",description:y.formatMessage({id:"app.workflow.ra.empty"})}),(0,e.jsx)(we.Z,{spinning:p})]})]})},Ie=t(37369),Le=t(43722),ke=t(39873),We=t(28508),me=t(66309),Ae=t(28036),oe=t(26412),Ce=t(22683),Ne=t(97807),Be=t(86),Pe=t(38027),Ue=(0,s.memo)(function(D){var u,y,c,i,h,g,p,Z,v,x,f,j,E,S,te,R,J,C=D.data,$=D.onClose,m=(0,q.useIntl)(),U=(0,s.useState)(500),_=I()(U,2),ee=_[0],ae=_[1],b=(0,Y.Z)(function(r){return r.setRunPanelLogRecord}),Q=(0,De.Z)(function(){var r=W()(M()().mark(function n(d,w){var l;return M()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,Le.Gh)({chatroom_id:d,app_run_id:w});case 2:return l=O.sent,O.abrupt("return",l.data);case 4:case"end":return O.stop()}},n)}));return function(n,d){return r.apply(this,arguments)}}(),{manual:!0}),a=Q.data,o=Q.loading,N=Q.run;(0,s.useEffect)(function(){C!=null&&C.chatroom_id&&C!==null&&C!==void 0&&C.app_run_id&&N(C.chatroom_id,C.app_run_id)},[C==null?void 0:C.chatroom_id,C==null?void 0:C.app_run_id,N]);var re=function(n){var d={1:{color:"processing",text:m.formatMessage({id:"workflow.running"})},2:{color:"success",text:m.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:m.formatMessage({id:"workflow.runF"})}},w=d[n]||{color:"default",text:"Unknown"};return(0,e.jsx)(me.Z,{color:w.color,children:w.text})},de=function(n){ae(n)};return(0,e.jsx)(ke.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:ee,onChange:de,children:(0,e.jsx)(_e.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,e.jsx)(Ae.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:$,icon:(0,e.jsx)(We.Z,{})}),title:(0,e.jsx)(fe.Z.Title,{level:5,children:m.formatMessage({id:"app.chatroom.log.title"})}),loading:o,children:(0,e.jsx)("div",{className:"space-y-6",children:o?(0,e.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,e.jsx)(we.Z,{})}):a!=null&&a.source_run?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(oe.Z,{column:1,bordered:!0,size:"small",children:[(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"app.chatroom.log.name"}),children:a.source_run.name}),(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"workflow.created_time"}),children:a.source_run.created_time}),(0,e.jsx)(oe.Z.Item,{label:m.formatMessage({id:"workflow.finished_time"}),children:a.source_run.finished_time}),(0,e.jsxs)(oe.Z.Item,{label:m.formatMessage({id:"workflow.elapsed_time"}),children:[a.source_run.elapsed_time,"s"]}),(0,e.jsx)(oe.Z.Item,{label:"Tokens",children:a.source_run.total_tokens})]}),(0,e.jsxs)("div",{className:"mt-4",children:[(0,e.jsx)(fe.Z.Title,{level:5,children:"\u8BA8\u8BBA\u603B\u7ED3"}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:a.source_run.created_time}),(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] bg-gray-50 rounded mt-2",children:(0,e.jsx)(Ce.U,{rehypePlugins:[Ne.Z],children:a==null||(u=a.source_run)===null||u===void 0?void 0:u.summary})})})]}),a!=null&&a.source_corrections&&(a==null?void 0:a.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),a==null?void 0:a.source_corrections.map(function(r,n){return(0,e.jsx)("div",{className:"mb-[16px] last-of-type:mb-0",children:(0,e.jsx)("div",{className:"rounded-[4px]  ".concat((a==null?void 0:a.source_corrections.length)-1!=n?"bg-[#F7F7F7]":"bg-blue-100"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",r.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),": ",r.created_time]}),(0,e.jsx)(Ce.U,{rehypePlugins:[Ne.Z],children:r==null?void 0:r.corrected_summary})]})})},r.created_time)})]}):(0,e.jsx)(e.Fragment,{}),a!=null&&a.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:a!=null&&(y=a.target_run)!==null&&y!==void 0&&y.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:a==null||(c=a.target_run)===null||c===void 0||(c=c.app)===null||c===void 0?void 0:c.name})]})}),(0,e.jsx)("div",{children:a!=null&&(i=a.target_run)!==null&&i!==void 0&&(i=i.inputs)!==null&&i!==void 0&&i.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[m.formatMessage({id:"app.summaryhistory.input"}),":"]}),(0,Pe.vw)(a==null||(h=a.target_run)===null||h===void 0||(h=h.inputs)===null||h===void 0?void 0:h.properties).map(function(r){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:r.display_name||r.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:r.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:a!=null&&(g=a.target_run)!==null&&g!==void 0&&g.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[m.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:a==null||(p=a.target_run)===null||p===void 0?void 0:p.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(a==null||(Z=a.target_run)===null||Z===void 0?void 0:Z.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(Ce.U,{rehypePlugins:[Ne.Z],children:a==null||(v=a.target_run)===null||v===void 0||(v=v.outputs)===null||v===void 0?void 0:v.value})}):(0,e.jsx)(Be.Z,{status:a==null||(x=a.target_run)===null||x===void 0?void 0:x.status,icon:a==null||(f=a.target_run)===null||f===void 0?void 0:f.icon,title:a==null||(j=a.target_run)===null||j===void 0?void 0:j.name,textDetails:(0,e.jsx)(Pe.p1,{progressObj:{created_time:a==null||(E=a.target_run)===null||E===void 0?void 0:E.created_time,elapsed_time:a==null||(S=a.target_run)===null||S===void 0?void 0:S.elapsed_time,app_name:a==null||(te=a.target_run)===null||te===void 0?void 0:te.app.name,status:a==null||(R=a.target_run)===null||R===void 0?void 0:R.status}}),handleClick:function(){var n,d,w,l,H,O,X,le,L,ce;b({app_id:a==null||(n=a.target_run)===null||n===void 0||(n=n.app)===null||n===void 0?void 0:n.id,app_name:a==null||(d=a.target_run)===null||d===void 0||(d=d.app)===null||d===void 0?void 0:d.name,icon:a==null||(w=a.target_run)===null||w===void 0?void 0:w.icon,workflow_id:a==null||(l=a.target_run)===null||l===void 0?void 0:l.workflow_id,type:2,app_run_id:a==null||(H=a.target_run)===null||H===void 0?void 0:H.id,run_name:a==null||(O=a.target_run)===null||O===void 0?void 0:O.name,status:a==null||(X=a.target_run)===null||X===void 0?void 0:X.status,created_time:a==null||(le=a.target_run)===null||le===void 0?void 0:le.created_time,elapsed_time:a==null||(L=a.target_run)===null||L===void 0?void 0:L.elapsed_time,completed_progress:"".concat(a==null||(ce=a.target_run)===null||ce===void 0?void 0:ce.percentage,"%")})},progress:a==null||(J=a.target_run)===null||J===void 0?void 0:J.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]}):null})})})}),He=t(4730),Ke=t(66212),Ge=t(88284),Ve=t(28058),Ye=t(2068),Je=t(44720),Qe=t(38703),Xe=t(55241),qe=t(34041),ea=(0,s.memo)(function(){var D,u,y=(0,Y.Z)(function(r){return r.setDealtWithData}),c=(0,Y.Z)(function(r){return r.setRunPanelLogRecord}),i=(0,q.useIntl)(),h=(0,s.useState)(0),g=I()(h,2),p=g[0],Z=g[1],v=function(n){var d=n.text;switch(d){case 1:return(0,e.jsx)(Ke.Z,{className:"text-blue-500"});case 2:return(0,e.jsx)(Ge.Z,{className:"text-green-500"});case 3:return(0,e.jsx)(Ve.Z,{className:"text-red-500"})}return(0,e.jsx)("span",{children:d})},x=function(){var r=W()(M()().mark(function n(d){var w,l,H,O,X;return M()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return w=d.current,l=d.pageSize,H=d.showStatus,O=H===void 0?0:H,L.next=3,(0,ue.PE)({current:w,pageSize:l,showStatus:O});case 3:return X=L.sent,L.abrupt("return",{list:X.data.list,success:!0,total:X.data.total_count});case 5:case"end":return L.stop()}},n)}));return function(d){return r.apply(this,arguments)}}(),f=he(function(r){var n=r.current,d=r.pageSize;return x({current:n,pageSize:d,showStatus:p})},{defaultPageSize:10,refreshDeps:[p]}),j=f.data,E=f.loading,S=f.pagination,te=f.run,R=(0,s.useState)(!1),J=I()(R,2),C=J[0],$=J[1],m=(0,s.useState)(null),U=I()(m,2),_=U[0],ee=U[1],ae=(0,s.useState)(!1),b=I()(ae,2),Q=b[0],a=b[1],o=function(){$(!1),a(!1)},N=function(n){switch(n.show_status){case 1:ee(n),$(!1),a(!0);break;case 2:ee(n),a(!1),$(!0);break;case 3:c(n),y(null);break;default:break}},re=function(n){var d=n.type;switch(d){case 1:return(0,e.jsx)(me.Z,{color:"blue",children:i.formatMessage({id:"app.workflow.log.type.roundtable"})});case 2:return(0,e.jsx)(me.Z,{color:"green",children:i.formatMessage({id:"app.workflow.log.type.agent"})});case 3:return(0,e.jsx)(me.Z,{color:"purple",children:i.formatMessage({id:"app.workflow.log.type.workflow"})})}},de=(0,s.memo)(function(r){var n,d,w,l=r.item,H=l.status==1?"#1B64F3":l.status==2?"#22C55F":"#F04444",O=l.status==1?"#f9fafe":l.status==2?"#f6fcf3":"#fafafa",X=(0,s.useRef)(null),le=(0,Je.Z)(X),L=function(){return l.show_status==1?l.chat_room_name:l.show_status==2?l.app_runs_name:l.show_status==3?l.associated_chat_room_name!=""?i.formatMessage({id:"app.workflow.log.roundtable.guidance"},{name:l.associated_chat_room_name}):l.app_runs_name:l.apps_name},ce=function(){return l.show_status==1&&l.apps_name?i.formatMessage({id:"app.workflow.log.guidance.execution"},{type:l.model==1?i.formatMessage({id:"app.workflow.log.type.agent.simple"}):i.formatMessage({id:"app.workflow.log.type.workflow.simple"}),name:l.apps_name}):l.apps_name};return(0,e.jsxs)("div",{onClick:function(){N(l)},ref:X,className:"flex relative rounded truncate gap-5  items-center shrink-0 cursor-pointer duration-200  box-border py-2.5 pr-5 ",children:[(0,e.jsx)("div",{style:{backgroundColor:le?O:"",width:le?"".concat(l.completed_steps/l.total_steps*100,"%"):"0%",transition:"0.5s"},className:"w-full h-full absolute left-0 duration-500"}),(0,e.jsx)("div",{style:{backgroundColor:H},className:"w-[4px] h-full z-10 mr-[10px] absolute"}),(0,e.jsx)("div",{className:"ml-5",children:((n=l.agents_data)===null||n===void 0?void 0:n.length)>0?(0,e.jsx)("div",{className:"ml-2",children:(0,e.jsx)(Me.Z,{agentList:l.agents_data,size:"sm"})}):(0,e.jsx)(xe.Z,{Image:(0,je.s9)("single",l.icon),avatar:l.avatar})}),(0,e.jsxs)("div",{className:"flex flex-col gap-1 truncate flex-1  z-10",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("span",{children:[(0,e.jsx)(re,{type:l.show_status}),(0,e.jsx)(L,{})]})}),(0,e.jsx)("div",{className:"text-[#999999] text-xs truncate  max-w-7/8",children:(0,e.jsxs)("div",{className:"flex items-center truncate",children:[(0,e.jsxs)("span",{children:[" ",l.created_time," "]}),(0,e.jsx)("span",{style:{maxWidth:"calc(100% - 200px)"},className:"truncate ml-2 ",children:(0,e.jsx)(ce,{})}),(l.show_status==3||l.show_status==2)&&(0,e.jsxs)("span",{className:"inline-flex items-center ml-2 gap-2",children:[(0,e.jsx)("span",{style:{backgroundColor:H},className:"inline-block w-1 h-1 rounded-sm"}),(d=l.elapsed_time)===null||d===void 0?void 0:d.toFixed(6),"S"]})]})})]}),l.total_steps!=l.completed_steps&&(0,e.jsx)("div",{className:"flex items-center justify-center",children:(0,e.jsx)(Qe.Z,{type:"circle",size:30,percent:parseInt(l.completed_steps/l.total_steps*100)})}),l.show_status==3&&(l==null||(w=l.file_list)===null||w===void 0?void 0:w.length)>0&&(0,e.jsx)("div",{className:"flex items-center justify-center z-20",children:(0,e.jsx)(Xe.Z,{content:(0,e.jsx)(Ie.Z,{files:l==null?void 0:l.file_list}),placement:"leftTop",title:i.formatMessage({id:"app.workflow.log.output.files"}),children:(0,e.jsx)(Ye.Z,{className:"text-[22px] text-green-600"})})})]},l.app_run_id)});return(0,e.jsxs)("div",{className:"min-h-[300px]",style:{height:"calc(100vh - 596px)"},children:[(0,e.jsx)(Se,{iconSrc:"/icons/workflows.svg",titleText:i.formatMessage({id:"app.workflow.log.title"}),pagination:S,showTotal:!1,titleAfter:(0,e.jsx)("div",{className:"flex-1 flex justify-end",children:(0,e.jsx)(qe.Z,{defaultValue:0,className:"w-full max-w-[120px]",allowClear:!0,style:{maxWidth:"120px"},onChange:function(n){var d;Z(n),(d=S.onChange)===null||d===void 0||d.call(S,1,S.pageSize)},size:"small",options:[{label:i.formatMessage({id:"app.workflow.log.filter.all"}),value:0},{label:i.formatMessage({id:"app.workflow.log.filter.roundtable"}),value:1},{label:i.formatMessage({id:"app.workflow.log.filter.agent"}),value:2},{label:i.formatMessage({id:"app.workflow.log.filter.workflow"}),value:3}]})})}),(0,e.jsxs)("div",{className:"bg-white rounded-lg p-4 h-full mt-4 overflow-y-auto box-border relative flex flex-col gap-5",style:{boxShadow:" 0px 2px 4px 0px rgba(0,0,0,0.05)"},children:[j==null||(D=j.list)===null||D===void 0?void 0:D.map(function(r,n){return(0,e.jsx)(de,{item:r})}),!E&&(j==null||(u=j.list)===null||u===void 0?void 0:u.length)===0&&(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:"/images/empty.svg",description:i.formatMessage({id:"app.workflow.log.empty"})})})]}),C&&(_==null?void 0:_.app_run_id)&&(0,e.jsx)(He.Z,{data:_,onClose:o}),Q&&(0,e.jsx)(Ue,{data:{chatroom_id:_==null?void 0:_.chatroom_id,app_run_id:_==null?void 0:_.app_run_id},onClose:o})]})}),aa=function(){return(0,e.jsxs)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full p-[30px] flex flex-col gap-6 overflow-x-auto box-border",children:[(0,e.jsx)(Fe,{}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-6 flex-1",children:[(0,e.jsx)(Oe,{}),(0,e.jsx)(ea,{})]}),(0,e.jsx)(T.$_,{}),(0,e.jsx)(F.Z,{})]})},ta=aa}}]);
