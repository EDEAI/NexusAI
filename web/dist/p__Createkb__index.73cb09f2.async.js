"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1734],{82826:function(Oe,Se,l){l.d(Se,{Z:function(){return c}});var xe=l(1413),p=l(67294),Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},oe=Ne,A=l(91146),re=function(x,E){return p.createElement(A.Z,(0,xe.Z)((0,xe.Z)({},x),{},{ref:E,icon:oe}))},Ee=p.forwardRef(re),c=Ee},83510:function(Oe,Se,l){l.d(Se,{LK:function(){return d},bs:function(){return T},go:function(){return t},uy:function(){return v}});var xe=l(15009),p=l.n(xe),Ne=l(99289),oe=l.n(Ne),A=l(47520),re="/v1/apps/apps_list",Ee="/v1/agent/agent_delete/",c="/v1/workflow/workflow_app_delete/",Pe="/v1/vector/delete_dataset/",x="/v1/skill/delete_skill_by_app_id/",E="/v1/apps/apps_create",r="/v1/apps/app_update/",t=function(){var ce=oe()(p()().mark(function Q(U){var ae;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(re),{method:"GET",data:U});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},Q)}));return function(U){return ce.apply(this,arguments)}}(),d=function(){var ce=oe()(p()().mark(function Q(U){var ae;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(U),e.next=3,U.mode;case 3:if(e.t0=e.sent,e.t0!=1){e.next=8;break}e.t1=(0,A.ZP)("".concat(Ee).concat(U.app_id),{method:"DELETE"}),e.next=9;break;case 8:e.t1=U.mode==2?(0,A.ZP)("".concat(c).concat(U.app_id),{method:"DELETE"}):U.mode==3?(0,A.ZP)("".concat(Pe).concat(U.app_id),{method:"DELETE"}):(0,A.ZP)("".concat(x).concat(U.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return ae=e.t1,e.abrupt("return",ae);case 11:case"end":return e.stop()}},Q)}));return function(U){return ce.apply(this,arguments)}}(),v=function(){var ce=oe()(p()().mark(function Q(U){var ae;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(E),{method:"POST",data:U});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},Q)}));return function(U){return ce.apply(this,arguments)}}(),T=function(){var ce=oe()(p()().mark(function Q(U){var ae;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(r).concat(U.app_id),{method:"PUT",data:U});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},Q)}));return function(U){return ce.apply(this,arguments)}}()},51845:function(Oe,Se,l){l.r(Se),l.d(Se,{default:function(){return oa}});var xe=l(5574),p=l.n(xe),Ne=l(32332),oe=l(82826),A=l(76772),re=l(28036),Ee=l(33456),c=l(67294),Pe=l(97857),x=l.n(Pe),E=l(15009),r=l.n(E),t=l(99289),d=l.n(t),v=l(83065),T=l(45360),ce=l(71230),Q=l(15746),U=l(4393),ae=l(26915),ye=l(86842),e=l(85893),De=1,Ue=function(u){var o=u.createkbInfo,a=(0,A.useIntl)(),i=[{title:a.formatMessage({id:"createkb.text",defaultMessage:""}),dataIndex:"input",ellipsis:!0},{title:a.formatMessage({id:"createkb.recallParagraph",defaultMessage:""}),dataIndex:"document_segment_num",width:"15%"},{title:a.formatMessage({id:"createkb.time",defaultMessage:""}),dataIndex:"created_time",width:"25%"}],s=(0,c.useState)([]),L=p()(s,2),C=L[0],P=L[1],se=(0,c.useState)(null),ie=p()(se,2),K=ie[0],Z=ie[1],G=(0,c.useState)(null),D=p()(G,2),F=D[0],de=D[1],V=(0,c.useState)([]),me=p()(V,2),ge=me[0],ne=me[1],ue=(0,c.useState)(!1),ve=p()(ue,2),W=ve[0],q=ve[1],z=(0,c.useState)(""),j=p()(z,2),ee=j[0],I=j[1],B=(0,c.useRef)(null),le=(0,c.useState)(0),J=p()(le,2),be=J[0],Me=J[1],Le=(0,c.useState)(1),Ce=p()(Le,2),ke=Ce[0],je=Ce[1],te=function(){var S=d()(r()().mark(function m(){var R;return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(ee==""){h.next=11;break}return q(!0),ne([]),h.next=5,(0,v.I9)({user_input:ee},o.app_id);case 5:R=h.sent,R.code==0?(R.data.data.length<=0&&T.ZP.error(a.formatMessage({id:"createkb.saveSuccess",defaultMessage:""})),ne(R.data.data)):T.ZP.error(R.detail),q(!1),k(),h.next=14;break;case 11:q(!1),ne([]),T.ZP.error(a.formatMessage({id:"createkb.testInput",defaultMessage:""}));case 14:case"end":return h.stop()}},m)}));return function(){return S.apply(this,arguments)}}(),M=function(){var S=d()(r()().mark(function m(R){return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:I(R.target.value);case 1:case"end":return h.stop()}},m)}));return function(R){return S.apply(this,arguments)}}(),_=function(m){De=m,k()},$=function(){var S=d()(r()().mark(function m(R){var w;return r()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return q(!0),pe.next=3,(0,v.gk)(R.id);case 3:w=pe.sent,w.code==0?ne(w.data.data):T.ZP.error(w.detail),q(!1),I(R.input);case 7:case"end":return pe.stop()}},m)}));return function(R){return S.apply(this,arguments)}}(),k=function(){var S=d()(r()().mark(function m(){var R,w,h=arguments;return r()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return R=h.length>0&&h[0]!==void 0?h[0]:De,he.next=3,(0,v.yC)({page:R},o.app_id);case 3:w=he.sent,w.code==0&&(P(w.data.data),de(w.data));case 5:case"end":return he.stop()}},m)}));return function(){return S.apply(this,arguments)}}(),fe=function(){var S=d()(r()().mark(function m(){var R,w,h,pe,he=arguments;return r()().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return R=he.length>0&&he[0]!==void 0?he[0]:1,w={app_id:o.app_id},Fe.next=4,(0,v.SH)(w);case 4:h=Fe.sent,h.code==0&&(pe=h.data.data.map(function(Ze,ut){return x()(x()({},Ze),{},{statusText:Ze.status==1?a.formatMessage({id:"createkb.normal",defaultMessage:""}):Ze.status==2?a.formatMessage({id:"createkb.disabled",defaultMessage:""}):a.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),console.log(h),Z(h.data));case 6:case"end":return Fe.stop()}},m)}));return function(){return S.apply(this,arguments)}}();return(0,c.useEffect)(function(){k(),fe(),setTimeout(function(){B.current&&Me(B.current.offsetHeight-55-82)},200),o.app_id&&je(o.type?2:1)},[]),(0,e.jsx)(e.Fragment,{children:F!=null?(0,e.jsxs)("div",{className:"h-full pb-[30px]",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:ke==2?(0,A.getLocale)()=="zh-CN"?K?K.dataset_detail.nickname+a.formatMessage({id:"createkb.knowledge.base.of"}):a.formatMessage({id:"createkb.knowledge.base.of"}):K?a.formatMessage({id:"createkb.knowledge.base.of"})+K.dataset_detail.nickname:a.formatMessage({id:"createkb.knowledge.base.of"}):ke==1?a.formatMessage({id:"createkb.editKB"}):a.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"flex w-full",style:{height:"calc(100% - 84px)"},children:(0,e.jsxs)(ce.Z,{gutter:0,style:{marginRight:"0px",marginLeft:"0px"},children:[(0,e.jsx)(Q.Z,{className:"pb-[30px] h-2/4",span:24,children:(0,e.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,e.jsx)("div",{className:"mb-5 text-[#555555] text-sm font-medium",children:a.formatMessage({id:"createkb.recallTest",defaultMessage:""})}),(0,e.jsxs)("div",{className:"w-full px-[15px] py-[15px] border-[#EEEEEE] rounded-lg bg-[#F7F7F7] flex-1 min-h-0",children:[(0,e.jsx)("div",{className:" overflow-y-auto",style:{height:"calc(100% - 65px)"},children:(0,e.jsx)(ce.Z,{gutter:[15,15],className:"w-full",children:ge.map(function(S,m){var R=(S.score*1).toFixed(4),w=S.reranking_score>0?(S.reranking_score*1).toFixed(4):0;return(0,e.jsx)(Q.Z,{className:"gutter-row w-full",span:24,children:(0,e.jsx)(U.Z,{activeTabKey:S.id,size:"small",children:(0,e.jsxs)("div",{className:"w-full bg-white  font-normal text-[12px] rounded-lg",children:[(0,e.jsx)("div",{className:"break-all text-[#213044] leading-[17px]",children:S.content}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",a.formatMessage({id:"createkb.source",defaultMessage:""}),"\uFF1A ",S.name]}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px]  leading-[17px]",children:[" ",a.formatMessage({id:"createkb.matchScore"}),"\uFF1A ",R]}),w==0?"":(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",a.formatMessage({id:"createkb.sortScore"}),"\uFF1A ",w]})]})})},S.id)})})}),(0,e.jsxs)("div",{className:"bg-white flex items-center rounded-lg mt-[15px] p-[10px]",children:[(0,e.jsx)(ae.Z,{className:" custom-textarea",onChange:M,variant:"borderless",placeholder:a.formatMessage({id:"createkb.briefText"}),maxLength:200,showCount:!0,value:ee,onPressEnter:te}),(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsx)(re.ZP,{type:"primary",loading:W,onClick:te,style:{background:"rgba(27,100,243,.1)"},className:"w-[30px] h-[30px] rounded-md flex justify-center items-center p-0",children:W?"":(0,e.jsx)("img",{src:"/icons/fs.svg",className:"w-4 h-4"})})})]})]})]})}),(0,e.jsx)("div",{className:"h-2/4",ref:B,children:(0,e.jsx)(Q.Z,{span:24,children:(0,e.jsxs)("div",{className:"w-full h-full",children:[(0,e.jsx)("div",{className:" mb-[20px] text-[#555555] text-sm font-medium",children:a.formatMessage({id:"createkb.recentQuery"})}),(0,e.jsx)("div",{className:"w-[900px] rounded-md border-[#eeeeee] border rounded-lg",children:(0,e.jsx)(ye.Z,{rowKey:"id",columns:i,dataSource:C,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:a.formatMessage({id:"createkb.no.data.available"})})})},pagination:{pageSize:F.paging_information.page_size,total:F.paging_information.total_count,onChange:_,style:{margin:"0px",marginTop:"10px"},hideOnSinglePage:!0},onRow:function(m,R){return{onClick:function(){return $(m)},style:{cursor:"pointer"}}},scroll:be!=0?{y:be}:{}})})]})})})]})})]}):""})},pt=Ue,mt=l(83510),gt=l(40741),Re=l(72269),ht=l(74330),xt=function(u){var o=u.createkbInfo,a=u.fun,i=(0,A.useIntl)(),s=(0,c.useState)(null),L=p()(s,2),C=L[0],P=L[1],se=(0,c.useState)(!1),ie=p()(se,2),K=ie[0],Z=ie[1],G=(0,c.useState)(1),D=p()(G,2),F=D[0],de=D[1],V=(0,c.useState)(1),me=p()(V,2),ge=me[0],ne=me[1],ue=(0,c.useState)(null),ve=p()(ue,2),W=ve[0],q=ve[1],z=(0,c.useState)(null),j=p()(z,2),ee=j[0],I=j[1],B=(0,c.useState)(1),le=p()(B,2),J=le[0],be=le[1],Me=function(_){o.type||de(_)},Le=function(_){ne(_==!0?1:0)},Ce=function(){a({type:"return"})},ke=function(){var M=d()(r()().mark(function _(){var $,k,fe;return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(Z(!0),o.app_id){m.next=11;break}return m.next=4,(0,mt.uy)((0,Ne.Go)("GET"));case 4:if($=m.sent,$.code!=0){m.next=9;break}a({type:"set",data:$.data.app_id}),m.next=11;break;case 9:return T.ZP.error(i.formatMessage({id:"createkb.creationFailed",defaultMessage:""})),m.abrupt("return");case 11:return k={app_id:o.app_id,name:C.name,description:C.description,public:ge,mode:F},m.next=14,(0,v._W)(k);case 14:fe=m.sent,fe.code==0?(T.ZP.success(i.formatMessage({id:"createkb.setupSuccess",defaultMessage:""})),setTimeout(function(){a({type:"next",data:"2"}),Z(!1)},1e3)):(T.ZP.error(i.formatMessage({id:"createkb.settingFailed",defaultMessage:""})),Z(!1));case 16:case"end":return m.stop()}},_)}));return function(){return M.apply(this,arguments)}}(),je=function(){var M=d()(r()().mark(function _(){var $,k,fe=arguments;return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return $=fe.length>0&&fe[0]!==void 0?fe[0]:1,m.next=3,(0,v.SH)({app_id:o.app_id,page:$,page_size:10,name:""});case 3:k=m.sent,k.code==0&&(ne(k.data.dataset_detail.is_public),de(k.data.dataset_detail.mode),I(k.data.dataset_detail.embedding_model_config_id),P({name:k.data.dataset_detail.name,description:k.data.dataset_detail.description,nickname:k.data.dataset_detail.nickname}),te(k.data.dataset_detail.embedding_model_config_id));case 5:case"end":return m.stop()}},_)}));return function(){return M.apply(this,arguments)}}(),te=function(){var M=d()(r()().mark(function _($){var k;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(0,v.Ue)($);case 2:k=S.sent,k.code==0&&q(k.data.data);case 4:case"end":return S.stop()}},_)}));return function($){return M.apply(this,arguments)}}();return(0,c.useEffect)(function(){o.app_id?(be(o.type?2:1),je()):(te(0),P({name:o.name,description:o.description}),be(3))},[]),(0,e.jsx)(e.Fragment,{children:C!=null?(0,e.jsxs)("div",{className:"bg-white h-full flex flex-col w-full relative",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:J==2?(0,A.getLocale)()=="zh-CN"?C.nickname+i.formatMessage({id:"createkb.knowledge.base.of"}):i.formatMessage({id:"createkb.knowledge.base.of"})+C.nickname:J==1?i.formatMessage({id:"createkb.editKB",defaultMessage:""}):i.formatMessage({id:"createkb.createKnowledgeBase",defaultMessage:""})})]}),(0,e.jsx)("div",{className:" pb-[30px] bg-white flex-1",children:(0,e.jsx)(ce.Z,{className:"h-full",children:(0,e.jsxs)(Q.Z,{span:24,className:"flex flex-col justify-between",children:[(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:i.formatMessage({id:"createkb.settings",defaultMessage:""})}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsxs)(gt.Z,{layout:"vertical",children:[(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:i.formatMessage({id:"createkb.name",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:C.name}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:i.formatMessage({id:"createkb.desc",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:C.description}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:i.formatMessage({id:"createkb.teamVisible",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px]",children:(0,e.jsx)(Re.Z,{onChange:Le,checked:ge===1,size:"small",disabled:o.type})}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:i.formatMessage({id:"createkb.modelSelect"})})]}),(0,e.jsx)("div",{className:"flex items-center mt-[15px]",children:(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)(U.Z,{onClick:function(){Me(1)},size:"small",className:F==1?"bg-[#FFFFFF]":"bg-[#F7F7F7]",style:{minWidth:"440px",cursor:o.type?"not-allowed":"pointer",borderColor:F==1?"#1B64F3":""},styles:{body:{padding:"15px"}},children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("p",{className:"pb-[15px] border-b border-[#EEEEEE] flex items-center",children:[(0,e.jsx)("img",{src:F==1?"/icons/online_select.svg":"/icons/online.svg",className:"w-4 h-4 "}),(0,e.jsx)("span",{className:F==1?"text-[#1B64F3] text-xs ml-[10px]":"text-[#213044] text-xs ml-[10px]",children:i.formatMessage({id:"createkb.apiEmbed"})})]}),(0,e.jsxs)("p",{className:"text-[#999999] mb-[10px]",children:[i.formatMessage({id:"createkb.vendor"}),": ",W==null?void 0:W.online.suppliers_name]}),(0,e.jsxs)("p",{className:"mb-0 text-[#999999]",children:[i.formatMessage({id:"createkb.modelName"}),": ",W==null?void 0:W.online.name]})]})}),(0,e.jsx)(U.Z,{onClick:function(){Me(2)},size:"small",className:F==2?"bg-[#FFFFFF] ml-5":"bg-[#F7F7F7] ml-5",style:{minWidth:"440px",cursor:o.type?"not-allowed":"pointer",borderColor:F==2?"#1B64F3":""},styles:{body:{padding:"15px"}},children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("p",{className:"pb-[15px] border-b border-[#EEEEEE] flex items-center",children:[(0,e.jsx)("img",{src:F==2?"/icons/local_select.svg":"/icons/local.svg",className:"w-4 h-4 "}),(0,e.jsx)("span",{className:F==2?"text-[#1B64F3] text-xs ml-[10px]":"text-[#213044] text-xs ml-[10px]",children:i.formatMessage({id:"createkb.localEmbed"})})]}),(0,e.jsxs)("p",{className:"text-[#999999] mb-[10px]",children:[i.formatMessage({id:"createkb.vendor"}),"\uFF1A -"]}),(0,e.jsxs)("p",{className:"mb-0 text-[#999999]",children:[i.formatMessage({id:"createkb.modelName"}),": ",W==null?void 0:W.local.name]})]})})]})})]}),(0,e.jsxs)("div",{className:"flex items-center mt-[60px]",children:[(0,e.jsx)(re.ZP,{type:"primary",onClick:ke,className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",disabled:o.type,style:{cursor:o.type?"not-allowed":""},children:i.formatMessage({id:"createkb.save.and.upload.document"})}),(0,e.jsx)(re.ZP,{type:"primary",onClick:Ce,className:"ml-[20px] py-[10px] h-[40px] px-[15px] bg-[#ffffff] text-[#213044] text-[14px] leading-[20px] font-medium border border-[#979797]",children:i.formatMessage({id:"createkb.cancel"})})]})]})]})})}),K?(0,e.jsx)("div",{className:" absolute w-full h-full t-0 l-0 z-10 flex justify-center items-center",children:(0,e.jsx)(ht.Z,{size:"large"})}):""]}):""})},vt=xt,bt=l(19632),$e=l.n(bt),jt=l(82061),Je=l(40110),wt=l(85576),yt=l(38703),Mt=l(47520),kt=l(13769),St=l.n(kt),Nt=l(78367),Et=["onChange","fileList","action","headers","disabled","multiple","accept","maxSize","showUploadList","className","height","timeout","fileTypeIcons","children","dragText","limitText"],Ct=Nt.Z.Dragger,Xe=(0,c.forwardRef)(function(n,u){var o=n.onChange,a=n.fileList,i=a===void 0?[]:a,s=n.action,L=n.headers,C=n.disabled,P=C===void 0?!1:C,se=n.multiple,ie=se===void 0?!0:se,K=n.accept,Z=K===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv":K,G=n.maxSize,D=G===void 0?15:G,F=n.showUploadList,de=F===void 0?!1:F,V=n.className,me=V===void 0?"":V,ge=n.height,ne=ge===void 0?"200px":ge,ue=n.timeout,ve=ue===void 0?3e5:ue,W=n.fileTypeIcons,q=W===void 0?[{src:"/icons/word.svg",alt:"Word"},{src:"/icons/txt.svg",alt:"TXT"},{src:"/icons/pdf.svg",alt:"PDF"},{src:"/icons/xlsx.svg",alt:"Excel"},{src:"/icons/md.svg",alt:"Markdown"}]:W,z=n.children,j=n.dragText,ee=n.limitText,I=St()(n,Et),B=(0,A.useIntl)(),le=(0,c.useRef)(null);console.log("FileUpload component received fileList:",i.length,"files"),console.log("FileUpload fileList names:",i.map(function(te){return te.name}));var J=function(){le.current&&(le.current.fileList=[],le.current.upload&&(le.current.upload.fileList=[]),le.current.forceUpdate&&le.current.forceUpdate(),console.log("FileUpload component reset completed"))};(0,c.useImperativeHandle)(u,function(){return{reset:J}});var be=function(){return L||{Authorization:"Bearer ".concat(localStorage.getItem("token"))}},Me={action:s||"",headers:be(),fileList:i,onChange:function(M){var _=M.file.status;_==="uploading"&&console.log("Upload progress:",M.file.percent),_==="done"?T.ZP.success("".concat(M.file.name," ").concat(B.formatMessage({id:"common.upload.success",defaultMessage:"Upload successful"}))):_==="error"&&T.ZP.error("".concat(M.file.name," ").concat(B.formatMessage({id:"common.upload.error",defaultMessage:"Upload failed"}))),o==null||o(M)},beforeUpload:function(M){var _=M.size/1024/1024<D;if(!_)return T.ZP.error(B.formatMessage({id:"common.upload.error.fileSize",defaultMessage:"File size cannot exceed ".concat(D,"MB")},{maxSize:D})),!1;var $=(M.size/1024/1024).toFixed(2),k="".concat(B.formatMessage({id:"common.upload.starting",defaultMessage:"Starting upload"})," ").concat(M.name,", ").concat(B.formatMessage({id:"common.upload.fileSize",defaultMessage:"File size"}),": ").concat($,"MB");return T.ZP.info(k),_},customRequest:function(M){var _=M.action,$=M.file,k=M.onError,fe=M.onProgress,S=M.onSuccess,m=M.headers,R=new FormData;R.append("file",$);var w=new XMLHttpRequest;return w.timeout=ve,w.open("post",_,!0),m&&Object.keys(m).forEach(function(h){w.setRequestHeader(h,m[h])}),w.upload.addEventListener("progress",function(h){if(h.lengthComputable){var pe=Math.round(h.loaded/h.total*100);fe({percent:pe},$)}}),w.addEventListener("load",function(){if(w.status>=200&&w.status<300)try{var h=JSON.parse(w.response);S(h,$)}catch(We){var pe=B.formatMessage({id:"common.upload.error.serverResponse",defaultMessage:"Server response error"});k(new Error(pe),$)}else{var he="".concat(B.formatMessage({id:"common.upload.error.httpStatus",defaultMessage:"HTTP status error"})," ").concat(w.status);k(new Error(he),$)}}),w.addEventListener("error",function(){var h=B.formatMessage({id:"common.upload.error.network",defaultMessage:"Network error"});k(new Error(h),$)}),w.addEventListener("timeout",function(){var h=B.formatMessage({id:"common.upload.error.timeout",defaultMessage:"Upload timeout"});k(new Error(h),$)}),w.addEventListener("abort",function(){var h=B.formatMessage({id:"common.upload.error.cancelled",defaultMessage:"Upload cancelled"});k(new Error(h),$)}),w.send(R),{abort:function(){w.abort()}}}},Le=j||B.formatMessage({id:"common.upload.instruction.dragOrClick",defaultMessage:"Drag files here or click to upload"}),Ce=ee||B.formatMessage({id:"common.upload.instruction.uploadLimit",defaultMessage:"Supports batch upload, single file no more than ".concat(D,"MB")},{maxSize:D}),ke=function(){return(0,e.jsxs)("div",{className:"upload-content p-[4px]",children:[(0,e.jsx)("div",{className:"flex items-center w-full justify-center",children:q.map(function(M,_){return(0,e.jsx)("img",{src:M.src,alt:M.alt,className:"w-[42px] h-[42px] mx-3"},_)})}),(0,e.jsx)("div",{className:"mt-[10px] text-[#213044] text-sm",children:Le}),(0,e.jsx)("div",{className:"mt-[10px] text-[#999999] text-sm",children:Ce})]})},je=x()(x()(x()({},Me),I),{},{name:"file",multiple:ie,className:"".concat(me," flex flex-col items-center justify-center"),showUploadList:de,accept:Z,disabled:P,style:{height:ne}});return(0,e.jsx)(Ct,x()(x()({},je),{},{ref:le,listType:"picture",children:z||ke()}))});Xe.displayName="FileUpload";var Ft=Xe,Tt=(0,c.forwardRef)(function(n,u){var o=n.fun,a=n.createkbInfo,i=n.fileList,s=i===void 0?[]:i;return console.log("Upload component received fileList:",s.length,"files"),console.log("Upload fileList names:",s.map(function(L){return L.name})),(0,e.jsx)(Ft,{ref:u,action:"".concat(Mt._n,"/v1/upload/upload_file"),fileList:s,onChange:o,disabled:a.type,accept:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv",maxSize:15,height:"200px",timeout:3e5,multiple:!0,showUploadList:!1,className:"mt-[15px]",fileTypeIcons:[{src:"/icons/word.svg",alt:"Word"},{src:"/icons/txt.svg",alt:"TXT"},{src:"/icons/pdf.svg",alt:"PDF"},{src:"/icons/xlsx.svg",alt:"Excel"},{src:"/icons/md.svg",alt:"Markdown"}]})}),Lt=Tt,ze=l(34994),Pt=l(52688),Dt=l(86615),Qe=l(31199),_t=l(93967),qe=l.n(_t),Zt=l(98423),et=l(98065),It=l(53124),Bt=l(83559),Ot=l(83262);const tt=["wrap","nowrap","wrap-reverse"],at=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],st=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Ut=(n,u)=>{const o=u.wrap===!0?"wrap":u.wrap;return{[`${n}-wrap-${o}`]:o&&tt.includes(o)}},Rt=(n,u)=>{const o={};return st.forEach(a=>{o[`${n}-align-${a}`]=u.align===a}),o[`${n}-align-stretch`]=!u.align&&!!u.vertical,o},$t=(n,u)=>{const o={};return at.forEach(a=>{o[`${n}-justify-${a}`]=u.justify===a}),o};function zt(n,u){return qe()(Object.assign(Object.assign(Object.assign({},Ut(n,u)),Rt(n,u)),$t(n,u)))}var At=zt;const Ht=n=>{const{componentCls:u}=n;return{[u]:{display:"flex","&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Kt=n=>{const{componentCls:u}=n;return{[u]:{"&-gap-small":{gap:n.flexGapSM},"&-gap-middle":{gap:n.flexGap},"&-gap-large":{gap:n.flexGapLG}}}},Vt=n=>{const{componentCls:u}=n,o={};return tt.forEach(a=>{o[`${u}-wrap-${a}`]={flexWrap:a}}),o},Yt=n=>{const{componentCls:u}=n,o={};return st.forEach(a=>{o[`${u}-align-${a}`]={alignItems:a}}),o},Gt=n=>{const{componentCls:u}=n,o={};return at.forEach(a=>{o[`${u}-justify-${a}`]={justifyContent:a}}),o},Wt=()=>({});var Jt=(0,Bt.I$)("Flex",n=>{const{paddingXS:u,padding:o,paddingLG:a}=n,i=(0,Ot.mergeToken)(n,{flexGapSM:u,flexGap:o,flexGapLG:a});return[Ht(i),Kt(i),Vt(i),Yt(i),Gt(i)]},Wt,{resetStyle:!1}),Xt=function(n,u){var o={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&u.indexOf(a)<0&&(o[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(n);i<a.length;i++)u.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(n,a[i])&&(o[a[i]]=n[a[i]]);return o},Qt=c.forwardRef((n,u)=>{const{prefixCls:o,rootClassName:a,className:i,style:s,flex:L,gap:C,children:P,vertical:se=!1,component:ie="div"}=n,K=Xt(n,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:Z,direction:G,getPrefixCls:D}=c.useContext(It.E_),F=D("flex",o),[de,V,me]=Jt(F),ge=se!=null?se:Z==null?void 0:Z.vertical,ne=qe()(i,a,Z==null?void 0:Z.className,F,V,me,At(F,n),{[`${F}-rtl`]:G==="rtl",[`${F}-gap-${C}`]:(0,et.n)(C),[`${F}-vertical`]:ge}),ue=Object.assign(Object.assign({},Z==null?void 0:Z.style),s);return L&&(ue.flex=L),C&&!(0,et.n)(C)&&(ue.gap=C),de(c.createElement(ie,Object.assign({ref:u,className:ne,style:ue},(0,Zt.Z)(K,["justify","wrap","align"])),P))}),qt=l(34041),Ae=l(78045),ea=l(96074),rt=l(2487),ta=l(58533),He="0",Ke="hit_count asc",Ve=1,nt="",lt,it,aa=function(u){var o=u.item,a=u.fun,i=u.createkbInfo,s=(0,A.useIntl)(),L=[{title:s.formatMessage({id:"createkb.splitMode",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.charLimit",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.avgChar",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.sectionNum",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.totalRecall",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.embedTime",defaultMessage:""})+"\uFF1A",value:""},{title:s.formatMessage({id:"createkb.embedCost",defaultMessage:""})+"\uFF1A",value:""}],C=(0,c.useState)(!1),P=p()(C,2),se=P[0],ie=P[1],K=(0,c.useState)([]),Z=p()(K,2),G=Z[0],D=Z[1],F=(0,c.useState)(null),de=p()(F,2),V=de[0],me=de[1],ge=function(){a("return")};function ne(){return L.filter(function(z){return z.value!=null}).map(function(z){return(0,e.jsx)("div",{className:"mr-[40px]",children:(0,e.jsxs)("div",{className:"flex items-center grow shrink-0",children:[(0,e.jsx)("div",{className:"text-[#666666] text-[12px] leading-[17px] font-normal",children:z.title}),(0,e.jsx)("div",{className:"text-[#213044] text-[12px] leading-[17px] font-medium",children:z.value})]})},"".concat(z.title))})}var ue=function(j){var ee=j.target.value;clearTimeout(lt),lt=setTimeout(function(){D([]),nt=ee,q(1)},500)},ve=function(){Ve+=1,q(Ve)},W=function(){var z=d()(r()().mark(function j(ee,I){var B;return r()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:ee?B=(0,v.Rc)(I.id):B=(0,v.U4)(I.id);case 1:case"end":return J.stop()}},j)}));return function(ee,I){return z.apply(this,arguments)}}(),q=function(){var z=d()(r()().mark(function j(){var ee,I,B=arguments;return r()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return ee=B.length>0&&B[0]!==void 0?B[0]:1,Ve=ee,J.next=4,(0,v.gD)({document_id:o.id,page:ee,page_size:10,hit_count:Ke,content:nt,status:He});case 4:I=J.sent,me(I.data),V==null&&(L[0].value=I.data.seg_set.seg_Mode,L[1].value=I.data.seg_set.seg_Len,L[2].value=I.data.seg_set.seg_Overlap,L[3].value=I.data.seg_set.seg_Avg,L[4].value=I.data.seg_set.seg_Num,L[5].value=I.data.seg_set.hit_Num,L[6].value=I.data.seg_set.Embedding_Time,L[7].value=I.data.seg_set.Embedding_Token,it=ne()),D(function(be){return[].concat($e()(be),$e()(I.data.data))});case 8:case"end":return J.stop()}},j)}));return function(){return z.apply(this,arguments)}}();return(0,c.useEffect)(function(){q()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"py-[30px] bg-white overflow-hidden w-full h-full flex flex-col",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"border-b  flex items-center pb-[30px]",children:[(0,e.jsx)("div",{className:"border-r mr-[10px] pr-[10px] cursor-pointer",onClick:ge,children:(0,e.jsx)("img",{src:"/icons/return.svg",className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("img",{src:"/icons/textIcon.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"text-[#213044] leading-[25px] text-[18px] font-medium ml-[5px]",children:o.name})]})]}),(0,e.jsx)("div",{className:"pt-[20px] pb-[15px] text-[#555555]  text-[14px] leading-[20px] font-medium",children:s.formatMessage({id:"createkb.docParams",defaultMessage:""})}),(0,e.jsx)("div",{className:"w-full border border-[#EEEEEE] rounded-lg p-[15px] bg-[#F7F7F7]",children:(0,e.jsx)(Qt,{wrap:!0,gap:"middle",align:"center",children:it})}),(0,e.jsxs)("div",{className:"pt-[20px] pb-[15px] text-[#555555] text-[14px] leading-[20px] font-medium",children:[s.formatMessage({id:"createkb.docPara",defaultMessage:""})," ",V!=null?V.paging_information.total_count:""]}),(0,e.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,e.jsxs)("div",{className:"sticky-0 flex items-center",children:[(0,e.jsx)(qt.Z,{defaultValue:"".concat(He),style:{width:114,height:32,background:"#F7F7F7"},onSelect:function(j){He=j,D([]),q(1)},options:[{value:"0",label:s.formatMessage({id:"createkb.all",defaultMessage:""})},{value:"1",label:s.formatMessage({id:"createkb.enabled",defaultMessage:""})},{value:"2",label:s.formatMessage({id:"createkb.disabled",defaultMessage:""})}]}),(0,e.jsx)(ae.Z,{size:"large",placeholder:s.formatMessage({id:"createkb.search",defaultMessage:""}),prefix:(0,e.jsx)(Je.Z,{className:"text-[#213044] opacity-30"}),onChange:ue,className:"w-[300px] text-sm h-8 ml-5"})]}),(0,e.jsx)("div",{className:"flex-1 justify-end flex items-center",children:(0,e.jsxs)("div",{className:"flex items-center text-[#555555] text-[14px] leading-[20px] font-normal",children:[(0,e.jsxs)("span",{children:[s.formatMessage({id:"createkb.recallSort"}),"\uFF1A"]}),(0,e.jsxs)(Ae.ZP.Group,{defaultValue:Ke,onChange:function(j){Ke=j.target.value,D([]),q(1)},size:"small",children:[(0,e.jsx)(Ae.ZP,{value:"hit_count asc",children:s.formatMessage({id:"createkb.highToLow"})}),(0,e.jsx)(Ae.ZP,{value:"hit_count desc",children:s.formatMessage({id:"createkb.lowToHigh"})})]})]})})]})]}),V!=null?(0,e.jsx)("div",{className:"overflow-y-auto flex-1 mt-4",id:"lists",children:(0,e.jsx)(ta.Z,{dataLength:G.length,next:ve,hasMore:G.length<V.paging_information.total_count,loader:!1,endMessage:G.length<=0?"":(0,e.jsx)(ea.Z,{plain:!0,children:s.formatMessage({id:"createkb.bottom"})}),scrollableTarget:"lists",children:(0,e.jsx)(rt.Z,{dataSource:G,split:!1,renderItem:function(j){return(0,e.jsx)(rt.Z.Item,{style:{padding:"0px"},children:(0,e.jsxs)("div",{className:"w-full rounded-lg bg-[#F7F7F7] p-[15px] mb-[15px]",children:[(0,e.jsxs)("div",{className:"w-full flex items-center",children:[(0,e.jsxs)("div",{className:"py-1 rounded-md px-2 border border-[#D8D8D8] flex items-center justify-center text-[#213044] text-sm",children:["#",j.segnum<=9?"00"+j.segnum:j.segnum<=99?"0"+j.segnum:j.segnum]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zishu.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:j.word_count})]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zh.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:j.hit_count})]}),(0,e.jsx)("div",{className:"ml-8 ",children:(0,e.jsx)(Re.Z,{defaultChecked:j.status!=2,onChange:function(I){return W(I,j)},disabled:i.type,size:"small"},j.id)})]}),(0,e.jsx)("div",{className:"pt-5",children:(0,e.jsx)("span",{className:"text-[#213044] text-sm",children:j.content})})]})},j.id)}})})}):""]})})},sa=aa,_e=1,ot,ct="",Ye=null,Ge={split:!0,split_mode:"text",chunk_size:4e3,chunk_overlap:200},ra=(0,c.memo)(function(n){var u=n.onFinish,o=n.isUploading,a=n.formValuesRef,i=n.intl,s=(0,c.useCallback)(function(C){return a.current=C,u(C)},[u,a]),L=(0,c.useCallback)(function(C,P){a.current=P},[a]);return(0,e.jsxs)(ze.A,{submitter:{resetButtonProps:!1,searchConfig:{submitText:i.formatMessage({id:"createkb.uploadToKnowledgeBase",defaultMessage:""})}},onFinish:s,layout:"horizontal",initialValues:a.current,disabled:o,onValuesChange:L,preserve:!1,children:[(0,e.jsx)(Pt.Z,{name:"split",label:i.formatMessage({id:"createkb.splitContent",defaultMessage:""})}),(0,e.jsx)(ze.A.Item,{noStyle:!0,dependencies:["split"],children:function(P){var se=P.getFieldValue;return se("split")?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Dt.Z.Group,{label:i.formatMessage({id:"createkb.splitType",defaultMessage:""}),name:"split_mode",radioType:"button",fieldProps:{options:[{label:"text",value:"text"},{label:"markdown",value:"markdown"}]}}),(0,e.jsx)(ze.A.Item,{noStyle:!0,dependencies:["split_mode"],children:function(K){var Z=K.getFieldValue;return Z("split_mode")==="text"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Qe.Z,{label:i.formatMessage({id:"createkb.chunkSize",defaultMessage:""}),name:"chunk_size",min:200,max:8e3}),(0,e.jsx)(Qe.Z,{label:i.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""}),name:"chunk_overlap",min:0,max:8e3})]}):null}})]}):null}})]})}),na=function(u){var o=u.fun,a=u.createkbInfo,i=wt.Z.confirm,s=(0,A.useIntl)(),L=function(f,g,O,H,X,y){return(0,e.jsx)("div",{className:"mt-[10px] border border-[#EEEEEE] rounded-lg",children:(0,e.jsx)(ye.Z,{columns:f,loading:g,dataSource:O,size:"middle",pagination:H,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:s.formatMessage({id:"createkb.no.data.available",defaultMessage:""})})})},onRow:function(Be,Y){return{onClick:function(){return X(Be,Y)},style:{cursor:"pointer"}}},onChange:y,rowKey:"id"})})},C=(0,c.useState)([]),P=p()(C,2),se=P[0],ie=P[1],K=(0,c.useState)([]),Z=p()(K,2),G=Z[0],D=Z[1],F=(0,c.useState)(null),de=p()(F,2),V=de[0],me=de[1],ge=(0,c.useState)(!0),ne=p()(ge,2),ue=ne[0],ve=ne[1],W=(0,c.useState)(!0),q=p()(W,2),z=q[0],j=q[1],ee=(0,c.useState)(null),I=p()(ee,2),B=I[0],le=I[1],J=(0,c.useState)(1),be=p()(J,2),Me=be[0],Le=be[1],Ce=(0,c.useState)([]),ke=p()(Ce,2),je=ke[0],te=ke[1],M=(0,c.useState)(!1),_=p()(M,2),$=_[0],k=_[1],fe=(0,c.useRef)(Ge),S=(0,c.useRef)(null),m=function(){o({type:"next",data:"3"})},R=function(f){j(!0)},w=function(f){var g=$e()(se);g[f]=!g[f],ie(g)},h=function(){var b=d()(r()().mark(function f(g,O,H,X){var y,N;return r()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(y=null,g){Y.next=7;break}return Y.next=4,(0,v.LV)(H.id);case 4:y=Y.sent,Y.next=10;break;case 7:return Y.next=9,(0,v.OK)(H.id);case 9:y=Y.sent;case 10:y.code==0&&(N=G.map(function(we,Te){return X==Te&&(we.status=g?1:2),x()(x()({},we),{},{statusText:we.status==1?s.formatMessage({id:"createkb.normal",defaultMessage:""}):we.status==2?s.formatMessage({id:"createkb.disabled",defaultMessage:""}):s.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),D(N));case 11:case"end":return Y.stop()}},f)}));return function(g,O,H,X){return b.apply(this,arguments)}}(),pe=function(){var b=d()(r()().mark(function f(g,O){return r()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:i({title:s.formatMessage({id:"createkb.deleteOperation",defaultMessage:""}),content:s.formatMessage({id:"createkb.confirmDelete",defaultMessage:"?"}),onOk:function(){var y=d()(r()().mark(function Be(){var Y;return r()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,(0,v.iH)(g);case 2:Y=Te.sent,Y.code==0&&(Ie(_e),w(O));case 4:case"end":return Te.stop()}},Be)}));function N(){return y.apply(this,arguments)}return N}(),onCancel:function(){}});case 1:case"end":return X.stop()}},f)}));return function(g,O){return b.apply(this,arguments)}}(),he=function(f){var g=f.target.value;clearTimeout(ot),ot=setTimeout(function(){ct=g,_e=1,Ie()},500)},We=function(f,g){le(f),j(!1)},Fe=function(f){f&&f.stopPropagation&&f.stopPropagation()},Ze=[{title:s.formatMessage({id:"createkb.filename",defaultMessage:""}),dataIndex:"name",key:"name",ellipsis:!0,className:"max-w-48 text-[#213044] text-xs py-[15px]"},{title:s.formatMessage({id:"createkb.charCount",defaultMessage:""}),dataIndex:"word_count",key:"word_count",className:"max-w-48 w-24 text-[#213044] text-xs py-[15px]"},{title:s.formatMessage({id:"createkb.recallNum",defaultMessage:""}),dataIndex:"hit_count",key:"hit_count",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]"},{title:s.formatMessage({id:"createkb.uploadTime",defaultMessage:""}),dataIndex:"created_time",key:"created_time",className:"max-w-48 w-44 text-[#213044] text-xs py-[15px]",sorter:!0},{title:s.formatMessage({id:"createkb.status",defaultMessage:""}),dataIndex:"statusText",key:"statusText",className:"max-w-48 w-28 text-[#213044] text-xs py-[15px]",render:function(f,g,O){return(0,e.jsx)("div",{onClick:Fe,children:(0,e.jsx)(Re.Z,{className:g.status==2?"":"bg-[#1B64F3]",defaultChecked:g.status!=2,onChange:function(X){return h(X,f,g,O)},size:"small"},f)})}},{title:s.formatMessage({id:"createkb.action"}),dataIndex:"id",key:"id",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]",render:function(f,g,O){return(0,e.jsx)("div",{onClick:Fe,children:(0,e.jsx)("img",{src:"/icons/delete.svg",className:"w-4 h-4",onClick:function(){pe(f,O)}})})}}],ut=function(){var b=d()(r()().mark(function f(g){var O,H;return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:console.log("getList called with:",g.fileList.length,"files"),console.log("File names:",g.fileList.map(function(N){return N.name})),console.log("File statuses:",g.fileList.map(function(N){return"".concat(N.name,": ").concat(N.status)})),O=g.fileList.some(function(N){return N.status==="uploading"}),k(O),H=g.fileList.some(function(N){return N.status==="error"}),H&&!O&&k(!1),te(g.fileList);case 8:case"end":return y.stop()}},f)}));return function(g){return b.apply(this,arguments)}}(),Ie=function(){var b=d()(r()().mark(function f(){var g,O,H,X,y,N=arguments;return r()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return g=N.length>0&&N[0]!==void 0?N[0]:1,O=N.length>1&&N[1]!==void 0?N[1]:Ye,ve(!0),H={app_id:a.app_id,page:g,page_size:10,name:ct},Y.next=6,(0,v.SH)(H);case 6:X=Y.sent,X.code==0&&(y=X.data.data.map(function(we,Te){return x()(x()({},we),{},{statusText:we.status==1?s.formatMessage({id:"createkb.normal"}):we.status==2?s.formatMessage({id:"createkb.disabled"}):s.formatMessage({id:"createkb.deleted"})})}),D(y),me(X.data)),ve(!1);case 9:case"end":return Y.stop()}},f)}));return function(){return b.apply(this,arguments)}}(),ca=function(f,g,O){Ye=O.order=="ascend"?"asc":O.order=="descend"?"desc":null,_e=f.current,Ie(_e,Ye)},da={total:V!=null?V.paging_information.total_count:0,current:_e,hideOnSinglePage:!0};(0,c.useEffect)(function(){a.app_id&&(Le(a.type?2:1),Ie())},[]);var ua=(0,c.useCallback)(function(){var b=d()(r()().mark(function f(g){var O,H;return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(O=je.filter(function(N){return N.status==="done"&&N.response}),O.length!==0){y.next=4;break}return T.ZP.warning(s.formatMessage({id:"createkb.upload.selectFileFirst"})),y.abrupt("return");case 4:return y.prev=4,y.next=7,(0,v.H_)({app_id:a.app_id*1,file_ids:O.map(function(N){return N.response.data.file_id*1}),process_rule_id:1,data_source_type:1,text_split_config:x()(x()({},Ge),g)});case 7:H=y.sent,H.code==0?(te([]),fe.current=Ge,setTimeout(function(){var N;(N=S.current)===null||N===void 0||N.reset()},100),Ie(_e),T.ZP.success(s.formatMessage({id:"createkb.upload.addToKbSuccess",defaultMessage:"Files successfully added to knowledge base"})),console.log("Files cleared and component reset")):T.ZP.error(s.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"})),y.next=15;break;case 11:y.prev=11,y.t0=y.catch(4),console.error("Add document error:",y.t0),T.ZP.error(s.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"}));case 15:case"end":return y.stop()}},f,null,[[4,11]])}));return function(f){return b.apply(this,arguments)}}(),[je,a.app_id,s]),ft=function(f){te(function(g){var O=g[f],H=g.filter(function(y,N){return N!==f});console.log("File deleted: ".concat(O==null?void 0:O.name," at index ").concat(f)),console.log("Remaining files:",H.map(function(y){return y.name})),console.log("File list length changed from ".concat(g.length," to ").concat(H.length));var X=H.some(function(y){return y.status==="uploading"});return k(X),H})},fa=function(){te([]),k(!1),setTimeout(function(){var f;(f=S.current)===null||f===void 0||f.reset()},100),T.ZP.info(s.formatMessage({id:"createkb.upload.allFilesCleared",defaultMessage:"All files cleared"})),console.log("All files manually cleared")};return(0,e.jsx)(e.Fragment,{children:z?V!=null?(0,e.jsxs)("div",{className:"h-full bg-white w-full",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Me==2?(0,A.getLocale)()=="zh-CN"?V.dataset_detail.nickname+s.formatMessage({id:"createkb.knowledge.base.of"}):s.formatMessage({id:"createkb.knowledge.base.of"})+V.dataset_detail.nickname:Me==1?s.formatMessage({id:"createkb.editKB"}):s.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:s.formatMessage({id:"createkb.documentSettings"})}),(0,e.jsx)("div",{className:"text-[#555555] text-[12px] leading-[17px] font-medium pt-[30px]",children:s.formatMessage({id:"createkb.uploadDoc"})}),(0,e.jsx)(Lt,{ref:S,fun:ut,createkbInfo:a,fileList:je}),je.length>0&&(0,e.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg ",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("h4",{className:"text-base font-medium text-gray-700",children:s.formatMessage({id:"createkb.fileList",defaultMessage:""})}),(0,e.jsx)("button",{onClick:fa,className:"text-xs text-red-500 hover:text-red-700 transition-colors px-2 py-1 border border-red-200 rounded hover:border-red-300",children:s.formatMessage({id:"createkb.upload.clearAll",defaultMessage:"Clear All"})})]}),(0,e.jsx)("ul",{className:"space-y-1",children:je.map(function(b,f){return(0,e.jsx)("li",{className:"flex items-center justify-between text-sm text-gray-600 bg-gray-50 p-3 rounded",children:(0,e.jsxs)("div",{className:"flex-1 mr-2",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("span",{className:"truncate font-medium",children:b.name}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[b.status==="uploading"&&(0,e.jsx)("button",{onClick:function(){b.xhr&&b.xhr.abort(),ft(f)},className:"text-gray-500 hover:text-gray-700 transition-colors text-xs",children:s.formatMessage({id:"createkb.upload.cancel"})}),(0,e.jsx)("button",{onClick:function(){return ft(f)},className:"text-red-500 hover:text-red-700 transition-colors","aria-label":"".concat(s.formatMessage({id:"createkb.deleteFile"})," ").concat(b.name),title:"".concat(s.formatMessage({id:"createkb.deleteFile"})," ").concat(b.name),children:(0,e.jsx)(jt.Z,{})})]})]}),b.status==="uploading"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)(yt.Z,{percent:Math.round(b.percent||0),size:"small",status:"active",strokeColor:"#1B64F3"}),(0,e.jsxs)("div",{className:"text-xs text-blue-500 font-medium",children:[s.formatMessage({id:"createkb.upload.progress"})," ",Math.round(b.percent||0),"%",b.size&&(0,e.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",(b.size/1024/1024).toFixed(2),"MB)"]})]})]}),b.status==="done"&&(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-green-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-green-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-green-600 font-medium whitespace-nowrap",children:s.formatMessage({id:"createkb.upload.complete"})})]}),b.status==="error"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-red-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-red-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-red-600 font-medium whitespace-nowrap",children:s.formatMessage({id:"createkb.upload.failed"})})]}),b.error&&(0,e.jsx)("div",{className:"text-xs text-red-500 mt-1",children:b.error.message||s.formatMessage({id:"createkb.error.unknown"})}),(0,e.jsx)("button",{onClick:function(){T.ZP.info(s.formatMessage({id:"createkb.instruction.retryUpload"}))},className:"text-xs text-blue-500 hover:text-blue-700",children:s.formatMessage({id:"createkb.upload.retry"})})]})]})},b.uid||f)})}),(0,e.jsx)(ra,{onFinish:ua,isUploading:$,formValuesRef:fe,intl:s})]}),(0,e.jsx)("div",{className:"flex justify-between pt-[30px]",children:(0,e.jsx)("span",{className:"text-[#213044] text-xs font-medium",children:s.formatMessage({id:"createkb.documentList"})})}),(0,e.jsx)("div",{className:"flex items-center w-full pt-[10px]",children:(0,e.jsx)(ae.Z,{placeholder:s.formatMessage({id:"createkb.searchDoc"}),onChange:he,className:"w-[782px] h-10 mr-5",prefix:(0,e.jsx)(Je.Z,{})})}),L(Ze,ue,G,da,We,ca),(0,e.jsx)("div",{className:"mt-[30px]",children:(0,e.jsx)(re.ZP,{type:"primary",className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",onClick:m,children:s.formatMessage({id:"createkb.enterRecallTest"})})})]}):"":(0,e.jsx)(sa,{fun:R,item:B,createkbInfo:a})})},la=na,dt=function(){A.history.back()},ia=function(){var u=(0,A.useIntl)(),o=(0,c.useState)("1"),a=p()(o,2),i=a[0],s=a[1],L=(0,c.useState)((0,Ne.Go)("GET")),C=p()(L,2),P=C[0],se=C[1],ie=[{key:"1",icon:(0,e.jsx)(e.Fragment,{children:i=="1"?(0,e.jsx)("img",{src:"/icons/kb_setting_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/kb_setting.svg",className:"w-4 h-4 mr-[10px]"})}),label:u.formatMessage({id:"createkb.settings",defaultMessage:""}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:i=="1"?"#1B64F3":"#213044"}},{key:"2",icon:(0,e.jsx)(e.Fragment,{children:i=="2"?(0,e.jsx)("img",{src:"/icons/uptxt_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/uptxt.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:P.app_id?"1":"0.4"}})}),label:u.formatMessage({id:"createkb.documentSettings",defaultMessage:""}),disabled:!P.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:i=="2"?"#1B64F3":"#213044"}},{key:"3",icon:(0,e.jsx)(e.Fragment,{children:i=="3"?(0,e.jsx)("img",{src:"/icons/recall_test_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/recall_test.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:P.app_id?"1":"0.4"}})}),label:u.formatMessage({id:"createkb.recallTest",defaultMessage:""}),disabled:!P.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:i=="3"?"#1B64F3":"#213044"}}],K=function(D){D.type=="set"&&(P.app_id=D.data,se(P)),D.type=="return"&&dt(),D.type=="next"&&s(D.data)};function Z(){var G=function(F){s(F.key)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"flex flex-col bg-white h-full",children:[(0,e.jsx)("div",{className:" bg-white pl-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)("div",{className:"w-full flex  justify-start",children:(0,e.jsxs)("div",{className:"cursor-pointer flex items-center",onClick:dt,children:[(0,e.jsx)(re.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(oe.Z,{className:"text-[#1B64F3] w-4 h-4"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:u.formatMessage({id:"createkb.back",defaultMessage:""})})]})})}),(0,e.jsx)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)(Ee.Z,{onClick:G,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[i],mode:"inline",items:ie})})]})})}return(0,e.jsxs)("div",{className:"w-full flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"w-[300px] shrink-0",children:(0,e.jsx)(Z,{})}),(0,e.jsx)("div",{className:"shrink-0 h-full overflow-y-auto bg-white overflow-x-auto",style:{width:"calc(100% - 300px)"},children:(0,e.jsx)("div",{className:"w-full h-full flex xl:justify-center justify-start flex-1",children:(0,e.jsx)("div",{className:"w-[900px] xl:px-0 px-[30px]",children:i=="1"?(0,e.jsx)(vt,{createkbInfo:P,fun:K}):i=="2"?(0,e.jsx)(la,{createkbInfo:P,fun:K}):(0,e.jsx)(pt,{createkbInfo:P,fun:K})})})})]})},oa=ia},58533:function(Oe,Se,l){var xe=l(67294);var p=function(x,E){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var d in t)t.hasOwnProperty(d)&&(r[d]=t[d])},p(x,E)};function Ne(x,E){p(x,E);function r(){this.constructor=x}x.prototype=E===null?Object.create(E):(r.prototype=E.prototype,new r)}var oe=function(){return oe=Object.assign||function(E){for(var r,t=1,d=arguments.length;t<d;t++){r=arguments[t];for(var v in r)Object.prototype.hasOwnProperty.call(r,v)&&(E[v]=r[v])}return E},oe.apply(this,arguments)};function A(x,E,r,t){var d,v=!1,T=0;function ce(){d&&clearTimeout(d)}function Q(){ce(),v=!0}typeof E!="boolean"&&(t=r,r=E,E=void 0);function U(){var ae=this,ye=Date.now()-T,e=arguments;if(v)return;function De(){T=Date.now(),r.apply(ae,e)}function Ue(){d=void 0}t&&!d&&De(),ce(),t===void 0&&ye>x?De():E!==!0&&(d=setTimeout(t?Ue:De,t===void 0?x-ye:x))}return U.cancel=Q,U}var re={Pixel:"Pixel",Percent:"Percent"},Ee={unit:re.Percent,value:.8};function c(x){return typeof x=="number"?{unit:re.Percent,value:x*100}:typeof x=="string"?x.match(/^(\d*(\.\d+)?)px$/)?{unit:re.Pixel,value:parseFloat(x)}:x.match(/^(\d*(\.\d+)?)%$/)?{unit:re.Percent,value:parseFloat(x)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),Ee):(console.warn("scrollThreshold should be string or number"),Ee)}var Pe=function(x){Ne(E,x);function E(r){var t=x.call(this,r)||this;return t.lastScrollTop=0,t.actionTriggered=!1,t.startY=0,t.currentY=0,t.dragging=!1,t.maxPullDownDistance=0,t.getScrollableTarget=function(){return t.props.scrollableTarget instanceof HTMLElement?t.props.scrollableTarget:typeof t.props.scrollableTarget=="string"?document.getElementById(t.props.scrollableTarget):(t.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},t.onStart=function(d){t.lastScrollTop||(t.dragging=!0,d instanceof MouseEvent?t.startY=d.pageY:d instanceof TouchEvent&&(t.startY=d.touches[0].pageY),t.currentY=t.startY,t._infScroll&&(t._infScroll.style.willChange="transform",t._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},t.onMove=function(d){t.dragging&&(d instanceof MouseEvent?t.currentY=d.pageY:d instanceof TouchEvent&&(t.currentY=d.touches[0].pageY),!(t.currentY<t.startY)&&(t.currentY-t.startY>=Number(t.props.pullDownToRefreshThreshold)&&t.setState({pullToRefreshThresholdBreached:!0}),!(t.currentY-t.startY>t.maxPullDownDistance*1.5)&&t._infScroll&&(t._infScroll.style.overflow="visible",t._infScroll.style.transform="translate3d(0px, "+(t.currentY-t.startY)+"px, 0px)")))},t.onEnd=function(){t.startY=0,t.currentY=0,t.dragging=!1,t.state.pullToRefreshThresholdBreached&&(t.props.refreshFunction&&t.props.refreshFunction(),t.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){t._infScroll&&(t._infScroll.style.overflow="auto",t._infScroll.style.transform="none",t._infScroll.style.willChange="unset")})},t.onScrollListener=function(d){typeof t.props.onScroll=="function"&&setTimeout(function(){return t.props.onScroll&&t.props.onScroll(d)},0);var v=t.props.height||t._scrollableNode?d.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!t.actionTriggered){var T=t.props.inverse?t.isElementAtTop(v,t.props.scrollThreshold):t.isElementAtBottom(v,t.props.scrollThreshold);T&&t.props.hasMore&&(t.actionTriggered=!0,t.setState({showLoader:!0}),t.props.next&&t.props.next()),t.lastScrollTop=v.scrollTop}},t.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:r.dataLength},t.throttledOnScrollListener=A(150,t.onScrollListener).bind(t),t.onStart=t.onStart.bind(t),t.onMove=t.onMove.bind(t),t.onEnd=t.onEnd.bind(t),t}return E.prototype.componentDidMount=function(){if(typeof this.props.dataLength=="undefined")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},E.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},E.prototype.componentDidUpdate=function(r){this.props.dataLength!==r.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},E.getDerivedStateFromProps=function(r,t){var d=r.dataLength!==t.prevDataLength;return d?oe(oe({},t),{prevDataLength:r.dataLength}):null},E.prototype.isElementAtTop=function(r,t){t===void 0&&(t=.8);var d=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,v=c(t);return v.unit===re.Pixel?r.scrollTop<=v.value+d-r.scrollHeight+1:r.scrollTop<=v.value/100+d-r.scrollHeight+1},E.prototype.isElementAtBottom=function(r,t){t===void 0&&(t=.8);var d=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,v=c(t);return v.unit===re.Pixel?r.scrollTop+d>=r.scrollHeight-v.value:r.scrollTop+d>=v.value/100*r.scrollHeight},E.prototype.render=function(){var r=this,t=oe({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),d=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),v=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return xe.createElement("div",{style:v,className:"infinite-scroll-component__outerdiv"},xe.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(T){return r._infScroll=T},style:t},this.props.pullDownToRefresh&&xe.createElement("div",{style:{position:"relative"},ref:function(T){return r._pullDown=T}},xe.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!d&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},E}(xe.Component);Se.Z=Pe}}]);
