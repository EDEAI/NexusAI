"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[178],{83510:function(bt,Me,n){n.d(Me,{LK:function(){return ne},bs:function(){return Re},go:function(){return fe},uy:function(){return Le}});var Te=n(15009),_=n.n(Te),Ie=n(99289),B=n.n(Ie),W=n(47520),t="/v1/apps/apps_list",Be="/v1/agent/agent_delete/",p="/v1/workflow/workflow_app_delete/",V="/v1/vector/delete_dataset/",Ve="/v1/skill/delete_skill_by_app_id/",Oe="/v1/apps/apps_create",Pe="/v1/apps/app_update/",fe=function(){var H=B()(_()().mark(function O(Z){var C;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,W.ZP)("".concat(t),{method:"GET",data:Z});case 2:return C=s.sent,s.abrupt("return",C);case 4:case"end":return s.stop()}},O)}));return function(Z){return H.apply(this,arguments)}}(),ne=function(){var H=B()(_()().mark(function O(Z){var C;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log(Z),s.next=3,Z.mode;case 3:if(s.t0=s.sent,s.t0!=1){s.next=8;break}s.t1=(0,W.ZP)("".concat(Be).concat(Z.app_id),{method:"DELETE"}),s.next=9;break;case 8:s.t1=Z.mode==2?(0,W.ZP)("".concat(p).concat(Z.app_id),{method:"DELETE"}):Z.mode==3?(0,W.ZP)("".concat(V).concat(Z.app_id),{method:"DELETE"}):(0,W.ZP)("".concat(Ve).concat(Z.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return C=s.t1,s.abrupt("return",C);case 11:case"end":return s.stop()}},O)}));return function(Z){return H.apply(this,arguments)}}(),Le=function(){var H=B()(_()().mark(function O(Z){var C;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,W.ZP)("".concat(Oe),{method:"POST",data:Z});case 2:return C=s.sent,s.abrupt("return",C);case 4:case"end":return s.stop()}},O)}));return function(Z){return H.apply(this,arguments)}}(),Re=function(){var H=B()(_()().mark(function O(Z){var C;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,W.ZP)("".concat(Pe).concat(Z.app_id),{method:"PUT",data:Z});case 2:return C=s.sent,s.abrupt("return",C);case 4:case"end":return s.stop()}},O)}));return function(Z){return H.apply(this,arguments)}}()},6180:function(bt,Me,n){n.r(Me),n.d(Me,{default:function(){return Ot}});var Te=n(15009),_=n.n(Te),Ie=n(99289),B=n.n(Ie),W=n(97857),t=n.n(W),Be=n(5574),p=n.n(Be),V=n(11551),Ve=n(83510),Oe=n(47520),Pe=n(29432),fe=n(10759),ne=n(32332),Le=n(2068),Re=n(89035),H=n(15360),O=n(82826),Z=n(69243),C=n(35312),g=n(40741),s=n(2453),X=n(28036),yt=n(50136),Ke=n(74330),x=n(67294),jt=n(13769),$e=n.n(jt),he=n(92939),We=n(51042),He=n(82061),J=n(26915),we=n(72269),Ae=n(34041),R=n(78045),e=n(85893),_t=["key","name"],wt=J.Z.TextArea,Ft=function(o){var ie=o.FirstValue,a=o.Detaillist,T=o.setDetaillist,xe=o.repository,ve=o.setRepository,k=o.Operationbentate,$=o.Ffromref,re=o.setFourthly_config_id,le=o.Fourthly_config_id,oe=o.Fourthly_select_list,b=o.Newproperties,y=o.setNewproperties,te=o.pageKeyfun,ue=o.firstjudgingcondition,Y=o.setAgentmunudisabled,de=o.agentmenudisabled,d=(0,C.useIntl)(),F=(0,x.useState)([]),G=p()(F,2),ae=G[0],Q=G[1],ce=(0,x.useState)({agent_id:0,data:{is_public:1,enable_api:0,obligations:null,input_variables:{},dataset_ids:[]}}),D=p()(ce,2),h=D[0],E=D[1];(0,x.useEffect)(function(){ye()},[]);var I=function(u){re(u)},L=function(u){E(t()(t()({},h),{},{data:t()(t()({},h.data),{},{obligations:u.target.value})})),T(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{obligations:u.target.value})}))},U=function(u,f){var m=new Set;return u.some(function(N){var S=N[f];return m.has(S)?m.add(S):m.add(S)&&!1})},me=function(u){T(t()(t()({},a),{},{app:t()(t()({},a.app),{},{is_public:u?1:0})})),E(t()(t()({},h),{},{data:t()(t()({},h.data),{},{is_public:u?1:0})}))},z=function(u){T(t()(t()({},a),{},{app:t()(t()({},a.app),{},{enable_api:u?1:0})})),E(t()(t()({},h),{},{data:t()(t()({},h.data),{},{enable_api:u?1:0})}))},q=function(u){T(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{allow_upload_file:u?1:0})}))},be=function(u){E(t()(t()({},h),{},{data:t()(t()({},h.data),{},{dataset_ids:u})})),ve(u)},ye=function(){var A=B()(_()().mark(function u(){var f;return _()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(0,V.zl)();case 2:f=N.sent,Q(f.data.data.map(function(S){return{value:S.dataset_id,label:S.name}}));case 4:case"end":return N.stop()}},u)}));return function(){return A.apply(this,arguments)}}(),Ce=function(){var A=B()(_()().mark(function u(){return _()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:ue()||(te("2"),Y(t()(t()({},de),{},{first:!1,second:!1})));case 1:case"end":return m.stop()}},u)}));return function(){return A.apply(this,arguments)}}(),Fe=function(u){T(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{default_output_format:u.target.value})}))};return(0,e.jsxs)("div",{style:{height:"100%",width:"900px",marginBottom:"30px"},children:[(0,e.jsx)("div",{className:"flex align-center justify-between mt-[30px]",children:(0,e.jsx)("div",{className:"text-base font-medium mb-[30px] text-[#333333]",children:d.formatMessage({id:"agent.menu.basicsetup"})})}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(g.Z,{name:"dynamic_form_nest_item",style:{width:"900px"},autoComplete:"off",form:$,children:[(0,e.jsx)(g.Z.List,{name:"users",children:function(u,f){var m,N=f.add,S=f.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:d.formatMessage({id:"agent.appname"})}),(0,e.jsxs)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:[(0,e.jsxs)("div",{children:[a&&a.app&&a.app.name,"\xA0"]}),(0,e.jsx)("div",{className:"",children:k==="true"?d.formatMessage({id:"agent.cannotmodify"}):""})]})]})}),(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:d.formatMessage({id:"agent.appdescription"})}),(0,e.jsx)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:a&&a.app&&a.app.description})]})}),(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(he.Z,{className:"font-medium",name:d.formatMessage({id:"agent.teamvisibility"}),title:d.formatMessage({id:"agent.explain.teamvisibility"})})}),(0,e.jsx)(we.Z,{size:"small",onChange:me,checked:!!(a&&a.app.is_public===1)})]}),(0,e.jsxs)("div",{className:"mb-[30px]  font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:d.formatMessage({id:"agent.APIswitch"})}),(0,e.jsx)(we.Z,{size:"small",onChange:z,checked:a&&a.app.enable_api===1,disabled:(a==null||(m=a.app)===null||m===void 0?void 0:m.publish_status)!==1})]}),(0,e.jsxs)("div",{className:"font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:d.formatMessage({id:"agent.filesupload"})}),(0,e.jsx)(we.Z,{size:"small",onChange:q,checked:!!(a&&a.agent.allow_upload_file==1)})]})]})}),(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:[(0,e.jsx)("span",{className:"text-[#E80000]",children:"* "}),d.formatMessage({id:"agent.LLMmodel"})]}),(0,e.jsx)(Ae.Z,{placeholder:d.formatMessage({id:"agent.pleaseselect"}),style:{width:270},value:le==0?d.formatMessage({id:"agent.pleaseselect"}):le,onChange:I,options:oe})]})}),(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",name:"obligations",children:(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(he.Z,{className:"font-medium",required:!0,name:d.formatMessage({id:"agent.functiondescription"}),title:d.formatMessage({id:"agent.explain.function"})})}),(0,e.jsx)(wt,{onChange:L,value:a&&a.agent&&a.agent.obligations,placeholder:"Agent".concat(d.formatMessage({id:"agent.functiondescription"})),autoSize:{minRows:8,maxRows:10}})]})}),(0,e.jsxs)("div",{className:"mb-[11px] text-xs font-bold flex justify-between items-center",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs",children:(0,e.jsx)(he.Z,{className:"font-medium",required:!0,name:d.formatMessage({id:"agent.inputvariable"}),title:d.formatMessage({id:"agent.explain.inputvariable"})})}),(0,e.jsx)("div",{children:(0,e.jsx)(X.ZP,{type:"link",onClick:function(){return N()},block:!0,icon:(0,e.jsx)(We.Z,{}),children:d.formatMessage({id:"agent.add"})})})]}),(0,e.jsxs)("div",{className:"w-full flex justify-start items-center text-xs font-medium px-2.5 text-[#555555] h-12 bg-[#F7F7F7] rounded-t-lg",children:[(0,e.jsx)("div",{className:"w-48 mr-5 ml-[10px]",children:d.formatMessage({id:"agent.variable.name"})}),(0,e.jsx)("div",{className:"w-52 mr-5",children:d.formatMessage({id:"agent.variable.display"})}),(0,e.jsx)("div",{className:"w-36 mr-[100px]",children:d.formatMessage({id:"agent.variable.type"})}),(0,e.jsx)("div",{className:"w-14 mr-[90px]",children:d.formatMessage({id:"agent.variable.required"})}),(0,e.jsx)("div",{children:d.formatMessage({id:"agent.variable.operation"})})]}),(0,e.jsx)("div",{className:"mb-[30px]",children:u.map(function(w){var K=w.key,ge=w.name,pe=$e()(w,_t);return(0,e.jsxs)("div",{className:"w-full h-20 flex justify-start  px-2.5 border-b border-x pt-7 last:rounded-b-lg",children:[(0,e.jsx)(g.Z.Item,t()(t()({className:"m-0"},pe),{},{name:[ge,"name"],rules:[{required:!0,message:d.formatMessage({id:"agent.rules.name"})},{pattern:/^[a-zA-Z0-9_]+$/,message:d.formatMessage({id:"agent.rules.verifydescription"})}],children:(0,e.jsx)(J.Z,{placeholder:d.formatMessage({id:"agent.variable.name"}),className:"w-48 mr-5"})})),(0,e.jsx)(g.Z.Item,t()(t()({className:"m-0"},pe),{},{name:[ge,"content"],rules:[{required:!0,message:d.formatMessage({id:"agent.rules.displayname"})}],children:(0,e.jsx)(J.Z,{placeholder:d.formatMessage({id:"agent.variable.display"}),className:"w-52 mr-5"})})),(0,e.jsx)(g.Z.Item,t()(t()({className:"w-36 mr-[110px] m-0"},pe),{},{name:[ge,"type"],children:(0,e.jsx)(Ae.Z,{defaultValue:"string",options:[{value:"string",label:"string"},{value:"number",label:"number"}]})})),(0,e.jsx)(g.Z.Item,t()(t()({className:"w-12 mr-[100px] m-0"},pe),{},{name:[ge,"status"],children:(0,e.jsx)(we.Z,{size:"small"})})),$&&$.getFieldsValue().users.length>1?(0,e.jsx)(g.Z.Item,{className:"m-0",children:(0,e.jsx)(He.Z,{onClick:function(){return S(ge)}})}):null]})})}),(0,e.jsxs)(g.Z.Item,{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs mb-[15px]",children:(0,e.jsx)(he.Z,{className:"font-medium",name:d.formatMessage({id:"agent.associatedknowledgebase"}),title:d.formatMessage({id:"agent.explain.associatedknowledgebase"})})}),(0,e.jsx)(Ae.Z,{size:"large",mode:"tags",style:{width:"100%"},placeholder:d.formatMessage({id:"agent.pleaseselect"}),value:xe,onChange:be,options:ae})]}),(0,e.jsx)(g.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"",children:[(0,e.jsxs)("div",{className:"text-[#555555] text-xs mb-[15px]",children:[" ",d.formatMessage({id:"agent.defaultoutputformat"})]}),(0,e.jsxs)(R.ZP.Group,{value:a&&a.agent.default_output_format,onChange:function(K){Fe(K)},children:[(0,e.jsx)(R.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text"})}),(0,e.jsx)(R.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"json"})}),(0,e.jsx)(R.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})]})})]})}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(X.ZP,{type:"primary",className:"mr-[20px]",onClick:function(){Ce()},children:d.formatMessage({id:"agent.btn.nextstep"})}),(0,e.jsxs)(X.ZP,{onClick:function(){history.back()},children:[" ",d.formatMessage({id:"agent.btn.back"})]})]}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Nt=Ft,St=n(49677),Zt=n.n(St),Mt=n(92485),Pt=n(85877),Xe=n(39944),At=n(71471),Ct=["key","name"],ga=At.Z.Title,pa=J.Z.TextArea,fa=J.Z.Search,kt=function(o){var ie=o.handleBack,a=o.Detaillist,T=o.setDetaillist,xe=o.Fourthly_select_list,ve=o.setFourthly_config_id,k=o.Fourthly_config_id,$=o.Fourthlyref,re=o.Fourthly_abilities_list,le=o.Operationbentate,oe=o.callwordlist,b=o.newagentid,y=(0,C.useIntl)(),te=(0,x.useState)(0),ue=p()(te,2),Y=ue[0],de=ue[1],d=(0,x.useState)(""),F=p()(d,2),G=F[0],ae=F[1],Q=(0,x.useState)(""),ce=p()(Q,2),D=ce[0],h=ce[1],E=(0,x.useState)(!1),I=p()(E,2),L=I[0],U=I[1],me=function(f){var m={user:{value:ye(f)}};ae(new Xe.z(m))},z=function(f){var m={user:{value:f.target.value}};ae(new Xe.z(m))},q=function(f){de(f)},be=function(f){var m=f.users.filter(function(w,K){return w.type=="number"&&!Number(w.value)&&!!w.value});if(!G.user)s.ZP.warning(y.formatMessage({id:"agent.message.warning.callword"}));else if(m.length>0)s.ZP.warning(y.formatMessage({id:"agent.message.warning.datatype"}));else{U(!0);var N=new fe.Kr("input","","");f.users.forEach(function(w){var K=new fe._w(w.name,w.type?w.type:"string",w.type=="string"?w.value:Number(w.value),w.content,w.status);N.addProperty(w.name,K)});var S={agent_id:b||a.agent.agent_id,ability_id:Y,input_dict:N,prompt:G};Ce(S)}},ye=function u(f){return f.map(function(m){return m.type==="mention"?m.id:m.children?u(m.children):m.text}).join("")},Ce=function(f){(0,V.LH)(f).then(function(m){s.ZP.success(y.formatMessage({id:"agent.message.success.runpublish"})),h(m.data.outputs.text),U(!1)}).catch(function(m){U(!1)})},Fe=function(){var u=B()(_()().mark(function f(){var m;return _()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(0,V.Dh)(b||a.agent.agent_id);case 2:m=S.sent,m.code==0?s.ZP.success(y.formatMessage({id:"agent.message.success.publish"})):s.ZP.error(y.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return S.stop()}},f)}));return function(){return u.apply(this,arguments)}}(),A=function(){var u=B()(_()().mark(function f(){return _()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:C.history.push("/Agents?app_id=".concat(a.app.app_id,"&type=false")),location.reload();case 2:case"end":return N.stop()}},f)}));return function(){return u.apply(this,arguments)}}();return(0,x.useEffect)(function(){},[]),(0,e.jsxs)("div",{style:{height:"100%"},children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:y.formatMessage({id:"agent.operationrun"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:y.formatMessage({id:"agent.selectivepower"})}),(0,e.jsx)(Ae.Z,{placeholder:y.formatMessage({id:"agent.pleaseselect"}),defaultValue:y.formatMessage({id:"agent.allability"}),style:{width:390,fontSize:"12px",color:"#BBBBBB",fontWeight:"400"},onChange:q,options:re})]}),(0,e.jsx)("div",{children:(0,e.jsxs)(g.Z,{name:"dynamic_form_nest_item",onFinish:be,style:{width:900},autoComplete:"off",form:$,children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:y.formatMessage({id:"agent.inputvariable"})}),(0,e.jsx)(g.Z.List,{name:"users",children:function(f,m){return Zt()(m),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"w-full flex justify-start items-center text-xs font-medium px-[10px] text-[#213044] h-12 bg-[#F7F7F7]  rounded-t-lg",children:[(0,e.jsx)("div",{className:"w-48 mr-5 ml-2.5",children:y.formatMessage({id:"agent.variable.name"})}),(0,e.jsx)("div",{className:"w-52",children:y.formatMessage({id:"agent.variable.value"})})]}),(0,e.jsx)("div",{className:"mb-[30px]",children:f.map(function(N){var S=N.key,w=N.name,K=$e()(N,Ct);return(0,e.jsxs)("div",{className:"w-full h-20 flex justify-start  px-2.5 border-b border-x pt-7 last:rounded-b-lg",children:[(0,e.jsx)(g.Z.Item,t()(t()({},K),{},{name:[w,"content"],children:(0,e.jsx)(J.Z,{className:"w-48 mr-5",style:{color:"#213044",fontWeight:"400",fontSize:"12px"},variant:"borderless",disabled:!0})})),(0,e.jsx)(g.Z.Item,t()(t()({},K),{},{name:[w,"value"],rules:[{required:!!($.getFieldsValue()&&$.getFieldsValue().users[S].status==!0),message:y.formatMessage({id:"agent.rules.veriablevalue"})}],children:(0,e.jsx)(J.Z,{style:{width:"660px"},placeholder:$.getFieldsValue()&&$.getFieldsValue().users[S].status==!0?y.formatMessage({id:"agent.variable.required.value"}):y.formatMessage({id:"agent.variable.value"})})}))]})})})]})}}),(0,e.jsxs)(g.Z.Item,{rules:[{required:!0,message:y.formatMessage({id:"agent.rules.callwordvalue"})}],children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:y.formatMessage({id:"agent.runpreview"})}),(0,e.jsx)(Ke.Z,{spinning:L,children:(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-3.5 rounded-lg",children:[(0,e.jsx)("div",{className:"h-[345px] mb-[30px]",children:D?(0,e.jsx)(Mt.Z,{language:"python3",value:D&&JSON.stringify(D)}):null}),(0,e.jsxs)("div",{className:"agents-input p-2 bg-white border rounded-md my-2 flex items-center justify-between",style:{border:"1px solid #EEE"},children:[(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Pt.Z,{onChange:function(f){me(f)},options:oe})}),(0,e.jsx)("div",{className:"w-8 h-8 bg-[#e8effc] rounded-md",children:(0,e.jsx)(X.ZP,{className:"bg-[#e8effc]",icon:(0,e.jsx)("img",{src:"/icons/fs.svg"}),type:"link",htmlType:"submit",block:!0})})]})]})})]})]})}),(0,e.jsx)("div",{className:"w-28",children:(a==null?void 0:a.agent.publish_status)===1&&(a==null?void 0:a.is_creator)===1?(0,e.jsx)("div",{children:(0,e.jsx)(X.ZP,{type:"primary",htmlType:"submit",className:"w-full",onClick:A,children:y.formatMessage({id:"agent.amend"})})}):(0,e.jsx)("div",{children:(0,e.jsx)(X.ZP,{type:"primary",htmlType:"submit",className:"w-full",disabled:le!="false",onClick:Fe,children:y.formatMessage({id:"agent.publish"})})})}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})},Dt=kt,Et=["key","name"],Tt=J.Z.TextArea,It=function(o){var ie=o.SecondValue,a=o.handleBack,T=o.Detaillist,xe=o.setDetaillist,ve=o.Sformref,k=o.Operationbentate,$=o.pageKeyfun,re=o.secondjudgingcondition,le=o.SkillMenuClick,oe=o.agentupdata,b=(0,C.useIntl)(),y=s.ZP.useMessage(),te=p()(y,2),ue=te[0],Y=te[1],de=(0,x.useState)({auto_match_ability:0,agent_abilities:[{agent_ability_id:0,name:"string",content:"string",status:0}]}),d=p()(de,2),F=d[0],G=d[1];(0,x.useEffect)(function(){});var ae=function(h){if(h.users.length==1&&(!h.users[0].content&&h.users[0].name||h.users[0].content&&!h.users[0].name))return s.ZP.warning(b.formatMessage({id:"agent.message.warning.selectknowledgebase"}));var E=h.users.map(function(L){return t()(t()({},L),{},{status:L.status?1:2,agent_ability_id:L.agent_ability_id?L.agent_ability_id:0})}),I={agent_id:T.agent.agent_id,data:{auto_match_ability:T.agent.auto_match_ability,agent_abilities:h.users.length==1&&!h.users[0].content&&!h.users[0].name?[]:E}};k=="false"&&Q(),ie(t()({},F))},Q=function(){var D=B()(_()().mark(function h(){return _()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:re()||oe();case 1:case"end":return I.stop()}},h)}));return function(){return D.apply(this,arguments)}}(),ce=function(h){xe(t()(t()({},T),{},{agent:t()(t()({},T.agent),{},{auto_match_ability:h?1:0})}))};return(0,e.jsxs)("div",{style:{height:"100%"},children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:b.formatMessage({id:"agent.Applicationcapabilitysetting"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:(0,e.jsx)(he.Z,{name:b.formatMessage({id:"agent.automatch"}),title:b.formatMessage({id:"agent.explain.automatch"})})}),(0,e.jsx)(we.Z,{size:"small",checked:!!(T&&T.agent.auto_match_ability==1),onChange:ce})]}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(g.Z,{name:"dynamic_form_nest_item",onFinish:ae,style:{width:900},autoComplete:"off",form:ve,children:[(0,e.jsx)(g.Z.List,{name:"users",children:function(h,E){var I=E.add,L=E.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-full flex items-center justify-between mb-[11px]",children:(0,e.jsx)("div",{className:" text-[#555555] text-xs font-medium",children:b.formatMessage({id:"agent.capability"})})}),h.map(function(U){var me=U.key,z=U.name,q=$e()(U,Et);return(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-[15px] rounded-lg mb-[20px]",children:[(0,e.jsx)(g.Z.Item,{className:"mb-0",children:(0,e.jsxs)("div",{className:"w-full flex justify-between items-center mb-[15px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium",children:b.formatMessage({id:"agent.capabilityname"})}),(0,e.jsxs)("div",{children:[" ",(0,e.jsx)(He.Z,{onClick:function(){return L(z)}})]})]})}),(0,e.jsx)(g.Z.Item,t()(t()({className:"mb-[20px]"},q),{},{name:[z,"name"],rules:[{required:h.length!==1,message:b.formatMessage({id:"agent.capabilityname"})}],children:(0,e.jsx)(J.Z,{placeholder:b.formatMessage({id:"agent.capabilityname"}),className:"w-full"})})),(0,e.jsx)("div",{className:"mb-[15px]",children:(0,e.jsx)(he.Z,{className:"text-[#555555] text-xs font-medium",name:b.formatMessage({id:"agent.capabilitydescription"}),title:b.formatMessage({id:"agent.explain.capabilitydescription"})})}),(0,e.jsx)(g.Z.Item,t()(t()({className:"w-full mb-[20px]"},q),{},{name:[z,"content"],rules:[{required:h.length!==1,message:b.formatMessage({id:"agent.capabilitydescription"})}],children:(0,e.jsx)(Tt,{placeholder:b.formatMessage({id:"agent.capabilitydescription"}),autoSize:{minRows:3,maxRows:10},className:"w-full"})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[15px]",children:b.formatMessage({id:"agent.capabilitystatus"})}),(0,e.jsx)(g.Z.Item,t()(t()({className:"mb-[20px]"},q),{},{name:[z,"status"],children:(0,e.jsxs)(R.ZP.Group,{optionType:"button",buttonStyle:"solid",defaultValue:!0,children:[(0,e.jsx)(R.ZP,{value:!0,children:b.formatMessage({id:"agent.capabilitystatus.enable"})}),(0,e.jsx)(R.ZP,{value:!1,children:b.formatMessage({id:"agent.capabilitystatus.disable"})})]})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[11px]",children:b.formatMessage({id:"agent.enableall"})}),(0,e.jsx)(g.Z.Item,{className:"mb-0",name:[z,"output_format"],children:(0,e.jsxs)(R.ZP.Group,{defaultValue:0,children:[(0,e.jsx)(R.ZP,{value:0,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:b.formatMessage({id:"agent.menu"})})}),(0,e.jsx)(R.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text string"})}),(0,e.jsx)(R.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"format json"})}),(0,e.jsx)(R.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})})]})}),(0,e.jsxs)("div",{onClick:function(){return I()},className:"w-full p-6  flex items-center justify-center border  border-transparent  hover:border-dashed  hover:border-[#1B64F3] hover:text-[#1B64F3] cursor-pointer bg-[#F7F7F7] rounded-lg mb-4",children:[(0,e.jsx)(We.Z,{})," ",b.formatMessage({id:"agent.add"})]})]})}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(X.ZP,{type:"primary",className:"mr-[20px]",onClick:function(){Q()},children:b.formatMessage({id:"agent.btn.savedebug"})}),(0,e.jsx)(X.ZP,{onClick:function(){history.back()},children:b.formatMessage({id:"agent.btn.back"})})]}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Bt=It,Vt=function(){var o,ie,a=(0,C.useIntl)(),T=(0,x.useRef)(null),xe=g.Z.useForm(),ve=p()(xe,1),k=ve[0],$=g.Z.useForm(),re=p()($,1),le=re[0],oe=g.Z.useForm(),b=p()(oe,1),y=b[0],te=g.Z.useForm(),ue=p()(te,1),Y=ue[0],de=(0,x.useState)(null),d=p()(de,2),F=d[0],G=d[1],ae=(0,x.useState)(0),Q=p()(ae,2),ce=Q[0],D=Q[1],h=(0,x.useState)(null),E=p()(h,2),I=E[0],L=E[1],U=(0,x.useState)(null),me=p()(U,2),z=me[0],q=me[1],be=(0,x.useState)(null),ye=p()(be,2),Ce=ye[0],Fe=ye[1],A=(0,x.useState)(null),u=p()(A,2),f=u[0],m=u[1],N=(0,x.useState)(null),S=p()(N,2),w=S[0],K=S[1],ge=(0,x.useState)(null),pe=p()(ge,2),Ne=pe[0],ke=pe[1],Lt=(0,x.useState)(null),Je=p()(Lt,2),ha=Je[0],xa=Je[1],Rt=(0,x.useState)(null),Ye=p()(Rt,2),$t=Ye[0],Gt=Ye[1],Ut=(0,x.useState)(null),Qe=p()(Ut,2),je=Qe[0],zt=Qe[1],Kt=(0,x.useState)("1"),qe=p()(Kt,2),se=qe[0],_e=qe[1],Wt=(0,x.useState)(null),et=p()(Wt,2),Ht=et[0],tt=et[1],Xt=(0,x.useState)(null),at=p()(Xt,2),Jt=at[0],Yt=at[1],Qt=(0,x.useState)(null),st=p()(Qt,2),qt=st[0],nt=st[1],ea=(0,x.useState)(null),it=p()(ea,2),Se=it[0],rt=it[1],ta=(0,x.useState)(!1),lt=p()(ta,2),aa=lt[0],ot=lt[1],sa=(0,x.useState)({first:!1,second:!1,fourthly:!1}),ut=p()(sa,2),Ze=ut[0],De=ut[1],na=[{key:"1",icon:(0,e.jsx)(Le.Z,{}),label:a.formatMessage({id:"agent.menu.basicsetup"}),disabled:Ze.first,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",lineHeight:"22px",color:se=="1"?"#1B64F3":"#213044"}},{key:"2",disabled:Ze.second,icon:(0,e.jsx)(Re.Z,{}),label:a.formatMessage({id:"agent.menu.Capacityoutput"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:se=="2"?"#1B64F3":"#213044"}},{key:"4",disabled:Ze.fourthly,icon:(0,e.jsx)(H.Z,{}),label:a.formatMessage({id:"agent.operationrun"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:se=="4"?"#1B64F3":"#213044"}}];(0,x.useEffect)(function(){var M=new URLSearchParams(window.location.search);M.get("app_id")||De(t()(t()({},Ze),{},{first:!1,second:!0,fourthly:!0})),Ee()},[]);var Ee=function(){var M=B()(_()().mark(function l(i){var r,j,v,c,ht,ze,xt,vt;return _()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(j=new URLSearchParams(window.location.search),j.get("from")&&Yt(j.get("from")),v=null,!(j.get("app_id")||i)){ee.next=10;break}return ee.next=6,(0,V.ek)(i||j.get("app_id"),j.get("type"));case 6:v=ee.sent,rt(v.data.app.app_id),ee.next=13;break;case 10:return ee.next=12,(0,ne.cI)();case 12:v=ee.sent;case 13:c=v.data,ht=(r=v.data)===null||r===void 0||(r=r.agent_dataset_relation_list)===null||r===void 0?void 0:r.map(function(P){return P.dataset_id}),L(ht),G(v.data),zt(v.data.agent.publish_status===0&&v.data.is_creator===1?"false":"true"),v.data.agent.publish_status===1&&s.ZP.warning(a.formatMessage({id:"agent.message.listwarning"}),5),k.setFieldsValue(dt(c.agent.input_variables)),ze=v.data.agent_abilities_list.map(function(P){return P.status==1?t()(t()({},P),{},{status:!0}):t()(t()({},P),{},{status:!1})}),y.setFieldsValue({users:ze[0]?ze:[{agent_ability_id:0,name:"",content:"",status:!0,output_format:0}]}),Fe(Ue(c.agent_abilities_list)),m(Ue(c.agent_abilities_list)),xt=c.agent_abilities_list.filter(function(P){return P.output_format!==0}),le.setFieldsValue({users:xt.map(function(P){return{agent_ability_id:P.agent_ability_id,output_format:P.output_format}})}),Y.setFieldsValue(dt(c.agent.input_variables)),K(c.m_configurations_list.map(function(P){return{value:P.m_config_id?P.m_config_id:P.model_config_id,label:P.m_name?P.m_name:P.model_name}})),c.agent.m_config_id||c.agent.model_config_id?ke(c.agent.m_config_id?c.agent.m_config_id:c.agent.model_config_id):ke(c.m_configurations_list[0].model_config_id),vt=c.agent_abilities_list.filter(function(P,ba){return P.status===1}),Gt(Ue(vt).concat([{value:0,label:a.formatMessage({id:"agent.allability"})}]));case 31:case"end":return ee.stop()}},l)}));return function(i){return M.apply(this,arguments)}}(),dt=function(l){var i={users:l&&l.properties?Object.values(l.properties).map(function(r){return{name:r.name,type:r.type,content:r.display_name,status:r.required}}):[{name:"",content:"",type:"string",agent_ability_id:0,output_format:0,status:0}]};return i},Ue=function(l){return l.map(function(i){return{value:i.agent_ability_id,label:i.name}})},ia=function(l){ft(l,1),Y.setFieldsValue(k.getFieldsValue())},ra=function(){Ee()},ct=function(l){D(l)},la=function(){history.back()},oa=function(){var l=k.getFieldsValue().users.filter(function(i){return!i||!i.name||!i.content});if(k.getFieldsValue().users[0])if(Ne)if(F.agent.obligations){if(l.length!==0)return s.ZP.warning(a.formatMessage({id:"agent.message.warning.completevariable"})),!0;if(ca(k.getFieldsValue().users,"name"))return s.ZP.warning(a.formatMessage({id:"agent.message.warning.repetition"})),!0}else return s.ZP.warning(a.formatMessage({id:"agent.message.warning.functiondescribe"})),!0;else return s.ZP.warning(a.formatMessage({id:"agent.message.warning.LLM"})),!0;else return s.ZP.warning(a.formatMessage({id:"agent.message.warning.variable"})),!0;return!1},ua=function(){var l=y.getFieldsValue().users.filter(function(r){return!!r}),i=l.filter(function(r){return!r.name||!r.content});return i.length!==0&&!(i.length==1&&i[0].name==""&&i[0].content=="")?(s.ZP.warning(a.formatMessage({id:"agent.message.warning.integritycapacity"})),!0):!1},mt=function(l){if((l==null?void 0:l.key)=="4"){var i=k.getFieldsValue().users.map(function(r){return{value:"<<".concat(Pe.qX,".inputs.").concat(r.name,">>"),label:r.name}});tt(i)}_e(l.key)},da=function(){ot(!0);var l=0;Se?(0,V.ek)(Se,!1).then(function(i){l=i.data.agent.agent_id,gt(l),setTimeout(function(){pt(l),s.ZP.success(a.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Ee(Se)},1e3),nt(l)}).catch(function(i){}):(0,Ve.uy)((0,ne.Go)("GET")).then(function(i){rt(i.data.app_id),(0,V.ek)(Se||i.data.app_id,!1).then(function(r){l=r.data.agent.agent_id,gt(l),setTimeout(function(){pt(l),s.ZP.success(a.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Ee(i.data.app_id);var j=t()(t()({},(0,ne.Go)("GET")),{},{app_id:i.data.app_id});(0,ne.Go)("SET",j)},1e3),nt(l)}).catch(function(r){})}).catch(function(i){})},gt=function(l,i){k.validateFields().then(function(r){var j={agent_id:l,data:{is_public:F.app.is_public,enable_api:F.app.enable_api,obligations:F.agent.obligations,input_variables:ma(k.getFieldsValue()),dataset_ids:I,m_config_id:Ne,allow_upload_file:F.agent.allow_upload_file,default_output_format:F.agent.default_output_format}};je=="false"&&ft(j,1),Y.setFieldsValue(k.getFieldsValue());var v=k.getFieldsValue().users.map(function(c){return{value:"<<".concat(Pe.qX,".inputs.").concat(c.name,">>"),label:c.name}});tt(v),i&&_e(i.key)}).catch(function(r){})},pt=function(l){var i=y.getFieldsValue().users.filter(function(v){return!!v}),r=i.map(function(v){return t()(t()({},v),{},{status:v.status==!1?2:1,agent_ability_id:v.agent_ability_id?v.agent_ability_id:0,output_format:v.output_format?v.output_format:0})}),j={agent_id:l,data:{auto_match_ability:F.agent.auto_match_ability,agent_abilities:r}};je=="false"&&(r.length==1&&r[0].name==""&&r[0].content==""?(De({first:!1,second:!1,fourthly:!1}),_e("4")):(0,V.Iw)(j).then(function(v){v.code==0&&(De({first:!1,second:!1,fourthly:!1}),_e("4"))}).catch(function(v){}))},ft=function(){var M=B()(_()().mark(function l(i,r){var j;return _()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(je!=="false"){c.next=19;break}if(r!==1){c.next=7;break}return c.next=4,(0,V.XB)(i);case 4:c.t0=c.sent,c.next=17;break;case 7:if(r!==2){c.next=13;break}return c.next=10,(0,V.Iw)(i);case 10:c.t1=c.sent,c.next=16;break;case 13:return c.next=15,(0,V.Ce)(i);case 15:c.t1=c.sent;case 16:c.t0=c.t1;case 17:j=c.t0,j&&j.code===0&&ot(!1);case 19:case"end":return c.stop()}},l)}));return function(i,r){return M.apply(this,arguments)}}(),ca=function(l,i){var r=new Set;return l.some(function(j){var v=j[i];return r.has(v)?r.add(v):r.add(v)&&!1})},ma=function(l){var i=new fe.Kr("input","","");return l.users.forEach(function(r){var j=new fe._w(r.name,r.type?r.type:"string",r.value?r.value:"",r.content,r.status);i.addProperty(r.name,j)}),i};return(0,e.jsxs)("div",{className:" flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsxs)("div",{className:"flex flex-col w-[300px]",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"flex w-full items-center bg-white px-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsxs)(X.ZP,{type:"link",shape:"circle",size:"middle",className:"",onClick:la,children:[(0,e.jsx)(O.Z,{}),(0,e.jsx)("span",{className:"text-sm font-medium text-[#213044]",children:Jt=="chat_room"?a.formatMessage({id:"agent.back_meeting"}):a.formatMessage({id:"agent.back"})})]})}),(0,e.jsxs)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:[(0,e.jsx)(yt.Z,{selectedKeys:[se],onClick:mt,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[se],mode:"inline",items:na}),F&&F.app.enable_api===1&&F.app.publish_status===1?(0,e.jsx)("div",{className:"w-full h-[40px] rounded-lg text-[#000] hover:bg-[#f0f0f0] p-[12px] pl-[16px] cursor-pointer",onClick:B()(_()().mark(function M(){var l,i;return _()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(l=new URLSearchParams(window.location.search),i=null,!l.get("app_id")){j.next=6;break}return j.next=5,(0,V.ek)(l.get("app_id"),l.get("type"));case 5:i=j.sent;case 6:i!=null&&i.data.app.enable_api===1&&i.data.app.publish_status===1?window.open(Oe._n+F.app.api_url):s.ZP.warning(a.formatMessage({id:"agent.save.and.click"}),5);case 7:case"end":return j.stop()}},M)})),children:(0,e.jsxs)("div",{className:"mr-[20px] text-base font-medium text-[#213044] -mt-1",children:[(0,e.jsx)(Z.Z,{className:"mr-3"}),a.formatMessage({id:"agent.visit"})," API"]})}):null]})]}),(0,e.jsx)(Ke.Z,{spinning:aa,size:"large",className:"mt-[112px]",children:(0,e.jsx)("div",{className:"flex flex-col",style:{height:"calc(100vh - 56px)",width:"calc(100vw - 230px)",overflowY:"scroll",scrollbarWidth:"none"},children:(0,e.jsxs)("div",{className:"px-[30px] ",style:{overflowX:"auto",minWidth:"960px",height:"100%"},children:[(0,e.jsx)("div",{className:"w-full flex justify-center  mt-[30px]",children:(0,e.jsxs)("div",{className:"flex items-center  w-[900px] ",children:[(0,e.jsx)("div",{className:"mr-[10px] w-[16px] h-[16px]",children:(0,e.jsx)("img",{src:"/icons/flag.svg",alt:"",className:"w-[16px] h-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"mr-[6px] text-lg text-[#213044] font-medium",children:[(o=(0,ne.Go)("GET"))!==null&&o!==void 0&&o.app_id?a.formatMessage({id:"agent.compile"}):a.formatMessage({id:"agent.created"}),a.formatMessage({id:"agent"})]}),(F==null||(ie=F.app)===null||ie===void 0?void 0:ie.publish_status)===1?(0,e.jsx)("div",{className:"bg-[#1B64F3] px-[7px] text-[#fff] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:a.formatMessage({id:"agent.havepublished"})}):(0,e.jsx)("div",{className:" bg-[#EEE] px-[7px]  text-[#999] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:a.formatMessage({id:"agent.unpublish"})})]})]})}),(0,e.jsx)("div",{style:{display:se==="1"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Nt,{FirstValue:ia,Ffromref:k,Detaillist:F,setDetaillist:G,repository:I,setRepository:L,Newproperties:z,setNewproperties:q,Operationbentate:je,Fourthly_config_id:Ne,setFourthly_config_id:ke,Fourthly_select_list:w,pageKeyfun:_e,firstjudgingcondition:oa,agentmenudisabled:Ze,setAgentmunudisabled:De})}),(0,e.jsx)("div",{style:{display:se==="2"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Bt,{SecondValue:ra,Detaillist:F,setDetaillist:G,Sformref:y,Operationbentate:je,handleBack:ct,pageKeyfun:_e,SkillMenuClick:mt,secondjudgingcondition:ua,agentupdata:da})}),(0,e.jsx)("div",{style:{display:se==="4"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Dt,{handleBack:ct,Detaillist:F,setDetaillist:G,Fourthly_select_list:w,Fourthly_config_id:Ne,setFourthly_config_id:ke,Fourthlyref:Y,Fourthly_abilities_list:$t,Operationbentate:je,callwordlist:Ht,newagentid:qt})})]})})})]})},Ot=Vt}}]);
