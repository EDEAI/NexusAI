"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{86:function(Qe,be,f){var De=f(5574),L=f.n(De),Ie=f(32332),ne=f(38703),Ae=f(67294),x=f(85893),ce=function(a){var ae=a.subtitle,Ee=a.handleClick,oe=a.lineClamp,ze=oe===void 0?2:oe,Y=a.textDetails,fe=a.title,Pe=a.icon,_e=a.iconType,Ce=_e===void 0?"":_e,Re=a.operation,Se=Re===void 0?"":Re,je=a.progress,pe=a.status,ke=a.backlogTips,Me=(0,Ae.useState)(0),he=L()(Me,2),Ne=he[0],we=he[1],Oe=function(){we(je)},Te=function(){we(0)},$e=function(e){return"rounded-[4px] border-l-[4px] ".concat(e==1?"border-[#1B64F3]":e==2?"border-[#52C41C]":"border-[#F04444]"," ")};return(0,x.jsxs)("div",{className:"flex  p-[10px] cursor-pointer overflow-hidden relative bg-[#fff] ".concat(pe!==void 0?$e(pe):"graphicbox"),onClick:Ee,onMouseEnter:function(){je!=null&&Oe()},onMouseLeave:function(){je!=null&&Te()},children:[pe!==void 0&&(0,x.jsx)("div",{style:{width:"".concat(Ne,"%"),transition:"width 0.5s "},className:"absolute bottom-0 left-0 top-0 bottom-0 h-full ".concat(pe==1?"bg-[#1B64F3]/[.03]":pe==2?"bg-[#52c41c]/[.05]":"bg-[#FAFAFA]"," ")}),(0,x.jsxs)("div",{className:"flex gap-x-[20px] w-full relative z-20",children:[(0,x.jsx)("div",{className:"shrink-0 flex gap-x-[7px] items-center",style:{fontSize:0},children:(0,x.jsxs)("div",{className:"w-[40px] h-[40px] rounded-[6px] flex items-center justify-center bg-[#F4F8F1] relative",children:[(0,x.jsx)("img",{src:(0,Ie.s9)("single",Pe),className:"w-[22px] h-[22px]"}),Ce&&(0,x.jsx)("div",{className:"w-[16px] h-[16px] absolute top-[28px] left-[28px] flex items-center justify-center bg-[#fff] rounded-[3px]",style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,x.jsx)("img",{src:"/icons/".concat(Ce,".svg"),alt:"",className:"w-[12px] h-[12px]"})})]})}),(0,x.jsx)("div",{className:"flex flex-1 min-w-0",children:(0,x.jsxs)("div",{className:"flex justify-center flex-col gap-y-[5px] flex-1 min-w-0",children:[(0,x.jsxs)("span",{className:"text-[12px] flex items-center",style:{color:"#213044"},children:[(0,x.jsx)("span",{className:"truncate",children:fe}),(0,x.jsx)("span",{className:"flex items-center flex-1",children:ae})]}),(0,x.jsx)("span",{className:"text-[12px] max-w-full truncate",style:{color:"#999999"},children:Y})]})}),ke||(0,x.jsx)(x.Fragment,{}),Se&&(0,x.jsx)("div",{className:"flex items-center w-[24px]",children:(0,x.jsx)("span",{className:"operation",children:Se})}),je!=null&&(0,x.jsx)("div",{className:"graphic_progress flex items-center pl-[30px]",children:(0,x.jsx)(ne.Z,{type:"circle",percent:je,size:29})})]})]})};be.Z=ce},53885:function(Qe,be,f){f.r(be),f.d(be,{default:function(){return Na}});var De=f(15009),L=f.n(De),Ie=f(99289),ne=f.n(Ie),Ae=f(5574),x=f.n(Ae),ce=f(43722),ge=f(32983),a=f(67294),ae=f(35312),Ee=f(19632),oe=f.n(Ee),ze=f(97857),Y=f.n(ze),fe=f(32332),Pe=f(82114),_e=f(82826),Ce=f(63783),Re=f(3471),Se=f(45360),je=f(85576),pe=f(28036),ke=f(83062),Me=f(72269),he=f(74330),Ne=f(96486),we=f(44010),Oe=f(73445),Te=f(782),$e=(0,Oe.Ue)((0,Te.mW)(function(d,n){return{clearMemory:null,truncatable:!1,disableInput:!1,summaryParams:null,runsSummaryShow:!1,summaryClick:!0,setClearMemory:function(u){d({clearMemory:u})},setTruncatable:function(u){d({truncatable:u})},setDisableInput:function(u){d({disableInput:u})},setSummaryParams:function(u){d({summaryParams:u})},setRunsSummaryShow:function(u){d({runsSummaryShow:u})},setSummaryClick:function(u){console.log(u),d({summaryClick:u})}}})),q=$e,e=f(85893),Xe=function(n){var s=(0,ae.useIntl)(),u=n.roomDetail,_=n.setAgent,o=Se.ZP.useMessage(),p=x()(o,2),j=p[0],T=p[1],h=(0,ae.useParams)(),S=h.id,m=q(function(i){return i.disableInput}),k=q(function(i){return i.truncatable}),b=q(function(i){return i.setClearMemory}),M=(0,a.useState)([]),E=x()(M,2),c=E[0],Z=E[1],te=(0,a.useState)(Y()({},u)),H=x()(te,2),R=H[0],K=H[1],t=(0,a.useState)([]),G=x()(t,2),P=G[0],D=G[1],V=(0,a.useRef)(!1),X=(0,a.useRef)(!1),U=(0,a.useState)(!1),W=x()(U,2),ee=W[0],I=W[1],A=function(){var r=je.Z.confirm;r({title:s.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Pe.Z,{}),content:s.formatMessage({id:"app.chatroom.clear.tips"}),okText:s.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:s.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){b(["TRUNCATE","0"])}})},$=function(){var i=ne()(L()().mark(function r(){var l;return L()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!S){v.next=5;break}return v.next=3,(0,ce.cH)({id:S});case 3:if(l=v.sent,l.code==0)try{K(function(){return Y()(Y()({},l.data.chat_info),{},{max_round:l.data.max_round,smart_selection:l.data.smart_selection})}),Z(l.data.agent_list),V.current=!0}catch(w){}case 5:case"end":return v.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),ie=function(){var i=ne()(L()().mark(function r(){var l;return L()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,ce.j2)({id:S});case 2:l=v.sent,l.code==0&&(D(l.data.list),X.current=!0);case 4:case"end":return v.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),se=function(){var i=ne()(L()().mark(function r(l){var y,v,w;return L()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!S){C.next=11;break}if(y=l.active==1?0:1,y!=0){C.next=7;break}if(v=c.filter(function(J){return J.active==1}),v.length-1!=0){C.next=7;break}return j.open({type:"error",content:s.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),C.abrupt("return",!1);case 7:return C.next=9,(0,ce.sT)({active:y},S,l.agent_id);case 9:w=C.sent,w.code==0&&Z(function(J){return J.map(function(xe){return Y()(Y()({},xe),{},{active:xe.agent_id==l.agent_id?y:xe.active})})});case 11:case"end":return C.stop()}},r)}));return function(l){return i.apply(this,arguments)}}(),le=function(r){return r.length>6?r.length=6:r.lenth,r},Q=function(r){r.type=="my_agent"?ae.history.push("/Agents?app_id=".concat(r.app_id,"&type=false&from=chat_room")):ae.history.push("/ReadOnlyAgent?app_id=".concat(r.app_id,"&type=true&from=chat_room"))},F=function(r){ae.history.replace("/chat_room/".concat(r.chatroom_id)),window.location.reload()},z=function(){I(!0)},N=function(){I(!1)},g=function(){var i=ne()(L()().mark(function r(l){var y,v,w;return L()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(l.checkItem&&l.checkItem.length==0)){C.next=3;break}return j.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),C.abrupt("return");case 3:return y=oe()(l.checkItem).map(function(J){var xe=J.agent_id,re=J.active,de=re===void 0?1:re;return{agent_id:xe,active:de}}),v={description:R.description,name:R.name,max_round:R.max_round},C.next=7,(0,ce.sI)(Y()(Y()({},v),{},{agent:y}),S);case 7:w=C.sent,w.code==0?(l.checkItem.map(function(J){J.active=J.active==null?1:J.active}),Z(oe()(l.checkItem)),_.current=oe()(l.checkItem),j.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):j.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return C.stop()}},r)}));return function(l){return i.apply(this,arguments)}}(),O=function(){var i=ne()(L()().mark(function r(){var l;return L()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=R.smart_selection==1?0:1,v.next=3,(0,ce.r5)({smart_selection:l},S);case 3:K(function(w){return Y()(Y()({},w),{},{smart_selection:l})});case 4:case"end":return v.stop()}},r)}));return function(){return i.apply(this,arguments)}}();return(0,a.useEffect)(function(){$(),ie()},[]),(0,e.jsxs)(e.Fragment,{children:[T,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){ae.history.go(-1)},children:[(0,e.jsx)(pe.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(_e.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:s.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:R.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(ke.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:s.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ce.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:s.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Me.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:R.smart_selection==1,onChange:O,disabled:m})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:V.current?(0,e.jsx)("div",{className:"flex flex-col",children:c&&c.length>0?c.map(function(i){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,fe.s9)("single",i.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:i.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:i.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){Q(i)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Me.Z,{size:"small",disabled:m,defaultChecked:!0,className:"w-[28px]",checked:i.active==1,onChange:function(){se(i)}})]})]},i.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ge.Z,{image:ge.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:z,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:k&&!m?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Ne.throttle)(function(){k&&!m&&A()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:s.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:s.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:X.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:P&&P.length>0?P.map(function(i){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){F(i)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:i.name}),i.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:s.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:i.agent_list&&i.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[le(i.agent_list).map(function(r,l){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,fe.s9)("single",r.icon),alt:"",className:"w-[18px]  h-[18px]"})})},l)}),i.agent_list.length>=6?(0,e.jsx)(Re.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},i.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ge.Z,{image:ge.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})})]})]}),(0,e.jsx)(we.Z,{show:ee,popupClose:N,popupSave:g,checkList:c,zIndex:99})]})]})},qe=(0,a.memo)(Xe),et=f(13769),tt=f.n(et),at=f(47635),ue=f(1413),nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},rt=nt,ye=f(91146),st=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:rt}))},it=a.forwardRef(st),lt=it,ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},ot=ct,ut=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:ot}))},dt=a.forwardRef(ut),pt=dt,xt=f(2068),ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},mt=ft,vt=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:mt}))},ht=a.forwardRef(vt),gt=ht,Ve=f(26915),jt=f(20640),Ue=f.n(jt),me=f(22683),ve=f(97807),yt=["node","className","children"],St=Ve.Z.TextArea,Nt=(0,a.memo)(function(d){var n=d.setInstruction,s=d.messageApi,u=d.isStop,_=d.scrollDomRef,o=d.upButtonDom,p=(0,ae.useIntl)(),j=q(function(E){return E.disableInput}),T=q(function(E){return E.setDisableInput}),h=(0,a.useState)(""),S=x()(h,2),m=S[0],k=S[1],b=function(c){!c.shiftKey&&c.target.value==""&&(s.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),k(""),c.preventDefault()),!c.shiftKey&&c.keyCode==13&&c.target.value!=""&&(T(!0),k(""),n(["INPUT",c.target.value]),c.preventDefault())},M=(0,Ne.throttle)(function(){n(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:o,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(c){_.current.scrollTo({top:_.current.scrollHeight,behavior:"smooth"})},children:(0,e.jsx)(lt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(St,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:m,disabled:j,onChange:function(c){k(c.target.value)},onPressEnter:b,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(p.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:M,children:(0,e.jsx)(pt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(j||!m?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Ne.throttle)(function(){if(j||!m)return!1;m||s.open({type:"warning",content:p.formatMessage({id:"app.chatroom.content.input"}),duration:10}),T(!0),n(["INPUT",m]),k("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),wt=function d(n){return typeof n=="string"?n:Array.isArray(n)?n.map(d).join(""):a.isValidElement(n)?d(n.props.children):""},bt=function(n){return wt(n)},Le=function(n,s){return{code:function(_){var o=_.node,p=_.className,j=_.children,T=tt()(_,yt),h=/language-(\w+)/.exec(p||"");if(h!=null&&h.length){var S=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:h[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var m=ne()(L()().mark(function k(b){var M;return L()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,M=b.currentTarget,c.next=4,Ue()(bt(j));case 4:M&&(M.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){M&&(M.children[1].innerText=s.formatMessage({id:"app.chatroom.content.copycode"}))},200),c.next=11;break;case 8:c.prev=8,c.t0=c.catch(0),console.error("Failed to copy text: ",c.t0);case 11:case"end":return c.stop()}},k,null,[[0,8]])}));return function(k){return m.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:s.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(S).concat(n),className:"p-4",children:j})})]})}else return(0,e.jsx)("code",Y()(Y()({},T),{},{children:j}))}}},We=(0,a.memo)(function(d){var n=d.messageApi,s=d.index,u=d.idName,_=d.cidName,o=(0,ae.useIntl)(),p=(0,a.useState)(!1),j=x()(p,2),T=j[0],h=j[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){h(!0)},onMouseLeave:function(){h(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var S=ne()(L()().mark(function m(k){var b,M;return L()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return b=k.target.closest("#".concat(u).concat(s)),M=b.querySelector("#".concat(_).concat(s)),c.prev=2,c.next=5,Ue()(M.innerText);case 5:n.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),c.next=11;break;case 8:c.prev=8,c.t0=c.catch(2),console.error("Failed to copy text: ",c.t0);case 11:case"end":return c.stop()}},m,null,[[2,8]])}));return function(m){return S.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(T?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(T?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Ge=function(n){var s=n.id,u=n.index,_=n.idName,o=n.cidName,p=(0,ae.useIntl)(),j=q(function(M){return M.setSummaryClick}),T=(0,a.useState)(!0),h=x()(T,2),S=h[0],m=h[1],k=q(function(M){return M.summaryClick});(0,a.useEffect)(function(){m(k)},[k]);var b=q(function(M){return M.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(S?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(E){if(S){var c=E.target.closest("#".concat(_).concat(u)),Z=c.querySelector("#".concat(o).concat(u));b({id:s,message:Z.innerText}),j(!1)}},children:[(0,e.jsx)(xt.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.chatroom.content.summary"})})]})})},_t=function(n){var s=n.roomid,u=(0,ae.useIntl)(),_=q(function(m){return m.setSummaryClick}),o=(0,a.useState)(!0),p=x()(o,2),j=p[0],T=p[1],h=q(function(m){return m.summaryClick});(0,a.useEffect)(function(){T(h)},[h]);var S=q(function(m){return m.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(j?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){j&&(S({id:s}),_(!1))},children:[(0,e.jsx)(gt,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:u.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ct=(0,a.memo)(function(d){var n=d.messageApi,s=d.setCurrentMessageContent,u=d.sendValue,_=d.agentList,o=d.scrollDomRef,p=d.upButtonDom,j=d.setIsStop,T=d.setisEnd,h=d.setSendValue,S=(0,ae.useIntl)(),m=(0,ae.useParams)(),k=m.id,b=q(function(V){return V.setDisableInput}),M=(0,a.useState)({}),E=x()(M,2),c=E[0],Z=E[1],te=(0,a.useRef)(!1),H=(0,a.useRef)(""),R=q(function(V){return V.setTruncatable}),K=function(X){var U=X.data;if(U.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var W=JSON.parse(U.slice(22,-2));switch(W[0]){case"ERROR":b(!1),j(!1),h(""),n.open({type:"error",content:"webSocket-".concat(W[1]),duration:10});break;case"CHAT":var ee={content:"".concat(W[1]),is_agent:0};s(function($){return[].concat(oe()($),[ee])}),setTimeout(function(){o.current.scrollTop=o.current.scrollHeight,p.current.style.display="none"});break;case"STOPPABLE":j(W[1]);break;case"TRUNCATABLE":R(W[1]),W[1]||n.open({type:"success",content:"".concat(S.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":n.open({type:"success",content:"".concat(S.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(U.indexOf("REPLY")!==-1&&U.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var I=JSON.parse(U.slice(22,-2))[1];H.current="",te.current=!0;var A=_.current.filter(function($){return $.agent_id==I})[0];Object.keys(c).length&&s(function($){return[].concat(oe()($),[c])}),Z(function($){return Y()(Y()({},$),{},{is_agent:1,icon:A==null?void 0:A.icon,name:A==null?void 0:A.name})}),j(!0),R(!1)}U.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&te.current&&(o.current.scrollTop=o.current.scrollHeight,p.current.style.display="none",H.current+=U,Z(function($){return Y()(Y()({},$),{},{content:H.current})})),U.indexOf("ENDCHAT")!==-1&&(te.current=!1,H.current="",b(!1),j(!1),R(!0),Object.keys(c).length&&s(function($){return[].concat(oe()($),[c])}),Z({}),T(!0),h(""))},t=(0,at.Z)("chat",K),G=t.runSocket,P=t.sendMessage,D=t.readyState;return(0,a.useEffect)(function(){D==1&&k&&P(JSON.stringify(["ENTER",parseInt(k)]))},[D]),(0,a.useEffect)(function(){u&&D==1&&P(u)},[u]),(0,a.useEffect)(function(){G()},[]),(0,e.jsx)(e.Fragment,{children:c.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(c.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:c.is_agent==1?(0,e.jsx)("img",{src:(0,fe.s9)("single",c.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(c.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:c.name?c.name:(0,fe.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:c.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],components:Le("add",S),children:c.content})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Rt=(0,a.memo)(function(d){var n=d.messageApi,s=d.setUserMessage,u=d.sendValue,_=d.agentList,o=d.scrollDomRef,p=d.upButtonDom,j=d.setIsStop,T=d.setSendValue,h=(0,ae.useIntl)(),S=(0,a.useState)([]),m=x()(S,2),k=m[0],b=m[1],M=(0,a.useState)(!1),E=x()(M,2),c=E[0],Z=E[1],te=(0,ae.useParams)(),H=te.id;return(0,a.useEffect)(function(){c&&(s(function(R){return[].concat(oe()(R),oe()(k))}),b([]),setTimeout(function(){Z(!1),o.current.scrollTop=o.current.scrollHeight},200))},[c]),(0,e.jsxs)(e.Fragment,{children:[k.length?k.map(function(R,K){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(R.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:R.is_agent==1?(0,e.jsx)("img",{src:(0,fe.s9)("single",R.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(K),children:[(0,e.jsx)("div",{className:"".concat(R.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:R.name?R.name:(0,fe.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:R.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(K),children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],components:Le(K,h),children:R.content})}),R.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(We,{messageApi:n,index:K,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(Ge,{id:H,index:K,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},K)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Ct,{messageApi:n,setCurrentMessageContent:b,sendValue:u,agentList:_,scrollDomRef:o,upButtonDom:p,setIsStop:j,setisEnd:Z,setSendValue:T})]})}),kt=(0,a.memo)(function(d){var n=d.messageApi,s=d.scrollDomRef,u=d.instruction,_=d.setIsStop,o=d.upButtonDom,p=d.setInstruction,j=d.agentList,T=(0,ae.useIntl)(),h=(0,ae.useParams)(),S=h.id,m=(0,a.useState)([]),k=x()(m,2),b=k[0],M=k[1],E=(0,a.useRef)(!1),c=(0,a.useState)(""),Z=x()(c,2),te=Z[0],H=Z[1],R=(0,a.useRef)(null),K=(0,a.useRef)(null),t=(0,a.useRef)(!0),G=(0,a.useRef)(2),P=(0,a.useRef)(1),D=(0,a.useRef)(0),V=function(){var I=ne()(L()().mark(function A($){var ie,se,le=arguments;return L()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(ie=le.length>1&&le[1]!==void 0?le[1]:function(){},!S){F.next=6;break}return F.next=4,(0,ce.KH)(S,{page:P.current,page_size:20});case 4:se=F.sent,se.code==0&&(G.current=se.data.total_pages,M(function(z){return $?oe()(se.data.list):[].concat(oe()(se.data.list),oe()(z))}),$?setTimeout(function(){s.current.scrollTop=s.current.scrollHeight,o.current.style.display="none"}):D.current=se.data.list.length);case 6:case"end":return F.stop()}},A)}));return function($){return I.apply(this,arguments)}}(),X=function(A){var $=A.target.scrollHeight-A.target.scrollTop-A.target.clientHeight;if(E.current!==Math.ceil($)>50&&(E.current=Math.ceil($)>50,o.current.style.display=E.current?"flex":"none"),A.target.scrollTop==0&&t.current){t.current=!1;var ie=R.current.firstChild;P.current=P.current+1,K.current.style.display="flex",G.current,G.current>=P.current?V(!1):K.current.style.display="none"}},U=function(A,$){$==="0"&&($=Number($));var ie=["".concat(A),$===0||$?$:null];H(JSON.stringify(ie))},W=q(function(I){return I.disableInput}),ee=q(function(I){return I.clearMemory});return(0,a.useEffect)(function(){ee&&ee.length&&U(ee[0],ee[1])},[ee]),(0,a.useEffect)(function(){u&&u.length&&(U(u[0],u[1]?u[1]:""),p([]))},[u]),(0,a.useEffect)(function(){D.current&&R.current.children[D.current]&&(s.current.scrollTop=R.current.children[D.current].offsetTop,t.current=!0)},[b]),(0,a.useEffect)(function(){P.current=1,V(!0)},[]),(0,e.jsxs)("div",{className:"flex-1 box-border relative overflow-y-auto chatroom overflow-x-hidden",ref:s,onScroll:X,children:[(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:K,children:(0,e.jsx)(he.Z,{})}),(0,e.jsxs)("div",{className:"max-w-[920px] mx-auto",style:{minHeight:"calc(100% - 50px)"},ref:R,children:[b.map(function(I,A){return(0,e.jsxs)("div",{id:"c".concat(I.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(I.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:I.is_agent==1?(0,e.jsx)("img",{src:(0,fe.s9)("single",I.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(A),children:[(0,e.jsx)("div",{className:"".concat(I.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:I.name?I.name:(0,fe.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:I.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(A),children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],components:Le(A,T),children:I.content})}),I.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(We,{messageApi:n,idName:"content",cidName:"chilContent",index:A}),(0,e.jsx)(Ge,{id:S,index:A,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},A)}),(0,e.jsx)(Rt,{messageApi:n,setUserMessage:M,sendValue:te,agentList:j,scrollDomRef:s,upButtonDom:o,setIsStop:_,setSendValue:H})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!W&&b.length?(0,e.jsx)(_t,{roomid:S}):(0,e.jsx)(e.Fragment,{})})]})}),Mt=(0,a.memo)(function(d){var n=d.agentList,s=(0,a.useRef)(null),u=(0,a.useRef)(null),_=(0,a.useState)(!1),o=x()(_,2),p=o[0],j=o[1],T=(0,a.useState)([]),h=x()(T,2),S=h[0],m=h[1],k=Se.ZP.useMessage(),b=x()(k,2),M=b[0],E=b[1];return(0,e.jsxs)(e.Fragment,{children:[E,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px]   overflow-auto",style:{height:"calc(100% )"},children:(0,e.jsxs)("div",{className:"flex flex-col w-full",children:[(0,e.jsx)(kt,{instruction:S,setInstruction:m,messageApi:M,scrollDomRef:s,setIsStop:j,upButtonDom:u,agentList:n}),(0,e.jsx)(Nt,{setInstruction:m,messageApi:M,isStop:p,upButtonDom:u,scrollDomRef:s})]})})]})}),Ft=f(42881),Dt=function(n){var s=n.children,u=n.className,_=u===void 0?"":u,o=n.dragDirection,p=o===void 0?"left":o,j=n.minWidth,T=j===void 0?415:j,h=n.maxWidth,S=h===void 0?820:h,m=n.minHeight,k=m===void 0?200:m,b=n.maxHeight,M=b===void 0?800:b,E=n.defaultWidth,c=E===void 0?415:E,Z=n.defaultHeight,te=Z===void 0?300:Z,H=(0,a.useState)(c),R=x()(H,2),K=R[0],t=R[1],G=(0,a.useState)(te),P=x()(G,2),D=P[0],V=P[1],X=(0,a.useCallback)(function(I,A){t(I),A&&V(A)},[t,V]),U=(0,Ft.W)({direction:["left","right"].includes(p)?"horizontal":"vertical",triggerDirection:p,minWidth:T,maxWidth:S,minHeight:k,maxHeight:M,onResize:X}),W=U.triggerRef,ee=U.containerRef;return(0,e.jsxs)("div",{ref:ee,style:{width:["left","right"].includes(p)?"".concat(K,"px"):void 0,height:["top","bottom"].includes(p)?"".concat(D,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(_),children:[p==="left"&&(0,e.jsx)("div",{ref:W,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),p==="right"&&(0,e.jsx)("div",{ref:W,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),p==="top"&&(0,e.jsx)("div",{ref:W,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),p==="bottom"&&(0,e.jsx)("div",{ref:W,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),s]})},It=(0,a.memo)(Dt),At={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Et=At,Pt=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:Et}))},Ot=a.forwardRef(Pt),Tt=Ot,$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Lt=$t,Zt=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:Lt}))},Ht=a.forwardRef(Zt),Bt=Ht,zt=f(83159),Vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},Ut=Vt,Wt=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:Ut}))},Gt=a.forwardRef(Wt),Kt=Gt,Fe=f(86),Ke=f(34994),Je=f(2216),Jt=f(85877),Yt=f(29432),Qt=f(39944),Xt=f(11551),Ze=f(55927),qt=function(n){var s,u,_,o=n.selectApp,p=n.runid,j=n.setBoxLoading,T=n.setinputShow,h=n.appId,S=n.id,m=n.setisRun,k=(0,ae.useIntl)(),b=(0,a.useRef)(""),M=(0,a.useRef)(""),E=(0,a.useRef)(null),c=(0,a.useState)(""),Z=x()(c,2),te=Z[0],H=Z[1],R=(0,a.useState)(null),K=x()(R,2),t=K[0],G=K[1],P=(0,a.useState)([]),D=x()(P,2),V=D[0],X=D[1],U=(0,a.useState)(""),W=x()(U,2),ee=W[0],I=W[1],A=(0,Ze.Z)(function(Q){return Q.flowMessage}),$=function(F){M.current=ie(F);var z={user:{value:ie(F)}};I(new Qt.z(z))},ie=function Q(F){return F.map(function(z){return z.type==="mention"?z.id:z.children?Q(z.children):z.text}).join("")},se=function(){var Q=ne()(L()().mark(function F(z){var N,g;return L()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return j(!0),N=Object.keys(z),N.forEach(function(r){E.current.properties[r]&&(E.current.properties[r].value=z[r])}),i.next=5,(0,Xt.LH)({agent_id:o.checkItem[0].agent_id,ability_id:0,input_dict:E.current,prompt:ee,data_source_run_id:b.current});case 5:g=i.sent,g.code==0&&(H(g.data.outputs_md),j(!1),m(!1));case 7:case"end":return i.stop()}},F)}));return function(z){return Q.apply(this,arguments)}}(),le=function(){var Q=ne()(L()().mark(function F(z,N){var g,O;return L()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,ce.xT)(z,N);case 2:g=r.sent,(g==null?void 0:g.code)==0&&(b.current=g==null||(O=g.data)===null||O===void 0?void 0:O.app_run_id);case 4:case"end":return r.stop()}},F)}));return function(z,N){return Q.apply(this,arguments)}}();return(0,a.useEffect)(function(){o&&o.checkItem.length&&(m(!0),le(S,{app_id:h,app_run_id:p,status:1,corrected_parameter:""}))},[o]),(0,a.useEffect)(function(){var Q=A.filter(function(i){return i.data.app_run_id==p&&i.type.indexOf("generate_meeting_action_items")!==-1});if(Q.length!=0){var F,z=(F=Q[Q.length-1])===null||F===void 0||(F=F.data)===null||F===void 0||(F=F.exec_data)===null||F===void 0||(F=F.outputs)===null||F===void 0?void 0:F.value;if(z){var N=JSON.parse(z);E.current=N;var g=Object.keys(N.properties);if(g.length){G(N.properties);var O=g.map(function(i){return{value:"<<".concat(Yt.qX,".inputs.").concat(i,">>"),label:i}});X(O)}T(!1),j(!1)}}},[A]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Fe.Z,{icon:o==null||(s=o.checkItem[0])===null||s===void 0?void 0:s.icon,title:o==null||(u=o.checkItem[0])===null||u===void 0?void 0:u.name,textDetails:o==null||(_=o.checkItem[0])===null||_===void 0?void 0:_.description,iconType:"robot_icon",handleClick:function(){}})}),t!=null?(0,e.jsxs)(Ke.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!M.current},searchConfig:{submitText:k.formatMessage({id:"workflow.button.run"})}},onFinish:function(F){se(F)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Je._,{data:t})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(Jt.Z,{onChange:function(F){$(F)},options:V,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),te?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:te})})}):(0,e.jsx)(e.Fragment,{})]})},ea=(0,a.memo)(qt),ta=f(66309),Ye=f(42237),aa=f(93696),na=function(n,s){return a.createElement(ye.Z,(0,ue.Z)((0,ue.Z)({},n),{},{ref:s,icon:aa.Z}))},ra=a.forwardRef(na),sa=ra,ia=f(4981),He=f(29608),la=(0,a.memo)(function(d){var n=d.progressObj,s=function(){return parseFloat(n.elapsed_time).toFixed(6)},u=function(o){var p=new Date(o),j=p.getFullYear(),T=(p.getMonth()+1).toString().padStart(2,"0"),h=p.getDate().toString().padStart(2,"0"),S=p.getHours().toString().padStart(2,"0"),m=p.getMinutes().toString().padStart(2,"0"),k=p.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(j,".").concat(T,".").concat(h," ").concat(S,":").concat(m,":").concat(k)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&u(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[s(),"S"]})]})]})})}),ca=function(n){var s,u,_,o=n.selectApp,p=n.runid,j=n.setBoxLoading,T=n.setinputShow,h=n.appId,S=n.id,m=n.setisRun,k=(0,ae.useIntl)(),b=(0,a.useRef)(""),M=(0,a.useRef)(null),E=(0,a.useState)(null),c=x()(E,2),Z=c[0],te=c[1],H=(0,a.useState)(!1),R=x()(H,2),K=R[0],t=R[1],G=(0,a.useState)(null),P=x()(G,2),D=P[0],V=P[1],X=(0,a.useState)(null),U=x()(X,2),W=U[0],ee=U[1],I=(0,a.useState)(null),A=x()(I,2),$=A[0],ie=A[1],se=(0,He.Z)(function(r){return r.setDealtWithData}),le=(0,He.Z)(function(r){return r.setRunPanelLogRecord}),Q=function(){var r=ne()(L()().mark(function l(y){var v,w,B,C,J;return L()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return j(!0),v=Object.keys(y),w={},v.forEach(function(de){M.current.properties[de]&&(M.current.properties[de].value=y[de]),W&&W.forEach(function(Be){Be.node_id==de&&(w[de]=y[de])})}),B={inputs:M.current,node_confirm_users:w,run_name:"chatroom-".concat(S,"-run-").concat(b.current,"-driven"),run_type:1,data_source_run_id:b.current},re.next=7,(0,Ye.UE)(h,B);case 7:C=re.sent,C.code==0&&(b.current=C==null||(J=C.data)===null||J===void 0?void 0:J.app_run_id,t(!0),m(!1));case 9:case"end":return re.stop()}},l)}));return function(y){return r.apply(this,arguments)}}(),F=function(){var r=ne()(L()().mark(function l(){var y,v;return L()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:y=i==null?void 0:i.filter(function(C){return C.type=="workflow_run_progress"&&C.data.app_run_id==b.current}).map(function(C){var J=C.data;return J}),y&&y.length&&(v=y[y.length-1],te(v),j(!1));case 2:case"end":return B.stop()}},l)}));return function(){return r.apply(this,arguments)}}(),z=function(){var r=ne()(L()().mark(function l(){var y,v,w,B,C;return L()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:v=i==null?void 0:i.filter(function(re){return re.type=="workflow_need_human_confirm"&&re.data.app_run_id==b.current}),w=(y=v.map(function(re){var de=re.data,Be=re.need_human_confirm;return{data:de,need_human_confirm:Be}}))===null||y===void 0?void 0:y.filter(function(re){return re.data.type!==1}),w&&w.length&&(C=w[w.length-1].data,C.exec_id=C==null||(B=C.node_exec_data)===null||B===void 0?void 0:B.node_exec_id,ie(w[w.length-1]),j(!1));case 3:case"end":return xe.stop()}},l)}));return function(){return r.apply(this,arguments)}}(),N=function(l){return l.completed_progress?parseInt(l.completed_progress.slice(0,-1)):!1},g=function(){var r=ne()(L()().mark(function l(y,v){var w,B;return L()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,ce.xT)(y,v);case 2:w=J.sent,(w==null?void 0:w.code)==0&&(b.current=w==null||(B=w.data)===null||B===void 0?void 0:B.app_run_id);case 4:case"end":return J.stop()}},l)}));return function(y,v){return r.apply(this,arguments)}}(),O=function(){var r=ne()(L()().mark(function l(){var y,v;return L()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return console.log(h),B.next=3,(0,Ye.zO)(h);case 3:y=B.sent,y.code==0&&ee(y==null||(v=y.data)===null||v===void 0?void 0:v.need_confirm_nodes),g(S,{app_id:h,app_run_id:p,status:1,corrected_parameter:""});case 6:case"end":return B.stop()}},l)}));return function(){return r.apply(this,arguments)}}();(0,a.useEffect)(function(){o&&o.checkItem.length&&(m(!0),O())},[o]);var i=(0,Ze.Z)(function(r){return r.flowMessage});return(0,a.useEffect)(function(){F(),z();var r=i.filter(function(B){return B.data.app_run_id==p&&B.type.indexOf("generate_meeting_action_items")!==-1});if(r.length!=0){var l,y=(l=r[r.length-1])===null||l===void 0||(l=l.data)===null||l===void 0||(l=l.exec_data)===null||l===void 0||(l=l.outputs)===null||l===void 0?void 0:l.value;if(y){var v=JSON.parse(y);M.current=v;var w=Object.keys(v.properties);w.length&&V(v.properties),T(!1),j(!1)}}},[i]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Fe.Z,{icon:o==null||(s=o.checkItem[0])===null||s===void 0?void 0:s.icon,title:o==null||(u=o.checkItem[0])===null||u===void 0?void 0:u.name,textDetails:o==null||(_=o.checkItem[0])===null||_===void 0?void 0:_.description,iconType:"workflow_icon",handleClick:function(){}})}),!K&&D!=null?(0,e.jsxs)(Ke.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:k.formatMessage({id:"workflow.button.run"})}},onFinish:Q,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Je._,{data:D})}),(0,e.jsx)(ia.e,{data:W})]}):(0,e.jsx)(e.Fragment,{}),$&&$.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){se($.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(sa,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:k.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),Z?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Fe.Z,{status:Z.status,icon:Z.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:Z.run_name}),Z.need_human_confirm==1?(0,e.jsx)(ta.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:k.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(la,{progressObj:Z}),handleClick:function(){le(Z)},progress:N(Z)})}):(0,e.jsx)(e.Fragment,{})]})},oa=(0,a.memo)(ca),ua=function(n){var s,u,_,o=(0,ae.useIntl)(),p=n.runid,j=n.id,T=n.setBoxLoading,h=n.scrollDom,S=n.setinputShow,m=(0,a.useRef)("agent"),k=(0,a.useRef)(""),b=(0,a.useState)(!1),M=x()(b,2),E=M[0],c=M[1],Z=(0,a.useState)({type:"agent",checkItem:[],show:!1}),te=x()(Z,2),H=te[0],R=te[1],K=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){R(function(D){return Y()(Y()({},D),{},{type:"agent",show:!0})})},children:o.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){R(function(D){return Y()(Y()({},D),{},{type:"workflow",show:!0})})},children:o.formatMessage({id:"app.summary.SelectWorkflow"})})}],t=function(){R(function(D){return Y()(Y()({},D),{},{show:!1})})},G=function(D){T(!0),R(function(V){return Y()(Y()({},V),{},{checkItem:D.checkItem})}),m.current=H.type,k.current=D.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:H!=null&&(s=H.checkItem)!==null&&s!==void 0&&s.length?h==null||(u=h.current)===null||u===void 0?void 0:u.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:o.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:E?(0,e.jsx)(zt.Z,{menu:{items:K},children:(0,e.jsx)(Kt,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:H!=null&&(_=H.checkItem)!==null&&_!==void 0&&_.length?(0,e.jsx)(e.Fragment,{children:m.current=="agent"?(0,e.jsx)(ea,{id:j,appId:k.current,selectApp:H,runid:p,setBoxLoading:T,scrollDom:h,setinputShow:S,setisRun:c}):(0,e.jsx)(oa,{id:j,appId:k.current,selectApp:H,runid:p,setBoxLoading:T,scrollDom:h,setinputShow:S,setisRun:c})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(pe.ZP,{className:"flex-1 text-[14px]",onClick:function(){R(function(D){return Y()(Y()({},D),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),o.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(pe.ZP,{className:"flex-1 text-[14px]",onClick:function(){R(function(D){return Y()(Y()({},D),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),o.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(we.Z,{show:H.show,nodetype:H.type,popupClose:t,popupSave:G,checkList:m.current==H.type?H.checkItem:[],zIndex:99,radio:!0})]})},da=(0,a.memo)(ua),pa=function(n){var s,u,_=n.setShow,o=n.inputShow,p=n.setBoxLoading,j=n.setAppRunId,T=n.scrollDom,h=(0,ae.useIntl)(),S=(0,a.useState)(!1),m=x()(S,2),k=m[0],b=m[1],M=(0,a.useState)(""),E=x()(M,2),c=E[0],Z=E[1],te=(0,a.useState)(""),H=x()(te,2),R=H[0],K=H[1],t=(0,a.useRef)(""),G=(0,a.useRef)(""),P=(0,a.useRef)(!1),D=(0,a.useState)(!1),V=x()(D,2),X=V[0],U=V[1],W=(0,a.useState)(null),ee=x()(W,2),I=ee[0],A=ee[1],$=q(function(N){return N.setSummaryClick}),ie=function(){var N=ne()(L()().mark(function g(O){var i,r,l,y,v=arguments;return L()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return i=v.length>1&&v[1]!==void 0?v[1]:{app_run_id:"",corrected_parameter:""},B.next=3,(0,ce.Rp)(O,i);case 3:r=B.sent,(r==null?void 0:r.code)==0&&(j(r==null||(l=r.data)===null||l===void 0?void 0:l.app_run_id),G.current=r==null||(y=r.data)===null||y===void 0?void 0:y.app_run_id,i.app_run_id&&(P.current=!0));case 5:case"end":return B.stop()}},g)}));return function(O){return N.apply(this,arguments)}}(),se=function(){var N=ne()(L()().mark(function g(O,i){var r,l,y,v,w;return L()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,(0,ce.xM)(O,{message:i});case 2:r=C.sent,(r==null?void 0:r.code)==0&&(G.current=r==null||(l=r.data)===null||l===void 0?void 0:l.app_run_id,j(r==null||(y=r.data)===null||y===void 0?void 0:y.app_run_id),r!=null&&(v=r.data)!==null&&v!==void 0&&(v=v.outputs)!==null&&v!==void 0&&v.value&&(Z(r==null||(w=r.data)===null||w===void 0||(w=w.outputs)===null||w===void 0?void 0:w.value),_(!0),p(!1),$(!0)));case 4:case"end":return C.stop()}},g)}));return function(O,i){return N.apply(this,arguments)}}(),le=function(){var N=ne()(L()().mark(function g(){var O;return L()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,ce.Gh)({chatroom_id:t.current,app_run_id:G.current});case 2:O=r.sent,O&&O!==null&&O!==void 0&&O.data&&A(O.data);case 4:case"end":return r.stop()}},g)}));return function(){return N.apply(this,arguments)}}(),Q=function(g){var O=new Date(g),i=O.getMonth()+1,r=O.getDate(),l=O.getHours(),y=O.getMinutes(),v=O.getSeconds();return O.getFullYear()+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)+" "+(l<10?"0"+l:l)+":"+(y<10?"0"+y:y)+":"+(v<10?"0"+v:v)},F=(0,Ze.Z)(function(N){return N.flowMessage});(0,a.useEffect)(function(){var N=F.filter(function(i){return i.data.app_run_id==G.current&&i.type.indexOf("generate_meeting_summary")!==-1});if(N.length!=0){var g,O=(g=N[N.length-1])===null||g===void 0||(g=g.data)===null||g===void 0||(g=g.exec_data)===null||g===void 0||(g=g.outputs)===null||g===void 0?void 0:g.value;O&&(P.current&&le(),Z(O),U(!1),_(!0),$(!0),p(!1))}},[F]);var z=q(function(N){return N.summaryParams});return(0,a.useEffect)(function(){z&&z.id&&(t.current=z.id,c&&Z(""),b(!0),z.message?(p(!0),se(z.id,z.message)):ie(z.id))},[z]),(0,e.jsx)(e.Fragment,{children:k?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:h.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:c?(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:I?I==null||(s=I.source_run)===null||s===void 0?void 0:s.summary:c})}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(he.Z,{size:"large"})})}),I&&(I==null||(u=I.source_corrections)===null||u===void 0?void 0:u.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[h.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),I.source_corrections.map(function(N){return(0,e.jsx)("div",{className:"last-of-type:bg-blue-100 rounded-[4px] bg-[#F7F7F7] mb-[16px] ",children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[h.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",N.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[h.formatMessage({id:"app.summaryhistory.time"}),": ",Q(N.created_time)]}),(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:N==null?void 0:N.corrected_summary})]})},N.created_time)})]}):(0,e.jsx)(e.Fragment,{}),o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Ve.Z.TextArea,{onChange:function(g){K(g.target.value)},value:R,disabled:!c||X,rows:4,placeholder:h.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(pe.ZP,{type:"primary",disabled:!c||!R,loading:X,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){ie(t.current,{app_run_id:String(G.current),corrected_parameter:R}),U(!0),K(""),_("")},children:h.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},xa=(0,a.memo)(pa),fa=f(87740),ma=(0,a.memo)(function(d){var n=d.progressObj;console.log(n);var s=function(){return parseFloat(n.elapsed_time).toFixed(6)},u=function(o){var p=new Date(o),j=p.getFullYear(),T=(p.getMonth()+1).toString().padStart(2,"0"),h=p.getDate().toString().padStart(2,"0"),S=p.getHours().toString().padStart(2,"0"),m=p.getMinutes().toString().padStart(2,"0"),k=p.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(j,".").concat(T,".").concat(h," ").concat(S,":").concat(m,":").concat(k)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&u(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[s(),"S"]})]})]})})}),va=function(n){var s=n.list,u=n.scrollDom,_=n.historyHeight,o=n.id,p=(0,ae.useIntl)(),j=(0,a.useState)([]),T=x()(j,2),h=T[0],S=T[1],m=(0,a.useRef)("100%"),k=(0,He.Z)(function(t){return t.setRunPanelLogRecord}),b=function(G){var P=new Date(G),D=P.getMonth()+1,V=P.getDate(),X=P.getHours(),U=P.getMinutes(),W=P.getSeconds();return P.getFullYear()+"-"+(D<10?"0"+D:D)+"-"+(V<10?"0"+V:V)+" "+(X<10?"0"+X:X)+":"+(U<10?"0"+U:U)+":"+(W<10?"0"+W:W)},M=function(G){var P=Object.keys(G),D=[];return P.forEach(function(V){D.push(G[V])}),D},E=q(function(t){return t.setSummaryClick}),c=(0,a.useState)(!0),Z=x()(c,2),te=Z[0],H=Z[1],R=q(function(t){return t.summaryClick}),K=q(function(t){return t.setSummaryParams});return(0,a.useEffect)(function(){H(R)},[R]),(0,a.useEffect)(function(){if(u){var t;m.current=u==null||(t=u.current)===null||t===void 0?void 0:t.offsetHeight}},[u]),(0,a.useEffect)(function(){_&&(m.current="auto")},[_]),(0,a.useEffect)(function(){S(oe()(s.reverse()))},[s]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"px-4",style:{minHeight:m.current},children:h&&h.length?h.map(function(t){var G,P,D,V,X,U,W,ee,I,A,$,ie,se,le,Q,F,z,N;return t!=null&&t.source_run&&t!==null&&t!==void 0&&t.source_run.summary?(0,e.jsx)("div",{className:"pt-[16px] border-b-[1px] border-color-[#eee] ",children:(0,e.jsxs)("div",{className:"pb-[60px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pb-[8px] flex items-center",children:(0,e.jsx)("span",{className:"flex-1",children:p.formatMessage({id:"app.summary.title"})})}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:b(t==null||(G=t.source_run)===null||G===void 0?void 0:G.created_time)}),(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] ".concat(t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?"bg-[#F7F7F7]":"bg-blue-100 rounded-[4px]"),children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:t==null||(P=t.source_run)===null||P===void 0?void 0:P.summary})}),t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),t==null?void 0:t.source_corrections.map(function(g){return(0,e.jsx)("div",{className:"last-of-type:bg-blue-100 rounded-[4px] bg-[#F7F7F7] mb-[16px] last-of-type:mb-0",children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[p.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",g.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[p.formatMessage({id:"app.summaryhistory.time"}),": ",b(g.created_time)]}),(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:g==null?void 0:g.corrected_summary})]})},g.created_time)})]}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(pe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(O){if(te){var i,r=(t==null?void 0:t.source_corrections)&&(t==null?void 0:t.source_corrections.length)>0&&(t==null?void 0:t.source_corrections[(t==null?void 0:t.source_corrections.length)-1]),l=r?r.corrected_summary:t==null||(i=t.source_run)===null||i===void 0?void 0:i.summary;K({id:o,message:l}),E(!1)}},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(fa.Z,{className:"text-[14px]"})]})}),t!=null&&t.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:t!=null&&(D=t.target_run)!==null&&D!==void 0&&D.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:t==null||(V=t.target_run)===null||V===void 0||(V=V.app)===null||V===void 0?void 0:V.name})]})}),(0,e.jsx)("div",{children:t!=null&&(X=t.target_run)!==null&&X!==void 0&&(X=X.inputs)!==null&&X!==void 0&&X.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[p.formatMessage({id:"app.summaryhistory.input"}),":"]}),M(t==null||(U=t.target_run)===null||U===void 0||(U=U.inputs)===null||U===void 0?void 0:U.properties).map(function(g){return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:g.display_name||g.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:g.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:t!=null&&(W=t.target_run)!==null&&W!==void 0&&W.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[p.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:t==null||(ee=t.target_run)===null||ee===void 0?void 0:ee.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[p.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(t==null||(I=t.target_run)===null||I===void 0?void 0:I.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(me.U,{rehypePlugins:[ve.Z],children:t==null||(A=t.target_run)===null||A===void 0||(A=A.outputs)===null||A===void 0?void 0:A.value})}):(0,e.jsx)(Fe.Z,{status:t==null||($=t.target_run)===null||$===void 0?void 0:$.status,icon:t==null||(ie=t.target_run)===null||ie===void 0?void 0:ie.icon,title:t==null||(se=t.target_run)===null||se===void 0?void 0:se.name,textDetails:(0,e.jsx)(ma,{progressObj:{created_time:t==null||(le=t.target_run)===null||le===void 0?void 0:le.created_time,elapsed_time:t==null||(Q=t.target_run)===null||Q===void 0?void 0:Q.elapsed_time,app_name:t==null||(F=t.target_run)===null||F===void 0?void 0:F.app.name,status:t==null||(z=t.target_run)===null||z===void 0?void 0:z.status}}),handleClick:function(){var O,i,r,l,y,v,w,B,C,J;k({app_id:t==null||(O=t.target_run)===null||O===void 0||(O=O.app)===null||O===void 0?void 0:O.id,app_name:t==null||(i=t.target_run)===null||i===void 0||(i=i.app)===null||i===void 0?void 0:i.name,icon:t==null||(r=t.target_run)===null||r===void 0?void 0:r.icon,workflow_id:t==null||(l=t.target_run)===null||l===void 0?void 0:l.workflow_id,type:2,app_run_id:t==null||(y=t.target_run)===null||y===void 0?void 0:y.id,run_name:t==null||(v=t.target_run)===null||v===void 0?void 0:v.name,status:t==null||(w=t.target_run)===null||w===void 0?void 0:w.status,created_time:t==null||(B=t.target_run)===null||B===void 0?void 0:B.created_time,elapsed_time:t==null||(C=t.target_run)===null||C===void 0?void 0:C.elapsed_time,completed_progress:"".concat(t==null||(J=t.target_run)===null||J===void 0?void 0:J.percentage,"%")})},progress:t==null||(N=t.target_run)===null||N===void 0?void 0:N.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]})},t.source_run.id):(0,e.jsx)(e.Fragment,{})}):(0,e.jsx)(e.Fragment,{})})})},ha=(0,a.memo)(va),ga=function(n){var s,u=n.id,_=(0,a.useState)(""),o=x()(_,2),p=o[0],j=o[1],T=(0,a.useState)(!1),h=x()(T,2),S=h[0],m=h[1],k=(0,a.useState)([]),b=x()(k,2),M=b[0],E=b[1],c=(0,a.useState)(!1),Z=x()(c,2),te=Z[0],H=Z[1],R=(0,a.useState)(!1),K=x()(R,2),t=K[0],G=K[1],P=(0,a.useState)(""),D=x()(P,2),V=D[0],X=D[1],U=(0,a.useState)(!1),W=x()(U,2),ee=W[0],I=W[1],A=(0,a.useState)(!1),$=x()(A,2),ie=$[0],se=$[1],le=(0,a.useState)(!0),Q=x()(le,2),F=Q[0],z=Q[1],N=(0,a.useRef)(null),g=(0,a.useRef)(!1),O=function(){var l=ne()(L()().mark(function y(){var v,w,B,C,J=arguments;return L()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return v=J.length>0&&J[0]!==void 0?J[0]:!0,re.next=3,(0,ce.sh)({chatroom_id:u,page:1,page_size:9999});case 3:w=re.sent,w.code==0&&(w!=null&&(B=w.data)!==null&&B!==void 0&&B.list&&w!==null&&w!==void 0&&(C=w.data)!==null&&C!==void 0&&(C=C.list)!==null&&C!==void 0&&C.length&&(E(w.data.list),m(!0)),v||(setTimeout(function(){var de;N==null||(de=N.current)===null||de===void 0||de.scrollTo({top:0})},200),j(i.id),r({})));case 5:case"end":return re.stop()}},y)}));return function(){return l.apply(this,arguments)}}();(0,a.useEffect)(function(){O()},[u]);var i=q(function(l){return l.summaryParams}),r=q(function(l){return l.setSummaryParams});return(0,a.useEffect)(function(){i&&i.id&&(m(!0),F||z(!0),te&&H(!1),ee&&I(!1),G(!0),O(!1),g.current=!0)},[i]),(0,e.jsx)(e.Fragment,{children:S?(0,e.jsxs)(It,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(ee?"translate-x-full flex-[0]":""),children:[ie?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(he.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){I(function(y){return!y})},className:`
                                        `.concat(ee?"right-[100%] top-[4px]":"right-[6px] top-[60px]",`
                                        fixed w-[40px] h-[40px]  flex justify-center items-center cursor-pointer z-[99]
                                    `),children:ee?(0,e.jsx)(Bt,{className:"text-[20px]"}):(0,e.jsx)(Tt,{className:"text-[20px]"})}),(0,e.jsx)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth",ref:N,children:(0,e.jsxs)("div",{children:[M.length?(0,e.jsx)(ha,{id:u,scrollDom:N,list:M,historyHeight:g.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:t?N==null||(s=N.current)===null||s===void 0?void 0:s.offsetHeight:""},children:[(0,e.jsx)(xa,{setShow:H,inputShow:F,setBoxLoading:se,setAppRunId:X,scrollDom:N}),te?(0,e.jsx)(da,{id:p,runid:V,setBoxLoading:se,scrollDom:N,setinputShow:z}):(0,e.jsx)(e.Fragment,{})]})]})})]})]}):(0,e.jsx)(e.Fragment,{})})},ja=(0,a.memo)(ga),ya=function(n){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(ge.Z,{image:ge.Z.PRESENTED_IMAGE_SIMPLE})})},Sa=(0,a.memo)(function(){var d=(0,ae.useParams)(),n=d.id,s=(0,a.useRef)([]),u=(0,a.useRef)(null),_=(0,a.useState)(!1),o=x()(_,2),p=o[0],j=o[1],T=function(){var h=ne()(L()().mark(function S(){var m;return L()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!n){b.next=5;break}return b.next=3,(0,ce.cH)({id:n});case 3:m=b.sent,m.code==0?(j(!0),u.current=m.data,s.current=m.data.agent_list):ae.history.replace("/meeting");case 5:case"end":return b.stop()}},S)}));return function(){return h.apply(this,arguments)}}();return(0,a.useEffect)(function(){T()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(qe,{roomDetail:u.current,setAgent:s}),(0,e.jsx)("div",{className:"flex-1",children:p?(0,e.jsx)(Mt,{agentList:s}):(0,e.jsx)(ya,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ja,{id:n})})]})})}),Na=Sa}}]);
