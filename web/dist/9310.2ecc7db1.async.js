"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9310],{89310:function(fa,ce,s){s.d(ce,{Z:function(){return Te}});var ge=s(19632),z=s.n(ge),me=s(15009),h=s.n(me),he=s(99289),I=s.n(he),pe=s(97857),x=s.n(pe),Se=s(5574),f=s.n(Se),R=s(11551),ye=s(18304),Z=s(85750),be=s(38008),Fe=s(77295),je=s(39944),Me=s(58299),V=s(55927),G=s(79574),Le=s(19078),Y=s(1413),u=s(67294),Ie=s(44685),$e=s(91146),xe=function(c,g){return u.createElement($e.Z,(0,Y.Z)((0,Y.Z)({},c),{},{ref:g,icon:Ie.Z}))},Re=u.forwardRef(xe),Ze=Re,we=s(34994),Ce=s(35312),Ne=s(77598),$=s(45360),Pe=s(74330),k=s(66309),w=s(28036),Ue=s(32983),r=s(85893),Te=(0,u.memo)(function(n){var c,g,C,j,Ae=(0,u.useState)([]),J=f()(Ae,2),Oe=J[0],N=J[1],Ee=(0,u.useState)(!0),K=f()(Ee,2),ca=K[0],He=K[1],Be=(0,u.useState)(1),Q=f()(Be,2),ga=Q[0],De=Q[1],We=(0,u.useState)(!0),X=f()(We,2),ze=X[0],Ve=X[1],Ge=(0,u.useState)(!1),q=f()(Ge,2),P=q[0],_=q[1],Ye=(0,u.useState)(!1),ee=f()(Ye,2),ma=ee[0],U=ee[1],ke=(0,u.useState)(!1),ae=f()(ke,2),te=ae[0],ne=ae[1],Je=(0,u.useState)(!1),le=f()(Je,2),Ke=le[0],T=le[1],Qe=(0,u.useState)(!1),se=f()(Qe,2),p=se[0],A=se[1],O=(0,u.useRef)(),Xe=(0,u.useRef)(null),qe=(0,u.useRef)(null),S=(0,Ce.useIntl)(),E=(0,V.Z)(function(l){return l.getTypedMessages("chat_message_llm_return")}),_e=(0,u.useState)(null),ie=f()(_e,2),re=ie[0],ea=ie[1],H=(0,V.Z)(function(l){return l.getTypedLastMessage("chat_message_llm_return")}),aa=(0,u.useState)(null),ue=f()(aa,2),y=ue[0],ta=ue[1],na=(0,Me.m)(),M=na.options,la=function(e){if(!e||!M)return"\u672A\u77E5\u6A21\u578B";var t=(0,Z.ti)(e,{options:M});return(t==null?void 0:t.label)||"\u672A\u77E5\u6A21\u578B"},sa=function(e){if(!e||!M)return!1;var t=(0,Z.ti)(e,{options:M});return(t==null?void 0:t.support_image)===1},ia=function(e){if(!e||!M)return!1;var t=(0,Z.ti)(e,{options:M});return(t==null?void 0:t.model_mode)===2},ra=function(){var e,t=(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.agent_id;if(t){var i=!p;A(i),(0,G.S_)(t,i)}else console.warn("Cannot save fullscreen state: agentId is not available"),A(function(o){return!o})};(0,u.useEffect)(function(){var l;if(((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.app)===null||l===void 0?void 0:l.name)!=null){var e=n.data.detailList.agent_chatroom_id,t=n.data.detailList.agent.agent_id;if(e){var i=window.location.search,o=new URLSearchParams(i);ea(e),o.set("id",String(e));var d="".concat(window.location.pathname,"?").concat(o.toString()).concat(window.location.hash);window.history.replaceState({},"",d)}var a=x()(x()({},n.data.detailList.app),{},{agent:n.data.detailList.agent,agent_id:t});if(ta(a),t){var b=(0,G.WM)(t);console.log("Restoring fullscreen state for agent ".concat(t,": ").concat(b)),A(b)}setTimeout(function(){Ve(!1)},500)}},[(c=n.data)===null||c===void 0||(c=c.detailList)===null||c===void 0||(c=c.app)===null||c===void 0?void 0:c.name,(g=n.data)===null||g===void 0||(g=g.detailList)===null||g===void 0||(g=g.agent)===null||g===void 0?void 0:g.m_config_id]);var L=(0,Fe.ZP)(),oe=L.uploadedFiles,ha=L.setUploadedFiles,pa=L.handleUpload,Sa=L.removeFile,ua=L.clearFiles,ya=L.isUploading,B=function(){var e;(e=Xe.current)===null||e===void 0||e.scrollIntoView({behavior:"smooth"})},de=function(){var l=I()(h()().mark(function e(){var t,i,o;return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,ne(!0),!(n!=null&&(t=n.saveInfo)!==null&&t!==void 0&&t.firstjudgingcondition())){a.next=6;break}return a.abrupt("return",!0);case 6:if(!(n!=null&&(i=n.saveInfo)!==null&&i!==void 0&&i.secondjudgingcondition())){a.next=10;break}return a.abrupt("return",!0);case 10:return a.next=12,n==null||(o=n.saveInfo)===null||o===void 0?void 0:o.agentupdata();case 12:return a.abrupt("return",a.sent);case 13:a.next=19;break;case 15:return a.prev=15,a.t0=a.catch(0),console.error("Failed to save info:",a.t0),a.abrupt("return",!1);case 19:return a.prev=19,ne(!1),a.finish(19);case 22:case"end":return a.stop()}},e,null,[[0,15,19,22]])}));return function(){return l.apply(this,arguments)}}();(0,Ne.Z)(function(){var l,e=H==null?void 0:H.data;if(e&&!((e==null?void 0:e.agent_id)!==((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.agent)===null||l===void 0?void 0:l.agent_id)&&!$.ZP.error)){var t=x()(x()({},e),{},{id:e.message_id});E&&E.length>0&&(U(!1),N(function(i){return[].concat(z()(i),[t])}),setTimeout(B,100))}},[E]),(0,u.useEffect)(function(){!P&&Oe.length>0&&B()},[P]);var oa=function(){var l=I()(h()().mark(function e(t){var i,o,d,a,b,v,D,ve,W,fe;return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(a=(i=O.current)===null||i===void 0?void 0:i.getFieldsValue(),!(!a||!((o=t.content)!==null&&o!==void 0&&o.trim()))){m.next=3;break}return m.abrupt("return");case 3:return b=n.data.detailList.agent.agent_id,v=n.data.detailList.agent.input_variables,D=a.ability_id,ve=new je.z({user:{value:a.content}}),W=oe.map(function(F){return{name:F.name,url:F.url||F.path_show||""}}),fe={id:Date.now(),content:t.content,isUser:!0,ability_id:D,agent_id:b,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:a.content,prompt_tokens:0,total_tokens:0,file_list:W.length>0?W:void 0},U(!0),N(function(F){return[].concat(z()(F),[fe])}),(d=O.current)===null||d===void 0||d.resetFields(["content"]),m.prev=12,m.next=15,(0,R.CY)({agent_id:b,input_dict:v,ability_id:D,prompt:ve,file_list:oe.map(function(F){return F.file_id})});case 15:ua(),m.next=22;break;case 18:m.prev=18,m.t0=m.catch(12),U(!1),$.ZP.error(S.formatMessage({id:"agent.chat.send.failed"}));case 22:setTimeout(B,100);case 23:case"end":return m.stop()}},e,null,[[12,18]])}));return function(t){return l.apply(this,arguments)}}(),ba=function(){var l=I()(h()().mark(function e(){var t,i,o;return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((t=n.data)!==null&&t!==void 0&&(t=t.detailList)!==null&&t!==void 0&&(t=t.agent)!==null&&t!==void 0&&t.agent_id){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,_(!0),a.next=6,(0,R.CU)(String(n.data.detailList.agent.agent_id),1);case 6:o=a.sent,(i=o.data)!==null&&i!==void 0&&i.list&&(N(o.data.list),He(o.data.total_pages>1),De(1)),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(2),console.error("Failed to fetch initial messages:",a.t0);case 13:return a.prev=13,_(!1),a.finish(13);case 16:case"end":return a.stop()}},e,null,[[2,10,13,16]])}));return function(){return l.apply(this,arguments)}}();if(P)return(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(Pe.Z,{})});var da=function(){var l=I()(h()().mark(function e(){return h()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,T(!0),i.next=4,de();case 4:setTimeout(I()(h()().mark(function o(){var d,a;return h()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,(0,R.Dh)((d=n.data)===null||d===void 0||(d=d.detailList)===null||d===void 0||(d=d.agent)===null||d===void 0?void 0:d.agent_id);case 3:a=v.sent,a.code==0?$.ZP.success(S.formatMessage({id:"agent.message.success.publish"})):$.ZP.error(S.formatMessage({id:"agent.message.fail.publish"})),v.next=11;break;case 7:v.prev=7,v.t0=v.catch(0),console.error("Failed to publish agent:",v.t0),$.ZP.error(S.formatMessage({id:"agent.message.fail.publish"}));case 11:return v.prev=11,T(!1),v.finish(11);case 14:case"end":return v.stop()}},o,null,[[0,7,11,14]])})),500),i.next=11;break;case 7:i.prev=7,i.t0=i.catch(0),console.error("Failed to save before publish:",i.t0),T(!1);case 11:case"end":return i.stop()}},e,null,[[0,7]])}));return function(){return l.apply(this,arguments)}}();if(ze)return null;var va=function(){var e,t;return(0,r.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,r.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.app)===null||e===void 0?void 0:e.name,p&&(y==null||(t=y.agent)===null||t===void 0?void 0:t.m_config_id)&&(0,r.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[la(y.agent.m_config_id),sa(y.agent.m_config_id)&&(0,r.jsx)(k.Z,{color:"blue",className:"text-xs",children:S.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})}),ia(y.agent.m_config_id)&&(0,r.jsx)(k.Z,{color:"default",className:"text-xs",children:S.formatMessage({id:"workflow.tag.localModel",defaultMessage:"Local Model"})})]})})]}),(0,r.jsx)(w.ZP,{type:"text",icon:p?(0,r.jsx)(Le.Z,{}):(0,r.jsx)(Ze,{}),onClick:ra,title:S.formatMessage({id:p?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),n.operationbentate=="false"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:te,onClick:de,className:"min-w-24",children:S.formatMessage({id:"agent.btn.savedebug"})}),(0,r.jsx)(w.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:Ke||te,onClick:da,className:"min-w-24",children:S.formatMessage({id:"agent.publish"})})]})]})};return(0,r.jsx)("div",{ref:qe,className:n.iframe?"w-full":"".concat(p?"fixed inset-0 z-50  border border-gray-300 !h-screen top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:n.iframe?n.iframe.height:p?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,r.jsxs)(we.A,{formRef:O,submitter:!1,onFinish:oa,layout:"horizontal",initialValues:{ability_id:0},style:{height:n.iframe?n.iframe.height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[n.iframe?null:(0,r.jsx)(va,{}),re?(0,r.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(p?"max-w-[1400px] mx-auto justify-center":""),style:{height:n.iframe?n.iframe.height:p?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,r.jsx)(be.aS,{children:(0,r.jsx)(ye.F,{agentList:{current:[y]},abilitiesList:(C=n.data)===null||C===void 0?void 0:C.abilitiesList,agentChatRoomId:re,chatStatus:(j=n.data)===null||j===void 0||(j=j.detailList)===null||j===void 0?void 0:j.chat_status})})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(Ue.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})}}]);
