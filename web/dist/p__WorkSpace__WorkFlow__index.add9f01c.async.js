"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,be,t){var Re=t(5574),H=t.n(Re),Be=t(42881),q=t(67294),ie=t(85893),p=function(D){var $e=D.children,J=D.className,z=J===void 0?"":J,te=D.dragDirection,ve=te===void 0?"left":te,we=D.minWidth,Pe=we===void 0?115:we,he=D.maxWidth,F=he===void 0?820:he,ue=D.minHeight,i=ue===void 0?200:ue,ae=D.maxHeight,xe=ae===void 0?800:ae,Y=D.defaultWidth,Ce=Y===void 0?415:Y,v=D.defaultHeight,_=v===void 0?300:v,e=D.onChange,ee=(0,q.useState)(Ce),ke=H()(ee,2),He=ke[0],pe=ke[1],Je=(0,q.useState)(_),fe=H()(Je,2),rt=fe[0],Ye=fe[1],it=(0,q.useCallback)(function(Fe,Ue){pe(Fe),Ue&&Ye(Ue),e==null||e(Fe,Ue)},[pe,Ye,e]),Xe=(0,Be.W)({direction:["left","right"].includes(ve)?"horizontal":"vertical",triggerDirection:ve,minWidth:Pe,maxWidth:F,minHeight:i,maxHeight:xe,onResize:it}),Ze=Xe.triggerRef,lt=Xe.containerRef;return(0,ie.jsxs)("div",{ref:lt,style:{width:["left","right"].includes(ve)?"".concat(He,"px"):void 0,height:["top","bottom"].includes(ve)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(z),children:[ve==="left"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="right"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ie.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ve==="top"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ve==="bottom"&&(0,ie.jsx)("div",{ref:Ze,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ie.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),$e]})};be.Z=(0,q.memo)(p)},36711:function(bt,be,t){t.r(be),t.d(be,{waitTime:function(){return he},waitTimePromise:function(){return Pe}});var Re=t(97857),H=t.n(Re),Be=t(5574),q=t.n(Be),ie=t(15009),p=t.n(ie),Ge=t(99289),D=t.n(Ge),$e=t(42237),J=t(29608),z=t(83535),te=t(35312),ve=t(67294),we=t(85893),Pe=function(){var F=D()(p()().mark(function ue(){var i,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return i=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.abrupt("return",new Promise(function(Ce){setTimeout(function(){Ce(!0)},i)}));case 2:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}(),he=function(){var F=D()(p()().mark(function ue(){var i,ae=arguments;return p()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return i=ae.length>0&&ae[0]!==void 0?ae[0]:100,Y.next=3,Pe(i);case 3:case"end":return Y.stop()}},ue)}));return function(){return F.apply(this,arguments)}}();be.default=function(){var F=(0,te.useIntl)(),ue=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:F.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ee;v==null||(ee=v.current)===null||ee===void 0||ee.submit()}}},{title:F.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:F.formatMessage({id:"workflow.created_time_des",defaultMessage:F.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:F.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ee;v==null||(ee=v.current)===null||ee===void 0||ee.submit()}},valueEnum:{1:{text:F.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:F.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:F.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(F.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:F.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:F.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],i=(0,te.useSearchParams)(),ae=q()(i,1),xe=ae[0],Y=(0,J.Z)(function(_){return _.setRunPanelLogRecord}),Ce=xe.get("app_id"),v=(0,ve.useRef)(null);return(0,we.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,we.jsx)("div",{children:(0,we.jsx)(z.Z,{columns:ue,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var _=D()(p()().mark(function e(ee,ke,He){var pe;return p()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return console.log(ee,ke,He),fe.next=3,(0,$e.bB)(H()(H()({app_runs_name:"",app_runs_status:0},ee),{},{app_id:Ce}));case 3:return pe=fe.sent,console.log(pe),fe.abrupt("return",{data:pe.data.list,success:!0,total:pe.data.total_count});case 6:case"end":return fe.stop()}},e)}));return function(e,ee,ke){return _.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),Y(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:F.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(bt,be,t){t.r(be),t.d(be,{default:function(){return ba}});var Re=t(15009),H=t.n(Re),Be=t(99289),q=t.n(Be),ie=t(97857),p=t.n(ie),Ge=t(5574),D=t.n(Ge),$e=t(32060),J=t(42237),z=t(35312),te=t(63648),ve=t(16091),we=t(13118),Pe=t(78234),he=t(77598),F=t(45360),ue=t(85576),i=t(67294),ae=t(64599),xe=t.n(ae),Y=t(7493),Ce=t(34559),v=t(15425),_=t(96906),e=t(85893),ee=function(s){return{nodes:s.nodes,edges:s.edges,onNodesChange:s.onNodesChange,onEdgesChange:s.onEdgesChange,onConnect:s.onConnect,nodeTypes:s.nodeTypes,connectionLineStyle:s.connectionLineStyle,defaultViewport:s.defaultViewport,onDrop:s.onDrop,onDragOver:s.onDragOver,setSelect:s.setSelect,preventScrolling:s.preventScrolling}},ke=(0,i.memo)(function(l){var s=l.children,u=(0,z.useIntl)(),f=(0,v.Z)(function(c){return c.nodes}),b=(0,v.Z)(function(c){return c.getEdges}),a=(0,v.Z)(function(c){return c.edges}),C=(0,v.Z)(function(c){return c.setEdges}),r=(0,v.Z)(function(c){return c.onNodesChange}),n=(0,v.Z)(function(c){return c.onEdgesChange}),g=(0,v.Z)(function(c){return c.onConnect}),x=(0,v.Z)(function(c){return c.nodeTypes}),I=(0,v.Z)(function(c){return c.connectionLineStyle}),k=(0,v.Z)(function(c){return c.defaultViewport}),$=(0,v.Z)(function(c){return c.onDrop}),P=(0,v.Z)(function(c){return c.onDragOver}),d=(0,v.Z)(function(c){return c.setSelect}),m=(0,v.Z)(function(c){return c.preventScrolling}),A=(0,i.useCallback)(function(c){var L=f.find(function(N){return N.id===c.target}),h=function N(O){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(S.has(O.id))return!1;S.add(O.id);var T=xe()((0,Y.xA)(O,f,a)),j;try{for(T.s();!(j=T.n()).done;){var le=j.value;if(le.id===c.source||N(le,S))return!0}}catch(ce){T.e(ce)}finally{T.f()}};return L.id===c.source?!1:!h(L)},[f,a]),ge=function(){},U=(0,i.useCallback)(function(c,L){console.log(c,L,b(),(0,Y.Kz)(c,L,a)),C((0,Y.Kz)(c,L,b()))},[]);return(0,he.Z)(function(){},[f]),(0,e.jsx)(Ce.tV,{children:(0,e.jsx)(te.x$,{onViewportChange:ge,nodes:f,edges:a,onNodesChange:r,onEdgesChange:n,onEdgesDelete:function(L){},onConnect:g,onReconnect:U,nodeTypes:x,minZoom:.3,maxZoom:1,connectionLineStyle:I,snapToGrid:!1,isValidConnection:A,connectionRadius:30,preventScrolling:m,onDragOver:P,onPaneClick:function(){d("")},onPaneContextMenu:function(L){L.preventDefault()},onSelectionChange:function(L){},onNodeClick:function(L,h){d(h.id)},onEdgeClick:function(L,h){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(L){},onBeforeDelete:function(){var c=q()(H()().mark(function L(h){var N;return H()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if((h==null||(N=h.nodes)===null||N===void 0||(N=N[0])===null||N===void 0?void 0:N.type)!=_.vW.Start){S.next=3;break}return F.ZP.error(u.formatMessage({id:"workflow.delStartNodeError"})),S.abrupt("return",Promise.reject(u.formatMessage({id:"workflow.delStartNodeError"})));case 3:return d(""),S.abrupt("return",Promise.resolve(h));case 5:case"end":return S.stop()}},L)}));return function(L){return c.apply(this,arguments)}}(),fitView:!0,children:s})})}),He=function(s){var u=(0,i.useCallback)(function(a){a.preventDefault(),a.dataTransfer.dropEffect="move"},[]),f=(0,i.useCallback)(function(a){a.preventDefault();var C=a.dataTransfer.getData("application/reactflow");if(!C)return null;var r=JSON.parse(C),n=r.type,g=r.item;if(!n||!g)return null;var x=s({x:a.clientX,y:a.clientY});return{position:x,type:n,item:g}},[s]),b=(0,i.useCallback)(function(a){var C=function(n){var g=f(n);g&&a(g.position,g.type,g.item)};return document.addEventListener("dragover",u),document.addEventListener("drop",C),function(){document.removeEventListener("dragover",u),document.removeEventListener("drop",C)}},[u,f]);return{onDnD:b}},pe=He,Je=function(){var s=(0,v.Z)(function(r){return r.setAgentData}),u=(0,v.Z)(function(r){return r.setSkillData}),f=(0,v.Z)(function(r){return r.setToolData}),b=(0,v.Z)(function(r){return r.setDatasetData}),a=(0,v.Z)(function(r){return r.setTeamDatasetData}),C=(0,v.Z)(function(r){return r.setModelOptionsData});(0,i.useEffect)(function(){(0,J.x$)(2).then(function(r){r.code===0&&s({team:r.data})}),(0,J.x$)(3).then(function(r){r.code===0&&s({user:r.data})}),(0,J.w)(2).then(function(r){r.code===0&&u({team:r.data})}),(0,J.w)(3).then(function(r){r.code===0&&u({user:r.data})}),(0,J.GZ)().then(function(r){r.code===0&&f({list:Object.values(r.data)})}),(0,J.fZ)().then(function(r){var n,g=Array.isArray(r==null||(n=r.data)===null||n===void 0?void 0:n.data)?r.data.data:[],x=g.map(function(m){return{label:m.supplier_name,options:Array.isArray(m.model_list)?m.model_list.map(function(A){return p()(p()({},A),{},{label:A.model_name,value:A.model_config_id})}):[]}}),I,k=xe()(g),$;try{for(k.s();!($=k.n()).done;){var P=$.value;if(Array.isArray(P.model_list)){var d=P.model_list.find(function(m){return m.model_default_used===1});if(d){I=d.model_config_id;break}}}}catch(m){k.e(m)}finally{k.f()}C({options:x,defaultValue:I})}),(0,J.mG)().then(function(r){r.code==0&&b({list:r.data.data.map(function(n){return p()(p()({},n),{},{label:n.name,value:n.dataset_id})})})}),(0,J.mG)(2).then(function(r){r.code==0&&a({list:r.data.data.map(function(n){return p()(p()({},n),{},{label:n.name,value:n.dataset_id})})})})},[s,u,f])},fe=Je,rt=t(18032),Ye=(0,i.memo)(function(l){var s=l.onSubmit,u=l.onClose;return(0,e.jsx)(rt.default,{onSubmit:s,onClose:u})}),it=t(39873),Xe=t(47520),Ze=t(36711),lt=t(82826),Fe=t(43425),Ue=t(48869),Tt=t(69243),Et=t(91806),st=t(34994),Qe=t(52688),Pt=t(55241),Zt=t(50136),dt=t(43586),Wt=function(){var s,u=(0,z.useIntl)(),f=(0,i.useState)(!0),b=D()(f,2),a=b[0],C=b[1],r=(0,v.Z)(function(S){return S.setWorkflowEditInfo}),n=(0,v.Z)(function(S){return S.workFlowInfo}),g=(0,v.Z)(function(S){return S.setSelect}),x=(0,i.useState)("1"),I=D()(x,2),k=I[0],$=I[1],P=(0,i.useState)(!1),d=D()(P,2),m=d[0],A=d[1],ge=(0,dt.Z)(),U=(0,i.useRef)(null),c=function(){var T,j;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{tooltip:(n==null||(T=n.app)===null||T===void 0?void 0:T.publish_status)!="1"?{title:u.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(n==null||(j=n.app)===null||j===void 0?void 0:j.publish_status)!="1",name:"enable_api",label:"API"})]})})})},L=[{key:"4",icon:(0,e.jsx)(lt.Z,{}),label:u.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:n!=null&&n.isProd?(0,e.jsx)(Fe.Z,{}):(0,e.jsx)(Pt.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Fe.Z,{})}),label:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:n==null?void 0:n.isProd},{key:"1",icon:(0,e.jsx)(Ue.Z,{}),label:u.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Tt.Z,{}),label:u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:m?u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):u.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!m},{key:"3",icon:(0,e.jsx)(Et.Z,{}),label:u.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,he.Z)(function(){if(n){var S,T,j,le,ce=n==null||(S=n.app)===null||S===void 0?void 0:S.is_public,je=n==null||(T=n.app)===null||T===void 0?void 0:T.enable_api,se={};se.is_public=!!ce,se.enable_api=(n==null||(j=n.app)===null||j===void 0?void 0:j.publish_status)=="1"?!!je:!1,console.log(se),A(se.enable_api),U==null||(le=U.current)===null||le===void 0||le.setFieldsValue(se)}},[n]);var h=function(T,j){console.log(T,j),N(j.enable_api),r(j),setTimeout(ge,300)},N=function(T){A(!!T)},O=function(T){var j;switch(T.key){case"4":z.history.go(-1);break;case"0":break;case"2":window.open(Xe._n+(n==null||(j=n.app)===null||j===void 0?void 0:j.api_url),"_blank");break;default:g(""),$(T.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(k==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Zt.Z,{defaultSelectedKeys:["1"],selectedKeys:[k],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:a,items:L,onClick:O}),k=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(st.A,{formRef:U,submitter:{render:function(){return null}},onValuesChange:h,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{disabled:!(n!=null&&(s=n.app)!==null&&s!==void 0&&s.api_url),name:"enable_api",label:"API"})]})})})]}),k=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(Ze.default,{})})})]})},At=Wt,ut=t(71471),Lt=(0,i.memo)(function(l){var s=l.name,u=l.description,f=l.publishStatus,b=(0,z.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ut.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:s}),f&&(0,e.jsxs)(ut.Z.Text,{className:"whitespace-normal",children:["(",b.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ut.Z.Text,{className:"whitespace-normal text-gray-500",children:u})]})}),Ot=t(19632),wt=t.n(Ot),Rt=t(9783),qe=t.n(Rt),Bt=t(22352),ct=t(2302),$t=t(26474),Ht=t(40110),Ft=t(86615),Ut=t(5966),_t=t(62370),Kt=t(96638),zt=t(74330),Vt=t(11941),vt=t(69386),Gt=t(96486),Jt=t(87718),Yt=t(63783),et=t(83062),ft=t(99510),mt=(0,i.memo)(function(l){var s=l.children,u=l.onDragStart,f=l.onClick,b=l.type,a=l.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(r){return u(r,b,a)},onClick:f,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:s})}),Xt=(0,i.memo)(function(l){var s,u,f,b,a=l.item,C=l.onDragStart,r=l.typeBadge,n=l.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(a==null||(s=a.baseData)===null||s===void 0?void 0:s.description)||(a==null||(u=a.data)===null||u===void 0?void 0:u.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:C,type:a.type,item:a,onClick:function(){return n==null?void 0:n(a)},children:(0,e.jsx)(ft.Z,{title:a.data.title,icon:(a==null||(f=a.baseData)===null||f===void 0?void 0:f.avatar)||(a==null||(b=a.baseData)===null||b===void 0?void 0:b.icon)||a.type,typeBadge:r})})})})}),Qt=(0,i.memo)(function(l){var s,u=l.item,f=l.onDragStart,b=l.typeBadge,a=l.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(s=u.baseData)===null||s===void 0?void 0:s.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:f,type:u.type,item:u,onClick:function(){return a==null?void 0:a(u)},children:(0,e.jsx)(ft.Z,{title:u.baseData.name,icon:u.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:u.baseData.nickname}),typeBadge:b})})})})}),qt=(0,i.memo)(function(l){var s,u,f,b,a,C,r,n,g,x,I,k,$,P,d=l.tool,m=l.category,A=l.onDragStart,ge=l.typeBadge,U=l.onItemClick,c=l.categoryIndex,L=l.toolIndex,h=(0,z.getLocale)()==="en-US"?"en_US":"zh_Hans",N=(0,ct.o6)()[_.vW.Tool],O=p()(p()({},d),{},{authorization_status:m==null?void 0:m.authorization_status,title:d==null||(s=d.identity)===null||s===void 0?void 0:s.label[h],icon:m==null||(u=m.identity)===null||u===void 0?void 0:u.icon,groupName:m==null||(f=m.identity)===null||f===void 0?void 0:f.name,credentials_for_provider:m==null?void 0:m.credentials_for_provider}),S={title:d==null||(b=d.identity)===null||b===void 0?void 0:b.label[h],desc:(d==null||(a=d.description)===null||a===void 0||(a=a.human)===null||a===void 0?void 0:a[h])||(d==null||(C=d.description)===null||C===void 0?void 0:C.llm),icon:m==null||(r=m.identity)===null||r===void 0?void 0:r.icon,data:{title:d==null||(n=d.identity)===null||n===void 0?void 0:n.label[h],desc:(d==null||(g=d.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[h])||(d==null||(x=d.description)===null||x===void 0?void 0:x.llm),icon:m==null||(I=m.identity)===null||I===void 0?void 0:I.icon,optput:d==null?void 0:d.output},baseData:O};return(0,e.jsx)(et.Z,{placement:"right",title:d==null||(k=d.description)===null||k===void 0||(k=k.human)===null||k===void 0?void 0:k[h],children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:A,type:_.vW.Tool,item:S,onClick:function(){return U==null?void 0:U(m,d,c,L)},children:(0,e.jsx)("div",{className:"text-sm py-2 pl-2 text-gray-600",children:(d==null||($=d.identity)===null||$===void 0?void 0:$.label[h])||(d==null||(P=d.identity)===null||P===void 0?void 0:P.label.en_US)})})})})}),ea=(0,i.memo)(function(l){var s,u,f,b,a=l.category,C=l.onDragStart,r=l.typeBadge,n=l.onItemClick,g=l.categoryIndex,x=(0,z.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{className:"flex flex-col pb-2",children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2 flex items-center",children:[(0,e.jsx)(ft.Z,{title:(a==null||(s=a.identity)===null||s===void 0?void 0:s.label[x])||(a==null||(u=a.identity)===null||u===void 0?void 0:u.label.en_US),icon:a==null||(f=a.identity)===null||f===void 0?void 0:f.icon,typeBadge:r}),(0,e.jsx)(et.Z,{placement:"right",title:a==null||(b=a.identity)===null||b===void 0?void 0:b.description[x],children:(0,e.jsx)(Yt.Z,{className:"cursor-pointer ml-1"})})]}),a.tools.map(function(I,k){return(0,e.jsx)("div",{className:"pl-6",children:(0,e.jsx)(qt,{tool:I,category:a,onDragStart:C,typeBadge:r,onItemClick:function(P,d,m,A){return n==null?void 0:n(P,d,m,A)},categoryIndex:g,toolIndex:k},k)})})]})}),ta=function(s){var u=s.list,f=s.onDragStart,b=s.type,a=b===void 0?"normal":b,C=s.typeBadge,r=C===void 0?null:C,n=s.onItemClick;return u!=null&&u.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:a==="tools"?u.map(function(g,x){return(0,e.jsx)(ea,{category:g,typeBadge:r,onDragStart:f,onItemClick:n,categoryIndex:x},x)}):a==="workflow"?u.map(function(g,x){return(0,e.jsx)(Qt,{item:g,onDragStart:f,typeBadge:r,onItemClick:n},x)}):u.map(function(g,x){return(0,e.jsx)(Xt,{item:g,onDragStart:f,typeBadge:r,onItemClick:n},x)})}):null},aa=(0,i.memo)(ta),na=(0,i.memo)(function(l){var s=l.visibleTabs,u=l.defaultActiveTab,f=l.showTeamSwitch,b=f===void 0?!0:f,a=l.isMinWidth,C=a===void 0?!1:a,r=l.isCollapsed,n=r===void 0?!1:r,g=l.onItemClick,x=(0,z.useIntl)(),I=(0,z.getLocale)()=="en-US"?"en_US":"zh_Hans",k=(0,ct.o6)(),$=(0,i.useMemo)(function(){return Object.values(k).filter(function(w){return![_.vW.Start,_.vW.Agent,_.vW.Tool,_.vW.Skill].includes(w.base.type)}).map(function(w){return w.base})},[k]),P=(0,i.useState)(u||"1"),d=D()(P,2),m=d[0],A=d[1],ge=(0,i.useState)($),U=D()(ge,2),c=U[0],L=U[1],h=(0,i.useState)([]),N=D()(h,2),O=N[0],S=N[1],T=(0,$t.v)(),j=T.tags,le=(0,Kt.Z)(qe()(qe()(qe()({},_.vW.Agent,[]),_.vW.Skill,[]),"workflow",[])),ce=D()(le,2),je=ce[0],se=ce[1],De=(0,i.useState)({team:1,keyword:"",tag:[]}),ye=D()(De,2),y=ye[0],_e=ye[1],Ke=(0,i.useRef)({}),gt=6e4,Me=(0,v.Z)(function(w){return w.toolData});(0,i.useEffect)(function(){S((Me==null?void 0:Me.list)||[])},[Me]);var We=(0,i.useCallback)(function(w,B,Z){w.dataTransfer.setData("application/reactflow",JSON.stringify({type:B,item:Z})),w.dataTransfer.effectAllowed="move"},[]),at=(0,i.useCallback)(function(w,B){if(!B)return w;var Z=new vt.Z(w,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),ne=Z.search(B);return ne.map(function(o){return o.item})},[]),nt=(0,i.useCallback)(function(w,B){if(!B)return w;var Z=w.map(function(E){var M;return p()(p()({},E),{},{tools:(M=E.tools)===null||M===void 0?void 0:M.map(function(X){var K,oe;return p()(p()({},X),{},{categoryName:(K=E.identity)===null||K===void 0||(K=K.label)===null||K===void 0?void 0:K[I],categoryIcon:(oe=E.identity)===null||oe===void 0?void 0:oe.icon})})})}),ne=new vt.Z(Z,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),o=ne.search(B);return o.map(function(E){return p()(p()({},E.item),{},{tools:E.item.tools.filter(function(M){var X=new vt.Z([M],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return X.search(B).length>0})})}).filter(function(E){return E.tools.length>0})},[I]),Ae=(0,i.useCallback)(function(){var w=q()(H()().mark(function B(Z){var ne,o,E,M,X,K;return H()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(ne="".concat(Z,"-").concat(y.team,"-").concat(y.keyword,"-").concat(y.tag.join(",")),o=Ke.current[ne],!(o&&Date.now()-o.timestamp<gt&&JSON.stringify(o.params)===JSON.stringify(y))){R.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(Z)),R.abrupt("return",o.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(Z)),R.prev=6,R.next=9,(0,J.RE)(Z,{search_type:y.team,apps_name:y.keyword,tag_ids:((E=y.tag)===null||E===void 0?void 0:E.join(","))||""});case 9:if(M=R.sent,!((M==null?void 0:M.code)===0&&M!==null&&M!==void 0&&M.data&&Array.isArray(M.data.list)&&M.data.list.length>0)){R.next=16;break}return X=M.data.list,K=X.filter(function(me){return me.publish_status==1}).map(function(me){var Ne,Oe;return p()(p()({},(Ne=k[Z])===null||Ne===void 0?void 0:Ne.base),{},{data:p()(p()({},(Oe=k[Z])===null||Oe===void 0?void 0:Oe.base.data),{},{title:me.name,desc:me.description}),baseData:me})}),Ke.current[ne]={data:K,timestamp:Date.now(),params:p()({},y)},se(qe()({},Z,K)),R.abrupt("return",K);case 16:return R.abrupt("return",[]);case 19:return R.prev=19,R.t0=R.catch(6),console.error("Failed to fetch ".concat(Z," data:"),R.t0),R.abrupt("return",[]);case 23:case"end":return R.stop()}},B,null,[[6,19]])}));return function(B){return w.apply(this,arguments)}}(),[y,k,se]),Ie=(0,i.useMemo)(function(){var w=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return y.keyword?at(c,y.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Ae(_.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return y.keyword?nt(O,y.keyword):O}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var Z=q()(H()().mark(function o(){return H()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Ae(_.vW.Skill);case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},o)}));function ne(){return Z.apply(this,arguments)}return ne}()}],B=s!=null&&s.length?w.filter(function(Z){return s.includes(Z.tabKey)}):w;return B.map(function(Z,ne){return p()(p()({},Z),{},{key:ne+1+""})})},[c,je,O,s,y,at,nt,Ae]),ze=(0,i.useMemo)(function(){return Ie.map(function(w){return{key:w.key,label:x.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}})},[Ie,x]),ot=(0,i.useCallback)(function(w){var B=w.tabIndex,Z=w.showName,ne=Z===void 0?!0:Z,o=Ie.find(function(W){return W.key===B}),E=(0,i.useState)([]),M=D()(E,2),X=M[0],K=M[1],oe=(0,i.useState)(!0),R=D()(oe,2),me=R[0],Ne=R[1],Oe=(0,i.useState)([]),re=D()(Oe,2),Se=re[0],St=re[1],wa=(0,i.useState)(20),xa=D()(wa,1),pt=xa[0],Da=(0,i.useState)(500),Ct=D()(Da,2),kt=Ct[0],jt=Ct[1],Te=(0,i.useRef)(null),yt=(0,i.useRef)(!1),Sa=54;(0,i.useEffect)(function(){var W=function(){if(Te.current){var Q=Te.current.clientHeight;jt(Q)}},V=function(Q){jt(Q.detail.height)};return W(),Te.current&&Te.current.addEventListener("containerResize",V),window.addEventListener("resize",W),function(){Te.current&&Te.current.removeEventListener("containerResize",V),window.removeEventListener("resize",W)}},[]),(0,i.useEffect)(function(){return function(){yt.current=!1}},[o==null?void 0:o.tabKey]),(0,i.useEffect)(function(){var W=function(){var V=q()(H()().mark(function de(){var Q,Ee;return H()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!(yt.current&&!y.keyword&&y.tag.length===0)){G.next=2;break}return G.abrupt("return");case 2:if(Ne(!0),G.prev=3,o){G.next=6;break}return G.abrupt("return");case 6:return G.next=8,o.getData();case 8:Q=G.sent,Ee=(Q==null?void 0:Q.map(function(ka,ja){return p()(p()({},ka),{},{id:"".concat(o.tabKey,"-").concat(ja)})}))||[],K(Ee),St(Ee.slice(0,pt)),yt.current=!0,G.next=18;break;case 15:G.prev=15,G.t0=G.catch(3),console.error("Failed to fetch data:",G.t0);case 18:return G.prev=18,Ne(!1),G.finish(18);case 21:case"end":return G.stop()}},de,null,[[3,15,18,21]])}));return function(){return V.apply(this,arguments)}}();W()},[o,y,pt]);var Ca=function(V){if(V.currentTarget.scrollHeight-V.currentTarget.scrollTop===kt){var de=Se.length;if(de<X.length){var Q=X.slice(de,de+pt);St(function(Ee){return[].concat(wt()(Ee),wt()(Q))})}}},Mt=(0,i.useCallback)(function(W){var V,de,Q;if(o){switch(console.log("Clicked item:",W),o.tabKey){case"tool":console.log("Tool ".concat((V=W.identity)===null||V===void 0||(V=V.label)===null||V===void 0?void 0:V[I]));break;case"workflow":console.log("Workflow ".concat((de=W.data)===null||de===void 0?void 0:de.title));break;case"agent":console.log("Agent ".concat((Q=W.data)===null||Q===void 0?void 0:Q.title));break;default:console.log("Clicked ".concat(o.tabKey," item:"),W)}g&&g(W,o.tabKey)}},[o,I,g]),It=(0,i.memo)(function(W){var V=W.data,de=W.index,Q=W.onDragStart,Ee=W.onItemClick,Nt=W.type,G=W.typeBadge;return(0,e.jsx)(aa,{typeBadge:G,list:[V],onDragStart:Q,type:Nt,onItemClick:Ee})});return o?(0,e.jsx)("div",{ref:Te,className:"overflow-y-auto h-full",children:(0,e.jsx)(zt.Z,{spinning:me,children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:Se.map(function(W){return(0,e.jsx)(It,{data:W,index:Se.indexOf(W),onDragStart:We,onItemClick:Mt,type:o.type,typeBadge:y!=null&&y.keyword&&o.tabKey!="node"?{icon:"/icons/".concat(o.tabKey,".svg"),tooltip:o.tabKey,color:"#1b64f3"}:void 0},W.id)})}):(0,e.jsx)(Jt.Z,{data:Se,height:kt,itemHeight:Sa,itemKey:"id",onScroll:Ca,children:function(V){return(0,e.jsx)(It,{data:V,index:Se.indexOf(V),onDragStart:We,onItemClick:Mt,type:o.type,typeBadge:y!=null&&y.keyword&&o.tabKey!="node"?{icon:"/icons/".concat(o.tabKey,".svg"),tooltip:o.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[m,y,C,Ie,We,I,g]),Ve=(0,i.useCallback)((0,Gt.debounce)(function(w){_e(w)},500),[]),Le=(0,i.useCallback)(function(){Ke.current={}},[]);(0,i.useEffect)(function(){Le()},[y.team,Le]);var ht=(0,i.useCallback)(function(w,B){"team"in w?_e(B):("tag"in w||"keyword"in w)&&Ve(B)},[Ve]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!n&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(st.A,{submitter:!1,initialValues:y,onValuesChange:ht,children:[b&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[x.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Ft.Z.Group,{name:"team",fieldProps:{options:[{label:x.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:x.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Ut.Z,{fieldProps:{prefix:(0,e.jsx)(Ht.Z,{}),placeholder:x.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(_t.Z,{name:"tag",children:(0,e.jsx)(Bt.O,{className:"w-full",options:j,listStyle:C?"horizontal":"vertical",allowClear:!0,placeholder:x.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(B){}})})})]}),y!=null&&y.keyword?null:(0,e.jsx)(Vt.Z,{activeKey:m,items:ze,onChange:function(B){A(B)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ie.map(function(w,B){return(0,e.jsxs)("div",{className:"space-y-2",children:[!n&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:x.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}),(0,e.jsx)(ot,{tabIndex:B+1+"",showName:!C},w.key)]},w.key)})}):(0,e.jsx)(ot,{tabIndex:m,showName:!C})})]})}),oa=(0,i.memo)(function(l){var s=l.visibleTabs,u=l.defaultActiveTab,f=l.showTeamSwitch,b=f===void 0?!0:f,a=l.workflowName,C=l.workflowDesc,r=l.publishStatus,n=l.onWidthChange,g=l.onItemClick,x=(0,i.useState)(!1),I=D()(x,2),k=I[0],$=I[1],P=(0,i.useState)(!1),d=D()(P,2),m=d[0],A=d[1];return(0,e.jsx)(it.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:m?100:315,onChange:function(U,c){requestAnimationFrame(function(){$(U<100),n==null||n(U);var L=document.querySelectorAll(".overflow-y-auto");L.forEach(function(h){if(h instanceof HTMLElement){var N=h.clientHeight,O=new CustomEvent("containerResize",{detail:{height:N,width:U}});h.dispatchEvent(O)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(na,{visibleTabs:s,defaultActiveTab:u,showTeamSwitch:b,isMinWidth:k,isCollapsed:m,onItemClick:g}),(0,e.jsx)(At,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Lt,{name:a,description:C,publishStatus:r})})]})})}),ra=t(74842),ia=t(98165),la=t(58638),tt=t(28036),sa=t(27484),da=t.n(sa),xt=t(70681),ua=200,ca=80,va={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},fa=function(){var s=(0,te._K)(),u=s.getNodes,f=s.getEdges,b=s.setNodes,a=function(n){return{width:n.width||ua,height:n.height||ca}},C=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",g=u(),x=f();if(g.length){var I=new xt.graphlib.Graph;I.setDefaultEdgeLabel(function(){return{}});var k=p()(p()({},va),{},{rankdir:n});I.setGraph(k),g.forEach(function(P){var d=a(P),m=d.width,A=d.height;I.setNode(P.id,{width:m,height:A})}),x.forEach(function(P){I.setEdge(P.source,P.target)}),xt.layout(I);var $=g.map(function(P){var d=I.node(P.id);return p()(p()({},P),{},{position:{x:d.x-d.width/2,y:d.y-d.height/2}})});b($)}};return{autoLayout:C}},ma=fa,ga=(0,i.memo)(function(){var l=(0,z.useIntl)(),s=(0,z.useSearchParams)(),u=D()(s,1),f=u[0],b=(0,v.Z)(function(h){return h.setWorkFlowInfo}),a=(0,v.Z)(function(h){return h.workFlowInfo}),C=(0,v.Z)(function(h){return h.setRunPanelShow}),r=f.get("type")=="true",n=(0,dt.Z)(),g=ma(),x=g.autoLayout,I=F.ZP.useMessage(),k=D()(I,2),$=k[0],P=k[1],d=(0,v.Z)(function(h){return h.loadingWorkflowData}),m=function(){var h=q()(H()().mark(function N(){var O;return H()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,n();case 2:O=f.get("app_id"),(0,J.aJ)(O).then(function(j){console.log(j),j.code==0&&(b(p()(p()({},a),{},{app:p()(p()({},a==null?void 0:a.app),{},{publish_status:"1"})})),$.open({type:"success",content:l.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return T.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),A=function(){C(!0)},ge=function(){var h=q()(H()().mark(function N(){var O,S;return H()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return O=f.get("app_id"),j.next=3,(0,J.Uq)(O);case 3:S=j.sent;case 4:case"end":return j.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),U=function(){var h=q()(H()().mark(function N(){var O,S,T,j;return H()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:S=f.get("app_id"),T=(a==null||(O=a.app)===null||O===void 0?void 0:O.name)||"workflow",j=da()().format("YYYY_MM_DD-HH_mm_ss"),(0,J.w8)(S,r==!0?1:0).then(function(je){var se=je,De=new Blob([se],{type:"text/yaml"}),ye=URL.createObjectURL(De),y=document.createElement("a");y.href=ye,y.download="".concat(T,"_").concat(j,".yml"),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(ye)});case 4:case"end":return ce.stop()}},N)}));return function(){return h.apply(this,arguments)}}(),c=function(N){x(N),$.open({type:"success",content:l.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},L=[{key:"TB",label:l.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:l.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}];return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!r&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(tt.ZP,{type:"primary",disabled:d,onClick:m,children:l.formatMessage({id:"workflow.release"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(ra.Z,{}),disabled:d,onClick:A,children:l.formatMessage({id:"workflow.run"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(ia.Z,{}),type:"dashed",disabled:d,onClick:n,children:l.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(la.Z,{}),type:"dashed",onClick:U,disabled:d,children:l.formatMessage({id:"workflow.export",defaultMessage:""})}),P]})}),Dt=t(64458),ha=function(){var s,u,f=(0,z.useIntl)(),b=(0,i.useRef)(null),a=(0,v.Z)(function(o){return o.resetNodes}),C=(0,v.Z)(function(o){return o.setNodeTypes}),r=(0,v.Z)(function(o){return o.addNode}),n=(0,v.Z)(function(o){return o.createNode}),g=(0,v.Z)(function(o){return o.setNodes}),x=(0,v.Z)(function(o){return o.setEdges}),I=(0,v.Z)(function(o){return o.setAppId}),k=(0,v.Z)(function(o){return o.setRunPanelShow}),$=(0,v.Z)(function(o){return o.runPanelShow}),P=(0,v.Z)(function(o){return o.getModelData}),d=(0,v.Z)(function(o){return o.setWorkFlowInfo}),m=(0,v.Z)(function(o){return o.setHandleList}),A=(0,v.Z)(function(o){return o.workFlowInfo}),ge=(0,v.Z)(function(o){return o.setWorkflowEditInfo}),U=F.ZP.useMessage(),c=D()(U,2),L=c[0],h=c[1],N=(0,te._K)(),O=N.screenToFlowPosition,S=N.getNodes,T=N.setViewport,j=pe(O),le=j.onDnD,ce=(0,z.useSearchParams)(),je=D()(ce,1),se=je[0],De=se.get("type")=="true",ye=(0,v.Z)(function(o){return o.setLoadingWorkflowData}),y=(0,te.B)({includeHiddenNodes:!1}),_e=(0,we.Z)(),Ke=(0,dt.Z)(),gt=(0,i.useState)(null),Me=D()(gt,2),We=Me[0],at=Me[1],nt=(0,i.useState)(!1),Ae=D()(nt,2),Ie=Ae[0],ze=Ae[1],ot=(0,i.useState)(""),Ve=D()(ot,2),Le=Ve[0],ht=Ve[1],w=null;(0,te.CV)({onEnd:function(E){}}),(0,Pe.Z)(function(){C((0,ct.$P)()),a(),(0,$e.b6)(),B(),m([])}),fe(),(0,i.useEffect)(function(){if(We){z.history.push(Le);return}var o=z.history.block(function(E,M){if($){ht(E.location.pathname),ze(!0);return}});return $||o==null||o(),function(){o==null||o()}},[$,We]),(0,he.Z)(function(){if(y){var o=S(),E=o[o.length-1];E.data.drag&&(E.position={x:E.position.x-E.measured.width/2,y:E.position.y-E.measured.height/2},g(o))}},[y]),(0,i.useEffect)(function(){var o=le(function(E,M,X){var K;console.log(E,M,X);var oe=p()(p()({drag:!0},X.data),{},{baseData:X.baseData});if((K=X.baseData)!==null&&K!==void 0&&K.output){var R;oe.outputInfo=(R=X.baseData)===null||R===void 0?void 0:R.output}debugger;n(M,{position:E,data:oe})});return o},[le,r]),(0,he.Z)(function(){_e=="hidden"&&Ke()},[_e]);var B=function(){var o=q()(H()().mark(function E(){var M;return H()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:M=se.get("app_id"),De&&L.open({type:"warning",content:f.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),ye(!0),I(M),(0,J.kE)(M,De?1:0).then(function(oe){if(oe.code==0){if(d(p()(p()({},oe.data),{},{isProd:De})),!oe.data.workflow.graph){ye(!1),n(_.vW.Start);return}var R=oe.data,me=R.workflow.graph,Ne=me.edges,Oe=me.nodes,re=me.views,Se=R.app;ge({enable_api:!!Se.enable_api,is_public:!!Se.is_public}),re!=null&&re.nodes&&g(re.nodes),re!=null&&re.edges&&x(re.edges),re!=null&&re.viewPort,setTimeout(function(){ye(!1)},1e3)}}),P();case 6:case"end":return K.stop()}},E)}));return function(){return o.apply(this,arguments)}}(),Z=function(){at(!0),console.log(Le),z.history.push(Le),ze(!1)},ne=function(){ze(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[h,(0,e.jsx)(ue.Z,{title:f.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ie,onOk:Z,onCancel:ne,children:f.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:b,children:(0,e.jsxs)(ke,{children:[(0,e.jsx)(te.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(te.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(oa,{workflowName:A==null||(s=A.app)===null||s===void 0?void 0:s.name,workflowDesc:A==null||(u=A.app)===null||u===void 0?void 0:u.description,publishStatus:De}),(0,e.jsx)(ga,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Ye,{})]})},pa=(0,i.memo)(function(){return(0,e.jsx)(te.tV,{children:(0,e.jsx)(ha,{})})}),ya=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(pa,{})})},ba=ya}}]);
