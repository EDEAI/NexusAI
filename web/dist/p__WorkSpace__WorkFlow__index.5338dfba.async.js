"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,we,t){var Be=t(5574),F=t.n(Be),$e=t(42881),ee=t(67294),le=t(85893),h=function(C){var He=C.children,Y=C.className,V=Y===void 0?"":Y,ae=C.dragDirection,ce=ae===void 0?"left":ae,xe=C.minWidth,Ze=xe===void 0?115:xe,he=C.maxWidth,U=he===void 0?820:he,de=C.minHeight,o=de===void 0?200:de,ne=C.maxHeight,De=ne===void 0?800:ne,X=C.defaultWidth,je=X===void 0?415:X,f=C.defaultHeight,z=f===void 0?300:f,e=C.onChange,te=(0,ee.useState)(je),Me=F()(te,2),Fe=Me[0],pe=Me[1],Ye=(0,ee.useState)(z),ve=F()(Ye,2),rt=ve[0],Xe=ve[1],it=(0,ee.useCallback)(function(Ke,ze){pe(Ke),ze&&Xe(ze),e==null||e(Ke,ze)},[pe,Xe,e]),Ue=(0,$e.W)({direction:["left","right"].includes(ce)?"horizontal":"vertical",triggerDirection:ce,minWidth:Ze,maxWidth:U,minHeight:o,maxHeight:De,onResize:it}),We=Ue.triggerRef,lt=Ue.containerRef;return(0,le.jsxs)("div",{ref:lt,style:{width:["left","right"].includes(ce)?"".concat(Fe,"px"):void 0,height:["top","bottom"].includes(ce)?"".concat(rt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(V),children:[ce==="left"&&(0,le.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,le.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ce==="right"&&(0,le.jsx)("div",{ref:We,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,le.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),ce==="top"&&(0,le.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,le.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),ce==="bottom"&&(0,le.jsx)("div",{ref:We,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,le.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),He]})};we.Z=(0,ee.memo)(h)},36711:function(bt,we,t){t.r(we),t.d(we,{waitTime:function(){return he},waitTimePromise:function(){return Ze}});var Be=t(97857),F=t.n(Be),$e=t(5574),ee=t.n($e),le=t(15009),h=t.n(le),Je=t(99289),C=t.n(Je),He=t(42237),Y=t(29608),V=t(83535),ae=t(35312),ce=t(67294),xe=t(85893),Ze=function(){var U=C()(h()().mark(function de(){var o,ne=arguments;return h()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return o=ne.length>0&&ne[0]!==void 0?ne[0]:100,X.abrupt("return",new Promise(function(je){setTimeout(function(){je(!0)},o)}));case 2:case"end":return X.stop()}},de)}));return function(){return U.apply(this,arguments)}}(),he=function(){var U=C()(h()().mark(function de(){var o,ne=arguments;return h()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return o=ne.length>0&&ne[0]!==void 0?ne[0]:100,X.next=3,Ze(o);case 3:case"end":return X.stop()}},de)}));return function(){return U.apply(this,arguments)}}();we.default=function(){var U=(0,ae.useIntl)(),de=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:U.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var te;f==null||(te=f.current)===null||te===void 0||te.submit()}}},{title:U.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:U.formatMessage({id:"workflow.created_time_des",defaultMessage:U.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:U.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var te;f==null||(te=f.current)===null||te===void 0||te.submit()}},valueEnum:{1:{text:U.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:U.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:U.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(U.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:U.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:U.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],o=(0,ae.useSearchParams)(),ne=ee()(o,1),De=ne[0],X=(0,Y.Z)(function(z){return z.setRunPanelLogRecord}),je=De.get("app_id"),f=(0,ce.useRef)(null);return(0,xe.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,xe.jsx)("div",{children:(0,xe.jsx)(V.Z,{columns:de,formRef:f,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var z=C()(h()().mark(function e(te,Me,Fe){var pe;return h()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return console.log(te,Me,Fe),ve.next=3,(0,He.bB)(F()(F()({app_runs_name:"",app_runs_status:0},te),{},{app_id:je}));case 3:return pe=ve.sent,console.log(pe),ve.abrupt("return",{data:pe.data.list,success:!0,total:pe.data.total_count});case 6:case"end":return ve.stop()}},e)}));return function(e,te,Me){return z.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),X(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:U.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(bt,we,t){t.r(we),t.d(we,{default:function(){return ba}});var Be=t(15009),F=t.n(Be),$e=t(99289),ee=t.n($e),le=t(97857),h=t.n(le),Je=t(5574),C=t.n(Je),He=t(32060),Y=t(42237),V=t(35312),ae=t(63648),ce=t(16091),xe=t(13118),Ze=t(78234),he=t(77598),U=t(45360),de=t(85576),o=t(67294),ne=t(64599),De=t.n(ne),X=t(7493),je=t(34559),f=t(15425),z=t(96906),e=t(85893),te=function(i){return{nodes:i.nodes,edges:i.edges,onNodesChange:i.onNodesChange,onEdgesChange:i.onEdgesChange,onConnect:i.onConnect,nodeTypes:i.nodeTypes,connectionLineStyle:i.connectionLineStyle,defaultViewport:i.defaultViewport,onDrop:i.onDrop,onDragOver:i.onDragOver,setSelect:i.setSelect,preventScrolling:i.preventScrolling}},Me=(0,o.memo)(function(r){var i=r.children,u=(0,V.useIntl)(),v=(0,f.Z)(function(c){return c.nodes}),x=(0,f.Z)(function(c){return c.getEdges}),l=(0,f.Z)(function(c){return c.edges}),D=(0,f.Z)(function(c){return c.setEdges}),s=(0,f.Z)(function(c){return c.onNodesChange}),a=(0,f.Z)(function(c){return c.onEdgesChange}),g=(0,f.Z)(function(c){return c.onConnect}),S=(0,f.Z)(function(c){return c.nodeTypes}),M=(0,f.Z)(function(c){return c.connectionLineStyle}),j=(0,f.Z)(function(c){return c.defaultViewport}),B=(0,f.Z)(function(c){return c.onDrop}),T=(0,f.Z)(function(c){return c.onDragOver}),d=(0,f.Z)(function(c){return c.setSelect}),m=(0,f.Z)(function(c){return c.preventScrolling}),$=(0,o.useCallback)(function(c){var L=v.find(function(b){return b.id===c.target}),E=function b(W){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(p.has(W.id))return!1;p.add(W.id);var P=De()((0,X.xA)(W,v,l)),N;try{for(P.s();!(N=P.n()).done;){var H=N.value;if(H.id===c.source||b(H,p))return!0}}catch(ye){P.e(ye)}finally{P.f()}};return L.id===c.source?!1:!E(L)},[v,l]),fe=function(){},K=(0,o.useCallback)(function(c,L){console.log(c,L,x(),(0,X.Kz)(c,L,l)),D((0,X.Kz)(c,L,x()))},[]);return(0,he.Z)(function(){},[v]),(0,e.jsx)(je.tV,{children:(0,e.jsx)(ae.x$,{onViewportChange:fe,nodes:v,edges:l,onNodesChange:s,onEdgesChange:a,onEdgesDelete:function(L){},onConnect:g,onReconnect:K,nodeTypes:S,minZoom:.3,maxZoom:1,connectionLineStyle:M,snapToGrid:!1,isValidConnection:$,connectionRadius:30,preventScrolling:m,onDragOver:T,onPaneClick:function(){d("")},onPaneContextMenu:function(L){L.preventDefault()},onSelectionChange:function(L){},onNodeClick:function(L,E){d(E.id)},onEdgeClick:function(L,E){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(L){},onBeforeDelete:function(){var c=ee()(F()().mark(function L(E){var b;return F()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if((E==null||(b=E.nodes)===null||b===void 0||(b=b[0])===null||b===void 0?void 0:b.type)!=z.vW.Start){p.next=3;break}return U.ZP.error(u.formatMessage({id:"workflow.delStartNodeError"})),p.abrupt("return",Promise.reject(u.formatMessage({id:"workflow.delStartNodeError"})));case 3:return d(""),p.abrupt("return",Promise.resolve(E));case 5:case"end":return p.stop()}},L)}));return function(L){return c.apply(this,arguments)}}(),fitView:!0,children:i})})}),Fe=function(i){var u=(0,o.useCallback)(function(l){l.preventDefault(),l.dataTransfer.dropEffect="move"},[]),v=(0,o.useCallback)(function(l){l.preventDefault();var D=l.dataTransfer.getData("application/reactflow");if(!D)return null;var s=JSON.parse(D),a=s.type,g=s.item;if(!a||!g)return null;var S=i({x:l.clientX,y:l.clientY});return{position:S,type:a,item:g}},[i]),x=(0,o.useCallback)(function(l){var D=function(a){var g=v(a);g&&l(g.position,g.type,g.item)};return document.addEventListener("dragover",u),document.addEventListener("drop",D),function(){document.removeEventListener("dragover",u),document.removeEventListener("drop",D)}},[u,v]);return{onDnD:x}},pe=Fe,Ye=function(){var i=(0,f.Z)(function(s){return s.setAgentData}),u=(0,f.Z)(function(s){return s.setSkillData}),v=(0,f.Z)(function(s){return s.setToolData}),x=(0,f.Z)(function(s){return s.setDatasetData}),l=(0,f.Z)(function(s){return s.setTeamDatasetData}),D=(0,f.Z)(function(s){return s.setModelOptionsData});(0,o.useEffect)(function(){(0,Y.x$)(2).then(function(s){s.code===0&&i({team:s.data})}),(0,Y.x$)(3).then(function(s){s.code===0&&i({user:s.data})}),(0,Y.w)(2).then(function(s){s.code===0&&u({team:s.data})}),(0,Y.w)(3).then(function(s){s.code===0&&u({user:s.data})}),(0,Y.GZ)().then(function(s){s.code===0&&v({list:Object.values(s.data)})}),(0,Y.fZ)().then(function(s){var a,g=Array.isArray(s==null||(a=s.data)===null||a===void 0?void 0:a.data)?s.data.data:[],S=g.map(function(m){return{label:m.supplier_name,options:Array.isArray(m.model_list)?m.model_list.map(function($){return h()(h()({},$),{},{label:$.model_name,value:$.model_config_id})}):[]}}),M,j=De()(g),B;try{for(j.s();!(B=j.n()).done;){var T=B.value;if(Array.isArray(T.model_list)){var d=T.model_list.find(function(m){return m.model_default_used===1});if(d){M=d.model_config_id;break}}}}catch(m){j.e(m)}finally{j.f()}D({options:S,defaultValue:M})}),(0,Y.mG)().then(function(s){s.code==0&&x({list:s.data.data.map(function(a){return h()(h()({},a),{},{label:a.name,value:a.dataset_id})})})}),(0,Y.mG)(2).then(function(s){s.code==0&&l({list:s.data.data.map(function(a){return h()(h()({},a),{},{label:a.name,value:a.dataset_id})})})})},[i,u,v])},ve=Ye,rt=t(18032),Xe=(0,o.memo)(function(r){var i=r.onSubmit,u=r.onClose;return(0,e.jsx)(rt.default,{onSubmit:i,onClose:u})}),it=t(39873),Ue=t(47520),We=t(36711),lt=t(82826),Ke=t(43425),ze=t(48869),Tt=t(69243),Et=t(91806),st=t(34994),Qe=t(52688),Pt=t(55241),Zt=t(50136),ut=t(43586),Wt=function(){var i,u=(0,V.useIntl)(),v=(0,o.useState)(!0),x=C()(v,2),l=x[0],D=x[1],s=(0,f.Z)(function(p){return p.setWorkflowEditInfo}),a=(0,f.Z)(function(p){return p.workFlowInfo}),g=(0,f.Z)(function(p){return p.setSelect}),S=(0,o.useState)("1"),M=C()(S,2),j=M[0],B=M[1],T=(0,o.useState)(!1),d=C()(T,2),m=d[0],$=d[1],fe=(0,ut.Z)(),K=(0,o.useRef)(null),c=function(){var P,N;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(st.A,{formRef:K,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{tooltip:(a==null||(P=a.app)===null||P===void 0?void 0:P.publish_status)!="1"?{title:u.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(a==null||(N=a.app)===null||N===void 0?void 0:N.publish_status)!="1",name:"enable_api",label:"API"})]})})})},L=[{key:"4",icon:(0,e.jsx)(lt.Z,{}),label:u.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:a!=null&&a.isProd?(0,e.jsx)(Ke.Z,{}):(0,e.jsx)(Pt.Z,{content:c,trigger:"click",forceRender:!0,placement:"rightTop",title:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Ke.Z,{})}),label:u.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:a==null?void 0:a.isProd},{key:"1",icon:(0,e.jsx)(ze.Z,{}),label:u.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Tt.Z,{}),label:u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:m?u.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):u.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!m},{key:"3",icon:(0,e.jsx)(Et.Z,{}),label:u.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,he.Z)(function(){if(a){var p,P,N,H,ye=a==null||(p=a.app)===null||p===void 0?void 0:p.is_public,be=a==null||(P=a.app)===null||P===void 0?void 0:P.enable_api,se={};se.is_public=!!ye,se.enable_api=(a==null||(N=a.app)===null||N===void 0?void 0:N.publish_status)=="1"?!!be:!1,console.log(se),$(se.enable_api),K==null||(H=K.current)===null||H===void 0||H.setFieldsValue(se)}},[a]);var E=function(P,N){console.log(P,N),b(N.enable_api),s(N),setTimeout(fe,300)},b=function(P){$(!!P)},W=function(P){var N;switch(P.key){case"4":V.history.go(-1);break;case"0":break;case"2":window.open(Ue._n+(a==null||(N=a.app)===null||N===void 0?void 0:N.api_url),"_blank");break;default:g(""),B(P.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(j==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Zt.Z,{defaultSelectedKeys:["1"],selectedKeys:[j],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:l,items:L,onClick:W}),j=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(st.A,{formRef:K,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(Qe.Z,{name:"is_public",label:u.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(Qe.Z,{disabled:!(a!=null&&(i=a.app)!==null&&i!==void 0&&i.api_url),name:"enable_api",label:"API"})]})})})]}),j=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(We.default,{})})})]})},At=Wt,dt=t(71471),Lt=(0,o.memo)(function(r){var i=r.name,u=r.description,v=r.publishStatus,x=(0,V.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(dt.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:i}),v&&(0,e.jsxs)(dt.Z.Text,{className:"whitespace-normal",children:["(",x.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(dt.Z.Text,{className:"whitespace-normal text-gray-500",children:u})]})}),Ot=t(19632),wt=t.n(Ot),Rt=t(9783),qe=t.n(Rt),Bt=t(22352),ct=t(2302),$t=t(26474),Ht=t(40110),Ft=t(86615),Ut=t(5966),Kt=t(62370),zt=t(96638),_t=t(74330),Vt=t(11941),vt=t(69386),Gt=t(96486),Jt=t(87718),Yt=t(63783),et=t(83062),ft=t(99510),mt=(0,o.memo)(function(r){var i=r.children,u=r.onDragStart,v=r.onClick,x=r.type,l=r.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(s){return u(s,x,l)},onClick:v,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:i})}),Xt=(0,o.memo)(function(r){var i,u,v,x,l=r.item,D=r.onDragStart,s=r.typeBadge,a=r.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(l==null||(i=l.baseData)===null||i===void 0?void 0:i.description)||(l==null||(u=l.data)===null||u===void 0?void 0:u.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:D,type:l.type,item:l,onClick:function(){return a==null?void 0:a(l)},children:(0,e.jsx)(ft.Z,{title:l.data.title,icon:(l==null||(v=l.baseData)===null||v===void 0?void 0:v.avatar)||(l==null||(x=l.baseData)===null||x===void 0?void 0:x.icon)||l.type,typeBadge:s})})})})}),Qt=(0,o.memo)(function(r){var i,u=r.item,v=r.onDragStart,x=r.typeBadge,l=r.onItemClick;return(0,e.jsx)(et.Z,{placement:"right",title:(i=u.baseData)===null||i===void 0?void 0:i.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:v,type:u.type,item:u,onClick:function(){return l==null?void 0:l(u)},children:(0,e.jsx)(ft.Z,{title:u.baseData.name,icon:u.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:u.baseData.nickname}),typeBadge:x})})})})}),qt=(0,o.memo)(function(r){var i,u,v,x,l,D,s,a,g,S,M,j,B,T,d=r.tool,m=r.category,$=r.onDragStart,fe=r.typeBadge,K=r.onItemClick,c=r.categoryIndex,L=r.toolIndex,E=(0,V.getLocale)()==="en-US"?"en_US":"zh_Hans",b=(0,ct.o6)()[z.vW.Tool],W=h()(h()({},d),{},{authorization_status:m==null?void 0:m.authorization_status,title:d==null||(i=d.identity)===null||i===void 0?void 0:i.label[E],icon:m==null||(u=m.identity)===null||u===void 0?void 0:u.icon,groupName:m==null||(v=m.identity)===null||v===void 0?void 0:v.name,credentials_for_provider:m==null?void 0:m.credentials_for_provider}),p={title:d==null||(x=d.identity)===null||x===void 0?void 0:x.label[E],desc:(d==null||(l=d.description)===null||l===void 0||(l=l.human)===null||l===void 0?void 0:l[E])||(d==null||(D=d.description)===null||D===void 0?void 0:D.llm),icon:m==null||(s=m.identity)===null||s===void 0?void 0:s.icon,data:{title:d==null||(a=d.identity)===null||a===void 0?void 0:a.label[E],desc:(d==null||(g=d.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[E])||(d==null||(S=d.description)===null||S===void 0?void 0:S.llm),icon:m==null||(M=m.identity)===null||M===void 0?void 0:M.icon},baseData:W};return(0,e.jsx)(et.Z,{placement:"right",title:d==null||(j=d.description)===null||j===void 0||(j=j.human)===null||j===void 0?void 0:j[E],children:(0,e.jsx)("div",{children:(0,e.jsx)(mt,{onDragStart:$,type:z.vW.Tool,item:p,onClick:function(){return K==null?void 0:K(m,d,c,L)},children:(0,e.jsx)(ft.Z,{title:d==null||(B=d.identity)===null||B===void 0?void 0:B.label[E],icon:m==null||(T=m.identity)===null||T===void 0?void 0:T.icon,typeBadge:fe})})})})}),ea=(0,o.memo)(function(r){var i,u,v=r.category,x=r.onDragStart,l=r.typeBadge,D=r.onItemClick,s=r.categoryIndex,a=(0,V.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[v==null||(i=v.identity)===null||i===void 0?void 0:i.label[a],(0,e.jsx)(et.Z,{placement:"right",title:v==null||(u=v.identity)===null||u===void 0?void 0:u.description[a],children:(0,e.jsx)(Yt.Z,{className:"cursor-pointer ml-1"})})]}),v.tools.map(function(g,S){return(0,e.jsx)(qt,{tool:g,category:v,onDragStart:x,typeBadge:l,onItemClick:function(j,B,T,d){return D==null?void 0:D(j,B,T,d)},categoryIndex:s,toolIndex:S},S)})]})}),ta=function(i){var u=i.list,v=i.onDragStart,x=i.type,l=x===void 0?"normal":x,D=i.typeBadge,s=D===void 0?null:D,a=i.onItemClick;return u!=null&&u.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:l==="tools"?u.map(function(g,S){return(0,e.jsx)(ea,{category:g,typeBadge:s,onDragStart:v,onItemClick:a,categoryIndex:S},S)}):l==="workflow"?u.map(function(g,S){return(0,e.jsx)(Qt,{item:g,onDragStart:v,typeBadge:s,onItemClick:a},S)}):u.map(function(g,S){return(0,e.jsx)(Xt,{item:g,onDragStart:v,typeBadge:s,onItemClick:a},S)})}):null},aa=(0,o.memo)(ta),na=(0,o.memo)(function(r){var i=r.visibleTabs,u=r.defaultActiveTab,v=r.showTeamSwitch,x=v===void 0?!0:v,l=r.isMinWidth,D=l===void 0?!1:l,s=r.isCollapsed,a=s===void 0?!1:s,g=r.onItemClick,S=(0,V.useIntl)(),M=(0,V.getLocale)()=="en-US"?"en_US":"zh_Hans",j=(0,ct.o6)(),B=(0,o.useMemo)(function(){return Object.values(j).filter(function(w){return![z.vW.Start,z.vW.Agent,z.vW.Tool,z.vW.Skill].includes(w.base.type)}).map(function(w){return w.base})},[j]),T=(0,o.useState)(u||"1"),d=C()(T,2),m=d[0],$=d[1],fe=(0,o.useState)(B),K=C()(fe,2),c=K[0],L=K[1],E=(0,o.useState)([]),b=C()(E,2),W=b[0],p=b[1],P=(0,$t.v)(),N=P.tags,H=(0,zt.Z)(qe()(qe()(qe()({},z.vW.Agent,[]),z.vW.Skill,[]),"workflow",[])),ye=C()(H,2),be=ye[0],se=ye[1],Se=(0,o.useState)({team:1,keyword:"",tag:[]}),Ce=C()(Se,2),y=Ce[0],me=Ce[1],_e=(0,o.useRef)({}),gt=6e4,Ie=(0,f.Z)(function(w){return w.toolData});(0,o.useEffect)(function(){p((Ie==null?void 0:Ie.list)||[])},[Ie]);var Ae=(0,o.useCallback)(function(w,R,Z){w.dataTransfer.setData("application/reactflow",JSON.stringify({type:R,item:Z})),w.dataTransfer.effectAllowed="move"},[]),at=(0,o.useCallback)(function(w,R){if(!R)return w;var Z=new vt.Z(w,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),oe=Z.search(R);return oe.map(function(n){return n.item})},[]),nt=(0,o.useCallback)(function(w,R){if(!R)return w;var Z=w.map(function(I){var k;return h()(h()({},I),{},{tools:(k=I.tools)===null||k===void 0?void 0:k.map(function(Q){var _,re;return h()(h()({},Q),{},{categoryName:(_=I.identity)===null||_===void 0||(_=_.label)===null||_===void 0?void 0:_[M],categoryIcon:(re=I.identity)===null||re===void 0?void 0:re.icon})})})}),oe=new vt.Z(Z,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),n=oe.search(R);return n.map(function(I){return h()(h()({},I.item),{},{tools:I.item.tools.filter(function(k){var Q=new vt.Z([k],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return Q.search(R).length>0})})}).filter(function(I){return I.tools.length>0})},[M]),Le=(0,o.useCallback)(function(){var w=ee()(F()().mark(function R(Z){var oe,n,I,k,Q,_;return F()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(oe="".concat(Z,"-").concat(y.team,"-").concat(y.keyword,"-").concat(y.tag.join(",")),n=_e.current[oe],!(n&&Date.now()-n.timestamp<gt&&JSON.stringify(n.params)===JSON.stringify(y))){O.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(Z)),O.abrupt("return",n.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(Z)),O.prev=6,O.next=9,(0,Y.RE)(Z,{search_type:y.team,apps_name:y.keyword,tag_ids:((I=y.tag)===null||I===void 0?void 0:I.join(","))||""});case 9:if(k=O.sent,!((k==null?void 0:k.code)===0&&k!==null&&k!==void 0&&k.data&&Array.isArray(k.data.list)&&k.data.list.length>0)){O.next=16;break}return Q=k.data.list,_=Q.filter(function(ge){return ge.publish_status==1}).map(function(ge){var Te,Re;return h()(h()({},(Te=j[Z])===null||Te===void 0?void 0:Te.base),{},{data:h()(h()({},(Re=j[Z])===null||Re===void 0?void 0:Re.base.data),{},{title:ge.name,desc:ge.description}),baseData:ge})}),_e.current[oe]={data:_,timestamp:Date.now(),params:h()({},y)},se(qe()({},Z,_)),O.abrupt("return",_);case 16:return O.abrupt("return",[]);case 19:return O.prev=19,O.t0=O.catch(6),console.error("Failed to fetch ".concat(Z," data:"),O.t0),O.abrupt("return",[]);case 23:case"end":return O.stop()}},R,null,[[6,19]])}));return function(R){return w.apply(this,arguments)}}(),[y,j,se]),Ne=(0,o.useMemo)(function(){var w=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return y.keyword?at(c,y.keyword):c}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Le(z.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return y.keyword?nt(W,y.keyword):W}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var Z=ee()(F()().mark(function n(){return F()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,Le(z.vW.Skill);case 2:return k.abrupt("return",k.sent);case 3:case"end":return k.stop()}},n)}));function oe(){return Z.apply(this,arguments)}return oe}()}],R=i!=null&&i.length?w.filter(function(Z){return i.includes(Z.tabKey)}):w;return R.map(function(Z,oe){return h()(h()({},Z),{},{key:oe+1+""})})},[c,be,W,i,y,at,nt,Le]),Ve=(0,o.useMemo)(function(){return Ne.map(function(w){return{key:w.key,label:S.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}})},[Ne,S]),ot=(0,o.useCallback)(function(w){var R=w.tabIndex,Z=w.showName,oe=Z===void 0?!0:Z,n=Ne.find(function(A){return A.key===R}),I=(0,o.useState)([]),k=C()(I,2),Q=k[0],_=k[1],re=(0,o.useState)(!0),O=C()(re,2),ge=O[0],Te=O[1],Re=(0,o.useState)([]),ie=C()(Re,2),ke=ie[0],St=ie[1],wa=(0,o.useState)(20),xa=C()(wa,1),pt=xa[0],Da=(0,o.useState)(500),Ct=C()(Da,2),kt=Ct[0],jt=Ct[1],Ee=(0,o.useRef)(null),yt=(0,o.useRef)(!1),Sa=54;(0,o.useEffect)(function(){var A=function(){if(Ee.current){var q=Ee.current.clientHeight;jt(q)}},G=function(q){jt(q.detail.height)};return A(),Ee.current&&Ee.current.addEventListener("containerResize",G),window.addEventListener("resize",A),function(){Ee.current&&Ee.current.removeEventListener("containerResize",G),window.removeEventListener("resize",A)}},[]),(0,o.useEffect)(function(){return function(){yt.current=!1}},[n==null?void 0:n.tabKey]),(0,o.useEffect)(function(){var A=function(){var G=ee()(F()().mark(function ue(){var q,Pe;return F()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(!(yt.current&&!y.keyword&&y.tag.length===0)){J.next=2;break}return J.abrupt("return");case 2:if(Te(!0),J.prev=3,n){J.next=6;break}return J.abrupt("return");case 6:return J.next=8,n.getData();case 8:q=J.sent,Pe=(q==null?void 0:q.map(function(ka,ja){return h()(h()({},ka),{},{id:"".concat(n.tabKey,"-").concat(ja)})}))||[],_(Pe),St(Pe.slice(0,pt)),yt.current=!0,J.next=18;break;case 15:J.prev=15,J.t0=J.catch(3),console.error("Failed to fetch data:",J.t0);case 18:return J.prev=18,Te(!1),J.finish(18);case 21:case"end":return J.stop()}},ue,null,[[3,15,18,21]])}));return function(){return G.apply(this,arguments)}}();A()},[n,y,pt]);var Ca=function(G){if(G.currentTarget.scrollHeight-G.currentTarget.scrollTop===kt){var ue=ke.length;if(ue<Q.length){var q=Q.slice(ue,ue+pt);St(function(Pe){return[].concat(wt()(Pe),wt()(q))})}}},Mt=(0,o.useCallback)(function(A){var G,ue,q;if(n){switch(console.log("Clicked item:",A),n.tabKey){case"tool":console.log("Tool ".concat((G=A.identity)===null||G===void 0||(G=G.label)===null||G===void 0?void 0:G[M]));break;case"workflow":console.log("Workflow ".concat((ue=A.data)===null||ue===void 0?void 0:ue.title));break;case"agent":console.log("Agent ".concat((q=A.data)===null||q===void 0?void 0:q.title));break;default:console.log("Clicked ".concat(n.tabKey," item:"),A)}g&&g(A,n.tabKey)}},[n,M,g]),It=(0,o.memo)(function(A){var G=A.data,ue=A.index,q=A.onDragStart,Pe=A.onItemClick,Nt=A.type,J=A.typeBadge;return(0,e.jsx)(aa,{typeBadge:J,list:[G],onDragStart:q,type:Nt,onItemClick:Pe})});return n?(0,e.jsx)("div",{ref:Ee,className:"overflow-y-auto h-full",children:(0,e.jsx)(_t.Z,{spinning:ge,children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:ke.map(function(A){return(0,e.jsx)(It,{data:A,index:ke.indexOf(A),onDragStart:Ae,onItemClick:Mt,type:n.type,typeBadge:y!=null&&y.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0},A.id)})}):(0,e.jsx)(Jt.Z,{data:ke,height:kt,itemHeight:Sa,itemKey:"id",onScroll:Ca,children:function(G){return(0,e.jsx)(It,{data:G,index:ke.indexOf(G),onDragStart:Ae,onItemClick:Mt,type:n.type,typeBadge:y!=null&&y.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[m,y,D,Ne,Ae,M,g]),Ge=(0,o.useCallback)((0,Gt.debounce)(function(w){me(w)},500),[]),Oe=(0,o.useCallback)(function(){_e.current={}},[]);(0,o.useEffect)(function(){Oe()},[y.team,Oe]);var ht=(0,o.useCallback)(function(w,R){"team"in w?me(R):("tag"in w||"keyword"in w)&&Ge(R)},[Ge]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!a&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(st.A,{submitter:!1,initialValues:y,onValuesChange:ht,children:[x&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[S.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Ft.Z.Group,{name:"team",fieldProps:{options:[{label:S.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:S.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(Ut.Z,{fieldProps:{prefix:(0,e.jsx)(Ht.Z,{}),placeholder:S.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Kt.Z,{name:"tag",children:(0,e.jsx)(Bt.O,{className:"w-full",options:N,listStyle:D?"horizontal":"vertical",allowClear:!0,placeholder:S.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(R){}})})})]}),y!=null&&y.keyword?null:(0,e.jsx)(Vt.Z,{activeKey:m,items:Ve,onChange:function(R){$(R)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:y!=null&&y.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ne.map(function(w,R){return(0,e.jsxs)("div",{className:"space-y-2",children:[!a&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:S.formatMessage({id:w.label,defaultMessage:w.defaultMessage})}),(0,e.jsx)(ot,{tabIndex:R+1+"",showName:!D},w.key)]},w.key)})}):(0,e.jsx)(ot,{tabIndex:m,showName:!D})})]})}),oa=(0,o.memo)(function(r){var i=r.visibleTabs,u=r.defaultActiveTab,v=r.showTeamSwitch,x=v===void 0?!0:v,l=r.workflowName,D=r.workflowDesc,s=r.publishStatus,a=r.onWidthChange,g=r.onItemClick,S=(0,o.useState)(!1),M=C()(S,2),j=M[0],B=M[1],T=(0,o.useState)(!1),d=C()(T,2),m=d[0],$=d[1];return(0,e.jsx)(it.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:m?100:315,onChange:function(K,c){requestAnimationFrame(function(){B(K<100),a==null||a(K);var L=document.querySelectorAll(".overflow-y-auto");L.forEach(function(E){if(E instanceof HTMLElement){var b=E.clientHeight,W=new CustomEvent("containerResize",{detail:{height:b,width:K}});E.dispatchEvent(W)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(na,{visibleTabs:i,defaultActiveTab:u,showTeamSwitch:x,isMinWidth:j,isCollapsed:m,onItemClick:g}),(0,e.jsx)(At,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Lt,{name:l,description:D,publishStatus:s})})]})})}),ra=t(74842),ia=t(98165),la=t(58638),tt=t(28036),sa=t(27484),ua=t.n(sa),xt=t(70681),da=200,ca=80,va={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},fa=function(){var i=(0,ae._K)(),u=i.getNodes,v=i.getEdges,x=i.setNodes,l=function(a){return{width:a.width||da,height:a.height||ca}},D=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",g=u(),S=v();if(g.length){var M=new xt.graphlib.Graph;M.setDefaultEdgeLabel(function(){return{}});var j=h()(h()({},va),{},{rankdir:a});M.setGraph(j),g.forEach(function(T){var d=l(T),m=d.width,$=d.height;M.setNode(T.id,{width:m,height:$})}),S.forEach(function(T){M.setEdge(T.source,T.target)}),xt.layout(M);var B=g.map(function(T){var d=M.node(T.id);return h()(h()({},T),{},{position:{x:d.x-d.width/2,y:d.y-d.height/2}})});x(B)}};return{autoLayout:D}},ma=fa,ga=(0,o.memo)(function(){var r=(0,V.useIntl)(),i=(0,V.useSearchParams)(),u=C()(i,1),v=u[0],x=(0,f.Z)(function(b){return b.setWorkFlowInfo}),l=(0,f.Z)(function(b){return b.workFlowInfo}),D=(0,f.Z)(function(b){return b.setRunPanelShow}),s=v.get("type")=="true",a=(0,ut.Z)(),g=ma(),S=g.autoLayout,M=U.ZP.useMessage(),j=C()(M,2),B=j[0],T=j[1],d=(0,f.Z)(function(b){return b.loadingWorkflowData}),m=function(){var b=ee()(F()().mark(function W(){var p;return F()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,a();case 2:p=v.get("app_id"),(0,Y.aJ)(p).then(function(H){console.log(H),H.code==0&&(x(h()(h()({},l),{},{app:h()(h()({},l==null?void 0:l.app),{},{publish_status:"1"})})),B.open({type:"success",content:r.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return N.stop()}},W)}));return function(){return b.apply(this,arguments)}}(),$=function(){D(!0)},fe=function(){var b=ee()(F()().mark(function W(){var p,P;return F()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return p=v.get("app_id"),H.next=3,(0,Y.Uq)(p);case 3:P=H.sent;case 4:case"end":return H.stop()}},W)}));return function(){return b.apply(this,arguments)}}(),K=function(){var b=ee()(F()().mark(function W(){var p,P,N,H;return F()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:P=v.get("app_id"),N=(l==null||(p=l.app)===null||p===void 0?void 0:p.name)||"workflow",H=ua()().format("YYYY_MM_DD-HH_mm_ss"),(0,Y.w8)(P,s==!0?1:0).then(function(se){var Se=se,Ce=new Blob([Se],{type:"text/yaml"}),y=URL.createObjectURL(Ce),me=document.createElement("a");me.href=y,me.download="".concat(N,"_").concat(H,".yml"),document.body.appendChild(me),me.click(),document.body.removeChild(me),URL.revokeObjectURL(y)});case 4:case"end":return be.stop()}},W)}));return function(){return b.apply(this,arguments)}}(),c=function(W){S(W),B.open({type:"success",content:r.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},L=[{key:"TB",label:r.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return c("TB")}},{key:"LR",label:r.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return c("LR")}}],E={name:"file",fileList:null,action:Ue._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!s&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(tt.ZP,{type:"primary",disabled:d,onClick:m,children:r.formatMessage({id:"workflow.release"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(ra.Z,{}),disabled:d,onClick:$,children:r.formatMessage({id:"workflow.run"})}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(ia.Z,{}),type:"dashed",disabled:d,onClick:a,children:r.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(tt.ZP,{icon:(0,e.jsx)(la.Z,{}),type:"dashed",onClick:K,disabled:d,children:r.formatMessage({id:"workflow.export",defaultMessage:""})}),T]})}),Dt=t(64458),ha=function(){var i,u,v=(0,V.useIntl)(),x=(0,o.useRef)(null),l=(0,f.Z)(function(n){return n.resetNodes}),D=(0,f.Z)(function(n){return n.setNodeTypes}),s=(0,f.Z)(function(n){return n.addNode}),a=(0,f.Z)(function(n){return n.createNode}),g=(0,f.Z)(function(n){return n.setNodes}),S=(0,f.Z)(function(n){return n.setEdges}),M=(0,f.Z)(function(n){return n.setAppId}),j=(0,f.Z)(function(n){return n.setRunPanelShow}),B=(0,f.Z)(function(n){return n.runPanelShow}),T=(0,f.Z)(function(n){return n.getModelData}),d=(0,f.Z)(function(n){return n.setWorkFlowInfo}),m=(0,f.Z)(function(n){return n.setHandleList}),$=(0,f.Z)(function(n){return n.workFlowInfo}),fe=(0,f.Z)(function(n){return n.setWorkflowEditInfo}),K=U.ZP.useMessage(),c=C()(K,2),L=c[0],E=c[1],b=(0,ae._K)(),W=b.screenToFlowPosition,p=b.getNodes,P=b.setViewport,N=pe(W),H=N.onDnD,ye=(0,V.useSearchParams)(),be=C()(ye,1),se=be[0],Se=se.get("type")=="true",Ce=(0,f.Z)(function(n){return n.setLoadingWorkflowData}),y=(0,ae.B)({includeHiddenNodes:!1}),me=(0,xe.Z)(),_e=(0,ut.Z)(),gt=(0,o.useState)(null),Ie=C()(gt,2),Ae=Ie[0],at=Ie[1],nt=(0,o.useState)(!1),Le=C()(nt,2),Ne=Le[0],Ve=Le[1],ot=(0,o.useState)(""),Ge=C()(ot,2),Oe=Ge[0],ht=Ge[1],w=null;(0,ae.CV)({onEnd:function(I){}}),(0,Ze.Z)(function(){D((0,ct.$P)()),l(),(0,He.b6)(),R(),m([])}),ve(),(0,o.useEffect)(function(){if(Ae){V.history.push(Oe);return}var n=V.history.block(function(I,k){if(B){ht(I.location.pathname),Ve(!0);return}});return B||n==null||n(),function(){n==null||n()}},[B,Ae]),(0,he.Z)(function(){if(y){var n=p(),I=n[n.length-1];I.data.drag&&(I.position={x:I.position.x-I.measured.width/2,y:I.position.y-I.measured.height/2},g(n))}},[y]),(0,o.useEffect)(function(){var n=H(function(I,k,Q){var _;console.log(I,k,Q);var re=h()(h()({drag:!0},Q.data),{},{baseData:Q.baseData});if((_=Q.baseData)!==null&&_!==void 0&&_.output){var O;re.outputInfo=(O=Q.baseData)===null||O===void 0?void 0:O.output}a(k,{position:I,data:re})});return n},[H,s]),(0,he.Z)(function(){me=="hidden"&&_e()},[me]);var R=function(){var n=ee()(F()().mark(function I(){var k;return F()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:k=se.get("app_id"),Se&&L.open({type:"warning",content:v.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),Ce(!0),M(k),(0,Y.kE)(k,Se?1:0).then(function(re){if(re.code==0){if(d(h()(h()({},re.data),{},{isProd:Se})),!re.data.workflow.graph){Ce(!1),a(z.vW.Start);return}var O=re.data,ge=O.workflow.graph,Te=ge.edges,Re=ge.nodes,ie=ge.views,ke=O.app;fe({enable_api:!!ke.enable_api,is_public:!!ke.is_public}),ie!=null&&ie.nodes&&g(ie.nodes),ie!=null&&ie.edges&&S(ie.edges),ie!=null&&ie.viewPort,setTimeout(function(){Ce(!1)},1e3)}}),T();case 6:case"end":return _.stop()}},I)}));return function(){return n.apply(this,arguments)}}(),Z=function(){at(!0),console.log(Oe),V.history.push(Oe),Ve(!1)},oe=function(){Ve(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[E,(0,e.jsx)(de.Z,{title:v.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ne,onOk:Z,onCancel:oe,children:v.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:x,children:(0,e.jsxs)(Me,{children:[(0,e.jsx)(ae.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(ae.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(oa,{workflowName:$==null||(i=$.app)===null||i===void 0?void 0:i.name,workflowDesc:$==null||(u=$.app)===null||u===void 0?void 0:u.description,publishStatus:Se}),(0,e.jsx)(ga,{}),(0,e.jsx)(Dt.s_,{}),(0,e.jsx)(Dt.Jf,{}),(0,e.jsx)(Xe,{})]})},pa=(0,o.memo)(function(){return(0,e.jsx)(ae.tV,{children:(0,e.jsx)(ha,{})})}),ya=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(pa,{})})},ba=ya}}]);
