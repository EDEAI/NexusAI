"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,Te,t){var Qe=t(5574),V=t.n(Qe),qe=t(42881),le=t(67294),fe=t(85893),k=function(y){var et=y.children,Y=y.className,ae=Y===void 0?"":Y,me=y.dragDirection,De=me===void 0?"left":me,We=y.minWidth,Be=We===void 0?415:We,Ce=y.maxWidth,G=Ce===void 0?820:Ce,xe=y.minHeight,l=xe===void 0?200:xe,ve=y.maxHeight,Ee=ve===void 0?800:ve,oe=y.defaultWidth,Le=oe===void 0?415:oe,v=y.defaultHeight,L=v===void 0?300:v,e=y.onChange,se=(0,le.useState)(Le),Re=V()(se,2),tt=Re[0],Ze=Re[1],lt=(0,le.useState)(L),je=V()(lt,2),ft=je[0],it=je[1],at=(0,le.useCallback)(function(st,Ne){Ze(st),Ne&&it(Ne),e==null||e(st,Ne)},[Ze,it,e]),Oe=(0,qe.W)({direction:["left","right"].includes(De)?"horizontal":"vertical",triggerDirection:De,minWidth:Be,maxWidth:G,minHeight:l,maxHeight:Ee,onResize:at}),Ue=Oe.triggerRef,mt=Oe.containerRef;return(0,fe.jsxs)("div",{ref:mt,style:{width:["left","right"].includes(De)?"".concat(tt,"px"):void 0,height:["top","bottom"].includes(De)?"".concat(ft,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(ae),children:[De==="left"&&(0,fe.jsx)("div",{ref:Ue,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,fe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),De==="right"&&(0,fe.jsx)("div",{ref:Ue,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,fe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),De==="top"&&(0,fe.jsx)("div",{ref:Ue,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,fe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),De==="bottom"&&(0,fe.jsx)("div",{ref:Ue,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,fe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),et]})};Te.Z=(0,le.memo)(k)},36711:function(bt,Te,t){t.r(Te),t.d(Te,{waitTime:function(){return Ce},waitTimePromise:function(){return Be}});var Qe=t(97857),V=t.n(Qe),qe=t(5574),le=t.n(qe),fe=t(15009),k=t.n(fe),rt=t(99289),y=t.n(rt),et=t(42237),Y=t(29608),ae=t(32592),me=t(35312),De=t(67294),We=t(85893),Be=function(){var G=y()(k()().mark(function xe(){var l,ve=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return l=ve.length>0&&ve[0]!==void 0?ve[0]:100,oe.abrupt("return",new Promise(function(Le){setTimeout(function(){Le(!0)},l)}));case 2:case"end":return oe.stop()}},xe)}));return function(){return G.apply(this,arguments)}}(),Ce=function(){var G=y()(k()().mark(function xe(){var l,ve=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return l=ve.length>0&&ve[0]!==void 0?ve[0]:100,oe.next=3,Be(l);case 3:case"end":return oe.stop()}},xe)}));return function(){return G.apply(this,arguments)}}();Te.default=function(){var G=(0,me.useIntl)(),xe=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:G.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var se;v==null||(se=v.current)===null||se===void 0||se.submit()}}},{title:G.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:G.formatMessage({id:"workflow.created_time_des",defaultMessage:G.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:G.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var se;v==null||(se=v.current)===null||se===void 0||se.submit()}},valueEnum:{1:{text:G.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:G.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:G.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(G.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:G.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:G.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],l=(0,me.useSearchParams)(),ve=le()(l,1),Ee=ve[0],oe=(0,Y.Z)(function(L){return L.setRunPanelLogRecord}),Le=Ee.get("app_id"),v=(0,De.useRef)(null);return(0,We.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,We.jsx)("div",{children:(0,We.jsx)(ae.Z,{columns:xe,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var L=y()(k()().mark(function e(se,Re,tt){var Ze;return k()().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return console.log(se,Re,tt),je.next=3,(0,et.bB)(V()(V()({app_runs_name:"",app_runs_status:0},se),{},{app_id:Le}));case 3:return Ze=je.sent,console.log(Ze),je.abrupt("return",{data:Ze.data.list,success:!0,total:Ze.data.total_count});case 6:case"end":return je.stop()}},e)}));return function(e,se,Re){return L.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),oe(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:G.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},53971:function(bt,Te,t){t.r(Te),t.d(Te,{default:function(){return Wa}});var Qe=t(15009),V=t.n(Qe),qe=t(99289),le=t.n(qe),fe=t(97857),k=t.n(fe),rt=t(5574),y=t.n(rt),et=t(32060),Y=t(42237),ae=t(35312),me=t(63648),De=t(16091),We=t(13118),Be=t(78234),Ce=t(77598),G=t(45360),xe=t(85576),l=t(67294),ve=t(64599),Ee=t.n(ve),oe=t(7493),Le=t(34559),v=t(15425),L=t(96906),e=t(85893),se=function(s){return{nodes:s.nodes,edges:s.edges,onNodesChange:s.onNodesChange,onEdgesChange:s.onEdgesChange,onConnect:s.onConnect,nodeTypes:s.nodeTypes,connectionLineStyle:s.connectionLineStyle,defaultViewport:s.defaultViewport,onDrop:s.onDrop,onDragOver:s.onDragOver,setSelect:s.setSelect,preventScrolling:s.preventScrolling}},Re=(0,l.memo)(function(d){var s=d.children,o=(0,ae.useIntl)(),f=(0,v.Z)(function(u){return u.nodes}),x=(0,v.Z)(function(u){return u.getEdges}),g=(0,v.Z)(function(u){return u.edges}),Z=(0,v.Z)(function(u){return u.setEdges}),r=(0,v.Z)(function(u){return u.onNodesChange}),i=(0,v.Z)(function(u){return u.onEdgesChange}),b=(0,v.Z)(function(u){return u.onConnect}),O=(0,v.Z)(function(u){return u.nodeTypes}),U=(0,v.Z)(function(u){return u.connectionLineStyle}),H=(0,v.Z)(function(u){return u.defaultViewport}),K=(0,v.Z)(function(u){return u.onDrop}),n=(0,v.Z)(function(u){return u.onDragOver}),h=(0,v.Z)(function(u){return u.setSelect}),D=(0,v.Z)(function(u){return u.preventScrolling}),X=(0,l.useCallback)(function(u){var N=f.find(function(A){return A.id===u.target}),E=function A(F){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(W.has(F.id))return!1;W.add(F.id);var R=Ee()((0,oe.xA)(F,f,g)),_;try{for(R.s();!(_=R.n()).done;){var re=_.value;if(re.id===u.source||A(re,W))return!0}}catch(we){R.e(we)}finally{R.f()}};return N.id===u.source?!1:!E(N)},[f,g]),Q=function(){},T=(0,l.useCallback)(function(u,N){console.log(u,N,x(),(0,oe.Kz)(u,N,g)),Z((0,oe.Kz)(u,N,x()))},[]);return(0,Ce.Z)(function(){},[f]),(0,e.jsx)(Le.tV,{children:(0,e.jsx)(me.x$,{onViewportChange:Q,nodes:f,edges:g,onNodesChange:r,onEdgesChange:i,onEdgesDelete:function(N){},onConnect:b,onReconnect:T,nodeTypes:O,minZoom:.3,maxZoom:1,connectionLineStyle:U,snapToGrid:!1,isValidConnection:X,connectionRadius:30,preventScrolling:D,onDragOver:n,onPaneClick:function(){h("")},onPaneContextMenu:function(N){N.preventDefault()},onSelectionChange:function(N){},onNodeClick:function(N,E){h(E.id)},onEdgeClick:function(N,E){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(N){},onBeforeDelete:function(){var u=le()(V()().mark(function N(E){var A;return V()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if((E==null||(A=E.nodes)===null||A===void 0||(A=A[0])===null||A===void 0?void 0:A.type)!=L.vW.Start){W.next=3;break}return G.ZP.error(o.formatMessage({id:"workflow.delStartNodeError"})),W.abrupt("return",Promise.reject(o.formatMessage({id:"workflow.delStartNodeError"})));case 3:return h(""),W.abrupt("return",Promise.resolve(E));case 5:case"end":return W.stop()}},N)}));return function(N){return u.apply(this,arguments)}}(),fitView:!0,children:s})})}),tt=function(s){var o=(0,l.useCallback)(function(g){g.preventDefault(),g.dataTransfer.dropEffect="move"},[]),f=(0,l.useCallback)(function(g){g.preventDefault();var Z=g.dataTransfer.getData("application/reactflow");if(!Z)return null;var r=JSON.parse(Z),i=r.type,b=r.item;if(!i||!b)return null;var O=s({x:g.clientX,y:g.clientY});return{position:O,type:i,item:b}},[s]),x=(0,l.useCallback)(function(g){var Z=function(i){var b=f(i);b&&g(b.position,b.type,b.item)};return document.addEventListener("dragover",o),document.addEventListener("drop",Z),function(){document.removeEventListener("dragover",o),document.removeEventListener("drop",Z)}},[o,f]);return{onDnD:x}},Ze=tt,lt=function(){var s=(0,v.Z)(function(r){return r.setAgentData}),o=(0,v.Z)(function(r){return r.setSkillData}),f=(0,v.Z)(function(r){return r.setToolData}),x=(0,v.Z)(function(r){return r.setDatasetData}),g=(0,v.Z)(function(r){return r.setTeamDatasetData}),Z=(0,v.Z)(function(r){return r.setModelOptionsData});(0,l.useEffect)(function(){(0,Y.x$)(2).then(function(r){r.code===0&&s({team:r.data})}),(0,Y.x$)(3).then(function(r){r.code===0&&s({user:r.data})}),(0,Y.w)(2).then(function(r){r.code===0&&o({team:r.data})}),(0,Y.w)(3).then(function(r){r.code===0&&o({user:r.data})}),(0,Y.GZ)().then(function(r){r.code===0&&f({list:Object.values(r.data)})}),(0,Y.fZ)().then(function(r){var i,b=Array.isArray(r==null||(i=r.data)===null||i===void 0?void 0:i.data)?r.data.data:[],O=b.map(function(D){return{label:D.supplier_name,options:Array.isArray(D.model_list)?D.model_list.map(function(X){return{label:X.model_name,value:X.model_config_id}}):[]}}),U,H=Ee()(b),K;try{for(H.s();!(K=H.n()).done;){var n=K.value;if(Array.isArray(n.model_list)){var h=n.model_list.find(function(D){return D.model_default_used===1});if(h){U=h.model_config_id;break}}}}catch(D){H.e(D)}finally{H.f()}Z({options:O,defaultValue:U})}),(0,Y.mG)().then(function(r){r.code==0&&x({list:r.data.data.map(function(i){return k()(k()({},i),{},{label:i.name,value:i.dataset_id})})})}),(0,Y.mG)(2).then(function(r){r.code==0&&g({list:r.data.data.map(function(i){return k()(k()({},i),{},{label:i.name,value:i.dataset_id})})})})},[s,o,f])},je=lt,ft=t(83065),it=t(39944),at=t(10759),Oe=t(55927),Ue=t(33914),mt=t(88284),st=t(28508),Ne=t(34994),St=t(90672),$t=t(46822),Ht=t(97462),Ft=t(64317),_t=t(29933),zt=t(3917),ke=t(71471),Ut=t(40056),Dt=t(2487),$e=t(28036),jt=t(96486),Mt=t.n(jt),Ke=t(29432),ut=t(92485),$a=ke.Z.Text,Ha=Ut.Z.ErrorBoundary,Kt=(0,l.memo)(function(){var d,s,o=(0,ae.useIntl)(),f=(0,l.useState)(!1),x=y()(f,2),g=x[0],Z=x[1],r=(0,Oe.Z)(function(p){return p.dealtWithData}),i=(0,Oe.Z)(function(p){return p.setDealtWithData}),b=(0,Oe.Z)(function(p){return p.setFlowMessage}),O=(0,Oe.Z)(function(p){return p.getNeedHumanConfirmMessage}),U=(0,Oe.Z)(function(p){return p.flowMessage}),H=(0,l.useState)(null),K=y()(H,2),n=K[0],h=K[1],D=(0,l.useState)(""),X=y()(D,2),Q=X[0],T=X[1],u=(0,l.useState)(!1),N=y()(u,2),E=N[0],A=N[1],F=(0,l.useState)(""),W=y()(F,2),R=W[0],_=W[1],re=(0,zt.Z)(Y.N7,{manual:!0}),we=re.loading,ge=re.runAsync;(0,l.useEffect)(function(){var p;Z(!!r);var w=r==null||(p=r.data)===null||p===void 0||(p=p.node_exec_data)===null||p===void 0?void 0:p.node_exec_id;return console.log(r,w),T(w),w&&pe(w),function(){Z(!1)}},[r]);var pe=function(w){we||ge(w).then(function(j){j.data&&(h(j.data),w!=R&&(A(!1),_(w)))})};(0,Ce.Z)(function(){console.log(U,Q);var p=U.find(function(w){var j;return(w==null||(j=w.data)===null||j===void 0||(j=j.node_exec_data)===null||j===void 0?void 0:j.node_exec_id)==Q});console.log(p),p&&pe(Q)},[U.length]);var Pe=function(w){A(!0),(0,Y.YX)(Q,{correct_prompt:new it.N("",w.prompt,""),operation:1,outputs:(n==null?void 0:n.outputs)||null}).then(function(j){j.code==0&&(P(Q),T(j.data.exec_id))})},P=function(w){var j=U.filter(function($){var z;return!(($==null||(z=$.data)===null||z===void 0||(z=z.node_exec_data)===null||z===void 0?void 0:z.node_exec_id)==w&&($==null?void 0:$.type)=="workflow_need_human_confirm")});b(j)},He=function(){(0,Y.YX)(Q,{operation:0,outputs:(n==null?void 0:n.outputs)||null}).then(function(w){w.code==0&&(Z(!1),P(Q),i(null))})},Ve=(0,l.useCallback)(function(){var p,w,j=r==null||(p=r.data)===null||p===void 0||(p=p.node_exec_data)===null||p===void 0?void 0:p.node_type;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[j!=L.vW.LLM&&(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"input"})}),(n==null||(w=n.correct_llm_history)===null||w===void 0?void 0:w.length)>0&&(0,e.jsx)(Dt.Z,{header:(0,e.jsx)(ke.Z.Title,{level:5,children:o.formatMessage({id:"workflow.historyPrompt",defaultMessage:"prompt"})}),dataSource:n==null?void 0:n.correct_llm_history,renderItem:function(z){var q;return(0,e.jsx)(Dt.Z.Item,{children:z==null||(q=z.correct_prompt)===null||q===void 0||(q=q.user)===null||q===void 0?void 0:q.value})}}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:n==null?void 0:n.outputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"output"})})]}),(0,e.jsx)(Ne.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:o.formatMessage({id:"workflow.xz"})}},loading:E,onFinish:Pe,children:(0,e.jsx)("div",{className:"flex ",children:(0,e.jsxs)("div",{className:"flex-1 pt-2 border-stone-300 border rounded-md my-2",children:[(0,e.jsxs)("div",{className:"px-2 flex justify-between cursor-default",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"text-sm text-gray-500 font-bold pb-1",children:"Prompt"})}),(0,e.jsx)("div",{})]}),(0,e.jsx)("div",{className:" pb-6 user-input-error",children:(0,e.jsx)(St.Z,{formItemProps:{className:"mb-0"},name:"prompt",required:!0,rules:[{required:!0,message:o.formatMessage({id:"workflow.requireInputPrompt"})}],fieldProps:{variant:"borderless",placeholder:o.formatMessage({id:"workflow.requireInputPrompt"}),autoSize:{minRows:2,maxRows:40},count:{show:function(z){var q=z.value,be=z.count,ie=z.maxLength;return(0,e.jsx)("div",{className:"pr-2 text-blue-400",children:be})}}}})})]})})})]})},[n]),Ge=(0,l.useCallback)(function(){var p,w,j,$=n==null||(p=n.node_graph)===null||p===void 0||(p=p.data)===null||p===void 0?void 0:p.input,z=$==null?void 0:$.properties,q=n==null||(w=n.node_graph)===null||w===void 0||(w=w.data)===null||w===void 0?void 0:w.requires_upload,be=n==null||(j=n.node_graph)===null||j===void 0||(j=j.data)===null||j===void 0||(j=j.import_to_knowledge_base)===null||j===void 0?void 0:j.input;console.log("requires_upload",n,q);var ie=(0,v.Z)(function(a){return a.datasetData});if(!z)return(0,e.jsx)(e.Fragment,{children:o.formatMessage({id:"workflow.requireInputPrompt",defaultMessage:""})});var he=Object.values(z),ye=function(c){var m;console.log(c);var B=(0,at.vV)($);if(he.length>0){var M=Object.entries(c).filter(function(J){var I=y()(J,2),ne=I[0],ee=I[1];return ne.startsWith("variables.")});M.forEach(function(J){var I=y()(J,2),ne=I[0],ee=I[1];B.properties[ne.replace("variables.","")].value=ee})}var S=new at.V7(Ke.Mp,"array[number]");c.file&&c.file.forEach(function(J){var I,ne=new at._w(J.uid,"number",(J==null||(I=J.response)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.file_id)||0);S.addValue(ne)}),B.addProperty(Ke.Mp,S),console.log(B,S);var C=(n==null||(m=n.node_graph)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.knowledge_base_mapping)||{input:{},output:{}};Object.entries(c).forEach(function(J){var I=y()(J,2),ne=I[0],ee=I[1];ne.startsWith("dataset.")&&(C.input[Ke.Mp]||(C.input[Ke.Mp]={}),C.input[Ke.Mp][ne.replace("dataset.","")]=ee)}),console.log(C),(0,Y.YX)(Q,{operation:0,inputs:B,outputs:null,correct_prompt:null,knowledge_base_mapping:C}).then(function(J){J.code==0&&(Z(!1),i(null),P(Q))})},_e={icon:(0,e.jsx)(Ue.Z,{}),title:o.formatMessage({id:"workflow.uploadFileText",defaultMessage:"\uFF0C"}),description:o.formatMessage({id:"workflow.uploadFileDes"}),accept:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv",fieldProps:{listType:"picture",name:"file",multiple:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},action:ft.M$,beforeUpload:function(c){var m=c.size/1024/1024<15;return m||G.ZP.error(o.formatMessage({id:"workflow.uploadFileErrorText"})),m}}};return(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsxs)(Ne.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:o.formatMessage({id:"workflow.checked",defaultMessage:""})}},onFinish:ye,children:[he.map(function(a){return(0,e.jsx)(St.Z,{label:a.display_name,name:"variables.".concat(a.name),required:a.required,rules:[{required:a.required,message:o.formatMessage({id:"workflow.toInput"})}]},a.name)}),q&&(0,e.jsx)($t.Z,k()({name:"file"},_e)),(0,e.jsx)(Ht.Z,{name:["file"],children:function(c){var m=c.file;return be&&(m==null?void 0:m.length)>0&&(m==null?void 0:m.map(function(B){return(0,e.jsx)(Ft.Z,{label:B.name,name:"dataset.".concat(B.uid),options:(ie==null?void 0:ie.list)||[],required:!0,rules:[{required:!0,message:o.formatMessage({id:"workflow.select_to_knowledge_base"})}]},B.uid)}))||null}})]})})},[n]),Ie=function(w){if(w.type!=="object"||!w.properties)return[w];var j=[],$=function z(q){var be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";Mt().forOwn(q,function(ie,he){var ye=be?"".concat(be,".").concat(he):he;ie.type==="object"&&ie.properties?z(ie.properties,ye):j.push(k()(k()({},ie),{},{name:ye}))})};return $(w.properties),j},nt=function(w){return w.reduce(function(j,$){return j[$.name]=$.value,j},{})},Je=(0,l.useCallback)(function(){console.log(n);var p=n==null?void 0:n.inputs,w=(0,l.useRef)(null),j=(0,l.useState)([]),$=y()(j,2),z=$[0],q=$[1],be=(0,l.useState)({}),ie=y()(be,2),he=ie[0],ye=ie[1],_e=G.ZP.useMessage(),a=y()(_e,2),c=a[0],m=a[1];(0,Be.Z)(function(){n!=null&&n.outputs&&(console.log(p,Ie(n==null?void 0:n.outputs)),q(Ie(n==null?void 0:n.outputs)),ye(JSON.stringify(Ie(n==null?void 0:n.outputs))))});var B=function(){var S={};try{S=JSON.parse(he),console.log(S,S[0]),(0,Y.YX)(Q,{outputs:Mt().isArray(S)?S[0]:S}).then(function(C){C.code==0&&(c.success(o.formatMessage({id:"workflow.checkSc",defaultMessage:""})),Z(!1),P(Q),i(null))})}catch(C){console.log(C),c.error(o.formatMessage({id:"workflow.checkOutputMessageError",defaultMessage:","}))}};return(0,e.jsxs)("div",{children:[m,(0,e.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[!Ke.eT.includes(n==null?void 0:n.node_type)&&(0,e.jsxs)("div",{children:[(0,e.jsx)(ke.Z.Title,{level:5,children:"Inputs"}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(S){ye(S)}})})]}),(0,e.jsxs)(ke.Z.Title,{level:5,children:["Outputs(",o.formatMessage({id:"workflow.toEdit",defaultMessage:""}),")"]}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:n==null?void 0:n.outputs,isJSONStringifyBeauty:!0,onChange:function(S){ye(S)}})}),(0,e.jsx)($e.ZP,{type:"primary",onClick:B,className:"w-full mt-4",children:o.formatMessage({id:"workflow.checked",defaultMessage:""})})]})]})},[n]),Ye=(0,l.useCallback)(function(){var p=n==null?void 0:n.node_type;return p==L.vW.Human?(0,e.jsx)(Ge,{}):p==L.vW.LLM||p==L.vW.Agent||p==L.vW.TaskGeneration?(0,e.jsx)(Ve,{}):(0,e.jsx)(Je,{})},[n]),Fe=function(){var w=n==null?void 0:n.node_type;return w==L.vW.LLM||w==L.vW.Agent||w==L.vW.TaskGeneration?(0,e.jsx)($e.ZP,{type:"text",onClick:He,className:"text-green-500",disabled:E,icon:(0,e.jsx)(mt.Z,{}),children:o.formatMessage({id:"workflow.checkBackLogs",defaultMessage:""})}):null};return g?(0,e.jsx)(_t.Z,{className:"w-[400px] border border-blue-300 fixed z-10  top-[105px] right-2 ",style:{height:"calc(100vh - 10px - 100px)"},extra:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Fe,{}),(0,e.jsx)($e.ZP,{onClick:function(){Z(!1),i(null)},type:"text",icon:(0,e.jsx)(st.Z,{})})]}),title:(0,e.jsx)(ke.Z.Title,{level:5,children:o.formatMessage({id:"workflow.backlogs",defaultMessage:""})}),bodyStyle:{overflowY:"auto",marginTop:"20px",boxSizing:"border-box"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(ke.Z.Title,{level:5,children:n==null||(d=n.node_graph)===null||d===void 0||(d=d.data)===null||d===void 0?void 0:d.title})}),(0,e.jsx)("div",{children:(0,e.jsx)(ke.Z.Text,{children:n==null||(s=n.node_graph)===null||s===void 0||(s=s.data)===null||s===void 0?void 0:s.desc})}),Ye()]})}):null}),Vt=t(19632),Ct=t.n(Vt),Gt=t(9783),dt=t.n(Gt),Jt=t(39873),Yt=t(22352),Xt=t(40110),Qt=t(86615),qt=t(5966),ea=t(62370),ta=t(96638),aa=t(74330),na=t(11941),oa=t(87718),gt=t(69386),pt=t(63680),ra=t(63783),ct=t(83062),ht=t(99510),yt=(0,l.memo)(function(d){var s=d.children,o=d.onDragStart,f=d.onClick,x=d.type,g=d.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(r){return o(r,x,g)},onClick:f,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:s})}),la=(0,l.memo)(function(d){var s,o,f,x=d.item,g=d.onDragStart,Z=d.typeBadge,r=d.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(x==null||(s=x.baseData)===null||s===void 0?void 0:s.description)||(x==null||(o=x.data)===null||o===void 0?void 0:o.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:g,type:x.type,item:x,onClick:function(){return r==null?void 0:r(x)},children:(0,e.jsx)(ht.Z,{title:x.data.title,icon:(x==null||(f=x.baseData)===null||f===void 0?void 0:f.icon)||x.type,typeBadge:Z})})})})}),ia=(0,l.memo)(function(d){var s,o=d.item,f=d.onDragStart,x=d.typeBadge,g=d.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(s=o.baseData)===null||s===void 0?void 0:s.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:f,type:o.type,item:o,onClick:function(){return g==null?void 0:g(o)},children:(0,e.jsx)(ht.Z,{title:o.baseData.name,icon:o.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:o.baseData.nickname}),typeBadge:x})})})})}),sa=(0,l.memo)(function(d){var s,o,f,x,g,Z,r,i,b,O,U,H,K,n,h=d.tool,D=d.category,X=d.onDragStart,Q=d.typeBadge,T=d.onItemClick,u=d.categoryIndex,N=d.toolIndex,E=(0,ae.getLocale)()==="en-US"?"en_US":"zh_Hans",A=(0,pt.o6)()[L.vW.Tool],F=k()(k()({},h),{},{authorization_status:D==null?void 0:D.authorization_status,title:h==null||(s=h.identity)===null||s===void 0?void 0:s.label[E],icon:D==null||(o=D.identity)===null||o===void 0?void 0:o.icon,groupName:D==null||(f=D.identity)===null||f===void 0?void 0:f.name,credentials_for_provider:D==null?void 0:D.credentials_for_provider}),W={title:h==null||(x=h.identity)===null||x===void 0?void 0:x.label[E],desc:(h==null||(g=h.description)===null||g===void 0||(g=g.human)===null||g===void 0?void 0:g[E])||(h==null||(Z=h.description)===null||Z===void 0?void 0:Z.llm),icon:D==null||(r=D.identity)===null||r===void 0?void 0:r.icon,data:{title:h==null||(i=h.identity)===null||i===void 0?void 0:i.label[E],desc:(h==null||(b=h.description)===null||b===void 0||(b=b.human)===null||b===void 0?void 0:b[E])||(h==null||(O=h.description)===null||O===void 0?void 0:O.llm),icon:D==null||(U=D.identity)===null||U===void 0?void 0:U.icon},baseData:F};return(0,e.jsx)(ct.Z,{placement:"right",title:h==null||(H=h.description)===null||H===void 0||(H=H.human)===null||H===void 0?void 0:H[E],children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:X,type:L.vW.Tool,item:W,onClick:function(){return T==null?void 0:T(D,h,u,N)},children:(0,e.jsx)(ht.Z,{title:h==null||(K=h.identity)===null||K===void 0?void 0:K.label[E],icon:D==null||(n=D.identity)===null||n===void 0?void 0:n.icon,typeBadge:Q})})})})}),ua=(0,l.memo)(function(d){var s,o,f=d.category,x=d.onDragStart,g=d.typeBadge,Z=d.onItemClick,r=d.categoryIndex,i=(0,ae.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[f==null||(s=f.identity)===null||s===void 0?void 0:s.label[i],(0,e.jsx)(ct.Z,{placement:"right",title:f==null||(o=f.identity)===null||o===void 0?void 0:o.description[i],children:(0,e.jsx)(ra.Z,{className:"cursor-pointer ml-1"})})]}),f.tools.map(function(b,O){return(0,e.jsx)(sa,{tool:b,category:f,onDragStart:x,typeBadge:g,onItemClick:function(H,K,n,h){return Z==null?void 0:Z(H,K,n,h)},categoryIndex:r,toolIndex:O},O)})]})}),da=function(s){var o=s.list,f=s.onDragStart,x=s.type,g=x===void 0?"normal":x,Z=s.typeBadge,r=Z===void 0?null:Z,i=s.onItemClick;return o!=null&&o.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:g==="tools"?o.map(function(b,O){return(0,e.jsx)(ua,{category:b,typeBadge:r,onDragStart:f,onItemClick:i,categoryIndex:O},O)}):g==="workflow"?o.map(function(b,O){return(0,e.jsx)(ia,{item:b,onDragStart:f,typeBadge:r,onItemClick:i},O)}):o.map(function(b,O){return(0,e.jsx)(la,{item:b,onDragStart:f,typeBadge:r,onItemClick:i},O)})}):null},ca=(0,l.memo)(da),va=t(26474),kt=t(47520),fa=t(36711),ma=t(82826),It=t(43425),ga=t(48869),pa=t(69243),ha=t(91806),vt=t(52688),ya=t(55241),xa=t(50136),xt=t(43586),wa=function(){var s,o=(0,ae.useIntl)(),f=(0,l.useState)(!0),x=y()(f,2),g=x[0],Z=x[1],r=(0,v.Z)(function(W){return W.setWorkflowEditInfo}),i=(0,v.Z)(function(W){return W.workFlowInfo}),b=(0,v.Z)(function(W){return W.setSelect}),O=(0,l.useState)("1"),U=y()(O,2),H=U[0],K=U[1],n=(0,l.useState)(!1),h=y()(n,2),D=h[0],X=h[1],Q=(0,xt.Z)(),T=(0,l.useRef)(null),u=function(){var R,_;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(Ne.A,{formRef:T,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:o.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{tooltip:(i==null||(R=i.app)===null||R===void 0?void 0:R.publish_status)!="1"?{title:o.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(i==null||(_=i.app)===null||_===void 0?void 0:_.publish_status)!="1",name:"enable_api",label:"API"})]})})})},N=[{key:"4",icon:(0,e.jsx)(ma.Z,{}),label:o.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:i!=null&&i.isProd?(0,e.jsx)(It.Z,{}):(0,e.jsx)(ya.Z,{content:u,trigger:"click",forceRender:!0,placement:"rightTop",title:o.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(It.Z,{})}),label:o.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:i==null?void 0:i.isProd},{key:"1",icon:(0,e.jsx)(ga.Z,{}),label:o.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(pa.Z,{}),label:o.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:D?o.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):o.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!D},{key:"3",icon:(0,e.jsx)(ha.Z,{}),label:o.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,Ce.Z)(function(){if(i){var W,R,_,re,we=i==null||(W=i.app)===null||W===void 0?void 0:W.is_public,ge=i==null||(R=i.app)===null||R===void 0?void 0:R.enable_api,pe={};pe.is_public=!!we,pe.enable_api=(i==null||(_=i.app)===null||_===void 0?void 0:_.publish_status)=="1"?!!ge:!1,console.log(pe),X(pe.enable_api),T==null||(re=T.current)===null||re===void 0||re.setFieldsValue(pe)}},[i]);var E=function(R,_){console.log(R,_),A(_.enable_api),r(_),setTimeout(Q,300)},A=function(R){X(!!R)},F=function(R){var _;switch(R.key){case"4":ae.history.go(-1);break;case"0":break;case"2":window.open(kt._n+(i==null||(_=i.app)===null||_===void 0?void 0:_.api_url),"_blank");break;default:b(""),K(R.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(H==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(xa.Z,{defaultSelectedKeys:["1"],selectedKeys:[H],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:g,items:N,onClick:F}),H=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(Ne.A,{formRef:T,submitter:{render:function(){return null}},onValuesChange:E,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:o.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{disabled:!(i!=null&&(s=i.app)!==null&&s!==void 0&&s.api_url),name:"enable_api",label:"API"})]})})})]}),H=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(fa.default,{})})})]})},ba=wa,Sa=(0,l.memo)(function(d){var s=d.name,o=d.description,f=d.publishStatus,x=(0,ae.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(ke.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:s}),f&&(0,e.jsxs)(ke.Z.Text,{className:"whitespace-normal",children:["(",x.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(ke.Z.Text,{className:"whitespace-normal text-gray-500",children:o})]})}),Da=(0,l.memo)(function(d){var s=d.visibleTabs,o=d.defaultActiveTab,f=d.showTeamSwitch,x=f===void 0?!0:f,g=d.workflowName,Z=d.workflowDesc,r=d.publishStatus,i=d.onWidthChange,b=(0,ae.useIntl)(),O=(0,ae.getLocale)()=="en-US"?"en_US":"zh_Hans",U=(0,pt.o6)(),H=Object.values(U).filter(function(a){return![L.vW.Start,L.vW.Agent,L.vW.Tool,L.vW.Skill].includes(a.base.type)}).map(function(a){return a.base}),K=(0,l.useState)(o||"1"),n=y()(K,2),h=n[0],D=n[1],X=(0,l.useState)(H),Q=y()(X,2),T=Q[0],u=Q[1],N=(0,l.useState)([]),E=y()(N,2),A=E[0],F=E[1],W=(0,va.v)(),R=W.tags,_=(0,ta.Z)(dt()(dt()(dt()({},L.vW.Agent,[]),L.vW.Skill,[]),"workflow",[])),re=y()(_,2),we=re[0],ge=re[1],pe=(0,l.useState)({team:1,keyword:"",tag:[]}),Pe=y()(pe,2),P=Pe[0],He=Pe[1],Ve=(0,l.useState)(!1),Ge=y()(Ve,2),Ie=Ge[0],nt=Ge[1],Je=(0,l.useState)(!1),Ye=y()(Je,2),Fe=Ye[0],p=Ye[1],w=(0,v.Z)(function(a){return a.toolData});(0,l.useEffect)(function(){F((w==null?void 0:w.list)||[])},[w]);var j=(0,l.useCallback)(function(a,c,m){console.log("onDragStart",a,c,m),a.dataTransfer.setData("application/reactflow",JSON.stringify({type:c,item:m})),a.dataTransfer.effectAllowed="move"},[]),$=(0,l.useCallback)(function(a,c){if(!c)return a;var m=new gt.Z(a,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),B=m.search(c);return B.map(function(M){return M.item})},[]),z=(0,l.useCallback)(function(a,c){if(!c)return a;var m=a.map(function(S){var C;return k()(k()({},S),{},{tools:(C=S.tools)===null||C===void 0?void 0:C.map(function(J){var I,ne;return k()(k()({},J),{},{categoryName:(I=S.identity)===null||I===void 0||(I=I.label)===null||I===void 0?void 0:I[O],categoryIcon:(ne=S.identity)===null||ne===void 0?void 0:ne.icon})})})}),B=new gt.Z(m,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),M=B.search(c);return M.map(function(S){return k()(k()({},S.item),{},{tools:S.item.tools.filter(function(C){var J=new gt.Z([C],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return J.search(c).length>0})})}).filter(function(S){return S.tools.length>0})},[O]),q=(0,l.useMemo)(function(){var a=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return P.keyword?$(T,P.keyword):T}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return he(L.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return P.keyword?z(A,P.keyword):A}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var m=le()(V()().mark(function M(){return V()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,he(L.vW.Skill);case 2:return C.abrupt("return",C.sent);case 3:case"end":return C.stop()}},M)}));function B(){return m.apply(this,arguments)}return B}()},{tabKey:"workflow",label:"workflow.list",defaultMessage:"Workflow",type:"workflow",getData:function(){var m=le()(V()().mark(function M(){return V()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,he("workflow");case 2:return C.abrupt("return",C.sent);case 3:case"end":return C.stop()}},M)}));function B(){return m.apply(this,arguments)}return B}()}],c=s!=null&&s.length?a.filter(function(m){return s.includes(m.tabKey)}):a;return c.map(function(m,B){return k()(k()({},m),{},{key:B+1+""})})},[T,we,A,s,P,$,z]),be=(0,l.useMemo)(function(){return q.map(function(a,c){return{key:a.key,label:b.formatMessage({id:a.label,defaultMessage:a.defaultMessage})}})},[q]),ie=(0,l.useCallback)(function(a){var c=a.tabIndex,m=a.showName,B=m===void 0?!0:m,M=q.find(function(te){return te.key===c}),S=(0,l.useState)([]),C=y()(S,2),J=C[0],I=C[1],ne=(0,l.useState)(!0),ee=y()(ne,2),Ae=ee[0],Nt=ee[1],Ea=(0,l.useState)([]),Pt=y()(Ea,2),ot=Pt[0],Tt=Pt[1],Oa=(0,l.useState)(20),Aa=y()(Oa,1),Wt=Aa[0],Ba=(0,l.useState)(500),Et=y()(Ba,2),Ot=Et[0],At=Et[1],ze=(0,l.useRef)(null),La=54;(0,l.useEffect)(function(){var te=function(){if(ze.current){var de=ze.current.clientHeight;At(de)}},ue=function(de){At(de.detail.height)};return te(),ze.current&&ze.current.addEventListener("containerResize",ue),window.addEventListener("resize",te),function(){ze.current&&ze.current.removeEventListener("containerResize",ue),window.removeEventListener("resize",te)}},[]),(0,l.useEffect)(function(){var te=function(){var ue=le()(V()().mark(function Se(){var de,Me;return V()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return Nt(!0),ce.prev=1,ce.next=4,M.getData();case 4:de=ce.sent,Me=(de==null?void 0:de.map(function(Rt,wt){return k()(k()({},Rt),{},{id:"".concat(M.tabKey,"-").concat(wt)})}))||[],I(Me),Tt(Me.slice(0,Wt)),ce.next=13;break;case 10:ce.prev=10,ce.t0=ce.catch(1),console.error("Failed to fetch data:",ce.t0);case 13:return ce.prev=13,Nt(!1),ce.finish(13);case 16:case"end":return ce.stop()}},Se,null,[[1,10,13,16]])}));return function(){return ue.apply(this,arguments)}}();te()},[M,P]);var Ra=function(ue){if(ue.currentTarget.scrollHeight-ue.currentTarget.scrollTop===Ot){var Se=ot.length;if(Se<J.length){var de=J.slice(Se,Se+Wt);Tt(function(Me){return[].concat(Ct()(Me),Ct()(de))})}}},Bt=(0,l.useCallback)(function(te,ue,Se,de){switch(console.log("Clicked category:",te),console.log("Clicked item:",ue),console.log("Indices:",Se,de),M.tabKey){case"tool":if(Se!==void 0&&de!==void 0){var Me,Xe;console.log("Tool ".concat((Me=ue.identity)===null||Me===void 0?void 0:Me.label[O]," in category ").concat((Xe=te.identity)===null||Xe===void 0?void 0:Xe.label[O]))}break;case"workflow":break;case"agent":break}},[M.tabKey,O]),Lt=(0,l.memo)(function(te){var ue=te.data,Se=te.index,de=te.onDragStart,Me=te.onItemClick,Xe=te.type,ce=te.typeBadge;return(0,e.jsx)(ca,{typeBadge:ce,list:[ue],onDragStart:de,type:Xe,onItemClick:function(wt){return Me(wt)}})});return(0,e.jsx)("div",{ref:ze,className:"overflow-y-auto h-full",children:(0,e.jsx)(aa.Z,{spinning:Ae,children:P!=null&&P.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:ot.map(function(te){return(0,e.jsx)(Lt,{data:te,index:ot.indexOf(te),onDragStart:j,onItemClick:Bt,type:M.type,typeBadge:P!=null&&P.keyword&&M.tabKey!="node"?{icon:"/icons/".concat(M.tabKey,".svg"),tooltip:M.tabKey,color:"#1b64f3"}:void 0},te.id)})}):(0,e.jsx)(oa.Z,{data:ot,height:Ot,itemHeight:La,itemKey:"id",onScroll:Ra,children:function(ue){return(0,e.jsx)(Lt,{data:ue,index:ot.indexOf(ue),onDragStart:j,onItemClick:Bt,type:M.type,typeBadge:P!=null&&P.keyword&&M.tabKey!="node"?{icon:"/icons/".concat(M.tabKey,".svg"),tooltip:M.tabKey,color:"#1b64f3"}:void 0})}})})})},[h,P,Ie]),he=(0,l.useCallback)(function(){var a=le()(V()().mark(function c(m){var B,M,S,C;return V()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,(0,Y.RE)(m,{search_type:P.team,apps_name:P.keyword,tag_ids:((B=P.tag)===null||B===void 0?void 0:B.join(","))||""});case 3:if(S=I.sent,!((S==null?void 0:S.code)===0&&S!==null&&S!==void 0&&(M=S.data)!==null&&M!==void 0&&(M=M.list)!==null&&M!==void 0&&M.length)){I.next=8;break}return C=S.data.list.map(function(ne){var ee,Ae;return k()(k()({},(ee=U[m])===null||ee===void 0?void 0:ee.base),{},{data:k()(k()({},(Ae=U[m])===null||Ae===void 0?void 0:Ae.base.data),{},{title:ne.name,desc:ne.description}),baseData:ne})}),ge(dt()({},m,C)),I.abrupt("return",C);case 8:I.next=13;break;case 10:I.prev=10,I.t0=I.catch(0),console.error("Failed to fetch ".concat(m," data:"),I.t0);case 13:case"end":return I.stop()}},c,null,[[0,10]])}));return function(c){return a.apply(this,arguments)}}(),[P]),ye=(0,l.useCallback)((0,jt.debounce)(function(a){He(a)},500),[]),_e=(0,l.useCallback)(function(a,c){"team"in a?(He(c),c.team==2):("tag"in a||"keyword"in a)&&ye(c)},[ye]);return(0,e.jsx)(Jt.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:Fe?100:315,onChange:function(c,m){requestAnimationFrame(function(){nt(c<100),i==null||i(c);var B=document.querySelectorAll(".overflow-y-auto");B.forEach(function(M){if(M instanceof HTMLElement){var S=M.clientHeight,C=new CustomEvent("containerResize",{detail:{height:S,width:c}});M.dispatchEvent(C)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[!Fe&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(Ne.A,{submitter:!1,initialValues:P,onValuesChange:_e,children:[x&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[b.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Qt.Z.Group,{name:"team",fieldProps:{options:[{label:b.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:b.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(qt.Z,{fieldProps:{prefix:(0,e.jsx)(Xt.Z,{}),placeholder:b.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(ea.Z,{name:"tag",children:(0,e.jsx)(Yt.O,{className:"w-full",options:R,listStyle:Ie?"horizontal":"vertical",allowClear:!0,placeholder:b.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(c){}})})})]}),P!=null&&P.keyword?null:(0,e.jsx)(na.Z,{activeKey:h,items:be,onChange:function(c){D(c)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:P!=null&&P.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:q.map(function(a,c){return(0,e.jsxs)("div",{className:"space-y-2",children:[!Fe&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:b.formatMessage({id:a.label,defaultMessage:a.defaultMessage})}),(0,e.jsx)(ie,{tabIndex:c+1+"",showName:!Ie},a.key)]},a.key)})}):(0,e.jsx)(ie,{tabIndex:h,showName:!Ie})}),(0,e.jsx)(ba,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Sa,{name:g,description:Z,publishStatus:r})})]})})}),ja=t(74842),Ma=t(98165),Ca=t(58638),ka=t(27484),Ia=t.n(ka),Za=(0,l.memo)(function(){var d=(0,ae.useIntl)(),s=(0,ae.useSearchParams)(),o=y()(s,1),f=o[0],x=(0,v.Z)(function(T){return T.setWorkFlowInfo}),g=(0,v.Z)(function(T){return T.workFlowInfo}),Z=(0,v.Z)(function(T){return T.setRunPanelShow}),r=f.get("type")=="true",i=(0,xt.Z)(),b=G.ZP.useMessage(),O=y()(b,2),U=O[0],H=O[1],K=(0,v.Z)(function(T){return T.loadingWorkflowData}),n=function(){var T=le()(V()().mark(function u(){var N;return V()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,i();case 2:N=f.get("app_id"),(0,Y.aJ)(N).then(function(F){console.log(F),F.code==0&&(x(k()(k()({},g),{},{app:k()(k()({},g==null?void 0:g.app),{},{publish_status:"1"})})),U.open({type:"success",content:d.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return A.stop()}},u)}));return function(){return T.apply(this,arguments)}}(),h=function(){Z(!0)},D=function(){var T=le()(V()().mark(function u(){var N,E;return V()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return N=f.get("app_id"),F.next=3,(0,Y.Uq)(N);case 3:E=F.sent;case 4:case"end":return F.stop()}},u)}));return function(){return T.apply(this,arguments)}}(),X=function(){var T=le()(V()().mark(function u(){var N,E,A,F;return V()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:E=f.get("app_id"),A=(g==null||(N=g.app)===null||N===void 0?void 0:N.name)||"workflow",F=Ia()().format("YYYY_MM_DD-HH_mm_ss"),(0,Y.w8)(E,r==!0?1:0).then(function(_){var re=new Blob([_],{type:"text/yaml"}),we=URL.createObjectURL(re),ge=document.createElement("a");ge.href=we,ge.download="".concat(A,"_").concat(F,".yml"),document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(we)});case 4:case"end":return R.stop()}},u)}));return function(){return T.apply(this,arguments)}}(),Q={name:"file",fileList:null,action:kt._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!r&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)($e.ZP,{type:"primary",disabled:K,onClick:n,children:d.formatMessage({id:"workflow.release"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(ja.Z,{}),disabled:K,onClick:h,children:d.formatMessage({id:"workflow.run"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ma.Z,{}),type:"dashed",disabled:K,onClick:i,children:d.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ca.Z,{}),type:"dashed",onClick:X,disabled:K,children:d.formatMessage({id:"workflow.export",defaultMessage:""})}),H]})}),Zt=t(43111),Na=function(){var s,o,f=(0,ae.useIntl)(),x=(0,l.useRef)(null),g=(0,v.Z)(function(a){return a.resetNodes}),Z=(0,v.Z)(function(a){return a.setNodeTypes}),r=(0,v.Z)(function(a){return a.addNode}),i=(0,v.Z)(function(a){return a.createNode}),b=(0,v.Z)(function(a){return a.setNodes}),O=(0,v.Z)(function(a){return a.setEdges}),U=(0,v.Z)(function(a){return a.setAppId}),H=(0,v.Z)(function(a){return a.setRunPanelShow}),K=(0,v.Z)(function(a){return a.runPanelShow}),n=(0,v.Z)(function(a){return a.getModelData}),h=(0,v.Z)(function(a){return a.setWorkFlowInfo}),D=(0,v.Z)(function(a){return a.setHandleList}),X=(0,v.Z)(function(a){return a.workFlowInfo}),Q=(0,v.Z)(function(a){return a.setWorkflowEditInfo}),T=G.ZP.useMessage(),u=y()(T,2),N=u[0],E=u[1],A=(0,me._K)(),F=A.screenToFlowPosition,W=A.getNodes,R=A.setViewport,_=Ze(F),re=_.onDnD,we=(0,ae.useSearchParams)(),ge=y()(we,1),pe=ge[0],Pe=pe.get("type")=="true",P=(0,v.Z)(function(a){return a.setLoadingWorkflowData}),He=(0,me.B)({includeHiddenNodes:!1}),Ve=(0,We.Z)(),Ge=(0,xt.Z)(),Ie=(0,l.useState)(null),nt=y()(Ie,2),Je=nt[0],Ye=nt[1],Fe=(0,l.useState)(!1),p=y()(Fe,2),w=p[0],j=p[1],$=(0,l.useState)(""),z=y()($,2),q=z[0],be=z[1],ie=null;(0,me.CV)({onEnd:function(c){}}),(0,Be.Z)(function(){Z((0,pt.$P)()),g(),(0,et.b6)(),he(),D([])}),je(),(0,l.useEffect)(function(){if(Je){ae.history.push(q);return}var a=ae.history.block(function(c,m){if(K){be(c.location.pathname),j(!0);return}});return K||a==null||a(),function(){a==null||a()}},[K,Je]),(0,Ce.Z)(function(){if(He){var a=W(),c=a[a.length-1];c.data.drag&&(c.position={x:c.position.x-c.measured.width/2,y:c.position.y-c.measured.height/2},b(a))}},[He]),(0,l.useEffect)(function(){var a=re(function(c,m,B){console.log(c,m,B),i(m,{position:c,data:k()(k()({drag:!0},B.data),{},{baseData:B.baseData})})});return a},[re,r]),(0,Ce.Z)(function(){Ve=="hidden"&&Ge()},[Ve]);var he=function(){var a=le()(V()().mark(function c(){var m;return V()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:m=pe.get("app_id"),Pe&&N.open({type:"warning",content:f.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),P(!0),U(m),(0,Y.kE)(m,Pe?1:0).then(function(S){if(S.code==0){if(h(k()(k()({},S.data),{},{isProd:Pe})),!S.data.workflow.graph){P(!1),i(L.vW.Start);return}var C=S.data,J=C.workflow.graph,I=J.edges,ne=J.nodes,ee=J.views,Ae=C.app;Q({enable_api:!!Ae.enable_api,is_public:!!Ae.is_public}),ee!=null&&ee.nodes&&b(ee.nodes),ee!=null&&ee.edges&&O(ee.edges),ee!=null&&ee.viewPort,setTimeout(function(){P(!1)},1e3)}}),n();case 6:case"end":return M.stop()}},c)}));return function(){return a.apply(this,arguments)}}(),ye=function(){Ye(!0),console.log(q),ae.history.push(q),j(!1)},_e=function(){j(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[E,(0,e.jsx)(xe.Z,{title:f.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:w,onOk:ye,onCancel:_e,children:f.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:x,children:(0,e.jsxs)(Re,{children:[(0,e.jsx)(me.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(me.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(Da,{visibleTabs:["node","agent","skill","tool"],workflowName:X==null||(s=X.app)===null||s===void 0?void 0:s.name,workflowDesc:X==null||(o=X.app)===null||o===void 0?void 0:o.description,publishStatus:Pe}),(0,e.jsx)(Za,{}),(0,e.jsx)(Zt.s_,{}),(0,e.jsx)(Zt.Jf,{}),(0,e.jsx)(Kt,{})]})},Pa=(0,l.memo)(function(){return(0,e.jsx)(me.tV,{children:(0,e.jsx)(Na,{})})}),Ta=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(Pa,{})})},Wa=Ta}}]);
