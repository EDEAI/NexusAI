"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[734],{82826:function(Oe,ye,n){n.d(ye,{Z:function(){return o}});var pe=n(1413),p=n(67294),ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},ne=ke,U=n(91146),ee=function(v,C){return p.createElement(U.Z,(0,pe.Z)((0,pe.Z)({},v),{},{ref:C,icon:ne}))},Me=p.forwardRef(ee),o=Me},83510:function(Oe,ye,n){n.d(ye,{LK:function(){return c},bs:function(){return L},go:function(){return t},uy:function(){return h}});var pe=n(15009),p=n.n(pe),ke=n(99289),ne=n.n(ke),U=n(47520),ee="/v1/apps/apps_list",Me="/v1/agent/agent_delete/",o="/v1/workflow/workflow_app_delete/",Le="/v1/vector/delete_dataset/",v="/v1/skill/delete_skill_by_app_id/",C="/v1/apps/apps_create",a="/v1/apps/app_update/",t=function(){var le=ne()(p()().mark(function Y(Z){var J;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.ZP)("".concat(ee),{method:"GET",data:Z});case 2:return J=e.sent,e.abrupt("return",J);case 4:case"end":return e.stop()}},Y)}));return function(Z){return le.apply(this,arguments)}}(),c=function(){var le=ne()(p()().mark(function Y(Z){var J;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Z),e.next=3,Z.mode;case 3:if(e.t0=e.sent,e.t0!=1){e.next=8;break}e.t1=(0,U.ZP)("".concat(Me).concat(Z.app_id),{method:"DELETE"}),e.next=9;break;case 8:e.t1=Z.mode==2?(0,U.ZP)("".concat(o).concat(Z.app_id),{method:"DELETE"}):Z.mode==3?(0,U.ZP)("".concat(Le).concat(Z.app_id),{method:"DELETE"}):(0,U.ZP)("".concat(v).concat(Z.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return J=e.t1,e.abrupt("return",J);case 11:case"end":return e.stop()}},Y)}));return function(Z){return le.apply(this,arguments)}}(),h=function(){var le=ne()(p()().mark(function Y(Z){var J;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.ZP)("".concat(C),{method:"POST",data:Z});case 2:return J=e.sent,e.abrupt("return",J);case 4:case"end":return e.stop()}},Y)}));return function(Z){return le.apply(this,arguments)}}(),L=function(){var le=ne()(p()().mark(function Y(Z){var J;return p()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.ZP)("".concat(a).concat(Z.app_id),{method:"PUT",data:Z});case 2:return J=e.sent,e.abrupt("return",J);case 4:case"end":return e.stop()}},Y)}));return function(Z){return le.apply(this,arguments)}}()},77638:function(Oe,ye,n){n.r(ye),n.d(ye,{default:function(){return aa}});var pe=n(5574),p=n.n(pe),ke=n(32332),ne=n(82826),U=n(35312),ee=n(28036),Me=n(50136),o=n(67294),Le=n(97857),v=n.n(Le),C=n(15009),a=n.n(C),t=n(99289),c=n.n(t),h=n(83065),L=n(45360),le=n(71230),Y=n(15746),Z=n(4393),J=n(26915),je=n(86842),e=n(85893),Te=1,Re=function(u){var i=u.createkbInfo,s=(0,U.useIntl)(),l=[{title:s.formatMessage({id:"createkb.text",defaultMessage:""}),dataIndex:"input",ellipsis:!0},{title:s.formatMessage({id:"createkb.recallParagraph",defaultMessage:""}),dataIndex:"document_segment_num",width:"15%"},{title:s.formatMessage({id:"createkb.time",defaultMessage:""}),dataIndex:"created_time",width:"25%"}],r=(0,o.useState)([]),j=p()(r,2),w=j[0],T=j[1],te=(0,o.useState)(null),se=p()(te,2),O=se[0],m=se[1],P=(0,o.useState)(null),k=p()(P,2),M=k[0],ie=k[1],V=(0,o.useState)([]),re=p()(V,2),ue=re[0],F=re[1],D=(0,o.useState)(!1),oe=p()(D,2),W=oe[0],X=oe[1],z=(0,o.useState)(""),N=p()(z,2),ae=N[0],B=N[1],ce=(0,o.useRef)(null),Ne=(0,o.useState)(0),Q=p()(Ne,2),he=Q[0],Ce=Q[1],_e=(0,o.useState)(1),De=p()(_e,2),Fe=De[0],we=De[1],xe=function(){var E=c()(a()().mark(function x(){var A;return a()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(ae==""){R.next=11;break}return X(!0),F([]),R.next=5,(0,h.I9)({user_input:ae},i.app_id);case 5:A=R.sent,A.code==0?(A.data.data.length<=0&&L.ZP.error(s.formatMessage({id:"createkb.saveSuccess",defaultMessage:""})),F(A.data.data)):L.ZP.error(A.detail),X(!1),I(),R.next=14;break;case 11:X(!1),F([]),L.ZP.error(s.formatMessage({id:"createkb.testInput",defaultMessage:""}));case 14:case"end":return R.stop()}},x)}));return function(){return E.apply(this,arguments)}}(),de=function(){var E=c()(a()().mark(function x(A){return a()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:B(A.target.value);case 1:case"end":return R.stop()}},x)}));return function(A){return E.apply(this,arguments)}}(),q=function(x){Te=x,I()},fe=function(){var E=c()(a()().mark(function x(A){var H;return a()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return X(!0),ve.next=3,(0,h.gk)(A.id);case 3:H=ve.sent,H.code==0?F(H.data.data):L.ZP.error(H.detail),X(!1),B(A.input);case 7:case"end":return ve.stop()}},x)}));return function(A){return E.apply(this,arguments)}}(),I=function(){var E=c()(a()().mark(function x(){var A,H,R=arguments;return a()().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return A=R.length>0&&R[0]!==void 0?R[0]:Te,ge.next=3,(0,h.yC)({page:A},i.app_id);case 3:H=ge.sent,H.code==0&&(T(H.data.data),ie(H.data));case 5:case"end":return ge.stop()}},x)}));return function(){return E.apply(this,arguments)}}(),me=function(){var E=c()(a()().mark(function x(){var A,H,R,ve,ge=arguments;return a()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return A=ge.length>0&&ge[0]!==void 0?ge[0]:1,H={app_id:i.app_id},Se.next=4,(0,h.SH)(H);case 4:R=Se.sent,R.code==0&&(ve=R.data.data.map(function(Ze,dt){return v()(v()({},Ze),{},{statusText:Ze.status==1?s.formatMessage({id:"createkb.normal",defaultMessage:""}):Ze.status==2?s.formatMessage({id:"createkb.disabled",defaultMessage:""}):s.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),console.log(R),m(R.data));case 6:case"end":return Se.stop()}},x)}));return function(){return E.apply(this,arguments)}}();return(0,o.useEffect)(function(){I(),me(),setTimeout(function(){ce.current&&Ce(ce.current.offsetHeight-55-82)},200),i.app_id&&we(i.type?2:1)},[]),(0,e.jsx)(e.Fragment,{children:M!=null?(0,e.jsxs)("div",{className:"h-full pb-[30px]",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Fe==2?(0,U.getLocale)()=="zh-CN"?O?O.dataset_detail.nickname+s.formatMessage({id:"createkb.knowledge.base.of"}):s.formatMessage({id:"createkb.knowledge.base.of"}):O?s.formatMessage({id:"createkb.knowledge.base.of"})+O.dataset_detail.nickname:s.formatMessage({id:"createkb.knowledge.base.of"}):Fe==1?s.formatMessage({id:"createkb.editKB"}):s.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"flex w-full",style:{height:"calc(100% - 84px)"},children:(0,e.jsxs)(le.Z,{gutter:0,style:{marginRight:"0px",marginLeft:"0px"},children:[(0,e.jsx)(Y.Z,{className:"pb-[30px] h-2/4",span:24,children:(0,e.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,e.jsx)("div",{className:"mb-5 text-[#555555] text-sm font-medium",children:s.formatMessage({id:"createkb.recallTest",defaultMessage:""})}),(0,e.jsxs)("div",{className:"w-full px-[15px] py-[15px] border-[#EEEEEE] rounded-lg bg-[#F7F7F7] flex-1 min-h-0",children:[(0,e.jsx)("div",{className:" overflow-y-auto",style:{height:"calc(100% - 65px)"},children:(0,e.jsx)(le.Z,{gutter:[15,15],className:"w-full",children:ue.map(function(E,x){var A=(E.score*1).toFixed(4),H=E.reranking_score>0?(E.reranking_score*1).toFixed(4):0;return(0,e.jsx)(Y.Z,{className:"gutter-row w-full",span:24,children:(0,e.jsx)(Z.Z,{activeTabKey:E.id,size:"small",children:(0,e.jsxs)("div",{className:"w-full bg-white  font-normal text-[12px] rounded-lg",children:[(0,e.jsx)("div",{className:"break-all text-[#213044] leading-[17px]",children:E.content}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",s.formatMessage({id:"createkb.source",defaultMessage:""}),"\uFF1A ",E.name]}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px]  leading-[17px]",children:[" ",s.formatMessage({id:"createkb.matchScore"}),"\uFF1A ",A]}),H==0?"":(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",s.formatMessage({id:"createkb.sortScore"}),"\uFF1A ",H]})]})})},E.id)})})}),(0,e.jsxs)("div",{className:"bg-white flex items-center rounded-lg mt-[15px] p-[10px]",children:[(0,e.jsx)(J.Z,{className:" custom-textarea",onChange:de,variant:"borderless",placeholder:s.formatMessage({id:"createkb.briefText"}),maxLength:200,showCount:!0,value:ae,onPressEnter:xe}),(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsx)(ee.ZP,{type:"primary",loading:W,onClick:xe,style:{background:"rgba(27,100,243,.1)"},className:"w-[30px] h-[30px] rounded-md flex justify-center items-center p-0",children:W?"":(0,e.jsx)("img",{src:"/icons/fs.svg",className:"w-4 h-4"})})})]})]})]})}),(0,e.jsx)("div",{className:"h-2/4",ref:ce,children:(0,e.jsx)(Y.Z,{span:24,children:(0,e.jsxs)("div",{className:"w-full h-full",children:[(0,e.jsx)("div",{className:" mb-[20px] text-[#555555] text-sm font-medium",children:s.formatMessage({id:"createkb.recentQuery"})}),(0,e.jsx)("div",{className:"w-[900px] rounded-md border-[#eeeeee] border rounded-lg",children:(0,e.jsx)(je.Z,{rowKey:"id",columns:l,dataSource:w,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:s.formatMessage({id:"createkb.no.data.available"})})})},pagination:{pageSize:M.paging_information.page_size,total:M.paging_information.total_count,onChange:q,style:{margin:"0px",marginTop:"10px"},hideOnSinglePage:!0},onRow:function(x,A){return{onClick:function(){return fe(x)},style:{cursor:"pointer"}}},scroll:he!=0?{y:he}:{}})})]})})})]})})]}):""})},ft=Re,pt=n(83510),mt=n(40741),Ue=n(72269),gt=n(74330),ht=function(u){var i=u.createkbInfo,s=u.fun,l=(0,U.useIntl)(),r=(0,o.useState)(null),j=p()(r,2),w=j[0],T=j[1],te=(0,o.useState)(!1),se=p()(te,2),O=se[0],m=se[1],P=(0,o.useState)(1),k=p()(P,2),M=k[0],ie=k[1],V=(0,o.useState)(1),re=p()(V,2),ue=re[0],F=re[1],D=(0,o.useState)(null),oe=p()(D,2),W=oe[0],X=oe[1],z=(0,o.useState)(null),N=p()(z,2),ae=N[0],B=N[1],ce=(0,o.useState)(1),Ne=p()(ce,2),Q=Ne[0],he=Ne[1],Ce=function(q){i.type||ie(q)},_e=function(q){F(q==!0?1:0)},De=function(){s({type:"return"})},Fe=function(){var de=c()(a()().mark(function q(){var fe,I,me;return a()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(m(!0),i.app_id){x.next=11;break}return x.next=4,(0,pt.uy)((0,ke.Go)("GET"));case 4:if(fe=x.sent,fe.code!=0){x.next=9;break}s({type:"set",data:fe.data.app_id}),x.next=11;break;case 9:return L.ZP.error(l.formatMessage({id:"createkb.creationFailed",defaultMessage:""})),x.abrupt("return");case 11:return I={app_id:i.app_id,name:w.name,description:w.description,public:ue,mode:M},x.next=14,(0,h._W)(I);case 14:me=x.sent,me.code==0?(L.ZP.success(l.formatMessage({id:"createkb.setupSuccess",defaultMessage:""})),setTimeout(function(){s({type:"next",data:"2"}),m(!1)},1e3)):(L.ZP.error(l.formatMessage({id:"createkb.settingFailed",defaultMessage:""})),m(!1));case 16:case"end":return x.stop()}},q)}));return function(){return de.apply(this,arguments)}}(),we=function(){var de=c()(a()().mark(function q(){var fe,I,me=arguments;return a()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return fe=me.length>0&&me[0]!==void 0?me[0]:1,x.next=3,(0,h.SH)({app_id:i.app_id,page:fe,page_size:10,name:""});case 3:I=x.sent,I.code==0&&(F(I.data.dataset_detail.is_public),ie(I.data.dataset_detail.mode),B(I.data.dataset_detail.embedding_model_config_id),T({name:I.data.dataset_detail.name,description:I.data.dataset_detail.description,nickname:I.data.dataset_detail.nickname}),xe(I.data.dataset_detail.embedding_model_config_id));case 5:case"end":return x.stop()}},q)}));return function(){return de.apply(this,arguments)}}(),xe=function(){var de=c()(a()().mark(function q(fe){var I;return a()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,h.Ue)(fe);case 2:I=E.sent,I.code==0&&X(I.data.data);case 4:case"end":return E.stop()}},q)}));return function(fe){return de.apply(this,arguments)}}();return(0,o.useEffect)(function(){i.app_id?(he(i.type?2:1),we()):(xe(0),T({name:i.name,description:i.description}),he(3))},[]),(0,e.jsx)(e.Fragment,{children:w!=null?(0,e.jsxs)("div",{className:"bg-white h-full flex flex-col w-full relative",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Q==2?(0,U.getLocale)()=="zh-CN"?w.nickname+l.formatMessage({id:"createkb.knowledge.base.of"}):l.formatMessage({id:"createkb.knowledge.base.of"})+w.nickname:Q==1?l.formatMessage({id:"createkb.editKB",defaultMessage:""}):l.formatMessage({id:"createkb.createKnowledgeBase",defaultMessage:""})})]}),(0,e.jsx)("div",{className:" pb-[30px] bg-white flex-1",children:(0,e.jsx)(le.Z,{className:"h-full",children:(0,e.jsxs)(Y.Z,{span:24,className:"flex flex-col justify-between",children:[(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:l.formatMessage({id:"createkb.settings",defaultMessage:""})}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsxs)(mt.Z,{layout:"vertical",children:[(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:l.formatMessage({id:"createkb.name",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:w.name}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:l.formatMessage({id:"createkb.desc",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:w.description}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:l.formatMessage({id:"createkb.teamVisible",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px]",children:(0,e.jsx)(Ue.Z,{onChange:_e,checked:ue===1,size:"small",disabled:i.type})}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:l.formatMessage({id:"createkb.modelSelect"})})]}),(0,e.jsx)("div",{className:"flex items-center mt-[15px]",children:(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)(Z.Z,{onClick:function(){Ce(1)},size:"small",className:M==1?"bg-[#FFFFFF]":"bg-[#F7F7F7]",style:{minWidth:"440px",cursor:i.type?"not-allowed":"pointer",borderColor:M==1?"#1B64F3":""},styles:{body:{padding:"15px"}},children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("p",{className:"pb-[15px] border-b border-[#EEEEEE] flex items-center",children:[(0,e.jsx)("img",{src:M==1?"/icons/online_select.svg":"/icons/online.svg",className:"w-4 h-4 "}),(0,e.jsx)("span",{className:M==1?"text-[#1B64F3] text-xs ml-[10px]":"text-[#213044] text-xs ml-[10px]",children:l.formatMessage({id:"createkb.apiEmbed"})})]}),(0,e.jsxs)("p",{className:"text-[#999999] mb-[10px]",children:[l.formatMessage({id:"createkb.vendor"}),": ",W==null?void 0:W.online.suppliers_name]}),(0,e.jsxs)("p",{className:"mb-0 text-[#999999]",children:[l.formatMessage({id:"createkb.modelName"}),": ",W==null?void 0:W.online.name]})]})}),(0,e.jsx)(Z.Z,{onClick:function(){Ce(2)},size:"small",className:M==2?"bg-[#FFFFFF] ml-5":"bg-[#F7F7F7] ml-5",style:{minWidth:"440px",cursor:i.type?"not-allowed":"pointer",borderColor:M==2?"#1B64F3":""},styles:{body:{padding:"15px"}},children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("p",{className:"pb-[15px] border-b border-[#EEEEEE] flex items-center",children:[(0,e.jsx)("img",{src:M==2?"/icons/local_select.svg":"/icons/local.svg",className:"w-4 h-4 "}),(0,e.jsx)("span",{className:M==2?"text-[#1B64F3] text-xs ml-[10px]":"text-[#213044] text-xs ml-[10px]",children:l.formatMessage({id:"createkb.localEmbed"})})]}),(0,e.jsxs)("p",{className:"text-[#999999] mb-[10px]",children:[l.formatMessage({id:"createkb.vendor"}),"\uFF1A -"]}),(0,e.jsxs)("p",{className:"mb-0 text-[#999999]",children:[l.formatMessage({id:"createkb.modelName"}),": ",W==null?void 0:W.local.name]})]})})]})})]}),(0,e.jsxs)("div",{className:"flex items-center mt-[60px]",children:[(0,e.jsx)(ee.ZP,{type:"primary",onClick:Fe,className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",disabled:i.type,style:{cursor:i.type?"not-allowed":""},children:l.formatMessage({id:"createkb.save.and.upload.document"})}),(0,e.jsx)(ee.ZP,{type:"primary",onClick:De,className:"ml-[20px] py-[10px] h-[40px] px-[15px] bg-[#ffffff] text-[#213044] text-[14px] leading-[20px] font-medium border border-[#979797]",children:l.formatMessage({id:"createkb.cancel"})})]})]})]})})}),O?(0,e.jsx)("div",{className:" absolute w-full h-full t-0 l-0 z-10 flex justify-center items-center",children:(0,e.jsx)(gt.Z,{size:"large"})}):""]}):""})},xt=ht,vt=n(19632),Ae=n.n(vt),bt=n(82061),We=n(40110),jt=n(85576),wt=n(38703),yt=n(78367),kt=yt.Z.Dragger,Mt=(0,o.forwardRef)(function(d,u){var i=d.fun,s=d.createkbInfo,l=d.fileList,r=l===void 0?[]:l,j=(0,U.useIntl)(),w=(0,o.useRef)(null);console.log("Upload component received fileList:",r.length,"files"),console.log("Upload fileList names:",r.map(function(O){return O.name}));var T=function(){w.current&&(w.current.fileList=[],w.current.upload&&(w.current.upload.fileList=[]),w.current.forceUpdate&&w.current.forceUpdate(),console.log("Upload component reset completed"))};(0,o.useImperativeHandle)(u,function(){return{reset:T}});var te={action:h.M$,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},timeout:3e5,fileList:r,onChange:function(m){var P=m.file.status;P==="uploading"&&console.log("Upload progress:",m.file.percent),P==="done"?L.ZP.success("".concat(m.file.name," ").concat(j.formatMessage({id:"createkb.upload.success"}))):P==="error"&&L.ZP.error("".concat(m.file.name," ").concat(j.formatMessage({id:"createkb.upload.error"}))),i(m)},beforeUpload:function(m){var P=m.size/1024/1024<15;if(!P)return L.ZP.error(j.formatMessage({id:"createkb.error.fileSize",defaultMessage:"File size cannot exceed 15MB"})),!1;var k=(m.size/1024/1024).toFixed(2),M="".concat(j.formatMessage({id:"createkb.upload.starting"})," ").concat(m.name,"\uFF0C").concat(j.formatMessage({id:"createkb.upload.fileSize"}),": ").concat(k,"MB");return L.ZP.info(M),P},customRequest:function(m){var P=m.action,k=m.file,M=m.onError,ie=m.onProgress,V=m.onSuccess,re=m.headers,ue=new FormData;ue.append("file",k);var F=new XMLHttpRequest;return F.timeout=3e5,F.open("post",typeof P=="function"?P(k):P,!0),re&&Object.keys(re).forEach(function(D){F.setRequestHeader(D,re[D])}),F.upload.addEventListener("progress",function(D){if(D.lengthComputable){var oe=Math.round(D.loaded/D.total*100);ie({percent:oe},k)}}),F.addEventListener("load",function(){if(F.status>=200&&F.status<300)try{var D=JSON.parse(F.response);V(D,k)}catch(X){var oe=j.formatMessage({id:"createkb.error.serverResponse"});M(new Error(oe),k)}else{var W="".concat(j.formatMessage({id:"createkb.error.httpStatus"})," ").concat(F.status);M(new Error(W),k)}}),F.addEventListener("error",function(){var D=j.formatMessage({id:"createkb.error.network"});M(new Error(D),k)}),F.addEventListener("timeout",function(){var D=j.formatMessage({id:"createkb.error.timeout"});M(new Error(D),k)}),F.addEventListener("abort",function(){var D=j.formatMessage({id:"createkb.error.cancelled"});M(new Error(D),k)}),F.send(ue),{abort:function(){F.abort()}}}},se=v()(v()({},te),{},{name:"file",multiple:!0,className:"h-[200px]",showUploadList:!1});return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(kt,v()(v()({},se),{},{ref:w,listType:"picture",className:"flex flex-col items-center justify-center custom-dragger mt-[15px]",accept:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv",disabled:s.type,children:(0,e.jsxs)("div",{className:"update p-[4px]",children:[(0,e.jsxs)("div",{className:"flex items-center w-full justify-center",children:[(0,e.jsx)("img",{src:"/icons/word.svg",className:"w-[42px] h-[42px] mx-3"}),(0,e.jsx)("img",{src:"/icons/txt.svg",className:"w-[42px] h-[42px] mx-3"}),(0,e.jsx)("img",{src:"/icons/pdf.svg",className:"w-[42px] h-[42px] mx-3"}),(0,e.jsx)("img",{src:"/icons/xlsx.svg",className:"w-[42px] h-[42px] mx-3"}),(0,e.jsx)("img",{src:"/icons/md.svg",className:"w-[42px] h-[42px] mx-3"})]}),(0,e.jsx)("div",{className:"mt-[10px] text-[#213044] text-sm",children:j.formatMessage({id:"createkb.instruction.dragOrClick",defaultMessage:"Drag files here or click to upload"})}),(0,e.jsx)("div",{className:"mt-[10px] text-[#999999] text-sm",children:j.formatMessage({id:"createkb.instruction.uploadLimit",defaultMessage:"Support batch upload, single file no more than 15MB"})})]})}))})}),Nt=Mt,$e=n(34994),St=n(52688),Et=n(86615),Je=n(31199),Ct=n(93967),Xe=n.n(Ct),Ft=n(98423),Qe=n(98065),Lt=n(53124),Tt=n(83559),Pt=n(83262);const qe=["wrap","nowrap","wrap-reverse"],et=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],tt=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Dt=(d,u)=>{const i=u.wrap===!0?"wrap":u.wrap;return{[`${d}-wrap-${i}`]:i&&qe.includes(i)}},_t=(d,u)=>{const i={};return tt.forEach(s=>{i[`${d}-align-${s}`]=u.align===s}),i[`${d}-align-stretch`]=!u.align&&!!u.vertical,i},Zt=(d,u)=>{const i={};return et.forEach(s=>{i[`${d}-justify-${s}`]=u.justify===s}),i};function Bt(d,u){return Xe()(Object.assign(Object.assign(Object.assign({},Dt(d,u)),_t(d,u)),Zt(d,u)))}var It=Bt;const Ot=d=>{const{componentCls:u}=d;return{[u]:{display:"flex","&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Rt=d=>{const{componentCls:u}=d;return{[u]:{"&-gap-small":{gap:d.flexGapSM},"&-gap-middle":{gap:d.flexGap},"&-gap-large":{gap:d.flexGapLG}}}},Ut=d=>{const{componentCls:u}=d,i={};return qe.forEach(s=>{i[`${u}-wrap-${s}`]={flexWrap:s}}),i},At=d=>{const{componentCls:u}=d,i={};return tt.forEach(s=>{i[`${u}-align-${s}`]={alignItems:s}}),i},$t=d=>{const{componentCls:u}=d,i={};return et.forEach(s=>{i[`${u}-justify-${s}`]={justifyContent:s}}),i},zt=()=>({});var Ht=(0,Tt.I$)("Flex",d=>{const{paddingXS:u,padding:i,paddingLG:s}=d,l=(0,Pt.mergeToken)(d,{flexGapSM:u,flexGap:i,flexGapLG:s});return[Ot(l),Rt(l),Ut(l),At(l),$t(l)]},zt,{resetStyle:!1}),Kt=function(d,u){var i={};for(var s in d)Object.prototype.hasOwnProperty.call(d,s)&&u.indexOf(s)<0&&(i[s]=d[s]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,s=Object.getOwnPropertySymbols(d);l<s.length;l++)u.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(d,s[l])&&(i[s[l]]=d[s[l]]);return i},Vt=o.forwardRef((d,u)=>{const{prefixCls:i,rootClassName:s,className:l,style:r,flex:j,gap:w,children:T,vertical:te=!1,component:se="div"}=d,O=Kt(d,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:m,direction:P,getPrefixCls:k}=o.useContext(Lt.E_),M=k("flex",i),[ie,V,re]=Ht(M),ue=te!=null?te:m==null?void 0:m.vertical,F=Xe()(l,s,m==null?void 0:m.className,M,V,re,It(M,d),{[`${M}-rtl`]:P==="rtl",[`${M}-gap-${w}`]:(0,Qe.n)(w),[`${M}-vertical`]:ue}),D=Object.assign(Object.assign({},m==null?void 0:m.style),r);return j&&(D.flex=j),w&&!(0,Qe.n)(w)&&(D.gap=w),ie(o.createElement(se,Object.assign({ref:u,className:F,style:D},(0,Ft.Z)(O,["justify","wrap","align"])),T))}),Gt=n(34041),ze=n(78045),Yt=n(96074),at=n(2487),Wt=n(58533),He="0",Ke="hit_count asc",Ve=1,st="",rt,nt,Jt=function(u){var i=u.item,s=u.fun,l=u.createkbInfo,r=(0,U.useIntl)(),j=[{title:r.formatMessage({id:"createkb.splitMode",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.charLimit",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.avgChar",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.sectionNum",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.totalRecall",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.embedTime",defaultMessage:""})+"\uFF1A",value:""},{title:r.formatMessage({id:"createkb.embedCost",defaultMessage:""})+"\uFF1A",value:""}],w=(0,o.useState)(!1),T=p()(w,2),te=T[0],se=T[1],O=(0,o.useState)([]),m=p()(O,2),P=m[0],k=m[1],M=(0,o.useState)(null),ie=p()(M,2),V=ie[0],re=ie[1],ue=function(){s("return")};function F(){return j.filter(function(z){return z.value!=null}).map(function(z){return(0,e.jsx)("div",{className:"mr-[40px]",children:(0,e.jsxs)("div",{className:"flex items-center grow shrink-0",children:[(0,e.jsx)("div",{className:"text-[#666666] text-[12px] leading-[17px] font-normal",children:z.title}),(0,e.jsx)("div",{className:"text-[#213044] text-[12px] leading-[17px] font-medium",children:z.value})]})},"".concat(z.title))})}var D=function(N){var ae=N.target.value;clearTimeout(rt),rt=setTimeout(function(){k([]),st=ae,X(1)},500)},oe=function(){Ve+=1,X(Ve)},W=function(){var z=c()(a()().mark(function N(ae,B){var ce;return a()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:ae?ce=(0,h.Rc)(B.id):ce=(0,h.U4)(B.id);case 1:case"end":return Q.stop()}},N)}));return function(ae,B){return z.apply(this,arguments)}}(),X=function(){var z=c()(a()().mark(function N(){var ae,B,ce=arguments;return a()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return ae=ce.length>0&&ce[0]!==void 0?ce[0]:1,Ve=ae,Q.next=4,(0,h.gD)({document_id:i.id,page:ae,page_size:10,hit_count:Ke,content:st,status:He});case 4:B=Q.sent,re(B.data),V==null&&(j[0].value=B.data.seg_set.seg_Mode,j[1].value=B.data.seg_set.seg_Len,j[2].value=B.data.seg_set.seg_Overlap,j[3].value=B.data.seg_set.seg_Avg,j[4].value=B.data.seg_set.seg_Num,j[5].value=B.data.seg_set.hit_Num,j[6].value=B.data.seg_set.Embedding_Time,j[7].value=B.data.seg_set.Embedding_Token,nt=F()),k(function(he){return[].concat(Ae()(he),Ae()(B.data.data))});case 8:case"end":return Q.stop()}},N)}));return function(){return z.apply(this,arguments)}}();return(0,o.useEffect)(function(){X()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"py-[30px] bg-white overflow-hidden w-full h-full flex flex-col",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"border-b  flex items-center pb-[30px]",children:[(0,e.jsx)("div",{className:"border-r mr-[10px] pr-[10px] cursor-pointer",onClick:ue,children:(0,e.jsx)("img",{src:"/icons/return.svg",className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("img",{src:"/icons/textIcon.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"text-[#213044] leading-[25px] text-[18px] font-medium ml-[5px]",children:i.name})]})]}),(0,e.jsx)("div",{className:"pt-[20px] pb-[15px] text-[#555555]  text-[14px] leading-[20px] font-medium",children:r.formatMessage({id:"createkb.docParams",defaultMessage:""})}),(0,e.jsx)("div",{className:"w-full border border-[#EEEEEE] rounded-lg p-[15px] bg-[#F7F7F7]",children:(0,e.jsx)(Vt,{wrap:!0,gap:"middle",align:"center",children:nt})}),(0,e.jsxs)("div",{className:"pt-[20px] pb-[15px] text-[#555555] text-[14px] leading-[20px] font-medium",children:[r.formatMessage({id:"createkb.docPara",defaultMessage:""})," ",V!=null?V.paging_information.total_count:""]}),(0,e.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,e.jsxs)("div",{className:"sticky-0 flex items-center",children:[(0,e.jsx)(Gt.Z,{defaultValue:"".concat(He),style:{width:114,height:32,background:"#F7F7F7"},onSelect:function(N){He=N,k([]),X(1)},options:[{value:"0",label:r.formatMessage({id:"createkb.all",defaultMessage:""})},{value:"1",label:r.formatMessage({id:"createkb.enabled",defaultMessage:""})},{value:"2",label:r.formatMessage({id:"createkb.disabled",defaultMessage:""})}]}),(0,e.jsx)(J.Z,{size:"large",placeholder:r.formatMessage({id:"createkb.search",defaultMessage:""}),prefix:(0,e.jsx)(We.Z,{className:"text-[#213044] opacity-30"}),onChange:D,className:"w-[300px] text-sm h-8 ml-5"})]}),(0,e.jsx)("div",{className:"flex-1 justify-end flex items-center",children:(0,e.jsxs)("div",{className:"flex items-center text-[#555555] text-[14px] leading-[20px] font-normal",children:[(0,e.jsxs)("span",{children:[r.formatMessage({id:"createkb.recallSort"}),"\uFF1A"]}),(0,e.jsxs)(ze.ZP.Group,{defaultValue:Ke,onChange:function(N){Ke=N.target.value,k([]),X(1)},size:"small",children:[(0,e.jsx)(ze.ZP,{value:"hit_count asc",children:r.formatMessage({id:"createkb.highToLow"})}),(0,e.jsx)(ze.ZP,{value:"hit_count desc",children:r.formatMessage({id:"createkb.lowToHigh"})})]})]})})]})]}),V!=null?(0,e.jsx)("div",{className:"overflow-y-auto flex-1 mt-4",id:"lists",children:(0,e.jsx)(Wt.Z,{dataLength:P.length,next:oe,hasMore:P.length<V.paging_information.total_count,loader:!1,endMessage:P.length<=0?"":(0,e.jsx)(Yt.Z,{plain:!0,children:r.formatMessage({id:"createkb.bottom"})}),scrollableTarget:"lists",children:(0,e.jsx)(at.Z,{dataSource:P,split:!1,renderItem:function(N){return(0,e.jsx)(at.Z.Item,{style:{padding:"0px"},children:(0,e.jsxs)("div",{className:"w-full rounded-lg bg-[#F7F7F7] p-[15px] mb-[15px]",children:[(0,e.jsxs)("div",{className:"w-full flex items-center",children:[(0,e.jsxs)("div",{className:"py-1 rounded-md px-2 border border-[#D8D8D8] flex items-center justify-center text-[#213044] text-sm",children:["#",N.segnum<=9?"00"+N.segnum:N.segnum<=99?"0"+N.segnum:N.segnum]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zishu.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:N.word_count})]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zh.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:N.hit_count})]}),(0,e.jsx)("div",{className:"ml-8 ",children:(0,e.jsx)(Ue.Z,{defaultChecked:N.status!=2,onChange:function(B){return W(B,N)},disabled:l.type,size:"small"},N.id)})]}),(0,e.jsx)("div",{className:"pt-5",children:(0,e.jsx)("span",{className:"text-[#213044] text-sm",children:N.content})})]})},N.id)}})})}):""]})})},Xt=Jt,Pe=1,lt,it="",Ge=null,Ye={split:!0,split_mode:"text",chunk_size:4e3,chunk_overlap:200},Qt=(0,o.memo)(function(d){var u=d.onFinish,i=d.isUploading,s=d.formValuesRef,l=d.intl,r=(0,o.useCallback)(function(w){return s.current=w,u(w)},[u,s]),j=(0,o.useCallback)(function(w,T){s.current=T},[s]);return(0,e.jsxs)($e.A,{submitter:{resetButtonProps:!1,searchConfig:{submitText:l.formatMessage({id:"createkb.uploadToKnowledgeBase",defaultMessage:""})}},onFinish:r,layout:"horizontal",initialValues:s.current,disabled:i,onValuesChange:j,preserve:!1,children:[(0,e.jsx)(St.Z,{name:"split",label:l.formatMessage({id:"createkb.splitContent",defaultMessage:""})}),(0,e.jsx)($e.A.Item,{noStyle:!0,dependencies:["split"],children:function(T){var te=T.getFieldValue;return te("split")?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Et.Z.Group,{label:l.formatMessage({id:"createkb.splitType",defaultMessage:""}),name:"split_mode",radioType:"button",fieldProps:{options:[{label:"text",value:"text"},{label:"markdown",value:"markdown"}]}}),(0,e.jsx)($e.A.Item,{noStyle:!0,dependencies:["split_mode"],children:function(O){var m=O.getFieldValue;return m("split_mode")==="text"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Je.Z,{label:l.formatMessage({id:"createkb.chunkSize",defaultMessage:""}),name:"chunk_size",min:200,max:8e3}),(0,e.jsx)(Je.Z,{label:l.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""}),name:"chunk_overlap",min:0,max:8e3})]}):null}})]}):null}})]})}),qt=function(u){var i=u.fun,s=u.createkbInfo,l=jt.Z.confirm,r=(0,U.useIntl)(),j=function(f,g,_,$,G,y){return(0,e.jsx)("div",{className:"mt-[10px] border border-[#EEEEEE] rounded-lg",children:(0,e.jsx)(je.Z,{columns:f,loading:g,dataSource:_,size:"middle",pagination:$,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:r.formatMessage({id:"createkb.no.data.available",defaultMessage:""})})})},onRow:function(Ie,K){return{onClick:function(){return G(Ie,K)},style:{cursor:"pointer"}}},onChange:y,rowKey:"id"})})},w=(0,o.useState)([]),T=p()(w,2),te=T[0],se=T[1],O=(0,o.useState)([]),m=p()(O,2),P=m[0],k=m[1],M=(0,o.useState)(null),ie=p()(M,2),V=ie[0],re=ie[1],ue=(0,o.useState)(!0),F=p()(ue,2),D=F[0],oe=F[1],W=(0,o.useState)(!0),X=p()(W,2),z=X[0],N=X[1],ae=(0,o.useState)(null),B=p()(ae,2),ce=B[0],Ne=B[1],Q=(0,o.useState)(1),he=p()(Q,2),Ce=he[0],_e=he[1],De=(0,o.useState)([]),Fe=p()(De,2),we=Fe[0],xe=Fe[1],de=(0,o.useState)(!1),q=p()(de,2),fe=q[0],I=q[1],me=(0,o.useRef)(Ye),E=(0,o.useRef)(null),x=function(){i({type:"next",data:"3"})},A=function(f){N(!0)},H=function(f){var g=Ae()(te);g[f]=!g[f],se(g)},R=function(){var b=c()(a()().mark(function f(g,_,$,G){var y,S;return a()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(y=null,g){K.next=7;break}return K.next=4,(0,h.LV)($.id);case 4:y=K.sent,K.next=10;break;case 7:return K.next=9,(0,h.OK)($.id);case 9:y=K.sent;case 10:y.code==0&&(S=P.map(function(be,Ee){return G==Ee&&(be.status=g?1:2),v()(v()({},be),{},{statusText:be.status==1?r.formatMessage({id:"createkb.normal",defaultMessage:""}):be.status==2?r.formatMessage({id:"createkb.disabled",defaultMessage:""}):r.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),k(S));case 11:case"end":return K.stop()}},f)}));return function(g,_,$,G){return b.apply(this,arguments)}}(),ve=function(){var b=c()(a()().mark(function f(g,_){return a()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:l({title:r.formatMessage({id:"createkb.deleteOperation",defaultMessage:""}),content:r.formatMessage({id:"createkb.confirmDelete",defaultMessage:"?"}),onOk:function(){var y=c()(a()().mark(function Ie(){var K;return a()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,(0,h.iH)(g);case 2:K=Ee.sent,K.code==0&&(Be(Pe),H(_));case 4:case"end":return Ee.stop()}},Ie)}));function S(){return y.apply(this,arguments)}return S}(),onCancel:function(){}});case 1:case"end":return G.stop()}},f)}));return function(g,_){return b.apply(this,arguments)}}(),ge=function(f){var g=f.target.value;clearTimeout(lt),lt=setTimeout(function(){it=g,Pe=1,Be()},500)},ct=function(f,g){Ne(f),N(!1)},Se=function(f){f&&f.stopPropagation&&f.stopPropagation()},Ze=[{title:r.formatMessage({id:"createkb.filename",defaultMessage:""}),dataIndex:"name",key:"name",ellipsis:!0,className:"max-w-48 text-[#213044] text-xs py-[15px]"},{title:r.formatMessage({id:"createkb.charCount",defaultMessage:""}),dataIndex:"word_count",key:"word_count",className:"max-w-48 w-24 text-[#213044] text-xs py-[15px]"},{title:r.formatMessage({id:"createkb.recallNum",defaultMessage:""}),dataIndex:"hit_count",key:"hit_count",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]"},{title:r.formatMessage({id:"createkb.uploadTime",defaultMessage:""}),dataIndex:"created_time",key:"created_time",className:"max-w-48 w-44 text-[#213044] text-xs py-[15px]",sorter:!0},{title:r.formatMessage({id:"createkb.status",defaultMessage:""}),dataIndex:"statusText",key:"statusText",className:"max-w-48 w-28 text-[#213044] text-xs py-[15px]",render:function(f,g,_){return(0,e.jsx)("div",{onClick:Se,children:(0,e.jsx)(Ue.Z,{className:g.status==2?"":"bg-[#1B64F3]",defaultChecked:g.status!=2,onChange:function(G){return R(G,f,g,_)},size:"small"},f)})}},{title:r.formatMessage({id:"createkb.action"}),dataIndex:"id",key:"id",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]",render:function(f,g,_){return(0,e.jsx)("div",{onClick:Se,children:(0,e.jsx)("img",{src:"/icons/delete.svg",className:"w-4 h-4",onClick:function(){ve(f,_)}})})}}],dt=function(){var b=c()(a()().mark(function f(g){var _,$;return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:console.log("getList called with:",g.fileList.length,"files"),console.log("File names:",g.fileList.map(function(S){return S.name})),console.log("File statuses:",g.fileList.map(function(S){return"".concat(S.name,": ").concat(S.status)})),_=g.fileList.some(function(S){return S.status==="uploading"}),I(_),$=g.fileList.some(function(S){return S.status==="error"}),$&&!_&&I(!1),xe(g.fileList);case 8:case"end":return y.stop()}},f)}));return function(g){return b.apply(this,arguments)}}(),Be=function(){var b=c()(a()().mark(function f(){var g,_,$,G,y,S=arguments;return a()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return g=S.length>0&&S[0]!==void 0?S[0]:1,_=S.length>1&&S[1]!==void 0?S[1]:Ge,oe(!0),$={app_id:s.app_id,page:g,page_size:10,name:it},K.next=6,(0,h.SH)($);case 6:G=K.sent,G.code==0&&(y=G.data.data.map(function(be,Ee){return v()(v()({},be),{},{statusText:be.status==1?r.formatMessage({id:"createkb.normal"}):be.status==2?r.formatMessage({id:"createkb.disabled"}):r.formatMessage({id:"createkb.deleted"})})}),k(y),re(G.data)),oe(!1);case 9:case"end":return K.stop()}},f)}));return function(){return b.apply(this,arguments)}}(),sa=function(f,g,_){Ge=_.order=="ascend"?"asc":_.order=="descend"?"desc":null,Pe=f.current,Be(Pe,Ge)},ra={total:V!=null?V.paging_information.total_count:0,current:Pe,hideOnSinglePage:!0};(0,o.useEffect)(function(){s.app_id&&(_e(s.type?2:1),Be())},[]);var na=(0,o.useCallback)(function(){var b=c()(a()().mark(function f(g){var _,$;return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(_=we.filter(function(S){return S.status==="done"&&S.response}),_.length!==0){y.next=4;break}return L.ZP.warning(r.formatMessage({id:"createkb.upload.selectFileFirst"})),y.abrupt("return");case 4:return y.prev=4,y.next=7,(0,h.H_)({app_id:s.app_id*1,file_ids:_.map(function(S){return S.response.data.file_id*1}),process_rule_id:1,data_source_type:1,text_split_config:v()(v()({},Ye),g)});case 7:$=y.sent,$.code==0?(xe([]),me.current=Ye,setTimeout(function(){var S;(S=E.current)===null||S===void 0||S.reset()},100),Be(Pe),L.ZP.success(r.formatMessage({id:"createkb.upload.addToKbSuccess",defaultMessage:"Files successfully added to knowledge base"})),console.log("Files cleared and component reset")):L.ZP.error(r.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"})),y.next=15;break;case 11:y.prev=11,y.t0=y.catch(4),console.error("Add document error:",y.t0),L.ZP.error(r.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"}));case 15:case"end":return y.stop()}},f,null,[[4,11]])}));return function(f){return b.apply(this,arguments)}}(),[we,s.app_id,r]),ut=function(f){xe(function(g){var _=g[f],$=g.filter(function(y,S){return S!==f});console.log("File deleted: ".concat(_==null?void 0:_.name," at index ").concat(f)),console.log("Remaining files:",$.map(function(y){return y.name})),console.log("File list length changed from ".concat(g.length," to ").concat($.length));var G=$.some(function(y){return y.status==="uploading"});return I(G),$})},la=function(){xe([]),I(!1),setTimeout(function(){var f;(f=E.current)===null||f===void 0||f.reset()},100),L.ZP.info(r.formatMessage({id:"createkb.upload.allFilesCleared",defaultMessage:"All files cleared"})),console.log("All files manually cleared")};return(0,e.jsx)(e.Fragment,{children:z?V!=null?(0,e.jsxs)("div",{className:"h-full bg-white w-full",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Ce==2?(0,U.getLocale)()=="zh-CN"?V.dataset_detail.nickname+r.formatMessage({id:"createkb.knowledge.base.of"}):r.formatMessage({id:"createkb.knowledge.base.of"})+V.dataset_detail.nickname:Ce==1?r.formatMessage({id:"createkb.editKB"}):r.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:r.formatMessage({id:"createkb.documentSettings"})}),(0,e.jsx)("div",{className:"text-[#555555] text-[12px] leading-[17px] font-medium pt-[30px]",children:r.formatMessage({id:"createkb.uploadDoc"})}),(0,e.jsx)(Nt,{ref:E,fun:dt,createkbInfo:s,fileList:we}),we.length>0&&(0,e.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg ",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("h4",{className:"text-base font-medium text-gray-700",children:r.formatMessage({id:"createkb.fileList",defaultMessage:""})}),(0,e.jsx)("button",{onClick:la,className:"text-xs text-red-500 hover:text-red-700 transition-colors px-2 py-1 border border-red-200 rounded hover:border-red-300",children:r.formatMessage({id:"createkb.upload.clearAll",defaultMessage:"Clear All"})})]}),(0,e.jsx)("ul",{className:"space-y-1",children:we.map(function(b,f){return(0,e.jsx)("li",{className:"flex items-center justify-between text-sm text-gray-600 bg-gray-50 p-3 rounded",children:(0,e.jsxs)("div",{className:"flex-1 mr-2",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("span",{className:"truncate font-medium",children:b.name}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[b.status==="uploading"&&(0,e.jsx)("button",{onClick:function(){b.xhr&&b.xhr.abort(),ut(f)},className:"text-gray-500 hover:text-gray-700 transition-colors text-xs",children:r.formatMessage({id:"createkb.upload.cancel"})}),(0,e.jsx)("button",{onClick:function(){return ut(f)},className:"text-red-500 hover:text-red-700 transition-colors","aria-label":"".concat(r.formatMessage({id:"createkb.deleteFile"})," ").concat(b.name),title:"".concat(r.formatMessage({id:"createkb.deleteFile"})," ").concat(b.name),children:(0,e.jsx)(bt.Z,{})})]})]}),b.status==="uploading"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)(wt.Z,{percent:Math.round(b.percent||0),size:"small",status:"active",strokeColor:"#1B64F3"}),(0,e.jsxs)("div",{className:"text-xs text-blue-500 font-medium",children:[r.formatMessage({id:"createkb.upload.progress"})," ",Math.round(b.percent||0),"%",b.size&&(0,e.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",(b.size/1024/1024).toFixed(2),"MB)"]})]})]}),b.status==="done"&&(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-green-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-green-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-green-600 font-medium whitespace-nowrap",children:r.formatMessage({id:"createkb.upload.complete"})})]}),b.status==="error"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-red-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-red-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-red-600 font-medium whitespace-nowrap",children:r.formatMessage({id:"createkb.upload.failed"})})]}),b.error&&(0,e.jsx)("div",{className:"text-xs text-red-500 mt-1",children:b.error.message||r.formatMessage({id:"createkb.error.unknown"})}),(0,e.jsx)("button",{onClick:function(){L.ZP.info(r.formatMessage({id:"createkb.instruction.retryUpload"}))},className:"text-xs text-blue-500 hover:text-blue-700",children:r.formatMessage({id:"createkb.upload.retry"})})]})]})},b.uid||f)})}),(0,e.jsx)(Qt,{onFinish:na,isUploading:fe,formValuesRef:me,intl:r})]}),(0,e.jsx)("div",{className:"flex justify-between pt-[30px]",children:(0,e.jsx)("span",{className:"text-[#213044] text-xs font-medium",children:r.formatMessage({id:"createkb.documentList"})})}),(0,e.jsx)("div",{className:"flex items-center w-full pt-[10px]",children:(0,e.jsx)(J.Z,{placeholder:r.formatMessage({id:"createkb.searchDoc"}),onChange:ge,className:"w-[782px] h-10 mr-5",prefix:(0,e.jsx)(We.Z,{})})}),j(Ze,D,P,ra,ct,sa),(0,e.jsx)("div",{className:"mt-[30px]",children:(0,e.jsx)(ee.ZP,{type:"primary",className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",onClick:x,children:r.formatMessage({id:"createkb.enterRecallTest"})})})]}):"":(0,e.jsx)(Xt,{fun:A,item:ce,createkbInfo:s})})},ea=qt,ot=function(){U.history.back()},ta=function(){var u=(0,U.useIntl)(),i=(0,o.useState)("1"),s=p()(i,2),l=s[0],r=s[1],j=(0,o.useState)((0,ke.Go)("GET")),w=p()(j,2),T=w[0],te=w[1],se=[{key:"1",icon:(0,e.jsx)(e.Fragment,{children:l=="1"?(0,e.jsx)("img",{src:"/icons/kb_setting_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/kb_setting.svg",className:"w-4 h-4 mr-[10px]"})}),label:u.formatMessage({id:"createkb.settings",defaultMessage:""}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:l=="1"?"#1B64F3":"#213044"}},{key:"2",icon:(0,e.jsx)(e.Fragment,{children:l=="2"?(0,e.jsx)("img",{src:"/icons/uptxt_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/uptxt.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:T.app_id?"1":"0.4"}})}),label:u.formatMessage({id:"createkb.documentSettings",defaultMessage:""}),disabled:!T.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:l=="2"?"#1B64F3":"#213044"}},{key:"3",icon:(0,e.jsx)(e.Fragment,{children:l=="3"?(0,e.jsx)("img",{src:"/icons/recall_test_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/recall_test.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:T.app_id?"1":"0.4"}})}),label:u.formatMessage({id:"createkb.recallTest",defaultMessage:""}),disabled:!T.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:l=="3"?"#1B64F3":"#213044"}}],O=function(k){k.type=="set"&&(T.app_id=k.data,te(T)),k.type=="return"&&ot(),k.type=="next"&&r(k.data)};function m(){var P=function(M){r(M.key)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"flex flex-col bg-white h-full",children:[(0,e.jsx)("div",{className:" bg-white pl-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)("div",{className:"w-full flex  justify-start",children:(0,e.jsxs)("div",{className:"cursor-pointer flex items-center",onClick:ot,children:[(0,e.jsx)(ee.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(ne.Z,{className:"text-[#1B64F3] w-4 h-4"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:u.formatMessage({id:"createkb.back",defaultMessage:""})})]})})}),(0,e.jsx)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)(Me.Z,{onClick:P,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[l],mode:"inline",items:se})})]})})}return(0,e.jsxs)("div",{className:"w-full flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"w-[300px] shrink-0",children:(0,e.jsx)(m,{})}),(0,e.jsx)("div",{className:"shrink-0 h-full overflow-y-auto bg-white overflow-x-auto",style:{width:"calc(100% - 300px)"},children:(0,e.jsx)("div",{className:"w-full h-full flex xl:justify-center justify-start flex-1",children:(0,e.jsx)("div",{className:"w-[900px] xl:px-0 px-[30px]",children:l=="1"?(0,e.jsx)(xt,{createkbInfo:T,fun:O}):l=="2"?(0,e.jsx)(ea,{createkbInfo:T,fun:O}):(0,e.jsx)(ft,{createkbInfo:T,fun:O})})})})]})},aa=ta},58533:function(Oe,ye,n){var pe=n(67294);var p=function(v,C){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,t){a.__proto__=t}||function(a,t){for(var c in t)t.hasOwnProperty(c)&&(a[c]=t[c])},p(v,C)};function ke(v,C){p(v,C);function a(){this.constructor=v}v.prototype=C===null?Object.create(C):(a.prototype=C.prototype,new a)}var ne=function(){return ne=Object.assign||function(C){for(var a,t=1,c=arguments.length;t<c;t++){a=arguments[t];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(C[h]=a[h])}return C},ne.apply(this,arguments)};function U(v,C,a,t){var c,h=!1,L=0;function le(){c&&clearTimeout(c)}function Y(){le(),h=!0}typeof C!="boolean"&&(t=a,a=C,C=void 0);function Z(){var J=this,je=Date.now()-L,e=arguments;if(h)return;function Te(){L=Date.now(),a.apply(J,e)}function Re(){c=void 0}t&&!c&&Te(),le(),t===void 0&&je>v?Te():C!==!0&&(c=setTimeout(t?Re:Te,t===void 0?v-je:v))}return Z.cancel=Y,Z}var ee={Pixel:"Pixel",Percent:"Percent"},Me={unit:ee.Percent,value:.8};function o(v){return typeof v=="number"?{unit:ee.Percent,value:v*100}:typeof v=="string"?v.match(/^(\d*(\.\d+)?)px$/)?{unit:ee.Pixel,value:parseFloat(v)}:v.match(/^(\d*(\.\d+)?)%$/)?{unit:ee.Percent,value:parseFloat(v)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),Me):(console.warn("scrollThreshold should be string or number"),Me)}var Le=function(v){ke(C,v);function C(a){var t=v.call(this,a)||this;return t.lastScrollTop=0,t.actionTriggered=!1,t.startY=0,t.currentY=0,t.dragging=!1,t.maxPullDownDistance=0,t.getScrollableTarget=function(){return t.props.scrollableTarget instanceof HTMLElement?t.props.scrollableTarget:typeof t.props.scrollableTarget=="string"?document.getElementById(t.props.scrollableTarget):(t.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},t.onStart=function(c){t.lastScrollTop||(t.dragging=!0,c instanceof MouseEvent?t.startY=c.pageY:c instanceof TouchEvent&&(t.startY=c.touches[0].pageY),t.currentY=t.startY,t._infScroll&&(t._infScroll.style.willChange="transform",t._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},t.onMove=function(c){t.dragging&&(c instanceof MouseEvent?t.currentY=c.pageY:c instanceof TouchEvent&&(t.currentY=c.touches[0].pageY),!(t.currentY<t.startY)&&(t.currentY-t.startY>=Number(t.props.pullDownToRefreshThreshold)&&t.setState({pullToRefreshThresholdBreached:!0}),!(t.currentY-t.startY>t.maxPullDownDistance*1.5)&&t._infScroll&&(t._infScroll.style.overflow="visible",t._infScroll.style.transform="translate3d(0px, "+(t.currentY-t.startY)+"px, 0px)")))},t.onEnd=function(){t.startY=0,t.currentY=0,t.dragging=!1,t.state.pullToRefreshThresholdBreached&&(t.props.refreshFunction&&t.props.refreshFunction(),t.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){t._infScroll&&(t._infScroll.style.overflow="auto",t._infScroll.style.transform="none",t._infScroll.style.willChange="unset")})},t.onScrollListener=function(c){typeof t.props.onScroll=="function"&&setTimeout(function(){return t.props.onScroll&&t.props.onScroll(c)},0);var h=t.props.height||t._scrollableNode?c.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!t.actionTriggered){var L=t.props.inverse?t.isElementAtTop(h,t.props.scrollThreshold):t.isElementAtBottom(h,t.props.scrollThreshold);L&&t.props.hasMore&&(t.actionTriggered=!0,t.setState({showLoader:!0}),t.props.next&&t.props.next()),t.lastScrollTop=h.scrollTop}},t.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:a.dataLength},t.throttledOnScrollListener=U(150,t.onScrollListener).bind(t),t.onStart=t.onStart.bind(t),t.onMove=t.onMove.bind(t),t.onEnd=t.onEnd.bind(t),t}return C.prototype.componentDidMount=function(){if(typeof this.props.dataLength=="undefined")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},C.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},C.prototype.componentDidUpdate=function(a){this.props.dataLength!==a.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},C.getDerivedStateFromProps=function(a,t){var c=a.dataLength!==t.prevDataLength;return c?ne(ne({},t),{prevDataLength:a.dataLength}):null},C.prototype.isElementAtTop=function(a,t){t===void 0&&(t=.8);var c=a===document.body||a===document.documentElement?window.screen.availHeight:a.clientHeight,h=o(t);return h.unit===ee.Pixel?a.scrollTop<=h.value+c-a.scrollHeight+1:a.scrollTop<=h.value/100+c-a.scrollHeight+1},C.prototype.isElementAtBottom=function(a,t){t===void 0&&(t=.8);var c=a===document.body||a===document.documentElement?window.screen.availHeight:a.clientHeight,h=o(t);return h.unit===ee.Pixel?a.scrollTop+c>=a.scrollHeight-h.value:a.scrollTop+c>=h.value/100*a.scrollHeight},C.prototype.render=function(){var a=this,t=ne({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),c=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),h=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return pe.createElement("div",{style:h,className:"infinite-scroll-component__outerdiv"},pe.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(L){return a._infScroll=L},style:t},this.props.pullDownToRefresh&&pe.createElement("div",{style:{position:"relative"},ref:function(L){return a._pullDown=L}},pe.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!c&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},C}(pe.Component);ye.Z=Le}}]);
