"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{86:function(ct,Fe,h){var $e=h(5574),E=h.n($e),Le=h(32332),ne=h(38703),Ze=h(67294),v=h(85893),pe=function(a){var te=a.subtitle,He=a.handleClick,le=a.lineClamp,Qe=le===void 0?2:le,X=a.textDetails,ve=a.title,Be=a.icon,De=a.iconType,Ie=De===void 0?"":De,Ae=a.operation,Ce=Ae===void 0?"":Ae,Se=a.progress,fe=a.status,Pe=a.backlogTips,Ee=(0,Ze.useState)(0),he=E()(Ee,2),Re=he[0],ke=he[1],ze=function(){ke(Se)},Ve=function(){ke(0)},Ue=function(e){return"rounded-[4px] border-l-[4px] ".concat(e==1?"border-[#1B64F3]":e==2?"border-[#52C41C]":"border-[#F04444]"," ")};return(0,v.jsxs)("div",{className:"flex  p-[10px] cursor-pointer overflow-hidden relative bg-[#fff] ".concat(fe!==void 0?Ue(fe):"graphicbox"),onClick:He,onMouseEnter:function(){Se!=null&&ze()},onMouseLeave:function(){Se!=null&&Ve()},children:[fe!==void 0&&(0,v.jsx)("div",{style:{width:"".concat(Re,"%"),transition:"width 0.5s "},className:"absolute bottom-0 left-0 top-0 bottom-0 h-full ".concat(fe==1?"bg-[#1B64F3]/[.03]":fe==2?"bg-[#52c41c]/[.05]":"bg-[#FAFAFA]"," ")}),(0,v.jsxs)("div",{className:"flex gap-x-[20px] w-full relative z-20",children:[(0,v.jsx)("div",{className:"shrink-0 flex gap-x-[7px] items-center",style:{fontSize:0},children:(0,v.jsxs)("div",{className:"w-[40px] h-[40px] rounded-[6px] flex items-center justify-center bg-[#F4F8F1] relative",children:[(0,v.jsx)("img",{src:(0,Le.s9)("single",Be),className:"w-[22px] h-[22px]"}),Ie&&(0,v.jsx)("div",{className:"w-[16px] h-[16px] absolute top-[28px] left-[28px] flex items-center justify-center bg-[#fff] rounded-[3px]",style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,v.jsx)("img",{src:"/icons/".concat(Ie,".svg"),alt:"",className:"w-[12px] h-[12px]"})})]})}),(0,v.jsx)("div",{className:"flex flex-1 min-w-0",children:(0,v.jsxs)("div",{className:"flex justify-center flex-col gap-y-[5px] flex-1 min-w-0",children:[(0,v.jsxs)("span",{className:"text-[12px] flex items-center",style:{color:"#213044"},children:[(0,v.jsx)("span",{className:"truncate",children:ve}),(0,v.jsx)("span",{className:"flex items-center flex-1",children:te})]}),(0,v.jsx)("span",{className:"text-[12px] max-w-full truncate",style:{color:"#999999"},children:X})]})}),Pe||(0,v.jsx)(v.Fragment,{}),Ce&&(0,v.jsx)("div",{className:"flex items-center w-[24px]",children:(0,v.jsx)("span",{className:"operation",children:Ce})}),Se!=null&&(0,v.jsx)("div",{className:"graphic_progress flex items-center pl-[30px]",children:(0,v.jsx)(ne.Z,{type:"circle",percent:Se,size:29})})]})]})};Fe.Z=pe},53885:function(ct,Fe,h){h.r(Fe),h.d(Fe,{default:function(){return Ia}});var $e=h(15009),E=h.n($e),Le=h(99289),ne=h.n(Le),Ze=h(5574),v=h.n(Ze),pe=h(43722),ye=h(32983),a=h(67294),te=h(35312),He=h(19632),le=h.n(He),Qe=h(97857),X=h.n(Qe),ve=h(32332),Be=h(82114),De=h(82826),Ie=h(63783),Ae=h(3471),Ce=h(45360),Se=h(85576),fe=h(28036),Pe=h(83062),Ee=h(72269),he=h(74330),Re=h(96486),ke=h(44010),ze=h(73445),Ve=h(782),Ue=(0,ze.Ue)((0,Ve.mW)(function(d,r){return{clearMemory:null,truncatable:!1,disableInput:!1,summaryParams:null,runsSummaryShow:!1,summaryClick:!0,setClearMemory:function(p){d({clearMemory:p})},setTruncatable:function(p){d({truncatable:p})},setDisableInput:function(p){d({disableInput:p})},setSummaryParams:function(p){d({summaryParams:p})},setRunsSummaryShow:function(p){d({runsSummaryShow:p})},setSummaryClick:function(p){console.log(p),d({summaryClick:p})}}})),Q=Ue,e=h(85893),ot=function(r){var n=(0,te.useIntl)(),p=r.roomDetail,N=r.setAgent,l=Ce.ZP.useMessage(),f=v()(l,2),m=f[0],M=f[1],g=(0,te.useParams)(),j=g.id,c=Q(function(s){return s.disableInput}),w=Q(function(s){return s.truncatable}),_=Q(function(s){return s.setClearMemory}),R=(0,a.useState)([]),O=v()(R,2),x=O[0],L=O[1],G=(0,a.useState)(X()({},p)),$=v()(G,2),t=$[0],Z=$[1],B=(0,a.useState)([]),K=v()(B,2),T=K[0],k=K[1],V=(0,a.useRef)(!1),ae=(0,a.useRef)(!1),W=(0,a.useState)(!1),U=v()(W,2),ee=U[0],H=U[1],P=function(){var i=Se.Z.confirm;i({title:n.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Be.Z,{}),content:n.formatMessage({id:"app.chatroom.clear.tips"}),okText:n.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:n.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){_(["TRUNCATE","0"])}})},S=function(){var s=ne()(E()().mark(function i(){var o;return E()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!j){y.next=5;break}return y.next=3,(0,pe.cH)({id:j});case 3:if(o=y.sent,o.code==0)try{Z(function(){return X()(X()({},o.data.chat_info),{},{max_round:o.data.max_round,smart_selection:o.data.smart_selection})}),L(o.data.agent_list),V.current=!0}catch(C){}case 5:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),ie=function(){var s=ne()(E()().mark(function i(){var o;return E()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,pe.j2)({id:j});case 2:o=y.sent,o.code==0&&(k(o.data.list),ae.current=!0);case 4:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),se=function(){var s=ne()(E()().mark(function i(o){var u,y,C;return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!j){I.next=11;break}if(u=o.active==1?0:1,u!=0){I.next=7;break}if(y=x.filter(function(z){return z.active==1}),y.length-1!=0){I.next=7;break}return m.open({type:"error",content:n.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),I.abrupt("return",!1);case 7:return I.next=9,(0,pe.sT)({active:u},j,o.agent_id);case 9:C=I.sent,C.code==0&&L(function(z){return z.map(function(oe){return X()(X()({},oe),{},{active:oe.agent_id==o.agent_id?u:oe.active})})});case 11:case"end":return I.stop()}},i)}));return function(o){return s.apply(this,arguments)}}(),ce=function(i){return i.length>6?i.length=6:i.lenth,i},q=function(i){i.type=="my_agent"?te.history.push("/Agents?app_id=".concat(i.app_id,"&type=false&from=chat_room")):te.history.push("/ReadOnlyAgent?app_id=".concat(i.app_id,"&type=true&from=chat_room"))},A=function(i){te.history.replace("/chat_room/".concat(i.chatroom_id)),window.location.reload()},J=function(){H(!0)},Y=function(){H(!1)},F=function(){var s=ne()(E()().mark(function i(o){var u,y,C;return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!(o.checkItem&&o.checkItem.length==0)){I.next=3;break}return m.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),I.abrupt("return");case 3:return u=le()(o.checkItem).map(function(z){var oe=z.agent_id,re=z.active,ue=re===void 0?1:re;return{agent_id:oe,active:ue}}),y={description:t.description,name:t.name,max_round:t.max_round},I.next=7,(0,pe.sI)(X()(X()({},y),{},{agent:u}),j);case 7:C=I.sent,C.code==0?(o.checkItem.map(function(z){z.active=z.active==null?1:z.active}),L(le()(o.checkItem)),N.current=le()(o.checkItem),m.open({type:"success",content:n.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):m.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return I.stop()}},i)}));return function(o){return s.apply(this,arguments)}}(),b=function(){var s=ne()(E()().mark(function i(){var o;return E()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return o=t.smart_selection==1?0:1,y.next=3,(0,pe.r5)({smart_selection:o},j);case 3:Z(function(C){return X()(X()({},C),{},{smart_selection:o})});case 4:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}();return(0,a.useEffect)(function(){S(),ie()},[]),(0,e.jsxs)(e.Fragment,{children:[M,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){te.history.go(-1)},children:[(0,e.jsx)(fe.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(De.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:n.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:t.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(Pe.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:n.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ie.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:n.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ee.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:t.smart_selection==1,onChange:b,disabled:c})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:V.current?(0,e.jsx)("div",{className:"flex flex-col",children:x&&x.length>0?x.map(function(s){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",s.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:s.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:s.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){q(s)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ee.Z,{size:"small",disabled:c,defaultChecked:!0,className:"w-[28px]",checked:s.active==1,onChange:function(){se(s)}})]})]},s.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:J,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:w&&!c?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Re.throttle)(function(){w&&!c&&P()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:n.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:ae.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:T&&T.length>0?T.map(function(s){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){A(s)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:s.name}),s.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:s.agent_list&&s.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[ce(s.agent_list).map(function(i,o){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",i.icon),alt:"",className:"w-[18px]  h-[18px]"})})},o)}),s.agent_list.length>=6?(0,e.jsx)(Ae.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},s.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})})]})]}),(0,e.jsx)(ke.Z,{show:ee,popupClose:Y,popupSave:F,checkList:x,zIndex:99})]})]})},ut=(0,a.memo)(ot),dt=h(13769),pt=h.n(dt),xt=h(47635),xe=h(1413),ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},mt=ft,Ne=h(91146),vt=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:mt}))},ht=a.forwardRef(vt),gt=ht,jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},yt=jt,St=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:yt}))},Nt=a.forwardRef(St),wt=Nt,_t=h(2068),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},Ct=bt,Rt=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:Ct}))},kt=a.forwardRef(Rt),Mt=kt,Xe=h(26915),Ft=h(20640),qe=h.n(Ft),ge=h(22683),je=h(97807),Dt=["node","className","children"],It=Xe.Z.TextArea,At=(0,a.memo)(function(d){var r=d.setInstruction,n=d.messageApi,p=d.isStop,N=d.scrollDomRef,l=d.upButtonDom,f=(0,te.useIntl)(),m=Q(function(O){return O.disableInput}),M=Q(function(O){return O.setDisableInput}),g=(0,a.useState)(""),j=v()(g,2),c=j[0],w=j[1],_=function(x){!x.shiftKey&&x.target.value==""&&(n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),w(""),x.preventDefault()),!x.shiftKey&&x.keyCode==13&&x.target.value!=""&&(M(!0),w(""),r(["INPUT",x.target.value]),x.preventDefault())},R=(0,Re.throttle)(function(){r(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:l,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(x){N.current.scrollTo({top:N.current.scrollHeight,behavior:"smooth"})},children:(0,e.jsx)(gt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(It,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:c,disabled:m,onChange:function(x){w(x.target.value)},onPressEnter:_,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(f.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),p?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:R,children:(0,e.jsx)(wt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(m||!c?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Re.throttle)(function(){if(m||!c)return!1;c||n.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),M(!0),r(["INPUT",c]),w("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),Pt=function d(r){return typeof r=="string"?r:Array.isArray(r)?r.map(d).join(""):a.isValidElement(r)?d(r.props.children):""},Et=function(r){return Pt(r)},We=function(r,n){return{code:function(N){var l=N.node,f=N.className,m=N.children,M=pt()(N,Dt),g=/language-(\w+)/.exec(f||"");if(g!=null&&g.length){var j=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:g[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var c=ne()(E()().mark(function w(_){var R;return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,R=_.currentTarget,x.next=4,qe()(Et(m));case 4:R&&(R.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){R&&(R.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(0),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},w,null,[[0,8]])}));return function(w){return c.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(j).concat(r),className:"p-4",children:m})})]})}else return(0,e.jsx)("code",X()(X()({},M),{},{children:m}))}}},et=(0,a.memo)(function(d){var r=d.messageApi,n=d.index,p=d.idName,N=d.cidName,l=(0,te.useIntl)(),f=(0,a.useState)(!1),m=v()(f,2),M=m[0],g=m[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){g(!0)},onMouseLeave:function(){g(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var j=ne()(E()().mark(function c(w){var _,R;return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return _=w.target.closest("#".concat(p).concat(n)),R=_.querySelector("#".concat(N).concat(n)),x.prev=2,x.next=5,qe()(R.innerText);case 5:r.open({type:"success",content:l.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(2),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},c,null,[[2,8]])}));return function(c){return j.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(M?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(M?" text-[#1B64F3]":"text-[#666]"),children:l.formatMessage({id:"app.chatroom.content.copy"})})]})})}),tt=function(r){var n=r.id,p=r.index,N=r.idName,l=r.cidName,f=(0,te.useIntl)(),m=Q(function(R){return R.setSummaryClick}),M=(0,a.useState)(!0),g=v()(M,2),j=g[0],c=g[1],w=Q(function(R){return R.summaryClick});(0,a.useEffect)(function(){c(w)},[w]);var _=Q(function(R){return R.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(j?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(O){if(j){var x=O.target.closest("#".concat(N).concat(p)),L=x.querySelector("#".concat(l).concat(p));_({id:n,message:L.innerText}),m(!1)}},children:[(0,e.jsx)(_t.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:f.formatMessage({id:"app.chatroom.content.summary"})})]})})},Ot=function(r){var n=r.roomid,p=(0,te.useIntl)(),N=Q(function(c){return c.setSummaryClick}),l=(0,a.useState)(!0),f=v()(l,2),m=f[0],M=f[1],g=Q(function(c){return c.summaryClick});(0,a.useEffect)(function(){M(g)},[g]);var j=Q(function(c){return c.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(m?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){m&&(j({id:n}),N(!1))},children:[(0,e.jsx)(Mt,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:p.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Tt=(0,a.memo)(function(d){var r=d.messageApi,n=d.setCurrentMessageContent,p=d.sendValue,N=d.agentList,l=d.scrollDomRef,f=d.upButtonDom,m=d.setIsStop,M=d.setisEnd,g=d.setSendValue,j=(0,te.useIntl)(),c=(0,te.useParams)(),w=c.id,_=Q(function(V){return V.setDisableInput}),R=(0,a.useState)({}),O=v()(R,2),x=O[0],L=O[1],G=(0,a.useRef)(!1),$=(0,a.useRef)(""),t=Q(function(V){return V.setTruncatable}),Z=function(ae){var W=ae.data;if(W.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var U=JSON.parse(W.slice(22,-2));switch(U[0]){case"ERROR":_(!1),m(!1),g(""),r.open({type:"error",content:"webSocket-".concat(U[1]),duration:10});break;case"CHAT":var ee={content:"".concat(U[1]),is_agent:0};n(function(S){return[].concat(le()(S),[ee])}),setTimeout(function(){l.current.scrollTop=l.current.scrollHeight,f.current.style.display="none"});break;case"STOPPABLE":m(U[1]);break;case"TRUNCATABLE":t(U[1]),U[1]||r.open({type:"success",content:"".concat(j.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":r.open({type:"success",content:"".concat(j.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(W.indexOf("REPLY")!==-1&&W.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var H=JSON.parse(W.slice(22,-2))[1];$.current="",G.current=!0;var P=N.current.filter(function(S){return S.agent_id==H})[0];Object.keys(x).length&&n(function(S){return[].concat(le()(S),[x])}),L(function(S){return X()(X()({},S),{},{is_agent:1,icon:P==null?void 0:P.icon,name:P==null?void 0:P.name})}),m(!0),t(!1)}W.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&G.current&&(l.current.scrollTop=l.current.scrollHeight,f.current.style.display="none",$.current+=W,L(function(S){return X()(X()({},S),{},{content:$.current})})),W.indexOf("ENDCHAT")!==-1&&(G.current=!1,$.current="",_(!1),m(!1),t(!0),Object.keys(x).length&&n(function(S){return[].concat(le()(S),[x])}),L({}),M(!0),g(""))},B=(0,xt.Z)("chat",Z),K=B.runSocket,T=B.sendMessage,k=B.readyState;return(0,a.useEffect)(function(){k==1&&w&&T(JSON.stringify(["ENTER",parseInt(w)]))},[k]),(0,a.useEffect)(function(){p&&k==1&&T(p)},[p]),(0,a.useEffect)(function(){K()},[]),(0,e.jsx)(e.Fragment,{children:x.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(x.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:x.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",x.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(x.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:x.name?x.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(x.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:x.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We("add",j),children:x.content})})})]})]}):(0,e.jsx)(e.Fragment,{})})}),$t=(0,a.memo)(function(d){var r=d.messageApi,n=d.setUserMessage,p=d.sendValue,N=d.agentList,l=d.scrollDomRef,f=d.upButtonDom,m=d.setIsStop,M=d.setSendValue,g=(0,te.useIntl)(),j=(0,a.useState)([]),c=v()(j,2),w=c[0],_=c[1],R=(0,a.useState)(!1),O=v()(R,2),x=O[0],L=O[1],G=(0,te.useParams)(),$=G.id;return(0,a.useEffect)(function(){x&&(n(function(t){return[].concat(le()(t),le()(w))}),_([]),setTimeout(function(){L(!1),l.current.scrollTop=l.current.scrollHeight},200))},[x]),(0,e.jsxs)(e.Fragment,{children:[w.length?w.map(function(t,Z){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(t.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:t.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",t.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(Z),children:[(0,e.jsx)("div",{className:"".concat(t.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:t.name?t.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(t.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:t.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(Z),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We(Z,g),children:t.content})})}),t.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:r,index:Z,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(tt,{id:$,index:Z,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},Z)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Tt,{messageApi:r,setCurrentMessageContent:_,sendValue:p,agentList:N,scrollDomRef:l,upButtonDom:f,setIsStop:m,setisEnd:L,setSendValue:M})]})}),Lt=(0,a.memo)(function(d){var r=d.messageApi,n=d.scrollDomRef,p=d.instruction,N=d.setIsStop,l=d.upButtonDom,f=d.setInstruction,m=d.agentList,M=(0,te.useIntl)(),g=(0,te.useParams)(),j=g.id,c=(0,a.useState)([]),w=v()(c,2),_=w[0],R=w[1],O=(0,a.useRef)(!1),x=(0,a.useState)(""),L=v()(x,2),G=L[0],$=L[1],t=(0,a.useRef)(null),Z=(0,a.useRef)(null),B=(0,a.useRef)(!0),K=(0,a.useRef)(2),T=(0,a.useRef)(1),k=(0,a.useRef)(0),V=function(){var H=ne()(E()().mark(function P(S){var ie,se,ce=arguments;return E()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(ie=ce.length>1&&ce[1]!==void 0?ce[1]:function(){},!j){A.next=6;break}return A.next=4,(0,pe.KH)(j,{page:T.current,page_size:20});case 4:se=A.sent,se.code==0&&(K.current=se.data.total_pages,R(function(J){return S?le()(se.data.list):[].concat(le()(se.data.list),le()(J))}),S?setTimeout(function(){n.current.scrollTop=n.current.scrollHeight,l.current.style.display="none"}):k.current=se.data.list.length);case 6:case"end":return A.stop()}},P)}));return function(S){return H.apply(this,arguments)}}(),ae=function(P){var S=P.target.scrollHeight-P.target.scrollTop-P.target.clientHeight;if(O.current!==Math.ceil(S)>50&&(O.current=Math.ceil(S)>50,l.current.style.display=O.current?"flex":"none"),P.target.scrollTop==0&&B.current){B.current=!1;var ie=t.current.firstChild;T.current=T.current+1,Z.current.style.display="flex",K.current,K.current>=T.current?V(!1):Z.current.style.display="none"}},W=function(P,S){S==="0"&&(S=Number(S));var ie=["".concat(P),S===0||S?S:null];$(JSON.stringify(ie))},U=Q(function(H){return H.disableInput}),ee=Q(function(H){return H.clearMemory});return(0,a.useEffect)(function(){ee&&ee.length&&W(ee[0],ee[1])},[ee]),(0,a.useEffect)(function(){p&&p.length&&(W(p[0],p[1]?p[1]:""),f([]))},[p]),(0,a.useEffect)(function(){k.current&&t.current.children[k.current]&&(n.current.scrollTop=t.current.children[k.current].offsetTop,B.current=!0)},[_]),(0,a.useEffect)(function(){T.current=1,V(!0)},[]),(0,e.jsxs)("div",{className:"flex-1 box-border relative overflow-y-auto chatroom overflow-x-hidden",ref:n,onScroll:ae,children:[(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:Z,children:(0,e.jsx)(he.Z,{})}),(0,e.jsxs)("div",{className:"max-w-[920px] mx-auto",style:{minHeight:"calc(100% - 50px)"},ref:t,children:[_.map(function(H,P){return(0,e.jsxs)("div",{id:"c".concat(H.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(H.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:H.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",H.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(P),children:[(0,e.jsx)("div",{className:"".concat(H.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:H.name?H.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(H.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:H.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(P),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We(P,M),children:H.content})})}),H.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:r,idName:"content",cidName:"chilContent",index:P}),(0,e.jsx)(tt,{id:j,index:P,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},P)}),(0,e.jsx)($t,{messageApi:r,setUserMessage:R,sendValue:G,agentList:m,scrollDomRef:n,upButtonDom:l,setIsStop:N,setSendValue:$})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!U&&_.length?(0,e.jsx)(Ot,{roomid:j}):(0,e.jsx)(e.Fragment,{})})]})}),Zt=(0,a.memo)(function(d){var r=d.agentList,n=(0,a.useRef)(null),p=(0,a.useRef)(null),N=(0,a.useState)(!1),l=v()(N,2),f=l[0],m=l[1],M=(0,a.useState)([]),g=v()(M,2),j=g[0],c=g[1],w=Ce.ZP.useMessage(),_=v()(w,2),R=_[0],O=_[1];return(0,e.jsxs)(e.Fragment,{children:[O,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px]   overflow-auto",style:{height:"calc(100% )"},children:(0,e.jsxs)("div",{className:"flex flex-col w-full",children:[(0,e.jsx)(Lt,{instruction:j,setInstruction:c,messageApi:R,scrollDomRef:n,setIsStop:m,upButtonDom:p,agentList:r}),(0,e.jsx)(At,{setInstruction:c,messageApi:R,isStop:f,upButtonDom:p,scrollDomRef:n})]})})]})}),Ht=h(42881),Bt=function(r){var n=r.children,p=r.className,N=p===void 0?"":p,l=r.dragDirection,f=l===void 0?"left":l,m=r.minWidth,M=m===void 0?415:m,g=r.maxWidth,j=g===void 0?820:g,c=r.minHeight,w=c===void 0?200:c,_=r.maxHeight,R=_===void 0?800:_,O=r.defaultWidth,x=O===void 0?415:O,L=r.defaultHeight,G=L===void 0?300:L,$=(0,a.useState)(x),t=v()($,2),Z=t[0],B=t[1],K=(0,a.useState)(G),T=v()(K,2),k=T[0],V=T[1],ae=(0,a.useCallback)(function(H,P){B(H),P&&V(P)},[B,V]),W=(0,Ht.W)({direction:["left","right"].includes(f)?"horizontal":"vertical",triggerDirection:f,minWidth:M,maxWidth:j,minHeight:w,maxHeight:R,onResize:ae}),U=W.triggerRef,ee=W.containerRef;return(0,e.jsxs)("div",{ref:ee,style:{width:["left","right"].includes(f)?"".concat(Z,"px"):void 0,height:["top","bottom"].includes(f)?"".concat(k,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(N),children:[f==="left"&&(0,e.jsx)("div",{ref:U,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),f==="right"&&(0,e.jsx)("div",{ref:U,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),f==="top"&&(0,e.jsx)("div",{ref:U,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),f==="bottom"&&(0,e.jsx)("div",{ref:U,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),n]})},zt=(0,a.memo)(Bt),Vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Ut=Vt,Wt=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:Ut}))},Gt=a.forwardRef(Wt),Kt=Gt,Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Yt=Jt,Qt=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:Yt}))},Xt=a.forwardRef(Qt),qt=Xt,ea=h(83159),ta={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},aa=ta,ra=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:aa}))},na=a.forwardRef(ra),sa=na,Oe=h(86),at=h(34994),rt=h(2216),ia=h(85877),la=h(29432),ca=h(39944),oa=h(11551),Ge=h(55927),ua=function(r){var n,p,N,l=r.selectApp,f=r.runid,m=r.setBoxLoading,M=r.setinputShow,g=r.appId,j=r.id,c=r.setisRun,w=(0,te.useIntl)(),_=(0,a.useRef)(""),R=(0,a.useRef)(""),O=(0,a.useRef)(null),x=(0,a.useState)(""),L=v()(x,2),G=L[0],$=L[1],t=(0,a.useState)(null),Z=v()(t,2),B=Z[0],K=Z[1],T=(0,a.useState)([]),k=v()(T,2),V=k[0],ae=k[1],W=(0,a.useState)(""),U=v()(W,2),ee=U[0],H=U[1],P=(0,Ge.Z)(function(q){return q.flowMessage}),S=function(A){R.current=ie(A);var J={user:{value:ie(A)}};H(new ca.z(J))},ie=function q(A){return A.map(function(J){return J.type==="mention"?J.id:J.children?q(J.children):J.text}).join("")},se=function(){var q=ne()(E()().mark(function A(J){var Y,F;return E()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return m(!0),Y=Object.keys(J),Y.forEach(function(i){O.current.properties[i]&&(O.current.properties[i].value=J[i])}),s.next=5,(0,oa.LH)({agent_id:l.checkItem[0].agent_id,ability_id:0,input_dict:O.current,prompt:ee,data_source_run_id:_.current});case 5:F=s.sent,F.code==0&&($(F.data.outputs_md),m(!1),c(!1));case 7:case"end":return s.stop()}},A)}));return function(J){return q.apply(this,arguments)}}(),ce=function(){var q=ne()(E()().mark(function A(J,Y){var F,b;return E()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,pe.xT)(J,Y);case 2:F=i.sent,(F==null?void 0:F.code)==0&&(_.current=F==null||(b=F.data)===null||b===void 0?void 0:b.app_run_id);case 4:case"end":return i.stop()}},A)}));return function(J,Y){return q.apply(this,arguments)}}();return(0,a.useEffect)(function(){l&&l.checkItem.length&&(c(!0),ce(j,{app_id:g,app_run_id:f,status:1,corrected_parameter:""}))},[l]),(0,a.useEffect)(function(){var q=P.filter(function(s){return s.data.app_run_id==f&&s.type.indexOf("generate_meeting_action_items")!==-1});if(q.length!=0){var A,J=(A=q[q.length-1])===null||A===void 0||(A=A.data)===null||A===void 0||(A=A.exec_data)===null||A===void 0||(A=A.outputs)===null||A===void 0?void 0:A.value;if(J){var Y=JSON.parse(J);O.current=Y;var F=Object.keys(Y.properties);if(F.length){K(Y.properties);var b=F.map(function(s){return{value:"<<".concat(la.qX,".inputs.").concat(s,">>"),label:s}});ae(b)}M(!1),m(!1)}}},[P]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:l==null||(n=l.checkItem[0])===null||n===void 0?void 0:n.icon,title:l==null||(p=l.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:l==null||(N=l.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"robot_icon",handleClick:function(){}})}),B!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!R.current},searchConfig:{submitText:w.formatMessage({id:"workflow.button.run"})}},onFinish:function(A){se(A)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(rt._,{data:B})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ia.Z,{onChange:function(A){S(A)},options:V,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),G?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:G})})}):(0,e.jsx)(e.Fragment,{})]})},da=(0,a.memo)(ua),pa=h(66309),nt=h(42237),xa=h(93696),fa=function(r,n){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},r),{},{ref:n,icon:xa.Z}))},ma=a.forwardRef(fa),va=ma,ha=h(4981),Ke=h(29608),ga=(0,a.memo)(function(d){var r=d.progressObj,n=function(){return parseFloat(r.elapsed_time).toFixed(6)},p=function(l){var f=new Date(l),m=f.getFullYear(),M=(f.getMonth()+1).toString().padStart(2,"0"),g=f.getDate().toString().padStart(2,"0"),j=f.getHours().toString().padStart(2,"0"),c=f.getMinutes().toString().padStart(2,"0"),w=f.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(m,".").concat(M,".").concat(g," ").concat(j,":").concat(c,":").concat(w)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:r.created_time&&p(r.created_time)}),(0,e.jsx)("div",{className:"truncate",children:r.apps_name||r.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(r.status==1?"bg-blue-600":r.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[n(),"S"]})]})]})})}),ja=function(r){var n,p,N,l=r.selectApp,f=r.runid,m=r.setBoxLoading,M=r.setinputShow,g=r.appId,j=r.id,c=r.setisRun,w=(0,te.useIntl)(),_=(0,a.useRef)(""),R=(0,a.useRef)(null),O=(0,a.useState)(null),x=v()(O,2),L=x[0],G=x[1],$=(0,a.useState)(!1),t=v()($,2),Z=t[0],B=t[1],K=(0,a.useState)(null),T=v()(K,2),k=T[0],V=T[1],ae=(0,a.useState)(null),W=v()(ae,2),U=W[0],ee=W[1],H=(0,a.useState)(null),P=v()(H,2),S=P[0],ie=P[1],se=(0,Ke.Z)(function(i){return i.setDealtWithData}),ce=(0,Ke.Z)(function(i){return i.setRunPanelLogRecord}),q=function(){var i=ne()(E()().mark(function o(u){var y,C,D,I,z;return E()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return m(!0),y=Object.keys(u),C={},y.forEach(function(ue){R.current.properties[ue]&&(R.current.properties[ue].value=u[ue]),U&&U.forEach(function(me){me.node_id==ue&&(C[ue]=u[ue])})}),D={inputs:R.current,node_confirm_users:C,run_name:"chatroom-".concat(j,"-run-").concat(_.current,"-driven"),run_type:1,data_source_run_id:_.current},re.next=7,(0,nt.UE)(g,D);case 7:I=re.sent,I.code==0&&(_.current=I==null||(z=I.data)===null||z===void 0?void 0:z.app_run_id,B(!0),c(!1));case 9:case"end":return re.stop()}},o)}));return function(u){return i.apply(this,arguments)}}(),A=function(){var i=ne()(E()().mark(function o(){var u,y;return E()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:u=s==null?void 0:s.filter(function(I){return I.type=="workflow_run_progress"&&I.data.app_run_id==_.current}).map(function(I){var z=I.data;return z}),u&&u.length&&(y=u[u.length-1],G(y),m(!1));case 2:case"end":return D.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),J=function(){var i=ne()(E()().mark(function o(){var u,y,C,D,I;return E()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:y=s==null?void 0:s.filter(function(re){return re.type=="workflow_need_human_confirm"&&re.data.app_run_id==_.current}),C=(u=y.map(function(re){var ue=re.data,me=re.need_human_confirm;return{data:ue,need_human_confirm:me}}))===null||u===void 0?void 0:u.filter(function(re){return re.data.type!==1}),C&&C.length&&(I=C[C.length-1].data,I.exec_id=I==null||(D=I.node_exec_data)===null||D===void 0?void 0:D.node_exec_id,ie(C[C.length-1]),m(!1));case 3:case"end":return oe.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),Y=function(o){return o.completed_progress?parseInt(o.completed_progress.slice(0,-1)):!1},F=function(){var i=ne()(E()().mark(function o(u,y){var C,D;return E()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,(0,pe.xT)(u,y);case 2:C=z.sent,(C==null?void 0:C.code)==0&&(_.current=C==null||(D=C.data)===null||D===void 0?void 0:D.app_run_id);case 4:case"end":return z.stop()}},o)}));return function(u,y){return i.apply(this,arguments)}}(),b=function(){var i=ne()(E()().mark(function o(){var u,y;return E()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return console.log(g),D.next=3,(0,nt.zO)(g);case 3:u=D.sent,u.code==0&&ee(u==null||(y=u.data)===null||y===void 0?void 0:y.need_confirm_nodes),F(j,{app_id:g,app_run_id:f,status:1,corrected_parameter:""});case 6:case"end":return D.stop()}},o)}));return function(){return i.apply(this,arguments)}}();(0,a.useEffect)(function(){l&&l.checkItem.length&&(c(!0),b())},[l]);var s=(0,Ge.Z)(function(i){return i.flowMessage});return(0,a.useEffect)(function(){A(),J();var i=s.filter(function(D){return D.data.app_run_id==f&&D.type.indexOf("generate_meeting_action_items")!==-1});if(i.length!=0){var o,u=(o=i[i.length-1])===null||o===void 0||(o=o.data)===null||o===void 0||(o=o.exec_data)===null||o===void 0||(o=o.outputs)===null||o===void 0?void 0:o.value;if(u){var y=JSON.parse(u);R.current=y;var C=Object.keys(y.properties);C.length&&(console.log(y.properties),V(y.properties)),M(!1),m(!1)}}},[s]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:l==null||(n=l.checkItem[0])===null||n===void 0?void 0:n.icon,title:l==null||(p=l.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:l==null||(N=l.checkItem[0])===null||N===void 0?void 0:N.description,iconType:"workflow_icon",handleClick:function(){}})}),!Z&&k!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:w.formatMessage({id:"workflow.button.run"})}},onFinish:q,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(rt._,{data:k})}),(0,e.jsx)(ha.e,{data:U})]}):(0,e.jsx)(e.Fragment,{children:k!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[w.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(k).map(function(i){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:i.display_name||i.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:i.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),S&&S.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){se(S.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(va,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:w.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),L?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Oe.Z,{status:L.status,icon:L.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:L.run_name}),L.need_human_confirm==1?(0,e.jsx)(pa.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:w.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(ga,{progressObj:L}),handleClick:function(){ce(L)},progress:Y(L)})}):(0,e.jsx)(e.Fragment,{})]})},ya=(0,a.memo)(ja),Sa=function(r){var n,p,N,l=(0,te.useIntl)(),f=r.runid,m=r.id,M=r.setBoxLoading,g=r.scrollDom,j=r.setinputShow,c=(0,a.useRef)("agent"),w=(0,a.useRef)(""),_=(0,a.useState)(!1),R=v()(_,2),O=R[0],x=R[1],L=(0,a.useState)({type:"agent",checkItem:[],show:!1}),G=v()(L,2),$=G[0],t=G[1],Z=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(k){return X()(X()({},k),{},{type:"agent",show:!0})})},children:l.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(k){return X()(X()({},k),{},{type:"workflow",show:!0})})},children:l.formatMessage({id:"app.summary.SelectWorkflow"})})}],B=function(){t(function(k){return X()(X()({},k),{},{show:!1})})},K=function(k){M(!0),t(function(V){return X()(X()({},V),{},{checkItem:k.checkItem})}),c.current=$.type,w.current=k.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:$!=null&&(n=$.checkItem)!==null&&n!==void 0&&n.length?g==null||(p=g.current)===null||p===void 0?void 0:p.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:l.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:O?(0,e.jsx)(ea.Z,{menu:{items:Z},children:(0,e.jsx)(sa,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:$!=null&&(N=$.checkItem)!==null&&N!==void 0&&N.length?(0,e.jsx)(e.Fragment,{children:c.current=="agent"?(0,e.jsx)(da,{id:m,appId:w.current,selectApp:$,runid:f,setBoxLoading:M,scrollDom:g,setinputShow:j,setisRun:x}):(0,e.jsx)(ya,{id:m,appId:w.current,selectApp:$,runid:f,setBoxLoading:M,scrollDom:g,setinputShow:j,setisRun:x})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(k){return X()(X()({},k),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),l.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(k){return X()(X()({},k),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),l.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(ke.Z,{show:$.show,nodetype:$.type,popupClose:B,popupSave:K,checkList:c.current==$.type?$.checkItem:[],zIndex:99,radio:!0})]})},Na=(0,a.memo)(Sa),st=h(87740),it=(0,a.memo)(function(d){var r=d.id,n=d.message,p=(0,te.useIntl)(),N=Q(function(c){return c.setSummaryClick}),l=(0,a.useState)(!0),f=v()(l,2),m=f[0],M=f[1],g=Q(function(c){return c.summaryClick}),j=Q(function(c){return c.setSummaryParams});return(0,a.useEffect)(function(){M(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(w){m&&(j({id:r,message:n}),N(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(st.Z,{className:"text-[14px]"})]})})}),wa=function(r){var n,p,N,l,f=r.setShow,m=r.inputShow,M=r.setBoxLoading,g=r.setAppRunId,j=r.scrollDom,c=(0,te.useIntl)(),w=(0,a.useState)(!1),_=v()(w,2),R=_[0],O=_[1],x=(0,a.useState)(""),L=v()(x,2),G=L[0],$=L[1],t=(0,a.useState)(""),Z=v()(t,2),B=Z[0],K=Z[1],T=(0,a.useRef)(""),k=(0,a.useRef)(""),V=(0,a.useRef)(!1),ae=(0,a.useState)(!1),W=v()(ae,2),U=W[0],ee=W[1],H=(0,a.useState)(null),P=v()(H,2),S=P[0],ie=P[1],se=Q(function(b){return b.setSummaryClick}),ce=function(){var b=ne()(E()().mark(function s(i){var o,u,y,C,D=arguments;return E()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return o=D.length>1&&D[1]!==void 0?D[1]:{app_run_id:"",corrected_parameter:""},z.next=3,(0,pe.Rp)(i,o);case 3:u=z.sent,(u==null?void 0:u.code)==0&&(g(u==null||(y=u.data)===null||y===void 0?void 0:y.app_run_id),k.current=u==null||(C=u.data)===null||C===void 0?void 0:C.app_run_id,o.app_run_id&&(V.current=!0));case 5:case"end":return z.stop()}},s)}));return function(i){return b.apply(this,arguments)}}(),q=function(){var b=ne()(E()().mark(function s(i,o){var u,y,C,D,I;return E()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,(0,pe.xM)(i,{message:o});case 2:u=oe.sent,(u==null?void 0:u.code)==0&&(k.current=u==null||(y=u.data)===null||y===void 0?void 0:y.app_run_id,g(u==null||(C=u.data)===null||C===void 0?void 0:C.app_run_id),u!=null&&(D=u.data)!==null&&D!==void 0&&(D=D.outputs)!==null&&D!==void 0&&D.value&&($(u==null||(I=u.data)===null||I===void 0||(I=I.outputs)===null||I===void 0?void 0:I.value),f(!0),M(!1),se(!0)));case 4:case"end":return oe.stop()}},s)}));return function(i,o){return b.apply(this,arguments)}}(),A=function(){var b=ne()(E()().mark(function s(){var i;return E()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,pe.Gh)({chatroom_id:T.current,app_run_id:k.current});case 2:i=u.sent,i&&i!==null&&i!==void 0&&i.data&&ie(i.data);case 4:case"end":return u.stop()}},s)}));return function(){return b.apply(this,arguments)}}(),J=function(s){var i=new Date(s),o=i.getMonth()+1,u=i.getDate(),y=i.getHours(),C=i.getMinutes(),D=i.getSeconds();return i.getFullYear()+"-"+(o<10?"0"+o:o)+"-"+(u<10?"0"+u:u)+" "+(y<10?"0"+y:y)+":"+(C<10?"0"+C:C)+":"+(D<10?"0"+D:D)},Y=(0,Ge.Z)(function(b){return b.flowMessage});(0,a.useEffect)(function(){var b=Y.filter(function(o){return o.data.app_run_id==k.current&&o.type.indexOf("generate_meeting_summary")!==-1});if(b.length!=0){var s,i=(s=b[b.length-1])===null||s===void 0||(s=s.data)===null||s===void 0||(s=s.exec_data)===null||s===void 0||(s=s.outputs)===null||s===void 0?void 0:s.value;i&&(V.current&&A(),$(i),ee(!1),f(!0),se(!0),M(!1))}},[Y]);var F=Q(function(b){return b.summaryParams});return(0,a.useEffect)(function(){F&&F.id&&(T.current=F.id,S&&ie(null),U&&ee(!1),G&&$(""),O(!0),F.message?(M(!0),q(F.id,F.message)):ce(F.id))},[F]),(0,e.jsx)(e.Fragment,{children:R?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:c.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:G?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:S?S==null||(n=S.source_run)===null||n===void 0?void 0:n.summary:G})}),S&&(S==null||(p=S.source_corrections)===null||p===void 0?void 0:p.length)>0||!m?(0,e.jsx)(it,{id:T.current,message:S?S==null||(N=S.source_run)===null||N===void 0?void 0:N.summary:G}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(he.Z,{size:"large"})})}),S&&(S==null||(l=S.source_corrections)===null||l===void 0?void 0:l.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[c.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),S.source_corrections.map(function(b,s){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(S.source_corrections.length-1==s?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[c.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",b.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[c.formatMessage({id:"app.summaryhistory.time"}),": ",J(b.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:b==null?void 0:b.corrected_summary})]})},b.created_time),!m||S.source_corrections.length-1!=s?(0,e.jsx)(it,{id:T.current,message:b==null?void 0:b.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},b.created_time)})]}):(0,e.jsx)(e.Fragment,{}),m?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Xe.Z.TextArea,{onChange:function(s){K(s.target.value)},value:B,disabled:!G||U,rows:4,placeholder:c.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(fe.ZP,{type:"primary",disabled:!G||!B,loading:U,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){ce(T.current,{app_run_id:String(k.current),corrected_parameter:B}),ee(!0),K(""),f("")},children:c.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},_a=(0,a.memo)(wa),ba=(0,a.memo)(function(d){var r=d.progressObj;console.log(r);var n=function(){return parseFloat(r.elapsed_time).toFixed(6)},p=function(l){var f=new Date(l),m=f.getFullYear(),M=(f.getMonth()+1).toString().padStart(2,"0"),g=f.getDate().toString().padStart(2,"0"),j=f.getHours().toString().padStart(2,"0"),c=f.getMinutes().toString().padStart(2,"0"),w=f.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(m,".").concat(M,".").concat(g," ").concat(j,":").concat(c,":").concat(w)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:r.created_time&&p(r.created_time)}),(0,e.jsx)("div",{className:"truncate",children:r.apps_name||r.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(r.status==1?"bg-blue-600":r.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[n(),"S"]})]})]})})}),lt=(0,a.memo)(function(d){var r=d.id,n=d.message,p=(0,te.useIntl)(),N=Q(function(c){return c.setSummaryClick}),l=(0,a.useState)(!0),f=v()(l,2),m=f[0],M=f[1],g=Q(function(c){return c.summaryClick}),j=Q(function(c){return c.setSummaryParams});return(0,a.useEffect)(function(){M(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(w){m&&(j({id:r,message:n}),N(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(st.Z,{className:"text-[14px]"})]})})}),Ca=function(r){var n=r.list,p=r.scrollDom,N=r.historyHeight,l=r.id,f=r.runid,m=(0,te.useIntl)(),M=(0,a.useState)([]),g=v()(M,2),j=g[0],c=g[1],w=(0,a.useRef)("100%"),_=(0,a.useState)(0),R=v()(_,2),O=R[0],x=R[1],L=(0,Ke.Z)(function(t){return t.setRunPanelLogRecord}),G=function(Z){var B=new Date(Z),K=B.getMonth()+1,T=B.getDate(),k=B.getHours(),V=B.getMinutes(),ae=B.getSeconds();return B.getFullYear()+"-"+(K<10?"0"+K:K)+"-"+(T<10?"0"+T:T)+" "+(k<10?"0"+k:k)+":"+(V<10?"0"+V:V)+":"+(ae<10?"0"+ae:ae)},$=function(Z){var B=Object.keys(Z),K=[];return B.forEach(function(T){K.push(Z[T])}),K};return(0,a.useEffect)(function(){if(p){var t;w.current=p==null||(t=p.current)===null||t===void 0?void 0:t.offsetHeight}},[p]),(0,a.useEffect)(function(){N&&(w.current="auto")},[N]),(0,a.useEffect)(function(){c(le()(n))},[n]),(0,a.useEffect)(function(){console.log(f),x(f)},[f]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"px-4",style:{minHeight:w.current},children:j&&j.length?j.map(function(t){var Z,B,K,T,k,V,ae,W,U,ee,H,P,S,ie,se,ce,q,A,J,Y;return t!=null&&t.source_run&&t!==null&&t!==void 0&&t.source_run.summary&&(!O||O!=(t==null||(Z=t.source_run)===null||Z===void 0?void 0:Z.id))?(0,e.jsx)("div",{className:"pt-[16px] border-b-[1px] border-color-[#eee] ",children:(0,e.jsxs)("div",{className:"pb-[60px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pb-[8px] flex items-center",children:(0,e.jsx)("span",{className:"flex-1",children:m.formatMessage({id:"app.summary.title"})})}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:G(t==null||(B=t.source_run)===null||B===void 0?void 0:B.created_time)}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] ".concat(t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?"bg-[#F7F7F7]":"bg-blue-100 rounded-[4px]"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(K=t.source_run)===null||K===void 0?void 0:K.summary})}),(0,e.jsx)(lt,{id:l,message:t==null||(T=t.source_run)===null||T===void 0?void 0:T.summary})]}),t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),t==null?void 0:t.source_corrections.map(function(F,b){return(0,e.jsxs)("div",{className:"mb-[16px] last-of-type:mb-0",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat((t==null?void 0:t.source_corrections.length)-1!=b?"bg-[#F7F7F7]":"bg-blue-100"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",F.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),":"," ",G(F.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:F==null?void 0:F.corrected_summary})]})}),(0,e.jsx)(lt,{id:l,message:F==null?void 0:F.corrected_summary})]},F.created_time)})]}):(0,e.jsx)(e.Fragment,{}),t!=null&&t.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:t!=null&&(k=t.target_run)!==null&&k!==void 0&&k.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:t==null||(V=t.target_run)===null||V===void 0||(V=V.app)===null||V===void 0?void 0:V.name})]})}),(0,e.jsx)("div",{children:t!=null&&(ae=t.target_run)!==null&&ae!==void 0&&(ae=ae.inputs)!==null&&ae!==void 0&&ae.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[m.formatMessage({id:"app.summaryhistory.input"}),":"]}),$(t==null||(W=t.target_run)===null||W===void 0||(W=W.inputs)===null||W===void 0?void 0:W.properties).map(function(F){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:F.display_name||F.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:F.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:t!=null&&(U=t.target_run)!==null&&U!==void 0&&U.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[m.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:t==null||(ee=t.target_run)===null||ee===void 0?void 0:ee.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(t==null||(H=t.target_run)===null||H===void 0?void 0:H.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(P=t.target_run)===null||P===void 0||(P=P.outputs)===null||P===void 0?void 0:P.value})}):(0,e.jsx)(Oe.Z,{status:t==null||(S=t.target_run)===null||S===void 0?void 0:S.status,icon:t==null||(ie=t.target_run)===null||ie===void 0?void 0:ie.icon,title:t==null||(se=t.target_run)===null||se===void 0?void 0:se.name,textDetails:(0,e.jsx)(ba,{progressObj:{created_time:t==null||(ce=t.target_run)===null||ce===void 0?void 0:ce.created_time,elapsed_time:t==null||(q=t.target_run)===null||q===void 0?void 0:q.elapsed_time,app_name:t==null||(A=t.target_run)===null||A===void 0?void 0:A.app.name,status:t==null||(J=t.target_run)===null||J===void 0?void 0:J.status}}),handleClick:function(){var b,s,i,o,u,y,C,D,I,z;L({app_id:t==null||(b=t.target_run)===null||b===void 0||(b=b.app)===null||b===void 0?void 0:b.id,app_name:t==null||(s=t.target_run)===null||s===void 0||(s=s.app)===null||s===void 0?void 0:s.name,icon:t==null||(i=t.target_run)===null||i===void 0?void 0:i.icon,workflow_id:t==null||(o=t.target_run)===null||o===void 0?void 0:o.workflow_id,type:2,app_run_id:t==null||(u=t.target_run)===null||u===void 0?void 0:u.id,run_name:t==null||(y=t.target_run)===null||y===void 0?void 0:y.name,status:t==null||(C=t.target_run)===null||C===void 0?void 0:C.status,created_time:t==null||(D=t.target_run)===null||D===void 0?void 0:D.created_time,elapsed_time:t==null||(I=t.target_run)===null||I===void 0?void 0:I.elapsed_time,completed_progress:"".concat(t==null||(z=t.target_run)===null||z===void 0?void 0:z.percentage,"%")})},progress:t==null||(Y=t.target_run)===null||Y===void 0?void 0:Y.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]})},t.source_run.id):(0,e.jsx)(e.Fragment,{})}):(0,e.jsx)(e.Fragment,{})})})},Ra=(0,a.memo)(Ca),ka=function(r){var n,p=r.id,N=(0,a.useState)(""),l=v()(N,2),f=l[0],m=l[1],M=(0,a.useState)(!1),g=v()(M,2),j=g[0],c=g[1],w=(0,a.useState)([]),_=v()(w,2),R=_[0],O=_[1],x=(0,a.useState)(!1),L=v()(x,2),G=L[0],$=L[1],t=(0,a.useState)(!1),Z=v()(t,2),B=Z[0],K=Z[1],T=(0,a.useState)(""),k=v()(T,2),V=k[0],ae=k[1],W=(0,a.useState)(!1),U=v()(W,2),ee=U[0],H=U[1],P=(0,a.useState)(!1),S=v()(P,2),ie=S[0],se=S[1],ce=(0,a.useState)(!0),q=v()(ce,2),A=q[0],J=q[1],Y=(0,a.useRef)(null),F=(0,a.useRef)(1),b=(0,a.useRef)(!1),s=(0,a.useRef)(!0),i=(0,a.useRef)(0),o=(0,a.useState)(!1),u=v()(o,2),y=u[0],C=u[1],D=Q(function(re){return re.summaryParams}),I=Q(function(re){return re.setSummaryParams}),z=function(){var re=ne()(E()().mark(function ue(){var me,Te,de,Je,_e,Ye,be=arguments;return E()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(me=be.length>0&&be[0]!==void 0?be[0]:!0,Te=be.length>1&&be[1]!==void 0?be[1]:!0,!(i.current!=0&&i.current<F.current)){we.next=5;break}return C(!1),we.abrupt("return");case 5:return we.next=8,(0,pe.sh)({chatroom_id:p,page:F.current,page_size:10});case 8:de=we.sent,de.code==0&&(de!=null&&(Je=de.data)!==null&&Je!==void 0&&Je.list&&de!==null&&de!==void 0&&(_e=de.data)!==null&&_e!==void 0&&(_e=_e.list)!==null&&_e!==void 0&&_e.length&&(i.current=de==null||(Ye=de.data)===null||Ye===void 0?void 0:Ye.total_pages,O(function(Me){return Te?le()(de.data.list.reverse()):[].concat(le()(de.data.list.reverse()),le()(Me))}),c(!0),C(!0),setTimeout(function(){s.current=!0},300)),Te&&setTimeout(function(){var Me;Y==null||(Me=Y.current)===null||Me===void 0||Me.scrollTo({top:0})},200),me||(m(D.id),I({})));case 10:case"end":return we.stop()}},ue)}));return function(){return re.apply(this,arguments)}}(),oe=function(){var re=ne()(E()().mark(function ue(me){return E()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:me.target.scrollHeight+(me.target.scrollTop-me.target.clientHeight)<10&&s.current&&(s.current=!1,C(!0),F.current=F.current+=1,z(!0,!1));case 1:case"end":return de.stop()}},ue)}));return function(me){return re.apply(this,arguments)}}();return(0,a.useEffect)(function(){F.current=1,z()},[p]),(0,a.useEffect)(function(){D&&D.id&&(c(!0),A||J(!0),G&&$(!1),ee&&H(!1),F.current=1,K(!0),z(!1),b.current=!0)},[D]),(0,e.jsx)(e.Fragment,{children:j?(0,e.jsxs)(zt,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(ee?"translate-x-full flex-[0]":""),children:[ie?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(he.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){H(function(ue){return!ue})},className:`
                                        `.concat(ee?"right-[100%] top-[4px]":"right-[6px] top-[60px]",`
                                        fixed w-[40px] h-[40px]  flex justify-center items-center cursor-pointer z-[99]
                                    `),children:ee?(0,e.jsx)(qt,{className:"text-[20px]"}):(0,e.jsx)(Kt,{className:"text-[20px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:oe,ref:Y,children:[(0,e.jsxs)("div",{children:[R.length?(0,e.jsx)(Ra,{id:p,runid:V,scrollDom:Y,list:R,historyHeight:b.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:B?Y==null||(n=Y.current)===null||n===void 0?void 0:n.offsetHeight:""},children:[(0,e.jsx)(_a,{setShow:$,inputShow:A,setBoxLoading:se,setAppRunId:ae,scrollDom:Y}),G?(0,e.jsx)(Na,{id:f,runid:V,setBoxLoading:se,scrollDom:Y,setinputShow:J}):(0,e.jsx)(e.Fragment,{})]})]}),y?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(he.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},Ma=(0,a.memo)(ka),Fa=function(r){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})},Da=(0,a.memo)(function(){var d=(0,te.useParams)(),r=d.id,n=(0,a.useRef)([]),p=(0,a.useRef)(null),N=(0,a.useState)(!1),l=v()(N,2),f=l[0],m=l[1],M=function(){var g=ne()(E()().mark(function j(){var c;return E()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!r){_.next=5;break}return _.next=3,(0,pe.cH)({id:r});case 3:c=_.sent,c.code==0?(m(!0),p.current=c.data,n.current=c.data.agent_list):te.history.replace("/meeting");case 5:case"end":return _.stop()}},j)}));return function(){return g.apply(this,arguments)}}();return(0,a.useEffect)(function(){M()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(ut,{roomDetail:p.current,setAgent:n}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:f?(0,e.jsx)(Zt,{agentList:n}):(0,e.jsx)(Fa,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ma,{id:r})})]})})}),Ia=Da}}]);
