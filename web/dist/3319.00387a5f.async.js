"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3319],{43319:function(ga,ge,r){r.d(ge,{Z:function(){return Ee}});var me=r(19632),V=r.n(me),he=r(15009),S=r.n(he),pe=r(99289),R=r.n(pe),Se=r(97857),w=r.n(Se),Fe=r(5574),m=r.n(Fe),x=r(11551),ye=r(18304),N=r(85750),be=r(38008),je=r(77295),Le=r(39944),Me=r(58299),W=r(55927),b="agent_fullscreen_states",Ie=function(i){try{var u=localStorage.getItem(b);if(!u)return!1;var h=JSON.parse(u);return h[String(i)]||!1}catch(g){return console.warn("Failed to get agent fullscreen state:",g),!1}},Ae=function(i,u){try{var h=localStorage.getItem(b),g=h?JSON.parse(h):{};g[String(i)]=u,localStorage.setItem(b,JSON.stringify(g)),console.log("Agent ".concat(i," fullscreen state saved: ").concat(u))}catch(C){console.warn("Failed to save agent fullscreen state:",C)}},ma=function(i){try{var u=localStorage.getItem(b);if(!u)return;var h=JSON.parse(u);delete h[String(i)],localStorage.setItem(b,JSON.stringify(h)),console.log("Agent ".concat(i," fullscreen state cleared"))}catch(g){console.warn("Failed to clear agent fullscreen state:",g)}},ha=function(){try{var i=localStorage.getItem(b);return i?JSON.parse(i):{}}catch(u){return console.warn("Failed to get all agent fullscreen states:",u),{}}},pa=function(){try{localStorage.removeItem(b),console.log("All agent fullscreen states cleared")}catch(i){console.warn("Failed to clear all agent fullscreen states:",i)}},Re=r(19078),Y=r(1413),d=r(67294),$e=r(44685),we=r(91146),xe=function(i,u){return d.createElement(we.Z,(0,Y.Z)((0,Y.Z)({},i),{},{ref:u,icon:$e.Z}))},Ne=d.forwardRef(xe),Ze=Ne,Ce=r(34994),Oe=r(76772),Ue=r(77598),$=r(45360),Pe=r(74330),k=r(66309),Z=r(28036),Te=r(32983),o=r(85893),Ee=(0,d.memo)(function(n){var i,u,h,g,C=(0,d.useState)([]),K=m()(C,2),He=K[0],O=K[1],Je=(0,d.useState)(!0),Q=m()(Je,2),Sa=Q[0],Be=Q[1],De=(0,d.useState)(1),X=m()(De,2),Fa=X[0],ze=X[1],Ge=(0,d.useState)(!0),q=m()(Ge,2),Ve=q[0],We=q[1],Ye=(0,d.useState)(!1),_=m()(Ye,2),U=_[0],ee=_[1],ke=(0,d.useState)(!1),ae=m()(ke,2),ya=ae[0],P=ae[1],Ke=(0,d.useState)(!1),te=m()(Ke,2),ne=te[0],le=te[1],Qe=(0,d.useState)(!1),re=m()(Qe,2),Xe=re[0],T=re[1],qe=(0,d.useState)(!1),se=m()(qe,2),F=se[0],E=se[1],H=(0,d.useRef)(),_e=(0,d.useRef)(null),ea=(0,d.useRef)(null),y=(0,Oe.useIntl)(),J=(0,W.Z)(function(l){return l.getTypedMessages("chat_message_llm_return")}),aa=(0,d.useState)(null),ie=m()(aa,2),oe=ie[0],ta=ie[1],B=(0,W.Z)(function(l){return l.getTypedLastMessage("chat_message_llm_return")}),na=(0,d.useState)(null),ue=m()(na,2),j=ue[0],la=ue[1],ra=(0,Me.m)(),I=ra.options,sa=function(e){if(!e||!I)return"\u672A\u77E5\u6A21\u578B";var t=(0,N.ti)(e,{options:I});return(t==null?void 0:t.label)||"\u672A\u77E5\u6A21\u578B"},ia=function(e){if(!e||!I)return!1;var t=(0,N.ti)(e,{options:I});return(t==null?void 0:t.support_image)===1},oa=function(e){if(!e||!I)return!1;var t=(0,N.ti)(e,{options:I});return(t==null?void 0:t.model_mode)===2},ua=function(){var e,t=(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.agent_id;if(t){var s=!F;E(s),Ae(t,s)}else console.warn("Cannot save fullscreen state: agentId is not available"),E(function(c){return!c})};(0,d.useEffect)(function(){var l;if(((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.app)===null||l===void 0?void 0:l.name)!=null){var e=n.data.detailList.agent_chatroom_id,t=n.data.detailList.agent.agent_id;if(e){var s=window.location.search,c=new URLSearchParams(s);ta(e),c.set("id",String(e));var v="".concat(window.location.pathname,"?").concat(c.toString()).concat(window.location.hash);window.history.replaceState({},"",v)}var a=w()(w()({},n.data.detailList.app),{},{agent:n.data.detailList.agent,agent_id:t});if(la(a),t){var L=Ie(t);console.log("Restoring fullscreen state for agent ".concat(t,": ").concat(L)),E(L)}setTimeout(function(){We(!1)},500)}},[(i=n.data)===null||i===void 0||(i=i.detailList)===null||i===void 0||(i=i.app)===null||i===void 0?void 0:i.name,(u=n.data)===null||u===void 0||(u=u.detailList)===null||u===void 0||(u=u.agent)===null||u===void 0?void 0:u.m_config_id]);var A=(0,je.ZP)(),de=A.uploadedFiles,ba=A.setUploadedFiles,ja=A.handleUpload,La=A.removeFile,da=A.clearFiles,Ma=A.isUploading,D=function(){var e;(e=_e.current)===null||e===void 0||e.scrollIntoView({behavior:"smooth"})},ce=function(){var l=R()(S()().mark(function e(){var t,s,c;return S()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,le(!0),!(n!=null&&(t=n.saveInfo)!==null&&t!==void 0&&t.firstjudgingcondition())){a.next=6;break}return a.abrupt("return",!0);case 6:if(!(n!=null&&(s=n.saveInfo)!==null&&s!==void 0&&s.secondjudgingcondition())){a.next=10;break}return a.abrupt("return",!0);case 10:return a.next=12,n==null||(c=n.saveInfo)===null||c===void 0?void 0:c.agentupdata();case 12:return a.abrupt("return",a.sent);case 13:a.next=19;break;case 15:return a.prev=15,a.t0=a.catch(0),console.error("Failed to save info:",a.t0),a.abrupt("return",!1);case 19:return a.prev=19,le(!1),a.finish(19);case 22:case"end":return a.stop()}},e,null,[[0,15,19,22]])}));return function(){return l.apply(this,arguments)}}();(0,Ue.Z)(function(){var l,e=B==null?void 0:B.data;if(e&&!((e==null?void 0:e.agent_id)!==((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.agent)===null||l===void 0?void 0:l.agent_id)&&!$.ZP.error)){var t=w()(w()({},e),{},{id:e.message_id});J&&J.length>0&&(P(!1),O(function(s){return[].concat(V()(s),[t])}),setTimeout(D,100))}},[J]),(0,d.useEffect)(function(){!U&&He.length>0&&D()},[U]);var ca=function(){var l=R()(S()().mark(function e(t){var s,c,v,a,L,f,z,ve,G,fe;return S()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(a=(s=H.current)===null||s===void 0?void 0:s.getFieldsValue(),!(!a||!((c=t.content)!==null&&c!==void 0&&c.trim()))){p.next=3;break}return p.abrupt("return");case 3:return L=n.data.detailList.agent.agent_id,f=n.data.detailList.agent.input_variables,z=a.ability_id,ve=new Le.z({user:{value:a.content}}),G=de.map(function(M){return{name:M.name,url:M.url||M.path_show||""}}),fe={id:Date.now(),content:t.content,isUser:!0,ability_id:z,agent_id:L,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:a.content,prompt_tokens:0,total_tokens:0,file_list:G.length>0?G:void 0},P(!0),O(function(M){return[].concat(V()(M),[fe])}),(v=H.current)===null||v===void 0||v.resetFields(["content"]),p.prev=12,p.next=15,(0,x.CY)({agent_id:L,input_dict:f,ability_id:z,prompt:ve,file_list:de.map(function(M){return M.file_id})});case 15:da(),p.next=22;break;case 18:p.prev=18,p.t0=p.catch(12),P(!1),$.ZP.error(y.formatMessage({id:"agent.chat.send.failed"}));case 22:setTimeout(D,100);case 23:case"end":return p.stop()}},e,null,[[12,18]])}));return function(t){return l.apply(this,arguments)}}(),Ia=function(){var l=R()(S()().mark(function e(){var t,s,c;return S()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((t=n.data)!==null&&t!==void 0&&(t=t.detailList)!==null&&t!==void 0&&(t=t.agent)!==null&&t!==void 0&&t.agent_id){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,ee(!0),a.next=6,(0,x.CU)(String(n.data.detailList.agent.agent_id),1);case 6:c=a.sent,(s=c.data)!==null&&s!==void 0&&s.list&&(O(c.data.list),Be(c.data.total_pages>1),ze(1)),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(2),console.error("Failed to fetch initial messages:",a.t0);case 13:return a.prev=13,ee(!1),a.finish(13);case 16:case"end":return a.stop()}},e,null,[[2,10,13,16]])}));return function(){return l.apply(this,arguments)}}();if(U)return(0,o.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,o.jsx)(Pe.Z,{})});var va=function(){var l=R()(S()().mark(function e(){return S()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,T(!0),s.next=4,ce();case 4:setTimeout(R()(S()().mark(function c(){var v,a;return S()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,(0,x.Dh)((v=n.data)===null||v===void 0||(v=v.detailList)===null||v===void 0||(v=v.agent)===null||v===void 0?void 0:v.agent_id);case 3:a=f.sent,a.code==0?$.ZP.success(y.formatMessage({id:"agent.message.success.publish"})):$.ZP.error(y.formatMessage({id:"agent.message.fail.publish"})),f.next=11;break;case 7:f.prev=7,f.t0=f.catch(0),console.error("Failed to publish agent:",f.t0),$.ZP.error(y.formatMessage({id:"agent.message.fail.publish"}));case 11:return f.prev=11,T(!1),f.finish(11);case 14:case"end":return f.stop()}},c,null,[[0,7,11,14]])})),500),s.next=11;break;case 7:s.prev=7,s.t0=s.catch(0),console.error("Failed to save before publish:",s.t0),T(!1);case 11:case"end":return s.stop()}},e,null,[[0,7]])}));return function(){return l.apply(this,arguments)}}();if(Ve)return null;var fa=function(){var e,t;return(0,o.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,o.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.app)===null||e===void 0?void 0:e.name,F&&(j==null||(t=j.agent)===null||t===void 0?void 0:t.m_config_id)&&(0,o.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,o.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[sa(j.agent.m_config_id),ia(j.agent.m_config_id)&&(0,o.jsx)(k.Z,{color:"blue",className:"text-xs",children:y.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})}),oa(j.agent.m_config_id)&&(0,o.jsx)(k.Z,{color:"default",className:"text-xs",children:y.formatMessage({id:"workflow.tag.localModel",defaultMessage:"Local Model"})})]})})]}),(0,o.jsx)(Z.ZP,{type:"text",icon:F?(0,o.jsx)(Re.Z,{}):(0,o.jsx)(Ze,{}),onClick:ua,title:y.formatMessage({id:F?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),n.operationbentate=="false"&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Z.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:ne,onClick:ce,className:"min-w-24",children:y.formatMessage({id:"agent.btn.savedebug"})}),(0,o.jsx)(Z.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:Xe||ne,onClick:va,className:"min-w-24",children:y.formatMessage({id:"agent.publish"})})]})]})};return(0,o.jsx)("div",{ref:ea,className:n.iframe?"w-full":"".concat(F?"fixed inset-0 z-50  border border-gray-300 !h-screen top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:n.iframe?n.iframe.height:F?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,o.jsxs)(Ce.A,{formRef:H,submitter:!1,onFinish:ca,layout:"horizontal",initialValues:{ability_id:0},style:{height:n.iframe?n.iframe.height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[n.iframe?null:(0,o.jsx)(fa,{}),oe?(0,o.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(F?"max-w-[1400px] mx-auto justify-center":""),style:{height:n.iframe?n.iframe.height:F?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,o.jsx)(be.aS,{children:(0,o.jsx)(ye.F,{agentList:{current:[j]},abilitiesList:(h=n.data)===null||h===void 0?void 0:h.abilitiesList,agentChatRoomId:oe,chatStatus:(g=n.data)===null||g===void 0||(g=g.detailList)===null||g===void 0?void 0:g.chat_status})})}):(0,o.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,o.jsx)(Te.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})}}]);
