"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8304],{80459:function(at,Se,c){var Pe=c(32332),C=c(67294),Le=c(85893),L=function(xe){var m=xe.width,Te=m===void 0?"40px":m,X=xe.bg,je=X===void 0?"#F4F8F1":X,te=xe.rounded,Ce=te===void 0?"6px":te,Y=xe.data,ye=xe.imgWidth,se=ye===void 0?"18px":ye,ce=xe.background;Y!=null&&Y.avatar&&(se=Te);var B=ce||je;return(0,Le.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Te,height:Te,backgroundColor:B,borderRadius:Ce},children:(0,Le.jsx)("img",{src:Y!=null&&Y.avatar?Y.avatar:(0,Pe.s9)("single",Y==null?void 0:Y.icon),style:{width:se,height:se,borderRadius:Ce},alt:""})})};Se.Z=(0,C.memo)(L)},18304:function(at,Se,c){c.d(Se,{F:function(){return qr}});var Pe=c(97857),C=c.n(Pe),Le=c(5574),L=c.n(Le),be=c(45360),xe=c(55026),m=c(67294),Te=c(15009),X=c.n(Te),je=c(19632),te=c.n(je),Ce=c(99289),Y=c.n(Ce),ye=c(9783),se=c.n(ye),ce=c(43722),B=c(39e3),F=c(76772),Ee=c(74330),H=c(41428),t=c(85893),Je=function(e){var r=e.roomid,n=(0,F.useIntl)(),a=(0,B.Z)(function(x){return x.setSummaryClick}),s=(0,m.useState)(!0),o=L()(s,2),l=o[0],u=o[1],d=(0,B.Z)(function(x){return x.summaryClick});(0,m.useEffect)(function(){u(d)},[d]);var v=(0,B.Z)(function(x){return x.setSummaryParams});return(0,t.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,t.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(v({id:r}),a(!1))},children:[(0,t.jsx)(H.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[14px]",children:n.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Me=c(80459),Be=c(45585),_e=c(55060),de=c(28036),fe=c(69753),Oe=c(97245),tt=c(77295),ot=function(e,r){try{var n=document.createElement("a");n.href=e,n.download=r,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(a){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",a)}},vt=function(e){var r=e.fileList,n=e.onDownload,a=n===void 0?ot:n,s=e.className,o=s===void 0?"":s,l=e.showInGrid,u=l===void 0?!1:l,d=e.maxHeight;return!r||r.length===0?null:(0,t.jsx)("div",{className:"mb-2 ".concat(o),style:{maxHeight:d,overflow:d?"auto":"visible"},children:(0,t.jsx)(_e.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"".concat(u?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:r.map(function(v,x){var f=v.path_show||v.url,_=(0,tt.CO)(v.name);return(0,t.jsx)("div",{className:"".concat(u?"":"mb-2"),children:_?(0,t.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,t.jsx)(_e.Z,{src:f,alt:v.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(de.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(fe.Z,{}),onClick:function(j){j.stopPropagation(),a(f,v.name)}})})]}):(0,t.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,t.jsx)(Oe.Z,{className:"mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:v.name})]}),(0,t.jsx)(de.ZP,{type:"text",size:"small",icon:(0,t.jsx)(fe.Z,{}),onClick:function(){return a(f,v.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(v.uid||v.file_id||x))})})})})},pt=vt,Ye=c(22683),Qe=c(97807),Xe=c(4958),Re=c(13769),Ie=c.n(Re),We=function(){var i=Y()(X()().mark(function e(r){return X()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){a.next=5;break}return a.next=4,navigator.clipboard.writeText(r);case 4:return a.abrupt("return",!0);case 5:return a.abrupt("return",st(r));case 8:return a.prev=8,a.t0=a.catch(0),console.error("Failed to copy using Clipboard API:",a.t0),a.abrupt("return",st(r));case 12:case"end":return a.stop()}},e,null,[[0,8]])}));return function(r){return i.apply(this,arguments)}}(),st=function(e){try{var r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select();var n=document.execCommand("copy");return document.body.removeChild(r),n}catch(a){return console.error("Fallback copy failed:",a),!1}},qe=c(52677),he=c.n(qe),He=function(e,r){try{var n=document.createElement("a");n.href=e,n.download=r,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(a){}},rt=function i(e){return typeof e=="string"?e:Array.isArray(e)?e.map(i).join(""):m.isValidElement(e)?i(e.props.children):""},ze=function(e){return rt(e)},De=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||he()(e)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var n=r.checkText,a=n===void 0?!0:n,s=r.checkFiles,o=s===void 0?!0:s,l=r.checkMCPTools,u=l===void 0?!0:l,d=r.checkStreaming,v=d===void 0?!0:d,x=r.minTextLength,f=x===void 0?1:x,_=function(){if(!a)return!1;try{var w=e.content;return w&&typeof w=="string"&&w.trim().length>=f}catch(P){return console.warn("Error checking text content:",P),!1}},y=function(){if(!o)return!1;try{var w=e.fileList||e.file_list;return w&&Array.isArray(w)&&w.length>0}catch(P){return console.warn("Error checking file content:",P),!1}},j=function(){if(!u)return!1;try{var w;if((w=e.parsedContent)!==null&&w!==void 0&&w.hasMCPTools)return!0;if(e.contentBlocks&&Array.isArray(e.contentBlocks)){var P=e.contentBlocks.some(function(S){return S&&S.type==="mcp"&&S.toolId});if(P)return!0}return e.activeMCPTools&&Array.isArray(e.activeMCPTools)?e.activeMCPTools.length>0:!1}catch(S){return console.warn("Error checking MCP content:",S),!1}},p=function(){if(!v)return!1;try{return e.contentBlocks&&Array.isArray(e.contentBlocks)?e.contentBlocks.some(function(w){return w&&w.type==="text"&&w.content&&w.content.trim().length>=f}):!1}catch(w){return console.warn("Error checking streaming content:",w),!1}};return _()||y()||j()||p()}catch(M){return console.error("hasMessageContent unexpected error:",M),!0}},ke=function(e){try{var r=(e==null?void 0:e.content)||"",n=(e==null?void 0:e.fileList)||(e==null?void 0:e.file_list)||[],a=(e==null?void 0:e.parsedContent)||{},s=(e==null?void 0:e.contentBlocks)||[],o=(e==null?void 0:e.activeMCPTools)||[];return{hasText:r&&typeof r=="string"&&r.trim().length>0,hasFiles:Array.isArray(n)&&n.length>0,hasParsedMCP:!!a.hasMCPTools,hasContentBlocksMCP:s.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(o)&&o.length>0,hasStreamingText:s.some(function(l){var u;return(l==null?void 0:l.type)==="text"&&(l==null||(u=l.content)===null||u===void 0?void 0:u.trim())}),textLength:r?r.trim().length:0,fileCount:Array.isArray(n)?n.length:0,mcpToolCount:Array.isArray(o)?o.length:0,blockCount:Array.isArray(s)?s.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},nt=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!e||!Array.isArray(e)||e.length===0)return null;var n=e[0];return n.is_agent===1&&n.content!=""?n:null}catch(a){return console.error("checkLastAgentMessage error:",a),null}},it=function(e){return!(e!=null&&e.blocks)||!Array.isArray(e.blocks)?[]:e.blocks.map(function(r){var n;return r.type==="text"?{type:"text",content:r.content||"",timestamp:Date.now()}:r.type==="mcp-tool"&&(n=r.toolData)!==null&&n!==void 0&&n.id?{type:"mcp",toolId:r.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},lt=function(e){return e.filter(function(r){return r.type==="mcp"&&r.toolId}).map(function(r){return r.toolId})},Ue=function(e,r){try{var n=C()(C()({},e),{},{content:e.content||"",activeMCPTools:e.activeMCTools||[]}),a=e.contentBlocks;if(!a&&e.parsedContent?a=it(e.parsedContent):!a&&e.content&&(a=[{type:"text",content:e.content,timestamp:Date.now()}]),r&&a){var s=lt(a);n.activeMCPTools=s}return n.contentBlocks=a||[],n}catch(o){return console.error("prepareHistoryMessageForCurrent error:",o),e}},et=c(76637),ut=function(e){var r=e.code,n=e.index,a=(0,m.useState)(""),s=L()(a,2),o=s[0],l=s[1],u=(0,m.useState)(!0),d=L()(u,2),v=d[0],x=d[1],f=(0,m.useState)(null),_=L()(f,2),y=_[0],j=_[1],p=(0,m.useState)(!1),M=L()(p,2),w=M[0],P=M[1],S=(0,m.useState)(""),J=L()(S,2),me=J[0],D=J[1],K=(0,m.useMemo)(function(){var G=r.split("").reduce(function(k,oe){return k=(k<<5)-k+oe.charCodeAt(0),k&k},0);return"mermaid-chart-".concat(n,"-").concat(Math.abs(G))},[r,n]),ae=(0,m.useMemo)(function(){return{startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:"Arial, sans-serif",fontSize:14}},[]),ee=(0,m.useCallback)(Y()(X()().mark(function G(){var k,oe;return X()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.prev=0,x(!0),j(null),et.Z.initialize(ae),U.next=6,et.Z.render(K,r);case 6:k=U.sent,oe=k.svg,l(oe),U.next=15;break;case 11:U.prev=11,U.t0=U.catch(0),console.error("Mermaid rendering error:",U.t0),j(U.t0.message||"Unknown error occurred");case 15:return U.prev=15,x(!1),U.finish(15);case 18:case"end":return U.stop()}},G,null,[[0,11,15,18]])})),[r,K,ae]);(0,m.useEffect)(function(){ee()},[ee]),(0,m.useEffect)(function(){if(!o){D("");return}var G="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o));D(G)},[o]);var we=(0,m.useMemo)(function(){return v?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading chart..."})}):y?(0,t.jsxs)("div",{className:"p-4 text-red-500 bg-red-50 border border-red-200 rounded",children:[(0,t.jsx)("p",{className:"font-medium",children:"\u56FE\u8868\u6E32\u67D3\u5931\u8D25"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:y})]}):o?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px]",dangerouslySetInnerHTML:{__html:o}}),(0,t.jsx)(de.ZP,{type:"button","aria-label":"Open preview",title:"Open preview",tabIndex:0,onClick:function(){return P(!0)},onKeyDown:function(k){(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),P(!0))},className:"absolute top-2 right-2 z-10 rounded-md bg-white/90 hover:bg-white text-gray-700 shadow px-2 py-1 text-xs border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Preview"}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(_e.Z,{style:{display:"none"},src:"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(o)),width:"100%",className:"w-full",preview:{visible:w,mask:!1,scaleStep:.25,imageRender:function(k){return(0,t.jsx)("div",{className:"bg-white w-full h-full flex justify-center items-center",children:k})},onVisibleChange:function(k){return P(k)}}})})]}):null},[v,y,o,w]);return(0,t.jsx)("div",{className:"my-4 p-4 bg-white border border-gray-200 rounded-lg",children:we})},ct=function(e,r){return e.code===r.code&&e.index===r.index},ht=m.memo(ut,ct),q=["node","className","children"],Ke=["node"],Lt=["node","children"],Ot=["node","children"],Rt=["node","children"],Ut=["node","children"],Dt=["node","children"],kt=["node","children"],Zt=function(e){var r=e.code,n=e.index,a=e.isCurrentMessage;if(!a)return(0,t.jsx)(ht,{code:r,index:n});var s=(0,m.useState)(!1),o=L()(s,2),l=o[0],u=o[1];return(0,m.useEffect)(function(){u(!1);var d=setTimeout(function(){return u(!0)},1e3);return function(){return clearTimeout(d)}},[r]),l?(0,t.jsx)(ht,{code:r,index:n}):(0,t.jsx)("div",{className:"my-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:(0,t.jsx)("div",{className:"flex justify-center items-center min-h-[200px] text-gray-500",children:(0,t.jsx)("div",{className:"text-sm",children:"Loading Mermaid chart..."})})})},Bt=function(e,r){return e.code===r.code&&e.index===r.index},Wt=(0,m.memo)(Zt,Bt),dt=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=function(o,l){try{var u=document.createElement("a");u.href=o,u.download=l,u.target="_blank",document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(d){}};return{code:function(o){var l=o.node,u=o.className,d=o.children,v=Ie()(o,q),x=/language-(\w+)/.exec(u||"");if(x!=null&&x.length){if(x[1]==="mermaid"){var f=ze(d);return(0,t.jsx)(Wt,{code:f,index:e,isCurrentMessage:n})}var _=Math.random().toString(36).substr(2,9);return(0,t.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:x[1]})}),(0,t.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var y=Y()(X()().mark(function j(p){var M,w;return X()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,M=p.currentTarget,S.next=4,We(ze(d));case 4:w=S.sent,w&&M?(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){M&&(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copycode"}))},200)):M&&(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){M&&(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),S.next=11;break;case 8:S.prev=8,S.t0=S.catch(0),console.error("Failed to copy text: ",S.t0);case 11:case"end":return S.stop()}},j,null,[[0,8]])}));return function(j){return y.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,t.jsx)("span",{children:r.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,t.jsx)("div",{id:"".concat(_).concat(e),className:"p-4",children:d})})]})}else return(0,t.jsx)("code",C()(C()({},v),{},{children:d}))},img:function(o){var l=o.node,u=Ie()(o,Ke);return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(_e.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,t.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(de.ZP,{type:"primary",size:"small",icon:(0,t.jsx)(fe.Z,{}),onClick:function(v){v.stopPropagation(),a(u.src||"",u.alt||"image.png")}})})]},u.src)},table:function(o){var l=o.node,u=o.children,d=Ie()(o,Lt);return(0,t.jsx)("div",{className:"overflow-x-auto my-4 border border-gray-300 rounded-lg",children:(0,t.jsx)("table",C()(C()({className:"min-w-full"},d),{},{children:u}))})},thead:function(o){var l=o.node,u=o.children,d=Ie()(o,Ot);return(0,t.jsx)("thead",C()(C()({className:"bg-gray-50"},d),{},{children:u}))},tbody:function(o){var l=o.node,u=o.children,d=Ie()(o,Rt);return(0,t.jsx)("tbody",C()(C()({className:"bg-white"},d),{},{children:u}))},tr:function(o){var l=o.node,u=o.children,d=Ie()(o,Ut);return(0,t.jsx)("tr",C()(C()({className:"border-b border-gray-200 hover:bg-gray-50"},d),{},{children:u}))},th:function(o){var l=o.node,u=o.children,d=Ie()(o,Dt);return(0,t.jsx)("th",C()(C()({className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border-r border-gray-200 last:border-r-0"},d),{},{children:u}))},td:function(o){var l=o.node,u=o.children,d=Ie()(o,kt);return(0,t.jsx)("td",C()(C()({className:"px-4 py-3 text-sm text-gray-900 border-r border-gray-200 last:border-r-0"},d),{},{children:u}))}}},Ht=c(61227),jt=c.n(Ht),zt=c(29608),Kt=c(97175),Gt=c(4161),Vt=c(49354),$t=c(45699),Jt=c(8751),Yt=c(79090),Mt=c(66212),Qt=c(16596),Xt=c(11475),qt=c(2830),er=c(87547),It=c(71471),wt=c(47221),gt=c(66309),tr=c(4393),O=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i.WAITING_FILE_UPLOAD="waiting_file_upload",i}({}),Nt=function(e,r){if(e){if(e.status==="waiting_confirm")return O.WAITING_CONFIRMATION;if(r===null)return O.RUNNING}if(r!==null){if(typeof r=="string")try{var n=JSON.parse(r);if(n.status==="failed")return O.FAILED}catch(a){}else if(he()(r)==="object"&&r.status==="failed")return O.FAILED;return O.COMPLETED}return O.PENDING},Pt=(0,m.createContext)(void 0),rr=function(e){var r=e.children,n=e.agentChatRoomId,a=e.agentList,s=(0,m.useRef)(null),o=(0,m.useRef)(null),l=(0,m.useState)(!1),u=L()(l,2),d=u[0],v=u[1],x=(0,m.useState)([]),f=L()(x,2),_=f[0],y=f[1],j=(0,F.useParams)(),p=j.id,M=(0,F.useLocation)(),w=new URLSearchParams(M.search),P=w.get("id"),S=n||p||P,J={scrollDomRef:s,upButtonDom:o,isStop:d,setIsStop:v,instruction:_,setInstruction:y,id:S,agentList:a};return(0,t.jsx)(Pt.Provider,{value:J,children:r})},Ge=function(){var e=(0,m.useContext)(Pt);if(e===void 0)throw new Error("useChatRoomContext must be used within a ChatRoomProvider");return e},nr=function(e){var r,n=e.fileConfig,a=e.value,s=e.onChange,o=(0,tt.ZP)({maxSizeMB:n.maxSize||10,acceptedFileTypes:((r=n.accepted_types)===null||r===void 0?void 0:r.join(","))||void 0,multiple:!1}),l=o.uploadedFiles,u=o.handleUpload,d=o.removeFile,v=o.clearFiles,x=o.isUploading,f=(0,F.useIntl)();return(0,m.useEffect)(function(){if(l.length>0){var _=l[l.length-1],y={file_name:_.name,file_path:_.path_show,size:0,type:"",id:_.file_id,status:"done"};s(y)}else s(null)},[l]),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-700 mb-1",children:[n.name,n.required!==!1&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),n.description&&(0,t.jsx)("span",{className:"text-gray-500 ml-2",children:n.description}),n.accepted_types&&n.accepted_types.length>0&&(0,t.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",n.accepted_types.join(", "),")"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:l.length===0?(0,t.jsx)(de.ZP,{type:"dashed",onClick:u,loading:x,disabled:x,className:"w-48",children:x?f.formatMessage({id:"app.chatroom.mcptool.uploading"}):f.formatMessage({id:"app.chatroom.mcptool.uploadFile"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"truncate flex-1 text-xs",children:l[l.length-1].name}),(0,t.jsx)(de.ZP,{type:"link",danger:!0,size:"small",onClick:function(){return d(l[l.length-1].uid)},disabled:x,children:f.formatMessage({id:"app.chatroom.mcptool.remove"})})]})})]})},ar=nr,or=function(e){var r=e.toolData,n=e.onFileUploadComplete,a=e.onFileUploadError,s=r.files_to_upload||[],o=(0,m.useState)({}),l=L()(o,2),u=l[0],d=l[1],v=(0,F.useIntl)(),x=s.every(function(j){return j.required===!1||u[j.variable_name]&&u[j.variable_name].status==="done"}),f=function(p,M){d(function(w){var P=C()({},w);return M?P[p]=M:delete P[p],P})},_=function(){return s.map(function(p){var M=u[p.variable_name];return C()(C()({},p),M)})},y=function(){if(!x){be.ZP.warning(v.formatMessage({id:"app.chatroom.mcptool.pleaseUploadAllRequiredFiles"}));return}var p=_();n(p)};return(0,m.useEffect)(function(){},[x,u,n]),(0,t.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg bg-blue-50",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:v.formatMessage({id:"app.chatroom.mcptool.requiredFiles"})})}),s.length===0&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:v.formatMessage({id:"app.chatroom.mcptool.noFilesRequired"})}),s.map(function(j){return(0,t.jsx)(ar,{fileConfig:j,value:u[j.variable_name],onChange:function(M){return f(j.variable_name,M)}},j.variable_name)}),(0,t.jsx)(de.ZP,{type:"primary",className:"mt-2 w-full",disabled:!x,onClick:y,children:v.formatMessage({id:"app.chatroom.mcptool.completeUpload"})})]})},sr=or,Ae=It.Z.Text,en=It.Z.Paragraph,xt=wt.Z.Panel,ir=function(e){var r=e.toLowerCase().split(".").pop(),n="text-sm";switch(r){case"xlsx":case"xls":case"csv":return(0,t.jsx)(Kt.Z,{className:"text-green-600 ".concat(n)});case"doc":case"docx":return(0,t.jsx)(Gt.Z,{className:"text-blue-600 ".concat(n)});case"pdf":return(0,t.jsx)(Vt.Z,{className:"text-red-600 ".concat(n)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,t.jsx)($t.Z,{className:"text-purple-600 ".concat(n)});default:return(0,t.jsx)(Oe.Z,{className:"text-gray-600 ".concat(n)})}},Tt=function(e){var r=e.fileList,n=e.intl,a=function(o,l){try{var u=document.createElement("a");u.href=o,u.download=l,u.target="_blank",document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(d){console.error("Download file failed",d)}};return!r||r.length===0?null:(0,t.jsx)("div",{className:"space-y-1",children:r.map(function(s,o){return(0,t.jsxs)("div",{className:"mb-2 last:mb-0",children:[s.variable_name&&(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Ae,{strong:!0,className:"text-xs text-gray-700",children:[s.variable_name,":"]})}),(0,t.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:ir(s.file_name)}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:s.file_name})})]}),(0,t.jsx)(de.ZP,{type:"text",size:"small",icon:(0,t.jsx)(fe.Z,{}),onClick:function(){return a(s.file_path,s.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:n.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},o)})})},lr=function(e){var r=e.status;switch(r){case O.COMPLETED:return(0,t.jsx)(Jt.Z,{className:"text-green-500"});case O.RUNNING:return(0,t.jsx)(Yt.Z,{className:"text-blue-500"});case O.WAITING_CONFIRMATION:return(0,t.jsx)(Mt.Z,{className:"text-orange-500"});case O.WAITING_FILE_UPLOAD:return(0,t.jsx)(Qt.Z,{className:"text-purple-500"});case O.FAILED:return(0,t.jsx)(Xt.Z,{className:"text-red-500"});default:return(0,t.jsx)(Mt.Z,{className:"text-gray-500"})}},ur=function(e){var r=e.status,n=e.intl,a=function(l){switch(l){case O.COMPLETED:return{color:"success",text:n.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case O.RUNNING:return{color:"processing",text:n.formatMessage({id:"app.chatroom.mcptool.status.running"})};case O.WAITING_CONFIRMATION:return{color:"warning",text:n.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case O.WAITING_FILE_UPLOAD:return{color:"purple",text:n.formatMessage({id:"app.chatroom.mcptool.status.waitingFileUpload"})};case O.FAILED:return{color:"error",text:n.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:n.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},s=a(r);return(0,t.jsx)(gt.Z,{color:s.color,children:s.text})},mt=function(e){if(e==null)return"null";if(typeof e=="string")try{var r=JSON.parse(e);return JSON.stringify(r,null,2)}catch(n){return e}try{return JSON.stringify(e,null,2)}catch(n){return String(e)}},cr=function(e,r){return e.includes("skill")?r.formatMessage({id:"app.chatroom.mcptool.type.skill"}):e.includes("workflow")?r.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):r.formatMessage({id:"app.chatroom.mcptool.type.tool"})},dr=function(e){if(!e||he()(e)!=="object")return{specialFields:{},regularFields:e};var r={},n={};return Object.keys(e).forEach(function(a){a==="input_variables"?r[a]=e[a]:n[a]=e[a]}),{specialFields:r,regularFields:n}},mr=function(e){var r=e.inputVariables,n=e.intl;return!r||he()(r)!=="object"||Object.keys(r).length===0?null:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ae,{strong:!0,className:"text-blue-600 text-sm",children:n.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(r).map(function(a){var s=L()(a,2),o=s[0],l=s[1];return(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,t.jsxs)(Ae,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[o,":"]}),(0,t.jsx)(Ae,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},o)})})]})},fr=function(e){var r=e.args,n=e.intl;try{var a=dr(r),s=a.specialFields,o=a.regularFields,l=s.input_variables&&Object.keys(s.input_variables).length>0,u=o&&Object.keys(o).length>0;return!l&&!u?(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:n.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(mr,{inputVariables:s.input_variables,intl:n}),u&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ae,{strong:!0,className:"text-gray-600 text-sm",children:n.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:mt(o)})})]})]})}catch(d){return console.warn("Failed to parse parameters for enhanced display:",d),(0,t.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:mt(r)})})}},vr=function(e){try{var r=e;if(typeof e=="string")try{r=JSON.parse(e)}catch(n){return[]}return r&&he()(r)==="object"&&r.status==="success"&&r.file_list&&Array.isArray(r.file_list)?r.file_list:[]}catch(n){return console.warn("Failed to extract file list from result data:",n),[]}},pr=function(e){var r=e.resultData,n=e.intl,a=e.status,s=r;if(typeof r=="string")try{s=JSON.parse(r)}catch(d){s=r}var o=s&&he()(s)==="object"&&s.status==="success"&&s.outputs&&he()(s.outputs)==="object";if(o){var l=s.outputs,u=Object.keys(l).length>0;return u?(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(Ae,{strong:!0,className:"text-green-600 text-sm",children:n.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(d){var v=L()(d,2),x=v[0],f=v[1];return(0,t.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsxs)(Ae,{strong:!0,className:"text-xs text-gray-700",children:[x,":"]})}),(0,t.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof f=="string"?(0,t.jsx)(Ye.U,{rehypePlugins:[Qe.Z],components:dt(0,n),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:f}):(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:mt(f)})})]},x)})]}):(0,t.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:n.formatMessage({id:"app.chatroom.mcptool.noOutputs"})})}return(0,t.jsx)("div",{className:"p-2 rounded text-xs ".concat(a===O.FAILED?"bg-red-50":"bg-green-50"),children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:mt(r)})})},yt=function(e){var r=e.toolData,n=e.intl,a=e.runtimeData,s=e.updateMCPTool,o=Ge(),l=o.setInstruction,u=(a==null?void 0:a.status)||Nt(r.workflow_confirmation_status,r.result),d=cr(r.name,n),v=(a==null?void 0:a.workflow_confirmation)||r.workflow_confirmation_status,x=(0,zt.Z)(function(D){return D.setDealtWithData}),f=(a==null?void 0:a.result)||r.result,_=null;if(typeof f=="string")try{var y=JSON.parse(f);y.status==="failed"&&(_=y.message)}catch(D){}else he()(f)==="object"&&(f==null?void 0:f.status)==="failed"&&(_=f.message);var j=function(){x(C()(C()({},v),{},{exec_id:v.node_exec_id}))},p=function D(K,ae){if(l){if(K.length===0){ae&&ae();return}var ee=jt()(K),we=ee[0],G=ee.slice(1);l(we),setTimeout(function(){D(G,ae)},100)}},M=function(K){if(!s){console.warn("updateMCPTool function not available");return}try{if(s(r.id,{uploaded_files:K,status:O.RUNNING}),l){var ae=[["MCPTOOLFILES",{id:r.id,files_to_upload:K}]];p(ae)}}catch(ee){console.error("Error handling file upload completion:",ee),be.ZP.error("Failed to process file upload completion")}},w=function(K){console.error("File upload error:",K),be.ZP.error(K),s&&s(r.id,{status:O.FAILED,error:K})},P=vr(f),S=P&&Array.isArray(P)&&P.length>0,J=((a==null?void 0:a.uploaded_files)||[]).map(function(D){return{file_name:D.file_name||D.name,file_path:D.file_path||"",variable_name:D.variable_name}}),me=J&&Array.isArray(J)&&J.length>0;return(0,t.jsxs)(tr.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(qt.Z,{className:"text-blue-500"}),(0,t.jsx)(Ae,{strong:!0,className:"text-sm",children:(a==null?void 0:a.skill_or_workflow_name)||r.skill_or_workflow_name}),(0,t.jsx)(gt.Z,{color:"blue",children:d}),(0,t.jsx)(lr,{status:u}),(0,t.jsx)(ur,{status:u,intl:n})]}),v&&u!==O.COMPLETED&&u!==O.FAILED&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(er.Z,{className:"text-orange-500"}),(0,t.jsxs)(Ae,{className:"text-sm font-medium",children:[n.formatMessage({id:"app.chatroom.mcptool.workflow"}),":"," ",(a==null?void 0:a.skill_or_workflow_name)||r.skill_or_workflow_name]}),v.confirmer_name&&(0,t.jsxs)(Ae,{className:"text-xs text-gray-600",children:[n.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",v.confirmer_name]})]}),v.show_todo_button&&(0,t.jsx)(de.ZP,{size:"small",type:"primary",onClick:j,children:n.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),_&&(0,t.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,t.jsxs)(Ae,{type:"danger",className:"text-xs",children:[n.formatMessage({id:"app.chatroom.mcptool.error"}),": ",_]})}),(a==null?void 0:a.status)===O.WAITING_FILE_UPLOAD&&(0,t.jsx)(sr,{toolData:a,onFileUploadComplete:M,onFileUploadError:w}),(0,t.jsxs)(wt.Z,{size:"small",ghost:!0,children:[((a==null?void 0:a.args)||r.args)&&Object.keys((a==null?void 0:a.args)||r.args).length>0&&(0,t.jsxs)(xt,{header:n.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:[(0,t.jsx)(fr,{args:(a==null?void 0:a.args)||r.args,intl:n}),me&&(0,t.jsx)(Tt,{fileList:J,intl:n})]},"params"),f&&(0,t.jsx)(xt,{header:n.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,t.jsx)(pr,{resultData:f,intl:n,status:u})},"result"),S&&(0,t.jsx)(xt,{header:n.formatMessage({id:"app.chatroom.mcptool.files"}),children:(0,t.jsx)(Tt,{fileList:P,intl:n})},"files")]})]})},Ct="<<<mcp-tool-start>>>",ft="<<<mcp-tool-end>>>",tn=function(e){var r,n=e.files_to_upload&&Array.isArray(e.files_to_upload)&&e.files_to_upload.length>0,a=((r=e.args)===null||r===void 0?void 0:r.input_variables)&&Object.values(e.args.input_variables).some(function(s){return s==="need_upload"});return(n||a)&&!e.result?MCPToolStatus.WAITING_FILE_UPLOAD:getMCPToolStatus(e.workflow_confirmation_status,e.result)},hr=function(e){return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.map(function(r){return{name:r.name||"",variable_name:r.variable_name||"",id:r.id||0,file_name:r.file_name||null,file_path:r.file_path||null,required:!0,accept:void 0,maxSize:void 0,description:void 0,accepted_types:void 0}})},gr=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("extractMCPTools: content is not a valid string:",e),[];for(var r=[],n=0;;){var a=e.indexOf(Ct,n);if(a===-1)break;var s=e.indexOf(ft,a);if(s===-1)break;var o=a+Ct.length,l=e.substring(o,s).trim();try{var u=JSON.parse(l),d=hr(u),v={id:u.id,name:u.name||"",skill_or_workflow_name:u.skill_or_workflow_name||"",workflow_run_id:u.workflow_run_id||0,workflow_confirmation_status:u.workflow_confirmation_status||null,args:u.args||{},result:u.result||null,files_to_upload:d};d.length>0&&console.log("[MCP Parser] Extracted files_to_upload for tool ".concat(v.id,":"),d),r.push({toolData:v,startIndex:a,endIndex:s+ft.length})}catch(x){console.error("Failed to parse MCP tool JSON:",x)}n=s+ft.length}return r},xr=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("splitContentBlocks: content is not a valid string:",e),[{type:"text",content:""}];var r=gr(e);if(r.length===0)return[{type:"text",content:e}];var n=[],a=0;if(r.forEach(function(o){if(o.startIndex>a){var l=e.substring(a,o.startIndex).trim();l&&n.push({type:"text",content:l})}n.push({type:"mcp-tool",content:e.substring(o.startIndex,o.endIndex),toolData:o.toolData}),a=o.endIndex}),a<e.length){var s=e.substring(a).trim();s&&n.push({type:"text",content:s})}return n},ve=function(e){if(typeof e!="string"||e===null||e===void 0)return console.warn("parseMCPContent: content is not a valid string:",e),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var r=xr(e),n=r.some(function(a){return a.type==="mcp-tool"});return{blocks:r,hasMCPTools:n}},rn=function(e,r,n){var a=_objectSpread({},e);a.mcpTools||(a.mcpTools=[]);var s=a.mcpTools.findIndex(function(o){return o.id===r});return s>=0?a.mcpTools[s]=_objectSpread(_objectSpread({},a.mcpTools[s]),n):a.mcpTools.push(_objectSpread({id:r,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},n)),a},nn=function(e,r){return!e.mcpTools||!Array.isArray(e.mcpTools)?null:e.mcpTools.find(function(n){return n.id===r})||null},an=function(e,r){var n=_objectSpread({},e);return n.mcpTools&&Array.isArray(n.mcpTools)&&(n.mcpTools=n.mcpTools.filter(function(a){return a.id!==r})),n},on=function(e){return!e.mcpTools||!Array.isArray(e.mcpTools)?[]:_toConsumableArray(e.mcpTools).sort(function(r,n){return String(r.id).localeCompare(String(n.id))})},yr=function(e){try{var r={id:e.id,name:e.name,skill_or_workflow_name:e.skill_or_workflow_name,workflow_run_id:e.workflow_run_id,workflow_confirmation_status:e.workflow_confirmation_status,args:e.args,result:e.result,files_to_upload:e.files_to_upload},n=JSON.stringify(r,null,0);return"".concat(Ct).concat(n).concat(ft)}catch(a){return console.error("Failed to serialize MCP tool:",a),""}},Cr=function(e){try{return!e.files_to_upload||!Array.isArray(e.files_to_upload)?[]:e.files_to_upload.filter(function(r){return!r||he()(r)!=="object"?(console.warn("Invalid file object in files_to_upload:",r),!1):r.file_path&&typeof r.file_path=="string"&&r.file_path.trim()!==""&&(r.file_path.startsWith("http")||r.file_path.startsWith("/"))})}catch(r){return console.error("Error inferring uploaded files:",r),[]}},_t=function(e,r){try{if(!e||!Array.isArray(e))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var n="";return e.forEach(function(a){if(a.type==="text")n+=a.content||"";else if(a.type==="mcp"&&a.toolId){var s=r(a.toolId);if(s){var o=yr(s);n+=o}else console.warn("MCP tool ".concat(a.toolId," not found in runtime data"))}}),n}catch(a){return console.error("Failed to reconstruct content with updated MCP tools:",a),""}},_r=c(27484),br=c.n(_r),Et=function(e){var r,n=e.content,a=e.fileList,s=e.index,o=e.intl,l=e.isAgent,u=e.contentId,d=e.isCurrentMessage,v=e.mcpTools,x=e.updateMCPTool,f=e.getMCPTool,_=e.item,y=e.contentBlocks,j=(_==null?void 0:_.parsedContent)||ve(n);return(0,t.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:u,children:[a&&a.length>0&&(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(pt,{fileList:a,onDownload:He})}),y&&y.length>0?(0,t.jsx)("div",{children:y.map(function(p,M){var w,P,S,J,me,D;return(0,t.jsx)("div",{children:p.type==="text"?p.content&&(0,t.jsx)(Ye.U,{remarkPlugins:[Xe.Z],rehypePlugins:[Qe.Z],components:dt(s,o,d),children:p.content}):p.toolId&&f&&(0,t.jsx)(yt,{toolData:{id:p.toolId,name:((w=f(p.toolId))===null||w===void 0?void 0:w.name)||"",skill_or_workflow_name:((P=f(p.toolId))===null||P===void 0?void 0:P.skill_or_workflow_name)||"",workflow_run_id:(S=f(p.toolId))===null||S===void 0?void 0:S.workflow_run_id,workflow_confirmation_status:(J=f(p.toolId))===null||J===void 0?void 0:J.workflow_confirmation_status,args:((me=f(p.toolId))===null||me===void 0?void 0:me.args)||{},result:(D=f(p.toolId))===null||D===void 0?void 0:D.result},intl:o,runtimeData:f(p.toolId),updateMCPTool:x})},"content-block-".concat(M))})}):j.hasMCPTools?(0,t.jsx)("div",{children:j.blocks.map(function(p,M){return(0,t.jsx)("div",{children:p.type==="text"?(0,t.jsx)(Ye.U,{remarkPlugins:[Xe.Z],rehypePlugins:[Qe.Z],components:dt(s,o),children:p.content}):p.toolData&&(0,t.jsx)(yt,{toolData:p.toolData,intl:o,runtimeData:f?f(p.toolData.id):null,updateMCPTool:x})},M)})}):(0,t.jsx)(Ye.U,{remarkPlugins:[Xe.Z],rehypePlugins:[Qe.Z],components:dt(s,o),children:n}),e.isCurrentMessage&&!y&&(_==null||(r=_.activeMCPTools)===null||r===void 0?void 0:r.length)>0&&(0,t.jsx)("div",{className:"mt-3",children:_.activeMCPTools.map(function(p){return f?f(p):null}).filter(Boolean).map(function(p){return(0,t.jsx)(yt,{toolData:{name:p.name,skill_or_workflow_name:p.skill_or_workflow_name,workflow_run_id:p.workflow_run_id,workflow_confirmation_status:p.workflow_confirmation_status,args:p.args,result:p.result,id:p.id},intl:o,runtimeData:p,updateMCPTool:x},"current-tool-".concat(p.id))})}),_.created_time&&_.is_agent==1&&(0,t.jsx)("div",{className:"text-xs text-gray-300  text-right -mr-2 mb-1",children:br()(_.created_time).format("YYYY-MM-DD HH:mm:ss")})]})},jr=(0,m.memo)(function(i){var e=i.messageApi,r=i.index,n=i.idName,a=i.cidName,s=(0,F.useIntl)(),o=(0,m.useState)(!1),l=L()(o,2),u=l[0],d=l[1];return(0,t.jsx)("div",{className:"flex gap-x-[4px]",children:(0,t.jsxs)("div",{onMouseEnter:function(){d(!0)},onMouseLeave:function(){d(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var v=Y()(X()().mark(function x(f){var _,y,j;return X()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return _=f.target.closest("#".concat(n).concat(r)),y=_.querySelector("#".concat(a).concat(r)),M.prev=2,M.next=5,We(y.innerText);case 5:j=M.sent,j?e.open({type:"success",content:s.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),M.next=13;break;case 9:M.prev=9,M.t0=M.catch(2),console.error("Failed to copy text: ",M.t0),e.open({type:"error",content:s.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return M.stop()}},x,null,[[2,9]])}));return function(x){return v.apply(this,arguments)}}(),children:[(0,t.jsx)("img",{src:"".concat(u?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,t.jsx)("span",{className:"text-[12px] ".concat(u?" text-[#1B64F3]":"text-[#666]"),children:s.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Mr=c(2068),Ir=function(e){var r=e.id,n=e.index,a=e.idName,s=e.cidName,o=(0,F.useIntl)(),l=(0,B.Z)(function(y){return y.setSummaryClick}),u=(0,m.useState)(!0),d=L()(u,2),v=d[0],x=d[1],f=(0,B.Z)(function(y){return y.summaryClick});(0,m.useEffect)(function(){x(f)},[f]);var _=(0,B.Z)(function(y){return y.setSummaryParams});return(0,t.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(v?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,t.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(j){if(v){var p=j.target.closest("#".concat(a).concat(n)),M=p.querySelector("#".concat(s).concat(n));_({id:r,message:M.innerText}),l(!1)}},children:[(0,t.jsx)(Mr.Z,{className:"text-[16px]"}),(0,t.jsx)("span",{className:"text-[12px]",children:o.formatMessage({id:"app.chatroom.content.summary"})})]})})},wr=function(e){var r=e.messageApi,n=e.index,a=e.idName,s=e.cidName,o=e.id,l=e.agentChatRoomId,u=e.isAgent;return u?(0,t.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,t.jsx)(jr,{messageApi:r,index:n,idName:a,cidName:s}),!l&&(0,t.jsx)(Ir,{id:o,index:n,idName:a,cidName:s})]}):null},bt=c(79574),At=function(e){var r,n=e.item,a=e.index,s=e.agentChatRoomId,o=e.abilitiesList,l=e.messageApi,u=e.id,d=e.idName,v=e.cidName,x=e.mcpTools,f=e.updateMCPTool,_=e.getMCPTool,y=(0,F.useIntl)(),j=n.is_agent===1,p=(0,Be.Pc)(),M=p.userInfo;return De(n)?(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(j?"":"flex-row-reverse"),children:[j?(0,t.jsx)(Me.Z,{data:n}):(0,t.jsx)(Me.Z,{data:{avatar:(0,bt.Ep)()?"/icons/headportrait/atyun.svg":"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(s?"":"max-w-[560px]"," text-right"),id:"".concat(d).concat(a),children:[(0,t.jsxs)("div",{className:"".concat(j?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[n.name?n.name:(M==null?void 0:M.nickname)||"",n.ability_id>0&&(0,t.jsxs)(t.Fragment,{children:[" ","(",(o==null||(r=o.find(function(w){return n.ability_id==w.value}))===null||r===void 0?void 0:r.label)||y.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,t.jsx)("div",{className:"flex ".concat(j?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Et,{content:n.content,fileList:n.file_list,index:a,intl:y,isAgent:j,contentId:"".concat(v).concat(a),mcpTools:x,updateMCPTool:f,getMCPTool:_,item:n})}),(0,t.jsx)(wr,{messageApi:l,index:a,idName:d,cidName:v,id:u,agentChatRoomId:s,isAgent:j})]})]}):null},Nr=c(47635),Pr=function(e,r,n,a,s,o,l,u,d,v,x,f,_,y,j,p,M){var w=(0,F.useIntl)(),P=(0,B.Z)(function(Z){return Z.setTruncatable}),S=function(h){try{var g=JSON.parse(h.slice(22,-2));return Array.isArray(g)&&g.length>=2?[g[0],g[1]]:null}catch(b){return console.warn("Failed to parse instruction:",b),null}},J=function(h){return h.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},me=function(h){return!h||!h.input_variables?!1:Object.values(h.input_variables).some(function(g){return g==="need_upload"})},D=function(h){d(function(g){var b=g.contentBlocks||[],I=h(b);return C()(C()({},g),{},{contentBlocks:I})})},K=function(h){D(function(g){var b=g[g.length-1];return b&&b.type==="text"?g.map(function(I,N){return N===g.length-1?C()(C()({},I),{},{content:(I.content||"")+h}):I}):[].concat(te()(g),[{type:"text",content:h,timestamp:Date.now()}])})},ae=function(h){D(function(g){return[].concat(te()(g),[{type:"mcp",toolId:h,timestamp:Date.now()}])})},ee=function(h){return!(h!=null&&h.blocks)||!Array.isArray(h.blocks)?[]:h.blocks.map(function(g){var b;return g.type==="text"?{type:"text",content:g.content||"",timestamp:Date.now()}:g.type==="mcp-tool"&&(b=g.toolData)!==null&&b!==void 0&&b.id?{type:"mcp",toolId:g.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},we=function(h){return h.filter(function(g){return g.type==="mcp"&&g.toolId}).map(function(g){return g.toolId})},G=function(h,g){_&&_(h,g),f.current&&Object.keys(v).length>0&&d(function(b){var I=b.activeMCPTools||[],N=I.includes(h)?I:[].concat(te()(I),[h]);return C()(C()({},b),{},{activeMCPTools:N})})},k=function(h,g,b){try{if(!h||!Array.isArray(h))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!b)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),h;var I=h.filter(function(z){return z.type==="mcp"&&z.toolId}).map(function(z){return z.toolId}),N=g.filter(function(z){return!I.includes(z)}),W=N.map(function(z){return{type:"mcp",toolId:z,timestamp:Date.now()}});return[].concat(te()(h),te()(W))}catch(z){return console.error("Failed to sync MCP tool states to contentBlocks:",z),h}},oe={ERROR:function(h){e(!1),r(!1),n(""),a.open({type:"error",content:"webSocket-".concat(h),duration:10})},CHAT:function(h){if(Object.keys(v).length&&De(v,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var g,b,I=C()({},v);if(((g=I.activeMCPTools)===null||g===void 0?void 0:g.length)>0||((b=I.contentBlocks)===null||b===void 0?void 0:b.length)>0){var N=k(I.contentBlocks||[],I.activeMCPTools||[],p);if(p&&N.length>0){var W=_t(N,p);W?(I.content=W,I.parsedContent=ve(W)):I.content&&(I.parsedContent=ve(I.content))}else I.content&&(I.parsedContent=ve(I.content));I.contentBlocks=N}else I.content&&(I.parsedContent=ve(I.content));s(function(le){return le.concat(I)}),d({})}var z={content:"".concat(h),is_agent:0};s(function(le){return le.concat(z)}),j&&j(!0),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(h){s(function(g){if(g.length===0)return g;var b=g.length-1;return g.map(function(I,N){return N===b?C()(C()({},I),{},{file_list:h}):I})}),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(h){r(h)},TRUNCATABLE:function(h){P(h),h||a.open({type:"success",content:"".concat(w.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(h){a.open({type:"success",content:"".concat(w.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(h){var g=h.id,b=h.name,I=h.skill_or_workflow_name,N=h.args,W=h.files_to_upload,z=I&&I.toLowerCase().includes("workflow"),le=W&&Array.isArray(W)&&W.length>0,Fe=le||me(N),ue=Fe?O.WAITING_FILE_UPLOAD:O.RUNNING;G(g,{name:b,skill_or_workflow_name:I||b,args:N,status:ue,isWorkflow:z,files_to_upload:W||[],uploaded_files:[]}),j&&j(!1),ae(g)},WITHMCPTOOLRESULT:function(h){var g=h.id,b=h.result,I=O.COMPLETED;if(typeof b=="string")try{var N=JSON.parse(b);N.status==="failed"&&(I=O.FAILED)}catch(W){}else he()(b)==="object"&&(b==null?void 0:b.status)==="failed"&&(I=O.FAILED);G(g,{result:b,status:I})},WITHWFSTATUS:function(h){var g=h.id,b=h.status,I={id:b.id,status:b.status,app_run_id:b.app_run_id,node_exec_id:b.node_exec_id,workflow_name:b.workflow_name,need_user_confirm:b.need_user_confirm,show_todo_button:b.show_todo_button,confirmer_name:b.confirmer_name},N;switch(b.status){case"running":N=O.RUNNING;break;case"waiting_confirm":N=O.WAITING_CONFIRMATION;break;case"completed":N=O.COMPLETED;break;case"failed":N=O.FAILED;break;default:N=O.RUNNING;break}j&&j(!1),G(g,{workflow_confirmation:I,status:N,isWorkflow:!0})},WITHMCPTOOLFILES:function(h){var g=h.id,b=h.files_to_upload,I=h.args;G(g,C()({uploaded_files:b||[],status:O.COMPLETED},I?{args:I}:{}))}},ie=function(h,g){oe[h]=g},U=function(h){var g=h.data,b=S(g),I=J(g),N=g.indexOf("REPLY")!==-1&&g.indexOf("ENDREPLY")===-1,W=g.indexOf("ABILITY")!==-1,z=g.indexOf("ENDCHAT")!==-1;if(I){if(!b)return;var le=b[0],Fe=b[1],ue=oe[le];ue?ue(Fe):console.warn("Unknown message type: ".concat(le))}if(I||console.log(f.current,h),!I&&f.current&&(x.current+=g,j&&j(!1),requestAnimationFrame(function(){o.current&&(o.current.scrollTop=0),l.current&&(l.current.style.display="none")}),d(function(Q){var ne=x.current,pe=C()(C()({},Q),{},{content:ne});return ne&&(pe.parsedContent=ve(ne)),pe}),K(g)),N&&I){var V=b[1],E=u.current.filter(function(Q){return Q.agent_id==V})[0];s(function(Q){var ne=Q;if(Object.keys(v).length&&De(v,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var pe,Ze,A=C()({},v);if(((pe=A.activeMCPTools)===null||pe===void 0?void 0:pe.length)>0||((Ze=A.contentBlocks)===null||Ze===void 0?void 0:Ze.length)>0){var Ve=k(A.contentBlocks||[],A.activeMCPTools||[],p);if(p&&Ve.length>0){var $e=_t(Ve,p);$e?(A.content=$e,A.parsedContent=ve($e)):A.content&&(A.parsedContent=ve(A.content))}else A.content&&(A.parsedContent=ve(A.content));A.contentBlocks=Ve}else A.content&&(A.parsedContent=ve(A.content));ne=Q.concat(A)}return x.current="",d({is_agent:1,icon:E==null?void 0:E.icon,name:E==null?void 0:E.name,avatar:E==null?void 0:E.avatar,content:"",activeMCPTools:[],agent_id:V,parsedContent:null,contentBlocks:[]}),f.current=!0,r(!0),P(!1),ne})}if(W&&I){var re=b[1];d(function(Q){return C()(C()({},Q),{},{is_agent:1,ability_id:re})})}if(z){if(f.current=!1,x.current="",e(!1),r(!1),P(!0),Object.keys(v).length){var Ne,ge,T=C()({},v);if(((Ne=T.activeMCPTools)===null||Ne===void 0?void 0:Ne.length)>0||((ge=T.contentBlocks)===null||ge===void 0?void 0:ge.length)>0){var R=k(T.contentBlocks||[],T.activeMCPTools||[],p);if(p&&R.length>0){var $=_t(R,p);$?(T.content=$,T.parsedContent=ve($)):T.content&&(T.parsedContent=ve(T.content))}else T.content&&(T.parsedContent=ve(T.content));T.contentBlocks=R}else T.content&&(T.parsedContent=ve(T.content));console.log(T),s(function(Q){return Q.concat(T)})}d({}),n("")}};return{getSocketMessage:U,addMessageHandler:ie}},Tr=function(e){var r=e.currentMessage,n=e.agentChatRoomId,a=e.intl,s=e.mcpTools,o=s===void 0?{}:s,l=e.updateMCPTool,u=l===void 0?function(){}:l,d=e.getMCPTool,v=d===void 0?function(){return null}:d,x=Ge(),f=x.setInstruction,_=(0,Be.Pc)(),y=_.userInfo;return!r.name||!De(r)?null:(0,t.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(r.is_agent!=1?"flex-row-reverse":""),children:[r.is_agent==1?(0,t.jsx)(Me.Z,{data:r}):(0,t.jsx)(Me.Z,{data:{avatar:(0,bt.Ep)()?"/icons/headportrait/atyun.svg":"/icons/user_header.svg"}}),(0,t.jsxs)("div",{className:"flex1 ".concat(n?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,t.jsx)("div",{className:"".concat(r.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:r.name?r.name:(y==null?void 0:y.nickname)||""}),(0,t.jsx)("div",{className:"flex ".concat(r.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,t.jsx)(Et,{content:r.content||"",fileList:r.file_list,index:-1,intl:a,isAgent:r.is_agent==1,contentId:"addchilContent",mcpTools:o,updateMCPTool:u,getMCPTool:v,item:C()(C()({},r),{},{parsedContent:ve(r.content||"")}),isCurrentMessage:!0,contentBlocks:r.contentBlocks})})]})]})},Er=(0,m.memo)(function(i){var e=i.messageApi,r=i.setCurrentMessageContent,n=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,l=i.setIsStop,u=i.setisEnd,d=i.setSendValue,v=i.agentChatRoomId,x=i.updateMCPTool,f=i.getCurrentMessageList,_=i.mcpTools,y=_===void 0?{}:_,j=i.getMCPTool,p=j===void 0?function(){return null}:j,M=i.setIsWaitingReply,w=i.removeHistoryMessage,P=i.setCurrentMessageFromHistory,S=Ge(),J=S.setInstruction,me=(0,F.useIntl)(),D=(0,F.useParams)(),K=D.id,ae=(0,F.useLocation)(),ee=new URLSearchParams(ae.search),we=ee.get("id"),G=v||K||we,k=(0,B.Z)(function(ue){return ue.setDisableInput}),oe=(0,m.useState)({}),ie=L()(oe,2),U=ie[0],Z=ie[1],h=(0,m.useRef)(!1),g=(0,m.useRef)(""),b=(0,m.useCallback)(function(ue){try{if(!ue||he()(ue)!=="object"){console.warn("Invalid history message provided:",ue);return}if(ue.is_agent!==1){console.warn("Attempted to set non-agent message as current:",ue);return}var V=Ue(ue,p);if(!V){console.warn("Failed to prepare history message:",ue);return}Z(V),h.current=!0,g.current=V.content||""}catch(E){console.error("Failed to set current message from history:",E)}},[p]);(0,m.useEffect)(function(){P&&P(b)},[P,b]);var I=Pr(k,l,d,e,r,s,o,a,Z,U,g,h,x,f,M,p,w),N=I.getSocketMessage,W=(0,Nr.Z)("chat",N),z=W.runSocket,le=W.sendMessage,Fe=W.readyState;return(0,m.useEffect)(function(){Fe==1&&G&&le(JSON.stringify(["ENTER",parseInt(G)]))},[Fe]),(0,m.useEffect)(function(){n&&Fe==1&&le(n)},[n]),(0,m.useEffect)(function(){z()},[]),(0,t.jsx)(Tr,{currentMessage:U,agentChatRoomId:v,intl:me,mcpTools:y,updateMCPTool:x,getMCPTool:p})}),Ar=function(e){var r=e.type,n=r===void 0?"typing":r,a=e.size,s=a===void 0?"medium":a;if(n==="typing")return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(n==="wave"){var o={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,u){return(0,t.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:C()(C()({},o),{},{animationDelay:"".concat(l,"s")})},u)})})]})}return n==="pulse"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,t.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,t.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):n==="spinner"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},Fr=function(e){var r=e.autoRotate,n=r===void 0?!1:r,a=e.rotateInterval,s=a===void 0?3e3:a,o=e.initialType,l=o===void 0?"wave":o,u=e.size,d=u===void 0?"medium":u,v=(0,m.useState)(l),x=L()(v,2),f=x[0],_=x[1],y=["typing","wave","pulse","spinner"];return(0,t.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,t.jsx)(Ar,{type:f,size:d})})},Sr=function(e){var r=e.isVisible,n=e.animationType,a=n===void 0?"pulse":n,s=e.enableAutoRotate,o=s===void 0?!0:s,l=(0,F.useIntl)();return r?(0,t.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,t.jsx)(Fr,{initialType:a,autoRotate:o,rotateInterval:4e3,size:"medium"})}),(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},Lr=(0,m.memo)(function(i){var e=i.messageApi,r=i.setUserMessage,n=i.sendValue,a=i.agentList,s=i.scrollDomRef,o=i.upButtonDom,l=i.setIsStop,u=i.setSendValue,d=i.agentChatRoomId,v=i.abilitiesList,x=i.mcpTools,f=i.updateMCPTool,_=i.getMCPTool,y=i.userMessage,j=Ge(),p=j.setInstruction,M=(0,m.useState)([]),w=L()(M,2),P=w[0],S=w[1],J=(0,m.useState)(!1),me=L()(J,2),D=me[0],K=me[1],ae=(0,m.useState)(!1),ee=L()(ae,2),we=ee[0],G=ee[1],k=(0,m.useRef)(!1),oe=(0,m.useRef)(null),ie=(0,F.useParams)(),U=ie.id,Z=(0,F.useLocation)(),h=new URLSearchParams(Z.search),g=h.get("id"),b=U||g;(0,m.useEffect)(function(){D&&(r(function(N){return[].concat(te()(P.reverse()),te()(N))}),S([]),setTimeout(function(){K(!1),s.current.scrollTop=0},200))},[D]),(0,m.useEffect)(function(){if(!k.current&&!(!y||!Array.isArray(y)||y.length===0)){if(!oe.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var N=nt(y);if(N){if(!N.id){console.warn("Found agent message without ID, skipping:",N),k.current=!0;return}if(oe.current(N),r){var W=y.filter(function(z){return z!==N});r(W)}else console.warn("setUserMessage not available for history update");k.current=!0}}catch(z){console.error("Failed to process history message:",z,{userMessageLength:y==null?void 0:y.length,hasCallback:!!oe.current}),k.current=!0}}},[y,r]),(0,m.useEffect)(function(){k.current=!1},[b]);var I=function(W){if(r&&y){var z=y.filter(function(le){return le!==W});r(z)}};return(0,t.jsxs)(t.Fragment,{children:[P.length?P.map(function(N,W){return(0,t.jsx)(At,{item:N,index:W,agentChatRoomId:d,abilitiesList:v,messageApi:e,id:b,idName:"currentContent",cidName:"currentChilContent",mcpTools:x,updateMCPTool:f,setInstruction:p,getMCPTool:_},W)}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)(Sr,{isVisible:we}),(0,t.jsx)(Er,{messageApi:e,setCurrentMessageContent:S,sendValue:n,agentList:a,scrollDomRef:s,upButtonDom:o,setIsStop:l,setisEnd:K,setSendValue:u,agentChatRoomId:d,updateMCPTool:f,getCurrentMessageList:function(){return y||[]},mcpTools:x,getMCPTool:_,setIsWaitingReply:G,removeHistoryMessage:I,setCurrentMessageFromHistory:function(W){oe.current=W},setInstruction:p})]})}),Or=(0,m.memo)(function(i){var e=i.messageApi,r=i.scrollDomRef,n=i.instruction,a=i.setIsStop,s=i.upButtonDom,o=i.agentList,l=i.agentChatRoomId,u=i.abilitiesList,d=Ge(),v=d.setInstruction,x=(0,F.useIntl)(),f=(0,m.useState)(860),_=L()(f,2),y=_[0],j=_[1],p=(0,F.useParams)(),M=p.id,w=(0,F.useLocation)(),P=new URLSearchParams(w.search),S=P.get("id"),J=l||M||S,me=(0,m.useState)([]),D=L()(me,2),K=D[0],ae=D[1],ee=(0,m.useRef)(!1),we=(0,m.useState)(""),G=L()(we,2),k=G[0],oe=G[1],ie=(0,m.useRef)(null),U=(0,m.useRef)(!0),Z=(0,m.useState)({}),h=L()(Z,2),g=h[0],b=h[1],I=(0,m.useRef)(2),N=(0,m.useRef)(1),W=(0,m.useRef)(0),z=function(R,$){b(function(Q){var ne=Q[R];return ne?C()(C()({},Q),{},se()({},R,C()(C()({},ne),$))):C()(C()({},Q),{},se()({},R,C()({id:R,status:O.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},$)))})},le=function(R){return g[R]||null},Fe=function(R){var $,Q=R.files_to_upload&&Array.isArray(R.files_to_upload)&&R.files_to_upload.length>0,ne=(($=R.args)===null||$===void 0?void 0:$.input_variables)&&Object.values(R.args.input_variables).some(function(pe){return pe==="need_upload"});return(Q||ne)&&!R.result?O.WAITING_FILE_UPLOAD:Nt(R.workflow_confirmation_status,R.result)},ue=function(R){var $=R.map(function(Q){var ne=C()({},Q);if(Q.is_agent===1&&Q.content){var pe=ve(Q.content);ne.parsedContent=pe,pe.hasMCPTools&&pe.blocks.forEach(function(Ze){if(Ze.type==="mcp-tool"&&Ze.toolData){var A=Ze.toolData;if(!g[A.id]){var Ve=Fe(A);b(function($e){return C()(C()({},$e),{},se()({},A.id,{id:A.id,name:A.name,skill_or_workflow_name:A.skill_or_workflow_name||A.name,workflow_run_id:A.workflow_run_id||0,workflow_confirmation_status:A.workflow_confirmation_status||null,args:A.args||{},result:A.result||null,status:Ve,isWorkflow:A.skill_or_workflow_name?A.skill_or_workflow_name.toLowerCase().includes("workflow"):!1,files_to_upload:A.files_to_upload||[],uploaded_files:Cr(A)}))})}}})}return ne});return $},V=function(){var T=Y()(X()().mark(function R($){var Q,ne,pe=arguments;return X()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(Q=pe.length>1&&pe[1]!==void 0?pe[1]:function(){},!J){A.next=6;break}return A.next=4,(0,ce.KH)(J,{page:N.current,page_size:10});case 4:ne=A.sent,ne.code==0&&(I.current=ne.data.total_pages,$||(ie.current.style.display="none"),ae(function(Ve){var $e=ne.data.list.reverse(),St=ue($e);return $?te()(St):[].concat(te()(Ve),te()(St))}),$?r&&r.current&&setTimeout(function(){r.current.scrollTop=0,s.current.style.display="none"}):W.current=ne.data.list.length,U.current=!0);case 6:case"end":return A.stop()}},R)}));return function($){return T.apply(this,arguments)}}(),E=function(R){var $=R.target.scrollHeight+(R.target.scrollTop-R.target.clientHeight);ee.current!==Math.ceil(R.target.scrollTop)<-50&&(ee.current=Math.ceil(R.target.scrollTop)<-50,s.current.style.display=ee.current?"flex":"none"),$<10&&U.current&&(U.current=!1,N.current=N.current+1,ie.current.style.display="flex",I.current>=N.current?V(!1):ie.current.style.display="none")},re=function(R,$){$==="0"&&($=Number($));var Q=["".concat(R),$!==""&&$!==null&&$!==void 0?$:null];oe(JSON.stringify(Q))},Ne=(0,B.Z)(function(T){return T.disableInput}),ge=(0,B.Z)(function(T){return T.clearMemory});return(0,m.useEffect)(function(){ge&&ge.length&&re(ge[0],ge[1])},[ge]),(0,m.useEffect)(function(){n&&n.length&&(re(n[0],n[1]!==void 0?n[1]:""),v([]))},[n]),(0,m.useEffect)(function(){N.current=1,V(!0)},[]),(0,m.useEffect)(function(){var T=function(){window.innerWidth<1280||j(window.innerWidth-320-(window.innerWidth-320)/2-88)};return T(),window.addEventListener("resize",T),function(){window.removeEventListener("resize",T)}},[]),(0,t.jsx)("div",{className:"flex-1 min-h-0",children:(0,t.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth  ".concat((0,bt.Ep)()?"px-2":"chatroom"),ref:r,onScroll:E,children:[(0,t.jsxs)("div",{className:"w-full",style:{minWidth:l?"":"".concat(y,"px")},children:[(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex flex-col-reverse",children:K&&K.length?K.map(function(T,R){return(0,t.jsx)(At,{item:C()(C()({},T),{},{id:"c".concat(T.id)}),index:R,agentChatRoomId:l,abilitiesList:u,messageApi:e,id:J,idName:"content",cidName:"chilContent",mcpTools:g,updateMCPTool:z,getMCPTool:le},R)}):(0,t.jsx)(t.Fragment,{})}),(0,t.jsx)(Lr,{messageApi:e,setUserMessage:ae,sendValue:k,agentList:o,scrollDomRef:r,upButtonDom:s,setIsStop:a,setSendValue:oe,agentChatRoomId:l,abilitiesList:u,mcpTools:g,updateMCPTool:z,getMCPTool:le,userMessage:K})]}),(0,t.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!l&&!Ne&&K.length?(0,t.jsx)(Je,{roomid:J}):(0,t.jsx)(t.Fragment,{})})]}),(0,t.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:ie,children:(0,t.jsx)(Ee.Z,{})})]})})}),Rr=c(82114),Ur=c(77171),Dr=c(85576),Ft=c(96486),kr=c(58299),Zr=c(38008),Br=c(83062),Wr=function(e){var r=e.uploadedFiles,n=e.handleRemoveFile;return r.length?(0,t.jsx)(_e.Z.PreviewGroup,{children:(0,t.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(function(a){return(0,t.jsx)(gt.Z,{closable:!0,onClose:function(){return n(a.uid)},className:"flex items-center ".concat(a.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,t.jsx)(Br.Z,{title:a.name,children:(0,t.jsx)("div",{className:"flex items-center",children:a.isImage?(0,t.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,t.jsx)(_e.Z,{src:a.path_show||a.url,alt:a.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:a.path_show||a.url,mask:!1}}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(fe.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),He(a.path_show||a.url,a.name)}})]}):(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Oe.Z,{className:"mr-1"}),(0,t.jsx)("span",{className:"truncate mr-1",children:a.name}),(0,t.jsx)(fe.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(o){o.stopPropagation(),He(a.path_show||a.url,a.name)}})]})})})},a.uid)})})})}):null},Hr=c(52645),zr=c(64317),Kr=function(e){var r=e.agentChatRoomId,n=e.abilitiesList,a=e.abilityId,s=e.setAbilityId,o=e.clearContext,l=(0,F.useIntl)();return r?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(n==null?void 0:n.length)>0&&(0,t.jsx)(zr.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:n,initialValue:a,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(d){s(d)}},formItemProps:{className:"m-0"}}),(0,t.jsx)(de.ZP,{size:"small",color:"danger",variant:"outlined",onClick:o,icon:(0,t.jsx)(Hr.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},Gr=c(88484),Vr=c(30159),$r=c(26915),Jr=$r.Z.TextArea,Yr=function(e){var r=e.userSendvalue,n=e.setUserSendvalue,a=e.disableInput,s=e.isUploading,o=e.isStop,l=e.userSendmessage,u=e.handleFileUpload,d=e.sendMessage,v=e.stopChatRoom,x=(0,F.useIntl)(),f=(0,Ft.throttle)(function(){if(a||!r)return!1;d(r)},300);return(0,t.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,t.jsx)(de.ZP,{type:"text",icon:(0,t.jsx)(Gr.Z,{}),onClick:u,disabled:a||s,loading:s}),(0,t.jsx)(Jr,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:r,disabled:a,onChange:function(y){n(y.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(x.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),o?(0,t.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:v,children:(0,t.jsx)(Vr.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,t.jsx)("div",{className:"".concat(a||!r?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:f,children:(0,t.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Qr=(0,m.memo)(function(i){var e,r=i.messageApi,n=i.isStop,a=i.scrollDomRef,s=i.upButtonDom,o=i.agentList,l=i.abilitiesList,u=i.agentChatRoomId,d=i.chatStatus,v=Ge(),x=v.setInstruction,f=(0,F.useIntl)(),_=(0,B.Z)(function(V){return V.disableInput}),y=(0,B.Z)(function(V){return V.setDisableInput}),j=(0,B.Z)(function(V){return V.setClearMemory}),p=(0,kr.m)(),M=p.options,w=u?(0,Zr.Zc)().isImageSupportModel:function(){return!1},P=(0,m.useState)(null),S=L()(P,2),J=S[0],me=S[1],D=(0,m.useState)(""),K=L()(D,2),ae=K[0],ee=K[1],we=(0,m.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),G=L()(we,2),k=G[0],oe=G[1],ie=(0,tt.ZP)({maxSizeMB:15,acceptedFileTypes:k,multiple:!0}),U=ie.uploadedFiles,Z=ie.handleUpload,h=ie.removeFile,g=ie.clearFiles,b=ie.isUploading;(0,m.useEffect)(function(){var V,E;if(u&&(o==null||(V=o.current)===null||V===void 0?void 0:V.length)>0&&o!==null&&o!==void 0&&(E=o.current[0])!==null&&E!==void 0&&(E=E.agent)!==null&&E!==void 0&&E.m_config_id){var re,Ne=o==null||(re=o.current[0])===null||re===void 0||(re=re.agent)===null||re===void 0?void 0:re.m_config_id,ge=w(Ne),T=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(ge?",.jpg,.png,.jpeg":"");oe(T)}},[o,M,o==null||(e=o.current)===null||e===void 0||(e=e[0])===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.m_config_id,w]);var I=function(){var E=Dr.Z.confirm;E({title:f.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,t.jsx)(Rr.Z,{}),content:f.formatMessage({id:"app.chatroom.clear.tips"}),okText:f.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:f.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){j(["TRUNCATE","0"])}})},N=function V(E,re){if(E.length===0){re&&re();return}var Ne=jt()(E),ge=Ne[0],T=Ne.slice(1);x(ge),setTimeout(function(){V(T,re)},100)},W=function(E){var re=[];(U==null?void 0:U.length)>0&&re.push(["FILELIST",U.map(function(ge){return ge.file_id})]);var Ne=J||0;re.push(["SETABILITY",Ne]),re.push(["INPUT",E]),N(re,function(){(U==null?void 0:U.length)>0&&g()})},z=function(E){!E.shiftKey&&E.target.value==""&&(r.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),ee(""),E.preventDefault()),!E.shiftKey&&E.keyCode==13&&E.target.value!=""&&(y(!0),ee(""),W(E.target.value),E.preventDefault())},le=(0,Ft.throttle)(function(){x(["STOP",null])},300),Fe=function(){_||Z()},ue=function(E){if(!E){r.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}y(!0),W(E),ee("")};return(0,t.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,t.jsx)("div",{ref:s,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(E){a.current.scrollTo({top:0,behavior:"smooth"})},children:(0,t.jsx)(Ur.Z,{className:"text-[16px]"})}),(0,t.jsx)(Wr,{uploadedFiles:U,handleRemoveFile:h}),(0,t.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(U.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,t.jsx)(Kr,{agentChatRoomId:u,abilitiesList:l,abilityId:J,setAbilityId:me,clearContext:I}),(0,t.jsx)(Yr,{userSendvalue:ae,setUserSendvalue:ee,disableInput:_,isUploading:b,isStop:n,userSendmessage:z,handleFileUpload:Fe,sendMessage:ue,stopChatRoom:le})]})]})}),Xr=(0,m.memo)(function(i){var e=i.agentList,r=i.agentChatRoomId,n=i.abilitiesList,a=i.chatStatus,s=Ge(),o=s.scrollDomRef,l=s.upButtonDom,u=s.isStop,d=s.setIsStop,v=s.instruction,x=s.setInstruction;(0,m.useEffect)(function(){a==1&&d(!0)},[a]);var f=be.ZP.useMessage(),_=L()(f,2),y=_[0],j=_[1];return(0,t.jsxs)(t.Fragment,{children:[j,(0,t.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(r?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)(Or,{instruction:v,messageApi:y,scrollDomRef:o,setIsStop:d,upButtonDom:l,agentList:e,agentChatRoomId:r,abilitiesList:n}),(0,t.jsx)(Qr,{messageApi:y,isStop:u,upButtonDom:l,scrollDomRef:o,agentList:e,agentChatRoomId:r,abilitiesList:n,chatStatus:a})]})})]})}),qr=(0,m.memo)(function(i){return(0,t.jsx)(rr,{agentChatRoomId:i.agentChatRoomId,agentList:i.agentList,children:(0,t.jsx)(Xr,C()({},i))})})},38008:function(at,Se,c){c.d(Se,{Zc:function(){return m},aS:function(){return xe}});var Pe=c(67294),C=c(85750),Le=c(58299),L=c(85893),be=(0,Pe.createContext)(void 0),xe=function(je){var te=je.children,Ce=(0,Le.m)(),Y=Ce.options,ye=(0,Pe.useMemo)(function(){var se=function(F){if(!F||!Y)return!1;var Ee=(0,C.ti)(F,{options:Y});return(Ee==null?void 0:Ee.support_image)===1},ce=function(F){return se(F)};return{isImageSupportModel:se,getCurrentModelImageSupport:ce}},[Y]);return(0,L.jsx)(be.Provider,{value:ye,children:te})},m=function(){var je=(0,Pe.useContext)(be);if(je===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return je},Te=null},77295:function(at,Se,c){c.d(Se,{CO:function(){return Y}});var Pe=c(15009),C=c.n(Pe),Le=c(19632),L=c.n(Le),be=c(99289),xe=c.n(be),m=c(5574),Te=c.n(m),X=c(45360),je=c(76772),te=c(67294),Ce=c(83065),Y=function(ce){var B,F=ce==null||(B=ce.split(".").pop())===null||B===void 0?void 0:B.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(F||"")},ye=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=(0,je.useIntl)(),F=(0,te.useState)([]),Ee=Te()(F,2),H=Ee[0],t=Ee[1],Je=(0,te.useState)(!1),Me=Te()(Je,2),Be=Me[0],_e=Me[1],de=ce.maxSizeMB,fe=de===void 0?15:de,Oe=ce.acceptedFileTypes,tt=Oe===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Oe,ot=ce.multiple,vt=ot===void 0?!0:ot,pt=function(){var Re=document.createElement("input");Re.type="file",Re.accept=tt,Re.multiple=vt,Re.onchange=function(){var Ie=xe()(C()().mark(function We(st){var qe,he,He,rt,ze,De,ke,nt,it,lt,Ue,et,ut,ct;return C()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(qe=st.target,!(qe.files&&qe.files.length>0)){q.next=37;break}if(_e(!0),he=Array.from(qe.files),He=he.filter(function(Ke){return Ke.size/1024/1024>fe}),!(He.length>0)){q.next=9;break}return X.ZP.error("".concat(He.map(function(Ke){return Ke.name}).join(", ")," ").concat(B.formatMessage({id:"workflow.uploadFileErrorText"}))),_e(!1),q.abrupt("return");case 9:rt=[],ze=0,De=he;case 11:if(!(ze<De.length)){q.next=35;break}return ke=De[ze],nt=new FormData,nt.append("file",ke),q.prev=15,q.next=18,(0,Ce.M$)();case 18:return it=q.sent,q.next=21,fetch(it,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:nt});case 21:return lt=q.sent,q.next=24,lt.json();case 24:Ue=q.sent,Ue.code===0?(X.ZP.success("".concat(ke.name," ").concat(B.formatMessage({id:"workflow.uploadSuccess"}))),(et=Ue.data)!==null&&et!==void 0&&et.file_id&&(ut=Y(ke.name),ct={name:ke.name,url:Ue.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:ut,file_id:Ue.data.file_id,path_show:Ue.data.file_url||Ue.data.path_show||""},rt.push(ct))):X.ZP.error("".concat(ke.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"}))),q.next=32;break;case 28:q.prev=28,q.t0=q.catch(15),console.error("Upload error:",q.t0),X.ZP.error("".concat(ke.name," ").concat(B.formatMessage({id:"workflow.uploadFailed"})));case 32:ze++,q.next=11;break;case 35:t(function(Ke){return[].concat(L()(Ke),rt)}),_e(!1);case 37:case"end":return q.stop()}},We,null,[[15,28]])}));return function(We){return Ie.apply(this,arguments)}}(),Re.click()},Ye=function(Re){t(function(Ie){return Ie.filter(function(We){return We.uid!==Re})})},Qe=function(){t([])};return{uploadedFiles:H,setUploadedFiles:t,handleUpload:pt,removeFile:Ye,clearFiles:Qe,isUploading:Be}};Se.ZP=ye},58299:function(at,Se,c){c.d(Se,{m:function(){return Y}});var Pe=c(64599),C=c.n(Pe),Le=c(97857),L=c.n(Le),be=c(15009),xe=c.n(be),m=c(99289),Te=c.n(m),X=c(73445),je=c(42237),te=c(67294),Ce=(0,X.Ue)(function(ye){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var se=Te()(xe()().mark(function B(){var F;return xe()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.prev=0,ye({loading:!0}),H.next=4,(0,je.fZ)();case 4:if(F=H.sent,F.code!==0){H.next=9;break}ye({models:Array.isArray(F.data.data)?F.data.data:[],initialized:!0}),H.next=10;break;case 9:throw new Error(F.message||"Failed to fetch models");case 10:H.next=15;break;case 12:H.prev=12,H.t0=H.catch(0),ye({error:H.t0.message});case 15:return H.prev=15,ye({loading:!1}),H.finish(15);case 18:case"end":return H.stop()}},B,null,[[0,12,15,18]])}));function ce(){return se.apply(this,arguments)}return ce}()}}),Y=function(){var se=Ce(function(H){return H.models}),ce=Ce(function(H){return H.loading}),B=Ce(function(H){return H.initialized}),F=Ce(function(H){return H.fetchModels});(0,te.useEffect)(function(){B||F()},[B,F]);var Ee=(0,te.useMemo)(function(){var H=Array.isArray(se)?se:[],t=H.map(function(fe){return{label:fe.supplier_name,options:Array.isArray(fe.model_list)?fe.model_list.map(function(Oe){return L()({label:Oe.model_name,value:Oe.model_config_id},Oe)}):[]}}),Je,Me=C()(H),Be;try{for(Me.s();!(Be=Me.n()).done;){var _e=Be.value;if(Array.isArray(_e.model_list)){var de=_e.model_list.find(function(fe){return fe.model_default_used===1});if(de){Je=de.model_config_id;break}}}}catch(fe){Me.e(fe)}finally{Me.f()}return{options:t,defaultValue:Je}},[se]);return L()(L()({},Ee),{},{loading:ce})}}}]);
