"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[145],{80459:function(pt,Be,s){var De=s(32332),R=s(67294),ke=s(85893),Z=function(q){var ue=q.width,Se=ue===void 0?"40px":ue,H=q.bg,be=H===void 0?"#F4F8F1":H,me=q.rounded,Oe=me===void 0?"6px":me,U=q.data,K=q.imgWidth,M=K===void 0?"18px":K,N=q.background;U!=null&&U.avatar&&(M=Se);var S=N||be;return(0,ke.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:Se,height:Se,backgroundColor:S,borderRadius:Oe},children:(0,ke.jsx)("img",{src:U!=null&&U.avatar?U.avatar:(0,De.s9)("single",U==null?void 0:U.icon),style:{width:M,height:M,borderRadius:Oe},alt:""})})};Be.Z=(0,R.memo)(Z)},80279:function(pt,Be,s){s.d(Be,{F:function(){return En}});var De=s(5574),R=s.n(De),ke=s(45360),Z=s(55026),x=s(67294),q=s(15009),ue=s.n(q),Se=s(19632),H=s.n(Se),be=s(99289),me=s.n(be),Oe=s(9783),U=s.n(Oe),K=s(97857),M=s.n(K),N=s(43722),S=s(39e3),P=s(35312),ne=s(74330),G=s(41428),e=s(85893),ot=function(t){var n=t.roomid,a=(0,P.useIntl)(),r=(0,S.Z)(function(m){return m.setSummaryClick}),o=(0,x.useState)(!0),u=R()(o,2),l=u[0],d=u[1],c=(0,S.Z)(function(m){return m.summaryClick});(0,x.useEffect)(function(){d(c)},[c]);var g=(0,S.Z)(function(m){return m.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(l?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){l&&(g({id:n}),r(!1))},children:[(0,e.jsx)(G.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:a.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},We=s(80459),Ve=s(32332),je=s(22683),Ze=s(97807),He=s(55060),se=s(28036),Ie=s(69753),Re=s(97245),E=s(77295),F=function(t,n){try{var a=document.createElement("a");a.href=t,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",r)}},de=function(t){var n=t.fileList,a=t.onDownload,r=a===void 0?F:a,o=t.className,u=o===void 0?"":o,l=t.showInGrid,d=l===void 0?!1:l,c=t.maxHeight;return!n||n.length===0?null:(0,e.jsx)("div",{className:"mb-2 ".concat(u),style:{maxHeight:c,overflow:c?"auto":"visible"},children:(0,e.jsx)(He.Z.PreviewGroup,{children:(0,e.jsx)("div",{className:"".concat(d?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:n.map(function(g,m){var C=g.path_show||g.url,I=(0,E.CO)(g.name);return(0,e.jsx)("div",{className:"".concat(d?"":"mb-2"),children:I?(0,e.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,e.jsx)(He.Z,{src:C,alt:g.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(se.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(Ie.Z,{}),onClick:function(p){p.stopPropagation(),r(C,g.name)}})})]}):(0,e.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,e.jsx)(Re.Z,{className:"mr-2 flex-shrink-0"}),(0,e.jsx)("span",{className:"text-sm truncate",children:g.name})]}),(0,e.jsx)(se.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ie.Z,{}),onClick:function(){return r(C,g.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(g.uid||g.file_id||m))})})})})},xe=de,ce=s(13769),re=s.n(ce),Fe=function(){var i=me()(ue()().mark(function t(n){return ue()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(navigator.clipboard&&navigator.clipboard.writeText)){r.next=5;break}return r.next=4,navigator.clipboard.writeText(n);case 4:return r.abrupt("return",!0);case 5:return r.abrupt("return",Xe(n));case 8:return r.prev=8,r.t0=r.catch(0),console.error("Failed to copy using Clipboard API:",r.t0),r.abrupt("return",Xe(n));case 12:case"end":return r.stop()}},t,null,[[0,8]])}));return function(n){return i.apply(this,arguments)}}(),Xe=function(t){try{var n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select();var a=document.execCommand("copy");return document.body.removeChild(n),a}catch(r){return console.error("Fallback copy failed:",r),!1}},ht=s(64599),qe=s.n(ht),Te=s(52677),ae=s.n(Te),et=function(t,n){try{var a=document.createElement("a");a.href=t,a.download=n,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){}},tt=function i(t){return typeof t=="string"?t:Array.isArray(t)?t.map(i).join(""):x.isValidElement(t)?i(t.props.children):""},Pe=function(t){return tt(t)},fe=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!t||ae()(t)!=="object")return console.warn("hasMessageContent: Invalid message object provided"),!1;var a=n.checkText,r=a===void 0?!0:a,o=n.checkFiles,u=o===void 0?!0:o,l=n.checkMCPTools,d=l===void 0?!0:l,c=n.checkStreaming,g=c===void 0?!0:c,m=n.minTextLength,C=m===void 0?1:m,I=function(){if(!r)return!1;try{var D=t.content;return D&&typeof D=="string"&&D.trim().length>=C}catch(z){return console.warn("Error checking text content:",z),!1}},_=function(){if(!u)return!1;try{var D=t.fileList||t.file_list;return D&&Array.isArray(D)&&D.length>0}catch(z){return console.warn("Error checking file content:",z),!1}},p=function(){if(!d)return!1;try{var D;if((D=t.parsedContent)!==null&&D!==void 0&&D.hasMCPTools)return!0;if(t.contentBlocks&&Array.isArray(t.contentBlocks)){var z=t.contentBlocks.some(function(V){return V&&V.type==="mcp"&&V.toolId});if(z)return!0}return t.activeMCPTools&&Array.isArray(t.activeMCPTools)?t.activeMCPTools.length>0:!1}catch(V){return console.warn("Error checking MCP content:",V),!1}},O=function(){if(!g)return!1;try{return t.contentBlocks&&Array.isArray(t.contentBlocks)?t.contentBlocks.some(function(D){return D&&D.type==="text"&&D.content&&D.content.trim().length>=C}):!1}catch(D){return console.warn("Error checking streaming content:",D),!1}};return I()||_()||p()||O()}catch(b){return console.error("hasMessageContent unexpected error:",b),!0}},dt=function(t){try{var n=(t==null?void 0:t.content)||"",a=(t==null?void 0:t.fileList)||(t==null?void 0:t.file_list)||[],r=(t==null?void 0:t.parsedContent)||{},o=(t==null?void 0:t.contentBlocks)||[],u=(t==null?void 0:t.activeMCPTools)||[];return{hasText:n&&typeof n=="string"&&n.trim().length>0,hasFiles:Array.isArray(a)&&a.length>0,hasParsedMCP:!!r.hasMCPTools,hasContentBlocksMCP:o.some(function(l){return(l==null?void 0:l.type)==="mcp"}),hasActiveMCP:Array.isArray(u)&&u.length>0,hasStreamingText:o.some(function(l){var d;return(l==null?void 0:l.type)==="text"&&(l==null||(d=l.content)===null||d===void 0?void 0:d.trim())}),textLength:n?n.trim().length:0,fileCount:Array.isArray(a)?a.length:0,mcpToolCount:Array.isArray(u)?u.length:0,blockCount:Array.isArray(o)?o.length:0}}catch(l){return console.error("analyzeMessageContent error:",l),{hasText:!1,hasFiles:!1,hasParsedMCP:!1,hasContentBlocksMCP:!1,hasActiveMCP:!1,hasStreamingText:!1,textLength:0,fileCount:0,mcpToolCount:0,blockCount:0}}},st=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};try{if(!t||!Array.isArray(t)||t.length===0)return null;var a=qe()(t),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o&&o.is_agent===1&&fe(o,M()({checkText:!0,checkFiles:!0,checkMCPTools:!0,minTextLength:1},n)))return o}}catch(u){a.e(u)}finally{a.f()}return null}catch(u){return console.error("checkLastAgentMessage error:",u),null}},mt=function(t){return!(t!=null&&t.blocks)||!Array.isArray(t.blocks)?[]:t.blocks.map(function(n){var a;return n.type==="text"?{type:"text",content:n.content||"",timestamp:Date.now()}:n.type==="mcp-tool"&&(a=n.toolData)!==null&&a!==void 0&&a.id?{type:"mcp",toolId:n.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},$e=function(t){return t.filter(function(n){return n.type==="mcp"&&n.toolId}).map(function(n){return n.toolId})},it=function(t,n){try{var a=M()(M()({},t),{},{content:t.content||"",activeMCPTools:t.activeMCTools||[]}),r=t.contentBlocks;if(!r&&t.parsedContent?r=mt(t.parsedContent):!r&&t.content&&(r=[{type:"text",content:t.content,timestamp:Date.now()}]),n&&r){var o=$e(r);a.activeMCPTools=o}return a.contentBlocks=r||[],a}catch(u){return console.error("prepareHistoryMessageForCurrent error:",u),t}},ft=["node","className","children"],ee=["node"],lt=function(t,n){return{code:function(r){var o=r.node,u=r.className,l=r.children,d=re()(r,ft),c=/language-(\w+)/.exec(u||"");if(c!=null&&c.length){var g=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:c[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var m=me()(ue()().mark(function C(I){var _,p;return ue()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,_=I.currentTarget,b.next=4,Fe(Pe(l));case 4:p=b.sent,p&&_?(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"}),setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200)):_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",setTimeout(function(){_&&(_.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},1e3)),b.next=11;break;case 8:b.prev=8,b.t0=b.catch(0),console.error("Failed to copy text: ",b.t0);case 11:case"end":return b.stop()}},C,null,[[0,8]])}));return function(C){return m.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(g).concat(t),className:"p-4",children:l})})]})}else return(0,e.jsx)("code",M()(M()({},d),{},{children:l}))},img:function(r){var o=r.node,u=re()(r,ee),l=function(c,g){try{var m=document.createElement("a");m.href=c,m.download=g,m.target="_blank",document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(C){}};return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(He.Z,{src:u.src,alt:u.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(se.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(Ie.Z,{}),onClick:function(c){c.stopPropagation(),l(u.src||"",u.alt||"image.png")}})})]})}}},W="<<<mcp-tool-start>>>",Ke="<<<mcp-tool-end>>>",jt=function(t){if(typeof t!="string"||t===null||t===void 0)return console.warn("extractMCPTools: content is not a valid string:",t),[];for(var n=[],a=0;;){var r=t.indexOf(W,a);if(r===-1)break;var o=t.indexOf(Ke,r);if(o===-1)break;var u=r+W.length,l=t.substring(u,o).trim();try{var d=JSON.parse(l),c={id:d.id,name:d.name||"",skill_or_workflow_name:d.skill_or_workflow_name||"",workflow_run_id:d.workflow_run_id||0,workflow_confirmation_status:d.workflow_confirmation_status||null,args:d.args||{},result:d.result||null};n.push({toolData:c,startIndex:r,endIndex:o+Ke.length})}catch(g){console.error("Failed to parse MCP tool JSON:",g)}a=o+Ke.length}return n},Dt=function(t){if(typeof t!="string"||t===null||t===void 0)return console.warn("splitContentBlocks: content is not a valid string:",t),[{type:"text",content:""}];var n=jt(t);if(n.length===0)return[{type:"text",content:t}];var a=[],r=0;if(n.forEach(function(u){if(u.startIndex>r){var l=t.substring(r,u.startIndex).trim();l&&a.push({type:"text",content:l})}a.push({type:"mcp-tool",content:t.substring(u.startIndex,u.endIndex),toolData:u.toolData}),r=u.endIndex}),r<t.length){var o=t.substring(r).trim();o&&a.push({type:"text",content:o})}return a},Le=function(t){if(typeof t!="string"||t===null||t===void 0)return console.warn("parseMCPContent: content is not a valid string:",t),{blocks:[{type:"text",content:""}],hasMCPTools:!1};var n=Dt(t),a=n.some(function(r){return r.type==="mcp-tool"});return{blocks:n,hasMCPTools:a}},kt=function(t,n,a){var r=_objectSpread({},t);r.mcpTools||(r.mcpTools=[]);var o=r.mcpTools.findIndex(function(u){return u.id===n});return o>=0?r.mcpTools[o]=_objectSpread(_objectSpread({},r.mcpTools[o]),a):r.mcpTools.push(_objectSpread({id:n,status:"pending",name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},a)),r},St=function(t,n){return!t.mcpTools||!Array.isArray(t.mcpTools)?null:t.mcpTools.find(function(a){return a.id===n})||null},It=function(t,n){var a=_objectSpread({},t);return a.mcpTools&&Array.isArray(a.mcpTools)&&(a.mcpTools=a.mcpTools.filter(function(r){return r.id!==n})),a},Qe=function(t){return!t.mcpTools||!Array.isArray(t.mcpTools)?[]:_toConsumableArray(t.mcpTools).sort(function(n,a){return String(n.id).localeCompare(String(a.id))})},Mt=function(t){try{var n={id:t.id,name:t.name,skill_or_workflow_name:t.skill_or_workflow_name,workflow_run_id:t.workflow_run_id,workflow_confirmation_status:t.workflow_confirmation_status,args:t.args,result:t.result},a=JSON.stringify(n,null,0);return"".concat(W).concat(a).concat(Ke)}catch(r){return console.error("Failed to serialize MCP tool:",r),""}},vt=function(t,n){try{if(!t||!Array.isArray(t))return console.warn("reconstructContentWithUpdatedMCPTools: contentBlocks is not a valid array"),"";var a="";return t.forEach(function(r){if(r.type==="text")a+=r.content||"";else if(r.type==="mcp"&&r.toolId){var o=n(r.toolId);if(o){var u=Mt(o);a+=u}else console.warn("MCP tool ".concat(r.toolId," not found in runtime data"))}}),a}catch(r){return console.error("Failed to reconstruct content with updated MCP tools:",r),""}},bt=s(71471),gt=s(47221),xt=s(66309),w=s(4393),Y=s(97175),ve=s(4161),_t=s(49354),at=s(45699),ut=s(8751),nt=s(79090),yt=s(66212),Tt=s(11475),Pt=s(2830),Ot=s(87547),B=function(i){return i.PENDING="pending",i.RUNNING="running",i.COMPLETED="completed",i.FAILED="failed",i.WAITING_CONFIRMATION="waiting_confirmation",i}({}),Rt=function(t,n){if(t){if(t.status==="waiting_confirm")return B.WAITING_CONFIRMATION;if(n===null)return B.RUNNING}if(n!==null){if(typeof n=="string")try{var a=JSON.parse(n);if(a.status==="failed")return B.FAILED}catch(r){}else if(ae()(n)==="object"&&n.status==="failed")return B.FAILED;return B.COMPLETED}return B.PENDING},Wt=s(29608),Ge=bt.Z.Text,An=bt.Z.Paragraph,wt=gt.Z.Panel,Zt=function(t){var n=t.toLowerCase().split(".").pop(),a="text-sm";switch(n){case"xlsx":case"xls":case"csv":return(0,e.jsx)(Y.Z,{className:"text-green-600 ".concat(a)});case"doc":case"docx":return(0,e.jsx)(ve.Z,{className:"text-blue-600 ".concat(a)});case"pdf":return(0,e.jsx)(_t.Z,{className:"text-red-600 ".concat(a)});case"jpg":case"jpeg":case"png":case"gif":case"svg":return(0,e.jsx)(at.Z,{className:"text-purple-600 ".concat(a)});default:return(0,e.jsx)(Re.Z,{className:"text-gray-600 ".concat(a)})}},Ht=function(t){var n=t.fileList,a=t.intl,r=function(u,l){try{var d=document.createElement("a");d.href=u,d.download=l,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(c){console.error("Download file failed",c)}};return!n||n.length===0?null:(0,e.jsx)("div",{className:"space-y-1",children:n.map(function(o,u){return(0,e.jsxs)("div",{className:"mb-2 last:mb-0",children:[o.variable_name&&(0,e.jsx)("div",{className:"mb-1",children:(0,e.jsxs)(Ge,{strong:!0,className:"text-xs text-gray-700",children:[o.variable_name,":"]})}),(0,e.jsx)("div",{className:"bg-green-50 border-l-4 border-l-green-400 border border-green-200 rounded p-2 hover:bg-green-100 transition-all duration-200",children:(0,e.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:Zt(o.file_name)}),(0,e.jsx)("div",{className:"flex-1 min-w-0",children:(0,e.jsx)("div",{className:"text-xs text-gray-800 truncate font-mono",children:o.file_name})})]}),(0,e.jsx)(se.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Ie.Z,{}),onClick:function(){return r(o.file_path,o.file_name)},className:"flex-shrink-0 text-green-600 hover:text-green-800 hover:bg-green-200 rounded transition-colors duration-200",title:a.formatMessage({id:"app.chatroom.mcptool.downloadFile"})})]})})]},u)})})},Kt=function(t){var n=t.status;switch(n){case B.COMPLETED:return(0,e.jsx)(ut.Z,{className:"text-green-500"});case B.RUNNING:return(0,e.jsx)(nt.Z,{className:"text-blue-500"});case B.WAITING_CONFIRMATION:return(0,e.jsx)(yt.Z,{className:"text-orange-500"});case B.FAILED:return(0,e.jsx)(Tt.Z,{className:"text-red-500"});default:return(0,e.jsx)(yt.Z,{className:"text-gray-500"})}},Gt=function(t){var n=t.status,a=t.intl,r=function(l){switch(l){case B.COMPLETED:return{color:"success",text:a.formatMessage({id:"app.chatroom.mcptool.status.completed"})};case B.RUNNING:return{color:"processing",text:a.formatMessage({id:"app.chatroom.mcptool.status.running"})};case B.WAITING_CONFIRMATION:return{color:"warning",text:a.formatMessage({id:"app.chatroom.mcptool.status.waiting"})};case B.FAILED:return{color:"error",text:a.formatMessage({id:"app.chatroom.mcptool.status.failed"})};default:return{color:"default",text:a.formatMessage({id:"app.chatroom.mcptool.status.pending"})}}},o=r(n);return(0,e.jsx)(xt.Z,{color:o.color,children:o.text})},Ct=function(t){if(t==null)return"null";if(typeof t=="string")try{var n=JSON.parse(t);return JSON.stringify(n,null,2)}catch(a){return t}try{return JSON.stringify(t,null,2)}catch(a){return String(t)}},zt=function(t,n){return t.includes("skill")?n.formatMessage({id:"app.chatroom.mcptool.type.skill"}):t.includes("workflow")?n.formatMessage({id:"app.chatroom.mcptool.type.workflow"}):n.formatMessage({id:"app.chatroom.mcptool.type.tool"})},Vt=function(t){if(!t||ae()(t)!=="object")return{specialFields:{},regularFields:t};var n={},a={};return Object.keys(t).forEach(function(r){r==="input_variables"?n[r]=t[r]:a[r]=t[r]}),{specialFields:n,regularFields:a}},$t=function(t){var n=t.inputVariables,a=t.intl;return!n||ae()(n)!=="object"||Object.keys(n).length===0?null:(0,e.jsxs)("div",{className:"mb-3",children:[(0,e.jsx)("div",{className:"mb-2",children:(0,e.jsx)(Ge,{strong:!0,className:"text-blue-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.inputVariables"})})}),(0,e.jsx)("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:Object.entries(n).map(function(r){var o=R()(r,2),u=o[0],l=o[1];return(0,e.jsxs)("div",{className:"flex items-start gap-2 mb-1 last:mb-0",children:[(0,e.jsxs)(Ge,{strong:!0,className:"text-xs text-gray-700 min-w-0 flex-shrink-0",children:[u,":"]}),(0,e.jsx)(Ge,{className:"text-xs text-gray-800 break-words flex-1 whitespace-pre-wrap",children:typeof l=="string"?l:JSON.stringify(l)})]},u)})})]})},Jt=function(t){var n=t.args,a=t.intl;try{var r=Vt(n),o=r.specialFields,u=r.regularFields,l=o.input_variables&&Object.keys(o.input_variables).length>0,d=u&&Object.keys(u).length>0;return!l&&!d?(0,e.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noParameters"})}):(0,e.jsxs)("div",{children:[l&&(0,e.jsx)($t,{inputVariables:o.input_variables,intl:a}),d&&(0,e.jsxs)("div",{children:[l&&(0,e.jsx)("div",{className:"mb-2",children:(0,e.jsx)(Ge,{strong:!0,className:"text-gray-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.otherParameters"})})}),(0,e.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,e.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Ct(u)})})]})]})}catch(c){return console.warn("Failed to parse parameters for enhanced display:",c),(0,e.jsx)("div",{className:"bg-gray-50 p-2 rounded text-xs",children:(0,e.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Ct(n)})})}},Yt=function(t){var n=t.resultData,a=t.intl,r=t.status,o=n;if(typeof n=="string")try{o=JSON.parse(n)}catch(m){o=n}var u=o&&ae()(o)==="object"&&o.status==="success"&&o.outputs&&ae()(o.outputs)==="object";if(u){var l=o.outputs,d=o.file_list,c=Object.keys(l).length>0,g=d&&Array.isArray(d)&&d.length>0;return!c&&!g?(0,e.jsx)("div",{className:"bg-green-50 p-2 rounded text-xs text-gray-500",children:a.formatMessage({id:"app.chatroom.mcptool.noOutputs"})}):(0,e.jsxs)("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[c&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mb-2",children:(0,e.jsx)(Ge,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.outputs"})})}),Object.entries(l).map(function(m){var C=R()(m,2),I=C[0],_=C[1];return(0,e.jsxs)("div",{className:"mb-3 last:mb-0",children:[(0,e.jsx)("div",{className:"mb-1",children:(0,e.jsxs)(Ge,{strong:!0,className:"text-xs text-gray-700",children:[I,":"]})}),(0,e.jsx)("div",{className:"bg-white p-2 rounded border border-green-300 whitespace-pre-wrap",children:typeof _=="string"?(0,e.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(0,a),className:"text-xs [&_p]:mb-1 [&_p:last-child]:mb-0 [&_pre]:text-xs [&_code]:text-xs",children:_}):(0,e.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono text-xs text-gray-800",children:Ct(_)})})]},I)})]}),g&&(0,e.jsxs)("div",{className:c?"mt-4":"",children:[(0,e.jsx)("div",{className:"mb-2",children:(0,e.jsx)(Ge,{strong:!0,className:"text-green-600 text-sm",children:a.formatMessage({id:"app.chatroom.mcptool.files"})})}),(0,e.jsx)("div",{className:"bg-white p-3 rounded border border-green-300",children:(0,e.jsx)(Ht,{fileList:d,intl:a})})]})]})}return(0,e.jsx)("div",{className:"p-2 rounded text-xs ".concat(r===B.FAILED?"bg-red-50":"bg-green-50"),children:(0,e.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Ct(n)})})},Nt=function(t){var n=t.toolData,a=t.intl,r=t.runtimeData,o=(r==null?void 0:r.status)||Rt(n.workflow_confirmation_status,n.result),u=zt(n.name,a),l=(r==null?void 0:r.workflow_confirmation)||n.workflow_confirmation_status,d=(0,Wt.Z)(function(I){return I.setDealtWithData}),c=(r==null?void 0:r.result)||n.result,g=null;if(typeof c=="string")try{var m=JSON.parse(c);m.status==="failed"&&(g=m.message)}catch(I){}else ae()(c)==="object"&&(c==null?void 0:c.status)==="failed"&&(g=c.message);var C=function(){d(M()(M()({},l),{},{exec_id:l.node_exec_id}))};return(0,e.jsxs)(w.Z,{className:"mb-3 border border-gray-200 shadow-sm",size:"small",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,e.jsx)(Pt.Z,{className:"text-blue-500"}),(0,e.jsx)(Ge,{strong:!0,className:"text-sm",children:(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name}),(0,e.jsx)(xt.Z,{color:"blue",children:u}),(0,e.jsx)(Kt,{status:o}),(0,e.jsx)(Gt,{status:o,intl:a})]}),l&&o!==B.COMPLETED&&o!==B.FAILED&&(0,e.jsx)("div",{className:"mb-2 p-2 bg-orange-50 border border-orange-200 rounded",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(Ot.Z,{className:"text-orange-500"}),(0,e.jsxs)(Ge,{className:"text-sm font-medium",children:[a.formatMessage({id:"app.chatroom.mcptool.workflow"}),": ",(r==null?void 0:r.skill_or_workflow_name)||n.skill_or_workflow_name]}),l.confirmer_name&&(0,e.jsxs)(Ge,{className:"text-xs text-gray-600",children:[a.formatMessage({id:"app.chatroom.mcptool.confirmer"}),": ",l.confirmer_name]})]}),l.show_todo_button&&(0,e.jsx)(se.ZP,{size:"small",type:"primary",onClick:C,children:a.formatMessage({id:"app.chatroom.mcptool.handleTodo"})})]})}),g&&(0,e.jsx)("div",{className:"mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,e.jsxs)(Ge,{type:"danger",className:"text-xs",children:[a.formatMessage({id:"app.chatroom.mcptool.error"}),": ",g]})}),(0,e.jsxs)(gt.Z,{size:"small",ghost:!0,children:[((r==null?void 0:r.args)||n.args)&&Object.keys((r==null?void 0:r.args)||n.args).length>0&&(0,e.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.parameters"}),children:(0,e.jsx)(Jt,{args:(r==null?void 0:r.args)||n.args,intl:a})},"params"),c&&(0,e.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.result"}),children:(0,e.jsx)(Yt,{resultData:c,intl:a,status:o})},"result"),l&&(0,e.jsx)(wt,{header:a.formatMessage({id:"app.chatroom.mcptool.workflowDetails"}),children:(0,e.jsx)("div",{className:"bg-blue-50 p-2 rounded text-xs",children:(0,e.jsx)("pre",{className:"whitespace-pre-wrap m-0 font-mono",children:Ct(l)})})},"workflow")]})]})},Ft=function(t){var n,a=t.content,r=t.fileList,o=t.index,u=t.intl,l=t.isAgent,d=t.contentId,c=t.mcpTools,g=t.updateMCPTool,m=t.getMCPTool,C=t.item,I=t.contentBlocks,_=(C==null?void 0:C.parsedContent)||Le(a);return(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:l?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:d,children:[r&&r.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(xe,{fileList:r,onDownload:et})}),I&&I.length>0?(0,e.jsx)("div",{children:I.map(function(p,O){var b,D,z,V,we,_e;return(0,e.jsx)("div",{children:p.type==="text"?p.content&&(0,e.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:p.content}):p.toolId&&m&&(0,e.jsx)(Nt,{toolData:{id:p.toolId,name:((b=m(p.toolId))===null||b===void 0?void 0:b.name)||"",skill_or_workflow_name:((D=m(p.toolId))===null||D===void 0?void 0:D.skill_or_workflow_name)||"",workflow_run_id:(z=m(p.toolId))===null||z===void 0?void 0:z.workflow_run_id,workflow_confirmation_status:(V=m(p.toolId))===null||V===void 0?void 0:V.workflow_confirmation_status,args:((we=m(p.toolId))===null||we===void 0?void 0:we.args)||{},result:(_e=m(p.toolId))===null||_e===void 0?void 0:_e.result},intl:u,runtimeData:m(p.toolId)})},"content-block-".concat(O))})}):_.hasMCPTools?(0,e.jsx)("div",{children:_.blocks.map(function(p,O){return(0,e.jsx)("div",{children:p.type==="text"?(0,e.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:p.content}):p.toolData&&(0,e.jsx)(Nt,{toolData:p.toolData,intl:u,runtimeData:m?m(p.toolData.id):null})},O)})}):(0,e.jsx)(je.U,{rehypePlugins:[Ze.Z],components:lt(o,u),children:a}),t.isCurrentMessage&&!I&&(C==null||(n=C.activeMCPTools)===null||n===void 0?void 0:n.length)>0&&(0,e.jsx)("div",{className:"mt-3",children:C.activeMCPTools.map(function(p){return m?m(p):null}).filter(Boolean).map(function(p){return(0,e.jsx)(Nt,{toolData:{name:p.name,skill_or_workflow_name:p.skill_or_workflow_name,workflow_run_id:p.workflow_run_id,workflow_confirmation_status:p.workflow_confirmation_status,args:p.args,result:p.result,id:p.id},intl:u,runtimeData:p},"current-tool-".concat(p.id))})})]})},Xt=(0,x.memo)(function(i){var t=i.messageApi,n=i.index,a=i.idName,r=i.cidName,o=(0,P.useIntl)(),u=(0,x.useState)(!1),l=R()(u,2),d=l[0],c=l[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var g=me()(ue()().mark(function m(C){var I,_,p;return ue()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return I=C.target.closest("#".concat(a).concat(n)),_=I.querySelector("#".concat(r).concat(n)),b.prev=2,b.next=5,Fe(_.innerText);case 5:p=b.sent,p?t.open({type:"success",content:o.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}):t.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2}),b.next=13;break;case 9:b.prev=9,b.t0=b.catch(2),console.error("Failed to copy text: ",b.t0),t.open({type:"error",content:o.formatMessage({id:"app.chatroom.content.copyFailed"})||"Copy failed",duration:2});case 13:case"end":return b.stop()}},m,null,[[2,9]])}));return function(m){return g.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(d?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]",alt:"copy"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(d?" text-[#1B64F3]":"text-[#666]"),children:o.formatMessage({id:"app.chatroom.content.copy"})})]})})}),Qt=s(2068),qt=function(t){var n=t.id,a=t.index,r=t.idName,o=t.cidName,u=(0,P.useIntl)(),l=(0,S.Z)(function(_){return _.setSummaryClick}),d=(0,x.useState)(!0),c=R()(d,2),g=c[0],m=c[1],C=(0,S.Z)(function(_){return _.summaryClick});(0,x.useEffect)(function(){m(C)},[C]);var I=(0,S.Z)(function(_){return _.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(g?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(p){if(g){var O=p.target.closest("#".concat(r).concat(a)),b=O.querySelector("#".concat(o).concat(a));I({id:n,message:b.innerText}),l(!1)}},children:[(0,e.jsx)(Qt.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:u.formatMessage({id:"app.chatroom.content.summary"})})]})})},en=function(t){var n=t.messageApi,a=t.index,r=t.idName,o=t.cidName,u=t.id,l=t.agentChatRoomId,d=t.isAgent;return d?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(Xt,{messageApi:n,index:a,idName:r,cidName:o}),!l&&(0,e.jsx)(qt,{id:u,index:a,idName:r,cidName:o})]}):null},Lt=function(t){var n,a=t.item,r=t.index,o=t.agentChatRoomId,u=t.abilitiesList,l=t.messageApi,d=t.id,c=t.idName,g=t.cidName,m=t.mcpTools,C=t.updateMCPTool,I=t.getMCPTool,_=(0,P.useIntl)(),p=a.is_agent===1;return fe(a)?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(p?"":"flex-row-reverse"),children:[p?(0,e.jsx)(We.Z,{data:a}):(0,e.jsx)(We.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(o?"":"max-w-[560px]"," text-right"),id:"".concat(c).concat(r),children:[(0,e.jsxs)("div",{className:"".concat(p?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[a.name?a.name:(0,Ve.Qy)("GET").nickname,a.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",(u==null||(n=u.find(function(O){return a.ability_id==O.value}))===null||n===void 0?void 0:n.label)||_.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(p?"flex-row":"flex-row-reverse"),children:(0,e.jsx)(Ft,{content:a.content,fileList:a.file_list,index:r,intl:_,isAgent:p,contentId:"".concat(g).concat(r),mcpTools:m,updateMCPTool:C,getMCPTool:I,item:a})}),(0,e.jsx)(en,{messageApi:l,index:r,idName:c,cidName:g,id:d,agentChatRoomId:o,isAgent:p})]})]}):null},tn=s(47635),nn=function(t,n,a,r,o,u,l,d,c,g,m,C,I,_,p,O,b){var D=(0,P.useIntl)(),z=(0,S.Z)(function(L){return L.setTruncatable}),V=function(h){try{var f=JSON.parse(h.slice(22,-2));return Array.isArray(f)&&f.length>=2?[f[0],f[1]]:null}catch(y){return console.warn("Failed to parse instruction:",y),null}},we=function(h){return h.indexOf("--NEXUSAI-INSTRUCTION-")!==-1},_e=function(h){c(function(f){var y=f.contentBlocks||[],v=h(y);return M()(M()({},f),{},{contentBlocks:v})})},Ne=function(h){_e(function(f){var y=f[f.length-1];return y&&y.type==="text"?f.map(function(v,T){return T===f.length-1?M()(M()({},v),{},{content:(v.content||"")+h}):v}):[].concat(H()(f),[{type:"text",content:h,timestamp:Date.now()}])})},Je=function(h){_e(function(f){return[].concat(H()(f),[{type:"mcp",toolId:h,timestamp:Date.now()}])})},Ue=function(h){return!(h!=null&&h.blocks)||!Array.isArray(h.blocks)?[]:h.blocks.map(function(f){var y;return f.type==="text"?{type:"text",content:f.content||"",timestamp:Date.now()}:f.type==="mcp-tool"&&(y=f.toolData)!==null&&y!==void 0&&y.id?{type:"mcp",toolId:f.toolData.id,timestamp:Date.now()}:null}).filter(Boolean)},rt=function(h){return h.filter(function(f){return f.type==="mcp"&&f.toolId}).map(function(f){return f.toolId})},pe=function(h,f){I&&I(h,f),C.current&&Object.keys(g).length>0&&c(function(y){var v=y.activeMCPTools||[],T=v.includes(h)?v:[].concat(H()(v),[h]);return M()(M()({},y),{},{activeMCPTools:T})})},Ee=function(h,f,y){try{if(!h||!Array.isArray(h))return console.warn("syncMCPToolStatesToContentBlocks: contentBlocks is not a valid array"),[];if(!y)return console.warn("syncMCPToolStatesToContentBlocks: getMCPTool function not available"),h;var v=h.filter(function($){return $.type==="mcp"&&$.toolId}).map(function($){return $.toolId}),T=f.filter(function($){return!v.includes($)}),X=T.map(function($){return{type:"mcp",toolId:$,timestamp:Date.now()}});return[].concat(H()(h),H()(X))}catch($){return console.error("Failed to sync MCP tool states to contentBlocks:",$),h}},ze={ERROR:function(h){t(!1),n(!1),a(""),r.open({type:"error",content:"webSocket-".concat(h),duration:10})},CHAT:function(h){if(Object.keys(g).length&&fe(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})){var f,y,v=M()({},g);if(((f=v.activeMCPTools)===null||f===void 0?void 0:f.length)>0||((y=v.contentBlocks)===null||y===void 0?void 0:y.length)>0){var T=Ee(v.contentBlocks||[],v.activeMCPTools||[],O);if(O&&T.length>0){var X=vt(T,O);X?(v.content=X,v.parsedContent=Le(X)):v.content&&(v.parsedContent=Le(v.content))}else v.content&&(v.parsedContent=Le(v.content));v.contentBlocks=T}else v.content&&(v.parsedContent=Le(v.content));o(function(Ce){return Ce.concat(v)}),c({})}var $={content:"".concat(h),is_agent:0};o(function(Ce){return Ce.concat($)}),p&&p(!0),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},WITHFILELIST:function(h){o(function(f){if(f.length===0)return f;var y=f.length-1;return f.map(function(v,T){return T===y?M()(M()({},v),{},{file_list:h}):v})}),requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")})},STOPPABLE:function(h){n(h)},TRUNCATABLE:function(h){z(h),h||r.open({type:"success",content:"".concat(D.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},TRUNCATEOK:function(h){r.open({type:"success",content:"".concat(D.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3})},MCPTOOLUSE:function(h){var f=h.id,y=h.name,v=h.skill_or_workflow_name,T=h.args,X=v&&v.toLowerCase().includes("workflow");pe(f,{name:y,skill_or_workflow_name:v||y,args:T,status:B.RUNNING,isWorkflow:X}),Je(f)},WITHMCPTOOLRESULT:function(h){var f=h.id,y=h.result,v=B.COMPLETED;if(typeof y=="string")try{var T=JSON.parse(y);T.status==="failed"&&(v=B.FAILED)}catch(X){}else ae()(y)==="object"&&(y==null?void 0:y.status)==="failed"&&(v=B.FAILED);pe(f,{result:y,status:v})},WITHWFSTATUS:function(h){var f=h.id,y=h.status,v={id:y.id,status:y.status,app_run_id:y.app_run_id,node_exec_id:y.node_exec_id,workflow_name:y.workflow_name,need_user_confirm:y.need_user_confirm,show_todo_button:y.show_todo_button,confirmer_name:y.confirmer_name},T;switch(y.status){case"running":T=B.RUNNING;break;case"waiting_confirm":T=B.WAITING_CONFIRMATION;break;case"completed":T=B.COMPLETED;break;case"failed":T=B.FAILED;break;default:T=B.RUNNING;break}pe(f,{workflow_confirmation:v,status:T,isWorkflow:!0})}},he=function(h,f){ze[h]=f},ie=function(h){var f=h.data,y=V(f),v=we(f),T=f.indexOf("REPLY")!==-1&&f.indexOf("ENDREPLY")===-1,X=f.indexOf("ABILITY")!==-1,$=f.indexOf("ENDCHAT")!==-1;if(v){if(!y)return;var Ce=y[0],Me=y[1],Ye=ze[Ce];Ye?Ye(Me):console.warn("Unknown message type: ".concat(Ce))}if(v||console.log(C.current,h),!v&&C.current&&(m.current+=f,requestAnimationFrame(function(){u.current&&(u.current.scrollTop=0),l.current&&(l.current.style.display="none")}),c(function(te){var Ae=m.current,ct=M()(M()({},te),{},{content:Ae});return Ae&&(ct.parsedContent=Le(Ae)),ct}),Ne(f)),T&&v){var J=y[1];p&&p(!1);var A=d.current.filter(function(te){return te.agent_id==J})[0];o(function(te){var Ae=te;return Object.keys(g).length&&fe(g,{checkText:!0,checkFiles:!0,checkMCPTools:!0,checkStreaming:!0,minTextLength:1})&&(Ae=te.concat(g)),m.current="",c({is_agent:1,icon:A==null?void 0:A.icon,name:A==null?void 0:A.name,content:"",activeMCPTools:[],agent_id:J,parsedContent:null,contentBlocks:[]}),C.current=!0,n(!0),z(!1),Ae})}if(X&&v){var le=y[1];c(function(te){return M()(M()({},te),{},{is_agent:1,ability_id:le})})}if($){if(C.current=!1,m.current="",t(!1),n(!1),z(!0),Object.keys(g).length){var ge,k,j=M()({},g);if(((ge=j.activeMCPTools)===null||ge===void 0?void 0:ge.length)>0||((k=j.contentBlocks)===null||k===void 0?void 0:k.length)>0){var Q=Ee(j.contentBlocks||[],j.activeMCPTools||[],O);if(O&&Q.length>0){var ye=vt(Q,O);ye?(j.content=ye,j.parsedContent=Le(ye)):j.content&&(j.parsedContent=Le(j.content))}else j.content&&(j.parsedContent=Le(j.content));j.contentBlocks=Q}else j.content&&(j.parsedContent=Le(j.content));o(function(te){return te.concat(j)})}c({}),a("")}};return{getSocketMessage:ie,addMessageHandler:he}},rn=function(t){var n=t.currentMessage,a=t.agentChatRoomId,r=t.intl,o=t.mcpTools,u=o===void 0?{}:o,l=t.updateMCPTool,d=l===void 0?function(){}:l,c=t.getMCPTool,g=c===void 0?function(){return null}:c;return!n.name||!fe(n)?null:(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(n.is_agent!=1?"flex-row-reverse":""),children:[n.is_agent==1?(0,e.jsx)(We.Z,{data:n}):(0,e.jsx)(We.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(a?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(n.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:n.name?n.name:(0,Ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(n.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)(Ft,{content:n.content||"",fileList:n.file_list,index:-1,intl:r,isAgent:n.is_agent==1,contentId:"addchilContent",mcpTools:u,updateMCPTool:d,getMCPTool:g,item:M()(M()({},n),{},{parsedContent:Le(n.content||"")}),isCurrentMessage:!0,contentBlocks:n.contentBlocks})})]})]})},an=(0,x.memo)(function(i){var t=i.messageApi,n=i.setCurrentMessageContent,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,d=i.setisEnd,c=i.setSendValue,g=i.agentChatRoomId,m=i.updateMCPTool,C=i.getCurrentMessageList,I=i.mcpTools,_=I===void 0?{}:I,p=i.getMCPTool,O=p===void 0?function(){return null}:p,b=i.setIsWaitingReply,D=i.removeHistoryMessage,z=i.setCurrentMessageFromHistory,V=(0,P.useIntl)(),we=(0,P.useParams)(),_e=we.id,Ne=(0,P.useLocation)(),Je=new URLSearchParams(Ne.search),Ue=Je.get("id"),rt=g||_e||Ue,pe=(0,S.Z)(function(Me){return Me.setDisableInput}),Ee=(0,x.useState)({}),ze=R()(Ee,2),he=ze[0],ie=ze[1],L=(0,x.useRef)(!1),h=(0,x.useRef)(""),f=(0,x.useCallback)(function(Me){try{if(!Me||ae()(Me)!=="object"){console.warn("Invalid history message provided:",Me);return}if(Me.is_agent!==1){console.warn("Attempted to set non-agent message as current:",Me);return}var Ye=it(Me,O);if(!Ye){console.warn("Failed to prepare history message:",Me);return}ie(Ye),L.current=!0,h.current=Ye.content||""}catch(J){console.error("Failed to set current message from history:",J)}},[O]);(0,x.useEffect)(function(){z&&z(f)},[z,f]);var y=nn(pe,l,c,t,n,o,u,r,ie,he,h,L,m,C,b,O,D),v=y.getSocketMessage,T=(0,tn.Z)("chat",v),X=T.runSocket,$=T.sendMessage,Ce=T.readyState;return(0,x.useEffect)(function(){Ce==1&&rt&&$(JSON.stringify(["ENTER",parseInt(rt)]))},[Ce]),(0,x.useEffect)(function(){a&&Ce==1&&$(a)},[a]),(0,x.useEffect)(function(){X()},[]),(0,e.jsx)(rn,{currentMessage:he,agentChatRoomId:g,intl:V,mcpTools:_,updateMCPTool:m,getMCPTool:O})}),on=function(t){var n=t.type,a=n===void 0?"typing":n,r=t.size,o=r===void 0?"medium":r;if(a==="typing")return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("style",{children:`
                        @keyframes chatroom-typing-bounce {
                            0%, 60%, 100% {
                                transform: translateY(0);
                                opacity: 0.7;
                            }
                            30% {
                                transform: translateY(-8px);
                                opacity: 1;
                            }
                        }
                    `}),(0,e.jsxs)("div",{className:"flex items-center justify-center space-x-1.5",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.2s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm",style:{animation:"chatroom-typing-bounce 1.4s ease-in-out infinite",animationDelay:"0.4s"}})]})]});if(a==="wave"){var u={animation:"chatroom-wave 1.2s ease-in-out infinite",transformOrigin:"bottom"};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("style",{children:`
                        @keyframes chatroom-wave {
                            0%, 40%, 100% { transform: scaleY(0.4); }
                            20% { transform: scaleY(1); }
                        }
                    `}),(0,e.jsx)("div",{className:"flex items-end justify-center space-x-1",children:[0,.1,.2,.3,.4].map(function(l,d){return(0,e.jsx)("div",{className:"w-1 h-4 bg-gradient-to-t from-blue-600 to-blue-400 rounded-sm",style:M()(M()({},u),{},{animationDelay:"".concat(l,"s")})},d)})})]})}return a==="pulse"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("style",{children:`
                        @keyframes chatroom-pulse-ring {
                            0% {
                                transform: scale(0.8);
                                opacity: 1;
                            }
                            100% {
                                transform: scale(2.4);
                                opacity: 0;
                            }
                        }
                        @keyframes chatroom-pulse-dot {
                            0% {
                                transform: scale(0.8);
                            }
                            50% {
                                transform: scale(1);
                            }
                            100% {
                                transform: scale(0.8);
                            }
                        }
                    `}),(0,e.jsxs)("div",{className:"flex items-center justify-center relative w-8 h-8",children:[(0,e.jsx)("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite"}}),(0,e.jsx)("div",{className:"absolute w-3 h-3 bg-blue-400 rounded-full",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",animation:"chatroom-pulse-ring 1.5s ease-out infinite",animationDelay:"0.5s"}}),(0,e.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full relative z-10",style:{animation:"chatroom-pulse-dot 1.5s ease-in-out infinite"}})]})]}):a==="spinner"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("style",{children:`
                        @keyframes chatroom-spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    `}),(0,e.jsx)("div",{className:"flex items-center justify-center",children:(0,e.jsx)("div",{className:"border-4 border-blue-200 border-t-blue-600 rounded-full",style:{width:"20px",height:"20px",animation:"chatroom-spin 1s linear infinite"}})})]}):null},sn=function(t){var n=t.autoRotate,a=n===void 0?!1:n,r=t.rotateInterval,o=r===void 0?3e3:r,u=t.initialType,l=u===void 0?"wave":u,d=t.size,c=d===void 0?"medium":d,g=(0,x.useState)(l),m=R()(g,2),C=m[0],I=m[1],_=["typing","wave","pulse","spinner"];return(0,e.jsx)("div",{className:"transition-all duration-500 ease-in-out",children:(0,e.jsx)(on,{type:C,size:c})})},ln=function(t){var n=t.isVisible,a=t.animationType,r=a===void 0?"pulse":a,o=t.enableAutoRotate,u=o===void 0?!0:o,l=(0,P.useIntl)();return n?(0,e.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[300px]",children:(0,e.jsx)("div",{className:"max-w-full",children:(0,e.jsxs)("div",{className:"max-w-[90%] min-w-[200px] rounded-xl relative  from-blue-50 to-indigo-50 text-gray-800 border border-blue-200 p-4  transition-all duration-300 backdrop-blur-sm",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0 p-2 bg-white rounded-full shadow-sm",children:(0,e.jsx)(sn,{initialType:r,autoRotate:u,rotateInterval:4e3,size:"medium"})}),(0,e.jsx)("div",{className:"flex flex-col",children:(0,e.jsx)("span",{className:"text-gray-700 text-sm font-semibold",children:l.formatMessage({id:"app.chatroom.waitingReply"})})})]}),(0,e.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-white/20 to-transparent pointer-events-none"})]})})}):null},un=(0,x.memo)(function(i){var t=i.messageApi,n=i.setUserMessage,a=i.sendValue,r=i.agentList,o=i.scrollDomRef,u=i.upButtonDom,l=i.setIsStop,d=i.setSendValue,c=i.agentChatRoomId,g=i.abilitiesList,m=i.mcpTools,C=i.updateMCPTool,I=i.getMCPTool,_=i.userMessage,p=(0,x.useState)([]),O=R()(p,2),b=O[0],D=O[1],z=(0,x.useState)(!1),V=R()(z,2),we=V[0],_e=V[1],Ne=(0,x.useState)(!1),Je=R()(Ne,2),Ue=Je[0],rt=Je[1],pe=(0,x.useRef)(!1),Ee=(0,x.useRef)(null),ze=(0,P.useParams)(),he=ze.id,ie=(0,P.useLocation)(),L=new URLSearchParams(ie.search),h=L.get("id"),f=he||h;(0,x.useEffect)(function(){we&&(n(function(v){return[].concat(H()(b.reverse()),H()(v))}),D([]),setTimeout(function(){_e(!1),o.current.scrollTop=0},200))},[we]),(0,x.useEffect)(function(){if(!pe.current&&!(!_||!Array.isArray(_)||_.length===0)){if(!Ee.current){console.warn("setCurrentMessageFromHistory callback not available");return}try{var v=st(_);if(v){if(!v.id){console.warn("Found agent message without ID, skipping:",v),pe.current=!0;return}if(Ee.current(v),n){var T=_.filter(function(X){return X!==v});n(T)}else console.warn("setUserMessage not available for history update");pe.current=!0}}catch(X){console.error("Failed to process history message:",X,{userMessageLength:_==null?void 0:_.length,hasCallback:!!Ee.current}),pe.current=!0}}},[_,n]),(0,x.useEffect)(function(){pe.current=!1},[f]);var y=function(T){if(n&&_){var X=_.filter(function($){return $!==T});n(X)}};return(0,e.jsxs)(e.Fragment,{children:[b.length?b.map(function(v,T){return(0,e.jsx)(Lt,{item:v,index:T,agentChatRoomId:c,abilitiesList:g,messageApi:t,id:f,idName:"currentContent",cidName:"currentChilContent",mcpTools:m,updateMCPTool:C,getMCPTool:I},T)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(ln,{isVisible:Ue}),(0,e.jsx)(an,{messageApi:t,setCurrentMessageContent:D,sendValue:a,agentList:r,scrollDomRef:o,upButtonDom:u,setIsStop:l,setisEnd:_e,setSendValue:d,agentChatRoomId:c,updateMCPTool:C,getCurrentMessageList:function(){return _||[]},mcpTools:m,getMCPTool:I,setIsWaitingReply:rt,removeHistoryMessage:y,setCurrentMessageFromHistory:function(T){Ee.current=T}})]})}),cn=(0,x.memo)(function(i){var t=i.messageApi,n=i.scrollDomRef,a=i.instruction,r=i.setIsStop,o=i.upButtonDom,u=i.setInstruction,l=i.agentList,d=i.agentChatRoomId,c=i.abilitiesList,g=(0,P.useIntl)(),m=(0,x.useState)(860),C=R()(m,2),I=C[0],_=C[1],p=(0,P.useParams)(),O=p.id,b=(0,P.useLocation)(),D=new URLSearchParams(b.search),z=D.get("id"),V=d||O||z,we=(0,x.useState)([]),_e=R()(we,2),Ne=_e[0],Je=_e[1],Ue=(0,x.useRef)(!1),rt=(0,x.useState)(""),pe=R()(rt,2),Ee=pe[0],ze=pe[1],he=(0,x.useRef)(null),ie=(0,x.useRef)(!0),L=(0,x.useState)({}),h=R()(L,2),f=h[0],y=h[1],v=(0,x.useRef)(2),T=(0,x.useRef)(1),X=(0,x.useRef)(0),$=function(j,Q){y(function(ye){var te=ye[j];return te?M()(M()({},ye),{},U()({},j,M()(M()({},te),Q))):M()(M()({},ye),{},U()({},j,M()({id:j,status:B.PENDING,name:"",skill_or_workflow_name:"",workflow_run_id:0,workflow_confirmation_status:null,args:{},result:null},Q)))})},Ce=function(j){return f[j]||null},Me=function(j){var Q=j.map(function(ye){var te=M()({},ye);if(ye.is_agent===1&&ye.content){var Ae=Le(ye.content);te.parsedContent=Ae,Ae.hasMCPTools&&Ae.blocks.forEach(function(ct){if(ct.type==="mcp-tool"&&ct.toolData){var oe=ct.toolData;if(!f[oe.id]){var Et=Rt(oe.workflow_confirmation_status,oe.result);y(function(At){return M()(M()({},At),{},U()({},oe.id,{id:oe.id,name:oe.name,skill_or_workflow_name:oe.skill_or_workflow_name||oe.name,workflow_run_id:oe.workflow_run_id||0,workflow_confirmation_status:oe.workflow_confirmation_status||null,args:oe.args||{},result:oe.result||null,status:Et,isWorkflow:oe.skill_or_workflow_name?oe.skill_or_workflow_name.toLowerCase().includes("workflow"):!1}))})}}})}return te});return Q},Ye=function(){var k=me()(ue()().mark(function j(Q){var ye,te,Ae=arguments;return ue()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(ye=Ae.length>1&&Ae[1]!==void 0?Ae[1]:function(){},!V){oe.next=6;break}return oe.next=4,(0,N.KH)(V,{page:T.current,page_size:10});case 4:te=oe.sent,te.code==0&&(v.current=te.data.total_pages,Q||(he.current.style.display="none"),Je(function(Et){var At=te.data.list.reverse(),Bt=Me(At);return Q?H()(Bt):[].concat(H()(Et),H()(Bt))}),Q?n&&n.current&&setTimeout(function(){n.current.scrollTop=0,o.current.style.display="none"}):X.current=te.data.list.length,ie.current=!0);case 6:case"end":return oe.stop()}},j)}));return function(Q){return k.apply(this,arguments)}}(),J=function(j){var Q=j.target.scrollHeight+(j.target.scrollTop-j.target.clientHeight);Ue.current!==Math.ceil(j.target.scrollTop)<-50&&(Ue.current=Math.ceil(j.target.scrollTop)<-50,o.current.style.display=Ue.current?"flex":"none"),Q<10&&ie.current&&(ie.current=!1,T.current=T.current+1,he.current.style.display="flex",v.current>=T.current?Ye(!1):he.current.style.display="none")},A=function(j,Q){Q==="0"&&(Q=Number(Q));var ye=["".concat(j),Q!==""&&Q!==null&&Q!==void 0?Q:null];ze(JSON.stringify(ye))},le=(0,S.Z)(function(k){return k.disableInput}),ge=(0,S.Z)(function(k){return k.clearMemory});return(0,x.useEffect)(function(){ge&&ge.length&&A(ge[0],ge[1])},[ge]),(0,x.useEffect)(function(){a&&a.length&&(A(a[0],a[1]!==void 0?a[1]:""),u([]))},[a]),(0,x.useEffect)(function(){T.current=1,Ye(!0)},[]),(0,x.useEffect)(function(){var k=function(){window.innerWidth<1280||_(window.innerWidth-320-(window.innerWidth-320)/2-88)};return k(),window.addEventListener("resize",k),function(){window.removeEventListener("resize",k)}},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse items-center scroll-smooth chatroom",ref:n,onScroll:J,children:[(0,e.jsxs)("div",{className:"w-full",style:{minWidth:d?"":"".concat(I,"px")},children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:Ne&&Ne.length?Ne.map(function(k,j){return(0,e.jsx)(Lt,{item:M()(M()({},k),{},{id:"c".concat(k.id)}),index:j,agentChatRoomId:d,abilitiesList:c,messageApi:t,id:V,idName:"content",cidName:"chilContent",mcpTools:f,updateMCPTool:$,getMCPTool:Ce},j)}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)(un,{messageApi:t,setUserMessage:Je,sendValue:Ee,agentList:l,scrollDomRef:n,upButtonDom:o,setIsStop:r,setSendValue:ze,agentChatRoomId:d,abilitiesList:c,mcpTools:f,updateMCPTool:$,getMCPTool:Ce,userMessage:Ne})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!d&&!le&&Ne.length?(0,e.jsx)(ot,{roomid:V}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:he,children:(0,e.jsx)(ne.Z,{})})]})})}),dn=function(t){var n=(0,x.useRef)(null),a=(0,x.useRef)(null),r=(0,x.useState)(!1),o=R()(r,2),u=o[0],l=o[1],d=(0,x.useState)([]),c=R()(d,2),g=c[0],m=c[1],C=(0,P.useParams)(),I=C.id,_=(0,P.useLocation)(),p=new URLSearchParams(_.search),O=p.get("id"),b=t||I||O;return{scrollDomRef:n,upButtonDom:a,isStop:u,setIsStop:l,instruction:g,setInstruction:m,id:b}},mn=s(61227),fn=s.n(mn),vn=s(82114),pn=s(77171),hn=s(85576),Ut=s(96486),gn=s(58299),xn=s(38008),_n=s(83062),yn=function(t){var n=t.uploadedFiles,a=t.handleRemoveFile;return n.length?(0,e.jsx)(He.Z.PreviewGroup,{children:(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(function(r){return(0,e.jsx)(xt.Z,{closable:!0,onClose:function(){return a(r.uid)},className:"flex items-center ".concat(r.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(_n.Z,{title:r.name,children:(0,e.jsx)("div",{className:"flex items-center",children:r.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(He.Z,{src:r.path_show||r.url,alt:r.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:r.path_show||r.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,e.jsx)(Ie.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),et(r.path_show||r.url,r.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Re.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:r.name}),(0,e.jsx)(Ie.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(u){u.stopPropagation(),et(r.path_show||r.url,r.name)}})]})})})},r.uid)})})})}):null},Cn=s(52645),Mn=s(64317),bn=function(t){var n=t.agentChatRoomId,a=t.abilitiesList,r=t.abilityId,o=t.setAbilityId,u=t.clearContext,l=(0,P.useIntl)();return n?(0,e.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(a==null?void 0:a.length)>0&&(0,e.jsx)(Mn.Z,{label:l.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:r,fieldProps:{placeholder:l.formatMessage({id:"agent.pleaseselect"}),allowClear:!1,size:"small",onChange:function(c){o(c)}},formItemProps:{className:"m-0"}}),(0,e.jsx)(se.ZP,{size:"small",color:"danger",variant:"outlined",onClick:u,icon:(0,e.jsx)(Cn.Z,{}),children:l.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}):null},jn=s(88484),In=s(30159),Tn=s(26915),Pn=Tn.Z.TextArea,wn=function(t){var n=t.userSendvalue,a=t.setUserSendvalue,r=t.disableInput,o=t.isUploading,u=t.isStop,l=t.userSendmessage,d=t.handleFileUpload,c=t.sendMessage,g=t.stopChatRoom,m=(0,P.useIntl)(),C=(0,Ut.throttle)(function(){if(r||!n)return!1;c(n)},300);return(0,e.jsxs)("div",{className:"flex items-center gap-[10px] box-border",children:[(0,e.jsx)(se.ZP,{type:"text",icon:(0,e.jsx)(jn.Z,{}),onClick:d,disabled:r||o,loading:o}),(0,e.jsx)(Pn,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:n,disabled:r,onChange:function(_){a(_.target.value)},onPressEnter:l,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(m.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),u?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:g,children:(0,e.jsx)(In.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(r||!n?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:C,children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})},Nn=(0,x.memo)(function(i){var t,n=i.setInstruction,a=i.messageApi,r=i.isStop,o=i.scrollDomRef,u=i.upButtonDom,l=i.agentList,d=i.abilitiesList,c=i.agentChatRoomId,g=i.chatStatus,m=(0,P.useIntl)(),C=(0,S.Z)(function(J){return J.disableInput}),I=(0,S.Z)(function(J){return J.setDisableInput}),_=(0,S.Z)(function(J){return J.setClearMemory}),p=(0,gn.m)(),O=p.options,b=c?(0,xn.Zc)().isImageSupportModel:function(){return!1},D=(0,x.useState)(null),z=R()(D,2),V=z[0],we=z[1],_e=(0,x.useState)(""),Ne=R()(_e,2),Je=Ne[0],Ue=Ne[1],rt=(0,x.useState)(".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg"),pe=R()(rt,2),Ee=pe[0],ze=pe[1],he=(0,E.ZP)({maxSizeMB:15,acceptedFileTypes:Ee,multiple:!0}),ie=he.uploadedFiles,L=he.handleUpload,h=he.removeFile,f=he.clearFiles,y=he.isUploading;(0,x.useEffect)(function(){var J,A;if(c&&(l==null||(J=l.current)===null||J===void 0?void 0:J.length)>0&&l!==null&&l!==void 0&&(A=l.current[0])!==null&&A!==void 0&&(A=A.agent)!==null&&A!==void 0&&A.m_config_id){var le,ge=l==null||(le=l.current[0])===null||le===void 0||(le=le.agent)===null||le===void 0?void 0:le.m_config_id,k=b(ge),j=".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv".concat(k?",.jpg,.png,.jpeg":"");console.log("Model config changed:",{modelConfigId:ge,supportsImage:k,newFileTypes:j,currentFileTypes:Ee}),ze(j)}},[l,O,l==null||(t=l.current)===null||t===void 0||(t=t[0])===null||t===void 0||(t=t.agent)===null||t===void 0?void 0:t.m_config_id,b]);var v=function(){var A=hn.Z.confirm;A({title:m.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(vn.Z,{}),content:m.formatMessage({id:"app.chatroom.clear.tips"}),okText:m.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:m.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){_(["TRUNCATE","0"])}})},T=function J(A,le){if(A.length===0){le&&le();return}var ge=fn()(A),k=ge[0],j=ge.slice(1);n(k),setTimeout(function(){J(j,le)},100)},X=function(A){var le=[];(ie==null?void 0:ie.length)>0&&le.push(["FILELIST",ie.map(function(k){return k.file_id})]);var ge=V||0;le.push(["SETABILITY",ge]),le.push(["INPUT",A]),T(le,function(){(ie==null?void 0:ie.length)>0&&f()})},$=function(A){!A.shiftKey&&A.target.value==""&&(a.open({type:"warning",content:m.formatMessage({id:"app.chatroom.content.input"}),duration:10}),Ue(""),A.preventDefault()),!A.shiftKey&&A.keyCode==13&&A.target.value!=""&&(I(!0),Ue(""),X(A.target.value),A.preventDefault())},Ce=(0,Ut.throttle)(function(){n(["STOP",null])},300),Me=function(){C||L()},Ye=function(A){if(!A){a.open({type:"warning",content:m.formatMessage({id:"app.chatroom.content.input"}),duration:10});return}I(!0),X(A),Ue("")};return(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:u,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(A){o.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(pn.Z,{className:"text-[16px]"})}),(0,e.jsx)(yn,{uploadedFiles:ie,handleRemoveFile:h}),(0,e.jsxs)("div",{className:"border  px-[12px] py-2 border-[#ccc] bg-[#fff]  ".concat(ie.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,e.jsx)(bn,{agentChatRoomId:c,abilitiesList:d,abilityId:V,setAbilityId:we,clearContext:v}),(0,e.jsx)(wn,{userSendvalue:Je,setUserSendvalue:Ue,disableInput:C,isUploading:y,isStop:r,userSendmessage:$,handleFileUpload:Me,sendMessage:Ye,stopChatRoom:Ce})]})]})}),En=(0,x.memo)(function(i){var t=i.agentList,n=i.agentChatRoomId,a=i.abilitiesList,r=i.chatStatus,o=dn(n),u=o.scrollDomRef,l=o.upButtonDom,d=o.isStop,c=o.setIsStop,g=o.instruction,m=o.setInstruction;(0,x.useEffect)(function(){console.log(r),r==1&&c(!0)},[r]);var C=ke.ZP.useMessage(),I=R()(C,2),_=I[0],p=I[1];return(0,e.jsxs)(e.Fragment,{children:[p,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(n?"w-full":"max-w-[1200px] !mx-auto px-[44px]"),children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(cn,{instruction:g,setInstruction:m,messageApi:_,scrollDomRef:u,setIsStop:c,upButtonDom:l,agentList:t,agentChatRoomId:n,abilitiesList:a}),(0,e.jsx)(Nn,{setInstruction:m,messageApi:_,isStop:d,upButtonDom:l,scrollDomRef:u,agentList:t,agentChatRoomId:n,abilitiesList:a,chatStatus:r})]})})]})})},85877:function(pt,Be,s){var De=s(19632),R=s.n(De),ke=s(97857),Z=s.n(ke),x=s(5574),q=s.n(x),ue=s(52677),Se=s.n(ue),H=s(35312),be=s(78234),me=s(77598),Oe=s(96486),U=s.n(Oe),K=s(67294),M=s(73935),N=s(43413),S=s(92858),P=s(16845),ne=s(15425),G=s(85893),e=function(E){var F=E.children;return(typeof document=="undefined"?"undefined":Se()(document))==="object"?M.createPortal(F,document.body):null},ot=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),We=function(E){var F=E.value,de=E.onChange,xe=E.id,ce=E.placeholder,re=E.options,Fe=(0,H.useIntl)(),Xe=(0,K.useRef)(),ht=(0,K.useState)(),qe=q()(ht,2),Te=qe[0],ae=qe[1],et=(0,K.useState)(0),tt=q()(et,2),Pe=tt[0],fe=tt[1],dt=(0,K.useState)(""),st=q()(dt,2),mt=st[0],$e=st[1],it=(0,K.useCallback)(function(w){return(0,G.jsx)(He,Z()({},w))},[]),ft=(0,K.useCallback)(function(w){return(0,G.jsx)(Ze,Z()({},w))},[]),ee=(0,K.useMemo)(function(){return Ve((0,P.BU)((0,S.VC)((0,N.Jh)())))},[]),lt=(0,K.useState)(null),W=q()(lt,2),Ke=W[0],jt=W[1],Dt=(0,ne.Z)(function(w){return w.selectedNode}),Le=(0,ne.Z)(function(w){return w.getOutputVariables}),kt=(0,ne.Z)(function(w){return w.getInputVariables}),St=(0,K.useState)([]),It=q()(St,2),Qe=It[0],Mt=It[1];(0,be.Z)(function(){F&&F.length>0&&vt(F),re!=null&&re.length&&Mt(re.map(function(w){return Z()(Z()({},w),{},{name:w.label,id:w.value})}))}),(0,me.Z)(function(){var w=U().isEqual(Ke,F);w||(F&&F.length>0?vt(F):F&&U().isArray(F)&&F.length==0&&vt([{type:"paragraph",children:[]}]))},[F,xe]),(0,me.Z)(function(){re.length&&Mt(re.map(function(w){return Z()(Z()({},w),{},{name:w.label,id:w.value})})),console.log(re)},[re]);var vt=function(Y){jt(Y),gt(ee,{nodes:[{type:"paragraph",children:[]}]}),gt(ee,{nodes:Y})},bt=(0,K.useCallback)(function(w){if(Te&&Qe.length>0)switch(w.key){case"ArrowDown":w.preventDefault();var Y=Pe>=Qe.length-1?0:Pe+1;fe(Y);return;case"ArrowUp":w.preventDefault();var ve=Pe<=0?Qe.length-1:Pe-1;fe(ve);return;case"Tab":case"Enter":w.preventDefault(),N.YR.select(ee,Te),je(ee,Qe[Pe]),ae(null);return;case"Escape":w.preventDefault(),ae(null);return}else if(w.key==="@"){setTimeout(function(){return xt()},10);return}ae(null)},[Qe,ee,Pe,Te]),gt=function(Y){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_t=R()(Y.children);if(_t.forEach(function(nt){return Y.apply({type:"remove_node",path:[0],node:nt})}),ve.nodes){var at=N.NB.isNode(ve.nodes)?[ve.nodes]:ve.nodes;at.forEach(function(nt,yt){return Y.apply({type:"insert_node",path:[yt],node:nt})})}var ut=ve.at&&N.E9.isPoint(ve.at)?ve.at:N.ML.end(Y,[]);ut&&N.YR.select(Y,ut)};(0,K.useEffect)(function(){if(Te&&Qe.length>0){var w=Xe.current,Y=P.F3.toDOMRange(ee,Te),ve=Y.getBoundingClientRect();w.style.top="".concat(ve.top+window.pageYOffset+24,"px"),w.style.left="".concat(ve.left+window.pageXOffset,"px")}},[Qe.length,ee,Pe,mt,Te]);var xt=function(){var Y=ee.selection;if(Y&&N.e6.isCollapsed(Y)){var ve=N.e6.edges(Y),_t=q()(ve,1),at=_t[0],ut=N.ML.before(ee,at),nt=ut&&N.ML.range(ee,ut,at),yt=nt&&N.ML.string(ee,nt),Tt=N.ML.after(ee,at),Pt=N.ML.range(ee,at,Tt),Ot=N.ML.string(ee,Pt);ae(nt),$e(""),fe(0);return}ae(null)};return(0,G.jsxs)(P.mH,{editor:ee,initialValue:Ie,onChange:function(Y){de==null||de(Y),ae(null)},children:[(0,G.jsx)(P.CX,{renderElement:it,renderLeaf:ft,onKeyDown:bt,className:"!outline-none",placeholder:ce!=null?ce:Fe.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),Te&&(0,G.jsx)(e,{children:(0,G.jsx)("div",{ref:Xe,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:Qe.length?Qe.map(function(w,Y){return(0,G.jsx)("div",{onClick:function(){console.log(w),N.YR.select(ee,Te),je(ee,w),ae(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:Y===Pe?"#B4D5FF":""},children:(0,G.jsx)("span",{children:w.name})},w.name+Y)}):(0,G.jsx)(G.Fragment,{children:Fe.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Ve=function(E){var F=E.isInline,de=E.isVoid,xe=E.markableVoid;return E.isInline=function(ce){return ce.type==="mention"?!0:F(ce)},E.isVoid=function(ce){return ce.type==="mention"?!0:de(ce)},E.markableVoid=function(ce){return ce.type==="mention"||xe(ce)},E},je=function(E,F){var de={type:"mention",id:(F==null?void 0:F.id)||"",character:F.name,base:F,children:[{bold:!0,text:"11111"}]};N.YR.insertNodes(E,de),N.YR.move(E)},Ze=function(E){var F=E.attributes,de=E.children,xe=E.leaf;return(0,G.jsx)("span",Z()(Z()({},F),{},{children:de}))},He=function(E){var F=E.attributes,de=E.children,xe=E.element;switch(xe.type){case"mention":return(0,G.jsx)(se,Z()({},E));default:return(0,G.jsx)("p",Z()(Z()({},F),{},{children:de}))}},se=function(E){var F=E.attributes,de=E.children,xe=E.element,ce=(0,P.vt)(),re=(0,P.UE)(),Fe={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:ce&&re?"0 0 0 2px #B4D5FF":"none"};return xe.children[0].bold&&(Fe.fontWeight="bold"),xe.children[0].italic&&(Fe.fontStyle="italic"),(0,G.jsx)("span",Z()(Z()({},F),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(xe.character.replace(" ","-")),style:Fe,children:ot?(0,G.jsxs)(K.Fragment,{children:["1",de,"/",xe.character]}):(0,G.jsxs)(K.Fragment,{children:[(0,G.jsx)("span",{children:xe.character}),de]})}))},Ie=[{type:"paragraph",children:[{text:""}]}];Be.Z=We},38008:function(pt,Be,s){s.d(Be,{Zc:function(){return ue},aS:function(){return q}});var De=s(67294),R=s(85750),ke=s(58299),Z=s(85893),x=(0,De.createContext)(void 0),q=function(be){var me=be.children,Oe=(0,ke.m)(),U=Oe.options,K=(0,De.useMemo)(function(){var M=function(P){if(!P||!U)return!1;var ne=(0,R.ti)(P,{options:U});return(ne==null?void 0:ne.support_image)===1},N=function(P){return M(P)};return{isImageSupportModel:M,getCurrentModelImageSupport:N}},[U]);return(0,Z.jsx)(x.Provider,{value:K,children:me})},ue=function(){var be=(0,De.useContext)(x);if(be===void 0)throw new Error("useModelImageSupport must be used within a ModelImageSupportProvider");return be},Se=null},77295:function(pt,Be,s){s.d(Be,{CO:function(){return U}});var De=s(15009),R=s.n(De),ke=s(19632),Z=s.n(ke),x=s(99289),q=s.n(x),ue=s(5574),Se=s.n(ue),H=s(45360),be=s(35312),me=s(67294),Oe=s(83065),U=function(N){var S,P=N==null||(S=N.split(".").pop())===null||S===void 0?void 0:S.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(P||"")},K=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},S=(0,be.useIntl)(),P=(0,me.useState)([]),ne=Se()(P,2),G=ne[0],e=ne[1],ot=(0,me.useState)(!1),We=Se()(ot,2),Ve=We[0],je=We[1],Ze=N.maxSizeMB,He=Ze===void 0?15:Ze,se=N.acceptedFileTypes,Ie=se===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":se,Re=N.multiple,E=Re===void 0?!0:Re,F=function(){var re=document.createElement("input");re.type="file",re.accept=Ie,re.multiple=E,re.onchange=function(){var Fe=q()(R()().mark(function Xe(ht){var qe,Te,ae,et,tt,Pe,fe,dt,st,mt,$e,it,ft,ee;return R()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(qe=ht.target,!(qe.files&&qe.files.length>0)){W.next=37;break}if(je(!0),Te=Array.from(qe.files),ae=Te.filter(function(Ke){return Ke.size/1024/1024>He}),!(ae.length>0)){W.next=9;break}return H.ZP.error("".concat(ae.map(function(Ke){return Ke.name}).join(", ")," ").concat(S.formatMessage({id:"workflow.uploadFileErrorText"}))),je(!1),W.abrupt("return");case 9:et=[],tt=0,Pe=Te;case 11:if(!(tt<Pe.length)){W.next=35;break}return fe=Pe[tt],dt=new FormData,dt.append("file",fe),W.prev=15,W.next=18,(0,Oe.M$)();case 18:return st=W.sent,W.next=21,fetch(st,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:dt});case 21:return mt=W.sent,W.next=24,mt.json();case 24:$e=W.sent,$e.code===0?(H.ZP.success("".concat(fe.name," ").concat(S.formatMessage({id:"workflow.uploadSuccess"}))),(it=$e.data)!==null&&it!==void 0&&it.file_id&&(ft=U(fe.name),ee={name:fe.name,url:$e.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:ft,file_id:$e.data.file_id,path_show:$e.data.file_url||$e.data.path_show||""},et.push(ee))):H.ZP.error("".concat(fe.name," ").concat(S.formatMessage({id:"workflow.uploadFailed"}))),W.next=32;break;case 28:W.prev=28,W.t0=W.catch(15),console.error("Upload error:",W.t0),H.ZP.error("".concat(fe.name," ").concat(S.formatMessage({id:"workflow.uploadFailed"})));case 32:tt++,W.next=11;break;case 35:e(function(Ke){return[].concat(Z()(Ke),et)}),je(!1);case 37:case"end":return W.stop()}},Xe,null,[[15,28]])}));return function(Xe){return Fe.apply(this,arguments)}}(),re.click()},de=function(re){e(function(Fe){return Fe.filter(function(Xe){return Xe.uid!==re})})},xe=function(){e([])};return{uploadedFiles:G,setUploadedFiles:e,handleUpload:F,removeFile:de,clearFiles:xe,isUploading:Ve}};Be.ZP=K},58299:function(pt,Be,s){s.d(Be,{m:function(){return K}});var De=s(64599),R=s.n(De),ke=s(97857),Z=s.n(ke),x=s(15009),q=s.n(x),ue=s(99289),Se=s.n(ue),H=s(73445),be=s(42237),me=s(45360),Oe=s(67294),U=(0,H.Ue)(function(M){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var N=Se()(q()().mark(function P(){var ne;return q()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,M({loading:!0}),e.next=4,(0,be.fZ)();case 4:if(ne=e.sent,ne.code!==0){e.next=9;break}M({models:Array.isArray(ne.data.data)?ne.data.data:[],initialized:!0}),e.next=10;break;case 9:throw new Error(ne.message||"Failed to fetch models");case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),M({error:e.t0.message}),me.ZP.error("Failed to fetch models");case 16:return e.prev=16,M({loading:!1}),e.finish(16);case 19:case"end":return e.stop()}},P,null,[[0,12,16,19]])}));function S(){return N.apply(this,arguments)}return S}()}}),K=function(){var N=U(function(e){return e.models}),S=U(function(e){return e.loading}),P=U(function(e){return e.initialized}),ne=U(function(e){return e.fetchModels});(0,Oe.useEffect)(function(){P||ne()},[P,ne]);var G=(0,Oe.useMemo)(function(){var e=Array.isArray(N)?N:[],ot=e.map(function(se){return{label:se.supplier_name,options:Array.isArray(se.model_list)?se.model_list.map(function(Ie){return Z()({label:Ie.model_name,value:Ie.model_config_id},Ie)}):[]}}),We,Ve=R()(e),je;try{for(Ve.s();!(je=Ve.n()).done;){var Ze=je.value;if(Array.isArray(Ze.model_list)){var He=Ze.model_list.find(function(se){return se.model_default_used===1});if(He){We=He.model_config_id;break}}}}catch(se){Ve.e(se)}finally{Ve.f()}return{options:ot,defaultValue:We}},[N]);return Z()(Z()({},G),{},{loading:S})}}}]);
