"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,Te,t){var Je=t(5574),G=t.n(Je),Ye=t(42881),le=t(67294),pe=t(85893),k=function(w){var Xe=w.children,Y=w.className,ae=Y===void 0?"":Y,ge=w.dragDirection,Se=ge===void 0?"left":ge,Ee=w.minWidth,Be=Ee===void 0?415:Ee,ke=w.maxWidth,J=ke===void 0?820:ke,we=w.minHeight,r=we===void 0?200:we,fe=w.maxHeight,We=fe===void 0?800:fe,oe=w.defaultWidth,Le=oe===void 0?415:oe,v=w.defaultHeight,$=v===void 0?300:v,e=w.onChange,ie=(0,le.useState)(Le),Re=G()(ie,2),Qe=Re[0],Ne=Re[1],lt=(0,le.useState)($),De=G()(lt,2),ft=De[0],it=De[1],qe=(0,le.useCallback)(function(st,Ze){Ne(st),Ze&&it(Ze),e==null||e(st,Ze)},[Ne,it,e]),Oe=(0,Ye.W)({direction:["left","right"].includes(Se)?"horizontal":"vertical",triggerDirection:Se,minWidth:Be,maxWidth:J,minHeight:r,maxHeight:We,onResize:qe}),ze=Oe.triggerRef,mt=Oe.containerRef;return(0,pe.jsxs)("div",{ref:mt,style:{width:["left","right"].includes(Se)?"".concat(Qe,"px"):void 0,height:["top","bottom"].includes(Se)?"".concat(ft,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(ae),children:[Se==="left"&&(0,pe.jsx)("div",{ref:ze,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,pe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),Se==="right"&&(0,pe.jsx)("div",{ref:ze,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,pe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),Se==="top"&&(0,pe.jsx)("div",{ref:ze,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,pe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),Se==="bottom"&&(0,pe.jsx)("div",{ref:ze,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,pe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),Xe]})};Te.Z=(0,le.memo)(k)},36711:function(bt,Te,t){t.r(Te),t.d(Te,{waitTime:function(){return ke},waitTimePromise:function(){return Be}});var Je=t(97857),G=t.n(Je),Ye=t(5574),le=t.n(Ye),pe=t(15009),k=t.n(pe),rt=t(99289),w=t.n(rt),Xe=t(42237),Y=t(29608),ae=t(32592),ge=t(35312),Se=t(67294),Ee=t(85893),Be=function(){var J=w()(k()().mark(function we(){var r,fe=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return r=fe.length>0&&fe[0]!==void 0?fe[0]:100,oe.abrupt("return",new Promise(function(Le){setTimeout(function(){Le(!0)},r)}));case 2:case"end":return oe.stop()}},we)}));return function(){return J.apply(this,arguments)}}(),ke=function(){var J=w()(k()().mark(function we(){var r,fe=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return r=fe.length>0&&fe[0]!==void 0?fe[0]:100,oe.next=3,Be(r);case 3:case"end":return oe.stop()}},we)}));return function(){return J.apply(this,arguments)}}();Te.default=function(){var J=(0,ge.useIntl)(),we=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:J.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ie;v==null||(ie=v.current)===null||ie===void 0||ie.submit()}}},{title:J.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:J.formatMessage({id:"workflow.created_time_des",defaultMessage:J.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:J.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ie;v==null||(ie=v.current)===null||ie===void 0||ie.submit()}},valueEnum:{1:{text:J.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:J.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:J.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(J.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:J.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:J.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],r=(0,ge.useSearchParams)(),fe=le()(r,1),We=fe[0],oe=(0,Y.Z)(function($){return $.setRunPanelLogRecord}),Le=We.get("app_id"),v=(0,Se.useRef)(null);return(0,Ee.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,Ee.jsx)("div",{children:(0,Ee.jsx)(ae.Z,{columns:we,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var $=w()(k()().mark(function e(ie,Re,Qe){var Ne;return k()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return console.log(ie,Re,Qe),De.next=3,(0,Xe.bB)(G()(G()({app_runs_name:"",app_runs_status:0},ie),{},{app_id:Le}));case 3:return Ne=De.sent,console.log(Ne),De.abrupt("return",{data:Ne.data.list,success:!0,total:Ne.data.total_count});case 6:case"end":return De.stop()}},e)}));return function(e,ie,Re){return $.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),oe(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:J.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},53971:function(bt,Te,t){t.r(Te),t.d(Te,{default:function(){return Ea}});var Je=t(15009),G=t.n(Je),Ye=t(99289),le=t.n(Ye),pe=t(97857),k=t.n(pe),rt=t(5574),w=t.n(rt),Xe=t(32060),Y=t(42237),ae=t(35312),ge=t(63648),Se=t(16091),Ee=t(13118),Be=t(78234),ke=t(77598),J=t(45360),we=t(85576),r=t(67294),fe=t(64599),We=t.n(fe),oe=t(7493),Le=t(34559),v=t(15425),$=t(96906),e=t(85893),ie=function(s){return{nodes:s.nodes,edges:s.edges,onNodesChange:s.onNodesChange,onEdgesChange:s.onEdgesChange,onConnect:s.onConnect,nodeTypes:s.nodeTypes,connectionLineStyle:s.connectionLineStyle,defaultViewport:s.defaultViewport,onDrop:s.onDrop,onDragOver:s.onDragOver,setSelect:s.setSelect,preventScrolling:s.preventScrolling}},Re=(0,r.memo)(function(d){var s=d.children,n=(0,ae.useIntl)(),c=(0,v.Z)(function(u){return u.nodes}),b=(0,v.Z)(function(u){return u.getEdges}),f=(0,v.Z)(function(u){return u.edges}),Z=(0,v.Z)(function(u){return u.setEdges}),o=(0,v.Z)(function(u){return u.onNodesChange}),l=(0,v.Z)(function(u){return u.onEdgesChange}),S=(0,v.Z)(function(u){return u.onConnect}),A=(0,v.Z)(function(u){return u.nodeTypes}),V=(0,v.Z)(function(u){return u.connectionLineStyle}),U=(0,v.Z)(function(u){return u.defaultViewport}),Q=(0,v.Z)(function(u){return u.onDrop}),a=(0,v.Z)(function(u){return u.onDragOver}),y=(0,v.Z)(function(u){return u.setSelect}),D=(0,v.Z)(function(u){return u.preventScrolling}),q=(0,r.useCallback)(function(u){var B=c.find(function(E){return E.id===u.target}),T=function E(se){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(P.has(se.id))return!1;P.add(se.id);var _=We()((0,oe.xA)(se,c,f)),K;try{for(_.s();!(K=_.n()).done;){var ne=K.value;if(ne.id===u.source||E(ne,P))return!0}}catch(ue){_.e(ue)}finally{_.f()}};return B.id===u.source?!1:!T(B)},[c,f]),W=function(){},H=(0,r.useCallback)(function(u,B){console.log(u,B,b(),(0,oe.Kz)(u,B,f)),Z((0,oe.Kz)(u,B,b()))},[]);return(0,ke.Z)(function(){},[c]),(0,e.jsx)(Le.tV,{children:(0,e.jsx)(ge.x$,{onViewportChange:W,nodes:c,edges:f,onNodesChange:o,onEdgesChange:l,onEdgesDelete:function(B){},onConnect:S,onReconnect:H,nodeTypes:A,minZoom:.3,maxZoom:1,connectionLineStyle:V,snapToGrid:!1,isValidConnection:q,connectionRadius:30,preventScrolling:D,onDragOver:a,onPaneClick:function(){y("")},onPaneContextMenu:function(B){B.preventDefault()},onSelectionChange:function(B){},onNodeClick:function(B,T){y(T.id)},onEdgeClick:function(B,T){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(B){},onBeforeDelete:function(){var u=le()(G()().mark(function B(T){var E;return G()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((T==null||(E=T.nodes)===null||E===void 0||(E=E[0])===null||E===void 0?void 0:E.type)!=$.vW.Start){P.next=3;break}return J.ZP.error(n.formatMessage({id:"workflow.delStartNodeError"})),P.abrupt("return",Promise.reject(n.formatMessage({id:"workflow.delStartNodeError"})));case 3:return y(""),P.abrupt("return",Promise.resolve(T));case 5:case"end":return P.stop()}},B)}));return function(B){return u.apply(this,arguments)}}(),fitView:!0,children:s})})}),Qe=function(s){var n=(0,r.useCallback)(function(f){f.preventDefault(),f.dataTransfer.dropEffect="move"},[]),c=(0,r.useCallback)(function(f){f.preventDefault();var Z=f.dataTransfer.getData("application/reactflow");if(!Z)return null;var o=JSON.parse(Z),l=o.type,S=o.item;if(!l||!S)return null;var A=s({x:f.clientX,y:f.clientY});return{position:A,type:l,item:S}},[s]),b=(0,r.useCallback)(function(f){var Z=function(l){var S=c(l);S&&f(S.position,S.type,S.item)};return document.addEventListener("dragover",n),document.addEventListener("drop",Z),function(){document.removeEventListener("dragover",n),document.removeEventListener("drop",Z)}},[n,c]);return{onDnD:b}},Ne=Qe,lt=function(){var s=(0,v.Z)(function(o){return o.setAgentData}),n=(0,v.Z)(function(o){return o.setSkillData}),c=(0,v.Z)(function(o){return o.setToolData}),b=(0,v.Z)(function(o){return o.setDatasetData}),f=(0,v.Z)(function(o){return o.setTeamDatasetData}),Z=(0,v.Z)(function(o){return o.setModelOptionsData});(0,r.useEffect)(function(){(0,Y.x$)(2).then(function(o){o.code===0&&s({team:o.data})}),(0,Y.x$)(3).then(function(o){o.code===0&&s({user:o.data})}),(0,Y.w)(2).then(function(o){o.code===0&&n({team:o.data})}),(0,Y.w)(3).then(function(o){o.code===0&&n({user:o.data})}),(0,Y.GZ)().then(function(o){o.code===0&&c({list:Object.values(o.data)})}),(0,Y.fZ)().then(function(o){var l,S=Array.isArray(o==null||(l=o.data)===null||l===void 0?void 0:l.data)?o.data.data:[],A=S.map(function(D){return{label:D.supplier_name,options:Array.isArray(D.model_list)?D.model_list.map(function(q){return{label:q.model_name,value:q.model_config_id}}):[]}}),V,U=We()(S),Q;try{for(U.s();!(Q=U.n()).done;){var a=Q.value;if(Array.isArray(a.model_list)){var y=a.model_list.find(function(D){return D.model_default_used===1});if(y){V=y.model_config_id;break}}}}catch(D){U.e(D)}finally{U.f()}Z({options:A,defaultValue:V})}),(0,Y.mG)().then(function(o){o.code==0&&b({list:o.data.data.map(function(l){return k()(k()({},l),{},{label:l.name,value:l.dataset_id})})})}),(0,Y.mG)(2).then(function(o){o.code==0&&f({list:o.data.data.map(function(l){return k()(k()({},l),{},{label:l.name,value:l.dataset_id})})})})},[s,n,c])},De=lt,ft=t(83065),it=t(39944),qe=t(10759),Oe=t(55927),ze=t(33914),mt=t(88284),st=t(28508),Ze=t(34994),St=t(90672),$t=t(46822),Ht=t(97462),Ft=t(64317),_t=t(29933),zt=t(3917),Ie=t(71471),Ut=t(40056),Dt=t(2487),$e=t(28036),jt=t(96486),Mt=t.n(jt),Ue=t(29432),ut=t(92485),$a=Ie.Z.Text,Ha=Ut.Z.ErrorBoundary,Kt=(0,r.memo)(function(){var d,s,n=(0,ae.useIntl)(),c=(0,r.useState)(!1),b=w()(c,2),f=b[0],Z=b[1],o=(0,Oe.Z)(function(m){return m.dealtWithData}),l=(0,Oe.Z)(function(m){return m.setDealtWithData}),S=(0,Oe.Z)(function(m){return m.setFlowMessage}),A=(0,Oe.Z)(function(m){return m.getNeedHumanConfirmMessage}),V=(0,Oe.Z)(function(m){return m.flowMessage}),U=(0,r.useState)(null),Q=w()(U,2),a=Q[0],y=Q[1],D=(0,r.useState)(""),q=w()(D,2),W=q[0],H=q[1],u=(0,r.useState)(!1),B=w()(u,2),T=B[0],E=B[1],se=(0,r.useState)(""),P=w()(se,2),_=P[0],K=P[1],ne=(0,zt.Z)(Y.N7,{manual:!0}),ue=ne.loading,He=ne.runAsync;(0,r.useEffect)(function(){var m;Z(!!o);var x=o==null||(m=o.data)===null||m===void 0||(m=m.node_exec_data)===null||m===void 0?void 0:m.node_exec_id;return console.log(o,x),H(x),x&&he(x),function(){Z(!1)}},[o]);var he=function(x){ue||He(x).then(function(I){I.data&&(y(I.data),x!=_&&(E(!1),K(x)))})};(0,ke.Z)(function(){console.log(V,W);var m=V.find(function(x){var I;return(x==null||(I=x.data)===null||I===void 0||(I=I.node_exec_data)===null||I===void 0?void 0:I.node_exec_id)==W});console.log(m),m&&he(W)},[V.length]);var Pe=function(x){E(!0),(0,Y.YX)(W,{correct_prompt:new it.N("",x.prompt,""),operation:1,outputs:(a==null?void 0:a.outputs)||null}).then(function(I){I.code==0&&(O(W),H(I.data.exec_id))})},O=function(x){var I=V.filter(function(F){var z;return!((F==null||(z=F.data)===null||z===void 0||(z=z.node_exec_data)===null||z===void 0?void 0:z.node_exec_id)==x&&(F==null?void 0:F.type)=="workflow_need_human_confirm")});S(I)},Fe=function(){(0,Y.YX)(W,{operation:0,outputs:(a==null?void 0:a.outputs)||null}).then(function(x){x.code==0&&(Z(!1),O(W),l(null))})},et=(0,r.useCallback)(function(){var m,x,I=o==null||(m=o.data)===null||m===void 0||(m=m.node_exec_data)===null||m===void 0?void 0:m.node_type;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[I!=$.vW.LLM&&(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"input"})}),(a==null||(x=a.correct_llm_history)===null||x===void 0?void 0:x.length)>0&&(0,e.jsx)(Dt.Z,{header:(0,e.jsx)(Ie.Z.Title,{level:5,children:n.formatMessage({id:"workflow.historyPrompt",defaultMessage:"prompt"})}),dataSource:a==null?void 0:a.correct_llm_history,renderItem:function(z){var ee;return(0,e.jsx)(Dt.Z.Item,{children:z==null||(ee=z.correct_prompt)===null||ee===void 0||(ee=ee.user)===null||ee===void 0?void 0:ee.value})}}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.outputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"output"})})]}),(0,e.jsx)(Ze.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:n.formatMessage({id:"workflow.xz"})}},loading:T,onFinish:Pe,children:(0,e.jsx)("div",{className:"flex ",children:(0,e.jsxs)("div",{className:"flex-1 pt-2 border-stone-300 border rounded-md my-2",children:[(0,e.jsxs)("div",{className:"px-2 flex justify-between cursor-default",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"text-sm text-gray-500 font-bold pb-1",children:"Prompt"})}),(0,e.jsx)("div",{})]}),(0,e.jsx)("div",{className:" pb-6 user-input-error",children:(0,e.jsx)(St.Z,{formItemProps:{className:"mb-0"},name:"prompt",required:!0,rules:[{required:!0,message:n.formatMessage({id:"workflow.requireInputPrompt"})}],fieldProps:{variant:"borderless",placeholder:n.formatMessage({id:"workflow.requireInputPrompt"}),autoSize:{minRows:2,maxRows:40},count:{show:function(z){var ee=z.value,Me=z.count,re=z.maxLength;return(0,e.jsx)("div",{className:"pr-2 text-blue-400",children:Me})}}}})})]})})})]})},[a]),Ke=(0,r.useCallback)(function(){var m,x,I,F=a==null||(m=a.node_graph)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.input,z=F==null?void 0:F.properties,ee=a==null||(x=a.node_graph)===null||x===void 0||(x=x.data)===null||x===void 0?void 0:x.requires_upload,Me=a==null||(I=a.node_graph)===null||I===void 0||(I=I.data)===null||I===void 0||(I=I.import_to_knowledge_base)===null||I===void 0?void 0:I.input;console.log("requires_upload",a,ee);var re=(0,v.Z)(function(i){return i.datasetData});if(!z)return(0,e.jsx)(e.Fragment,{children:n.formatMessage({id:"workflow.requireInputPrompt",defaultMessage:""})});var ye=Object.values(z),xe=function(g){var h;console.log(g);var L=(0,qe.vV)(F);if(ye.length>0){var j=Object.entries(g).filter(function(te){var N=w()(te,2),R=N[0],me=N[1];return R.startsWith("variables.")});j.forEach(function(te){var N=w()(te,2),R=N[0],me=N[1];L.properties[R.replace("variables.","")].value=me})}var M=new qe.V7(Ue.Mp,"array[number]");g.file&&g.file.forEach(function(te){var N,R=new qe._w(te.uid,"number",(te==null||(N=te.response)===null||N===void 0||(N=N.data)===null||N===void 0?void 0:N.file_id)||0);M.addValue(R)}),L.addProperty(Ue.Mp,M),console.log(L,M);var C=(a==null||(h=a.node_graph)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.knowledge_base_mapping)||{input:{},output:{}};Object.entries(g).forEach(function(te){var N=w()(te,2),R=N[0],me=N[1];R.startsWith("dataset.")&&(C.input[Ue.Mp]||(C.input[Ue.Mp]={}),C.input[Ue.Mp][R.replace("dataset.","")]=me)}),console.log(C),(0,Y.YX)(W,{operation:0,inputs:L,outputs:null,correct_prompt:null,knowledge_base_mapping:C}).then(function(te){te.code==0&&(Z(!1),l(null),O(W))})},p={icon:(0,e.jsx)(ze.Z,{}),title:n.formatMessage({id:"workflow.uploadFileText",defaultMessage:"\uFF0C"}),description:n.formatMessage({id:"workflow.uploadFileDes"}),accept:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv",fieldProps:{listType:"picture",name:"file",multiple:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},action:ft.M$,beforeUpload:function(g){var h=g.size/1024/1024<15;return h||J.ZP.error(n.formatMessage({id:"workflow.uploadFileErrorText"})),h}}};return(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsxs)(Ze.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:n.formatMessage({id:"workflow.checked",defaultMessage:""})}},onFinish:xe,children:[ye.map(function(i){return(0,e.jsx)(St.Z,{label:i.display_name,name:"variables.".concat(i.name),required:i.required,rules:[{required:i.required,message:n.formatMessage({id:"workflow.toInput"})}]},i.name)}),ee&&(0,e.jsx)($t.Z,k()({name:"file"},p)),(0,e.jsx)(Ht.Z,{name:["file"],children:function(g){var h=g.file;return Me&&(h==null?void 0:h.length)>0&&(h==null?void 0:h.map(function(L){return(0,e.jsx)(Ft.Z,{label:L.name,name:"dataset.".concat(L.uid),options:(re==null?void 0:re.list)||[],required:!0,rules:[{required:!0,message:n.formatMessage({id:"workflow.select_to_knowledge_base"})}]},L.uid)}))||null}})]})})},[a]),je=function(x){if(x.type!=="object"||!x.properties)return[x];var I=[],F=function z(ee){var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";Mt().forOwn(ee,function(re,ye){var xe=Me?"".concat(Me,".").concat(ye):ye;re.type==="object"&&re.properties?z(re.properties,xe):I.push(k()(k()({},re),{},{name:xe}))})};return F(x.properties),I},tt=function(x){return x.reduce(function(I,F){return I[F.name]=F.value,I},{})},at=(0,r.useCallback)(function(){console.log(a);var m=a==null?void 0:a.inputs,x=(0,r.useRef)(null),I=(0,r.useState)([]),F=w()(I,2),z=F[0],ee=F[1],Me=(0,r.useState)({}),re=w()(Me,2),ye=re[0],xe=re[1],p=J.ZP.useMessage(),i=w()(p,2),g=i[0],h=i[1];(0,Be.Z)(function(){a!=null&&a.outputs&&(console.log(m,je(a==null?void 0:a.outputs)),ee(je(a==null?void 0:a.outputs)),xe(JSON.stringify(je(a==null?void 0:a.outputs))))});var L=function(){var M={};try{M=JSON.parse(ye),console.log(M,M[0]),(0,Y.YX)(W,{outputs:Mt().isArray(M)?M[0]:M}).then(function(C){C.code==0&&(g.success(n.formatMessage({id:"workflow.checkSc",defaultMessage:""})),Z(!1),O(W),l(null))})}catch(C){console.log(C),g.error(n.formatMessage({id:"workflow.checkOutputMessageError",defaultMessage:","}))}};return(0,e.jsxs)("div",{children:[h,(0,e.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[!Ue.eT.includes(a==null?void 0:a.node_type)&&(0,e.jsxs)("div",{children:[(0,e.jsx)(Ie.Z.Title,{level:5,children:"Inputs"}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(M){xe(M)}})})]}),(0,e.jsxs)(Ie.Z.Title,{level:5,children:["Outputs(",n.formatMessage({id:"workflow.toEdit",defaultMessage:""}),")"]}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.outputs,isJSONStringifyBeauty:!0,onChange:function(M){xe(M)}})}),(0,e.jsx)($e.ZP,{type:"primary",onClick:L,className:"w-full mt-4",children:n.formatMessage({id:"workflow.checked",defaultMessage:""})})]})]})},[a]),Ve=(0,r.useCallback)(function(){var m=a==null?void 0:a.node_type;return m==$.vW.Human?(0,e.jsx)(Ke,{}):m==$.vW.LLM||m==$.vW.Agent||m==$.vW.TaskGeneration?(0,e.jsx)(et,{}):(0,e.jsx)(at,{})},[a]),Ae=function(){var x=a==null?void 0:a.node_type;return x==$.vW.LLM||x==$.vW.Agent||x==$.vW.TaskGeneration?(0,e.jsx)($e.ZP,{type:"text",onClick:Fe,className:"text-green-500",disabled:T,icon:(0,e.jsx)(mt.Z,{}),children:n.formatMessage({id:"workflow.checkBackLogs",defaultMessage:""})}):null};return f?(0,e.jsx)(_t.Z,{className:"w-[400px] border border-blue-300 fixed z-10  top-[105px] right-2 ",style:{height:"calc(100vh - 10px - 100px)"},extra:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Ae,{}),(0,e.jsx)($e.ZP,{onClick:function(){Z(!1),l(null)},type:"text",icon:(0,e.jsx)(st.Z,{})})]}),title:(0,e.jsx)(Ie.Z.Title,{level:5,children:n.formatMessage({id:"workflow.backlogs",defaultMessage:""})}),bodyStyle:{overflowY:"auto",marginTop:"20px",boxSizing:"border-box"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(Ie.Z.Title,{level:5,children:a==null||(d=a.node_graph)===null||d===void 0||(d=d.data)===null||d===void 0?void 0:d.title})}),(0,e.jsx)("div",{children:(0,e.jsx)(Ie.Z.Text,{children:a==null||(s=a.node_graph)===null||s===void 0||(s=s.data)===null||s===void 0?void 0:s.desc})}),Ve()]})}):null}),Vt=t(19632),Ct=t.n(Vt),Gt=t(9783),dt=t.n(Gt),Jt=t(39873),Yt=t(22352),Xt=t(40110),Qt=t(86615),qt=t(5966),ea=t(62370),ta=t(96638),aa=t(74330),na=t(11941),oa=t(87718),pt=t(69386),gt=t(63680),ra=t(63783),ct=t(83062),ht=t(99510),yt=(0,r.memo)(function(d){var s=d.children,n=d.onDragStart,c=d.onClick,b=d.type,f=d.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(o){return n(o,b,f)},onClick:c,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:s})}),la=(0,r.memo)(function(d){var s,n,c,b=d.item,f=d.onDragStart,Z=d.typeBadge,o=d.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(b==null||(s=b.baseData)===null||s===void 0?void 0:s.description)||(b==null||(n=b.data)===null||n===void 0?void 0:n.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:f,type:b.type,item:b,onClick:function(){return o==null?void 0:o(b)},children:(0,e.jsx)(ht.Z,{title:b.data.title,icon:(b==null||(c=b.baseData)===null||c===void 0?void 0:c.icon)||b.type,typeBadge:Z})})})})}),ia=(0,r.memo)(function(d){var s,n=d.item,c=d.onDragStart,b=d.typeBadge,f=d.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(s=n.baseData)===null||s===void 0?void 0:s.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:c,type:n.type,item:n,onClick:function(){return f==null?void 0:f(n)},children:(0,e.jsx)(ht.Z,{title:n.baseData.name,icon:n.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:n.baseData.nickname}),typeBadge:b})})})})}),sa=(0,r.memo)(function(d){var s,n,c,b,f,Z,o,l,S,A,V,U,Q,a,y=d.tool,D=d.category,q=d.onDragStart,W=d.typeBadge,H=d.onItemClick,u=d.categoryIndex,B=d.toolIndex,T=(0,ae.getLocale)()==="en-US"?"en_US":"zh_Hans",E=(0,gt.o6)()[$.vW.Tool],se=k()(k()({},y),{},{authorization_status:D==null?void 0:D.authorization_status,title:y==null||(s=y.identity)===null||s===void 0?void 0:s.label[T],icon:D==null||(n=D.identity)===null||n===void 0?void 0:n.icon,groupName:D==null||(c=D.identity)===null||c===void 0?void 0:c.name,credentials_for_provider:D==null?void 0:D.credentials_for_provider}),P={title:y==null||(b=y.identity)===null||b===void 0?void 0:b.label[T],desc:(y==null||(f=y.description)===null||f===void 0||(f=f.human)===null||f===void 0?void 0:f[T])||(y==null||(Z=y.description)===null||Z===void 0?void 0:Z.llm),icon:D==null||(o=D.identity)===null||o===void 0?void 0:o.icon,data:{title:y==null||(l=y.identity)===null||l===void 0?void 0:l.label[T],desc:(y==null||(S=y.description)===null||S===void 0||(S=S.human)===null||S===void 0?void 0:S[T])||(y==null||(A=y.description)===null||A===void 0?void 0:A.llm),icon:D==null||(V=D.identity)===null||V===void 0?void 0:V.icon},baseData:se};return(0,e.jsx)(ct.Z,{placement:"right",title:y==null||(U=y.description)===null||U===void 0||(U=U.human)===null||U===void 0?void 0:U[T],children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:q,type:$.vW.Tool,item:P,onClick:function(){return H==null?void 0:H(D,y,u,B)},children:(0,e.jsx)(ht.Z,{title:y==null||(Q=y.identity)===null||Q===void 0?void 0:Q.label[T],icon:D==null||(a=D.identity)===null||a===void 0?void 0:a.icon,typeBadge:W})})})})}),ua=(0,r.memo)(function(d){var s,n,c=d.category,b=d.onDragStart,f=d.typeBadge,Z=d.onItemClick,o=d.categoryIndex,l=(0,ae.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[c==null||(s=c.identity)===null||s===void 0?void 0:s.label[l],(0,e.jsx)(ct.Z,{placement:"right",title:c==null||(n=c.identity)===null||n===void 0?void 0:n.description[l],children:(0,e.jsx)(ra.Z,{className:"cursor-pointer ml-1"})})]}),c.tools.map(function(S,A){return(0,e.jsx)(sa,{tool:S,category:c,onDragStart:b,typeBadge:f,onItemClick:function(U,Q,a,y){return Z==null?void 0:Z(U,Q,a,y)},categoryIndex:o,toolIndex:A},A)})]})}),da=function(s){var n=s.list,c=s.onDragStart,b=s.type,f=b===void 0?"normal":b,Z=s.typeBadge,o=Z===void 0?null:Z,l=s.onItemClick;return n!=null&&n.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:f==="tools"?n.map(function(S,A){return(0,e.jsx)(ua,{category:S,typeBadge:o,onDragStart:c,onItemClick:l,categoryIndex:A},A)}):f==="workflow"?n.map(function(S,A){return(0,e.jsx)(ia,{item:S,onDragStart:c,typeBadge:o,onItemClick:l},A)}):n.map(function(S,A){return(0,e.jsx)(la,{item:S,onDragStart:c,typeBadge:o,onItemClick:l},A)})}):null},ca=(0,r.memo)(da),va=t(26474),kt=t(47520),fa=t(36711),ma=t(82826),It=t(43425),pa=t(48869),ga=t(69243),ha=t(91806),vt=t(52688),ya=t(55241),xa=t(50136),xt=t(43586),wa=function(){var s,n=(0,ae.useIntl)(),c=(0,r.useState)(!0),b=w()(c,2),f=b[0],Z=b[1],o=(0,v.Z)(function(P){return P.setWorkflowEditInfo}),l=(0,v.Z)(function(P){return P.workFlowInfo}),S=(0,v.Z)(function(P){return P.setSelect}),A=(0,r.useState)("1"),V=w()(A,2),U=V[0],Q=V[1],a=(0,r.useState)(!1),y=w()(a,2),D=y[0],q=y[1],W=(0,xt.Z)(),H=(0,r.useRef)(null),u=function(){var _,K;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(Ze.A,{formRef:H,submitter:{render:function(){return null}},onValuesChange:T,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:n.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{tooltip:(l==null||(_=l.app)===null||_===void 0?void 0:_.publish_status)!="1"?{title:n.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(l==null||(K=l.app)===null||K===void 0?void 0:K.publish_status)!="1",name:"enable_api",label:"API"})]})})})},B=[{key:"4",icon:(0,e.jsx)(ma.Z,{}),label:n.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:l!=null&&l.isProd?(0,e.jsx)(It.Z,{}):(0,e.jsx)(ya.Z,{content:u,trigger:"click",forceRender:!0,placement:"rightTop",title:n.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(It.Z,{})}),label:n.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:l==null?void 0:l.isProd},{key:"1",icon:(0,e.jsx)(pa.Z,{}),label:n.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(ga.Z,{}),label:n.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:D?n.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):n.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!D},{key:"3",icon:(0,e.jsx)(ha.Z,{}),label:n.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,ke.Z)(function(){if(l){var P,_,K,ne,ue=l==null||(P=l.app)===null||P===void 0?void 0:P.is_public,He=l==null||(_=l.app)===null||_===void 0?void 0:_.enable_api,he={};he.is_public=!!ue,he.enable_api=(l==null||(K=l.app)===null||K===void 0?void 0:K.publish_status)=="1"?!!He:!1,console.log(he),q(he.enable_api),H==null||(ne=H.current)===null||ne===void 0||ne.setFieldsValue(he)}},[l]);var T=function(_,K){console.log(_,K),E(K.enable_api),o(K),setTimeout(W,300)},E=function(_){q(!!_)},se=function(_){var K;switch(_.key){case"4":ae.history.go(-1);break;case"0":break;case"2":window.open(kt._n+(l==null||(K=l.app)===null||K===void 0?void 0:K.api_url),"_blank");break;default:S(""),Q(_.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(U==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(xa.Z,{defaultSelectedKeys:["1"],selectedKeys:[U],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:f,items:B,onClick:se}),U=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(Ze.A,{formRef:H,submitter:{render:function(){return null}},onValuesChange:T,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:n.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{disabled:!(l!=null&&(s=l.app)!==null&&s!==void 0&&s.api_url),name:"enable_api",label:"API"})]})})})]}),U=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(fa.default,{})})})]})},ba=wa,Sa=(0,r.memo)(function(d){var s=d.name,n=d.description,c=d.publishStatus,b=(0,ae.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(Ie.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:s}),c&&(0,e.jsxs)(Ie.Z.Text,{className:"whitespace-normal",children:["(",b.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(Ie.Z.Text,{className:"whitespace-normal text-gray-500",children:n})]})}),Da=(0,r.memo)(function(d){var s=d.visibleTabs,n=d.defaultActiveTab,c=d.showTeamSwitch,b=c===void 0?!0:c,f=d.workflowName,Z=d.workflowDesc,o=d.publishStatus,l=d.onWidthChange,S=(0,ae.useIntl)(),A=(0,ae.getLocale)()=="en-US"?"en_US":"zh_Hans",V=(0,gt.o6)(),U=Object.values(V).filter(function(i){return![$.vW.Start,$.vW.Agent,$.vW.Tool,$.vW.Skill].includes(i.base.type)}).map(function(i){return i.base}),Q=(0,r.useState)(n||"1"),a=w()(Q,2),y=a[0],D=a[1],q=(0,r.useState)(U),W=w()(q,2),H=W[0],u=W[1],B=(0,r.useState)([]),T=w()(B,2),E=T[0],se=T[1],P=(0,va.v)(),_=P.tags,K=(0,ta.Z)(dt()(dt()(dt()({},$.vW.Agent,[]),$.vW.Skill,[]),"workflow",[])),ne=w()(K,2),ue=ne[0],He=ne[1],he=(0,r.useState)({team:1,keyword:"",tag:[]}),Pe=w()(he,2),O=Pe[0],Fe=Pe[1],et=(0,r.useState)(!1),Ke=w()(et,2),je=Ke[0],tt=Ke[1],at=(0,r.useState)(!1),Ve=w()(at,2),Ae=Ve[0],m=Ve[1],x=(0,v.Z)(function(i){return i.toolData});(0,r.useEffect)(function(){se((x==null?void 0:x.list)||[])},[x]);var I=(0,r.useCallback)(function(i,g,h){console.log("onDragStart",i,g,h),i.dataTransfer.setData("application/reactflow",JSON.stringify({type:g,item:h})),i.dataTransfer.effectAllowed="move"},[]),F=(0,r.useCallback)(function(i,g){if(!g)return i;var h=new pt.Z(i,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),L=h.search(g);return L.map(function(j){return j.item})},[]),z=(0,r.useCallback)(function(i,g){if(!g)return i;var h=i.map(function(M){var C;return k()(k()({},M),{},{tools:(C=M.tools)===null||C===void 0?void 0:C.map(function(te){var N,R;return k()(k()({},te),{},{categoryName:(N=M.identity)===null||N===void 0||(N=N.label)===null||N===void 0?void 0:N[A],categoryIcon:(R=M.identity)===null||R===void 0?void 0:R.icon})})})}),L=new pt.Z(h,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),j=L.search(g);return j.map(function(M){return k()(k()({},M.item),{},{tools:M.item.tools.filter(function(C){var te=new pt.Z([C],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return te.search(g).length>0})})}).filter(function(M){return M.tools.length>0})},[A]),ee=(0,r.useMemo)(function(){var i=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return O.keyword?F(H,O.keyword):H}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return ye($.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return O.keyword?z(E,O.keyword):E}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var h=le()(G()().mark(function j(){return G()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,ye($.vW.Skill);case 2:return C.abrupt("return",C.sent);case 3:case"end":return C.stop()}},j)}));function L(){return h.apply(this,arguments)}return L}()},{tabKey:"workflow",label:"workflow.list",defaultMessage:"Workflow",type:"workflow",getData:function(){var h=le()(G()().mark(function j(){return G()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,ye("workflow");case 2:return C.abrupt("return",C.sent);case 3:case"end":return C.stop()}},j)}));function L(){return h.apply(this,arguments)}return L}()}],g=s!=null&&s.length?i.filter(function(h){return s.includes(h.tabKey)}):i;return g.map(function(h,L){return k()(k()({},h),{},{key:L+1+""})})},[H,ue,E,s,O,F,z]),Me=(0,r.useMemo)(function(){return ee.map(function(i,g){return{key:i.key,label:S.formatMessage({id:i.label,defaultMessage:i.defaultMessage})}})},[ee]),re=(0,r.useCallback)(function(i){var g=i.tabIndex,h=i.showName,L=h===void 0?!0:h,j=ee.find(function(X){return X.key===g}),M=(0,r.useState)([]),C=w()(M,2),te=C[0],N=C[1],R=(0,r.useState)(!0),me=w()(R,2),nt=me[0],Zt=me[1],Wa=(0,r.useState)([]),Pt=w()(Wa,2),ot=Pt[0],Tt=Pt[1],Oa=(0,r.useState)(20),Aa=w()(Oa,1),Et=Aa[0],Ba=(0,r.useState)(500),Wt=w()(Ba,2),Ot=Wt[0],At=Wt[1],_e=(0,r.useRef)(null),La=54;(0,r.useEffect)(function(){var X=function(){if(_e.current){var ce=_e.current.clientHeight;At(ce)}},de=function(ce){At(ce.detail.height)};return X(),_e.current&&_e.current.addEventListener("containerResize",de),window.addEventListener("resize",X),function(){_e.current&&_e.current.removeEventListener("containerResize",de),window.removeEventListener("resize",X)}},[]),(0,r.useEffect)(function(){var X=function(){var de=le()(G()().mark(function be(){var ce,Ce;return G()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return Zt(!0),ve.prev=1,ve.next=4,j.getData();case 4:ce=ve.sent,Ce=(ce==null?void 0:ce.map(function(Rt,wt){return k()(k()({},Rt),{},{id:"".concat(j.tabKey,"-").concat(wt)})}))||[],N(Ce),Tt(Ce.slice(0,Et)),ve.next=13;break;case 10:ve.prev=10,ve.t0=ve.catch(1),console.error("Failed to fetch data:",ve.t0);case 13:return ve.prev=13,Zt(!1),ve.finish(13);case 16:case"end":return ve.stop()}},be,null,[[1,10,13,16]])}));return function(){return de.apply(this,arguments)}}();X()},[j,O]);var Ra=function(de){if(de.currentTarget.scrollHeight-de.currentTarget.scrollTop===Ot){var be=ot.length;if(be<te.length){var ce=te.slice(be,be+Et);Tt(function(Ce){return[].concat(Ct()(Ce),Ct()(ce))})}}},Bt=(0,r.useCallback)(function(X,de,be,ce){switch(console.log("Clicked category:",X),console.log("Clicked item:",de),console.log("Indices:",be,ce),j.tabKey){case"tool":if(be!==void 0&&ce!==void 0){var Ce,Ge;console.log("Tool ".concat((Ce=de.identity)===null||Ce===void 0?void 0:Ce.label[A]," in category ").concat((Ge=X.identity)===null||Ge===void 0?void 0:Ge.label[A]))}break;case"workflow":break;case"agent":break}},[j.tabKey,A]),Lt=(0,r.memo)(function(X){var de=X.data,be=X.index,ce=X.onDragStart,Ce=X.onItemClick,Ge=X.type,ve=X.typeBadge;return(0,e.jsx)(ca,{typeBadge:ve,list:[de],onDragStart:ce,type:Ge,onItemClick:function(wt){return Ce(wt)}})});return(0,e.jsx)("div",{ref:_e,className:"overflow-y-auto h-full",children:(0,e.jsx)(aa.Z,{spinning:nt,children:O!=null&&O.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:ot.map(function(X){return(0,e.jsx)(Lt,{data:X,index:ot.indexOf(X),onDragStart:I,onItemClick:Bt,type:j.type,typeBadge:O!=null&&O.keyword&&j.tabKey!="node"?{icon:"/icons/".concat(j.tabKey,".svg"),tooltip:j.tabKey,color:"#1b64f3"}:void 0},X.id)})}):(0,e.jsx)(oa.Z,{data:ot,height:Ot,itemHeight:La,itemKey:"id",onScroll:Ra,children:function(de){return(0,e.jsx)(Lt,{data:de,index:ot.indexOf(de),onDragStart:I,onItemClick:Bt,type:j.type,typeBadge:O!=null&&O.keyword&&j.tabKey!="node"?{icon:"/icons/".concat(j.tabKey,".svg"),tooltip:j.tabKey,color:"#1b64f3"}:void 0})}})})})},[y,O,je]),ye=(0,r.useCallback)(function(){var i=le()(G()().mark(function g(h){var L,j,M,C;return G()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.prev=0,N.next=3,(0,Y.RE)(h,{search_type:O.team,apps_name:O.keyword,tag_ids:((L=O.tag)===null||L===void 0?void 0:L.join(","))||""});case 3:if(M=N.sent,!((M==null?void 0:M.code)===0&&M!==null&&M!==void 0&&(j=M.data)!==null&&j!==void 0&&(j=j.list)!==null&&j!==void 0&&j.length)){N.next=8;break}return C=M.data.list.map(function(R){var me,nt;return k()(k()({},(me=V[h])===null||me===void 0?void 0:me.base),{},{data:k()(k()({},(nt=V[h])===null||nt===void 0?void 0:nt.base.data),{},{title:R.name,desc:R.description}),baseData:R})}),He(dt()({},h,C)),N.abrupt("return",C);case 8:N.next=13;break;case 10:N.prev=10,N.t0=N.catch(0),console.error("Failed to fetch ".concat(h," data:"),N.t0);case 13:case"end":return N.stop()}},g,null,[[0,10]])}));return function(g){return i.apply(this,arguments)}}(),[O]),xe=(0,r.useCallback)((0,jt.debounce)(function(i){Fe(i)},500),[]),p=(0,r.useCallback)(function(i,g){"team"in i?(Fe(g),g.team==2):("tag"in i||"keyword"in i)&&xe(g)},[xe]);return(0,e.jsx)(Jt.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:Ae?100:315,onChange:function(g,h){requestAnimationFrame(function(){tt(g<100),l==null||l(g);var L=document.querySelectorAll(".overflow-y-auto");L.forEach(function(j){if(j instanceof HTMLElement){var M=j.clientHeight,C=new CustomEvent("containerResize",{detail:{height:M,width:g}});j.dispatchEvent(C)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[!Ae&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(Ze.A,{submitter:!1,initialValues:O,onValuesChange:p,children:[b&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[S.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Qt.Z.Group,{name:"team",fieldProps:{options:[{label:S.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:S.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(qt.Z,{fieldProps:{prefix:(0,e.jsx)(Xt.Z,{}),placeholder:S.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(ea.Z,{name:"tag",children:(0,e.jsx)(Yt.O,{className:"w-full",options:_,listStyle:je?"horizontal":"vertical",allowClear:!0,placeholder:S.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(g){}})})})]}),O!=null&&O.keyword?null:(0,e.jsx)(na.Z,{activeKey:y,items:Me,onChange:function(g){D(g)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:O!=null&&O.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:ee.map(function(i,g){return(0,e.jsxs)("div",{className:"space-y-2",children:[!Ae&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:S.formatMessage({id:i.label,defaultMessage:i.defaultMessage})}),(0,e.jsx)(re,{tabIndex:g+1+"",showName:!je},i.key)]},i.key)})}):(0,e.jsx)(re,{tabIndex:y,showName:!je})}),(0,e.jsx)(ba,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Sa,{name:f,description:Z,publishStatus:o})})]})})}),ja=t(74842),Ma=t(98165),Ca=t(58638),ka=t(27484),Ia=t.n(ka),Na=(0,r.memo)(function(){var d=(0,ae.useIntl)(),s=(0,ae.useSearchParams)(),n=w()(s,1),c=n[0],b=(0,v.Z)(function(W){return W.setWorkFlowInfo}),f=(0,v.Z)(function(W){return W.workFlowInfo}),Z=(0,v.Z)(function(W){return W.setRunPanelShow}),o=c.get("type")=="true",l=(0,xt.Z)(),S=J.ZP.useMessage(),A=w()(S,2),V=A[0],U=A[1],Q=function(){var W=le()(G()().mark(function H(){var u;return G()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,l();case 2:u=c.get("app_id"),(0,Y.aJ)(u).then(function(E){console.log(E),E.code==0&&(b(k()(k()({},f),{},{app:k()(k()({},f==null?void 0:f.app),{},{publish_status:"1"})})),V.open({type:"success",content:d.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return T.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),a=function(){Z(!0)},y=function(){var W=le()(G()().mark(function H(){var u,B;return G()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=c.get("app_id"),E.next=3,(0,Y.Uq)(u);case 3:B=E.sent;case 4:case"end":return E.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),D=function(){var W=le()(G()().mark(function H(){var u,B,T,E;return G()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:B=c.get("app_id"),T=(f==null||(u=f.app)===null||u===void 0?void 0:u.name)||"workflow",E=Ia()().format("YYYY_MM_DD-HH_mm_ss"),(0,Y.w8)(B,o==!0?1:0).then(function(_){var K=new Blob([_],{type:"text/yaml"}),ne=URL.createObjectURL(K),ue=document.createElement("a");ue.href=ne,ue.download="".concat(T,"_").concat(E,".yml"),document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ne)});case 4:case"end":return P.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),q={name:"file",fileList:null,action:kt._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!o&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)($e.ZP,{type:"primary",onClick:Q,children:d.formatMessage({id:"workflow.release"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(ja.Z,{}),onClick:a,children:d.formatMessage({id:"workflow.run"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ma.Z,{}),type:"dashed",onClick:l,children:d.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ca.Z,{}),type:"dashed",onClick:D,children:d.formatMessage({id:"workflow.export",defaultMessage:""})}),U]})}),Nt=t(55877),Za=function(){var s,n,c=(0,ae.useIntl)(),b=(0,r.useRef)(null),f=(0,v.Z)(function(p){return p.resetNodes}),Z=(0,v.Z)(function(p){return p.setNodeTypes}),o=(0,v.Z)(function(p){return p.addNode}),l=(0,v.Z)(function(p){return p.createNode}),S=(0,v.Z)(function(p){return p.setNodes}),A=(0,v.Z)(function(p){return p.setEdges}),V=(0,v.Z)(function(p){return p.setAppId}),U=(0,v.Z)(function(p){return p.setRunPanelShow}),Q=(0,v.Z)(function(p){return p.runPanelShow}),a=(0,v.Z)(function(p){return p.getModelData}),y=(0,v.Z)(function(p){return p.setWorkFlowInfo}),D=(0,v.Z)(function(p){return p.setHandleList}),q=(0,v.Z)(function(p){return p.workFlowInfo}),W=(0,v.Z)(function(p){return p.setWorkflowEditInfo}),H=J.ZP.useMessage(),u=w()(H,2),B=u[0],T=u[1],E=(0,ge._K)(),se=E.screenToFlowPosition,P=E.getNodes,_=E.setViewport,K=Ne(se),ne=K.onDnD,ue=(0,ae.useSearchParams)(),He=w()(ue,1),he=He[0],Pe=he.get("type")=="true",O=(0,ge.B)({includeHiddenNodes:!1}),Fe=(0,Ee.Z)(),et=(0,xt.Z)(),Ke=(0,r.useState)(null),je=w()(Ke,2),tt=je[0],at=je[1],Ve=(0,r.useState)(!1),Ae=w()(Ve,2),m=Ae[0],x=Ae[1],I=(0,r.useState)(""),F=w()(I,2),z=F[0],ee=F[1],Me=null;(0,ge.CV)({onEnd:function(i){}}),(0,Be.Z)(function(){Z((0,gt.$P)()),f(),(0,Xe.b6)(),re(),D([])}),De(),(0,r.useEffect)(function(){if(tt){ae.history.push(z);return}var p=ae.history.block(function(i,g){if(Q){ee(i.location.pathname),x(!0);return}});return Q||p==null||p(),function(){p==null||p()}},[Q,tt]),(0,ke.Z)(function(){if(O){var p=P(),i=p[p.length-1];i.data.drag&&(i.position={x:i.position.x-i.measured.width/2,y:i.position.y-i.measured.height/2},S(p))}},[O]),(0,r.useEffect)(function(){var p=ne(function(i,g,h){console.log(i,g,h),l(g,{position:i,data:k()(k()({drag:!0},h.data),{},{baseData:h.baseData})})});return p},[ne,o]),(0,ke.Z)(function(){Fe=="hidden"&&et()},[Fe]);var re=function(){var p=le()(G()().mark(function i(){var g;return G()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:g=he.get("app_id"),Pe&&B.open({type:"warning",content:c.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),V(g),(0,Y.kE)(g,Pe?1:0).then(function(j){if(j.code==0){if(y(k()(k()({},j.data),{},{isProd:Pe})),!j.data.workflow.graph){l($.vW.Start);return}var M=j.data,C=M.workflow.graph,te=C.edges,N=C.nodes,R=C.views,me=M.app;W({enable_api:!!me.enable_api,is_public:!!me.is_public}),R!=null&&R.nodes&&S(R.nodes),R!=null&&R.edges&&A(R.edges),R!=null&&R.viewPort}}),a();case 5:case"end":return L.stop()}},i)}));return function(){return p.apply(this,arguments)}}(),ye=function(){at(!0),console.log(z),ae.history.push(z),x(!1)},xe=function(){x(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[T,(0,e.jsx)(we.Z,{title:c.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:m,onOk:ye,onCancel:xe,children:c.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:b,children:(0,e.jsxs)(Re,{children:[(0,e.jsx)(ge.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(ge.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(Da,{visibleTabs:["node","agent","skill","tool"],workflowName:q==null||(s=q.app)===null||s===void 0?void 0:s.name,workflowDesc:q==null||(n=q.app)===null||n===void 0?void 0:n.description,publishStatus:Pe}),(0,e.jsx)(Na,{}),(0,e.jsx)(Nt.s_,{}),(0,e.jsx)(Nt.Jf,{}),(0,e.jsx)(Kt,{})]})},Pa=(0,r.memo)(function(){return(0,e.jsx)(ge.tV,{children:(0,e.jsx)(Za,{})})}),Ta=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(Pa,{})})},Ea=Ta}}]);
