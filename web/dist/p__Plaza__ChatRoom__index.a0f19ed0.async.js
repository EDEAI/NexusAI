"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{82826:function(Oe,ge,l){l.d(ge,{Z:function(){return fe}});var ve=l(1413),j=l(67294),ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},K=ye,Se=l(91146),y=function(J,Ze){return j.createElement(Se.Z,(0,ve.Z)((0,ve.Z)({},J),{},{ref:Ze,icon:K}))},se=j.forwardRef(y),fe=se},3471:function(Oe,ge,l){var ve=l(1413),j=l(67294),ye=l(29245),K=l(91146),Se=function(fe,t){return j.createElement(K.Z,(0,ve.Z)((0,ve.Z)({},fe),{},{ref:t,icon:ye.Z}))},y=j.forwardRef(Se);ge.Z=y},88484:function(Oe,ge,l){l.d(ge,{Z:function(){return fe}});var ve=l(1413),j=l(67294),ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},K=ye,Se=l(91146),y=function(J,Ze){return j.createElement(Se.Z,(0,ve.Z)((0,ve.Z)({},J),{},{ref:Ze,icon:K}))},se=j.forwardRef(y),fe=se},51636:function(Oe,ge,l){l.r(ge),l.d(ge,{default:function(){return Oa}});var ve=l(15009),j=l.n(ve),ye=l(99289),K=l.n(ye),Se=l(5574),y=l.n(Se),se=l(43722),fe=l(32983),t=l(67294),J=l(35312),Ze=l(19632),ue=l.n(Ze),it=l(97857),Q=l.n(it),je=l(80459),lt=l(82114),ct=l(82826),ot=l(63783),ut=l(3471),Ve=l(45360),dt=l(85576),Ne=l(28036),We=l(83062),Ge=l(72269),Ce=l(74330),Ee=l(96486),Ke=l(44010),ae=l(39e3),e=l(85893),pt=function(a){var n=(0,J.useIntl)(),x=a.roomDetail,w=a.setAgent,h=Ve.ZP.useMessage(),r=y()(h,2),v=r[0],R=r[1],g=(0,J.useParams)(),p=g.id,m=(0,ae.Z)(function(c){return c.disableInput}),O=(0,ae.Z)(function(c){return c.truncatable}),F=(0,ae.Z)(function(c){return c.setClearMemory}),M=(0,t.useState)([]),_=y()(M,2),u=_[0],H=_[1],T=(0,t.useState)(Q()({},x)),E=y()(T,2),k=E[0],V=E[1],ne=(0,t.useState)([]),b=y()(ne,2),A=b[0],P=b[1],ee=(0,t.useRef)(!1),de=(0,t.useRef)(!1),re=(0,t.useState)(!1),G=y()(re,2),D=G[0],U=G[1],z=function(){var o=dt.Z.confirm;o({title:n.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(lt.Z,{}),content:n.formatMessage({id:"app.chatroom.clear.tips"}),okText:n.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:n.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){F(["TRUNCATE","0"])}})},C=function(){var c=K()(j()().mark(function o(){var s;return j()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!p){f.next=5;break}return f.next=3,(0,se.cH)({id:p});case 3:if(s=f.sent,s.code==0)try{V(function(){return Q()(Q()({},s.data.chat_info),{},{max_round:s.data.max_round,smart_selection:s.data.smart_selection})}),H(s.data.agent_list),ee.current=!0}catch(I){}case 5:case"end":return f.stop()}},o)}));return function(){return c.apply(this,arguments)}}(),te=function(){var c=K()(j()().mark(function o(){var s;return j()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,se.j2)({id:p});case 2:s=f.sent,s.code==0&&(P(s.data.list),de.current=!0);case 4:case"end":return f.stop()}},o)}));return function(){return c.apply(this,arguments)}}(),ce=function(){var c=K()(j()().mark(function o(s){var i,f,I;return j()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!p){N.next=11;break}if(i=s.active==1?0:1,i!=0){N.next=7;break}if(f=u.filter(function(L){return L.active==1}),f.length-1!=0){N.next=7;break}return v.open({type:"error",content:n.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),N.abrupt("return",!1);case 7:return N.next=9,(0,se.sT)({active:i},p,s.agent_id);case 9:I=N.sent,I.code==0&&H(function(L){return L.map(function(Y){return Q()(Q()({},Y),{},{active:Y.agent_id==s.agent_id?i:Y.active})})});case 11:case"end":return N.stop()}},o)}));return function(s){return c.apply(this,arguments)}}(),me=function(o){return o.length>6?o.length=6:o.lenth,o},ie=function(o){o.type=="my_agent"?J.history.push("/Agents?app_id=".concat(o.app_id,"&type=false&from=chat_room")):J.history.push("/ReadOnlyAgent?app_id=".concat(o.app_id,"&type=true&from=chat_room"))},X=function(o){J.history.replace("/chat_room/".concat(o.chatroom_id)),window.location.reload()},B=function(){U(!0)},$=function(){U(!1)},W=function(){var c=K()(j()().mark(function o(s){var i,f,I;return j()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!(s.checkItem&&s.checkItem.length==0)){N.next=3;break}return v.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),N.abrupt("return");case 3:return i=ue()(s.checkItem).map(function(L){var Y=L.agent_id,he=L.active,q=he===void 0?1:he;return{agent_id:Y,active:q}}),f={description:k.description,name:k.name,max_round:k.max_round},N.next=7,(0,se.sI)(Q()(Q()({},f),{},{agent:i}),p);case 7:I=N.sent,I.code==0?(s.checkItem.map(function(L){L.active=L.active==null?1:L.active}),H(ue()(s.checkItem)),w.current=ue()(s.checkItem),v.open({type:"success",content:n.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):v.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return N.stop()}},o)}));return function(s){return c.apply(this,arguments)}}(),S=function(){var c=K()(j()().mark(function o(){var s;return j()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=k.smart_selection==1?0:1,f.next=3,(0,se.r5)({smart_selection:s},p);case 3:V(function(I){return Q()(Q()({},I),{},{smart_selection:s})});case 4:case"end":return f.stop()}},o)}));return function(){return c.apply(this,arguments)}}();return(0,t.useEffect)(function(){C(),te()},[]),(0,e.jsxs)(e.Fragment,{children:[R,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){J.history.go(-1)},children:[(0,e.jsx)(Ne.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(ct.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:n.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:k.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(We.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:n.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(ot.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:n.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ge.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:k.smart_selection==1,onChange:S,disabled:m})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:ee.current?(0,e.jsx)("div",{className:"flex flex-col",children:u&&u.length>0?u.map(function(c){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)(je.Z,{data:c}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:c.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:c.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){ie(c)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ge.Z,{size:"small",disabled:m,defaultChecked:!0,className:"w-[28px]",checked:c.active==1,onChange:function(){ce(c)}})]})]},c.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(fe.Z,{image:fe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Ce.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:B,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:O&&!m?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Ee.throttle)(function(){O&&!m&&z()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:n.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:de.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:A&&A.length>0?A.map(function(c){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){X(c)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:c.name}),c.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:c.agent_list&&c.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[me(c.agent_list).map(function(o,s){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)(je.Z,{data:o,width:"30px"})},s)}),c.agent_list.length>=6?(0,e.jsx)(ut.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},c.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(fe.Z,{image:fe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(Ce.Z,{})})})})]})]}),(0,e.jsx)(Ke.Z,{show:D,popupClose:$,popupSave:W,checkList:u,zIndex:99})]})]})},ft=(0,t.memo)(pt),mt=l(13769),Je=l.n(mt),xt=l(47635),Pe=l(27522),vt=l(77295),Te=l(32332),pe=l(1413),ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},gt=ht,we=l(91146),jt=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:gt}))},yt=t.forwardRef(jt),St=yt,Le=l(69753),Nt=l(97245),wt=l(88484),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},Ct=bt,Rt=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Ct}))},Mt=t.forwardRef(Rt),kt=Mt,Ft=l(2068),It={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},Zt=It,At=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Zt}))},Dt=t.forwardRef(At),Ot=Dt,Qe=l(26915),Be=l(55060),Xe=l(66309),Et=l(20640),Ye=l.n(Et),Re=l(22683),Me=l(97807),Pt=["node","className","children"],Tt=["node"],Lt=Qe.Z.TextArea,ke=function(a,n){try{var x=document.createElement("a");x.href=a,x.download=n,x.target="_blank",document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch(w){}},Bt=(0,t.memo)(function(d){var a=d.setInstruction,n=d.messageApi,x=d.isStop,w=d.scrollDomRef,h=d.upButtonDom,r=(0,J.useIntl)(),v=(0,ae.Z)(function(b){return b.disableInput}),R=(0,ae.Z)(function(b){return b.setDisableInput}),g=(0,vt.ZP)({maxSizeMB:15,acceptedFileTypes:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv,.jpg,.png,.jpeg",multiple:!0}),p=g.uploadedFiles,m=g.handleUpload,O=g.removeFile,F=g.clearFiles,M=g.isUploading,_=(0,t.useState)(""),u=y()(_,2),H=u[0],T=u[1],E=function(A){(p==null?void 0:p.length)>0?(a(["FILELIST",p.map(function(P){return P.file_id})]),setTimeout(function(){a(["INPUT",A]),p.length>0&&F()},300)):a(["INPUT",A])},k=function(A){!A.shiftKey&&A.target.value==""&&(n.open({type:"warning",content:r.formatMessage({id:"app.chatroom.content.input"}),duration:10}),T(""),A.preventDefault()),!A.shiftKey&&A.keyCode==13&&A.target.value!=""&&(R(!0),T(""),E(A.target.value),A.preventDefault())},V=(0,Ee.throttle)(function(){a(["STOP",null])},300),ne=function(){v||m()};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:h,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(A){w.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(St,{className:"text-[16px]"})}),(0,e.jsx)(Be.Z.PreviewGroup,{children:p.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map(function(b){return(0,e.jsx)(Xe.Z,{closable:!0,onClose:function(){return O(b.uid)},className:"flex items-center ".concat(b.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(We.Z,{title:b.name,children:(0,e.jsx)("div",{className:"flex items-center",children:b.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(Be.Z,{src:b.path_show||b.url,alt:b.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:b.path_show||b.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:b.name}),(0,e.jsx)(Le.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(P){P.stopPropagation(),ke(b.path_show||b.url,b.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Nt.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:b.name}),(0,e.jsx)(Le.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(P){P.stopPropagation(),ke(b.path_show||b.url,b.name)}})]})})})},b.uid)})})})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] ".concat(p.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,e.jsx)(Ne.ZP,{type:"text",icon:(0,e.jsx)(wt.Z,{}),onClick:ne,disabled:v||M,loading:M}),(0,e.jsx)(Lt,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:H,disabled:v,onChange:function(A){T(A.target.value)},onPressEnter:k,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(r.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),x?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:V,children:(0,e.jsx)(kt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(v||!H?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Ee.throttle)(function(){if(v||!H)return!1;H||n.open({type:"warning",content:r.formatMessage({id:"app.chatroom.content.input"}),duration:10}),R(!0),E(H),T("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),$t=function d(a){return typeof a=="string"?a:Array.isArray(a)?a.map(d).join(""):t.isValidElement(a)?d(a.props.children):""},_t=function(a){return $t(a)},$e=function(a,n){return{code:function(w){var h=w.node,r=w.className,v=w.children,R=Je()(w,Pt),g=/language-(\w+)/.exec(r||"");if(g!=null&&g.length){var p=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:g[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var m=K()(j()().mark(function O(F){var M;return j()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,M=F.currentTarget,u.next=4,Ye()(_t(v));case 4:M&&(M.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){M&&(M.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(0),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},O,null,[[0,8]])}));return function(O){return m.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(p).concat(a),className:"p-4",children:v})})]})}else return(0,e.jsx)("code",Q()(Q()({},R),{},{children:v}))},img:function(w){var h=w.node,r=Je()(w,Tt);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(Be.Z,{src:r.src,alt:r.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(Ne.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(Le.Z,{}),onClick:function(R){R.stopPropagation(),ke(r.src||"",r.alt||"image.png")}})})]})}}},qe=(0,t.memo)(function(d){var a=d.messageApi,n=d.index,x=d.idName,w=d.cidName,h=(0,J.useIntl)(),r=(0,t.useState)(!1),v=y()(r,2),R=v[0],g=v[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){g(!0)},onMouseLeave:function(){g(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var p=K()(j()().mark(function m(O){var F,M;return j()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return F=O.target.closest("#".concat(x).concat(n)),M=F.querySelector("#".concat(w).concat(n)),u.prev=2,u.next=5,Ye()(M.innerText);case 5:a.open({type:"success",content:h.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(2),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},m,null,[[2,8]])}));return function(m){return p.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(R?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(R?" text-[#1B64F3]":"text-[#666]"),children:h.formatMessage({id:"app.chatroom.content.copy"})})]})})}),et=function(a){var n=a.id,x=a.index,w=a.idName,h=a.cidName,r=(0,J.useIntl)(),v=(0,ae.Z)(function(M){return M.setSummaryClick}),R=(0,t.useState)(!0),g=y()(R,2),p=g[0],m=g[1],O=(0,ae.Z)(function(M){return M.summaryClick});(0,t.useEffect)(function(){m(O)},[O]);var F=(0,ae.Z)(function(M){return M.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(p?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(_){if(p){var u=_.target.closest("#".concat(w).concat(x)),H=u.querySelector("#".concat(h).concat(x));F({id:n,message:H.innerText}),v(!1)}},children:[(0,e.jsx)(Ft.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.content.summary"})})]})})},Ht=function(a){var n=a.roomid,x=(0,J.useIntl)(),w=(0,ae.Z)(function(m){return m.setSummaryClick}),h=(0,t.useState)(!0),r=y()(h,2),v=r[0],R=r[1],g=(0,ae.Z)(function(m){return m.summaryClick});(0,t.useEffect)(function(){R(g)},[g]);var p=(0,ae.Z)(function(m){return m.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(v?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){v&&(p({id:n}),w(!1))},children:[(0,e.jsx)(Ot,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:x.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ut=(0,t.memo)(function(d){var a=d.messageApi,n=d.setCurrentMessageContent,x=d.sendValue,w=d.agentList,h=d.scrollDomRef,r=d.upButtonDom,v=d.setIsStop,R=d.setisEnd,g=d.setSendValue,p=(0,J.useIntl)(),m=(0,J.useParams)(),O=m.id,F=(0,ae.Z)(function(ee){return ee.setDisableInput}),M=(0,t.useState)({}),_=y()(M,2),u=_[0],H=_[1],T=(0,t.useRef)(!1),E=(0,t.useRef)(""),k=(0,ae.Z)(function(ee){return ee.setTruncatable}),V=function(de){var re=de.data;if(re.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var G=JSON.parse(re.slice(22,-2));switch(G[0]){case"ERROR":F(!1),v(!1),g(""),a.open({type:"error",content:"webSocket-".concat(G[1]),duration:10});break;case"CHAT":var D={content:"".concat(G[1]),is_agent:0};n(function(C){return[].concat(ue()(C),[D])}),setTimeout(function(){h.current.scrollTop=0,r.current.style.display="none"});break;case"WITHFILELIST":n(function(C){var te=ue()(C);return te.length&&(te[te.length-1].file_list=G[1]),te}),setTimeout(function(){h.current.scrollTop=0,r.current.style.display="none"});break;case"STOPPABLE":v(G[1]);break;case"TRUNCATABLE":k(G[1]),G[1]||a.open({type:"success",content:"".concat(p.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":a.open({type:"success",content:"".concat(p.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(re.indexOf("REPLY")!==-1&&re.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var U=JSON.parse(re.slice(22,-2))[1];E.current="",T.current=!0;var z=w.current.filter(function(C){return C.agent_id==U})[0];Object.keys(u).length&&n(function(C){return[].concat(ue()(C),[u])}),H(function(C){return Q()(Q()({},C),{},{is_agent:1,icon:z==null?void 0:z.icon,name:z==null?void 0:z.name})}),v(!0),k(!1)}re.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&T.current&&(h.current.scrollTop=0,r.current.style.display="none",E.current+=re,H(function(C){return Q()(Q()({},C),{},{content:E.current})})),re.indexOf("ENDCHAT")!==-1&&(T.current=!1,E.current="",F(!1),v(!1),k(!0),Object.keys(u).length&&n(function(C){return[].concat(ue()(C),[u])}),H({}),R(!0),g(""))},ne=(0,xt.Z)("chat",V),b=ne.runSocket,A=ne.sendMessage,P=ne.readyState;return(0,t.useEffect)(function(){P==1&&O&&A(JSON.stringify(["ENTER",parseInt(O)]))},[P]),(0,t.useEffect)(function(){x&&P==1&&A(x)},[x]),(0,t.useEffect)(function(){b()},[]),(0,e.jsx)(e.Fragment,{children:u.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(u.is_agent!=1?"flex-row-reverse":""),children:[u.is_agent==1?(0,e.jsx)(je.Z,{data:u}):(0,e.jsx)(je.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(u.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:u.name?u.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(u.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:u.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:[u.file_list&&u.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Pe.Z,{fileList:u.file_list,onDownload:ke})}),(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],components:$e("add",p),children:u.content})]})})]})]}):(0,e.jsx)(e.Fragment,{})})}),zt=(0,t.memo)(function(d){var a=d.messageApi,n=d.setUserMessage,x=d.sendValue,w=d.agentList,h=d.scrollDomRef,r=d.upButtonDom,v=d.setIsStop,R=d.setSendValue,g=(0,J.useIntl)(),p=(0,t.useState)([]),m=y()(p,2),O=m[0],F=m[1],M=(0,t.useState)(!1),_=y()(M,2),u=_[0],H=_[1],T=(0,J.useParams)(),E=T.id;return(0,t.useEffect)(function(){u&&(n(function(k){return[].concat(ue()(O.reverse()),ue()(k))}),F([]),setTimeout(function(){H(!1),h.current.scrollTop=0},200))},[u]),(0,e.jsxs)(e.Fragment,{children:[O.length?O.map(function(k,V){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(k.is_agent!=1?"flex-row-reverse":""),children:[k.is_agent==1?(0,e.jsx)(je.Z,{data:k}):(0,e.jsx)(je.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(V),children:[(0,e.jsx)("div",{className:"".concat(k.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:k.name?k.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(k.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:k.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(V),children:[k.file_list&&k.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Pe.Z,{fileList:k.file_list,onDownload:ke})}),(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],components:$e(V,g),children:k.content})]})}),k.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(qe,{messageApi:a,index:V,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(et,{id:E,index:V,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},V)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Ut,{messageApi:a,setCurrentMessageContent:F,sendValue:x,agentList:w,scrollDomRef:h,upButtonDom:r,setIsStop:v,setisEnd:H,setSendValue:R})]})}),Vt=(0,t.memo)(function(d){var a=d.messageApi,n=d.scrollDomRef,x=d.instruction,w=d.setIsStop,h=d.upButtonDom,r=d.setInstruction,v=d.agentList,R=(0,J.useIntl)(),g=(0,J.useParams)(),p=g.id,m=(0,t.useState)([]),O=y()(m,2),F=O[0],M=O[1],_=(0,t.useRef)(!1),u=(0,t.useState)(""),H=y()(u,2),T=H[0],E=H[1],k=(0,t.useRef)(null),V=(0,t.useRef)(!0),ne=(0,t.useRef)(2),b=(0,t.useRef)(1),A=(0,t.useRef)(0),P=function(){var D=K()(j()().mark(function U(z){var C,te,ce=arguments;return j()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(C=ce.length>1&&ce[1]!==void 0?ce[1]:function(){},!p){ie.next=6;break}return ie.next=4,(0,se.KH)(p,{page:b.current,page_size:10});case 4:te=ie.sent,te.code==0&&(ne.current=te.data.total_pages,z||(k.current.style.display="none"),M(function(X){return z?ue()(te.data.list.reverse()):[].concat(ue()(X),ue()(te.data.list.reverse()))}),z?setTimeout(function(){n.current.scrollTop=0,h.current.style.display="none"}):A.current=te.data.list.length,V.current=!0);case 6:case"end":return ie.stop()}},U)}));return function(z){return D.apply(this,arguments)}}(),ee=function(U){var z=U.target.scrollHeight+(U.target.scrollTop-U.target.clientHeight);_.current!==Math.ceil(U.target.scrollTop)<-50&&(_.current=Math.ceil(U.target.scrollTop)<-50,h.current.style.display=_.current?"flex":"none"),z<10&&V.current&&(V.current=!1,b.current=b.current+1,k.current.style.display="flex",ne.current>=b.current?P(!1):k.current.style.display="none")},de=function(U,z){z==="0"&&(z=Number(z));var C=["".concat(U),z===0||z?z:null];E(JSON.stringify(C))},re=(0,ae.Z)(function(D){return D.disableInput}),G=(0,ae.Z)(function(D){return D.clearMemory});return(0,t.useEffect)(function(){G&&G.length&&de(G[0],G[1])},[G]),(0,t.useEffect)(function(){x&&x.length&&(de(x[0],x[1]?x[1]:""),r([]))},[x]),(0,t.useEffect)(function(){b.current=1,P(!0)},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:n,onScroll:ee,children:[(0,e.jsxs)("div",{className:"min-w-[860px]",children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:F&&F.length?F.map(function(D,U){return(0,e.jsxs)("div",{id:"c".concat(D.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(D.is_agent!=1?"flex-row-reverse":""),children:[D.is_agent==1?(0,e.jsx)(je.Z,{data:D}):(0,e.jsx)(je.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(U),children:[(0,e.jsx)("div",{className:"".concat(D.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:D.name?D.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(D.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:D.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(U),children:[D.file_list&&D.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Pe.Z,{fileList:D.file_list,onDownload:ke})}),(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],components:$e(U,R),children:D.content})]})}),D.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(qe,{messageApi:a,idName:"content",cidName:"chilContent",index:U}),(0,e.jsx)(et,{id:p,index:U,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},U)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(zt,{messageApi:a,setUserMessage:M,sendValue:T,agentList:v,scrollDomRef:n,upButtonDom:h,setIsStop:w,setSendValue:E})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!re&&F.length?(0,e.jsx)(Ht,{roomid:p}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:k,children:(0,e.jsx)(Ce.Z,{})})]})})}),Wt=(0,t.memo)(function(d){var a=d.agentList,n=(0,t.useRef)(null),x=(0,t.useRef)(null),w=(0,t.useState)(!1),h=y()(w,2),r=h[0],v=h[1],R=(0,t.useState)([]),g=y()(R,2),p=g[0],m=g[1],O=Ve.ZP.useMessage(),F=y()(O,2),M=F[0],_=F[1];return(0,e.jsxs)(e.Fragment,{children:[_,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full",children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(Vt,{instruction:p,setInstruction:m,messageApi:M,scrollDomRef:n,setIsStop:v,upButtonDom:x,agentList:a}),(0,e.jsx)(Bt,{setInstruction:m,messageApi:M,isStop:r,upButtonDom:x,scrollDomRef:n})]})})]})}),Gt=l(39873),Kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},Jt=Kt,Qt=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Jt}))},Xt=t.forwardRef(Qt),Yt=Xt,qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},ea=qt,ta=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:ea}))},aa=t.forwardRef(ta),na=aa,ra=l(83159),sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},ia=sa,la=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:ia}))},ca=t.forwardRef(la),oa=ca,_e=l(86),tt=l(34994),at=l(2216),ua=l(85877),da=l(29432),pa=l(39944),fa=l(11551),He=l(55927),ma=function(a){var n,x,w,h,r=a.selectApp,v=a.runid,R=a.setBoxLoading,g=a.setinputShow,p=a.appId,m=a.id,O=a.setisRun,F=(0,J.useIntl)(),M=(0,t.useRef)(""),_=(0,t.useRef)(""),u=(0,t.useRef)(null),H=(0,t.useState)(""),T=y()(H,2),E=T[0],k=T[1],V=(0,t.useState)(null),ne=y()(V,2),b=ne[0],A=ne[1],P=(0,t.useState)([]),ee=y()(P,2),de=ee[0],re=ee[1],G=(0,t.useState)(""),D=y()(G,2),U=D[0],z=D[1],C=(0,He.Z)(function(X){return X.flowMessage}),te=function(B){_.current=ce(B);var $={user:{value:ce(B)}};z(new pa.z($))},ce=function X(B){return B.map(function($){return $.type==="mention"?$.id:$.children?X($.children):$.text}).join("")},me=function(){var X=K()(j()().mark(function B($){var W,S;return j()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return R(!0),W=Object.keys($),W.forEach(function(s){u.current.properties[s]&&(u.current.properties[s].value=$[s])}),o.next=5,(0,fa.LH)({agent_id:r.checkItem[0].agent_id,ability_id:0,input_dict:u.current,prompt:U,data_source_run_id:M.current});case 5:S=o.sent,S.code==0&&(k(S.data.outputs_md),R(!1),O(!1));case 7:case"end":return o.stop()}},B)}));return function($){return X.apply(this,arguments)}}(),ie=function(){var X=K()(j()().mark(function B($,W){var S,c;return j()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,se.xT)($,W);case 2:S=s.sent,(S==null?void 0:S.code)==0&&(M.current=S==null||(c=S.data)===null||c===void 0?void 0:c.app_run_id);case 4:case"end":return s.stop()}},B)}));return function($,W){return X.apply(this,arguments)}}();return(0,t.useEffect)(function(){r&&r.checkItem.length&&(O(!0),ie(m,{app_id:p,app_run_id:v,status:1,corrected_parameter:""}))},[r]),(0,t.useEffect)(function(){var X=C.filter(function(o){return o.data.app_run_id==v&&o.type.indexOf("generate_meeting_action_items")!==-1});if(X.length!=0){var B,$=(B=X[X.length-1])===null||B===void 0||(B=B.data)===null||B===void 0||(B=B.exec_data)===null||B===void 0||(B=B.outputs)===null||B===void 0?void 0:B.value;if($){var W=JSON.parse($);u.current=W;var S=Object.keys(W.properties);if(S.length){A(W.properties);var c=S.map(function(o){return{value:"<<".concat(da.qX,".inputs.").concat(o,">>"),label:o}});re(c)}g(!1),R(!1)}}},[C]),console.log(r),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(_e.Z,{icon:r==null||(n=r.checkItem[0])===null||n===void 0?void 0:n.icon,title:r==null||(x=r.checkItem[0])===null||x===void 0?void 0:x.name,textDetails:r==null||(w=r.checkItem[0])===null||w===void 0?void 0:w.description,iconType:"robot_icon",avatar:r==null||(h=r.checkItem[0])===null||h===void 0?void 0:h.avatar,handleClick:function(){}})}),b!=null?(0,e.jsxs)(tt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!_.current},searchConfig:{submitText:F.formatMessage({id:"workflow.button.run"})}},onFinish:function(B){me(B)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(at._,{data:b})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ua.Z,{onChange:function(B){te(B)},options:de,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),E?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],children:E})})}):(0,e.jsx)(e.Fragment,{})]})},xa=(0,t.memo)(ma),nt=l(42237),va=l(93696),ha=function(a,n){return t.createElement(we.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:va.Z}))},ga=t.forwardRef(ha),ja=ga,ya=l(4981),rt=l(29608),Sa=(0,t.memo)(function(d){var a=d.progressObj,n=function(){return parseFloat(a.elapsed_time).toFixed(6)},x=function(h){var r=new Date(h),v=r.getFullYear(),R=(r.getMonth()+1).toString().padStart(2,"0"),g=r.getDate().toString().padStart(2,"0"),p=r.getHours().toString().padStart(2,"0"),m=r.getMinutes().toString().padStart(2,"0"),O=r.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(v,".").concat(R,".").concat(g," ").concat(p,":").concat(m,":").concat(O)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:a.created_time&&x(a.created_time)}),(0,e.jsx)("div",{className:"truncate",children:a.apps_name||a.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(a.status==1?"bg-blue-600":a.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[n(),"S"]})]})]})})}),Na=function(a){var n,x,w,h,r=a.selectApp,v=a.runid,R=a.setBoxLoading,g=a.setinputShow,p=a.appId,m=a.id,O=a.setisRun,F=(0,J.useIntl)(),M=(0,t.useRef)(""),_=(0,t.useRef)(null),u=(0,t.useState)(null),H=y()(u,2),T=H[0],E=H[1],k=(0,t.useState)(!1),V=y()(k,2),ne=V[0],b=V[1],A=(0,t.useState)(null),P=y()(A,2),ee=P[0],de=P[1],re=(0,t.useState)(null),G=y()(re,2),D=G[0],U=G[1],z=(0,t.useState)(null),C=y()(z,2),te=C[0],ce=C[1],me=(0,rt.Z)(function(s){return s.setDealtWithData}),ie=(0,rt.Z)(function(s){return s.setRunPanelLogRecord}),X=function(){var s=K()(j()().mark(function i(f){var I,Z,N,L,Y;return j()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return R(!0),I=Object.keys(f),Z={},I.forEach(function(oe){_.current.properties[oe]&&(_.current.properties[oe].value=f[oe]),D&&D.forEach(function(xe){xe.node_id==oe&&(Z[oe]=f[oe])})}),N={inputs:_.current,node_confirm_users:Z,run_name:"chatroom-".concat(m,"-run-").concat(M.current,"-driven"),run_type:1,data_source_run_id:M.current},q.next=7,(0,nt.UE)(p,N);case 7:L=q.sent,L.code==0&&(M.current=L==null||(Y=L.data)===null||Y===void 0?void 0:Y.app_run_id,b(!0),O(!1));case 9:case"end":return q.stop()}},i)}));return function(f){return s.apply(this,arguments)}}(),B=function(){var s=K()(j()().mark(function i(){var f,I;return j()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:f=o==null?void 0:o.filter(function(L){return L.type=="workflow_run_progress"&&L.data.app_run_id==M.current}).map(function(L){var Y=L.data;return Y}),f&&f.length&&(I=f[f.length-1],E(I),R(!1));case 2:case"end":return N.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),$=function(){var s=K()(j()().mark(function i(){var f,I,Z,N,L;return j()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:I=o==null?void 0:o.filter(function(q){return q.type=="workflow_need_human_confirm"&&q.data.app_run_id==M.current}),Z=(f=I.map(function(q){var oe=q.data,xe=q.need_human_confirm;return{data:oe,need_human_confirm:xe}}))===null||f===void 0?void 0:f.filter(function(q){return q.data.type!==1}),Z&&Z.length&&(L=Z[Z.length-1].data,L.exec_id=L==null||(N=L.node_exec_data)===null||N===void 0?void 0:N.node_exec_id,ce(Z[Z.length-1]),R(!1));case 3:case"end":return he.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),W=function(i){return i.completed_progress?parseInt(i.completed_progress.slice(0,-1)):!1},S=function(){var s=K()(j()().mark(function i(f,I){var Z,N;return j()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,(0,se.xT)(f,I);case 2:Z=Y.sent,(Z==null?void 0:Z.code)==0&&(M.current=Z==null||(N=Z.data)===null||N===void 0?void 0:N.app_run_id);case 4:case"end":return Y.stop()}},i)}));return function(f,I){return s.apply(this,arguments)}}(),c=function(){var s=K()(j()().mark(function i(){var f,I;return j()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return console.log(p),N.next=3,(0,nt.zO)(p);case 3:f=N.sent,f.code==0&&U(f==null||(I=f.data)===null||I===void 0?void 0:I.need_confirm_nodes),S(m,{app_id:p,app_run_id:v,status:1,corrected_parameter:""});case 6:case"end":return N.stop()}},i)}));return function(){return s.apply(this,arguments)}}();(0,t.useEffect)(function(){r&&r.checkItem.length&&(O(!0),c())},[r]);var o=(0,He.Z)(function(s){return s.flowMessage});return(0,t.useEffect)(function(){B(),$();var s=o.filter(function(N){return N.data.app_run_id==v&&N.type.indexOf("generate_meeting_action_items")!==-1});if(s.length!=0){var i,f=(i=s[s.length-1])===null||i===void 0||(i=i.data)===null||i===void 0||(i=i.exec_data)===null||i===void 0||(i=i.outputs)===null||i===void 0?void 0:i.value;if(f){var I=JSON.parse(f);_.current=I;var Z=Object.keys(I.properties);Z.length&&(console.log(I.properties),de(I.properties)),g(!1),R(!1)}}},[o]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(_e.Z,{icon:r==null||(n=r.checkItem[0])===null||n===void 0?void 0:n.icon,title:r==null||(x=r.checkItem[0])===null||x===void 0?void 0:x.name,textDetails:r==null||(w=r.checkItem[0])===null||w===void 0?void 0:w.description,iconType:"workflow_icon",avatar:r==null||(h=r.checkItem[0])===null||h===void 0?void 0:h.avatar,handleClick:function(){}})}),!ne&&ee!=null?(0,e.jsxs)(tt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:F.formatMessage({id:"workflow.button.run"})}},onFinish:X,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(at._,{data:ee})}),(0,e.jsx)(ya.e,{data:D})]}):(0,e.jsx)(e.Fragment,{children:ee!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[F.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(ee).map(function(s){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:s.display_name||s.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:s.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),te&&te.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){me(te.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(ja,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:F.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),T?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(_e.Z,{status:T.status,icon:T.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:T.run_name}),T.need_human_confirm==1?(0,e.jsx)(Xe.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:F.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(Sa,{progressObj:T}),handleClick:function(){ie(T)},progress:W(T)})}):(0,e.jsx)(e.Fragment,{})]})},wa=(0,t.memo)(Na),ba=function(a){var n,x,w,h=(0,J.useIntl)(),r=a.runid,v=a.id,R=a.setBoxLoading,g=a.scrollDom,p=a.setinputShow,m=(0,t.useRef)("agent"),O=(0,t.useRef)(""),F=(0,t.useState)(!1),M=y()(F,2),_=M[0],u=M[1],H=(0,t.useState)({type:"agent",checkItem:[],show:!1}),T=y()(H,2),E=T[0],k=T[1],V=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){k(function(P){return Q()(Q()({},P),{},{type:"agent",show:!0})})},children:h.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){k(function(P){return Q()(Q()({},P),{},{type:"workflow",show:!0})})},children:h.formatMessage({id:"app.summary.SelectWorkflow"})})}],ne=function(){k(function(P){return Q()(Q()({},P),{},{show:!1})})},b=function(P){R(!0),k(function(ee){return Q()(Q()({},ee),{},{checkItem:P.checkItem})}),m.current=E.type,O.current=P.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:E!=null&&(n=E.checkItem)!==null&&n!==void 0&&n.length?g==null||(x=g.current)===null||x===void 0?void 0:x.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:h.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:_?(0,e.jsx)(ra.Z,{menu:{items:V},children:(0,e.jsx)(oa,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:E!=null&&(w=E.checkItem)!==null&&w!==void 0&&w.length?(0,e.jsx)(e.Fragment,{children:m.current=="agent"?(0,e.jsx)(xa,{id:v,appId:O.current,selectApp:E,runid:r,setBoxLoading:R,scrollDom:g,setinputShow:p,setisRun:u}):(0,e.jsx)(wa,{id:v,appId:O.current,selectApp:E,runid:r,setBoxLoading:R,scrollDom:g,setinputShow:p,setisRun:u})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(Ne.ZP,{className:"flex-1 text-[14px]",onClick:function(){k(function(P){return Q()(Q()({},P),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),h.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(Ne.ZP,{className:"flex-1 text-[14px]",onClick:function(){k(function(P){return Q()(Q()({},P),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),h.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(Ke.Z,{show:E.show,nodetype:E.type,popupClose:ne,popupSave:b,checkList:m.current==E.type?E.checkItem:[],zIndex:99,radio:!0})]})},Ca=(0,t.memo)(ba),Ra=l(87740),st=(0,t.memo)(function(d){var a=d.id,n=d.message,x=(0,J.useIntl)(),w=(0,ae.Z)(function(m){return m.setSummaryClick}),h=(0,t.useState)(!0),r=y()(h,2),v=r[0],R=r[1],g=(0,ae.Z)(function(m){return m.summaryClick}),p=(0,ae.Z)(function(m){return m.setSummaryParams});return(0,t.useEffect)(function(){R(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(Ne.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(O){v&&(p({id:a,message:n}),w(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:x.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(Ra.Z,{className:"text-[14px]"})]})})}),Ma=function(a){var n,x,w,h,r=a.setShow,v=a.inputShow,R=a.setBoxLoading,g=a.setAppRunId,p=a.scrollDom,m=(0,J.useIntl)(),O=(0,t.useState)(!1),F=y()(O,2),M=F[0],_=F[1],u=(0,t.useState)(""),H=y()(u,2),T=H[0],E=H[1],k=(0,t.useState)(""),V=y()(k,2),ne=V[0],b=V[1],A=(0,t.useRef)(""),P=(0,t.useRef)(""),ee=(0,t.useRef)(!1),de=(0,t.useState)(!1),re=y()(de,2),G=re[0],D=re[1],U=(0,t.useState)(null),z=y()(U,2),C=z[0],te=z[1],ce=(0,ae.Z)(function(S){return S.setSummaryClick}),me=function(){var S=K()(j()().mark(function c(o){var s,i,f,I,Z=arguments;return j()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return s=Z.length>1&&Z[1]!==void 0?Z[1]:{app_run_id:"",corrected_parameter:""},L.next=3,(0,se.Rp)(o,s);case 3:i=L.sent,(i==null?void 0:i.code)==0&&(g(i==null||(f=i.data)===null||f===void 0?void 0:f.app_run_id),P.current=i==null||(I=i.data)===null||I===void 0?void 0:I.app_run_id,s.app_run_id&&(ee.current=!0));case 5:case"end":return L.stop()}},c)}));return function(o){return S.apply(this,arguments)}}(),ie=function(){var S=K()(j()().mark(function c(o,s){var i,f,I,Z,N;return j()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,(0,se.xM)(o,{message:s});case 2:i=Y.sent,(i==null?void 0:i.code)==0&&(P.current=i==null||(f=i.data)===null||f===void 0?void 0:f.app_run_id,g(i==null||(I=i.data)===null||I===void 0?void 0:I.app_run_id),i!=null&&(Z=i.data)!==null&&Z!==void 0&&(Z=Z.outputs)!==null&&Z!==void 0&&Z.value&&(E(i==null||(N=i.data)===null||N===void 0||(N=N.outputs)===null||N===void 0?void 0:N.value),r(!0),R(!1),ce(!0),p.current.scrollTo({top:0})));case 4:case"end":return Y.stop()}},c)}));return function(o,s){return S.apply(this,arguments)}}(),X=function(){var S=K()(j()().mark(function c(){var o;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,se.Gh)({chatroom_id:A.current,app_run_id:P.current});case 2:o=i.sent,o&&o!==null&&o!==void 0&&o.data&&te(o.data);case 4:case"end":return i.stop()}},c)}));return function(){return S.apply(this,arguments)}}(),B=function(c){var o=new Date(c),s=o.getMonth()+1,i=o.getDate(),f=o.getHours(),I=o.getMinutes(),Z=o.getSeconds();return o.getFullYear()+"-"+(s<10?"0"+s:s)+"-"+(i<10?"0"+i:i)+" "+(f<10?"0"+f:f)+":"+(I<10?"0"+I:I)+":"+(Z<10?"0"+Z:Z)},$=(0,He.Z)(function(S){return S.flowMessage});(0,t.useEffect)(function(){var S=$.filter(function(s){return s.data.app_run_id==P.current&&s.type.indexOf("generate_meeting_summary")!==-1});if(S.length!=0){var c,o=(c=S[S.length-1])===null||c===void 0||(c=c.data)===null||c===void 0||(c=c.exec_data)===null||c===void 0||(c=c.outputs)===null||c===void 0?void 0:c.value;o&&(ee.current&&X(),E(o),D(!1),r(!0),ce(!0),R(!1),p.current.scrollTo({top:0}))}},[$]);var W=(0,ae.Z)(function(S){return S.summaryParams});return(0,t.useEffect)(function(){W&&W.id&&(A.current=W.id,C&&te(null),G&&D(!1),T&&E(""),_(!0),W.message?(R(!0),ie(W.id,W.message)):me(W.id))},[W]),(0,e.jsx)(e.Fragment,{children:M?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:m.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:T?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],children:C?C==null||(n=C.source_run)===null||n===void 0?void 0:n.summary:T})}),C&&(C==null||(x=C.source_corrections)===null||x===void 0?void 0:x.length)>0||!v?(0,e.jsx)(st,{id:A.current,message:C?C==null||(w=C.source_run)===null||w===void 0?void 0:w.summary:T}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(Ce.Z,{size:"large"})})}),C&&(C==null||(h=C.source_corrections)===null||h===void 0?void 0:h.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),C.source_corrections.map(function(S,c){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(C.source_corrections.length-1==c?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",S.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),": ",B(S.created_time)]}),(0,e.jsx)(Re.U,{rehypePlugins:[Me.Z],children:S==null?void 0:S.corrected_summary})]})},S.created_time),!v||C.source_corrections.length-1!=c?(0,e.jsx)(st,{id:A.current,message:S==null?void 0:S.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},S.created_time)})]}):(0,e.jsx)(e.Fragment,{}),v?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Qe.Z.TextArea,{onChange:function(c){b(c.target.value)},value:ne,disabled:!T||G,rows:4,placeholder:m.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(Ne.ZP,{type:"primary",disabled:!T||!ne,loading:G,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){me(A.current,{app_run_id:String(P.current),corrected_parameter:ne}),D(!0),b(""),r("")},children:m.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},ka=(0,t.memo)(Ma),Fa=l(38027),Ia=function(a){var n,x=a.id,w=(0,t.useState)(""),h=y()(w,2),r=h[0],v=h[1],R=(0,t.useState)(!1),g=y()(R,2),p=g[0],m=g[1],O=(0,t.useState)([]),F=y()(O,2),M=F[0],_=F[1],u=(0,t.useState)(!1),H=y()(u,2),T=H[0],E=H[1],k=(0,t.useState)(!1),V=y()(k,2),ne=V[0],b=V[1],A=(0,t.useState)(""),P=y()(A,2),ee=P[0],de=P[1],re=(0,t.useState)(!1),G=y()(re,2),D=G[0],U=G[1],z=(0,t.useState)(!1),C=y()(z,2),te=C[0],ce=C[1],me=(0,t.useState)(!0),ie=y()(me,2),X=ie[0],B=ie[1],$=(0,t.useRef)(null),W=(0,t.useRef)(1),S=(0,t.useRef)(!1),c=(0,t.useRef)(!0),o=(0,t.useRef)(0),s=(0,t.useState)(!1),i=y()(s,2),f=i[0],I=i[1],Z=(0,ae.Z)(function(q){return q.summaryParams}),N=(0,ae.Z)(function(q){return q.setSummaryParams}),L=function(){var q=K()(j()().mark(function oe(){var xe,De,le,Ue,Fe,ze,Ie=arguments;return j()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(xe=Ie.length>0&&Ie[0]!==void 0?Ie[0]:!0,De=Ie.length>1&&Ie[1]!==void 0?Ie[1]:!0,!(o.current!=0&&o.current<W.current)){be.next=5;break}return I(!1),be.abrupt("return");case 5:return be.next=8,(0,se.sh)({chatroom_id:x,page:W.current,page_size:10});case 8:le=be.sent,le.code==0&&(le!=null&&(Ue=le.data)!==null&&Ue!==void 0&&Ue.list&&le!==null&&le!==void 0&&(Fe=le.data)!==null&&Fe!==void 0&&(Fe=Fe.list)!==null&&Fe!==void 0&&Fe.length&&(o.current=le==null||(ze=le.data)===null||ze===void 0?void 0:ze.total_pages,_(function(Ae){return De?ue()(le.data.list.reverse()):[].concat(ue()(le.data.list.reverse()),ue()(Ae))}),m(!0),I(!0),setTimeout(function(){c.current=!0},500)),De&&setTimeout(function(){var Ae;$==null||(Ae=$.current)===null||Ae===void 0||Ae.scrollTo({top:0})},200),xe||(v(Z.id),N({})));case 10:case"end":return be.stop()}},oe)}));return function(){return q.apply(this,arguments)}}(),Y=function(){var q=K()(j()().mark(function oe(xe){return j()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:xe.target.scrollHeight+(xe.target.scrollTop-xe.target.clientHeight)<400&&c.current&&(c.current=!1,I(!0),W.current=W.current+=1,L(!0,!1));case 1:case"end":return le.stop()}},oe)}));return function(xe){return q.apply(this,arguments)}}();(0,t.useEffect)(function(){W.current=1,L()},[x]),(0,t.useEffect)(function(){Z&&Z.id&&(m(!0),X||B(!0),T&&E(!1),D&&U(!1),W.current=1,b(!0),L(!1),S.current=!0)},[Z]);var he=(0,ae.Z)(function(q){return q.setOrientationShow});return(0,t.useEffect)(function(){p&&he(!0)},[p]),(0,e.jsx)(e.Fragment,{children:p?(0,e.jsxs)("div",{style:{overflow:D?"hidden":"initial"},className:"relative pl-[32px] box-border",children:[(0,e.jsx)("div",{onClick:function(){U(function(oe){return!oe})},className:`
                                `.concat(D?"absolute left-[2px]  top-[60px]":"absolute left-[2px] top-[60px]",`
                                history_packup
                                hover:text-[#1B64F3]
                                w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                            `),children:D?(0,e.jsx)(na,{className:"text-[18px]"}):(0,e.jsx)(Yt,{className:"text-[18px]"})}),(0,e.jsxs)(Gt.Z,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(D?"hidden flex-[0]":"block"),children:[te?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(Ce.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:Y,ref:$,children:[(0,e.jsxs)("div",{children:[M.length?(0,e.jsx)(Fa.ZP,{id:x,runid:ee,scrollDom:$,list:M,historyHeight:S.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:ne?$==null||(n=$.current)===null||n===void 0?void 0:n.offsetHeight:""},children:[(0,e.jsx)(ka,{setShow:E,inputShow:X,setBoxLoading:ce,setAppRunId:de,scrollDom:$}),T?(0,e.jsx)(Ca,{id:r,runid:ee,setBoxLoading:ce,scrollDom:$,setinputShow:B}):(0,e.jsx)(e.Fragment,{})]})]}),f?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(Ce.Z,{})}):(0,e.jsx)(e.Fragment,{})]})})]})]}):(0,e.jsx)(e.Fragment,{})})},Za=(0,t.memo)(Ia),Aa=function(a){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(fe.Z,{image:fe.Z.PRESENTED_IMAGE_SIMPLE})})},Da=(0,t.memo)(function(){var d=(0,J.useParams)(),a=d.id,n=(0,t.useRef)([]),x=(0,t.useRef)(null),w=(0,t.useState)(!1),h=y()(w,2),r=h[0],v=h[1],R=function(){var g=K()(j()().mark(function p(){var m;return j()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!a){F.next=5;break}return F.next=3,(0,se.cH)({id:a});case 3:m=F.sent,m.code==0?(v(!0),x.current=m.data,n.current=m.data.agent_list):J.history.replace("/meeting");case 5:case"end":return F.stop()}},p)}));return function(){return g.apply(this,arguments)}}();return(0,t.useEffect)(function(){R()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden overflow-x-auto",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(ft,{roomDetail:x.current,setAgent:n}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:r?(0,e.jsx)(Wt,{agentList:n}):(0,e.jsx)(Aa,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Za,{id:a})})]})})}),Oa=Da}}]);
