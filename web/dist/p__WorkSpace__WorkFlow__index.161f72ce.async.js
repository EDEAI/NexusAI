"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(Lt,Oe,t){var it=t(5574),B=t.n(it),lt=t(42881),ae=t(67294),ye=t(85893),m=function(b){var st=b.children,ne=b.className,q=ne===void 0?"":ne,ge=b.dragDirection,xe=ge===void 0?"left":ge,Re=b.minWidth,Qe=Re===void 0?415:Re,Ze=b.maxWidth,Q=Ze===void 0?820:Ze,we=b.minHeight,a=we===void 0?200:we,he=b.maxHeight,Be=he===void 0?800:he,re=b.defaultWidth,Fe=re===void 0?415:re,h=b.defaultHeight,K=h===void 0?300:h,e=b.onChange,de=(0,ae.useState)(Fe),Ue=B()(de,2),ut=Ue[0],We=Ue[1],mt=(0,ae.useState)(K),Ce=B()(mt,2),jt=Ce[0],gt=Ce[1],Mt=(0,ae.useCallback)(function(ht,et){We(ht),et&&gt(et),e==null||e(ht,et)},[We,gt,e]),_e=(0,lt.W)({direction:["left","right"].includes(xe)?"horizontal":"vertical",triggerDirection:xe,minWidth:Qe,maxWidth:Q,minHeight:a,maxHeight:Be,onResize:Mt}),qe=_e.triggerRef,Ie=_e.containerRef;return(0,ye.jsxs)("div",{ref:Ie,style:{width:["left","right"].includes(xe)?"".concat(ut,"px"):void 0,height:["top","bottom"].includes(xe)?"".concat(jt,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(q),children:[xe==="left"&&(0,ye.jsx)("div",{ref:qe,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,ye.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),xe==="right"&&(0,ye.jsx)("div",{ref:qe,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,ye.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),xe==="top"&&(0,ye.jsx)("div",{ref:qe,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ye.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),xe==="bottom"&&(0,ye.jsx)("div",{ref:qe,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,ye.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),st]})};Oe.Z=(0,ae.memo)(m)},36711:function(Lt,Oe,t){t.r(Oe),t.d(Oe,{waitTime:function(){return Ze},waitTimePromise:function(){return Qe}});var it=t(97857),B=t.n(it),lt=t(5574),ae=t.n(lt),ye=t(15009),m=t.n(ye),ft=t(99289),b=t.n(ft),st=t(42237),ne=t(29608),q=t(32592),ge=t(35312),xe=t(67294),Re=t(85893),Qe=function(){var Q=b()(m()().mark(function we(){var a,he=arguments;return m()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return a=he.length>0&&he[0]!==void 0?he[0]:100,re.abrupt("return",new Promise(function(Fe){setTimeout(function(){Fe(!0)},a)}));case 2:case"end":return re.stop()}},we)}));return function(){return Q.apply(this,arguments)}}(),Ze=function(){var Q=b()(m()().mark(function we(){var a,he=arguments;return m()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return a=he.length>0&&he[0]!==void 0?he[0]:100,re.next=3,Qe(a);case 3:case"end":return re.stop()}},we)}));return function(){return Q.apply(this,arguments)}}();Oe.default=function(){var Q=(0,ge.useIntl)(),we=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:Q.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var de;h==null||(de=h.current)===null||de===void 0||de.submit()}}},{title:Q.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:Q.formatMessage({id:"workflow.created_time_des",defaultMessage:Q.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:Q.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var de;h==null||(de=h.current)===null||de===void 0||de.submit()}},valueEnum:{1:{text:Q.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:Q.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:Q.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(Q.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:Q.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:Q.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],a=(0,ge.useSearchParams)(),he=ae()(a,1),Be=he[0],re=(0,ne.Z)(function(K){return K.setRunPanelLogRecord}),Fe=Be.get("app_id"),h=(0,xe.useRef)(null);return(0,Re.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,Re.jsx)("div",{children:(0,Re.jsx)(q.Z,{columns:we,formRef:h,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var K=b()(m()().mark(function e(de,Ue,ut){var We;return m()().wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return console.log(de,Ue,ut),Ce.next=3,(0,st.bB)(B()(B()({app_runs_name:"",app_runs_status:0},de),{},{app_id:Fe}));case 3:return We=Ce.sent,console.log(We),Ce.abrupt("return",{data:We.data.list,success:!0,total:We.data.total_count});case 6:case"end":return Ce.stop()}},e)}));return function(e,de,Ue){return K.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),re(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:Q.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},43917:function(Lt,Oe,t){t.r(Oe),t.d(Oe,{default:function(){return Pa}});var it=t(15009),B=t.n(it),lt=t(99289),ae=t.n(lt),ye=t(97857),m=t.n(ye),ft=t(5574),b=t.n(ft),st=t(32060),ne=t(42237),q=t(35312),ge=t(63648),xe=t(16091),Re=t(13118),Qe=t(78234),Ze=t(77598),Q=t(45360),we=t(85576),a=t(67294),he=t(64599),Be=t.n(he),re=t(7493),Fe=t(34559),h=t(15425),K=t(96906),e=t(85893),de=function(r){return{nodes:r.nodes,edges:r.edges,onNodesChange:r.onNodesChange,onEdgesChange:r.onEdgesChange,onConnect:r.onConnect,nodeTypes:r.nodeTypes,connectionLineStyle:r.connectionLineStyle,defaultViewport:r.defaultViewport,onDrop:r.onDrop,onDragOver:r.onDragOver,setSelect:r.setSelect,preventScrolling:r.preventScrolling}},Ue=(0,a.memo)(function(l){var r=l.children,s=(0,q.useIntl)(),g=(0,h.Z)(function(d){return d.nodes}),y=(0,h.Z)(function(d){return d.getEdges}),p=(0,h.Z)(function(d){return d.edges}),I=(0,h.Z)(function(d){return d.setEdges}),i=(0,h.Z)(function(d){return d.onNodesChange}),o=(0,h.Z)(function(d){return d.onEdgesChange}),D=(0,h.Z)(function(d){return d.onConnect}),N=(0,h.Z)(function(d){return d.nodeTypes}),E=(0,h.Z)(function(d){return d.connectionLineStyle}),P=(0,h.Z)(function(d){return d.defaultViewport}),J=(0,h.Z)(function(d){return d.onDrop}),$=(0,h.Z)(function(d){return d.onDragOver}),v=(0,h.Z)(function(d){return d.setSelect}),w=(0,h.Z)(function(d){return d.preventScrolling}),Y=(0,a.useCallback)(function(d){var V=g.find(function(j){return j.id===d.target}),U=function j(H){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(x.has(H.id))return!1;x.add(H.id);var O=Be()((0,re.xA)(H,g,p)),W;try{for(O.s();!(W=O.n()).done;){var _=W.value;if(_.id===d.source||j(_,x))return!0}}catch(De){O.e(De)}finally{O.f()}};return V.id===d.source?!1:!U(V)},[g,p]),Se=function(){},ee=(0,a.useCallback)(function(d,V){console.log(d,V,y(),(0,re.Kz)(d,V,p)),I((0,re.Kz)(d,V,y()))},[]);return(0,Ze.Z)(function(){},[g]),(0,e.jsx)(Fe.tV,{children:(0,e.jsx)(ge.x$,{onViewportChange:Se,nodes:g,edges:p,onNodesChange:i,onEdgesChange:o,onEdgesDelete:function(V){},onConnect:D,onReconnect:ee,nodeTypes:N,minZoom:.3,maxZoom:1,connectionLineStyle:E,snapToGrid:!1,isValidConnection:Y,connectionRadius:30,preventScrolling:w,onDragOver:$,onPaneClick:function(){v("")},onPaneContextMenu:function(V){V.preventDefault()},onSelectionChange:function(V){},onNodeClick:function(V,U){v(U.id)},onEdgeClick:function(V,U){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(V){},onBeforeDelete:function(){var d=ae()(B()().mark(function V(U){var j;return B()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if((U==null||(j=U.nodes)===null||j===void 0||(j=j[0])===null||j===void 0?void 0:j.type)!=K.vW.Start){x.next=3;break}return Q.ZP.error(s.formatMessage({id:"workflow.delStartNodeError"})),x.abrupt("return",Promise.reject(s.formatMessage({id:"workflow.delStartNodeError"})));case 3:return v(""),x.abrupt("return",Promise.resolve(U));case 5:case"end":return x.stop()}},V)}));return function(V){return d.apply(this,arguments)}}(),fitView:!0,children:r})})}),ut=function(r){var s=(0,a.useCallback)(function(p){p.preventDefault(),p.dataTransfer.dropEffect="move"},[]),g=(0,a.useCallback)(function(p){p.preventDefault();var I=p.dataTransfer.getData("application/reactflow");if(!I)return null;var i=JSON.parse(I),o=i.type,D=i.item;if(!o||!D)return null;var N=r({x:p.clientX,y:p.clientY});return{position:N,type:o,item:D}},[r]),y=(0,a.useCallback)(function(p){var I=function(o){var D=g(o);D&&p(D.position,D.type,D.item)};return document.addEventListener("dragover",s),document.addEventListener("drop",I),function(){document.removeEventListener("dragover",s),document.removeEventListener("drop",I)}},[s,g]);return{onDnD:y}},We=ut,mt=function(){var r=(0,h.Z)(function(i){return i.setAgentData}),s=(0,h.Z)(function(i){return i.setSkillData}),g=(0,h.Z)(function(i){return i.setToolData}),y=(0,h.Z)(function(i){return i.setDatasetData}),p=(0,h.Z)(function(i){return i.setTeamDatasetData}),I=(0,h.Z)(function(i){return i.setModelOptionsData});(0,a.useEffect)(function(){(0,ne.x$)(2).then(function(i){i.code===0&&r({team:i.data})}),(0,ne.x$)(3).then(function(i){i.code===0&&r({user:i.data})}),(0,ne.w)(2).then(function(i){i.code===0&&s({team:i.data})}),(0,ne.w)(3).then(function(i){i.code===0&&s({user:i.data})}),(0,ne.GZ)().then(function(i){i.code===0&&g({list:Object.values(i.data)})}),(0,ne.fZ)().then(function(i){var o,D=Array.isArray(i==null||(o=i.data)===null||o===void 0?void 0:o.data)?i.data.data:[],N=D.map(function(w){return{label:w.supplier_name,options:Array.isArray(w.model_list)?w.model_list.map(function(Y){return m()(m()({},Y),{},{label:Y.model_name,value:Y.model_config_id})}):[]}}),E,P=Be()(D),J;try{for(P.s();!(J=P.n()).done;){var $=J.value;if(Array.isArray($.model_list)){var v=$.model_list.find(function(w){return w.model_default_used===1});if(v){E=v.model_config_id;break}}}}catch(w){P.e(w)}finally{P.f()}I({options:N,defaultValue:E})}),(0,ne.mG)().then(function(i){i.code==0&&y({list:i.data.data.map(function(o){return m()(m()({},o),{},{label:o.name,value:o.dataset_id})})})}),(0,ne.mG)(2).then(function(i){i.code==0&&p({list:i.data.data.map(function(o){return m()(m()({},o),{},{label:o.name,value:o.dataset_id})})})})},[r,s,g])},Ce=mt,jt=t(18032),gt=(0,a.memo)(function(l){var r=l.onSubmit,s=l.onClose;return(0,e.jsx)(jt.default,{onSubmit:r,onClose:s})}),Mt=t(19632),_e=t.n(Mt),qe=t(9783),Ie=t.n(qe),ht=t(39873),et=t(26474),At=t(96638),Ot=t(74330),tt=t(69386),Rt=t(96486),Bt=t(87718),pt=t(63680),Ht=t(47520),_t=t(36711),Gt=t(82826),Kt=t(43425),Vt=t(48869),Jt=t(69243),Yt=t(91806),It=t(34994),yt=t(52688),Xt=t(55241),Qt=t(50136),Nt=t(43586),qt=function(){var r,s=(0,q.useIntl)(),g=(0,a.useState)(!0),y=b()(g,2),p=y[0],I=y[1],i=(0,h.Z)(function(x){return x.setWorkflowEditInfo}),o=(0,h.Z)(function(x){return x.workFlowInfo}),D=(0,h.Z)(function(x){return x.setSelect}),N=(0,a.useState)("1"),E=b()(N,2),P=E[0],J=E[1],$=(0,a.useState)(!1),v=b()($,2),w=v[0],Y=v[1],Se=(0,Nt.Z)(),ee=(0,a.useRef)(null),d=function(){var O,W;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(It.A,{formRef:ee,submitter:{render:function(){return null}},onValuesChange:U,layout:"horizontal",children:[(0,e.jsx)(yt.Z,{name:"is_public",label:s.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(yt.Z,{tooltip:(o==null||(O=o.app)===null||O===void 0?void 0:O.publish_status)!="1"?{title:s.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(o==null||(W=o.app)===null||W===void 0?void 0:W.publish_status)!="1",name:"enable_api",label:"API"})]})})})},V=[{key:"4",icon:(0,e.jsx)(Gt.Z,{}),label:s.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:o!=null&&o.isProd?(0,e.jsx)(Kt.Z,{}):(0,e.jsx)(Xt.Z,{content:d,trigger:"click",forceRender:!0,placement:"rightTop",title:s.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(Kt.Z,{})}),label:s.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:o==null?void 0:o.isProd},{key:"1",icon:(0,e.jsx)(Vt.Z,{}),label:s.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Jt.Z,{}),label:s.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:w?s.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):s.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!w},{key:"3",icon:(0,e.jsx)(Yt.Z,{}),label:s.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,Ze.Z)(function(){if(o){var x,O,W,_,De=o==null||(x=o.app)===null||x===void 0?void 0:x.is_public,ke=o==null||(O=o.app)===null||O===void 0?void 0:O.enable_api,ce={};ce.is_public=!!De,ce.enable_api=(o==null||(W=o.app)===null||W===void 0?void 0:W.publish_status)=="1"?!!ke:!1,console.log(ce),Y(ce.enable_api),ee==null||(_=ee.current)===null||_===void 0||_.setFieldsValue(ce)}},[o]);var U=function(O,W){console.log(O,W),j(W.enable_api),i(W),setTimeout(Se,300)},j=function(O){Y(!!O)},H=function(O){var W;switch(O.key){case"4":q.history.go(-1);break;case"0":break;case"2":window.open(Ht._n+(o==null||(W=o.app)===null||W===void 0?void 0:W.api_url),"_blank");break;default:D(""),J(O.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(P==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(Qt.Z,{defaultSelectedKeys:["1"],selectedKeys:[P],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:p,items:V,onClick:H}),P=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(It.A,{formRef:ee,submitter:{render:function(){return null}},onValuesChange:U,layout:"horizontal",children:[(0,e.jsx)(yt.Z,{name:"is_public",label:s.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(yt.Z,{disabled:!(o!=null&&(r=o.app)!==null&&r!==void 0&&r.api_url),name:"enable_api",label:"API"})]})})})]}),P=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(_t.default,{})})})]})},ea=qt,Tt=t(71471),ta=(0,a.memo)(function(l){var r=l.name,s=l.description,g=l.publishStatus,y=(0,q.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(Tt.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:r}),g&&(0,e.jsxs)(Tt.Z.Text,{className:"whitespace-normal",children:["(",y.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(Tt.Z.Text,{className:"whitespace-normal text-gray-500",children:s})]})}),aa=t(63783),bt=t(83062),Et=t(99510),Pt=(0,a.memo)(function(l){var r=l.children,s=l.onDragStart,g=l.onClick,y=l.type,p=l.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(i){return s(i,y,p)},onClick:g,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:r})}),na=(0,a.memo)(function(l){var r,s,g,y=l.item,p=l.onDragStart,I=l.typeBadge,i=l.onItemClick;return(0,e.jsx)(bt.Z,{placement:"right",title:(y==null||(r=y.baseData)===null||r===void 0?void 0:r.description)||(y==null||(s=y.data)===null||s===void 0?void 0:s.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(Pt,{onDragStart:p,type:y.type,item:y,onClick:function(){return i==null?void 0:i(y)},children:(0,e.jsx)(Et.Z,{title:y.data.title,icon:(y==null||(g=y.baseData)===null||g===void 0?void 0:g.icon)||y.type,typeBadge:I})})})})}),oa=(0,a.memo)(function(l){var r,s=l.item,g=l.onDragStart,y=l.typeBadge,p=l.onItemClick;return(0,e.jsx)(bt.Z,{placement:"right",title:(r=s.baseData)===null||r===void 0?void 0:r.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(Pt,{onDragStart:g,type:s.type,item:s,onClick:function(){return p==null?void 0:p(s)},children:(0,e.jsx)(Et.Z,{title:s.baseData.name,icon:s.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:s.baseData.nickname}),typeBadge:y})})})})}),ra=(0,a.memo)(function(l){var r,s,g,y,p,I,i,o,D,N,E,P,J,$,v=l.tool,w=l.category,Y=l.onDragStart,Se=l.typeBadge,ee=l.onItemClick,d=l.categoryIndex,V=l.toolIndex,U=(0,q.getLocale)()==="en-US"?"en_US":"zh_Hans",j=(0,pt.o6)()[K.vW.Tool],H=m()(m()({},v),{},{authorization_status:w==null?void 0:w.authorization_status,title:v==null||(r=v.identity)===null||r===void 0?void 0:r.label[U],icon:w==null||(s=w.identity)===null||s===void 0?void 0:s.icon,groupName:w==null||(g=w.identity)===null||g===void 0?void 0:g.name,credentials_for_provider:w==null?void 0:w.credentials_for_provider}),x={title:v==null||(y=v.identity)===null||y===void 0?void 0:y.label[U],desc:(v==null||(p=v.description)===null||p===void 0||(p=p.human)===null||p===void 0?void 0:p[U])||(v==null||(I=v.description)===null||I===void 0?void 0:I.llm),icon:w==null||(i=w.identity)===null||i===void 0?void 0:i.icon,data:{title:v==null||(o=v.identity)===null||o===void 0?void 0:o.label[U],desc:(v==null||(D=v.description)===null||D===void 0||(D=D.human)===null||D===void 0?void 0:D[U])||(v==null||(N=v.description)===null||N===void 0?void 0:N.llm),icon:w==null||(E=w.identity)===null||E===void 0?void 0:E.icon},baseData:H};return(0,e.jsx)(bt.Z,{placement:"right",title:v==null||(P=v.description)===null||P===void 0||(P=P.human)===null||P===void 0?void 0:P[U],children:(0,e.jsx)("div",{children:(0,e.jsx)(Pt,{onDragStart:Y,type:K.vW.Tool,item:x,onClick:function(){return ee==null?void 0:ee(w,v,d,V)},children:(0,e.jsx)(Et.Z,{title:v==null||(J=v.identity)===null||J===void 0?void 0:J.label[U],icon:w==null||($=w.identity)===null||$===void 0?void 0:$.icon,typeBadge:Se})})})})}),ia=(0,a.memo)(function(l){var r,s,g=l.category,y=l.onDragStart,p=l.typeBadge,I=l.onItemClick,i=l.categoryIndex,o=(0,q.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[g==null||(r=g.identity)===null||r===void 0?void 0:r.label[o],(0,e.jsx)(bt.Z,{placement:"right",title:g==null||(s=g.identity)===null||s===void 0?void 0:s.description[o],children:(0,e.jsx)(aa.Z,{className:"cursor-pointer ml-1"})})]}),g.tools.map(function(D,N){return(0,e.jsx)(ra,{tool:D,category:g,onDragStart:y,typeBadge:p,onItemClick:function(P,J,$,v){return I==null?void 0:I(P,J,$,v)},categoryIndex:i,toolIndex:N},N)})]})}),la=function(r){var s=r.list,g=r.onDragStart,y=r.type,p=y===void 0?"normal":y,I=r.typeBadge,i=I===void 0?null:I,o=r.onItemClick;return s!=null&&s.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:p==="tools"?s.map(function(D,N){return(0,e.jsx)(ia,{category:D,typeBadge:i,onDragStart:g,onItemClick:o,categoryIndex:N},N)}):p==="workflow"?s.map(function(D,N){return(0,e.jsx)(oa,{item:D,onDragStart:g,typeBadge:i,onItemClick:o},N)}):s.map(function(D,N){return(0,e.jsx)(na,{item:D,onDragStart:g,typeBadge:i,onItemClick:o},N)})}):null},$t=(0,a.memo)(la),sa=t(22352),ua=t(40110),da=t(86615),ca=t(5966),va=t(62370),fa=t(78688),ma=t(11941),ga=(0,a.memo)(function(l){var r=l.visibleTabs,s=l.defaultActiveTab,g=l.showTeamSwitch,y=g===void 0?!0:g,p=l.isMinWidth,I=p===void 0?!1:p,i=l.isCollapsed,o=i===void 0?!1:i,D=l.onItemClick,N=(0,q.useIntl)(),E=(0,q.getLocale)()=="en-US"?"en_US":"zh_Hans",P=(0,pt.o6)(),J=(0,a.useMemo)(function(){return Object.values(P).filter(function(C){return![K.vW.Start,K.vW.Agent,K.vW.Tool,K.vW.Skill].includes(C.base.type)}).map(function(C){return C.base})},[P]),$=(0,a.useState)(s||"1"),v=b()($,2),w=v[0],Y=v[1],Se=(0,a.useState)(J),ee=b()(Se,2),d=ee[0],V=ee[1],U=(0,a.useState)([]),j=b()(U,2),H=j[0],x=j[1],O=(0,et.v)(),W=O.tags,_=(0,At.Z)(Ie()(Ie()(Ie()({},K.vW.Agent,[]),K.vW.Skill,[]),"workflow",[])),De=b()(_,2),ke=De[0],ce=De[1],Ne=(0,a.useState)({team:1,keyword:"",tag:[]}),je=b()(Ne,2),c=je[0],pe=je[1],Ge=(0,a.useRef)({}),at=6e4,Me=(0,h.Z)(function(C){return C.toolData});(0,fa.Z)(function(C){console.log("toolData",C)},[Me,c,d,ke,H,r,s,y,I,o,D]),(0,a.useEffect)(function(){x((Me==null?void 0:Me.list)||[])},[Me]);var He=(0,a.useCallback)(function(C,G,L){C.dataTransfer.setData("application/reactflow",JSON.stringify({type:G,item:L})),C.dataTransfer.effectAllowed="move"},[]),nt=(0,a.useCallback)(function(C,G){if(!G)return C;var L=new tt.Z(C,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),le=L.search(G);return le.map(function(n){return n.item})},[]),Ve=(0,a.useCallback)(function(C,G){if(!G)return C;var L=C.map(function(u){var f;return m()(m()({},u),{},{tools:(f=u.tools)===null||f===void 0?void 0:f.map(function(M){var Z,k;return m()(m()({},M),{},{categoryName:(Z=u.identity)===null||Z===void 0||(Z=Z.label)===null||Z===void 0?void 0:Z[E],categoryIcon:(k=u.identity)===null||k===void 0?void 0:k.icon})})})}),le=new tt.Z(L,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),n=le.search(G);return n.map(function(u){return m()(m()({},u.item),{},{tools:u.item.tools.filter(function(f){var M=new tt.Z([f],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return M.search(G).length>0})})}).filter(function(u){return u.tools.length>0})},[E]),Le=(0,a.useCallback)(function(){var C=ae()(B()().mark(function G(L){var le,n,u,f,M,Z;return B()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(le="".concat(L,"-").concat(c.team,"-").concat(c.keyword,"-").concat(c.tag.join(",")),n=Ge.current[le],!(n&&Date.now()-n.timestamp<at&&JSON.stringify(n.params)===JSON.stringify(c))){S.next=5;break}return console.log("[Cache hit] Using cached data for ".concat(L)),S.abrupt("return",n.data);case 5:return console.log("[Cache miss] Fetching data for ".concat(L)),S.prev=6,S.next=9,(0,ne.RE)(L,{search_type:c.team,apps_name:c.keyword,tag_ids:((u=c.tag)===null||u===void 0?void 0:u.join(","))||""});case 9:if(f=S.sent,!((f==null?void 0:f.code)===0&&f!==null&&f!==void 0&&f.data&&Array.isArray(f.data.list)&&f.data.list.length>0)){S.next=16;break}return M=f.data.list,Z=M.map(function(T){var ve,z;return m()(m()({},(ve=P[L])===null||ve===void 0?void 0:ve.base),{},{data:m()(m()({},(z=P[L])===null||z===void 0?void 0:z.base.data),{},{title:T.name,desc:T.description}),baseData:T})}),Ge.current[le]={data:Z,timestamp:Date.now(),params:m()({},c)},ce(Ie()({},L,Z)),S.abrupt("return",Z);case 16:return S.abrupt("return",[]);case 19:return S.prev=19,S.t0=S.catch(6),console.error("Failed to fetch ".concat(L," data:"),S.t0),S.abrupt("return",[]);case 23:case"end":return S.stop()}},G,null,[[6,19]])}));return function(G){return C.apply(this,arguments)}}(),[c,P,ce]),Ke=(0,a.useMemo)(function(){var C=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return c.keyword?nt(d,c.keyword):d}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return Le(K.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return c.keyword?Ve(H,c.keyword):H}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var L=ae()(B()().mark(function n(){return B()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Le(K.vW.Skill);case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},n)}));function le(){return L.apply(this,arguments)}return le}()}],G=r!=null&&r.length?C.filter(function(L){return r.includes(L.tabKey)}):C;return G.map(function(L,le){return m()(m()({},L),{},{key:le+1+""})})},[d,ke,H,r,c,nt,Ve,Le]),Te=(0,a.useMemo)(function(){return Ke.map(function(C){return{key:C.key,label:N.formatMessage({id:C.label,defaultMessage:C.defaultMessage})}})},[Ke,N]),Je=(0,a.useCallback)(function(C){var G=C.tabIndex,L=C.showName,le=L===void 0?!0:L,n=Ke.find(function(F){return F.key===G}),u=(0,a.useState)([]),f=b()(u,2),M=f[0],Z=f[1],k=(0,a.useState)(!0),S=b()(k,2),T=S[0],ve=S[1],z=(0,a.useState)([]),X=b()(z,2),fe=X[0],ze=X[1],St=(0,a.useState)(20),Zt=b()(St,1),ot=Zt[0],Xe=(0,a.useState)(500),dt=b()(Xe,2),Dt=dt[0],kt=dt[1],Ee=(0,a.useRef)(null),ct=(0,a.useRef)(!1),xt=54;(0,a.useEffect)(function(){var F=function(){if(Ee.current){var oe=Ee.current.clientHeight;kt(oe)}},te=function(oe){kt(oe.detail.height)};return F(),Ee.current&&Ee.current.addEventListener("containerResize",te),window.addEventListener("resize",F),function(){Ee.current&&Ee.current.removeEventListener("containerResize",te),window.removeEventListener("resize",F)}},[]),(0,a.useEffect)(function(){return function(){ct.current=!1}},[n==null?void 0:n.tabKey]),(0,a.useEffect)(function(){var F=function(){var te=ae()(B()().mark(function ue(){var oe,R;return B()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!(ct.current&&!c.keyword&&c.tag.length===0)){A.next=2;break}return A.abrupt("return");case 2:if(ve(!0),A.prev=3,n){A.next=6;break}return A.abrupt("return");case 6:return A.next=8,n.getData();case 8:oe=A.sent,R=(oe==null?void 0:oe.map(function(se,be){return m()(m()({},se),{},{id:"".concat(n.tabKey,"-").concat(be)})}))||[],Z(R),ze(R.slice(0,ot)),ct.current=!0,A.next=18;break;case 15:A.prev=15,A.t0=A.catch(3),console.error("Failed to fetch data:",A.t0);case 18:return A.prev=18,ve(!1),A.finish(18);case 21:case"end":return A.stop()}},ue,null,[[3,15,18,21]])}));return function(){return te.apply(this,arguments)}}();F()},[n,c,ot]);var Ct=function(te){if(te.currentTarget.scrollHeight-te.currentTarget.scrollTop===Dt){var ue=fe.length;if(ue<M.length){var oe=M.slice(ue,ue+ot);ze(function(R){return[].concat(_e()(R),_e()(oe))})}}},vt=(0,a.useCallback)(function(F){var te,ue,oe;if(n){switch(console.log("Clicked item:",F),n.tabKey){case"tool":console.log("Tool ".concat((te=F.identity)===null||te===void 0||(te=te.label)===null||te===void 0?void 0:te[E]));break;case"workflow":console.log("Workflow ".concat((ue=F.data)===null||ue===void 0?void 0:ue.title));break;case"agent":console.log("Agent ".concat((oe=F.data)===null||oe===void 0?void 0:oe.title));break;default:console.log("Clicked ".concat(n.tabKey," item:"),F)}D&&D(F,n.tabKey)}},[n,E,D]),Pe=(0,a.memo)(function(F){var te=F.data,ue=F.index,oe=F.onDragStart,R=F.onItemClick,ie=F.type,A=F.typeBadge;return(0,e.jsx)($t,{typeBadge:A,list:[te],onDragStart:oe,type:ie,onItemClick:R})});return n?(0,e.jsx)("div",{ref:Ee,className:"overflow-y-auto h-full",children:(0,e.jsx)(Ot.Z,{spinning:T,children:c!=null&&c.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:fe.map(function(F){return(0,e.jsx)(Pe,{data:F,index:fe.indexOf(F),onDragStart:He,onItemClick:vt,type:n.type,typeBadge:c!=null&&c.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0},F.id)})}):(0,e.jsx)(Bt.Z,{data:fe,height:Dt,itemHeight:xt,itemKey:"id",onScroll:Ct,children:function(te){return(0,e.jsx)(Pe,{data:te,index:fe.indexOf(te),onDragStart:He,onItemClick:vt,type:n.type,typeBadge:c!=null&&c.keyword&&n.tabKey!="node"?{icon:"/icons/".concat(n.tabKey,".svg"),tooltip:n.tabKey,color:"#1b64f3"}:void 0})}})})}):null},[w,c,I,Ke,He,E,D]),$e=(0,a.useCallback)((0,Rt.debounce)(function(C){pe(C)},500),[]),Ae=(0,a.useCallback)(function(){Ge.current={}},[]);(0,a.useEffect)(function(){Ae()},[c.team,Ae]);var Ye=(0,a.useCallback)(function(C,G){"team"in C?pe(G):("tag"in C||"keyword"in C)&&$e(G)},[$e]);return(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[!o&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(It.A,{submitter:!1,initialValues:c,onValuesChange:Ye,children:[y&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[N.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(da.Z.Group,{name:"team",fieldProps:{options:[{label:N.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:N.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(ca.Z,{fieldProps:{prefix:(0,e.jsx)(ua.Z,{}),placeholder:N.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(va.Z,{name:"tag",children:(0,e.jsx)(sa.O,{className:"w-full",options:W,listStyle:I?"horizontal":"vertical",allowClear:!0,placeholder:N.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(G){}})})})]}),c!=null&&c.keyword?null:(0,e.jsx)(ma.Z,{activeKey:w,items:Te,onChange:function(G){Y(G)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:c!=null&&c.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Ke.map(function(C,G){return(0,e.jsxs)("div",{className:"space-y-2",children:[!o&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:N.formatMessage({id:C.label,defaultMessage:C.defaultMessage})}),(0,e.jsx)(Je,{tabIndex:G+1+"",showName:!I},C.key)]},C.key)})}):(0,e.jsx)(Je,{tabIndex:w,showName:!I})})]})}),ha=(0,a.memo)(function(l){var r=l.visibleTabs,s=l.defaultActiveTab,g=l.showTeamSwitch,y=g===void 0?!0:g,p=l.workflowName,I=l.workflowDesc,i=l.publishStatus,o=l.onWidthChange,D=l.onItemClick,N=(0,q.useIntl)(),E=(0,q.getLocale)()=="en-US"?"en_US":"zh_Hans",P=(0,pt.o6)(),J=Object.values(P).filter(function(u){return![K.vW.Start,K.vW.Agent,K.vW.Tool,K.vW.Skill].includes(u.base.type)}).map(function(u){return u.base}),$=(0,a.useState)(s||"1"),v=b()($,2),w=v[0],Y=v[1],Se=(0,a.useState)(J),ee=b()(Se,2),d=ee[0],V=ee[1],U=(0,a.useState)([]),j=b()(U,2),H=j[0],x=j[1],O=(0,et.v)(),W=O.tags,_=(0,At.Z)(Ie()(Ie()(Ie()({},K.vW.Agent,[]),K.vW.Skill,[]),"workflow",[])),De=b()(_,2),ke=De[0],ce=De[1],Ne=(0,a.useState)({team:1,keyword:"",tag:[]}),je=b()(Ne,2),c=je[0],pe=je[1],Ge=(0,a.useState)(!1),at=b()(Ge,2),Me=at[0],He=at[1],nt=(0,a.useState)(!1),Ve=b()(nt,2),Le=Ve[0],Ke=Ve[1],Te=(0,h.Z)(function(u){return u.toolData});(0,a.useEffect)(function(){x((Te==null?void 0:Te.list)||[])},[Te]);var Je=(0,a.useCallback)(function(u,f,M){u.dataTransfer.setData("application/reactflow",JSON.stringify({type:f,item:M})),u.dataTransfer.effectAllowed="move"},[]),$e=(0,a.useCallback)(function(u,f){if(!f)return u;var M=new tt.Z(u,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),Z=M.search(f);return Z.map(function(k){return k.item})},[]),Ae=(0,a.useCallback)(function(u,f){if(!f)return u;var M=u.map(function(S){var T;return m()(m()({},S),{},{tools:(T=S.tools)===null||T===void 0?void 0:T.map(function(ve){var z,X;return m()(m()({},ve),{},{categoryName:(z=S.identity)===null||z===void 0||(z=z.label)===null||z===void 0?void 0:z[E],categoryIcon:(X=S.identity)===null||X===void 0?void 0:X.icon})})})}),Z=new tt.Z(M,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),k=Z.search(f);return k.map(function(S){return m()(m()({},S.item),{},{tools:S.item.tools.filter(function(T){var ve=new tt.Z([T],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return ve.search(f).length>0})})}).filter(function(S){return S.tools.length>0})},[E]),Ye=(0,a.useMemo)(function(){var u=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return c.keyword?$e(d,c.keyword):d}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return L(K.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return c.keyword?Ae(H,c.keyword):H}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var M=ae()(B()().mark(function k(){return B()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,L(K.vW.Skill);case 2:return T.abrupt("return",T.sent);case 3:case"end":return T.stop()}},k)}));function Z(){return M.apply(this,arguments)}return Z}()},{tabKey:"workflow",label:"workflow.list",defaultMessage:"Workflow",type:"workflow",getData:function(){var M=ae()(B()().mark(function k(){return B()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,L("workflow");case 2:return T.abrupt("return",T.sent);case 3:case"end":return T.stop()}},k)}));function Z(){return M.apply(this,arguments)}return Z}()}],f=r!=null&&r.length?u.filter(function(M){return r.includes(M.tabKey)}):u;return f.map(function(M,Z){return m()(m()({},M),{},{key:Z+1+""})})},[d,ke,H,r,c,$e,Ae]),C=(0,a.useMemo)(function(){return Ye.map(function(u,f){return{key:u.key,label:N.formatMessage({id:u.label,defaultMessage:u.defaultMessage})}})},[Ye]),G=(0,a.useCallback)(function(u){var f=u.tabIndex,M=u.showName,Z=M===void 0?!0:M,k=Ye.find(function(R){return R.key===f}),S=(0,a.useState)([]),T=b()(S,2),ve=T[0],z=T[1],X=(0,a.useState)(!0),fe=b()(X,2),ze=fe[0],St=fe[1],Zt=(0,a.useState)([]),ot=b()(Zt,2),Xe=ot[0],dt=ot[1],Dt=(0,a.useState)(20),kt=b()(Dt,1),Ee=kt[0],ct=(0,a.useState)(500),xt=b()(ct,2),Ct=xt[0],vt=xt[1],Pe=(0,a.useRef)(null),F=54;(0,a.useEffect)(function(){var R=function(){if(Pe.current){var se=Pe.current.clientHeight;vt(se)}},ie=function(se){vt(se.detail.height)};return R(),Pe.current&&Pe.current.addEventListener("containerResize",ie),window.addEventListener("resize",R),function(){Pe.current&&Pe.current.removeEventListener("containerResize",ie),window.removeEventListener("resize",R)}},[]),(0,a.useEffect)(function(){var R=function(){var ie=ae()(B()().mark(function A(){var se,be;return B()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return St(!0),me.prev=1,me.next=4,k.getData();case 4:se=me.sent,be=(se==null?void 0:se.map(function(Ut,Wt){return m()(m()({},Ut),{},{id:"".concat(k.tabKey,"-").concat(Wt)})}))||[],z(be),dt(be.slice(0,Ee)),me.next=13;break;case 10:me.prev=10,me.t0=me.catch(1),console.error("Failed to fetch data:",me.t0);case 13:return me.prev=13,St(!1),me.finish(13);case 16:case"end":return me.stop()}},A,null,[[1,10,13,16]])}));return function(){return ie.apply(this,arguments)}}();R()},[k,c]);var te=function(ie){if(ie.currentTarget.scrollHeight-ie.currentTarget.scrollTop===Ct){var A=Xe.length;if(A<ve.length){var se=ve.slice(A,A+Ee);dt(function(be){return[].concat(_e()(be),_e()(se))})}}},ue=(0,a.useCallback)(function(R,ie,A,se){switch(console.log("Clicked category:",R),console.log("Clicked item:",ie),console.log("Indices:",A,se),k.tabKey){case"tool":if(A!==void 0&&se!==void 0){var be,rt;console.log("Tool ".concat((be=ie.identity)===null||be===void 0?void 0:be.label[E]," in category ").concat((rt=R.identity)===null||rt===void 0?void 0:rt.label[E]))}break;case"workflow":break;case"agent":break}},[k.tabKey,E]),oe=(0,a.memo)(function(R){var ie=R.data,A=R.index,se=R.onDragStart,be=R.onItemClick,rt=R.type,me=R.typeBadge;return(0,e.jsx)($t,{typeBadge:me,list:[ie],onDragStart:se,type:rt,onItemClick:function(Wt){return be(Wt)}})});return(0,e.jsx)("div",{ref:Pe,className:"overflow-y-auto h-full",children:(0,e.jsx)(Ot.Z,{spinning:ze,children:c!=null&&c.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:Xe.map(function(R){return(0,e.jsx)(oe,{data:R,index:Xe.indexOf(R),onDragStart:Je,onItemClick:ue,type:k.type,typeBadge:c!=null&&c.keyword&&k.tabKey!="node"?{icon:"/icons/".concat(k.tabKey,".svg"),tooltip:k.tabKey,color:"#1b64f3"}:void 0},R.id)})}):(0,e.jsx)(Bt.Z,{data:Xe,height:Ct,itemHeight:F,itemKey:"id",onScroll:te,children:function(ie){return(0,e.jsx)(oe,{data:ie,index:Xe.indexOf(ie),onDragStart:Je,onItemClick:ue,type:k.type,typeBadge:c!=null&&c.keyword&&k.tabKey!="node"?{icon:"/icons/".concat(k.tabKey,".svg"),tooltip:k.tabKey,color:"#1b64f3"}:void 0})}})})})},[w,c,Me]),L=(0,a.useCallback)(function(){var u=ae()(B()().mark(function f(M){var Z,k,S,T;return B()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.prev=0,z.next=3,(0,ne.RE)(M,{search_type:c.team,apps_name:c.keyword,tag_ids:((Z=c.tag)===null||Z===void 0?void 0:Z.join(","))||""});case 3:if(S=z.sent,!((S==null?void 0:S.code)===0&&S!==null&&S!==void 0&&(k=S.data)!==null&&k!==void 0&&(k=k.list)!==null&&k!==void 0&&k.length)){z.next=8;break}return T=S.data.list.map(function(X){var fe,ze;return m()(m()({},(fe=P[M])===null||fe===void 0?void 0:fe.base),{},{data:m()(m()({},(ze=P[M])===null||ze===void 0?void 0:ze.base.data),{},{title:X.name,desc:X.description}),baseData:X})}),ce(Ie()({},M,T)),z.abrupt("return",T);case 8:z.next=13;break;case 10:z.prev=10,z.t0=z.catch(0),console.error("Failed to fetch ".concat(M," data:"),z.t0);case 13:case"end":return z.stop()}},f,null,[[0,10]])}));return function(f){return u.apply(this,arguments)}}(),[c]),le=(0,a.useCallback)((0,Rt.debounce)(function(u){pe(u)},500),[]),n=(0,a.useCallback)(function(u,f){"team"in u?(pe(f),f.team==2):("tag"in u||"keyword"in u)&&le(f)},[le]);return(0,e.jsx)(ht.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:Le?100:315,onChange:function(f,M){requestAnimationFrame(function(){He(f<100),o==null||o(f);var Z=document.querySelectorAll(".overflow-y-auto");Z.forEach(function(k){if(k instanceof HTMLElement){var S=k.clientHeight,T=new CustomEvent("containerResize",{detail:{height:S,width:f}});k.dispatchEvent(T)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,e.jsx)(ga,{visibleTabs:r,defaultActiveTab:s,showTeamSwitch:y,isMinWidth:Me,isCollapsed:Le,onItemClick:D}),(0,e.jsx)(ea,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(ta,{name:p,description:I,publishStatus:i})})]})})}),pa=t(74842),ya=t(98165),ba=t(58638),wt=t(28036),wa=t(27484),Sa=t.n(wa),Da=t(70681),zt=t.n(Da),ka=200,xa=80,Ca={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ja=function(){var r=(0,ge._K)(),s=r.getNodes,g=r.getEdges,y=r.setNodes,p=function(o){return{width:o.width||ka,height:o.height||xa}},I=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",D=s(),N=g();if(D.length){var E=new(zt()).graphlib.Graph;E.setDefaultEdgeLabel(function(){return{}});var P=m()(m()({},Ca),{},{rankdir:o});E.setGraph(P),D.forEach(function($){var v=p($),w=v.width,Y=v.height;E.setNode($.id,{width:w,height:Y})}),N.forEach(function($){E.setEdge($.source,$.target)}),zt().layout(E);var J=D.map(function($){var v=E.node($.id);return m()(m()({},$),{},{position:{x:v.x-v.width/2,y:v.y-v.height/2}})});y(J)}};return{autoLayout:I}},Ma=ja,Ia=(0,a.memo)(function(){var l=(0,q.useIntl)(),r=(0,q.useSearchParams)(),s=b()(r,1),g=s[0],y=(0,h.Z)(function(j){return j.setWorkFlowInfo}),p=(0,h.Z)(function(j){return j.workFlowInfo}),I=(0,h.Z)(function(j){return j.setRunPanelShow}),i=g.get("type")=="true",o=(0,Nt.Z)(),D=Ma(),N=D.autoLayout,E=Q.ZP.useMessage(),P=b()(E,2),J=P[0],$=P[1],v=(0,h.Z)(function(j){return j.loadingWorkflowData}),w=function(){var j=ae()(B()().mark(function H(){var x;return B()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,o();case 2:x=g.get("app_id"),(0,ne.aJ)(x).then(function(_){console.log(_),_.code==0&&(y(m()(m()({},p),{},{app:m()(m()({},p==null?void 0:p.app),{},{publish_status:"1"})})),J.open({type:"success",content:l.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return W.stop()}},H)}));return function(){return j.apply(this,arguments)}}(),Y=function(){I(!0)},Se=function(){var j=ae()(B()().mark(function H(){var x,O;return B()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return x=g.get("app_id"),_.next=3,(0,ne.Uq)(x);case 3:O=_.sent;case 4:case"end":return _.stop()}},H)}));return function(){return j.apply(this,arguments)}}(),ee=function(){var j=ae()(B()().mark(function H(){var x,O,W,_;return B()().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:O=g.get("app_id"),W=(p==null||(x=p.app)===null||x===void 0?void 0:x.name)||"workflow",_=Sa()().format("YYYY_MM_DD-HH_mm_ss"),(0,ne.w8)(O,i==!0?1:0).then(function(ce){var Ne=ce,je=new Blob([Ne],{type:"text/yaml"}),c=URL.createObjectURL(je),pe=document.createElement("a");pe.href=c,pe.download="".concat(W,"_").concat(_,".yml"),document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(c)});case 4:case"end":return ke.stop()}},H)}));return function(){return j.apply(this,arguments)}}(),d=function(H){N(H),J.open({type:"success",content:l.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},V=[{key:"TB",label:l.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return d("TB")}},{key:"LR",label:l.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return d("LR")}}],U={name:"file",fileList:null,action:Ht._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!i&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(wt.ZP,{type:"primary",disabled:v,onClick:w,children:l.formatMessage({id:"workflow.release"})}),(0,e.jsx)(wt.ZP,{icon:(0,e.jsx)(pa.Z,{}),disabled:v,onClick:Y,children:l.formatMessage({id:"workflow.run"})}),(0,e.jsx)(wt.ZP,{icon:(0,e.jsx)(ya.Z,{}),type:"dashed",disabled:v,onClick:o,children:l.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(wt.ZP,{icon:(0,e.jsx)(ba.Z,{}),type:"dashed",onClick:ee,disabled:v,children:l.formatMessage({id:"workflow.export",defaultMessage:""})}),$]})}),Ft=t(64458),Na=function(){var r,s,g=(0,q.useIntl)(),y=(0,a.useRef)(null),p=(0,h.Z)(function(n){return n.resetNodes}),I=(0,h.Z)(function(n){return n.setNodeTypes}),i=(0,h.Z)(function(n){return n.addNode}),o=(0,h.Z)(function(n){return n.createNode}),D=(0,h.Z)(function(n){return n.setNodes}),N=(0,h.Z)(function(n){return n.setEdges}),E=(0,h.Z)(function(n){return n.setAppId}),P=(0,h.Z)(function(n){return n.setRunPanelShow}),J=(0,h.Z)(function(n){return n.runPanelShow}),$=(0,h.Z)(function(n){return n.getModelData}),v=(0,h.Z)(function(n){return n.setWorkFlowInfo}),w=(0,h.Z)(function(n){return n.setHandleList}),Y=(0,h.Z)(function(n){return n.workFlowInfo}),Se=(0,h.Z)(function(n){return n.setWorkflowEditInfo}),ee=Q.ZP.useMessage(),d=b()(ee,2),V=d[0],U=d[1],j=(0,ge._K)(),H=j.screenToFlowPosition,x=j.getNodes,O=j.setViewport,W=We(H),_=W.onDnD,De=(0,q.useSearchParams)(),ke=b()(De,1),ce=ke[0],Ne=ce.get("type")=="true",je=(0,h.Z)(function(n){return n.setLoadingWorkflowData}),c=(0,ge.B)({includeHiddenNodes:!1}),pe=(0,Re.Z)(),Ge=(0,Nt.Z)(),at=(0,a.useState)(null),Me=b()(at,2),He=Me[0],nt=Me[1],Ve=(0,a.useState)(!1),Le=b()(Ve,2),Ke=Le[0],Te=Le[1],Je=(0,a.useState)(""),$e=b()(Je,2),Ae=$e[0],Ye=$e[1],C=null;(0,ge.CV)({onEnd:function(u){}}),(0,Qe.Z)(function(){I((0,pt.$P)()),p(),(0,st.b6)(),G(),w([])}),Ce(),(0,a.useEffect)(function(){if(He){q.history.push(Ae);return}var n=q.history.block(function(u,f){if(J){Ye(u.location.pathname),Te(!0);return}});return J||n==null||n(),function(){n==null||n()}},[J,He]),(0,Ze.Z)(function(){if(c){var n=x(),u=n[n.length-1];u.data.drag&&(u.position={x:u.position.x-u.measured.width/2,y:u.position.y-u.measured.height/2},D(n))}},[c]),(0,a.useEffect)(function(){var n=_(function(u,f,M){console.log(u,f,M),o(f,{position:u,data:m()(m()({drag:!0},M.data),{},{baseData:M.baseData})})});return n},[_,i]),(0,Ze.Z)(function(){pe=="hidden"&&Ge()},[pe]);var G=function(){var n=ae()(B()().mark(function u(){var f;return B()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:f=ce.get("app_id"),Ne&&V.open({type:"warning",content:g.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),je(!0),E(f),(0,ne.kE)(f,Ne?1:0).then(function(k){if(k.code==0){if(v(m()(m()({},k.data),{},{isProd:Ne})),!k.data.workflow.graph){je(!1),o(K.vW.Start);return}var S=k.data,T=S.workflow.graph,ve=T.edges,z=T.nodes,X=T.views,fe=S.app;Se({enable_api:!!fe.enable_api,is_public:!!fe.is_public}),X!=null&&X.nodes&&D(X.nodes),X!=null&&X.edges&&N(X.edges),X!=null&&X.viewPort,setTimeout(function(){je(!1)},1e3)}}),$();case 6:case"end":return Z.stop()}},u)}));return function(){return n.apply(this,arguments)}}(),L=function(){nt(!0),console.log(Ae),q.history.push(Ae),Te(!1)},le=function(){Te(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[U,(0,e.jsx)(we.Z,{title:g.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Ke,onOk:L,onCancel:le,children:g.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:y,children:(0,e.jsxs)(Ue,{children:[(0,e.jsx)(ge.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(ge.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(ha,{workflowName:Y==null||(r=Y.app)===null||r===void 0?void 0:r.name,workflowDesc:Y==null||(s=Y.app)===null||s===void 0?void 0:s.description,publishStatus:Ne}),(0,e.jsx)(Ia,{}),(0,e.jsx)(Ft.s_,{}),(0,e.jsx)(Ft.Jf,{}),(0,e.jsx)(gt,{})]})},Ta=(0,a.memo)(function(){return(0,e.jsx)(ge.tV,{children:(0,e.jsx)(Na,{})})}),Ea=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(Ta,{})})},Pa=Ea}}]);
