"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4730],{4730:function(je,A,n){n.d(A,{Z:function(){return xe}});var D=n(15009),Z=n.n(D),L=n(99289),R=n.n(L),X=n(5574),B=n.n(X),V=n(11551),G=n(39873),J=n(28508),U=n(29933),F=n(76772),Y=n(3917),K=n(66309),Q=n(28036),z=n(71471),q=n(74330),I=n(26412),u=n(67294),k=n(93967),O=n.n(k),E=n(53124),_=n(35792),c=n(96826),ee=n(14747),te=n(83559),ie=n(83262);const le=e=>{const{componentCls:t,calc:a}=e;return{[t]:Object.assign(Object.assign({},(0,ee.Wf)(e)),{margin:0,padding:0,listStyle:"none",[`${t}-item`]:{position:"relative",margin:0,paddingBottom:e.itemPaddingBottom,fontSize:e.fontSize,listStyle:"none","&-tail":{position:"absolute",insetBlockStart:e.itemHeadSize,insetInlineStart:a(a(e.itemHeadSize).sub(e.tailWidth)).div(2).equal(),height:`calc(100% - ${(0,c.unit)(e.itemHeadSize)})`,borderInlineStart:`${(0,c.unit)(e.tailWidth)} ${e.lineType} ${e.tailColor}`},"&-pending":{[`${t}-item-head`]:{fontSize:e.fontSizeSM,backgroundColor:"transparent"},[`${t}-item-tail`]:{display:"none"}},"&-head":{position:"absolute",width:e.itemHeadSize,height:e.itemHeadSize,backgroundColor:e.dotBg,border:`${(0,c.unit)(e.dotBorderWidth)} ${e.lineType} transparent`,borderRadius:"50%","&-blue":{color:e.colorPrimary,borderColor:e.colorPrimary},"&-red":{color:e.colorError,borderColor:e.colorError},"&-green":{color:e.colorSuccess,borderColor:e.colorSuccess},"&-gray":{color:e.colorTextDisabled,borderColor:e.colorTextDisabled}},"&-head-custom":{position:"absolute",insetBlockStart:a(e.itemHeadSize).div(2).equal(),insetInlineStart:a(e.itemHeadSize).div(2).equal(),width:"auto",height:"auto",marginBlockStart:0,paddingBlock:e.customHeadPaddingVertical,lineHeight:1,textAlign:"center",border:0,borderRadius:0,transform:"translate(-50%, -50%)"},"&-content":{position:"relative",insetBlockStart:a(a(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.lineWidth).equal(),marginInlineStart:a(e.margin).add(e.itemHeadSize).equal(),marginInlineEnd:0,marginBlockStart:0,marginBlockEnd:0,wordBreak:"break-word"},"&-last":{[`> ${t}-item-tail`]:{display:"none"},[`> ${t}-item-content`]:{minHeight:a(e.controlHeightLG).mul(1.2).equal()}}},[`&${t}-alternate,
        &${t}-right,
        &${t}-label`]:{[`${t}-item`]:{"&-tail, &-head, &-head-custom":{insetInlineStart:"50%"},"&-head":{marginInlineStart:a(e.marginXXS).mul(-1).equal(),"&-custom":{marginInlineStart:a(e.tailWidth).div(2).equal()}},"&-left":{[`${t}-item-content`]:{insetInlineStart:`calc(50% - ${(0,c.unit)(e.marginXXS)})`,width:`calc(50% - ${(0,c.unit)(e.marginSM)})`,textAlign:"start"}},"&-right":{[`${t}-item-content`]:{width:`calc(50% - ${(0,c.unit)(e.marginSM)})`,margin:0,textAlign:"end"}}}},[`&${t}-right`]:{[`${t}-item-right`]:{[`${t}-item-tail,
            ${t}-item-head,
            ${t}-item-head-custom`]:{insetInlineStart:`calc(100% - ${(0,c.unit)(a(a(e.itemHeadSize).add(e.tailWidth)).div(2).equal())})`},[`${t}-item-content`]:{width:`calc(100% - ${(0,c.unit)(a(e.itemHeadSize).add(e.marginXS).equal())})`}}},[`&${t}-pending
        ${t}-item-last
        ${t}-item-tail`]:{display:"block",height:`calc(100% - ${(0,c.unit)(e.margin)})`,borderInlineStart:`${(0,c.unit)(e.tailWidth)} dotted ${e.tailColor}`},[`&${t}-reverse
        ${t}-item-last
        ${t}-item-tail`]:{display:"none"},[`&${t}-reverse ${t}-item-pending`]:{[`${t}-item-tail`]:{insetBlockStart:e.margin,display:"block",height:`calc(100% - ${(0,c.unit)(e.margin)})`,borderInlineStart:`${(0,c.unit)(e.tailWidth)} dotted ${e.tailColor}`},[`${t}-item-content`]:{minHeight:a(e.controlHeightLG).mul(1.2).equal()}},[`&${t}-label`]:{[`${t}-item-label`]:{position:"absolute",insetBlockStart:a(a(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.tailWidth).equal(),width:`calc(50% - ${(0,c.unit)(e.marginSM)})`,textAlign:"end"},[`${t}-item-right`]:{[`${t}-item-label`]:{insetInlineStart:`calc(50% + ${(0,c.unit)(e.marginSM)})`,width:`calc(50% - ${(0,c.unit)(e.marginSM)})`,textAlign:"start"}}},"&-rtl":{direction:"rtl",[`${t}-item-head-custom`]:{transform:"translate(50%, -50%)"}}})}},ae=e=>({tailColor:e.colorSplit,tailWidth:e.lineWidthBold,dotBorderWidth:e.wireframe?e.lineWidthBold:e.lineWidth*3,dotBg:e.colorBgContainer,itemPaddingBottom:e.padding*1.25});var re=(0,te.I$)("Timeline",e=>{const t=(0,ie.mergeToken)(e,{itemHeadSize:10,customHeadPaddingVertical:e.paddingXXS,paddingInlineEnd:2});return[le(t)]},ae),ne=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]]);return a},H=e=>{var{prefixCls:t,className:a,color:i="blue",dot:l,pending:j=!1,position:m,label:h,children:b}=e,C=ne(e,["prefixCls","className","color","dot","pending","position","label","children"]);const{getPrefixCls:y}=u.useContext(E.E_),d=y("timeline",t),s=O()(`${d}-item`,{[`${d}-item-pending`]:j},a),v=/blue|red|green|gray/.test(i||"")?void 0:i,g=O()(`${d}-item-head`,{[`${d}-item-head-custom`]:!!l,[`${d}-item-head-${i}`]:!v});return u.createElement("li",Object.assign({},C,{className:s}),h&&u.createElement("div",{className:`${d}-item-label`},h),u.createElement("div",{className:`${d}-item-tail`}),u.createElement("div",{className:g,style:{borderColor:v,color:v}},l),u.createElement("div",{className:`${d}-item-content`},b))},se=n(74902),oe=n(19267),W=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]]);return a},de=e=>{var{prefixCls:t,className:a,pending:i=!1,children:l,items:j,rootClassName:m,reverse:h=!1,direction:b,hashId:C,pendingDot:y,mode:d=""}=e,s=W(e,["prefixCls","className","pending","children","items","rootClassName","reverse","direction","hashId","pendingDot","mode"]);const v=(o,N)=>d==="alternate"?o==="right"?`${t}-item-right`:o==="left"?`${t}-item-left`:N%2===0?`${t}-item-left`:`${t}-item-right`:d==="left"?`${t}-item-left`:d==="right"?`${t}-item-right`:o==="right"?`${t}-item-right`:"",g=(0,se.Z)(j||[]),P=typeof i=="boolean"?null:i;i&&g.push({pending:!!i,dot:y||u.createElement(oe.Z,null),children:P}),h&&g.reverse();const T=g.length,$=`${t}-item-last`,f=g.filter(o=>!!o).map((o,N)=>{var x;const ye=N===T-2?$:"",$e=N===T-1?$:"",{className:Se}=o,be=W(o,["className"]);return u.createElement(H,Object.assign({},be,{className:O()([Se,!h&&i?ye:$e,v((x=o==null?void 0:o.position)!==null&&x!==void 0?x:"",N)]),key:(o==null?void 0:o.key)||N}))}),p=g.some(o=>!!(o!=null&&o.label)),S=O()(t,{[`${t}-pending`]:!!i,[`${t}-reverse`]:!!h,[`${t}-${d}`]:!!d&&!p,[`${t}-label`]:p,[`${t}-rtl`]:b==="rtl"},a,m,C);return u.createElement("ul",Object.assign({},s,{className:S}),f)},me=n(50344);function ce(e,t){return e&&Array.isArray(e)?e:(0,me.Z)(t).map(a=>{var i,l;return Object.assign({children:(l=(i=a==null?void 0:a.props)===null||i===void 0?void 0:i.children)!==null&&l!==void 0?l:""},a.props)})}var ue=ce,ge=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]]);return a};const M=e=>{const{getPrefixCls:t,direction:a,timeline:i}=u.useContext(E.E_),{prefixCls:l,children:j,items:m,className:h,style:b}=e,C=ge(e,["prefixCls","children","items","className","style"]),y=t("timeline",l),d=(0,_.Z)(y),[s,v,g]=re(y,d),P=ue(m,j);return s(u.createElement(de,Object.assign({},C,{className:O()(i==null?void 0:i.className,h,g,d),style:Object.assign(Object.assign({},i==null?void 0:i.style),b),prefixCls:y,direction:a,items:P,hashId:v})))};M.Item=H;var he=M,w=he,ve=n(22683),fe=n(97807),pe=n(620),r=n(85893),xe=(0,u.memo)(function(e){var t,a,i,l=e.data,j=e.onClose,m=(0,F.useIntl)(),h=(0,u.useState)(500),b=B()(h,2),C=b[0],y=b[1],d=(0,Y.Z)(function(){var $=R()(Z()().mark(function f(p,S){var o;return Z()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,V.pC)(p,S);case 2:return o=x.sent,x.abrupt("return",o.data);case 4:case"end":return x.stop()}},f)}));return function(f,p){return $.apply(this,arguments)}}(),{manual:!0}),s=d.data,v=d.loading,g=d.run;(0,u.useEffect)(function(){l!=null&&l.app_id&&l!==null&&l!==void 0&&l.app_run_id&&g(l.app_id,l.app_run_id)},[l==null?void 0:l.app_id,l==null?void 0:l.app_run_id,g]);var P=function(f){var p={1:{color:"processing",text:m.formatMessage({id:"workflow.running"})},2:{color:"success",text:m.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:m.formatMessage({id:"workflow.runF"})}},S=p[f]||{color:"default",text:"Unknown"};return(0,r.jsx)(K.Z,{color:S.color,children:S.text})},T=function(f){y(f)};return(0,r.jsx)(G.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:C,onChange:T,children:(0,r.jsx)(U.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,r.jsx)(Q.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:j,icon:(0,r.jsx)(J.Z,{})}),title:(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.detail"})}),loading:v,children:(0,r.jsx)("div",{className:"space-y-6",children:v?(0,r.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,r.jsx)(q.Z,{})}):s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(I.Z,{column:1,bordered:!0,size:"small",children:[(0,r.jsx)(I.Z.Item,{label:m.formatMessage({id:"workflow.user"}),children:s.nickname}),(0,r.jsx)(I.Z.Item,{label:m.formatMessage({id:"workflow.status"}),children:P(s.status)}),(0,r.jsx)(I.Z.Item,{label:m.formatMessage({id:"workflow.created_time"}),children:s.created_time}),(0,r.jsxs)(I.Z.Item,{label:m.formatMessage({id:"workflow.elapsed_time"}),children:[s.elapsed_time,"s"]}),(0,r.jsx)(I.Z.Item,{label:"Tokens",children:s.total_tokens})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.output"})}),s.outputs?(0,r.jsx)("div",{children:(s==null||(t=s.outputs)===null||t===void 0?void 0:t.type)=="json"?(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(pe.Z,{language:"python3",value:JSON.parse((a=s.outputs)===null||a===void 0?void 0:a.value)||"{}",readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"JSON"})}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)(ve.U,{rehypePlugins:[fe.Z],children:((i=s.outputs)===null||i===void 0?void 0:i.value)||""})})}):s.error?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,r.jsx)("div",{className:"text-red-500 font-medium mb-2",children:m.formatMessage({id:"agent.log.error"})}),(0,r.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:s.error})]}):(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:m.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(s==null?void 0:s.prompt_data)&&s.prompt_data.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(z.Z.Title,{level:5,children:m.formatMessage({id:"agent.log.conversation"})}),(0,r.jsx)(w,{className:"mt-2",children:s.prompt_data.map(function($,f){var p=B()($,2),S=p[0],o=p[1];return(0,r.jsx)(w.Item,{color:S==="human"?"blue":"green",children:(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:S}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:o.value})]})},f)})})]})]}):null})})})})}}]);
