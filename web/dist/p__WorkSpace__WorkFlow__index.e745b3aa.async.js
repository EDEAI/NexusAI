"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9142],{39873:function(Le,te,e){var ge=e(5574),N=e.n(ge),pe=e(42881),z=e(67294),K=e(85893),w=function(x){var we=x.children,Z=x.className,O=Z===void 0?"":Z,B=x.dragDirection,V=B===void 0?"left":B,ae=x.minWidth,de=ae===void 0?115:ae,Q=x.maxWidth,M=Q===void 0?820:Q,U=x.minHeight,d=U===void 0?200:U,H=x.maxHeight,ne=H===void 0?800:H,k=x.defaultWidth,se=k===void 0?415:k,r=x.defaultHeight,$=r===void 0?300:r,t=x.onChange,L=(0,z.useState)(se),ie=N()(L,2),xe=ie[0],q=ie[1],Ce=(0,z.useState)($),G=N()(Ce,2),ke=G[0],_e=G[1],Ie=(0,z.useCallback)(function(ye,be){q(ye),be&&_e(be),t==null||t(ye,be)},[q,_e,t]),Pe=(0,pe.W)({direction:["left","right"].includes(V)?"horizontal":"vertical",triggerDirection:V,minWidth:de,maxWidth:M,minHeight:d,maxHeight:ne,onResize:Ie}),ce=Pe.triggerRef,Te=Pe.containerRef;return(0,K.jsxs)("div",{ref:Te,style:{width:["left","right"].includes(V)?"".concat(xe,"px"):void 0,height:["top","bottom"].includes(V)?"".concat(ke,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(O),children:[V==="left"&&(0,K.jsx)("div",{ref:ce,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,K.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),V==="right"&&(0,K.jsx)("div",{ref:ce,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,K.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),V==="top"&&(0,K.jsx)("div",{ref:ce,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,K.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),V==="bottom"&&(0,K.jsx)("div",{ref:ce,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,K.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),we]})};te.Z=(0,z.memo)(w)},36711:function(Le,te,e){e.r(te),e.d(te,{waitTime:function(){return Q},waitTimePromise:function(){return de}});var ge=e(97857),N=e.n(ge),pe=e(5574),z=e.n(pe),K=e(15009),w=e.n(K),je=e(99289),x=e.n(je),we=e(42237),Z=e(29608),O=e(46944),B=e(76772),V=e(67294),ae=e(85893),de=function(){var M=x()(w()().mark(function U(){var d,H=arguments;return w()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return d=H.length>0&&H[0]!==void 0?H[0]:100,k.abrupt("return",new Promise(function(se){setTimeout(function(){se(!0)},d)}));case 2:case"end":return k.stop()}},U)}));return function(){return M.apply(this,arguments)}}(),Q=function(){var M=x()(w()().mark(function U(){var d,H=arguments;return w()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return d=H.length>0&&H[0]!==void 0?H[0]:100,k.next=3,de(d);case 3:case"end":return k.stop()}},U)}));return function(){return M.apply(this,arguments)}}();te.default=function(){var M=(0,B.useIntl)(),U=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:M.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(t){var L;r==null||(L=r.current)===null||L===void 0||L.submit()}}},{title:M.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:M.formatMessage({id:"workflow.created_time_des",defaultMessage:M.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:M.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(t){var L;r==null||(L=r.current)===null||L===void 0||L.submit()}},valueEnum:{1:{text:M.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:M.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:M.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(M.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:M.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:M.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],d=(0,B.useSearchParams)(),H=z()(d,1),ne=H[0],k=(0,Z.Z)(function($){return $.setRunPanelLogRecord}),se=ne.get("app_id"),r=(0,V.useRef)(null);return(0,ae.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,ae.jsx)("div",{children:(0,ae.jsx)(O.Z,{columns:U,formRef:r,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var $=x()(w()().mark(function t(L,ie,xe){var q;return w()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return console.log(L,ie,xe),G.next=3,(0,we.bB)(N()(N()({app_runs_name:"",app_runs_status:0},L),{},{app_id:se}));case 3:return q=G.sent,console.log(q),G.abrupt("return",{data:q.data.list,success:!0,total:q.data.total_count});case 6:case"end":return G.stop()}},t)}));return function(t,L,ie){return $.apply(this,arguments)}}(),onRow:function(t){return{onClick:function(){console.log("Row clicked:",t),k(t)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:M.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},47815:function(Le,te,e){e.r(te),e.d(te,{default:function(){return wt}});var ge=e(15009),N=e.n(ge),pe=e(99289),z=e.n(pe),K=e(97857),w=e.n(K),je=e(5574),x=e.n(je),we=e(32060),Z=e(42237),O=e(76772),B=e(63648),V=e(16091),ae=e(13118),de=e(78234),Q=e(77598),M=e(45360),U=e(85576),d=e(67294),H=e(64599),ne=e.n(H),k=e(7493),se=e(34559),r=e(15425),$=e(96906),t=e(85893),L=function(i){return{nodes:i.nodes,edges:i.edges,onNodesChange:i.onNodesChange,onEdgesChange:i.onEdgesChange,onConnect:i.onConnect,nodeTypes:i.nodeTypes,connectionLineStyle:i.connectionLineStyle,defaultViewport:i.defaultViewport,onDrop:i.onDrop,onDragOver:i.onDragOver,setSelect:i.setSelect,preventScrolling:i.preventScrolling}},ie=(0,d.memo)(function(c){var i=c.children,l=(0,O.useIntl)(),h=(0,r.Z)(function(o){return o.nodes}),E=(0,r.Z)(function(o){return o.getEdges}),v=(0,r.Z)(function(o){return o.edges}),I=(0,r.Z)(function(o){return o.setEdges}),n=(0,r.Z)(function(o){return o.onNodesChange}),a=(0,r.Z)(function(o){return o.onEdgesChange}),b=(0,r.Z)(function(o){return o.onConnect}),R=(0,r.Z)(function(o){return o.nodeTypes}),j=(0,r.Z)(function(o){return o.connectionLineStyle}),T=(0,r.Z)(function(o){return o.defaultViewport}),W=(0,r.Z)(function(o){return o.onDrop}),C=(0,r.Z)(function(o){return o.onDragOver}),y=(0,r.Z)(function(o){return o.setSelect}),_=(0,r.Z)(function(o){return o.preventScrolling}),P=(0,d.useCallback)(function(o){var D=h.find(function(g){return g.id===o.target}),u=function g(S){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(f.has(S.id))return!1;f.add(S.id);var p=ne()((0,k.xA)(S,h,v)),m;try{for(p.s();!(m=p.n()).done;){var Y=m.value;if(Y.id===o.source||g(Y,f))return!0}}catch(ee){p.e(ee)}finally{p.f()}};return D.id===o.source?!1:!u(D)},[h,v]),le=function(){},F=(0,d.useCallback)(function(o,D){console.log(o,D,E(),(0,k.Kz)(o,D,v)),I((0,k.Kz)(o,D,E()))},[]);return(0,Q.Z)(function(){},[h]),(0,t.jsx)(se.tV,{children:(0,t.jsx)(B.x$,{onViewportChange:le,nodes:h,edges:v,onNodesChange:n,onEdgesChange:a,onEdgesDelete:function(D){},onConnect:b,onReconnect:F,nodeTypes:R,minZoom:.3,maxZoom:1,connectionLineStyle:j,snapToGrid:!1,isValidConnection:P,connectionRadius:30,preventScrolling:_,onDragOver:C,onPaneClick:function(){y("")},onPaneContextMenu:function(D){D.preventDefault()},onSelectionChange:function(D){},onNodeClick:function(D,u){y(u.id)},onEdgeClick:function(D,u){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(D){},onBeforeDelete:function(){var o=z()(N()().mark(function D(u){var g;return N()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if((u==null||(g=u.nodes)===null||g===void 0||(g=g[0])===null||g===void 0?void 0:g.type)!=$.vW.Start){f.next=3;break}return M.ZP.error(l.formatMessage({id:"workflow.delStartNodeError"})),f.abrupt("return",Promise.reject(l.formatMessage({id:"workflow.delStartNodeError"})));case 3:return y(""),f.abrupt("return",Promise.resolve(u));case 5:case"end":return f.stop()}},D)}));return function(D){return o.apply(this,arguments)}}(),fitView:!0,children:i})})}),xe=function(i){var l=(0,d.useCallback)(function(v){v.preventDefault(),v.dataTransfer.dropEffect="move"},[]),h=(0,d.useCallback)(function(v){v.preventDefault();var I=v.dataTransfer.getData("application/reactflow");if(!I)return null;var n=JSON.parse(I),a=n.type,b=n.item;if(!a||!b)return null;var R=i({x:v.clientX,y:v.clientY});return{position:R,type:a,item:b}},[i]),E=(0,d.useCallback)(function(v){var I=function(a){var b=h(a);b&&v(b.position,b.type,b.item)};return document.addEventListener("dragover",l),document.addEventListener("drop",I),function(){document.removeEventListener("dragover",l),document.removeEventListener("drop",I)}},[l,h]);return{onDnD:E}},q=xe,Ce=function(){var i=(0,r.Z)(function(n){return n.setAgentData}),l=(0,r.Z)(function(n){return n.setSkillData}),h=(0,r.Z)(function(n){return n.setToolData}),E=(0,r.Z)(function(n){return n.setDatasetData}),v=(0,r.Z)(function(n){return n.setTeamDatasetData}),I=(0,r.Z)(function(n){return n.setModelOptionsData});(0,d.useEffect)(function(){(0,Z.x$)(2).then(function(n){n.code===0&&i({team:n.data})}),(0,Z.x$)(3).then(function(n){n.code===0&&i({user:n.data})}),(0,Z.w)(2).then(function(n){n.code===0&&l({team:n.data})}),(0,Z.w)(3).then(function(n){n.code===0&&l({user:n.data})}),(0,Z.GZ)().then(function(n){n.code===0&&h({list:Object.values(n.data)})}),(0,Z.fZ)().then(function(n){var a,b=Array.isArray(n==null||(a=n.data)===null||a===void 0?void 0:a.data)?n.data.data:[],R=b.map(function(_){return{label:_.supplier_name,options:Array.isArray(_.model_list)?_.model_list.map(function(P){return w()(w()({},P),{},{label:P.model_name,value:P.model_config_id})}):[]}}),j,T=ne()(b),W;try{for(T.s();!(W=T.n()).done;){var C=W.value;if(Array.isArray(C.model_list)){var y=C.model_list.find(function(_){return _.model_default_used===1});if(y){j=y.model_config_id;break}}}}catch(_){T.e(_)}finally{T.f()}I({options:R,defaultValue:j})}),(0,Z.mG)().then(function(n){n.code==0&&E({list:n.data.data.map(function(a){return w()(w()({},a),{},{label:a.name,value:a.dataset_id})})})}),(0,Z.mG)(2).then(function(n){n.code==0&&v({list:n.data.data.map(function(a){return w()(w()({},a),{},{label:a.name,value:a.dataset_id})})})})},[i,l,h])},G=Ce,ke=e(18032),_e=(0,d.memo)(function(c){var i=c.onSubmit,l=c.onClose;return(0,t.jsx)(ke.default,{onSubmit:i,onClose:l})}),Ie=e(39873),Pe=e(47520),ce=e(36711),Te=e(82826),ye=e(43425),be=e(48869),Ge=e(69243),Ye=e(91806),Re=e(34994),Se=e(52688),Je=e(55241),Xe=e(33456),Ze=e(43586),Qe=function(){var i,l=(0,O.useIntl)(),h=(0,d.useState)(!0),E=x()(h,2),v=E[0],I=E[1],n=(0,r.Z)(function(f){return f.setWorkflowEditInfo}),a=(0,r.Z)(function(f){return f.workFlowInfo}),b=(0,r.Z)(function(f){return f.setSelect}),R=(0,d.useState)("1"),j=x()(R,2),T=j[0],W=j[1],C=(0,d.useState)(!1),y=x()(C,2),_=y[0],P=y[1],le=(0,Ze.Z)(),F=(0,d.useRef)(null),o=function(){var p,m;return(0,t.jsx)("div",{className:"",children:(0,t.jsx)("div",{className:"w-[240px]  ",children:(0,t.jsxs)(Re.A,{formRef:F,submitter:{render:function(){return null}},onValuesChange:u,layout:"horizontal",children:[(0,t.jsx)(Se.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,t.jsx)(Se.Z,{tooltip:(a==null||(p=a.app)===null||p===void 0?void 0:p.publish_status)!="1"?{title:l.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(a==null||(m=a.app)===null||m===void 0?void 0:m.publish_status)!="1",name:"enable_api",label:"API"})]})})})},D=[{key:"4",icon:(0,t.jsx)(Te.Z,{}),label:l.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:a!=null&&a.isProd?(0,t.jsx)(ye.Z,{}):(0,t.jsx)(Je.Z,{content:o,trigger:"click",forceRender:!0,placement:"rightTop",title:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,t.jsx)(ye.Z,{})}),label:l.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:a==null?void 0:a.isProd},{key:"1",icon:(0,t.jsx)(be.Z,{}),label:l.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,t.jsx)(Ge.Z,{}),label:l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:_?l.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):l.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!_},{key:"3",icon:(0,t.jsx)(Ye.Z,{}),label:l.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,Q.Z)(function(){if(a){var f,p,m,Y,ee=a==null||(f=a.app)===null||f===void 0?void 0:f.is_public,De=a==null||(p=a.app)===null||p===void 0?void 0:p.enable_api,X={};X.is_public=!!ee,X.enable_api=(a==null||(m=a.app)===null||m===void 0?void 0:m.publish_status)=="1"?!!De:!1,console.log(X),P(X.enable_api),F==null||(Y=F.current)===null||Y===void 0||Y.setFieldsValue(X)}},[a]);var u=function(p,m){console.log(p,m),g(m.enable_api),n(m),setTimeout(le,300)},g=function(p){P(!!p)},S=function(p){var m;switch(p.key){case"4":O.history.go(-1);break;case"0":break;case"2":window.open(Pe._n+(a==null||(m=a.app)===null||m===void 0?void 0:m.api_url),"_blank");break;default:b(""),W(p.key)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(T==="3"?" !-left-[14px]":""),children:[(0,t.jsx)(Xe.Z,{defaultSelectedKeys:["1"],selectedKeys:[T],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:v,items:D,onClick:S}),T=="0"&&(0,t.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,t.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,t.jsxs)(Re.A,{formRef:F,submitter:{render:function(){return null}},onValuesChange:u,layout:"horizontal",children:[(0,t.jsx)(Se.Z,{name:"is_public",label:l.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,t.jsx)(Se.Z,{disabled:!(a!=null&&(i=a.app)!==null&&i!==void 0&&i.api_url),name:"enable_api",label:"API"})]})})})]}),T=="3"&&(0,t.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,t.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,t.jsx)(ce.default,{})})})]})},qe=Qe,Ne=e(71471),et=(0,d.memo)(function(c){var i=c.name,l=c.description,h=c.publishStatus,E=(0,O.useIntl)();return(0,t.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,t.jsx)(Ne.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:i}),h&&(0,t.jsxs)(Ne.Z.Text,{className:"whitespace-normal",children:["(",E.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,t.jsx)(Ne.Z.Text,{className:"whitespace-normal text-gray-500",children:l})]})}),tt=e(79398),at=(0,d.memo)(function(c){var i=c.visibleTabs,l=c.defaultActiveTab,h=c.showTeamSwitch,E=h===void 0?!0:h,v=c.workflowName,I=c.workflowDesc,n=c.publishStatus,a=c.onWidthChange,b=c.onItemClick,R=(0,d.useState)(!1),j=x()(R,2),T=j[0],W=j[1],C=(0,d.useState)(!1),y=x()(C,2),_=y[0],P=y[1];return(0,t.jsx)(Ie.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:_?100:315,onChange:function(F,o){requestAnimationFrame(function(){W(F<100),a==null||a(F);var D=document.querySelectorAll(".overflow-y-auto");D.forEach(function(u){if(u instanceof HTMLElement){var g=u.clientHeight,S=new CustomEvent("containerResize",{detail:{height:g,width:F}});u.dispatchEvent(S)}})})},children:(0,t.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[(0,t.jsx)(tt.Z,{visibleTabs:i,defaultActiveTab:l,showTeamSwitch:E,isMinWidth:T,isCollapsed:_,onItemClick:b}),(0,t.jsx)(qe,{}),(0,t.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,t.jsx)(et,{name:v,description:I,publishStatus:n})})]})})}),nt=e(74842),ot=e(98165),rt=e(58638),Ee=e(28036),st=e(27484),it=e.n(st),Fe=e(70681),lt=200,ut=80,dt={rankdir:"TB",align:"UL",ranker:"longest-path",nodesep:80,ranksep:100,edgesep:10,marginx:20,marginy:20},ct=function(){var i=(0,B._K)(),l=i.getNodes,h=i.getEdges,E=i.setNodes,v=function(a){return{width:a.width||lt,height:a.height||ut}},I=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"TB",b=l(),R=h();if(b.length){var j=new Fe.graphlib.Graph;j.setDefaultEdgeLabel(function(){return{}});var T=w()(w()({},dt),{},{rankdir:a});j.setGraph(T),b.forEach(function(C){var y=v(C),_=y.width,P=y.height;j.setNode(C.id,{width:_,height:P})}),R.forEach(function(C){j.setEdge(C.source,C.target)}),Fe.layout(j);var W=b.map(function(C){var y=j.node(C.id);return w()(w()({},C),{},{position:{x:y.x-y.width/2,y:y.y-y.height/2}})});E(W)}};return{autoLayout:I}},ft=ct,vt=(0,d.memo)(function(){var c=(0,O.useIntl)(),i=(0,O.useSearchParams)(),l=x()(i,1),h=l[0],E=(0,r.Z)(function(u){return u.setWorkFlowInfo}),v=(0,r.Z)(function(u){return u.workFlowInfo}),I=(0,r.Z)(function(u){return u.setRunPanelShow}),n=h.get("type")=="true",a=(0,Ze.Z)(),b=ft(),R=b.autoLayout,j=M.ZP.useMessage(),T=x()(j,2),W=T[0],C=T[1],y=(0,r.Z)(function(u){return u.loadingWorkflowData}),_=function(){var u=z()(N()().mark(function g(){var S;return N()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,a();case 2:S=h.get("app_id"),(0,Z.aJ)(S).then(function(m){console.log(m),m.code==0&&(E(w()(w()({},v),{},{app:w()(w()({},v==null?void 0:v.app),{},{publish_status:"1"})})),W.open({type:"success",content:c.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return p.stop()}},g)}));return function(){return u.apply(this,arguments)}}(),P=function(){I(!0)},le=function(){var u=z()(N()().mark(function g(){var S,f;return N()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return S=h.get("app_id"),m.next=3,(0,Z.Uq)(S);case 3:f=m.sent;case 4:case"end":return m.stop()}},g)}));return function(){return u.apply(this,arguments)}}(),F=function(){var u=z()(N()().mark(function g(){var S,f,p,m;return N()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:f=h.get("app_id"),p=(v==null||(S=v.app)===null||S===void 0?void 0:S.name)||"workflow",m=it()().format("YYYY_MM_DD-HH_mm_ss"),(0,Z.w8)(f,n==!0?1:0).then(function(De){var X=De,fe=new Blob([X],{type:"text/yaml"}),ve=URL.createObjectURL(fe),oe=document.createElement("a");oe.href=ve,oe.download="".concat(p,"_").concat(m,".yml"),document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(ve)});case 4:case"end":return ee.stop()}},g)}));return function(){return u.apply(this,arguments)}}(),o=function(g){R(g),W.open({type:"success",content:c.formatMessage({id:"workflow.autoLayoutSuccess",defaultMessage:"Nodes arranged successfully"})})},D=[{key:"TB",label:c.formatMessage({id:"workflow.autoLayoutVertical",defaultMessage:"Vertical Layout"}),onClick:function(){return o("TB")}},{key:"LR",label:c.formatMessage({id:"workflow.autoLayoutHorizontal",defaultMessage:"Horizontal Layout"}),onClick:function(){return o("LR")}}];return(0,t.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!n&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(Ee.ZP,{type:"primary",disabled:y,onClick:_,children:c.formatMessage({id:"workflow.release"})}),(0,t.jsx)(Ee.ZP,{icon:(0,t.jsx)(nt.Z,{}),disabled:y,onClick:P,children:c.formatMessage({id:"workflow.run"})}),(0,t.jsx)(Ee.ZP,{icon:(0,t.jsx)(ot.Z,{}),type:"dashed",disabled:y,onClick:a,children:c.formatMessage({id:"workflow.save"})})]}),(0,t.jsx)(Ee.ZP,{icon:(0,t.jsx)(rt.Z,{}),type:"dashed",onClick:F,disabled:y,children:c.formatMessage({id:"workflow.export",defaultMessage:""})}),C]})}),Be=e(64458),mt=e(50079),ht=function(){var i,l,h=(0,O.useIntl)(),E=(0,d.useRef)(null),v=(0,r.Z)(function(s){return s.resetNodes}),I=(0,r.Z)(function(s){return s.setNodeTypes}),n=(0,r.Z)(function(s){return s.addNode}),a=(0,r.Z)(function(s){return s.createNode}),b=(0,r.Z)(function(s){return s.setNodes}),R=(0,r.Z)(function(s){return s.setEdges}),j=(0,r.Z)(function(s){return s.setAppId}),T=(0,r.Z)(function(s){return s.setRunPanelShow}),W=(0,r.Z)(function(s){return s.runPanelShow}),C=(0,r.Z)(function(s){return s.getModelData}),y=(0,r.Z)(function(s){return s.setWorkFlowInfo}),_=(0,r.Z)(function(s){return s.setHandleList}),P=(0,r.Z)(function(s){return s.workFlowInfo}),le=(0,r.Z)(function(s){return s.setWorkflowEditInfo}),F=M.ZP.useMessage(),o=x()(F,2),D=o[0],u=o[1],g=(0,B._K)(),S=g.screenToFlowPosition,f=g.getNodes,p=g.setViewport,m=q(S),Y=m.onDnD,ee=(0,O.useSearchParams)(),De=x()(ee,1),X=De[0],fe=X.get("type")=="true",ve=(0,r.Z)(function(s){return s.setLoadingWorkflowData}),oe=(0,B.B)({includeHiddenNodes:!1}),He=(0,ae.Z)(),xt=(0,Ze.Z)(),yt=(0,d.useState)(null),Ke=x()(yt,2),ze=Ke[0],bt=Ke[1],Dt=(0,d.useState)(!1),Ue=x()(Dt,2),Mt=Ue[0],We=Ue[1],jt=(0,d.useState)(""),Ve=x()(jt,2),Ae=Ve[0],Ct=Ve[1],Et=null;(0,B.CV)({onEnd:function(A){}}),(0,de.Z)(function(){I((0,mt.$P)()),v(),(0,we.b6)(),_t(),_([])}),G(),(0,d.useEffect)(function(){if(ze){O.history.push(Ae);return}var s=O.history.block(function(A,me){if(W){Ct(A.location.pathname),We(!0);return}});return W||s==null||s(),function(){s==null||s()}},[W,ze]),(0,Q.Z)(function(){if(oe){var s=f(),A=s[s.length-1];A!=null&&A.data.drag&&(A.position={x:A.position.x-A.measured.width/2,y:A.position.y-A.measured.height/2},b(s))}},[oe]),(0,d.useEffect)(function(){var s=Y(function(A,me,Me){var ue,re=w()(w()({drag:!0},Me.data),{},{baseData:Me.baseData});if((ue=Me.baseData)!==null&&ue!==void 0&&ue.output){var he;re.outputInfo=(he=Me.baseData)===null||he===void 0?void 0:he.output}a(me,{position:A,data:re})});return s},[Y,n]),(0,Q.Z)(function(){He=="hidden"&&xt()},[He]);var _t=function(){var s=z()(N()().mark(function A(){var me;return N()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:me=X.get("app_id"),fe&&D.open({type:"warning",content:h.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),ve(!0),j(me),(0,Z.kE)(me,fe?1:0).then(function(re){if(re.code==0&&re.data){if(y(w()(w()({},re.data),{},{isProd:fe})),!re.data.workflow.graph){ve(!1),a($.vW.Start);return}var he=re.data,Oe=he.workflow.graph,kt=Oe.edges,It=Oe.nodes,J=Oe.views,$e=he.app;le({enable_api:!!$e.enable_api,is_public:!!$e.is_public}),J!=null&&J.nodes&&b(J.nodes),J!=null&&J.edges&&R(J.edges),J!=null&&J.viewPort,setTimeout(function(){ve(!1)},1e3)}}),C();case 6:case"end":return ue.stop()}},A)}));return function(){return s.apply(this,arguments)}}(),Pt=function(){bt(!0),console.log(Ae),O.history.push(Ae),We(!1)},St=function(){We(!1)};return(0,t.jsxs)("div",{className:"dndflow",children:[u,(0,t.jsx)(U.Z,{title:h.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:Mt,onOk:Pt,onCancel:St,children:h.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,t.jsx)("div",{className:"reactflow-wrapper",ref:E,children:(0,t.jsxs)(ie,{children:[(0,t.jsx)(B.Aq,{}),(0,t.jsx)("div",{children:(0,t.jsx)(B.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,t.jsx)(at,{workflowName:P==null||(i=P.app)===null||i===void 0?void 0:i.name,workflowDesc:P==null||(l=P.app)===null||l===void 0?void 0:l.description,publishStatus:fe}),(0,t.jsx)(vt,{}),(0,t.jsx)(Be.s_,{}),(0,t.jsx)(Be.Jf,{}),(0,t.jsx)(_e,{})]})},gt=(0,d.memo)(function(){return(0,t.jsx)(B.tV,{children:(0,t.jsx)(ht,{})})}),pt=function(){return(0,t.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,t.jsx)(gt,{})})},wt=pt}}]);
