"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{39873:function(bt,Te,t){var Je=t(5574),_=t.n(Je),Ye=t(42881),le=t(67294),pe=t(85893),k=function(x){var Xe=x.children,J=x.className,ee=J===void 0?"":J,ge=x.dragDirection,Se=ge===void 0?"left":ge,Ee=x.minWidth,Ae=Ee===void 0?415:Ee,ke=x.maxWidth,V=ke===void 0?820:ke,we=x.minHeight,o=we===void 0?200:we,fe=x.maxHeight,Be=fe===void 0?800:fe,oe=x.defaultWidth,Le=oe===void 0?415:oe,v=x.defaultHeight,$=v===void 0?300:v,e=x.onChange,ie=(0,le.useState)(Le),Re=_()(ie,2),Qe=Re[0],Ne=Re[1],lt=(0,le.useState)($),De=_()(lt,2),ft=De[0],it=De[1],qe=(0,le.useCallback)(function(st,Pe){Ne(st),Pe&&it(Pe),e==null||e(st,Pe)},[Ne,it,e]),We=(0,Ye.W)({direction:["left","right"].includes(Se)?"horizontal":"vertical",triggerDirection:Se,minWidth:Ae,maxWidth:V,minHeight:o,maxHeight:Be,onResize:qe}),Ue=We.triggerRef,mt=We.containerRef;return(0,pe.jsxs)("div",{ref:mt,style:{width:["left","right"].includes(Se)?"".concat(Qe,"px"):void 0,height:["top","bottom"].includes(Se)?"".concat(ft,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(ee),children:[Se==="left"&&(0,pe.jsx)("div",{ref:Ue,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,pe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),Se==="right"&&(0,pe.jsx)("div",{ref:Ue,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,pe.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),Se==="top"&&(0,pe.jsx)("div",{ref:Ue,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,pe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),Se==="bottom"&&(0,pe.jsx)("div",{ref:Ue,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,pe.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),Xe]})};Te.Z=(0,le.memo)(k)},36711:function(bt,Te,t){t.r(Te),t.d(Te,{waitTime:function(){return ke},waitTimePromise:function(){return Ae}});var Je=t(97857),_=t.n(Je),Ye=t(5574),le=t.n(Ye),pe=t(15009),k=t.n(pe),rt=t(99289),x=t.n(rt),Xe=t(42237),J=t(29608),ee=t(32592),ge=t(35312),Se=t(67294),Ee=t(85893),Ae=function(){var V=x()(k()().mark(function we(){var o,fe=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return o=fe.length>0&&fe[0]!==void 0?fe[0]:100,oe.abrupt("return",new Promise(function(Le){setTimeout(function(){Le(!0)},o)}));case 2:case"end":return oe.stop()}},we)}));return function(){return V.apply(this,arguments)}}(),ke=function(){var V=x()(k()().mark(function we(){var o,fe=arguments;return k()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return o=fe.length>0&&fe[0]!==void 0?fe[0]:100,oe.next=3,Ae(o);case 3:case"end":return oe.stop()}},we)}));return function(){return V.apply(this,arguments)}}();Te.default=function(){var V=(0,ge.useIntl)(),we=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:V.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(e){var ie;v==null||(ie=v.current)===null||ie===void 0||ie.submit()}}},{title:V.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,width:180,tooltip:V.formatMessage({id:"workflow.created_time_des",defaultMessage:V.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:V.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,width:120,valueType:"select",fieldProps:{onChange:function(e){var ie;v==null||(ie=v.current)===null||ie===void 0||ie.submit()}},valueEnum:{1:{text:V.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:V.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:V.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(V.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,width:100,tooltip:V.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",width:100,hideInSearch:!0},{title:V.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,width:120,ellipsis:!0,key:"user"}],o=(0,ge.useSearchParams)(),fe=le()(o,1),Be=fe[0],oe=(0,J.Z)(function($){return $.setRunPanelLogRecord}),Le=Be.get("app_id"),v=(0,Se.useRef)(null);return(0,Ee.jsx)("div",{className:"h-full w-screen pl-[60px] box-border",children:(0,Ee.jsx)("div",{children:(0,Ee.jsx)(ee.Z,{columns:we,formRef:v,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 380px)",x:"100%"},request:function(){var $=x()(k()().mark(function e(ie,Re,Qe){var Ne;return k()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return console.log(ie,Re,Qe),De.next=3,(0,Xe.bB)(_()(_()({app_runs_name:"",app_runs_status:0},ie),{},{app_id:Le}));case 3:return Ne=De.sent,console.log(Ne),De.abrupt("return",{data:Ne.data.list,success:!0,total:Ne.data.total_count});case 6:case"end":return De.stop()}},e)}));return function(e,ie,Re){return $.apply(this,arguments)}}(),onRow:function(e){return{onClick:function(){console.log("Row clicked:",e),oe(e)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:V.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})})})}},53971:function(bt,Te,t){t.r(Te),t.d(Te,{default:function(){return Ea}});var Je=t(15009),_=t.n(Je),Ye=t(99289),le=t.n(Ye),pe=t(97857),k=t.n(pe),rt=t(5574),x=t.n(rt),Xe=t(32060),J=t(42237),ee=t(35312),ge=t(63648),Se=t(16091),Ee=t(13118),Ae=t(78234),ke=t(77598),V=t(45360),we=t(85576),o=t(67294),fe=t(64599),Be=t.n(fe),oe=t(7493),Le=t(34559),v=t(15425),$=t(96906),e=t(85893),ie=function(l){return{nodes:l.nodes,edges:l.edges,onNodesChange:l.onNodesChange,onEdgesChange:l.onEdgesChange,onConnect:l.onConnect,nodeTypes:l.nodeTypes,connectionLineStyle:l.connectionLineStyle,defaultViewport:l.defaultViewport,onDrop:l.onDrop,onDragOver:l.onDragOver,setSelect:l.setSelect,preventScrolling:l.preventScrolling}},Re=(0,o.memo)(function(u){var l=u.children,n=(0,ee.useIntl)(),c=(0,v.Z)(function(s){return s.nodes}),w=(0,v.Z)(function(s){return s.getEdges}),f=(0,v.Z)(function(s){return s.edges}),i=(0,v.Z)(function(s){return s.setEdges}),b=(0,v.Z)(function(s){return s.onNodesChange}),d=(0,v.Z)(function(s){return s.onEdgesChange}),C=(0,v.Z)(function(s){return s.onConnect}),B=(0,v.Z)(function(s){return s.nodeTypes}),Y=(0,v.Z)(function(s){return s.connectionLineStyle}),X=(0,v.Z)(function(s){return s.defaultViewport}),te=(0,v.Z)(function(s){return s.onDrop}),a=(0,v.Z)(function(s){return s.onDragOver}),S=(0,v.Z)(function(s){return s.setSelect}),E=(0,v.Z)(function(s){return s.preventScrolling}),ae=(0,o.useCallback)(function(s){var A=c.find(function(T){return T.id===s.target}),Z=function T(se){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(P.has(se.id))return!1;P.add(se.id);var z=Be()((0,oe.xA)(se,c,f)),K;try{for(z.s();!(K=z.n()).done;){var ne=K.value;if(ne.id===s.source||T(ne,P))return!0}}catch(ue){z.e(ue)}finally{z.f()}};return A.id===s.source?!1:!Z(A)},[c,f]),W=function(){},H=(0,o.useCallback)(function(s,A){console.log(s,A,w(),(0,oe.Kz)(s,A,f)),i((0,oe.Kz)(s,A,w()))},[]);return(0,ke.Z)(function(){},[c]),(0,e.jsx)(Le.tV,{children:(0,e.jsx)(ge.x$,{onViewportChange:W,nodes:c,edges:f,onNodesChange:b,onEdgesChange:d,onEdgesDelete:function(A){},onConnect:C,onReconnect:H,nodeTypes:B,minZoom:.3,maxZoom:1,connectionLineStyle:Y,snapToGrid:!1,isValidConnection:ae,connectionRadius:30,preventScrolling:E,onDragOver:a,onPaneClick:function(){S("")},onPaneContextMenu:function(A){A.preventDefault()},onSelectionChange:function(A){},onNodeClick:function(A,Z){S(Z.id)},onEdgeClick:function(A,Z){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(A){},onBeforeDelete:function(){var s=le()(_()().mark(function A(Z){var T;return _()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((Z==null||(T=Z.nodes)===null||T===void 0||(T=T[0])===null||T===void 0?void 0:T.type)!=$.vW.Start){P.next=3;break}return V.ZP.error(n.formatMessage({id:"workflow.delStartNodeError"})),P.abrupt("return",Promise.reject(n.formatMessage({id:"workflow.delStartNodeError"})));case 3:return S(""),P.abrupt("return",Promise.resolve(Z));case 5:case"end":return P.stop()}},A)}));return function(A){return s.apply(this,arguments)}}(),fitView:!0,children:l})})}),Qe=function(l){var n=(0,o.useCallback)(function(f){f.preventDefault(),f.dataTransfer.dropEffect="move"},[]),c=(0,o.useCallback)(function(f){f.preventDefault();var i=f.dataTransfer.getData("application/reactflow");if(!i)return null;var b=JSON.parse(i),d=b.type,C=b.item;if(!d||!C)return null;var B=l({x:f.clientX,y:f.clientY});return{position:B,type:d,item:C}},[l]),w=(0,o.useCallback)(function(f){var i=function(d){var C=c(d);C&&f(C.position,C.type,C.item)};return document.addEventListener("dragover",n),document.addEventListener("drop",i),function(){document.removeEventListener("dragover",n),document.removeEventListener("drop",i)}},[n,c]);return{onDnD:w}},Ne=Qe,lt=function(){var l=(0,v.Z)(function(i){return i.setAgentData}),n=(0,v.Z)(function(i){return i.setSkillData}),c=(0,v.Z)(function(i){return i.setToolData}),w=(0,v.Z)(function(i){return i.setDatasetData}),f=(0,v.Z)(function(i){return i.setTeamDatasetData});(0,o.useEffect)(function(){(0,J.x$)(2).then(function(i){i.code===0&&l({team:i.data})}),(0,J.x$)(3).then(function(i){i.code===0&&l({user:i.data})}),(0,J.w)(2).then(function(i){i.code===0&&n({team:i.data})}),(0,J.w)(3).then(function(i){i.code===0&&n({user:i.data})}),(0,J.GZ)().then(function(i){i.code===0&&c({list:Object.values(i.data)})}),(0,J.mG)().then(function(i){i.code==0&&w({list:i.data.data.map(function(b){return k()(k()({},b),{},{label:b.name,value:b.dataset_id})})})}),(0,J.mG)(2).then(function(i){i.code==0&&f({list:i.data.data.map(function(b){return k()(k()({},b),{},{label:b.name,value:b.dataset_id})})})})},[l,n,c])},De=lt,ft=t(83065),it=t(39944),qe=t(10759),We=t(55927),Ue=t(33914),mt=t(88284),st=t(28508),Pe=t(34994),St=t(90672),$t=t(46822),Ht=t(97462),Ft=t(64317),zt=t(29933),Ut=t(3917),Ie=t(71471),Kt=t(40056),Dt=t(2487),$e=t(28036),jt=t(96486),Mt=t.n(jt),Ke=t(29432),ut=t(92485),$a=Ie.Z.Text,Ha=Kt.Z.ErrorBoundary,_t=(0,o.memo)(function(){var u,l,n=(0,ee.useIntl)(),c=(0,o.useState)(!1),w=x()(c,2),f=w[0],i=w[1],b=(0,We.Z)(function(m){return m.dealtWithData}),d=(0,We.Z)(function(m){return m.setDealtWithData}),C=(0,We.Z)(function(m){return m.setFlowMessage}),B=(0,We.Z)(function(m){return m.getNeedHumanConfirmMessage}),Y=(0,We.Z)(function(m){return m.flowMessage}),X=(0,o.useState)(null),te=x()(X,2),a=te[0],S=te[1],E=(0,o.useState)(""),ae=x()(E,2),W=ae[0],H=ae[1],s=(0,o.useState)(!1),A=x()(s,2),Z=A[0],T=A[1],se=(0,o.useState)(""),P=x()(se,2),z=P[0],K=P[1],ne=(0,Ut.Z)(J.N7,{manual:!0}),ue=ne.loading,He=ne.runAsync;(0,o.useEffect)(function(){var m;i(!!b);var y=b==null||(m=b.data)===null||m===void 0||(m=m.node_exec_data)===null||m===void 0?void 0:m.node_exec_id;return console.log(b,y),H(y),y&&he(y),function(){i(!1)}},[b]);var he=function(y){ue||He(y).then(function(I){I.data&&(S(I.data),y!=z&&(T(!1),K(y)))})};(0,ke.Z)(function(){console.log(Y,W);var m=Y.find(function(y){var I;return(y==null||(I=y.data)===null||I===void 0||(I=I.node_exec_data)===null||I===void 0?void 0:I.node_exec_id)==W});console.log(m),m&&he(W)},[Y.length]);var Ze=function(y){T(!0),(0,J.YX)(W,{correct_prompt:new it.N("",y.prompt,""),operation:1,outputs:(a==null?void 0:a.outputs)||null}).then(function(I){I.code==0&&(O(W),H(I.data.exec_id))})},O=function(y){var I=Y.filter(function(F){var U;return!((F==null||(U=F.data)===null||U===void 0||(U=U.node_exec_data)===null||U===void 0?void 0:U.node_exec_id)==y&&(F==null?void 0:F.type)=="workflow_need_human_confirm")});C(I)},Fe=function(){(0,J.YX)(W,{operation:0,outputs:(a==null?void 0:a.outputs)||null}).then(function(y){y.code==0&&(i(!1),O(W),d(null))})},et=(0,o.useCallback)(function(){var m,y,I=b==null||(m=b.data)===null||m===void 0||(m=m.node_exec_data)===null||m===void 0?void 0:m.node_type;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[I!=$.vW.LLM&&(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"input"})}),(a==null||(y=a.correct_llm_history)===null||y===void 0?void 0:y.length)>0&&(0,e.jsx)(Dt.Z,{header:(0,e.jsx)(Ie.Z.Title,{level:5,children:n.formatMessage({id:"workflow.historyPrompt",defaultMessage:"prompt"})}),dataSource:a==null?void 0:a.correct_llm_history,renderItem:function(U){var Q;return(0,e.jsx)(Dt.Z.Item,{children:U==null||(Q=U.correct_prompt)===null||Q===void 0||(Q=Q.user)===null||Q===void 0?void 0:Q.value})}}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.outputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"output"})})]}),(0,e.jsx)(Pe.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:n.formatMessage({id:"workflow.xz"})}},loading:Z,onFinish:Ze,children:(0,e.jsx)("div",{className:"flex ",children:(0,e.jsxs)("div",{className:"flex-1 pt-2 border-stone-300 border rounded-md my-2",children:[(0,e.jsxs)("div",{className:"px-2 flex justify-between cursor-default",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"text-sm text-gray-500 font-bold pb-1",children:"Prompt"})}),(0,e.jsx)("div",{})]}),(0,e.jsx)("div",{className:" pb-6 user-input-error",children:(0,e.jsx)(St.Z,{formItemProps:{className:"mb-0"},name:"prompt",required:!0,rules:[{required:!0,message:n.formatMessage({id:"workflow.requireInputPrompt"})}],fieldProps:{variant:"borderless",placeholder:n.formatMessage({id:"workflow.requireInputPrompt"}),autoSize:{minRows:2,maxRows:40},count:{show:function(U){var Q=U.value,Me=U.count,re=U.maxLength;return(0,e.jsx)("div",{className:"pr-2 text-blue-400",children:Me})}}}})})]})})})]})},[a]),_e=(0,o.useCallback)(function(){var m,y,I,F=a==null||(m=a.node_graph)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.input,U=F==null?void 0:F.properties,Q=a==null||(y=a.node_graph)===null||y===void 0||(y=y.data)===null||y===void 0?void 0:y.requires_upload,Me=a==null||(I=a.node_graph)===null||I===void 0||(I=I.data)===null||I===void 0||(I=I.import_to_knowledge_base)===null||I===void 0?void 0:I.input;console.log("requires_upload",a,Q);var re=(0,v.Z)(function(r){return r.datasetData});if(!U)return(0,e.jsx)(e.Fragment,{children:n.formatMessage({id:"workflow.requireInputPrompt",defaultMessage:""})});var ye=Object.values(U),xe=function(g){var h;console.log(g);var L=(0,qe.vV)(F);if(ye.length>0){var D=Object.entries(g).filter(function(q){var N=x()(q,2),R=N[0],me=N[1];return R.startsWith("variables.")});D.forEach(function(q){var N=x()(q,2),R=N[0],me=N[1];L.properties[R.replace("variables.","")].value=me})}var j=new qe.V7(Ke.Mp,"array[number]");g.file&&g.file.forEach(function(q){var N,R=new qe._w(q.uid,"number",(q==null||(N=q.response)===null||N===void 0||(N=N.data)===null||N===void 0?void 0:N.file_id)||0);j.addValue(R)}),L.addProperty(Ke.Mp,j),console.log(L,j);var M=(a==null||(h=a.node_graph)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.knowledge_base_mapping)||{input:{},output:{}};Object.entries(g).forEach(function(q){var N=x()(q,2),R=N[0],me=N[1];R.startsWith("dataset.")&&(M.input[Ke.Mp]||(M.input[Ke.Mp]={}),M.input[Ke.Mp][R.replace("dataset.","")]=me)}),console.log(M),(0,J.YX)(W,{operation:0,inputs:L,outputs:null,correct_prompt:null,knowledge_base_mapping:M}).then(function(q){q.code==0&&(i(!1),d(null),O(W))})},p={icon:(0,e.jsx)(Ue.Z,{}),title:n.formatMessage({id:"workflow.uploadFileText",defaultMessage:"\uFF0C"}),description:n.formatMessage({id:"workflow.uploadFileDes"}),accept:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv",fieldProps:{listType:"picture",name:"file",multiple:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},action:ft.M$,beforeUpload:function(g){var h=g.size/1024/1024<15;return h||V.ZP.error(n.formatMessage({id:"workflow.uploadFileErrorText"})),h}}};return(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsxs)(Pe.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:n.formatMessage({id:"workflow.checked",defaultMessage:""})}},onFinish:xe,children:[ye.map(function(r){return(0,e.jsx)(St.Z,{label:r.display_name,name:"variables.".concat(r.name),required:r.required,rules:[{required:r.required,message:n.formatMessage({id:"workflow.toInput"})}]},r.name)}),Q&&(0,e.jsx)($t.Z,k()({name:"file"},p)),(0,e.jsx)(Ht.Z,{name:["file"],children:function(g){var h=g.file;return Me&&(h==null?void 0:h.length)>0&&(h==null?void 0:h.map(function(L){return(0,e.jsx)(Ft.Z,{label:L.name,name:"dataset.".concat(L.uid),options:(re==null?void 0:re.list)||[],required:!0,rules:[{required:!0,message:n.formatMessage({id:"workflow.select_to_knowledge_base"})}]},L.uid)}))||null}})]})})},[a]),je=function(y){if(y.type!=="object"||!y.properties)return[y];var I=[],F=function U(Q){var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";Mt().forOwn(Q,function(re,ye){var xe=Me?"".concat(Me,".").concat(ye):ye;re.type==="object"&&re.properties?U(re.properties,xe):I.push(k()(k()({},re),{},{name:xe}))})};return F(y.properties),I},tt=function(y){return y.reduce(function(I,F){return I[F.name]=F.value,I},{})},at=(0,o.useCallback)(function(){console.log(a);var m=a==null?void 0:a.inputs,y=(0,o.useRef)(null),I=(0,o.useState)([]),F=x()(I,2),U=F[0],Q=F[1],Me=(0,o.useState)({}),re=x()(Me,2),ye=re[0],xe=re[1],p=V.ZP.useMessage(),r=x()(p,2),g=r[0],h=r[1];(0,Ae.Z)(function(){a!=null&&a.outputs&&(console.log(m,je(a==null?void 0:a.outputs)),Q(je(a==null?void 0:a.outputs)),xe(JSON.stringify(je(a==null?void 0:a.outputs))))});var L=function(){var j={};try{j=JSON.parse(ye),console.log(j,j[0]),(0,J.YX)(W,{outputs:Mt().isArray(j)?j[0]:j}).then(function(M){M.code==0&&(g.success(n.formatMessage({id:"workflow.checkSc",defaultMessage:""})),i(!1),O(W),d(null))})}catch(M){console.log(M),g.error(n.formatMessage({id:"workflow.checkOutputMessageError",defaultMessage:","}))}};return(0,e.jsxs)("div",{children:[h,(0,e.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[!Ke.eT.includes(a==null?void 0:a.node_type)&&(0,e.jsxs)("div",{children:[(0,e.jsx)(Ie.Z.Title,{level:5,children:"Inputs"}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(j){xe(j)}})})]}),(0,e.jsxs)(Ie.Z.Title,{level:5,children:["Outputs(",n.formatMessage({id:"workflow.toEdit",defaultMessage:""}),")"]}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(ut.Z,{language:"python3",value:a==null?void 0:a.outputs,isJSONStringifyBeauty:!0,onChange:function(j){xe(j)}})}),(0,e.jsx)($e.ZP,{type:"primary",onClick:L,className:"w-full mt-4",children:n.formatMessage({id:"workflow.checked",defaultMessage:""})})]})]})},[a]),Ve=(0,o.useCallback)(function(){var m=a==null?void 0:a.node_type;return m==$.vW.Human?(0,e.jsx)(_e,{}):m==$.vW.LLM||m==$.vW.Agent||m==$.vW.TaskGeneration?(0,e.jsx)(et,{}):(0,e.jsx)(at,{})},[a]),Oe=function(){var y=a==null?void 0:a.node_type;return y==$.vW.LLM||y==$.vW.Agent||y==$.vW.TaskGeneration?(0,e.jsx)($e.ZP,{type:"text",onClick:Fe,className:"text-green-500",disabled:Z,icon:(0,e.jsx)(mt.Z,{}),children:n.formatMessage({id:"workflow.checkBackLogs",defaultMessage:""})}):null};return f?(0,e.jsx)(zt.Z,{className:"w-[400px] border border-blue-300 fixed z-10  top-[105px] right-2 ",style:{height:"calc(100vh - 10px - 100px)"},extra:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Oe,{}),(0,e.jsx)($e.ZP,{onClick:function(){i(!1),d(null)},type:"text",icon:(0,e.jsx)(st.Z,{})})]}),title:(0,e.jsx)(Ie.Z.Title,{level:5,children:n.formatMessage({id:"workflow.backlogs",defaultMessage:""})}),bodyStyle:{overflowY:"auto",marginTop:"20px",boxSizing:"border-box"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(Ie.Z.Title,{level:5,children:a==null||(u=a.node_graph)===null||u===void 0||(u=u.data)===null||u===void 0?void 0:u.title})}),(0,e.jsx)("div",{children:(0,e.jsx)(Ie.Z.Text,{children:a==null||(l=a.node_graph)===null||l===void 0||(l=l.data)===null||l===void 0?void 0:l.desc})}),Ve()]})}):null}),Vt=t(19632),Ct=t.n(Vt),Gt=t(9783),dt=t.n(Gt),Jt=t(39873),Yt=t(22352),Xt=t(40110),Qt=t(86615),qt=t(5966),ea=t(62370),ta=t(96638),aa=t(74330),na=t(11941),oa=t(87718),pt=t(69386),gt=t(63680),ra=t(63783),ct=t(83062),ht=t(99510),yt=(0,o.memo)(function(u){var l=u.children,n=u.onDragStart,c=u.onClick,w=u.type,f=u.item;return(0,e.jsx)("div",{draggable:!0,onDragStart:function(b){return n(b,w,f)},onClick:c,className:"cursor-pointer hover:bg-blue-100 rounded-md px-2 box-border",children:l})}),la=(0,o.memo)(function(u){var l,n,c,w=u.item,f=u.onDragStart,i=u.typeBadge,b=u.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(w==null||(l=w.baseData)===null||l===void 0?void 0:l.description)||(w==null||(n=w.data)===null||n===void 0?void 0:n.descTools),children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:f,type:w.type,item:w,onClick:function(){return b==null?void 0:b(w)},children:(0,e.jsx)(ht.Z,{title:w.data.title,icon:(w==null||(c=w.baseData)===null||c===void 0?void 0:c.icon)||w.type,typeBadge:i})})})})}),ia=(0,o.memo)(function(u){var l,n=u.item,c=u.onDragStart,w=u.typeBadge,f=u.onItemClick;return(0,e.jsx)(ct.Z,{placement:"right",title:(l=n.baseData)===null||l===void 0?void 0:l.description,children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:c,type:n.type,item:n,onClick:function(){return f==null?void 0:f(n)},children:(0,e.jsx)(ht.Z,{title:n.baseData.name,icon:n.baseData.icon||"workflow",extra:(0,e.jsx)("div",{className:"text-xs text-gray-500",children:n.baseData.nickname}),typeBadge:w})})})})}),sa=(0,o.memo)(function(u){var l,n,c,w,f,i,b,d,C,B,Y,X,te,a,S=u.tool,E=u.category,ae=u.onDragStart,W=u.typeBadge,H=u.onItemClick,s=u.categoryIndex,A=u.toolIndex,Z=(0,ee.getLocale)()==="en-US"?"en_US":"zh_Hans",T=(0,gt.o6)()[$.vW.Tool],se=k()(k()({},S),{},{authorization_status:E==null?void 0:E.authorization_status,title:S==null||(l=S.identity)===null||l===void 0?void 0:l.label[Z],icon:E==null||(n=E.identity)===null||n===void 0?void 0:n.icon,groupName:E==null||(c=E.identity)===null||c===void 0?void 0:c.name,credentials_for_provider:E==null?void 0:E.credentials_for_provider}),P={title:S==null||(w=S.identity)===null||w===void 0?void 0:w.label[Z],desc:(S==null||(f=S.description)===null||f===void 0||(f=f.human)===null||f===void 0?void 0:f[Z])||(S==null||(i=S.description)===null||i===void 0?void 0:i.llm),icon:E==null||(b=E.identity)===null||b===void 0?void 0:b.icon,data:{title:S==null||(d=S.identity)===null||d===void 0?void 0:d.label[Z],desc:(S==null||(C=S.description)===null||C===void 0||(C=C.human)===null||C===void 0?void 0:C[Z])||(S==null||(B=S.description)===null||B===void 0?void 0:B.llm),icon:E==null||(Y=E.identity)===null||Y===void 0?void 0:Y.icon},baseData:se};return(0,e.jsx)(ct.Z,{placement:"right",title:S==null||(X=S.description)===null||X===void 0||(X=X.human)===null||X===void 0?void 0:X[Z],children:(0,e.jsx)("div",{children:(0,e.jsx)(yt,{onDragStart:ae,type:$.vW.Tool,item:P,onClick:function(){return H==null?void 0:H(E,S,s,A)},children:(0,e.jsx)(ht.Z,{title:S==null||(te=S.identity)===null||te===void 0?void 0:te.label[Z],icon:E==null||(a=E.identity)===null||a===void 0?void 0:a.icon,typeBadge:W})})})})}),ua=(0,o.memo)(function(u){var l,n,c=u.category,w=u.onDragStart,f=u.typeBadge,i=u.onItemClick,b=u.categoryIndex,d=(0,ee.getLocale)()==="en-US"?"en_US":"zh_Hans";return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[#333333] mb-2",children:[c==null||(l=c.identity)===null||l===void 0?void 0:l.label[d],(0,e.jsx)(ct.Z,{placement:"right",title:c==null||(n=c.identity)===null||n===void 0?void 0:n.description[d],children:(0,e.jsx)(ra.Z,{className:"cursor-pointer ml-1"})})]}),c.tools.map(function(C,B){return(0,e.jsx)(sa,{tool:C,category:c,onDragStart:w,typeBadge:f,onItemClick:function(X,te,a,S){return i==null?void 0:i(X,te,a,S)},categoryIndex:b,toolIndex:B},B)})]})}),da=function(l){var n=l.list,c=l.onDragStart,w=l.type,f=w===void 0?"normal":w,i=l.typeBadge,b=i===void 0?null:i,d=l.onItemClick;return n!=null&&n.length?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-y-2 gap-2",children:f==="tools"?n.map(function(C,B){return(0,e.jsx)(ua,{category:C,typeBadge:b,onDragStart:c,onItemClick:d,categoryIndex:B},B)}):f==="workflow"?n.map(function(C,B){return(0,e.jsx)(ia,{item:C,onDragStart:c,typeBadge:b,onItemClick:d},B)}):n.map(function(C,B){return(0,e.jsx)(la,{item:C,onDragStart:c,typeBadge:b,onItemClick:d},B)})}):null},ca=(0,o.memo)(da),va=t(26474),kt=t(47520),fa=t(36711),ma=t(82826),It=t(43425),pa=t(48869),ga=t(69243),ha=t(91806),vt=t(52688),ya=t(55241),xa=t(50136),xt=t(10899),wa=function(){var l,n=(0,ee.useIntl)(),c=(0,o.useState)(!0),w=x()(c,2),f=w[0],i=w[1],b=(0,v.Z)(function(P){return P.setWorkflowEditInfo}),d=(0,v.Z)(function(P){return P.workFlowInfo}),C=(0,v.Z)(function(P){return P.setSelect}),B=(0,o.useState)("1"),Y=x()(B,2),X=Y[0],te=Y[1],a=(0,o.useState)(!1),S=x()(a,2),E=S[0],ae=S[1],W=(0,xt.Z)(),H=(0,o.useRef)(null),s=function(){var z,K;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(Pe.A,{formRef:H,submitter:{render:function(){return null}},onValuesChange:Z,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:n.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{tooltip:(d==null||(z=d.app)===null||z===void 0?void 0:z.publish_status)!="1"?{title:n.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(d==null||(K=d.app)===null||K===void 0?void 0:K.publish_status)!="1",name:"enable_api",label:"API"})]})})})},A=[{key:"4",icon:(0,e.jsx)(ma.Z,{}),label:n.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:d!=null&&d.isProd?(0,e.jsx)(It.Z,{}):(0,e.jsx)(ya.Z,{content:s,trigger:"click",forceRender:!0,placement:"rightTop",title:n.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(It.Z,{})}),label:n.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:d==null?void 0:d.isProd},{key:"1",icon:(0,e.jsx)(pa.Z,{}),label:n.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(ga.Z,{}),label:n.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:E?n.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):n.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!E},{key:"3",icon:(0,e.jsx)(ha.Z,{}),label:n.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,ke.Z)(function(){if(d){var P,z,K,ne,ue=d==null||(P=d.app)===null||P===void 0?void 0:P.is_public,He=d==null||(z=d.app)===null||z===void 0?void 0:z.enable_api,he={};he.is_public=!!ue,he.enable_api=(d==null||(K=d.app)===null||K===void 0?void 0:K.publish_status)=="1"?!!He:!1,console.log(he),ae(he.enable_api),H==null||(ne=H.current)===null||ne===void 0||ne.setFieldsValue(he)}},[d]);var Z=function(z,K){console.log(z,K),T(K.enable_api),b(K),setTimeout(W,300)},T=function(z){ae(!!z)},se=function(z){var K;switch(z.key){case"4":ee.history.go(-1);break;case"0":break;case"2":window.open(kt._n+(d==null||(K=d.app)===null||K===void 0?void 0:K.api_url),"_blank");break;default:C(""),te(z.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"absolute left-[calc(100%+26px)] -top-4  z-20 ".concat(X==="3"?" !-left-[14px]":""),children:[(0,e.jsx)(xa.Z,{defaultSelectedKeys:["1"],selectedKeys:[X],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:f,items:A,onClick:se}),X=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px] bg-white rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(Pe.A,{formRef:H,submitter:{render:function(){return null}},onValuesChange:Z,layout:"horizontal",children:[(0,e.jsx)(vt.Z,{name:"is_public",label:n.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(vt.Z,{disabled:!(d!=null&&(l=d.app)!==null&&l!==void 0&&l.api_url),name:"enable_api",label:"API"})]})})})]}),X=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px] pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(fa.default,{})})})]})},ba=wa,Sa=(0,o.memo)(function(u){var l=u.name,n=u.description,c=u.publishStatus,w=(0,ee.useIntl)();return(0,e.jsxs)("div",{className:"flex flex-col gap-2 min-w-[300px] max-w-[400px] pointer-events-none",children:[(0,e.jsx)(Ie.Z.Title,{className:"!m-0 !text-base whitespace-normal",level:5,children:l}),c&&(0,e.jsxs)(Ie.Z.Text,{className:"whitespace-normal",children:["(",w.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(Ie.Z.Text,{className:"whitespace-normal text-gray-500",children:n})]})}),Da=(0,o.memo)(function(u){var l=u.visibleTabs,n=u.defaultActiveTab,c=u.showTeamSwitch,w=c===void 0?!0:c,f=u.workflowName,i=u.workflowDesc,b=u.publishStatus,d=u.onWidthChange,C=(0,ee.useIntl)(),B=(0,ee.getLocale)()=="en-US"?"en_US":"zh_Hans",Y=(0,gt.o6)(),X=Object.values(Y).filter(function(r){return![$.vW.Start,$.vW.Agent,$.vW.Tool,$.vW.Skill].includes(r.base.type)}).map(function(r){return r.base}),te=(0,o.useState)(n||"1"),a=x()(te,2),S=a[0],E=a[1],ae=(0,o.useState)(X),W=x()(ae,2),H=W[0],s=W[1],A=(0,o.useState)([]),Z=x()(A,2),T=Z[0],se=Z[1],P=(0,va.v)(),z=P.tags,K=(0,ta.Z)(dt()(dt()(dt()({},$.vW.Agent,[]),$.vW.Skill,[]),"workflow",[])),ne=x()(K,2),ue=ne[0],He=ne[1],he=(0,o.useState)({team:1,keyword:"",tag:[]}),Ze=x()(he,2),O=Ze[0],Fe=Ze[1],et=(0,o.useState)(!1),_e=x()(et,2),je=_e[0],tt=_e[1],at=(0,o.useState)(!1),Ve=x()(at,2),Oe=Ve[0],m=Ve[1],y=(0,v.Z)(function(r){return r.toolData});(0,o.useEffect)(function(){se((y==null?void 0:y.list)||[])},[y]);var I=(0,o.useCallback)(function(r,g,h){console.log("onDragStart",r,g,h),r.dataTransfer.setData("application/reactflow",JSON.stringify({type:g,item:h})),r.dataTransfer.effectAllowed="move"},[]),F=(0,o.useCallback)(function(r,g){if(!g)return r;var h=new pt.Z(r,{keys:["data.title","type","data.desc"],threshold:.3,includeScore:!0}),L=h.search(g);return L.map(function(D){return D.item})},[]),U=(0,o.useCallback)(function(r,g){if(!g)return r;var h=r.map(function(j){var M;return k()(k()({},j),{},{tools:(M=j.tools)===null||M===void 0?void 0:M.map(function(q){var N,R;return k()(k()({},q),{},{categoryName:(N=j.identity)===null||N===void 0||(N=N.label)===null||N===void 0?void 0:N[B],categoryIcon:(R=j.identity)===null||R===void 0?void 0:R.icon})})})}),L=new pt.Z(h,{keys:["identity.label.zh_Hans","identity.label.en_US","identity.description.zh_Hans","identity.description.en_US","tools.identity.label.zh_Hans","tools.identity.label.en_US","tools.description.human.zh_Hans","tools.description.human.en_US"],threshold:.4,includeScore:!0,useExtendedSearch:!0}),D=L.search(g);return D.map(function(j){return k()(k()({},j.item),{},{tools:j.item.tools.filter(function(M){var q=new pt.Z([M],{keys:["identity.label.zh_Hans","identity.label.en_US","description.human.zh_Hans","description.human.en_US"],threshold:.4});return q.search(g).length>0})})}).filter(function(j){return j.tools.length>0})},[B]),Q=(0,o.useMemo)(function(){var r=[{tabKey:"node",label:"workflow.node",defaultMessage:"Node",type:"normal",getData:function(){return O.keyword?F(H,O.keyword):H}},{tabKey:"agent",label:"workflow.agent",defaultMessage:"Agent",type:"normal",getData:function(){return ye($.vW.Agent)}},{tabKey:"tool",label:"workflow.tool",defaultMessage:"Tool",type:"tools",getData:function(){return O.keyword?U(T,O.keyword):T}},{tabKey:"skill",label:"workflow.skill",defaultMessage:"Skill",type:"normal",getData:function(){var h=le()(_()().mark(function D(){return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,ye($.vW.Skill);case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},D)}));function L(){return h.apply(this,arguments)}return L}()},{tabKey:"workflow",label:"workflow.list",defaultMessage:"Workflow",type:"workflow",getData:function(){var h=le()(_()().mark(function D(){return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,ye("workflow");case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},D)}));function L(){return h.apply(this,arguments)}return L}()}],g=l!=null&&l.length?r.filter(function(h){return l.includes(h.tabKey)}):r;return g.map(function(h,L){return k()(k()({},h),{},{key:L+1+""})})},[H,ue,T,l,O,F,U]),Me=(0,o.useMemo)(function(){return Q.map(function(r,g){return{key:r.key,label:C.formatMessage({id:r.label,defaultMessage:r.defaultMessage})}})},[Q]),re=(0,o.useCallback)(function(r){var g=r.tabIndex,h=r.showName,L=h===void 0?!0:h,D=Q.find(function(G){return G.key===g}),j=(0,o.useState)([]),M=x()(j,2),q=M[0],N=M[1],R=(0,o.useState)(!0),me=x()(R,2),nt=me[0],Pt=me[1],Wa=(0,o.useState)([]),Zt=x()(Wa,2),ot=Zt[0],Tt=Zt[1],Oa=(0,o.useState)(20),Aa=x()(Oa,1),Et=Aa[0],Ba=(0,o.useState)(500),Wt=x()(Ba,2),Ot=Wt[0],At=Wt[1],ze=(0,o.useRef)(null),La=54;(0,o.useEffect)(function(){var G=function(){if(ze.current){var ce=ze.current.clientHeight;At(ce)}},de=function(ce){At(ce.detail.height)};return G(),ze.current&&ze.current.addEventListener("containerResize",de),window.addEventListener("resize",G),function(){ze.current&&ze.current.removeEventListener("containerResize",de),window.removeEventListener("resize",G)}},[]),(0,o.useEffect)(function(){var G=function(){var de=le()(_()().mark(function be(){var ce,Ce;return _()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return Pt(!0),ve.prev=1,ve.next=4,D.getData();case 4:ce=ve.sent,Ce=(ce==null?void 0:ce.map(function(Rt,wt){return k()(k()({},Rt),{},{id:"".concat(D.tabKey,"-").concat(wt)})}))||[],N(Ce),Tt(Ce.slice(0,Et)),ve.next=13;break;case 10:ve.prev=10,ve.t0=ve.catch(1),console.error("Failed to fetch data:",ve.t0);case 13:return ve.prev=13,Pt(!1),ve.finish(13);case 16:case"end":return ve.stop()}},be,null,[[1,10,13,16]])}));return function(){return de.apply(this,arguments)}}();G()},[D,O]);var Ra=function(de){if(de.currentTarget.scrollHeight-de.currentTarget.scrollTop===Ot){var be=ot.length;if(be<q.length){var ce=q.slice(be,be+Et);Tt(function(Ce){return[].concat(Ct()(Ce),Ct()(ce))})}}},Bt=(0,o.useCallback)(function(G,de,be,ce){switch(console.log("Clicked category:",G),console.log("Clicked item:",de),console.log("Indices:",be,ce),D.tabKey){case"tool":if(be!==void 0&&ce!==void 0){var Ce,Ge;console.log("Tool ".concat((Ce=de.identity)===null||Ce===void 0?void 0:Ce.label[B]," in category ").concat((Ge=G.identity)===null||Ge===void 0?void 0:Ge.label[B]))}break;case"workflow":break;case"agent":break}},[D.tabKey,B]),Lt=(0,o.memo)(function(G){var de=G.data,be=G.index,ce=G.onDragStart,Ce=G.onItemClick,Ge=G.type,ve=G.typeBadge;return(0,e.jsx)(ca,{typeBadge:ve,list:[de],onDragStart:ce,type:Ge,onItemClick:function(wt){return Ce(wt)}})});return(0,e.jsx)("div",{ref:ze,className:"overflow-y-auto h-full",children:(0,e.jsx)(aa.Z,{spinning:nt,children:O!=null&&O.keyword?(0,e.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2",children:ot.map(function(G){return(0,e.jsx)(Lt,{data:G,index:ot.indexOf(G),onDragStart:I,onItemClick:Bt,type:D.type,typeBadge:O!=null&&O.keyword&&D.tabKey!="node"?{icon:"/icons/".concat(D.tabKey,".svg"),tooltip:D.tabKey,color:"#1b64f3"}:void 0},G.id)})}):(0,e.jsx)(oa.Z,{data:ot,height:Ot,itemHeight:La,itemKey:"id",onScroll:Ra,children:function(de){return(0,e.jsx)(Lt,{data:de,index:ot.indexOf(de),onDragStart:I,onItemClick:Bt,type:D.type,typeBadge:O!=null&&O.keyword&&D.tabKey!="node"?{icon:"/icons/".concat(D.tabKey,".svg"),tooltip:D.tabKey,color:"#1b64f3"}:void 0})}})})})},[S,O,je]),ye=(0,o.useCallback)(function(){var r=le()(_()().mark(function g(h){var L,D,j,M;return _()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.prev=0,N.next=3,(0,J.RE)(h,{search_type:O.team,apps_name:O.keyword,tag_ids:((L=O.tag)===null||L===void 0?void 0:L.join(","))||""});case 3:if(j=N.sent,!((j==null?void 0:j.code)===0&&j!==null&&j!==void 0&&(D=j.data)!==null&&D!==void 0&&(D=D.list)!==null&&D!==void 0&&D.length)){N.next=8;break}return M=j.data.list.map(function(R){var me,nt;return k()(k()({},(me=Y[h])===null||me===void 0?void 0:me.base),{},{data:k()(k()({},(nt=Y[h])===null||nt===void 0?void 0:nt.base.data),{},{title:R.name,desc:R.description}),baseData:R})}),He(dt()({},h,M)),N.abrupt("return",M);case 8:N.next=13;break;case 10:N.prev=10,N.t0=N.catch(0),console.error("Failed to fetch ".concat(h," data:"),N.t0);case 13:case"end":return N.stop()}},g,null,[[0,10]])}));return function(g){return r.apply(this,arguments)}}(),[O]),xe=(0,o.useCallback)((0,jt.debounce)(function(r){Fe(r)},500),[]),p=(0,o.useCallback)(function(r,g){"team"in r?(Fe(g),g.team==2):("tag"in r||"keyword"in r)&&xe(g)},[xe]);return(0,e.jsx)(Jt.Z,{dragDirection:"right",minWidth:200,maxWidth:415,className:"fixed left-0 top-16 bg-white shadow-md",defaultWidth:Oe?100:315,onChange:function(g,h){requestAnimationFrame(function(){tt(g<100),d==null||d(g);var L=document.querySelectorAll(".overflow-y-auto");L.forEach(function(D){if(D instanceof HTMLElement){var j=D.clientHeight,M=new CustomEvent("containerResize",{detail:{height:j,width:g}});D.dispatchEvent(M)}})})},children:(0,e.jsxs)("div",{className:"h-[calc(100vh-110px)] flex flex-col relative",children:[!Oe&&(0,e.jsxs)("div",{className:"px-4 py-3",children:[(0,e.jsxs)(Pe.A,{submitter:!1,initialValues:O,onValuesChange:p,children:[w&&(0,e.jsxs)("div",{className:"flex gap-2 items-center text-base mb-4",children:[C.formatMessage({id:"workflow.nodeList",defaultMessage:""}),(0,e.jsx)(Qt.Z.Group,{name:"team",fieldProps:{options:[{label:C.formatMessage({id:"workflow.team",defaultMessage:""}),value:2},{label:C.formatMessage({id:"workflow.mine",defaultMessage:""}),value:1}],size:"small",optionType:"button",buttonStyle:"solid"},formItemProps:{className:"mb-0"}})]}),(0,e.jsx)(qt.Z,{fieldProps:{prefix:(0,e.jsx)(Xt.Z,{}),placeholder:C.formatMessage({id:"workflow.search",defaultMessage:""})},name:"keyword"}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(ea.Z,{name:"tag",children:(0,e.jsx)(Yt.O,{className:"w-full",options:z,listStyle:je?"horizontal":"vertical",allowClear:!0,placeholder:C.formatMessage({id:"creation.placeholder.selectTags",defaultMessage:""}),onChange:function(g){}})})})]}),O!=null&&O.keyword?null:(0,e.jsx)(na.Z,{activeKey:S,items:Me,onChange:function(g){E(g)}})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:O!=null&&O.keyword?(0,e.jsx)("div",{className:"grid gap-4",children:Q.map(function(r,g){return(0,e.jsxs)("div",{className:"space-y-2",children:[!Oe&&(0,e.jsx)("div",{className:"text-base font-medium px-2",children:C.formatMessage({id:r.label,defaultMessage:r.defaultMessage})}),(0,e.jsx)(re,{tabIndex:g+1+"",showName:!je},r.key)]},r.key)})}):(0,e.jsx)(re,{tabIndex:S,showName:!je})}),(0,e.jsx)(ba,{}),(0,e.jsx)("div",{className:"absolute left-[calc(100%+80px)] top-0",children:(0,e.jsx)(Sa,{name:f,description:i,publishStatus:b})})]})})}),ja=t(74842),Ma=t(98165),Ca=t(58638),ka=t(27484),Ia=t.n(ka),Na=(0,o.memo)(function(){var u=(0,ee.useIntl)(),l=(0,ee.useSearchParams)(),n=x()(l,1),c=n[0],w=(0,v.Z)(function(W){return W.setWorkFlowInfo}),f=(0,v.Z)(function(W){return W.workFlowInfo}),i=(0,v.Z)(function(W){return W.setRunPanelShow}),b=c.get("type")=="true",d=(0,xt.Z)(),C=V.ZP.useMessage(),B=x()(C,2),Y=B[0],X=B[1],te=function(){var W=le()(_()().mark(function H(){var s;return _()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,d();case 2:s=c.get("app_id"),(0,J.aJ)(s).then(function(T){console.log(T),T.code==0&&(w(k()(k()({},f),{},{app:k()(k()({},f==null?void 0:f.app),{},{publish_status:"1"})})),Y.open({type:"success",content:u.formatMessage({id:"workflow.releaseSuc"})}))});case 4:case"end":return Z.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),a=function(){i(!0)},S=function(){var W=le()(_()().mark(function H(){var s,A;return _()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=c.get("app_id"),T.next=3,(0,J.Uq)(s);case 3:A=T.sent;case 4:case"end":return T.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),E=function(){var W=le()(_()().mark(function H(){var s,A,Z,T;return _()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:A=c.get("app_id"),Z=(f==null||(s=f.app)===null||s===void 0?void 0:s.name)||"workflow",T=Ia()().format("YYYY_MM_DD-HH_mm_ss"),(0,J.w8)(A,b==!0?1:0).then(function(z){var K=new Blob([z],{type:"text/yaml"}),ne=URL.createObjectURL(K),ue=document.createElement("a");ue.href=ne,ue.download="".concat(Z,"_").concat(T,".yml"),document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(ne)});case 4:case"end":return P.stop()}},H)}));return function(){return W.apply(this,arguments)}}(),ae={name:"file",fileList:null,action:kt._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!b&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)($e.ZP,{type:"primary",onClick:te,children:u.formatMessage({id:"workflow.release"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(ja.Z,{}),onClick:a,children:u.formatMessage({id:"workflow.run"})}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ma.Z,{}),type:"dashed",onClick:d,children:u.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)($e.ZP,{icon:(0,e.jsx)(Ca.Z,{}),type:"dashed",onClick:E,children:u.formatMessage({id:"workflow.export",defaultMessage:""})}),X]})}),Nt=t(55877),Pa=function(){var l,n,c=(0,ee.useIntl)(),w=(0,o.useRef)(null),f=(0,v.Z)(function(p){return p.resetNodes}),i=(0,v.Z)(function(p){return p.setNodeTypes}),b=(0,v.Z)(function(p){return p.addNode}),d=(0,v.Z)(function(p){return p.createNode}),C=(0,v.Z)(function(p){return p.setNodes}),B=(0,v.Z)(function(p){return p.setEdges}),Y=(0,v.Z)(function(p){return p.setAppId}),X=(0,v.Z)(function(p){return p.setRunPanelShow}),te=(0,v.Z)(function(p){return p.runPanelShow}),a=(0,v.Z)(function(p){return p.getModelData}),S=(0,v.Z)(function(p){return p.setWorkFlowInfo}),E=(0,v.Z)(function(p){return p.setHandleList}),ae=(0,v.Z)(function(p){return p.workFlowInfo}),W=(0,v.Z)(function(p){return p.setWorkflowEditInfo}),H=V.ZP.useMessage(),s=x()(H,2),A=s[0],Z=s[1],T=(0,ge._K)(),se=T.screenToFlowPosition,P=T.getNodes,z=T.setViewport,K=Ne(se),ne=K.onDnD,ue=(0,ee.useSearchParams)(),He=x()(ue,1),he=He[0],Ze=he.get("type")=="true",O=(0,ge.B)({includeHiddenNodes:!1}),Fe=(0,Ee.Z)(),et=(0,xt.Z)(),_e=(0,o.useState)(null),je=x()(_e,2),tt=je[0],at=je[1],Ve=(0,o.useState)(!1),Oe=x()(Ve,2),m=Oe[0],y=Oe[1],I=(0,o.useState)(""),F=x()(I,2),U=F[0],Q=F[1],Me=null;(0,ge.CV)({onEnd:function(r){}}),(0,Ae.Z)(function(){i((0,gt.$P)()),f(),(0,Xe.b6)(),re(),E([])}),De(),(0,o.useEffect)(function(){if(tt){ee.history.push(U);return}var p=ee.history.block(function(r,g){if(te){Q(r.location.pathname),y(!0);return}});return te||p==null||p(),function(){p==null||p()}},[te,tt]),(0,ke.Z)(function(){if(O){var p=P(),r=p[p.length-1];r.data.drag&&(r.position={x:r.position.x-r.measured.width/2,y:r.position.y-r.measured.height/2},C(p))}},[O]),(0,o.useEffect)(function(){var p=ne(function(r,g,h){console.log(r,g,h),d(g,{position:r,data:k()(k()({drag:!0},h.data),{},{baseData:h.baseData})})});return p},[ne,b]),(0,ke.Z)(function(){Fe=="hidden"&&et()},[Fe]);var re=function(){var p=le()(_()().mark(function r(){var g;return _()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:g=he.get("app_id"),Ze&&A.open({type:"warning",content:c.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),Y(g),(0,J.kE)(g,Ze?1:0).then(function(D){if(D.code==0){if(S(k()(k()({},D.data),{},{isProd:Ze})),!D.data.workflow.graph){d($.vW.Start);return}var j=D.data,M=j.workflow.graph,q=M.edges,N=M.nodes,R=M.views,me=j.app;W({enable_api:!!me.enable_api,is_public:!!me.is_public}),R!=null&&R.nodes&&C(R.nodes),R!=null&&R.edges&&B(R.edges),R!=null&&R.viewPort}}),a();case 5:case"end":return L.stop()}},r)}));return function(){return p.apply(this,arguments)}}(),ye=function(){at(!0),console.log(U),ee.history.push(U),y(!1)},xe=function(){y(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[Z,(0,e.jsx)(we.Z,{title:c.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:m,onOk:ye,onCancel:xe,children:c.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:w,children:(0,e.jsxs)(Re,{children:[(0,e.jsx)(ge.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(ge.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-right",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsx)(Da,{visibleTabs:["node","agent","skill","tool"],workflowName:ae==null||(l=ae.app)===null||l===void 0?void 0:l.name,workflowDesc:ae==null||(n=ae.app)===null||n===void 0?void 0:n.description,publishStatus:Ze}),(0,e.jsx)(Na,{}),(0,e.jsx)(Nt.s_,{}),(0,e.jsx)(Nt.Jf,{}),(0,e.jsx)(_t,{})]})},Za=(0,o.memo)(function(){return(0,e.jsx)(ge.tV,{children:(0,e.jsx)(Pa,{})})}),Ta=function(){return(0,e.jsx)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:(0,e.jsx)(Za,{})})},Ea=Ta}}]);
