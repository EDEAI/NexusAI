"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[615],{85422:function(la,De,a){var Le=a(15009),W=a.n(Le),Ie=a(99289),re=a.n(Ie),we=a(5574),g=a.n(we),Ne=a(11551),C=a(39873),Te=a(28508),w=a(29933),le=a(35312),ge=a(3917),K=a(66309),m=a(28036),Y=a(71471),z=a(74330),e=a(26412),P=a(12845),Q=a(67294),ee=a(22683),ne=a(97807),fe=a(92485),n=a(85893);De.Z=(0,Q.memo)(function(k){var N,ie,oe,M=k.data,Se=k.onClose,D=(0,le.useIntl)(),he=(0,Q.useState)(500),_e=g()(he,2),Ce=_e[0],X=_e[1],A=(0,ge.Z)(function(){var O=re()(W()().mark(function F(T,R){var je;return W()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,(0,Ne.pC)(T,R);case 2:return je=ae.sent,ae.abrupt("return",je.data);case 4:case"end":return ae.stop()}},F)}));return function(F,T){return O.apply(this,arguments)}}(),{manual:!0}),d=A.data,B=A.loading,V=A.run;(0,Q.useEffect)(function(){M!=null&&M.app_id&&M!==null&&M!==void 0&&M.app_run_id&&V(M.app_id,M.app_run_id)},[M==null?void 0:M.app_id,M==null?void 0:M.app_run_id,V]);var pe=function(F){var T={1:{color:"processing",text:D.formatMessage({id:"workflow.running"})},2:{color:"success",text:D.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:D.formatMessage({id:"workflow.runF"})}},R=T[F]||{color:"default",text:"Unknown"};return(0,n.jsx)(K.Z,{color:R.color,children:R.text})},xe=function(F){X(F)};return(0,n.jsx)(C.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:Ce,onChange:xe,children:(0,n.jsx)(w.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,n.jsx)(m.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:Se,icon:(0,n.jsx)(Te.Z,{})}),title:(0,n.jsx)(Y.Z.Title,{level:5,children:D.formatMessage({id:"agent.log.detail"})}),loading:B,children:(0,n.jsx)("div",{className:"space-y-6",children:B?(0,n.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,n.jsx)(z.Z,{})}):d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.Z,{column:1,bordered:!0,size:"small",children:[(0,n.jsx)(e.Z.Item,{label:D.formatMessage({id:"workflow.user"}),children:d.nickname}),(0,n.jsx)(e.Z.Item,{label:D.formatMessage({id:"workflow.status"}),children:pe(d.status)}),(0,n.jsx)(e.Z.Item,{label:D.formatMessage({id:"workflow.created_time"}),children:d.created_time}),(0,n.jsxs)(e.Z.Item,{label:D.formatMessage({id:"workflow.elapsed_time"}),children:[d.elapsed_time,"s"]}),(0,n.jsx)(e.Z.Item,{label:"Tokens",children:d.total_tokens})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)(Y.Z.Title,{level:5,children:D.formatMessage({id:"agent.log.output"})}),d.outputs?(0,n.jsx)("div",{children:(d==null||(N=d.outputs)===null||N===void 0?void 0:N.type)=="json"?(0,n.jsx)("div",{className:"h-80",children:(0,n.jsx)(fe.Z,{language:"python3",value:JSON.parse((ie=d.outputs)===null||ie===void 0?void 0:ie.value)||"{}",readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"JSON"})}):(0,n.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,n.jsx)(ee.U,{rehypePlugins:[ne.Z],children:((oe=d.outputs)===null||oe===void 0?void 0:oe.value)||""})})}):d.error?(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,n.jsx)("div",{className:"text-red-500 font-medium mb-2",children:D.formatMessage({id:"agent.log.error"})}),(0,n.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:d.error})]}):(0,n.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,n.jsx)("div",{className:"text-sm text-gray-500",children:D.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(d==null?void 0:d.prompt_data)&&d.prompt_data.length>0&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)(Y.Z.Title,{level:5,children:D.formatMessage({id:"agent.log.conversation"})}),(0,n.jsx)(P.Z,{className:"mt-2",children:d.prompt_data.map(function(O,F){var T=g()(O,2),R=T[0],je=T[1];return(0,n.jsx)(P.Z.Item,{color:R==="human"?"blue":"green",children:(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,n.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:R}),(0,n.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:je.value})]})},F)})})]})]}):null})})})})},13085:function(la,De,a){a.d(De,{Z:function(){return va}});var Le=a(19632),W=a.n(Le),Ie=a(97857),re=a.n(Ie),we=a(15009),g=a.n(we),Ne=a(99289),C=a.n(Ne),Te=a(5574),w=a.n(Te),le=a(13769),ge=a.n(le),K=a(11551),m=a(67294),Y=a(74330),z=a(35312),e=a(85893),P=function(o){var v=o.children,h=o.onLoadMore,j=o.onLoadPrevious,y=o.hasMore,Z=o.hasPrevious,L=Z===void 0?!1:Z,$=o.threshold,U=$===void 0?100:$,I=o.className,Fe=I===void 0?"":I,de=o.loadingComponent,te=de===void 0?(0,e.jsx)(Y.Z,{size:"small"}):de,be=o.errorComponent,He=o.initialScrollPosition,Ve=He===void 0?"bottom":He,Ge=o.preserveScrollPosition,Oe=Ge===void 0?!0:Ge,ze=o.scrollBehavior,Je=ze===void 0?"smooth":ze,ia=(0,z.useIntl)(),H=(0,m.useRef)(null),Ye=(0,m.useState)(!1),Re=w()(Ye,2),Ze=Re[0],Ue=Re[1],Qe=(0,m.useState)(!1),Ae=w()(Qe,2),Me=Ae[0],Be=Ae[1],Xe=(0,m.useState)(null),$e=w()(Xe,2),ye=$e[0],qe=$e[1],ue=(0,m.useRef)(!1),We=(0,m.useRef)(!0),oa=function(){H.current&&(H.current.scrollTop=H.current.scrollHeight)};(0,m.useEffect)(function(){We.current&&H.current&&(H.current.scrollTop=H.current.scrollHeight,We.current=!1)},[]),(0,m.useEffect)(function(){var p=H.current;if(p){var Pe=function(){var x=C()(g()().mark(function q(){var se,J,ea,aa,Ee;return g()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!ue.current){b.next=2;break}return b.abrupt("return");case 2:if(se=p.scrollTop,J=p.scrollHeight,ea=p.clientHeight,!(L&&!Me&&se<U)){b.next=16;break}return b.prev=4,ue.current=!0,Be(!0),aa=p.scrollHeight,Ee=p.scrollTop,b.next=11,j==null?void 0:j();case 11:requestAnimationFrame(function(){var da=p.scrollHeight,ta=da-aa;p.scrollTop=Ee+ta});case 12:return b.prev=12,ue.current=!1,Be(!1),b.finish(12);case 16:if(!(y&&!Ze&&J-se-ea<U)){b.next=27;break}return b.prev=17,ue.current=!0,Ue(!0),b.next=22,h==null?void 0:h();case 22:p.scrollTop=p.scrollHeight;case 23:return b.prev=23,ue.current=!1,Ue(!1),b.finish(23);case 27:case"end":return b.stop()}},q,null,[[4,,12,16],[17,,23,27]])}));return function(){return x.apply(this,arguments)}}(),ce=Ke(Pe,150);return p.addEventListener("scroll",ce),function(){return p.removeEventListener("scroll",ce)}}},[y,L,h,j,U,Ze,Me]);function Ke(p,Pe){var ce;return function(){for(var x=this,q=arguments.length,se=new Array(q),J=0;J<q;J++)se[J]=arguments[J];clearTimeout(ce),ce=setTimeout(function(){return p.apply(x,se)},Pe)}}return(0,e.jsxs)("div",{ref:H,className:"relative overflow-y-auto ".concat(Fe),children:[(0,e.jsxs)("div",{className:"flex flex-col-reverse min-h-full",children:[Me&&(0,e.jsx)("div",{className:"sticky top-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:te}),v,Ze&&(0,e.jsx)("div",{className:"sticky bottom-0 left-0 right-0 flex justify-center py-2 bg-white/80 z-10",children:te})]}),ye&&(0,e.jsx)("div",{className:"sticky top-0 w-full text-center py-2 text-red-500",children:be||ye.message})]})},Q=P,ee=a(27522),ne=a(77295),fe=a(39944),n=a(55927),k=a(69753),N=a(82114),ie=a(97245),oe=a(27496),M=a(82061),Se=a(88484),D=a(34994),he=a(90672),_e=a(64317),Ce=a(77598),X=a(55060),A=a(28036),d=a(45360),B=a(85576),V=a(66309),pe=a(83062),xe=a(22683),O=a(97807),F=["node"],T=["node"],R=function(o,v){try{var h=document.createElement("a");h.href=o,h.download=v,h.target="_blank",document.body.appendChild(h),h.click(),document.body.removeChild(h)}catch(j){}},je=(0,m.memo)(function(s){var o=s.message;return(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsxs)("div",{className:"max-w-[70%] rounded-lg p-3 bg-blue-100 text-blue-900",children:[o.file_list&&o.file_list.length>0&&(0,e.jsx)(ee.Z,{fileList:o.file_list,onDownload:R}),(0,e.jsx)(xe.U,{components:{img:function(h){var j=h.node,y=ge()(h,F);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(X.Z,{src:y.src,alt:y.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(A.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(k.Z,{}),onClick:function(L){L.stopPropagation(),R(y.src||"",y.alt||"image.png")}})})]})}},rehypePlugins:[O.Z],children:o.message})]})})}),na=(0,m.memo)(function(s){var o,v=s.message,h=s.detailList,j=s.abilitiesList,y=(0,z.useIntl)(),Z=j==null?void 0:j.find(function(L){return L.value===v.ability_id});return(0,e.jsx)("div",{className:"flex justify-start pb-4",children:(0,e.jsxs)("div",{className:"max-w-full",children:[(0,e.jsxs)("div",{className:"text-sm font-bold mb-2",children:[h==null||(o=h.app)===null||o===void 0?void 0:o.name," ",(Z==null?void 0:Z.label)&&(0,e.jsxs)("span",{className:"text-gray-500 font-normal text-xs",children:["(",Z==null?void 0:Z.label,")"]})]}),(0,e.jsxs)("div",{className:"max-w-[90%] rounded-lg  relative bg-white text-gray-900 border border-gray-200",children:[v.file_list&&v.file_list.length>0&&(0,e.jsx)("div",{className:"p-3 border-b border-gray-100",children:(0,e.jsx)(ee.Z,{fileList:v.file_list,onDownload:R})}),v.message&&(0,e.jsx)("div",{className:"p-3 child  max-w-full [&_p]:mb-0 [&_div]:max-w-full break-words",children:(0,e.jsx)(X.Z.PreviewGroup,{children:(0,e.jsx)(xe.U,{components:{img:function($){var U=$.node,I=ge()($,T);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(X.Z,{src:I.src,alt:I.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(A.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(k.Z,{}),onClick:function(de){de.stopPropagation(),R(I.src||"",I.alt||"image.png")}})})]})}},rehypePlugins:[O.Z],children:v.message})})}),v.error&&(0,e.jsxs)("div",{className:"p-3 text-red-500",children:[(0,e.jsx)("div",{children:y.formatMessage({id:"agent.chat.error.message"})}),v.error]}),(0,e.jsx)("div",{className:"absolute w-full mt-1",children:(0,e.jsxs)("div",{className:"text-xs text-gray-500 flex justify-between",children:[(0,e.jsx)("div",{children:v.created_time}),(0,e.jsx)("div",{})]})})]})]})})}),ae=(0,m.memo)(function(s){var o,v=s.detailList,h=(0,z.useIntl)();return(0,e.jsx)("div",{className:"flex justify-start pb-4 max-w-[90%] min-w-[70%]",children:(0,e.jsxs)("div",{className:"max-w-full",children:[(0,e.jsx)("div",{className:"text-sm font-bold mb-2",children:v==null||(o=v.app)===null||o===void 0?void 0:o.name}),(0,e.jsx)("div",{className:"max-w-[90%] min-w-[200px] rounded-lg relative bg-white text-gray-900 border border-gray-200 p-4",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 pr-4",children:[(0,e.jsx)(Y.Z,{size:"small"}),(0,e.jsx)("span",{className:"text-gray-500",children:h.formatMessage({id:"agent.chat.waiting"})})]})})]})})}),va=(0,m.memo)(function(s){var o,v,h,j,y,Z,L,$,U,I,Fe=(0,m.useState)([]),de=w()(Fe,2),te=de[0],be=de[1],He=(0,m.useState)(!0),Ve=w()(He,2),Ge=Ve[0],Oe=Ve[1],ze=(0,m.useState)(1),Je=w()(ze,2),ia=Je[0],H=Je[1],Ye=(0,m.useState)(!1),Re=w()(Ye,2),Ze=Re[0],Ue=Re[1],Qe=(0,m.useState)(!1),Ae=w()(Qe,2),Me=Ae[0],Be=Ae[1],Xe=(0,m.useState)(!1),$e=w()(Xe,2),ye=$e[0],qe=$e[1],ue=(0,m.useState)(!1),We=w()(ue,2),oa=We[0],Ke=We[1],p=(0,m.useRef)(),Pe=(0,m.useRef)(null),ce=(0,m.useRef)(null),x=(0,z.useIntl)(),q=(0,n.Z)(function(t){return t.getTypedMessages("chat_message_llm_return")}),se=(0,m.useState)("list"),J=w()(se,2),ea=J[0],aa=J[1],Ee=(0,n.Z)(function(t){return t.getTypedLastMessage("chat_message_llm_return")}),me=(0,ne.ZP)(),b=me.uploadedFiles,da=me.setUploadedFiles,ta=me.handleUpload,ga=me.removeFile,fa=me.clearFiles,ya=me.isUploading,sa=function(){var l;(l=Pe.current)===null||l===void 0||l.scrollIntoView({behavior:"smooth"})},ua=function(){var t=C()(g()().mark(function l(){var r,u,c;return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(s!=null&&(r=s.saveInfo)!==null&&r!==void 0&&r.firstjudgingcondition())){i.next=4;break}return i.abrupt("return",!0);case 4:if(!(s!=null&&(u=s.saveInfo)!==null&&u!==void 0&&u.secondjudgingcondition())){i.next=8;break}return i.abrupt("return",!0);case 8:return i.next=10,s==null||(c=s.saveInfo)===null||c===void 0?void 0:c.agentupdata();case 10:return i.abrupt("return",i.sent);case 11:case"end":return i.stop()}},l)}));return function(){return t.apply(this,arguments)}}();(0,Ce.Z)(function(){var t,l=Ee==null?void 0:Ee.data;if(l&&!((l==null?void 0:l.agent_id)!==((t=s.data)===null||t===void 0||(t=t.detailList)===null||t===void 0||(t=t.agent)===null||t===void 0?void 0:t.agent_id)&&!d.ZP.error)){var r=re()(re()({},l),{},{id:l.message_id});q&&q.length>0&&(Ke(!1),be(function(u){return[].concat(W()(u),[r])}),setTimeout(sa,100))}},[q]),(0,m.useEffect)(function(){var t;(t=s.data)!==null&&t!==void 0&&(t=t.detailList)!==null&&t!==void 0&&(t=t.agent)!==null&&t!==void 0&&t.agent_id&&_a()},[(o=s.data)===null||o===void 0||(o=o.detailList)===null||o===void 0||(o=o.agent)===null||o===void 0?void 0:o.agent_id]),(0,m.useEffect)(function(){!ye&&te.length>0&&sa()},[ye]);var ha=function(){var t=C()(g()().mark(function l(r){var u,c,f,i,_,E,ke,S,ra,ma;return g()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(console.log(r),i=(u=p.current)===null||u===void 0?void 0:u.getFieldsValue(),!(!i||!((c=r.content)!==null&&c!==void 0&&c.trim()))){G.next=4;break}return G.abrupt("return");case 4:return _=s.data.detailList.agent.agent_id,E=s.data.detailList.agent.input_variables,ke=i.ability_id,S=new fe.z({user:{value:i.content}}),ra=b.map(function(ve){return{name:ve.name,url:ve.url||ve.path_show||""}}),ma={id:Date.now(),content:r.content,isUser:!0,ability_id:ke,agent_id:_,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:i.content,prompt_tokens:0,total_tokens:0,file_list:ra.length>0?ra:void 0},Ke(!0),be(function(ve){return[].concat(W()(ve),[ma])}),(f=p.current)===null||f===void 0||f.resetFields(["content"]),G.prev=13,G.next=16,(0,K.CY)({agent_id:_,input_dict:E,ability_id:ke,prompt:S,file_list:b.map(function(ve){return ve.file_id})});case 16:fa(),G.next=23;break;case 19:G.prev=19,G.t0=G.catch(13),Ke(!1),d.ZP.error("\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 23:setTimeout(sa,100);case 24:case"end":return G.stop()}},l,null,[[13,19]])}));return function(r){return t.apply(this,arguments)}}(),_a=function(){var t=C()(g()().mark(function l(){var r,u,c;return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if((r=s.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,qe(!0),i.next=6,(0,K.CU)(String(s.data.detailList.agent.agent_id),1);case 6:c=i.sent,(u=c.data)!==null&&u!==void 0&&u.list&&(be(c.data.list),Oe(c.data.total_pages>1),H(1)),i.next=13;break;case 10:i.prev=10,i.t0=i.catch(2),console.error("Failed to fetch initial messages:",i.t0);case 13:return i.prev=13,qe(!1),i.finish(13);case 16:case"end":return i.stop()}},l,null,[[2,10,13,16]])}));return function(){return t.apply(this,arguments)}}(),pa=function(){var t=C()(g()().mark(function l(){var r,u,c,f;return g()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(Ze||!((r=s.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id))){_.next=2;break}return _.abrupt("return");case 2:return _.prev=2,Ue(!0),c=ia+1,_.next=7,(0,K.CU)(String(s.data.detailList.agent.agent_id),c);case 7:f=_.sent,((u=f.data)===null||u===void 0||(u=u.list)===null||u===void 0?void 0:u.length)>0?(be(function(E){return[].concat(W()(f.data.list),W()(E))}),H(c),Oe(c<f.data.total_pages)):Oe(!1),_.next=15;break;case 11:_.prev=11,_.t0=_.catch(2),console.error("Failed to load more messages:",_.t0),Oe(!1);case 15:return _.prev=15,Ue(!1),_.finish(15);case 18:case"end":return _.stop()}},l,null,[[2,11,15,18]])}));return function(){return t.apply(this,arguments)}}(),xa=function(){var t=C()(g()().mark(function l(){var r;return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(!((r=s.data)!==null&&r!==void 0&&(r=r.detailList)!==null&&r!==void 0&&(r=r.agent)!==null&&r!==void 0&&r.agent_id)||Me||!te.length)){c.next=2;break}return c.abrupt("return");case 2:B.Z.confirm({title:x.formatMessage({id:"agent.chat.clear.memory.confirm.title"}),icon:(0,e.jsx)(N.Z,{}),content:x.formatMessage({id:"agent.chat.clear.memory.confirm.content"}),okText:x.formatMessage({id:"agent.chat.clear.memory.confirm.ok"}),cancelText:x.formatMessage({id:"agent.chat.clear.memory.confirm.cancel"}),onOk:function(){var f=C()(g()().mark(function _(){var E;return g()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,Be(!0),E=te[te.length-1].id,S.next=5,(0,K.Nj)(String(s.data.detailList.agent.agent_id),E);case 5:d.ZP.success(x.formatMessage({id:"agent.chat.clear.memory.success"})),S.next=11;break;case 8:S.prev=8,S.t0=S.catch(0),console.error("Failed to clear context memory:",S.t0);case 11:return S.prev=11,Be(!1),S.finish(11);case 14:case"end":return S.stop()}},_,null,[[0,8,11,14]])}));function i(){return f.apply(this,arguments)}return i}()});case 3:case"end":return c.stop()}},l)}));return function(){return t.apply(this,arguments)}}(),ja=function(){return(0,e.jsxs)("div",{className:"flex items-center justify-center py-2 bg-white/80",children:[(0,e.jsx)(Y.Z,{size:"small"}),(0,e.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:x.formatMessage({id:"agent.chat.loading.more"})})]})};if(ye)return(0,e.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,e.jsx)(Y.Z,{})});var ba=function(){var t=C()(g()().mark(function l(){return g()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,ua();case 2:setTimeout(C()(g()().mark(function c(){var f,i;return g()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,K.Dh)((f=s.data)===null||f===void 0||(f=f.detailList)===null||f===void 0||(f=f.agent)===null||f===void 0?void 0:f.agent_id);case 2:i=E.sent,i.code==0?d.ZP.success(x.formatMessage({id:"agent.message.success.publish"})):d.ZP.error(x.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return E.stop()}},c)})),500);case 3:case"end":return u.stop()}},l)}));return function(){return t.apply(this,arguments)}}(),Ma=function(){var l;if(!((l=s.data)!==null&&l!==void 0&&(l=l.detailList)!==null&&l!==void 0&&(l=l.agent)!==null&&l!==void 0&&l.agent_id)){d.ZP.error(x.formatMessage({id:"agent.chat.error.message"}));return}ta()},ca=function(){var t=C()(g()().mark(function l(){var r,u,c,f,i;return g()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return f=((r=p.current)===null||r===void 0?void 0:r.getFieldValue("content"))||"",i=f,(u=p.current)===null||u===void 0||u.setFieldsValue({content:i}),E.next=5,(c=p.current)===null||c===void 0?void 0:c.submit();case 5:case"end":return E.stop()}},l)}));return function(){return t.apply(this,arguments)}}();return(0,e.jsx)("div",{className:"!h-[calc(100vh-65px)] p-4 !pb-0 box-border",style:{height:"calc(100vh - 65px)"},children:(0,e.jsxs)(D.A,{formRef:p,submitter:!1,onFinish:ha,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto ",children:[(0,e.jsxs)("div",{className:"pb-4 flex gap-[10px] ",style:{paddingBottom:"16px"},children:[(0,e.jsx)("div",{className:"flex-1 flex items-center font-bold text-base",children:(v=s.data)===null||v===void 0||(v=v.detailList)===null||v===void 0||(v=v.app)===null||v===void 0?void 0:v.name}),s.operationbentate=="false"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.ZP,{type:"primary",disabled:s.operationbentate!="false",onClick:ua,className:"min-w-24",children:x.formatMessage({id:"agent.btn.savedebug"})}),(0,e.jsx)(A.ZP,{type:"primary",disabled:s.operationbentate!="false",onClick:ba,className:"min-w-24",children:x.formatMessage({id:"agent.publish"})})]})]}),(0,e.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#ccc] flex-1 overflow-y-auto flex flex-col",children:[(0,e.jsx)("div",{className:"flex-1 overflow-y-auto ",ref:ce,children:(0,e.jsx)(Q,{className:"h-full",onLoadPrevious:pa,hasPrevious:Ge,hasMore:!1,threshold:50,loadingComponent:(0,e.jsx)(ja,{}),children:(0,e.jsxs)("div",{className:"px-4 py-2 space-y-4",children:[te.map(function(t){var l,r;return t.agent_run_id===0?(0,e.jsx)(je,{message:t},t.id):(0,e.jsx)(na,{detailList:s==null||(l=s.data)===null||l===void 0?void 0:l.detailList,abilitiesList:s==null||(r=s.data)===null||r===void 0?void 0:r.abilitiesList,message:t},t.id)}),oa&&(0,e.jsx)(ae,{detailList:s==null||(h=s.data)===null||h===void 0?void 0:h.detailList}),(0,e.jsx)("div",{ref:Pe})]})})}),(0,e.jsxs)("div",{className:"border-t border-gray-200 bg-white px-4 py-2 relative",children:[(0,e.jsx)(X.Z.PreviewGroup,{children:b.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map(function(t){return(0,e.jsx)(V.Z,{closable:!0,onClose:function(){return ga(t.uid)},className:"flex items-center ".concat(t.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(pe.Z,{title:t.name,children:(0,e.jsx)("div",{className:"flex items-center",children:t.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(X.Z,{src:t.path_show||t.url,alt:t.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:t.path_show||t.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:t.name}),(0,e.jsx)(k.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(r){r.stopPropagation(),R(t.path_show||t.url,t.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(ie.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:t.name}),(0,e.jsx)(k.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(r){r.stopPropagation(),R(t.path_show||t.url,t.name)}})]})})})},t.uid)})})})}),(0,e.jsxs)("div",{className:"flex items-center p-[8px] gap-[10px] box-border border bg-white rounded-[8px]",children:[(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)(he.Z,{name:"content",placeholder:x.formatMessage({id:"agent.chat.input.placeholder"}),disabled:(s==null||(j=s.data)===null||j===void 0||(j=j.detailList)===null||j===void 0||(j=j.agent)===null||j===void 0?void 0:j.agent_id)==0,fieldProps:{autoSize:{minRows:1,maxRows:4},variant:"borderless",onPressEnter:function(l){l.shiftKey||(l.preventDefault(),ca())},size:"small",className:"",title:x.formatMessage({id:"agent.chat.input.shift.enter"})},formItemProps:{className:"mb-0"},className:"mb-0"})}),(0,e.jsx)(A.ZP,{onClick:ca,type:"primary",disabled:(s==null||(y=s.data)===null||y===void 0||(y=y.detailList)===null||y===void 0||(y=y.agent)===null||y===void 0?void 0:y.agent_id)==0,className:"min-w-[30px] h-[30px] flex items-center justify-center cursor-pointer rounded-[6px]",icon:(0,e.jsx)(oe.Z,{}),title:x.formatMessage({id:"agent.chat.send"})})]}),(0,e.jsxs)("div",{className:"flex items-center mt-1 gap-2",children:[(0,e.jsx)(_e.Z,{name:"ability_id",options:((Z=s.data)===null||Z===void 0?void 0:Z.abilitiesList)||[{value:0,label:x.formatMessage({id:"agent.allability"})}],fieldProps:{placeholder:x.formatMessage({id:"agent.pleaseselect"}),size:"small"},disabled:(s==null||(L=s.data)===null||L===void 0||(L=L.detailList)===null||L===void 0||(L=L.agent)===null||L===void 0?void 0:L.agent_id)==0||!(($=s.data)!==null&&$!==void 0&&($=$.abilitiesList)!==null&&$!==void 0&&$.length),formItemProps:{className:"mb-0"}}),(0,e.jsx)(A.ZP,{icon:(0,e.jsx)(M.Z,{}),disabled:(s==null||(U=s.data)===null||U===void 0||(U=U.detailList)===null||U===void 0||(U=U.agent)===null||U===void 0?void 0:U.agent_id)==0,loading:Me,onClick:xa,size:"small",children:x.formatMessage({id:"agent.chat.clear.memory"})}),(0,e.jsx)(A.ZP,{icon:(0,e.jsx)(Se.Z,{}),disabled:(s==null||(I=s.data)===null||I===void 0||(I=I.detailList)===null||I===void 0||(I=I.agent)===null||I===void 0?void 0:I.agent_id)==0,onClick:Ma,size:"small",children:x.formatMessage({id:"agent.chat.upload.file"})})]})]})]})]})})})},27842:function(la,De,a){var Le=a(5574),W=a.n(Le),Ie=a(15009),re=a.n(Ie),we=a(99289),g=a.n(we),Ne=a(11551),C=a(29608),Te=a(32592),w=a(35312),le=a(67294),ge=a(85422),K=a(85893),m=null,Y=null;De.ZP=function(z){var e=z.agent_id,P=(0,w.useIntl)(),Q=(0,w.useSearchParams)(),ee=W()(Q,1),ne=ee[0],fe=(0,le.useRef)(null),n=(0,le.useState)(null),k=W()(n,2),N=k[0],ie=k[1],oe=(0,le.useState)(!1),M=W()(oe,2),Se=M[0],D=M[1],he=ne.get("app_id"),_e=function(){D(!1)},Ce=function(B){ie({app_id:he,app_run_id:B.id}),D(!0)},X=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:P.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:P.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:P.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:P.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:P.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:P.formatMessage({id:"workflow.created_time_des",defaultMessage:P.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(P.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:P.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:P.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],A=(0,C.Z)(function(d){return d.setRunPanelLogRecord});return(0,K.jsxs)("div",{className:"h-full",children:[(0,K.jsx)(Te.Z,{columns:X,formRef:fe,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var d=g()(re()().mark(function B(V,pe,xe){var O;return re()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return console.log(V,pe,xe),T.next=3,(0,Ne.My)(he,{page:V.current,page_size:V.pageSize});case 3:return O=T.sent,console.log(O),T.abrupt("return",{data:O.data.list,success:!0,total:O.data.total_count});case 6:case"end":return T.stop()}},B)}));return function(B,V,pe){return d.apply(this,arguments)}}(),onRow:function(B){return{onClick:function(){Ce(B)},className:(N==null?void 0:N.app_run_id)===B.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:P.formatMessage({id:"agent.log.list"})}),Se&&(N==null?void 0:N.app_id)&&(N==null?void 0:N.app_run_id)&&(0,K.jsx)(ge.Z,{data:N,onClose:_e})]})}}}]);
