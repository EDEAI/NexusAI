"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[178],{83510:function(St,De,s){s.d(De,{LK:function(){return ve},bs:function(){return Ge},go:function(){return Fe},uy:function(){return ze}});var Be=s(15009),j=s.n(Be),Oe=s(99289),B=s.n(Oe),se=s(47520),t="/v1/apps/apps_list",Le="/v1/agent/agent_delete/",h="/v1/workflow/workflow_app_delete/",R="/v1/vector/delete_dataset/",Re="/v1/skill/delete_skill_by_app_id/",$e="/v1/apps/apps_create",ke="/v1/apps/app_update/",Fe=function(){var ne=B()(j()().mark(function $(M){var C;return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,se.ZP)("".concat(t),{method:"GET",data:M});case 2:return C=n.sent,n.abrupt("return",C);case 4:case"end":return n.stop()}},$)}));return function(M){return ne.apply(this,arguments)}}(),ve=function(){var ne=B()(j()().mark(function $(M){var C;return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(M),n.next=3,M.mode;case 3:if(n.t0=n.sent,n.t0!=1){n.next=8;break}n.t1=(0,se.ZP)("".concat(Le).concat(M.app_id),{method:"DELETE"}),n.next=9;break;case 8:n.t1=M.mode==2?(0,se.ZP)("".concat(h).concat(M.app_id),{method:"DELETE"}):M.mode==3?(0,se.ZP)("".concat(R).concat(M.app_id),{method:"DELETE"}):(0,se.ZP)("".concat(Re).concat(M.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return C=n.t1,n.abrupt("return",C);case 11:case"end":return n.stop()}},$)}));return function(M){return ne.apply(this,arguments)}}(),ze=function(){var ne=B()(j()().mark(function $(M){var C;return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,se.ZP)("".concat($e),{method:"POST",data:M});case 2:return C=n.sent,n.abrupt("return",C);case 4:case"end":return n.stop()}},$)}));return function(M){return ne.apply(this,arguments)}}(),Ge=function(){var ne=B()(j()().mark(function $(M){var C;return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,se.ZP)("".concat(ke).concat(M.app_id),{method:"PUT",data:M});case 2:return C=n.sent,n.abrupt("return",C);case 4:case"end":return n.stop()}},$)}));return function(M){return ne.apply(this,arguments)}}()},48528:function(St,De,s){s.r(De),s.d(De,{default:function(){return ea}});var Be=s(15009),j=s.n(Be),Oe=s(99289),B=s.n(Oe),se=s(97857),t=s.n(se),Le=s(5574),h=s.n(Le),R=s(11551),Re=s(83510),$e=s(47520),ke=s(29432),Fe=s(10759),ve=s(32332),ze=s(2068),Ge=s(89035),ne=s(15360),$=s(82826),M=s(69243),C=s(35312),y=s(40741),n=s(45360),xe=s(28036),Nt=s(50136),Ue=s(25409),Xe=s(74330),p=s(67294),be=s(92939),Mt=s(5608),Zt=s(64599),Pt=s.n(Zt),At=s(73445),Ct=s(42237),Ee=(0,At.Ue)(function(ie){return{models:[],loading:!1,error:null,initialized:!1,fetchModels:function(){var i=B()(j()().mark(function u(){var w;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,ie({loading:!0}),a.next=4,(0,Ct.fZ)();case 4:if(w=a.sent,w.code!==0){a.next=9;break}ie({models:Array.isArray(w.data.data)?w.data.data:[],initialized:!0}),a.next=10;break;case 9:throw new Error(w.message||"Failed to fetch models");case 10:a.next=16;break;case 12:a.prev=12,a.t0=a.catch(0),ie({error:a.t0.message}),n.ZP.error("Failed to fetch models");case 16:return a.prev=16,ie({loading:!1}),a.finish(16);case 19:case"end":return a.stop()}},u,null,[[0,12,16,19]])}));function O(){return i.apply(this,arguments)}return O}()}}),Dt=function(){var i=Ee(function(a){return a.models}),O=Ee(function(a){return a.loading}),u=Ee(function(a){return a.initialized}),w=Ee(function(a){return a.fetchModels});(0,p.useEffect)(function(){u||w()},[u,w]);var ce=(0,p.useMemo)(function(){var a=Array.isArray(i)?i:[],S=a.map(function(c){return{label:c.supplier_name,options:Array.isArray(c.model_list)?c.model_list.map(function(Q){return{label:Q.model_name,value:Q.model_config_id}}):[]}}),z,W=Pt()(a),re;try{for(W.s();!(re=W.n()).done;){var J=re.value;if(Array.isArray(J.model_list)){var v=J.model_list.find(function(c){return c.model_default_used===1});if(v){z=v.model_config_id;break}}}}catch(c){W.e(c)}finally{W.f()}return{options:S,defaultValue:z}},[i]);return t()(t()({},ce),{},{loading:O})},ye=s(26915),Se=s(72269),Ke=s(34041),K=s(78045),e=s(85893),kt=ye.Z.TextArea,Et=function(i){var O,u,w,ce=i.FirstValue,a=i.Detaillist,S=i.setDetaillist,z=i.repository,W=i.setRepository,re=i.Operationbentate,J=i.Ffromref,v=i.setFourthly_config_id,c=i.Fourthly_config_id,Q=i.Fourthly_select_list,we=i.Newproperties,me=i.setNewproperties,q=i.pageKeyfun,fe=i.firstjudgingcondition,x=i.setAgentmunudisabled,X=i.agentmenudisabled,b=(0,C.useIntl)(),ge=(0,p.useState)([]),pe=h()(ge,2),le=pe[0],je=pe[1],H=(0,p.useState)({agent_id:0,data:{is_public:1,enable_api:0,obligations:null,input_variables:{},dataset_ids:[],attrs_are_visible:1}}),_=h()(H,2),Z=_[0],k=_[1];(0,p.useEffect)(function(){T()},[]);var G=function(f){v(f)},oe=function(f){k(t()(t()({},Z),{},{data:t()(t()({},Z.data),{},{obligations:f.target.value})})),S(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{obligations:f.target.value})}))},Ne=function(f,U){var L=new Set;return f.some(function(te){var ae=te[U];return L.has(ae)?L.add(ae):L.add(ae)&&!1})},Y=function(f){S(t()(t()({},a),{},{app:t()(t()({},a.app),{},{is_public:f?1:0})})),k(t()(t()({},Z),{},{data:t()(t()({},Z.data),{},{is_public:f?1:0})}))},ee=function(f){S(t()(t()({},a),{},{app:t()(t()({},a.app),{},{enable_api:f?1:0})})),k(t()(t()({},Z),{},{data:t()(t()({},Z.data),{},{enable_api:f?1:0})}))},Me=function(f){S(t()(t()({},a),{},{app:t()(t()({},a.app),{},{attrs_are_visible:f?1:0})})),k(t()(t()({},Z),{},{data:t()(t()({},Z.data),{},{attrs_are_visible:f?1:0})}))},Ze=function(f){S(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{allow_upload_file:f?1:0})}))},Pe=function(f){k(t()(t()({},Z),{},{data:t()(t()({},Z.data),{},{dataset_ids:f})})),W(f)},T=function(){var E=B()(j()().mark(function f(){var U;return j()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,(0,R.zl)();case 2:U=te.sent,je(U.data.data.map(function(ae){return{value:ae.dataset_id,label:ae.name}}));case 4:case"end":return te.stop()}},f)}));return function(){return E.apply(this,arguments)}}(),F=function(){var E=B()(j()().mark(function f(){return j()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:fe()||(q("2"),x(t()(t()({},X),{},{first:!1,second:!1})));case 1:case"end":return L.stop()}},f)}));return function(){return E.apply(this,arguments)}}(),N=function(f){S(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{default_output_format:f.target.value})}))},V=function(f){S(t()(t()({},a),{},{agent:t()(t()({},a.agent),{},{input_variables:f.free})}))},I=Dt(),P=I.options,he=I.defaultValue;return(0,e.jsxs)("div",{style:{height:"100%",width:"100%",marginBottom:"30px"},children:[(0,e.jsx)("div",{className:"flex align-center justify-between mt-[30px]",children:(0,e.jsx)("div",{className:"text-base font-medium mb-[30px] text-[#333333]",children:b.formatMessage({id:"agent.menu.basicsetup"})})}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(y.Z,{name:"dynamic_form_nest_item",style:{width:"100%"},autoComplete:"off",form:J,children:[(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:b.formatMessage({id:"agent.appname"})}),(0,e.jsxs)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:[(0,e.jsxs)("div",{children:[a&&a.app&&a.app.name,"\xA0"]}),(0,e.jsx)("div",{className:"",children:re==="true"?b.formatMessage({id:"agent.cannotmodify"}):""})]})]})}),(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"text-[#555555] text-xs",children:[(0,e.jsx)("div",{className:"font-medium  mb-[15px]",children:b.formatMessage({id:"agent.appdescription"})}),(0,e.jsx)("div",{className:"w-full p-[15px] flex font-normal items-center bg-[#F7F7F7] rounded-lg",children:a&&a.app&&a.app.description})]})}),(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",name:b.formatMessage({id:"agent.teamvisibility"}),title:b.formatMessage({id:"agent.explain.teamvisibility"})})}),(0,e.jsx)(Se.Z,{size:"small",onChange:Y,checked:!!(a&&a.app.is_public===1)})]}),(0,e.jsxs)("div",{className:"mb-[30px]  font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",name:b.formatMessage({id:"agent.attrVisible"}),title:b.formatMessage({id:"agent.explain.attrVisible"})})}),(0,e.jsx)(Se.Z,{size:"small",onChange:Me,checked:a&&a.app.attrs_are_visible===1})]}),(0,e.jsxs)("div",{className:"mb-[30px]  font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:b.formatMessage({id:"agent.APIswitch"})}),(0,e.jsx)(Se.Z,{size:"small",onChange:ee,checked:a&&a.app.enable_api===1,disabled:(a==null||(O=a.app)===null||O===void 0?void 0:O.publish_status)!==1})]}),(0,e.jsxs)("div",{className:"font-medium",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:b.formatMessage({id:"agent.filesupload"})}),(0,e.jsx)(Se.Z,{size:"small",onChange:Ze,checked:!!(a&&a.agent.allow_upload_file==1)})]})]})}),(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:[(0,e.jsx)("span",{className:"text-[#E80000]",children:"* "}),b.formatMessage({id:"agent.LLMmodel"})]}),(0,e.jsx)(Ke.Z,{placeholder:b.formatMessage({id:"agent.pleaseselect"}),style:{width:270},value:c==0?b.formatMessage({id:"agent.pleaseselect"}):c,variant:"filled",onChange:G,options:P})]})}),(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",name:"obligations",children:(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",required:!0,name:b.formatMessage({id:"agent.functiondescription"}),title:b.formatMessage({id:"agent.explain.function"})})}),(0,e.jsx)(kt,{onChange:oe,value:a&&a.agent&&a.agent.obligations,placeholder:"Agent".concat(b.formatMessage({id:"agent.functiondescription"})),autoSize:{minRows:8,maxRows:10}})]})}),(a==null||(u=a.agent)===null||u===void 0?void 0:u.input_variables)&&(0,e.jsx)("div",{className:"mb-[30px]",children:(0,e.jsx)(Mt.Z,{title:(0,e.jsx)("div",{className:"text-[#555555] text-xs",children:(0,e.jsx)(be.Z,{className:"font-medium",required:!0,name:b.formatMessage({id:"agent.inputvariable"}),title:b.formatMessage({id:"agent.explain.inputvariable"})})}),variables:Object.values((a==null||(w=a.agent)===null||w===void 0||(w=w.input_variables)===null||w===void 0?void 0:w.properties)||{}),onChange:V})}),(0,e.jsx)(y.Z.List,{name:"users",children:function(f,U){var L=U.add,te=U.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(y.Z.Item,{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs mb-[15px]",children:(0,e.jsx)(be.Z,{className:"font-medium",name:b.formatMessage({id:"agent.associatedknowledgebase"}),title:b.formatMessage({id:"agent.explain.associatedknowledgebase"})})}),(0,e.jsx)(Ke.Z,{size:"large",mode:"tags",style:{width:"100%"},placeholder:b.formatMessage({id:"agent.pleaseselect"}),value:z,onChange:Pe,options:le})]}),(0,e.jsx)(y.Z.Item,{className:"mb-[30px]",children:(0,e.jsxs)("div",{className:"",children:[(0,e.jsxs)("div",{className:"text-[#555555] text-xs mb-[15px]",children:[" ",b.formatMessage({id:"agent.defaultoutputformat"})]}),(0,e.jsxs)(K.ZP.Group,{value:a&&a.agent.default_output_format,onChange:function(Qe){N(Qe)},children:[(0,e.jsx)(K.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text"})}),(0,e.jsx)(K.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"json"})}),(0,e.jsx)(K.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})]})})]})}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(xe.ZP,{type:"primary",className:"mr-[20px]",onClick:function(){F()},children:b.formatMessage({id:"agent.btn.nextstep"})}),(0,e.jsx)(xe.ZP,{onClick:function(){history.back()},children:b.formatMessage({id:"agent.btn.back"})})]}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Tt=Et,It=s(13769),Ye=s.n(It),Vt=s(49677),Bt=s.n(Vt),Ot=s(92485),Lt=s(85877),Je=s(39944),Rt=s(71471),$t=["key","name"],Fa=Rt.Z.Title,wa=ye.Z.TextArea,Sa=ye.Z.Search,zt=function(i){var O=i.handleBack,u=i.Detaillist,w=i.setDetaillist,ce=i.Fourthly_select_list,a=i.setFourthly_config_id,S=i.Fourthly_config_id,z=i.Fourthlyref,W=i.Fourthly_abilities_list,re=i.Operationbentate,J=i.callwordlist,v=i.newagentid,c=(0,C.useIntl)(),Q=(0,p.useState)(0),we=h()(Q,2),me=we[0],q=we[1],fe=(0,p.useState)(""),x=h()(fe,2),X=x[0],b=x[1],ge=(0,p.useState)(""),pe=h()(ge,2),le=pe[0],je=pe[1],H=(0,p.useState)(!1),_=h()(H,2),Z=_[0],k=_[1],G=function(F){var N={user:{value:ee(F)}};b(new Je.z(N))},oe=function(F){var N={user:{value:F.target.value}};b(new Je.z(N))},Ne=function(F){q(F)},Y=function(F){var N=F.users.filter(function(P,he){return P.type=="number"&&!Number(P.value)&&!!P.value});if(!X.user)n.ZP.warning(c.formatMessage({id:"agent.message.warning.callword"}));else if(N.length>0)n.ZP.warning(c.formatMessage({id:"agent.message.warning.datatype"}));else{k(!0);var V=new Fe.Kr("input","","");F.users.forEach(function(P){var he=new Fe._w(P.name,P.type?P.type:"string",P.type=="string"?P.value:Number(P.value),P.content,P.status);V.addProperty(P.name,he)});var I={agent_id:v||u.agent.agent_id,ability_id:me,input_dict:V,prompt:X};Me(I)}},ee=function T(F){return F.map(function(N){return N.type==="mention"?N.id:N.children?T(N.children):N.text}).join("")},Me=function(F){(0,R.LH)(F).then(function(N){n.ZP.success(c.formatMessage({id:"agent.message.success.runpublish"})),je(N.data.outputs.text),k(!1)}).catch(function(N){k(!1)})},Ze=function(){var T=B()(j()().mark(function F(){var N;return j()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,R.Dh)(v||u.agent.agent_id);case 2:N=I.sent,N.code==0?n.ZP.success(c.formatMessage({id:"agent.message.success.publish"})):n.ZP.error(c.formatMessage({id:"agent.message.fail.publish"}));case 4:case"end":return I.stop()}},F)}));return function(){return T.apply(this,arguments)}}(),Pe=function(){var T=B()(j()().mark(function F(){return j()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:C.history.push("/Agents?app_id=".concat(u.app.app_id,"&type=false")),location.reload();case 2:case"end":return V.stop()}},F)}));return function(){return T.apply(this,arguments)}}();return(0,p.useEffect)(function(){},[]),(0,e.jsxs)("div",{style:{height:"100%"},children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:c.formatMessage({id:"agent.operationrun"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:c.formatMessage({id:"agent.selectivepower"})}),(0,e.jsx)(Ke.Z,{placeholder:c.formatMessage({id:"agent.pleaseselect"}),defaultValue:c.formatMessage({id:"agent.allability"}),style:{width:390,fontSize:"12px",color:"#BBBBBB",fontWeight:"400"},onChange:Ne,options:W})]}),(0,e.jsx)("div",{children:(0,e.jsxs)(y.Z,{name:"dynamic_form_nest_item",onFinish:Y,style:{width:"100%"},autoComplete:"off",form:z,children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:c.formatMessage({id:"agent.inputvariable"})}),(0,e.jsx)(y.Z.List,{name:"users",children:function(F,N){return Bt()(N),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"w-full flex justify-start items-center text-xs font-medium px-[10px] text-[#213044] h-12 bg-[#F7F7F7]  rounded-t-lg",children:[(0,e.jsx)("div",{className:"mr-5 ml-2.5",children:c.formatMessage({id:"agent.variable.name"})}),(0,e.jsx)("div",{className:"",children:c.formatMessage({id:"agent.variable.value"})})]}),(0,e.jsx)("div",{className:"mb-[30px]",children:F.map(function(V){var I=V.key,P=V.name,he=Ye()(V,$t);return(0,e.jsxs)("div",{className:"w-full h-20 flex justify-start  px-2.5 border-b border-x pt-7 last:rounded-b-lg",children:[(0,e.jsx)(y.Z.Item,t()(t()({},he),{},{name:[P,"content"],children:(0,e.jsx)(ye.Z,{className:"mr-5",style:{color:"#213044",fontWeight:"400",fontSize:"12px"},variant:"borderless",disabled:!0})})),(0,e.jsx)(y.Z.Item,t()(t()({},he),{},{name:[P,"value"],rules:[{required:!!(z.getFieldsValue()&&z.getFieldsValue().users[I].status==!0),message:c.formatMessage({id:"agent.rules.veriablevalue"})}],children:(0,e.jsx)(ye.Z,{placeholder:z.getFieldsValue()&&z.getFieldsValue().users[I].status==!0?c.formatMessage({id:"agent.variable.required.value"}):c.formatMessage({id:"agent.variable.value"})})}))]})})})]})}}),(0,e.jsxs)(y.Z.Item,{rules:[{required:!0,message:c.formatMessage({id:"agent.rules.callwordvalue"})}],children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:c.formatMessage({id:"agent.runpreview"})}),(0,e.jsx)(Xe.Z,{spinning:Z,children:(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-3.5 rounded-lg",children:[(0,e.jsx)("div",{className:"h-[345px] mb-[30px]",children:le?(0,e.jsx)(Ot.Z,{language:"python3",value:le&&JSON.stringify(le)}):null}),(0,e.jsxs)("div",{className:"agents-input p-2 bg-white border rounded-md my-2 flex items-center justify-between",style:{border:"1px solid #EEE"},children:[(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Lt.Z,{onChange:function(F){G(F)},options:J})}),(0,e.jsx)("div",{className:"w-8 h-8 bg-[#e8effc] rounded-md",children:(0,e.jsx)(xe.ZP,{className:"bg-[#e8effc]",icon:(0,e.jsx)("img",{src:"/icons/fs.svg"}),type:"link",htmlType:"submit",block:!0})})]})]})})]})]})}),(0,e.jsx)("div",{className:"w-28",children:(u==null?void 0:u.agent.publish_status)===1&&(u==null?void 0:u.is_creator)===1?(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"primary",htmlType:"submit",className:"w-full",onClick:Pe,children:c.formatMessage({id:"agent.amend"})})}):(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"primary",htmlType:"submit",className:"w-full",disabled:re!="false",onClick:Ze,children:c.formatMessage({id:"agent.publish"})})})}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})},Gt=zt,Ut=s(51042),Kt=s(82061),Wt=["key","name"],Ht=ye.Z.TextArea,Xt=function(i){var O=i.SecondValue,u=i.handleBack,w=i.Detaillist,ce=i.setDetaillist,a=i.Sformref,S=i.Operationbentate,z=i.pageKeyfun,W=i.secondjudgingcondition,re=i.SkillMenuClick,J=i.agentupdata,v=(0,C.useIntl)(),c=n.ZP.useMessage(),Q=h()(c,2),we=Q[0],me=Q[1],q=(0,p.useRef)(null),fe=(0,p.useState)({auto_match_ability:0,agent_abilities:[{agent_ability_id:0,name:"string",content:"string",status:0}]}),x=h()(fe,2),X=x[0],b=x[1];(0,p.useEffect)(function(){});var ge=function(_){if(_.users.length==1&&(!_.users[0].content&&_.users[0].name||_.users[0].content&&!_.users[0].name))return n.ZP.warning(v.formatMessage({id:"agent.message.warning.selectknowledgebase"}));var Z=_.users.map(function(G){return t()(t()({},G),{},{status:G.status?1:2,agent_ability_id:G.agent_ability_id?G.agent_ability_id:0})}),k={agent_id:w.agent.agent_id,data:{auto_match_ability:w.agent.auto_match_ability,agent_abilities:_.users.length==1&&!_.users[0].content&&!_.users[0].name?[]:Z}};S=="false"&&pe(),O(t()({},X))},pe=function(){var H=B()(j()().mark(function _(){return j()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:W()||J();case 1:case"end":return k.stop()}},_)}));return function(){return H.apply(this,arguments)}}(),le=function(_){ce(t()(t()({},w),{},{agent:t()(t()({},w.agent),{},{auto_match_ability:_?1:0})}))},je=function(){setTimeout(function(){q.current&&q.current.scrollTo({top:q.current.scrollHeight,behavior:"smooth"})},100)};return(0,e.jsxs)("div",{style:{height:"100%"},className:"w-full flex-1 sticky top-0",children:[(0,e.jsx)("div",{className:"text-base font-medium text-[#333333] my-[30px]",children:v.formatMessage({id:"agent.Applicationcapabilitysetting"})}),(0,e.jsxs)("div",{className:"mb-[30px]",children:[(0,e.jsx)("div",{className:"mb-[15px] text-[#555555] text-xs font-medium",children:(0,e.jsx)(be.Z,{name:v.formatMessage({id:"agent.automatch"}),title:v.formatMessage({id:"agent.explain.automatch"})})}),(0,e.jsx)(Se.Z,{size:"small",checked:!!(w&&w.agent.auto_match_ability==1),onChange:le})]}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsxs)(y.Z,{name:"dynamic_form_nest_item",onFinish:ge,style:{width:"100%"},autoComplete:"off",form:a,children:[(0,e.jsx)(y.Z.List,{name:"users",children:function(_,Z){var k=Z.add,G=Z.remove;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"w-full flex items-center justify-between mb-[11px]",children:[(0,e.jsx)("div",{className:" text-[#555555] text-xs font-medium",children:v.formatMessage({id:"agent.capability"})}),(0,e.jsx)("div",{children:(0,e.jsx)(xe.ZP,{type:"link",onClick:function(){k(),je()},block:!0,icon:(0,e.jsx)(Ut.Z,{}),children:v.formatMessage({id:"agent.add"})})})]}),(0,e.jsx)("div",{style:{height:"calc(100vh - 206px)",overflowY:"auto"},className:"overflow-y-auto",ref:q,children:_.map(function(oe){var Ne=oe.key,Y=oe.name,ee=Ye()(oe,Wt);return(0,e.jsxs)("div",{className:"bg-[#F7F7F7] p-[15px] rounded-lg mb-[20px]",children:[(0,e.jsx)(y.Z.Item,{className:"mb-0",children:(0,e.jsxs)("div",{className:"w-full flex justify-between items-center mb-[15px]",children:[(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium",children:v.formatMessage({id:"agent.capabilityname"})}),(0,e.jsxs)("div",{children:[" ",(0,e.jsx)(Kt.Z,{onClick:function(){return G(Y)}})]})]})}),(0,e.jsx)(y.Z.Item,t()(t()({className:"mb-[20px]"},ee),{},{name:[Y,"name"],rules:[{required:_.length!==1,message:v.formatMessage({id:"agent.capabilityname"})}],children:(0,e.jsx)(ye.Z,{placeholder:v.formatMessage({id:"agent.capabilityname"}),maxLength:50,className:"w-full"})})),(0,e.jsx)("div",{className:"mb-[15px]",children:(0,e.jsx)(be.Z,{className:"text-[#555555] text-xs font-medium",name:v.formatMessage({id:"agent.capabilitydescription"}),title:v.formatMessage({id:"agent.explain.capabilitydescription"})})}),(0,e.jsx)(y.Z.Item,t()(t()({className:"w-full mb-[20px]"},ee),{},{name:[Y,"content"],rules:[{required:_.length!==1,message:v.formatMessage({id:"agent.capabilitydescription"})}],children:(0,e.jsx)(Ht,{placeholder:v.formatMessage({id:"agent.capabilitydescription"}),autoSize:{minRows:3,maxRows:10},className:"w-full"})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[15px]",children:v.formatMessage({id:"agent.capabilitystatus"})}),(0,e.jsx)(y.Z.Item,t()(t()({className:"mb-[20px]"},ee),{},{name:[Y,"status"],children:(0,e.jsxs)(K.ZP.Group,{optionType:"button",buttonStyle:"solid",defaultValue:!0,children:[(0,e.jsx)(K.ZP,{value:!0,children:v.formatMessage({id:"agent.capabilitystatus.enable"})}),(0,e.jsx)(K.ZP,{value:!1,children:v.formatMessage({id:"agent.capabilitystatus.disable"})})]})})),(0,e.jsx)("div",{className:"text-[#555555] text-xs font-medium mb-[11px]",children:v.formatMessage({id:"agent.enableall"})}),(0,e.jsx)(y.Z.Item,{className:"mb-0",name:[Y,"output_format"],children:(0,e.jsxs)(K.ZP.Group,{defaultValue:0,children:[(0,e.jsx)(K.ZP,{value:0,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:v.formatMessage({id:"agent.menu"})})}),(0,e.jsx)(K.ZP,{value:1,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"text string"})}),(0,e.jsx)(K.ZP,{value:2,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"format json"})}),(0,e.jsx)(K.ZP,{value:3,children:(0,e.jsx)("div",{className:"text-[#555555] text-xs font-normal",children:"code"})})]})})]})})})]})}}),(0,e.jsx)("div",{className:"h-[30px] w-1"})]})})]})},Yt=Xt,Jt=s(13085),Qt=s(27842),qt=function(){var i,O,u=(0,C.useIntl)(),w=(0,p.useRef)(null),ce=y.Z.useForm(),a=h()(ce,1),S=a[0],z=y.Z.useForm(),W=h()(z,1),re=W[0],J=y.Z.useForm(),v=h()(J,1),c=v[0],Q=y.Z.useForm(),we=h()(Q,1),me=we[0],q=(0,p.useState)(null),fe=h()(q,2),x=fe[0],X=fe[1],b=(0,p.useState)(0),ge=h()(b,2),pe=ge[0],le=ge[1],je=(0,p.useState)(null),H=h()(je,2),_=H[0],Z=H[1],k=(0,p.useState)(null),G=h()(k,2),oe=G[0],Ne=G[1],Y=(0,p.useState)(null),ee=h()(Y,2),Me=ee[0],Ze=ee[1],Pe=(0,p.useState)(null),T=h()(Pe,2),F=T[0],N=T[1],V=(0,p.useState)(null),I=h()(V,2),P=I[0],he=I[1],E=(0,p.useState)(null),f=h()(E,2),U=f[0],L=f[1],te=(0,p.useState)(null),ae=h()(te,2),Qe=ae[0],Na=ae[1],ta=(0,p.useState)(null),qe=h()(ta,2),et=qe[0],aa=qe[1],sa=(0,p.useState)(null),tt=h()(sa,2),_e=tt[0],na=tt[1],ia=(0,p.useState)("1"),at=h()(ia,2),ue=at[0],Te=at[1],ra=(0,p.useState)(null),st=h()(ra,2),la=st[0],nt=st[1],oa=(0,p.useState)(null),it=h()(oa,2),ua=it[0],da=it[1],ca=(0,p.useState)(null),rt=h()(ca,2),ma=rt[0],lt=rt[1],fa=(0,p.useState)(null),ot=h()(fa,2),Ae=ot[0],ut=ot[1],ga=(0,p.useState)(!1),dt=h()(ga,2),pa=dt[0],ct=dt[1],ha=(0,p.useState)({first:!1,second:!1,fourthly:!1}),mt=h()(ha,2),Ce=mt[0],Ie=mt[1],va=[{key:"1",icon:(0,e.jsx)(ze.Z,{}),label:u.formatMessage({id:"agent.menu.basicsetup"}),disabled:Ce.first,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",lineHeight:"22px",color:ue=="1"?"#1B64F3":"#213044"}},{key:"2",disabled:Ce.second,icon:(0,e.jsx)(Ge.Z,{}),label:u.formatMessage({id:"agent.menu.Capacityoutput"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:ue=="2"?"#1B64F3":"#213044"}},{key:"5",disabled:Ce.fourthly,icon:(0,e.jsx)(ne.Z,{}),label:u.formatMessage({id:"app.dashboard.run_log_agent"}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",lineHeight:"22px",fontWeight:"500",color:ue=="5"?"#1B64F3":"#213044"}}];(0,p.useEffect)(function(){var A=new URLSearchParams(window.location.search);A.get("app_id")||Ie(t()(t()({},Ce),{},{first:!1,second:!0,fourthly:!0})),Ve()},[]);var Ve=function(){var A=B()(j()().mark(function r(l){var o,m,g,d,_t,He,Ft,wt;return j()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(m=new URLSearchParams(window.location.search),m.get("from")&&da(m.get("from")),g=null,!(m.get("app_id")||l)){de.next=10;break}return de.next=6,(0,R.ek)(l||m.get("app_id"),m.get("type"));case 6:g=de.sent,ut(g.data.app.app_id),de.next=13;break;case 10:return de.next=12,(0,ve.cI)();case 12:g=de.sent;case 13:d=g.data,_t=(o=g.data)===null||o===void 0||(o=o.agent_dataset_relation_list)===null||o===void 0?void 0:o.map(function(D){return D.dataset_id}),Z(_t),X(g.data),na(g.data.agent.publish_status===0&&g.data.is_creator===1?"false":"true"),g.data.agent.publish_status===1&&n.ZP.warning(u.formatMessage({id:"agent.message.listwarning"}),5),S.setFieldsValue(ft(d.agent.input_variables)),He=g.data.agent_abilities_list.map(function(D){return D.status==1?t()(t()({},D),{},{status:!0}):t()(t()({},D),{},{status:!1})}),c.setFieldsValue({users:He[0]?He:[{agent_ability_id:0,name:"",content:"",status:!0,output_format:0}]}),Ze(We(d.agent_abilities_list)),N(We(d.agent_abilities_list)),Ft=d.agent_abilities_list.filter(function(D){return D.output_format!==0}),re.setFieldsValue({users:Ft.map(function(D){return{agent_ability_id:D.agent_ability_id,output_format:D.output_format}})}),me.setFieldsValue(ft(d.agent.input_variables)),he(d.m_configurations_list.map(function(D){return{value:D.m_config_id?D.m_config_id:D.model_config_id,label:D.m_name?D.m_name:D.model_name}})),d.agent.m_config_id||d.agent.model_config_id?L(d.agent.m_config_id?d.agent.m_config_id:d.agent.model_config_id):L(d.m_configurations_list[0].model_config_id),wt=d.agent_abilities_list.filter(function(D,Za){return D.status===1}),aa(We(wt).concat([{value:0,label:u.formatMessage({id:"agent.allability"})}]));case 31:case"end":return de.stop()}},r)}));return function(l){return A.apply(this,arguments)}}(),ft=function(r){var l={users:r&&r.properties?Object.values(r.properties).map(function(o){return t()({name:o.name,type:o.type,content:o.display_name,status:o.required},o)}):[{name:"",content:"",type:"string",agent_ability_id:0,output_format:0,status:0}]};return l},We=function(r){return r.map(function(l){return{value:l.agent_ability_id,label:l.name}})},xa=function(r){jt(r,1),me.setFieldsValue(S.getFieldsValue())},ba=function(){Ve()},gt=function(r){le(r)},ya=function(){C.history.back()},pt=function(){var r=S.getFieldsValue().users.filter(function(l){return!l||!l.name||!l.content});if(S.getFieldsValue().users[0])if(U)if(x.agent.obligations){if(r.length!==0)return n.ZP.warning(u.formatMessage({id:"agent.message.warning.completevariable"})),!0;if(ja(S.getFieldsValue().users,"name"))return n.ZP.warning(u.formatMessage({id:"agent.message.warning.repetition"})),!0}else return n.ZP.warning(u.formatMessage({id:"agent.message.warning.functiondescribe"})),!0;else return n.ZP.warning(u.formatMessage({id:"agent.message.warning.LLM"})),!0;else return n.ZP.warning(u.formatMessage({id:"agent.message.warning.variable"})),!0;return!1},ht=function(){var r=c.getFieldsValue().users.filter(function(o){return!!o}),l=r.filter(function(o){return!o.name||!o.content});return l.length!==0&&!(l.length==1&&l[0].name==""&&l[0].content=="")?(n.ZP.warning(u.formatMessage({id:"agent.message.warning.integritycapacity"})),!0):!1},vt=function(r){if((r==null?void 0:r.key)=="4"){var l=S.getFieldsValue().users.map(function(o){return{value:"<<".concat(ke.qX,".inputs.").concat(o.name,">>"),label:o.name}});nt(l)}Te(r.key)},xt=function(){ct(!0);var r=0;return new Promise(function(l,o){Ae?(0,R.ek)(Ae,!1).then(function(m){r=m.data.agent.agent_id,bt(r),l(""),setTimeout(function(){yt(r),n.ZP.success(u.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Ve(Ae)},1e3),lt(r)}).catch(function(m){l("")}):(0,Re.uy)((0,ve.Go)("GET")).then(function(m){ut(m.data.app_id),(0,R.ek)(Ae||m.data.app_id,!1).then(function(g){l(g),r=g.data.agent.agent_id,bt(r),m.data.app_id&&C.history.replace("/Agents?app_id=".concat(m.data.app_id,"&type=false")),setTimeout(function(){yt(r),n.ZP.success(u.formatMessage({id:"skill.conserve.success"}))},500),setTimeout(function(){Ve(m.data.app_id);var d=t()(t()({},(0,ve.Go)("GET")),{},{app_id:m.data.app_id});(0,ve.Go)("SET",d)},1e3),lt(r)}).catch(function(g){l("")})}).catch(function(m){console.log(m)})})},bt=function(r,l){S.validateFields().then(function(o){var m={agent_id:r,data:{is_public:x.app.is_public,enable_api:x.app.enable_api,attrs_are_visible:x.app.attrs_are_visible,obligations:x.agent.obligations,input_variables:x.agent.input_variables?x.agent.input_variables:_a(S.getFieldsValue()),dataset_ids:_,m_config_id:U,allow_upload_file:x.agent.allow_upload_file,default_output_format:x.agent.default_output_format}};_e=="false"&&jt(m,1),me.setFieldsValue(S.getFieldsValue());var g=S.getFieldsValue().users.map(function(d){return{value:"<<".concat(ke.qX,".inputs.").concat(d.name,">>"),label:d.name}});nt(g),l&&Te(l.key)}).catch(function(o){})},yt=function(r){var l=c.getFieldsValue().users.filter(function(g){return!!g}),o=l.map(function(g){return t()(t()({},g),{},{status:g.status==!1?2:1,agent_ability_id:g.agent_ability_id?g.agent_ability_id:0,output_format:g.output_format?g.output_format:0})}),m={agent_id:r,data:{auto_match_ability:x.agent.auto_match_ability,agent_abilities:o}};_e=="false"&&(o.length==1&&o[0].name==""&&o[0].content==""?Ie({first:!1,second:!1,fourthly:!1}):(0,R.Iw)(m).then(function(g){g.code==0&&Ie({first:!1,second:!1,fourthly:!1})}).catch(function(g){}))},jt=function(){var A=B()(j()().mark(function r(l,o){var m;return j()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(_e!=="false"){d.next=19;break}if(o!==1){d.next=7;break}return d.next=4,(0,R.XB)(l);case 4:d.t0=d.sent,d.next=17;break;case 7:if(o!==2){d.next=13;break}return d.next=10,(0,R.Iw)(l);case 10:d.t1=d.sent,d.next=16;break;case 13:return d.next=15,(0,R.Ce)(l);case 15:d.t1=d.sent;case 16:d.t0=d.t1;case 17:m=d.t0,m&&m.code===0&&ct(!1);case 19:case"end":return d.stop()}},r)}));return function(l,o){return A.apply(this,arguments)}}(),ja=function(r,l){var o=new Set;return r.some(function(m){var g=m[l];return o.has(g)?o.add(g):o.add(g)&&!1})},_a=function(r){var l=new Fe.Kr("input","","");return r.users.forEach(function(o){var m=new Fe._w(o.name,o.type?o.type:"string",o.value?o.value:"",o.content,o.status);l.addProperty(o.name,m)}),l};return(0,e.jsxs)("div",{className:" flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsxs)("div",{className:"flex flex-col w-[300px]",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"flex w-full items-center bg-white px-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsxs)(xe.ZP,{type:"link",shape:"circle",size:"middle",className:"",onClick:ya,children:[(0,e.jsx)($.Z,{}),(0,e.jsx)("span",{className:"text-sm font-medium text-[#213044]",children:ua=="chat_room"?u.formatMessage({id:"agent.back_meeting"}):u.formatMessage({id:"agent.back"})})]})}),(0,e.jsxs)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:[(0,e.jsx)(Nt.Z,{selectedKeys:[ue],onClick:vt,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[ue],mode:"inline",items:va}),x&&x.app.enable_api===1&&x.app.publish_status===1?(0,e.jsx)("div",{className:"w-full h-[40px] rounded-lg text-[#000] hover:bg-[#f0f0f0] p-[12px] pl-[16px] cursor-pointer",onClick:B()(j()().mark(function A(){var r,l;return j()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=new URLSearchParams(window.location.search),l=null,!r.get("app_id")){m.next=6;break}return m.next=5,(0,R.ek)(r.get("app_id"),r.get("type"));case 5:l=m.sent;case 6:l!=null&&l.data.app.enable_api===1&&l.data.app.publish_status===1?window.open($e._n+x.app.api_url):n.ZP.warning(u.formatMessage({id:"agent.save.and.click"}),5);case 7:case"end":return m.stop()}},A)})),children:(0,e.jsxs)("div",{className:"mr-[20px] text-base font-medium text-[#213044] -mt-1",children:[(0,e.jsx)(M.Z,{className:"mr-3"}),u.formatMessage({id:"agent.visit"})," API"]})}):null]})]}),(0,e.jsx)("div",{className:"flex-1 relative w-[calc(100%-300px)]",children:(0,e.jsxs)(Ue.Z,{style:{height:"100%",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)"},children:[(0,e.jsx)(Ue.Z.Panel,{defaultSize:"50%",min:"40%",max:"70%",children:(0,e.jsx)(Xe.Z,{spinning:pa,size:"large",className:"mt-[112px] mr-4",children:(0,e.jsx)("div",{className:"flex flex-col",style:{height:"calc(100vh - 56px)",overflowY:"scroll",scrollbarWidth:"none"},children:(0,e.jsxs)("div",{className:"px-[30px] ",style:{overflowX:"auto",height:"100%"},children:[(0,e.jsx)("div",{className:"w-full flex justify-center  mt-[30px]",children:(0,e.jsxs)("div",{className:"flex items-center w-full ",children:[(0,e.jsx)("div",{className:"mr-[10px] w-[16px] h-[16px]",children:(0,e.jsx)("img",{src:"/icons/flag.svg",alt:"",className:"w-[16px] h-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"mr-[6px] text-lg text-[#213044] font-medium",children:[(i=(0,ve.Go)("GET"))!==null&&i!==void 0&&i.app_id?u.formatMessage({id:"agent.compile"}):u.formatMessage({id:"agent.created"})," ",u.formatMessage({id:"agent"})]}),(x==null||(O=x.app)===null||O===void 0?void 0:O.publish_status)===1?(0,e.jsx)("div",{className:"bg-[#1B64F3] px-[7px] text-[#fff] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:u.formatMessage({id:"agent.havepublished"})}):(0,e.jsx)("div",{className:" bg-[#EEE] px-[7px]  text-[#999] rounded font-normal text-xs flex items-center justify-center h-[18px]",children:u.formatMessage({id:"agent.unpublish"})})]})]})}),(0,e.jsx)("div",{style:{display:ue==="1"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Tt,{FirstValue:xa,Ffromref:S,Detaillist:x,setDetaillist:X,repository:_,setRepository:Z,Newproperties:oe,setNewproperties:Ne,Operationbentate:_e,Fourthly_config_id:U,setFourthly_config_id:L,Fourthly_select_list:P,pageKeyfun:Te,firstjudgingcondition:pt,agentmenudisabled:Ce,setAgentmunudisabled:Ie})}),(0,e.jsx)("div",{style:{display:ue==="2"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center",position:"sticky",top:"-150px"},children:(0,e.jsx)(Yt,{SecondValue:ba,Detaillist:x,setDetaillist:X,Sformref:c,Operationbentate:_e,handleBack:gt,pageKeyfun:Te,SkillMenuClick:vt,secondjudgingcondition:ht,agentupdata:xt})}),(0,e.jsx)("div",{style:{display:ue==="4"?"flex":"none",height:"calc(100vh - 146px)",justifyContent:"center"},children:(0,e.jsx)(Gt,{handleBack:gt,Detaillist:x,setDetaillist:X,Fourthly_select_list:P,Fourthly_config_id:U,setFourthly_config_id:L,Fourthlyref:me,Fourthly_abilities_list:et,Operationbentate:_e,callwordlist:la,newagentid:ma})})]})})})}),(0,e.jsx)(Ue.Z.Panel,{children:(0,e.jsx)("div",{children:(0,e.jsx)(Jt.Z,{saveInfo:{firstjudgingcondition:pt,secondjudgingcondition:ht,agentupdata:xt},operationbentate:_e,data:{abilitiesList:et,detailList:x}})})}),ue=="5"&&(0,e.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-slate-50 w-full h-full z-10",children:(0,e.jsx)(Qt.ZP,{agent_id:x.agent.agent_id})})]})})]})},ea=qt}}]);
