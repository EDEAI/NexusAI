"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{82826:function(Ve,Ne,o){o.d(Ne,{Z:function(){return xe}});var ge=o(1413),C=o(67294),Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},q=Fe,Ie=o(91146),w=function(J,Ze){return C.createElement(Ie.Z,(0,ge.Z)((0,ge.Z)({},J),{},{ref:Ze,icon:q}))},se=C.forwardRef(w),xe=se},88484:function(Ve,Ne,o){o.d(Ne,{Z:function(){return xe}});var ge=o(1413),C=o(67294),Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},q=Fe,Ie=o(91146),w=function(J,Ze){return C.createElement(Ie.Z,(0,ge.Z)((0,ge.Z)({},J),{},{ref:Ze,icon:q}))},se=C.forwardRef(w),xe=se},51636:function(Ve,Ne,o){o.r(Ne),o.d(Ne,{default:function(){return Oa}});var ge=o(15009),C=o.n(ge),Fe=o(99289),q=o.n(Fe),Ie=o(5574),w=o.n(Ie),se=o(43722),xe=o(32983),t=o(67294),J=o(35312),Ze=o(19632),ue=o.n(Ze),it=o(97857),K=o.n(it),he=o(80459),lt=o(82114),ct=o(82826),ot=o(63783),ut=o(3471),_e=o(45360),dt=o(85576),je=o(28036),We=o(83062),Ge=o(72269),we=o(74330),Oe=o(96486),Je=o(44010),ae=o(39e3),e=o(85893),pt=function(a){var n=(0,J.useIntl)(),x=a.roomDetail,S=a.setAgent,h=_e.ZP.useMessage(),r=w()(h,2),v=r[0],R=r[1],g=(0,J.useParams)(),p=g.id,m=(0,ae.Z)(function(l){return l.disableInput}),D=(0,ae.Z)(function(l){return l.truncatable}),F=(0,ae.Z)(function(l){return l.setClearMemory}),M=(0,t.useState)([]),H=w()(M,2),u=H[0],z=H[1],P=(0,t.useState)(K()({},x)),E=w()(P,2),k=E[0],_=E[1],ne=(0,t.useState)([]),N=w()(ne,2),A=N[0],T=N[1],ee=(0,t.useRef)(!1),de=(0,t.useRef)(!1),re=(0,t.useState)(!1),G=w()(re,2),O=G[0],U=G[1],V=function(){var c=dt.Z.confirm;c({title:n.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(lt.Z,{}),content:n.formatMessage({id:"app.chatroom.clear.tips"}),okText:n.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:n.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){F(["TRUNCATE","0"])}})},b=function(){var l=q()(C()().mark(function c(){var s;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!p){f.next=5;break}return f.next=3,(0,se.cH)({id:p});case 3:if(s=f.sent,s.code==0)try{_(function(){return K()(K()({},s.data.chat_info),{},{max_round:s.data.max_round,smart_selection:s.data.smart_selection})}),z(s.data.agent_list),ee.current=!0}catch(I){}case 5:case"end":return f.stop()}},c)}));return function(){return l.apply(this,arguments)}}(),te=function(){var l=q()(C()().mark(function c(){var s;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,se.j2)({id:p});case 2:s=f.sent,s.code==0&&(T(s.data.list),de.current=!0);case 4:case"end":return f.stop()}},c)}));return function(){return l.apply(this,arguments)}}(),ce=function(){var l=q()(C()().mark(function c(s){var i,f,I;return C()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!p){y.next=11;break}if(i=s.active==1?0:1,i!=0){y.next=7;break}if(f=u.filter(function(L){return L.active==1}),f.length-1!=0){y.next=7;break}return v.open({type:"error",content:n.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),y.abrupt("return",!1);case 7:return y.next=9,(0,se.sT)({active:i},p,s.agent_id);case 9:I=y.sent,I.code==0&&z(function(L){return L.map(function(X){return K()(K()({},X),{},{active:X.agent_id==s.agent_id?i:X.active})})});case 11:case"end":return y.stop()}},c)}));return function(s){return l.apply(this,arguments)}}(),fe=function(c){return c.length>6?c.length=6:c.lenth,c},ie=function(c){c.type=="my_agent"?J.history.push("/Agents?app_id=".concat(c.app_id,"&type=false&from=chat_room")):J.history.push("/ReadOnlyAgent?app_id=".concat(c.app_id,"&type=true&from=chat_room"))},Q=function(c){J.history.replace("/chat_room/".concat(c.chatroom_id)),window.location.reload()},B=function(){U(!0)},$=function(){U(!1)},W=function(){var l=q()(C()().mark(function c(s){var i,f,I;return C()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(s.checkItem&&s.checkItem.length==0)){y.next=3;break}return v.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),y.abrupt("return");case 3:return i=ue()(s.checkItem).map(function(L){var X=L.agent_id,ve=L.active,Y=ve===void 0?1:ve;return{agent_id:X,active:Y}}),f={description:k.description,name:k.name,max_round:k.max_round},y.next=7,(0,se.sI)(K()(K()({},f),{},{agent:i}),p);case 7:I=y.sent,I.code==0?(s.checkItem.map(function(L){L.active=L.active==null?1:L.active}),z(ue()(s.checkItem)),S.current=ue()(s.checkItem),v.open({type:"success",content:n.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):v.open({type:"error",content:n.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return y.stop()}},c)}));return function(s){return l.apply(this,arguments)}}(),j=function(){var l=q()(C()().mark(function c(){var s;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=k.smart_selection==1?0:1,f.next=3,(0,se.r5)({smart_selection:s},p);case 3:_(function(I){return K()(K()({},I),{},{smart_selection:s})});case 4:case"end":return f.stop()}},c)}));return function(){return l.apply(this,arguments)}}();return(0,t.useEffect)(function(){b(),te()},[]),(0,e.jsxs)(e.Fragment,{children:[R,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){J.history.go(-1)},children:[(0,e.jsx)(je.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(ct.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:n.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:k.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(We.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:n.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(ot.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:n.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ge.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:k.smart_selection==1,onChange:j,disabled:m})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:ee.current?(0,e.jsx)("div",{className:"flex flex-col",children:u&&u.length>0?u.map(function(l){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)(he.Z,{data:l}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:l.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:l.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){ie(l)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ge.Z,{size:"small",disabled:m,defaultChecked:!0,className:"w-[28px]",checked:l.active==1,onChange:function(){ce(l)}})]})]},l.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(we.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:B,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:D&&!m?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Oe.throttle)(function(){D&&!m&&V()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:n.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:n.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:de.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:A&&A.length>0?A.map(function(l){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){Q(l)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:l.name}),l.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:n.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:l.agent_list&&l.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[fe(l.agent_list).map(function(c,s){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)(he.Z,{data:c,width:"30px"})},s)}),l.agent_list.length>=6?(0,e.jsx)(ut.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},l.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(we.Z,{})})})})]})]}),(0,e.jsx)(Je.Z,{show:O,popupClose:$,popupSave:W,checkList:u,zIndex:99})]})]})},ft=(0,t.memo)(pt),mt=o(13769),Ke=o.n(mt),xt=o(47635),Ee=o(27522),vt=o(77295),Te=o(32332),pe=o(1413),ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},gt=ht,ye=o(91146),jt=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:gt}))},yt=t.forwardRef(jt),St=yt,Pe=o(69753),Nt=o(97245),wt=o(88484),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},Ct=bt,Rt=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Ct}))},Mt=t.forwardRef(Rt),kt=Mt,Ft=o(2068),It={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},Zt=It,At=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Zt}))},Dt=t.forwardRef(At),Ot=Dt,Qe=o(26915),Le=o(55060),Xe=o(66309),Et=o(20640),Ye=o.n(Et),be=o(22683),Ce=o(97807),Tt=["node","className","children"],Pt=["node"],Lt=Qe.Z.TextArea,Re=function(a,n){try{var x=document.createElement("a");x.href=a,x.download=n,x.target="_blank",document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch(S){}},Bt=(0,t.memo)(function(d){var a=d.setInstruction,n=d.messageApi,x=d.isStop,S=d.scrollDomRef,h=d.upButtonDom,r=(0,J.useIntl)(),v=(0,ae.Z)(function(N){return N.disableInput}),R=(0,ae.Z)(function(N){return N.setDisableInput}),g=(0,vt.ZP)({maxSizeMB:15,acceptedFileTypes:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv,.jpg,.png,.jpeg",multiple:!0}),p=g.uploadedFiles,m=g.handleUpload,D=g.removeFile,F=g.clearFiles,M=g.isUploading,H=(0,t.useState)(""),u=w()(H,2),z=u[0],P=u[1],E=function(A){(p==null?void 0:p.length)>0?(a(["FILELIST",p.map(function(T){return T.file_id})]),setTimeout(function(){a(["INPUT",A]),p.length>0&&F()},300)):a(["INPUT",A])},k=function(A){!A.shiftKey&&A.target.value==""&&(n.open({type:"warning",content:r.formatMessage({id:"app.chatroom.content.input"}),duration:10}),P(""),A.preventDefault()),!A.shiftKey&&A.keyCode==13&&A.target.value!=""&&(R(!0),P(""),E(A.target.value),A.preventDefault())},_=(0,Oe.throttle)(function(){a(["STOP",null])},300),ne=function(){v||m()};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:h,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(A){S.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(St,{className:"text-[16px]"})}),(0,e.jsx)(Le.Z.PreviewGroup,{children:p.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map(function(N){return(0,e.jsx)(Xe.Z,{closable:!0,onClose:function(){return D(N.uid)},className:"flex items-center ".concat(N.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(We.Z,{title:N.name,children:(0,e.jsx)("div",{className:"flex items-center",children:N.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(Le.Z,{src:N.path_show||N.url,alt:N.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:N.path_show||N.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:N.name}),(0,e.jsx)(Pe.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(T){T.stopPropagation(),Re(N.path_show||N.url,N.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Nt.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:N.name}),(0,e.jsx)(Pe.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(T){T.stopPropagation(),Re(N.path_show||N.url,N.name)}})]})})})},N.uid)})})})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] ".concat(p.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,e.jsx)(je.ZP,{type:"text",icon:(0,e.jsx)(wt.Z,{}),onClick:ne,disabled:v||M,loading:M}),(0,e.jsx)(Lt,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:z,disabled:v,onChange:function(A){P(A.target.value)},onPressEnter:k,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(r.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),x?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:_,children:(0,e.jsx)(kt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(v||!z?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Oe.throttle)(function(){if(v||!z)return!1;z||n.open({type:"warning",content:r.formatMessage({id:"app.chatroom.content.input"}),duration:10}),R(!0),E(z),P("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),$t=function d(a){return typeof a=="string"?a:Array.isArray(a)?a.map(d).join(""):t.isValidElement(a)?d(a.props.children):""},Ht=function(a){return $t(a)},Be=function(a,n){return{code:function(S){var h=S.node,r=S.className,v=S.children,R=Ke()(S,Tt),g=/language-(\w+)/.exec(r||"");if(g!=null&&g.length){var p=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:g[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var m=q()(C()().mark(function D(F){var M;return C()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,M=F.currentTarget,u.next=4,Ye()(Ht(v));case 4:M&&(M.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){M&&(M.children[1].innerText=n.formatMessage({id:"app.chatroom.content.copycode"}))},200),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(0),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},D,null,[[0,8]])}));return function(D){return m.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:n.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(p).concat(a),className:"p-4",children:v})})]})}else return(0,e.jsx)("code",K()(K()({},R),{},{children:v}))},img:function(S){var h=S.node,r=Ke()(S,Pt);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(Le.Z,{src:r.src,alt:r.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(je.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(Pe.Z,{}),onClick:function(R){R.stopPropagation(),Re(r.src||"",r.alt||"image.png")}})})]})}}},qe=(0,t.memo)(function(d){var a=d.messageApi,n=d.index,x=d.idName,S=d.cidName,h=(0,J.useIntl)(),r=(0,t.useState)(!1),v=w()(r,2),R=v[0],g=v[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){g(!0)},onMouseLeave:function(){g(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var p=q()(C()().mark(function m(D){var F,M;return C()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return F=D.target.closest("#".concat(x).concat(n)),M=F.querySelector("#".concat(S).concat(n)),u.prev=2,u.next=5,Ye()(M.innerText);case 5:a.open({type:"success",content:h.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(2),console.error("Failed to copy text: ",u.t0);case 11:case"end":return u.stop()}},m,null,[[2,8]])}));return function(m){return p.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(R?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(R?" text-[#1B64F3]":"text-[#666]"),children:h.formatMessage({id:"app.chatroom.content.copy"})})]})})}),et=function(a){var n=a.id,x=a.index,S=a.idName,h=a.cidName,r=(0,J.useIntl)(),v=(0,ae.Z)(function(M){return M.setSummaryClick}),R=(0,t.useState)(!0),g=w()(R,2),p=g[0],m=g[1],D=(0,ae.Z)(function(M){return M.summaryClick});(0,t.useEffect)(function(){m(D)},[D]);var F=(0,ae.Z)(function(M){return M.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(p?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(H){if(p){var u=H.target.closest("#".concat(S).concat(x)),z=u.querySelector("#".concat(h).concat(x));F({id:n,message:z.innerText}),v(!1)}},children:[(0,e.jsx)(Ft.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.content.summary"})})]})})},zt=function(a){var n=a.roomid,x=(0,J.useIntl)(),S=(0,ae.Z)(function(m){return m.setSummaryClick}),h=(0,t.useState)(!0),r=w()(h,2),v=r[0],R=r[1],g=(0,ae.Z)(function(m){return m.summaryClick});(0,t.useEffect)(function(){R(g)},[g]);var p=(0,ae.Z)(function(m){return m.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(v?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){v&&(p({id:n}),S(!1))},children:[(0,e.jsx)(Ot,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:x.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Ut=(0,t.memo)(function(d){var a=d.messageApi,n=d.setCurrentMessageContent,x=d.sendValue,S=d.agentList,h=d.scrollDomRef,r=d.upButtonDom,v=d.setIsStop,R=d.setisEnd,g=d.setSendValue,p=(0,J.useIntl)(),m=(0,J.useParams)(),D=m.id,F=(0,ae.Z)(function(ee){return ee.setDisableInput}),M=(0,t.useState)({}),H=w()(M,2),u=H[0],z=H[1],P=(0,t.useRef)(!1),E=(0,t.useRef)(""),k=(0,ae.Z)(function(ee){return ee.setTruncatable}),_=function(de){var re=de.data;if(re.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var G=JSON.parse(re.slice(22,-2));switch(G[0]){case"ERROR":F(!1),v(!1),g(""),a.open({type:"error",content:"webSocket-".concat(G[1]),duration:10});break;case"CHAT":var O={content:"".concat(G[1]),is_agent:0};n(function(b){return[].concat(ue()(b),[O])}),setTimeout(function(){h.current.scrollTop=0,r.current.style.display="none"});break;case"WITHFILELIST":n(function(b){var te=ue()(b);return te.length&&(te[te.length-1].file_list=G[1]),te}),setTimeout(function(){h.current.scrollTop=0,r.current.style.display="none"});break;case"STOPPABLE":v(G[1]);break;case"TRUNCATABLE":k(G[1]),G[1]||a.open({type:"success",content:"".concat(p.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":a.open({type:"success",content:"".concat(p.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(re.indexOf("REPLY")!==-1&&re.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var U=JSON.parse(re.slice(22,-2))[1];E.current="",P.current=!0;var V=S.current.filter(function(b){return b.agent_id==U})[0];Object.keys(u).length&&n(function(b){return[].concat(ue()(b),[u])}),z(function(b){return K()(K()({},b),{},{is_agent:1,icon:V==null?void 0:V.icon,name:V==null?void 0:V.name})}),v(!0),k(!1)}re.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&P.current&&(h.current.scrollTop=0,r.current.style.display="none",E.current+=re,z(function(b){return K()(K()({},b),{},{content:E.current})})),re.indexOf("ENDCHAT")!==-1&&(P.current=!1,E.current="",F(!1),v(!1),k(!0),Object.keys(u).length&&n(function(b){return[].concat(ue()(b),[u])}),z({}),R(!0),g(""))},ne=(0,xt.Z)("chat",_),N=ne.runSocket,A=ne.sendMessage,T=ne.readyState;return(0,t.useEffect)(function(){T==1&&D&&A(JSON.stringify(["ENTER",parseInt(D)]))},[T]),(0,t.useEffect)(function(){x&&T==1&&A(x)},[x]),(0,t.useEffect)(function(){N()},[]),(0,e.jsx)(e.Fragment,{children:u.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(u.is_agent!=1?"flex-row-reverse":""),children:[u.is_agent==1?(0,e.jsx)(he.Z,{data:u}):(0,e.jsx)(he.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(u.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:u.name?u.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(u.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:u.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:[u.file_list&&u.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Ee.Z,{fileList:u.file_list,onDownload:Re})}),(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],components:Be("add",p),children:u.content})]})})]})]}):(0,e.jsx)(e.Fragment,{})})}),Vt=(0,t.memo)(function(d){var a=d.messageApi,n=d.setUserMessage,x=d.sendValue,S=d.agentList,h=d.scrollDomRef,r=d.upButtonDom,v=d.setIsStop,R=d.setSendValue,g=(0,J.useIntl)(),p=(0,t.useState)([]),m=w()(p,2),D=m[0],F=m[1],M=(0,t.useState)(!1),H=w()(M,2),u=H[0],z=H[1],P=(0,J.useParams)(),E=P.id;return(0,t.useEffect)(function(){u&&(n(function(k){return[].concat(ue()(D.reverse()),ue()(k))}),F([]),setTimeout(function(){z(!1),h.current.scrollTop=0},200))},[u]),(0,e.jsxs)(e.Fragment,{children:[D.length?D.map(function(k,_){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(k.is_agent!=1?"flex-row-reverse":""),children:[k.is_agent==1?(0,e.jsx)(he.Z,{data:k}):(0,e.jsx)(he.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(_),children:[(0,e.jsx)("div",{className:"".concat(k.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:k.name?k.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(k.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:k.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(_),children:[k.file_list&&k.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Ee.Z,{fileList:k.file_list,onDownload:Re})}),(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],components:Be(_,g),children:k.content})]})}),k.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(qe,{messageApi:a,index:_,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(et,{id:E,index:_,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},_)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Ut,{messageApi:a,setCurrentMessageContent:F,sendValue:x,agentList:S,scrollDomRef:h,upButtonDom:r,setIsStop:v,setisEnd:z,setSendValue:R})]})}),_t=(0,t.memo)(function(d){var a=d.messageApi,n=d.scrollDomRef,x=d.instruction,S=d.setIsStop,h=d.upButtonDom,r=d.setInstruction,v=d.agentList,R=(0,J.useIntl)(),g=(0,J.useParams)(),p=g.id,m=(0,t.useState)([]),D=w()(m,2),F=D[0],M=D[1],H=(0,t.useRef)(!1),u=(0,t.useState)(""),z=w()(u,2),P=z[0],E=z[1],k=(0,t.useRef)(null),_=(0,t.useRef)(!0),ne=(0,t.useRef)(2),N=(0,t.useRef)(1),A=(0,t.useRef)(0),T=function(){var O=q()(C()().mark(function U(V){var b,te,ce=arguments;return C()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(b=ce.length>1&&ce[1]!==void 0?ce[1]:function(){},!p){ie.next=6;break}return ie.next=4,(0,se.KH)(p,{page:N.current,page_size:10});case 4:te=ie.sent,te.code==0&&(ne.current=te.data.total_pages,V||(k.current.style.display="none"),M(function(Q){return V?ue()(te.data.list.reverse()):[].concat(ue()(Q),ue()(te.data.list.reverse()))}),V?setTimeout(function(){n.current.scrollTop=0,h.current.style.display="none"}):A.current=te.data.list.length,_.current=!0);case 6:case"end":return ie.stop()}},U)}));return function(V){return O.apply(this,arguments)}}(),ee=function(U){var V=U.target.scrollHeight+(U.target.scrollTop-U.target.clientHeight);H.current!==Math.ceil(U.target.scrollTop)<-50&&(H.current=Math.ceil(U.target.scrollTop)<-50,h.current.style.display=H.current?"flex":"none"),V<10&&_.current&&(_.current=!1,N.current=N.current+1,k.current.style.display="flex",ne.current>=N.current?T(!1):k.current.style.display="none")},de=function(U,V){V==="0"&&(V=Number(V));var b=["".concat(U),V===0||V?V:null];E(JSON.stringify(b))},re=(0,ae.Z)(function(O){return O.disableInput}),G=(0,ae.Z)(function(O){return O.clearMemory});return(0,t.useEffect)(function(){G&&G.length&&de(G[0],G[1])},[G]),(0,t.useEffect)(function(){x&&x.length&&(de(x[0],x[1]?x[1]:""),r([]))},[x]),(0,t.useEffect)(function(){N.current=1,T(!0)},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:n,onScroll:ee,children:[(0,e.jsxs)("div",{className:"min-w-[860px]",children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:F&&F.length?F.map(function(O,U){return(0,e.jsxs)("div",{id:"c".concat(O.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(O.is_agent!=1?"flex-row-reverse":""),children:[O.is_agent==1?(0,e.jsx)(he.Z,{data:O}):(0,e.jsx)(he.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(U),children:[(0,e.jsx)("div",{className:"".concat(O.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:O.name?O.name:(0,Te.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(O.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:O.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(U),children:[O.file_list&&O.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(Ee.Z,{fileList:O.file_list,onDownload:Re})}),(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],components:Be(U,R),children:O.content})]})}),O.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(qe,{messageApi:a,idName:"content",cidName:"chilContent",index:U}),(0,e.jsx)(et,{id:p,index:U,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},U)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(Vt,{messageApi:a,setUserMessage:M,sendValue:P,agentList:v,scrollDomRef:n,upButtonDom:h,setIsStop:S,setSendValue:E})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!re&&F.length?(0,e.jsx)(zt,{roomid:p}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:k,children:(0,e.jsx)(we.Z,{})})]})})}),Wt=(0,t.memo)(function(d){var a=d.agentList,n=(0,t.useRef)(null),x=(0,t.useRef)(null),S=(0,t.useState)(!1),h=w()(S,2),r=h[0],v=h[1],R=(0,t.useState)([]),g=w()(R,2),p=g[0],m=g[1],D=_e.ZP.useMessage(),F=w()(D,2),M=F[0],H=F[1];return(0,e.jsxs)(e.Fragment,{children:[H,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full",children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(_t,{instruction:p,setInstruction:m,messageApi:M,scrollDomRef:n,setIsStop:v,upButtonDom:x,agentList:a}),(0,e.jsx)(Bt,{setInstruction:m,messageApi:M,isStop:r,upButtonDom:x,scrollDomRef:n})]})})]})}),Gt=o(39873),Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},Kt=Jt,Qt=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:Kt}))},Xt=t.forwardRef(Qt),Yt=Xt,qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},ea=qt,ta=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:ea}))},aa=t.forwardRef(ta),na=aa,ra=o(83159),sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},ia=sa,la=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:ia}))},ca=t.forwardRef(la),oa=ca,$e=o(86),tt=o(34994),at=o(2216),ua=o(85877),da=o(29432),pa=o(39944),fa=o(11551),He=o(55927),ma=function(a){var n,x,S,h,r=a.selectApp,v=a.runid,R=a.setBoxLoading,g=a.setinputShow,p=a.appId,m=a.id,D=a.setisRun,F=(0,J.useIntl)(),M=(0,t.useRef)(""),H=(0,t.useRef)(""),u=(0,t.useRef)(null),z=(0,t.useState)(""),P=w()(z,2),E=P[0],k=P[1],_=(0,t.useState)(null),ne=w()(_,2),N=ne[0],A=ne[1],T=(0,t.useState)([]),ee=w()(T,2),de=ee[0],re=ee[1],G=(0,t.useState)(""),O=w()(G,2),U=O[0],V=O[1],b=(0,He.Z)(function(Q){return Q.flowMessage}),te=function(B){H.current=ce(B);var $={user:{value:ce(B)}};V(new pa.z($))},ce=function Q(B){return B.map(function($){return $.type==="mention"?$.id:$.children?Q($.children):$.text}).join("")},fe=function(){var Q=q()(C()().mark(function B($){var W,j;return C()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return R(!0),W=Object.keys($),W.forEach(function(s){u.current.properties[s]&&(u.current.properties[s].value=$[s])}),c.next=5,(0,fa.LH)({agent_id:r.checkItem[0].agent_id,ability_id:0,input_dict:u.current,prompt:U,data_source_run_id:M.current});case 5:j=c.sent,j.code==0&&(k(j.data.outputs_md),R(!1),D(!1));case 7:case"end":return c.stop()}},B)}));return function($){return Q.apply(this,arguments)}}(),ie=function(){var Q=q()(C()().mark(function B($,W){var j,l;return C()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,se.xT)($,W);case 2:j=s.sent,(j==null?void 0:j.code)==0&&(M.current=j==null||(l=j.data)===null||l===void 0?void 0:l.app_run_id);case 4:case"end":return s.stop()}},B)}));return function($,W){return Q.apply(this,arguments)}}();return(0,t.useEffect)(function(){r&&r.checkItem.length&&(D(!0),ie(m,{app_id:p,app_run_id:v,status:1,corrected_parameter:""}))},[r]),(0,t.useEffect)(function(){var Q=b.filter(function(c){return c.data.app_run_id==v&&c.type.indexOf("generate_meeting_action_items")!==-1});if(Q.length!=0){var B,$=(B=Q[Q.length-1])===null||B===void 0||(B=B.data)===null||B===void 0||(B=B.exec_data)===null||B===void 0||(B=B.outputs)===null||B===void 0?void 0:B.value;if($){var W=JSON.parse($);u.current=W;var j=Object.keys(W.properties);if(j.length){A(W.properties);var l=j.map(function(c){return{value:"<<".concat(da.qX,".inputs.").concat(c,">>"),label:c}});re(l)}g(!1),R(!1)}}},[b]),console.log(r),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)($e.Z,{icon:r==null||(n=r.checkItem[0])===null||n===void 0?void 0:n.icon,title:r==null||(x=r.checkItem[0])===null||x===void 0?void 0:x.name,textDetails:r==null||(S=r.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"robot_icon",avatar:r==null||(h=r.checkItem[0])===null||h===void 0?void 0:h.avatar,handleClick:function(){}})}),N!=null?(0,e.jsxs)(tt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!H.current},searchConfig:{submitText:F.formatMessage({id:"workflow.button.run"})}},onFinish:function(B){fe(B)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(at._,{data:N})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ua.Z,{onChange:function(B){te(B)},options:de,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),E?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],children:E})})}):(0,e.jsx)(e.Fragment,{})]})},xa=(0,t.memo)(ma),nt=o(42237),va=o(93696),ha=function(a,n){return t.createElement(ye.Z,(0,pe.Z)((0,pe.Z)({},a),{},{ref:n,icon:va.Z}))},ga=t.forwardRef(ha),ja=ga,ya=o(4981),rt=o(29608),Sa=(0,t.memo)(function(d){var a=d.progressObj,n=function(){return parseFloat(a.elapsed_time).toFixed(6)},x=function(h){var r=new Date(h),v=r.getFullYear(),R=(r.getMonth()+1).toString().padStart(2,"0"),g=r.getDate().toString().padStart(2,"0"),p=r.getHours().toString().padStart(2,"0"),m=r.getMinutes().toString().padStart(2,"0"),D=r.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(v,".").concat(R,".").concat(g," ").concat(p,":").concat(m,":").concat(D)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:a.created_time&&x(a.created_time)}),(0,e.jsx)("div",{className:"truncate",children:a.apps_name||a.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(a.status==1?"bg-blue-600":a.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[n(),"S"]})]})]})})}),Na=function(a){var n,x,S,h,r=a.selectApp,v=a.runid,R=a.setBoxLoading,g=a.setinputShow,p=a.appId,m=a.id,D=a.setisRun,F=(0,J.useIntl)(),M=(0,t.useRef)(""),H=(0,t.useRef)(null),u=(0,t.useState)(null),z=w()(u,2),P=z[0],E=z[1],k=(0,t.useState)(!1),_=w()(k,2),ne=_[0],N=_[1],A=(0,t.useState)(null),T=w()(A,2),ee=T[0],de=T[1],re=(0,t.useState)(null),G=w()(re,2),O=G[0],U=G[1],V=(0,t.useState)(null),b=w()(V,2),te=b[0],ce=b[1],fe=(0,rt.Z)(function(s){return s.setDealtWithData}),ie=(0,rt.Z)(function(s){return s.setRunPanelLogRecord}),Q=function(){var s=q()(C()().mark(function i(f){var I,Z,y,L,X;return C()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return R(!0),I=Object.keys(f),Z={},I.forEach(function(oe){H.current.properties[oe]&&(H.current.properties[oe].value=f[oe]),O&&O.forEach(function(me){me.node_id==oe&&(Z[oe]=f[oe])})}),y={inputs:H.current,node_confirm_users:Z,run_name:"chatroom-".concat(m,"-run-").concat(M.current,"-driven"),run_type:1,data_source_run_id:M.current},Y.next=7,(0,nt.UE)(p,y);case 7:L=Y.sent,L.code==0&&(M.current=L==null||(X=L.data)===null||X===void 0?void 0:X.app_run_id,N(!0),D(!1));case 9:case"end":return Y.stop()}},i)}));return function(f){return s.apply(this,arguments)}}(),B=function(){var s=q()(C()().mark(function i(){var f,I;return C()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:f=c==null?void 0:c.filter(function(L){return L.type=="workflow_run_progress"&&L.data.app_run_id==M.current}).map(function(L){var X=L.data;return X}),f&&f.length&&(I=f[f.length-1],E(I),R(!1));case 2:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),$=function(){var s=q()(C()().mark(function i(){var f,I,Z,y,L;return C()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:I=c==null?void 0:c.filter(function(Y){return Y.type=="workflow_need_human_confirm"&&Y.data.app_run_id==M.current}),Z=(f=I.map(function(Y){var oe=Y.data,me=Y.need_human_confirm;return{data:oe,need_human_confirm:me}}))===null||f===void 0?void 0:f.filter(function(Y){return Y.data.type!==1}),Z&&Z.length&&(L=Z[Z.length-1].data,L.exec_id=L==null||(y=L.node_exec_data)===null||y===void 0?void 0:y.node_exec_id,ce(Z[Z.length-1]),R(!1));case 3:case"end":return ve.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),W=function(i){return i.completed_progress?parseInt(i.completed_progress.slice(0,-1)):!1},j=function(){var s=q()(C()().mark(function i(f,I){var Z,y;return C()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.next=2,(0,se.xT)(f,I);case 2:Z=X.sent,(Z==null?void 0:Z.code)==0&&(M.current=Z==null||(y=Z.data)===null||y===void 0?void 0:y.app_run_id);case 4:case"end":return X.stop()}},i)}));return function(f,I){return s.apply(this,arguments)}}(),l=function(){var s=q()(C()().mark(function i(){var f,I;return C()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return console.log(p),y.next=3,(0,nt.zO)(p);case 3:f=y.sent,f.code==0&&U(f==null||(I=f.data)===null||I===void 0?void 0:I.need_confirm_nodes),j(m,{app_id:p,app_run_id:v,status:1,corrected_parameter:""});case 6:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}();(0,t.useEffect)(function(){r&&r.checkItem.length&&(D(!0),l())},[r]);var c=(0,He.Z)(function(s){return s.flowMessage});return(0,t.useEffect)(function(){B(),$();var s=c.filter(function(y){return y.data.app_run_id==v&&y.type.indexOf("generate_meeting_action_items")!==-1});if(s.length!=0){var i,f=(i=s[s.length-1])===null||i===void 0||(i=i.data)===null||i===void 0||(i=i.exec_data)===null||i===void 0||(i=i.outputs)===null||i===void 0?void 0:i.value;if(f){var I=JSON.parse(f);H.current=I;var Z=Object.keys(I.properties);Z.length&&(console.log(I.properties),de(I.properties)),g(!1),R(!1)}}},[c]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)($e.Z,{icon:r==null||(n=r.checkItem[0])===null||n===void 0?void 0:n.icon,title:r==null||(x=r.checkItem[0])===null||x===void 0?void 0:x.name,textDetails:r==null||(S=r.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"workflow_icon",avatar:r==null||(h=r.checkItem[0])===null||h===void 0?void 0:h.avatar,handleClick:function(){}})}),!ne&&ee!=null?(0,e.jsxs)(tt.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:F.formatMessage({id:"workflow.button.run"})}},onFinish:Q,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(at._,{data:ee})}),(0,e.jsx)(ya.e,{data:O})]}):(0,e.jsx)(e.Fragment,{children:ee!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[F.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(ee).map(function(s){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:s.display_name||s.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:s.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),te&&te.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){fe(te.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(ja,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:F.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),P?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)($e.Z,{status:P.status,icon:P.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:P.run_name}),P.need_human_confirm==1?(0,e.jsx)(Xe.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:F.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(Sa,{progressObj:P}),handleClick:function(){ie(P)},progress:W(P)})}):(0,e.jsx)(e.Fragment,{})]})},wa=(0,t.memo)(Na),ba=function(a){var n,x,S,h=(0,J.useIntl)(),r=a.runid,v=a.id,R=a.setBoxLoading,g=a.scrollDom,p=a.setinputShow,m=(0,t.useRef)("agent"),D=(0,t.useRef)(""),F=(0,t.useState)(!1),M=w()(F,2),H=M[0],u=M[1],z=(0,t.useState)({type:"agent",checkItem:[],show:!1}),P=w()(z,2),E=P[0],k=P[1],_=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){k(function(T){return K()(K()({},T),{},{type:"agent",show:!0})})},children:h.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){k(function(T){return K()(K()({},T),{},{type:"workflow",show:!0})})},children:h.formatMessage({id:"app.summary.SelectWorkflow"})})}],ne=function(){k(function(T){return K()(K()({},T),{},{show:!1})})},N=function(T){R(!0),k(function(ee){return K()(K()({},ee),{},{checkItem:T.checkItem})}),m.current=E.type,D.current=T.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:E!=null&&(n=E.checkItem)!==null&&n!==void 0&&n.length?g==null||(x=g.current)===null||x===void 0?void 0:x.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:h.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:H?(0,e.jsx)(ra.Z,{menu:{items:_},children:(0,e.jsx)(oa,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:E!=null&&(S=E.checkItem)!==null&&S!==void 0&&S.length?(0,e.jsx)(e.Fragment,{children:m.current=="agent"?(0,e.jsx)(xa,{id:v,appId:D.current,selectApp:E,runid:r,setBoxLoading:R,scrollDom:g,setinputShow:p,setisRun:u}):(0,e.jsx)(wa,{id:v,appId:D.current,selectApp:E,runid:r,setBoxLoading:R,scrollDom:g,setinputShow:p,setisRun:u})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(je.ZP,{className:"flex-1 text-[14px]",onClick:function(){k(function(T){return K()(K()({},T),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),h.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(je.ZP,{className:"flex-1 text-[14px]",onClick:function(){k(function(T){return K()(K()({},T),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),h.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(Je.Z,{show:E.show,nodetype:E.type,popupClose:ne,popupSave:N,checkList:m.current==E.type?E.checkItem:[],zIndex:99,radio:!0})]})},Ca=(0,t.memo)(ba),Ra=o(87740),st=(0,t.memo)(function(d){var a=d.id,n=d.message,x=(0,J.useIntl)(),S=(0,ae.Z)(function(m){return m.setSummaryClick}),h=(0,t.useState)(!0),r=w()(h,2),v=r[0],R=r[1],g=(0,ae.Z)(function(m){return m.summaryClick}),p=(0,ae.Z)(function(m){return m.setSummaryParams});return(0,t.useEffect)(function(){R(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(je.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(D){v&&(p({id:a,message:n}),S(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:x.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(Ra.Z,{className:"text-[14px]"})]})})}),Ma=function(a){var n,x,S,h,r=a.setShow,v=a.inputShow,R=a.setBoxLoading,g=a.setAppRunId,p=a.scrollDom,m=(0,J.useIntl)(),D=(0,t.useState)(!1),F=w()(D,2),M=F[0],H=F[1],u=(0,t.useState)(""),z=w()(u,2),P=z[0],E=z[1],k=(0,t.useState)(""),_=w()(k,2),ne=_[0],N=_[1],A=(0,t.useRef)(""),T=(0,t.useRef)(""),ee=(0,t.useRef)(!1),de=(0,t.useState)(!1),re=w()(de,2),G=re[0],O=re[1],U=(0,t.useState)(null),V=w()(U,2),b=V[0],te=V[1],ce=(0,ae.Z)(function(j){return j.setSummaryClick}),fe=function(){var j=q()(C()().mark(function l(c){var s,i,f,I,Z=arguments;return C()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return s=Z.length>1&&Z[1]!==void 0?Z[1]:{app_run_id:"",corrected_parameter:""},L.next=3,(0,se.Rp)(c,s);case 3:i=L.sent,(i==null?void 0:i.code)==0&&(g(i==null||(f=i.data)===null||f===void 0?void 0:f.app_run_id),T.current=i==null||(I=i.data)===null||I===void 0?void 0:I.app_run_id,s.app_run_id&&(ee.current=!0));case 5:case"end":return L.stop()}},l)}));return function(c){return j.apply(this,arguments)}}(),ie=function(){var j=q()(C()().mark(function l(c,s){var i,f,I,Z,y;return C()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.next=2,(0,se.xM)(c,{message:s});case 2:i=X.sent,(i==null?void 0:i.code)==0&&(T.current=i==null||(f=i.data)===null||f===void 0?void 0:f.app_run_id,g(i==null||(I=i.data)===null||I===void 0?void 0:I.app_run_id),i!=null&&(Z=i.data)!==null&&Z!==void 0&&(Z=Z.outputs)!==null&&Z!==void 0&&Z.value&&(E(i==null||(y=i.data)===null||y===void 0||(y=y.outputs)===null||y===void 0?void 0:y.value),r(!0),R(!1),ce(!0),p.current.scrollTo({top:0})));case 4:case"end":return X.stop()}},l)}));return function(c,s){return j.apply(this,arguments)}}(),Q=function(){var j=q()(C()().mark(function l(){var c;return C()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,se.Gh)({chatroom_id:A.current,app_run_id:T.current});case 2:c=i.sent,c&&c!==null&&c!==void 0&&c.data&&te(c.data);case 4:case"end":return i.stop()}},l)}));return function(){return j.apply(this,arguments)}}(),B=function(l){var c=new Date(l),s=c.getMonth()+1,i=c.getDate(),f=c.getHours(),I=c.getMinutes(),Z=c.getSeconds();return c.getFullYear()+"-"+(s<10?"0"+s:s)+"-"+(i<10?"0"+i:i)+" "+(f<10?"0"+f:f)+":"+(I<10?"0"+I:I)+":"+(Z<10?"0"+Z:Z)},$=(0,He.Z)(function(j){return j.flowMessage});(0,t.useEffect)(function(){var j=$.filter(function(s){return s.data.app_run_id==T.current&&s.type.indexOf("generate_meeting_summary")!==-1});if(j.length!=0){var l,c=(l=j[j.length-1])===null||l===void 0||(l=l.data)===null||l===void 0||(l=l.exec_data)===null||l===void 0||(l=l.outputs)===null||l===void 0?void 0:l.value;c&&(ee.current&&Q(),E(c),O(!1),r(!0),ce(!0),R(!1),p.current.scrollTo({top:0}))}},[$]);var W=(0,ae.Z)(function(j){return j.summaryParams});return(0,t.useEffect)(function(){W&&W.id&&(A.current=W.id,b&&te(null),G&&O(!1),P&&E(""),H(!0),W.message?(R(!0),ie(W.id,W.message)):fe(W.id))},[W]),(0,e.jsx)(e.Fragment,{children:M?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:m.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:P?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],children:b?b==null||(n=b.source_run)===null||n===void 0?void 0:n.summary:P})}),b&&(b==null||(x=b.source_corrections)===null||x===void 0?void 0:x.length)>0||!v?(0,e.jsx)(st,{id:A.current,message:b?b==null||(S=b.source_run)===null||S===void 0?void 0:S.summary:P}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(we.Z,{size:"large"})})}),b&&(b==null||(h=b.source_corrections)===null||h===void 0?void 0:h.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),b.source_corrections.map(function(j,l){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(b.source_corrections.length-1==l?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",j.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),": ",B(j.created_time)]}),(0,e.jsx)(be.U,{rehypePlugins:[Ce.Z],children:j==null?void 0:j.corrected_summary})]})},j.created_time),!v||b.source_corrections.length-1!=l?(0,e.jsx)(st,{id:A.current,message:j==null?void 0:j.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},j.created_time)})]}):(0,e.jsx)(e.Fragment,{}),v?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Qe.Z.TextArea,{onChange:function(l){N(l.target.value)},value:ne,disabled:!P||G,rows:4,placeholder:m.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(je.ZP,{type:"primary",disabled:!P||!ne,loading:G,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){fe(A.current,{app_run_id:String(T.current),corrected_parameter:ne}),O(!0),N(""),r("")},children:m.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},ka=(0,t.memo)(Ma),Fa=o(38027),Ia=function(a){var n,x=a.id,S=(0,t.useState)(""),h=w()(S,2),r=h[0],v=h[1],R=(0,t.useState)(!1),g=w()(R,2),p=g[0],m=g[1],D=(0,t.useState)([]),F=w()(D,2),M=F[0],H=F[1],u=(0,t.useState)(!1),z=w()(u,2),P=z[0],E=z[1],k=(0,t.useState)(!1),_=w()(k,2),ne=_[0],N=_[1],A=(0,t.useState)(""),T=w()(A,2),ee=T[0],de=T[1],re=(0,t.useState)(!1),G=w()(re,2),O=G[0],U=G[1],V=(0,t.useState)(!1),b=w()(V,2),te=b[0],ce=b[1],fe=(0,t.useState)(!0),ie=w()(fe,2),Q=ie[0],B=ie[1],$=(0,t.useRef)(null),W=(0,t.useRef)(1),j=(0,t.useRef)(!1),l=(0,t.useRef)(!0),c=(0,t.useRef)(0),s=(0,t.useState)(!1),i=w()(s,2),f=i[0],I=i[1],Z=(0,ae.Z)(function(Y){return Y.summaryParams}),y=(0,ae.Z)(function(Y){return Y.setSummaryParams}),L=function(){var Y=q()(C()().mark(function oe(){var me,De,le,ze,Me,Ue,ke=arguments;return C()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(me=ke.length>0&&ke[0]!==void 0?ke[0]:!0,De=ke.length>1&&ke[1]!==void 0?ke[1]:!0,!(c.current!=0&&c.current<W.current)){Se.next=5;break}return I(!1),Se.abrupt("return");case 5:return Se.next=8,(0,se.sh)({chatroom_id:x,page:W.current,page_size:10});case 8:le=Se.sent,le.code==0&&(le!=null&&(ze=le.data)!==null&&ze!==void 0&&ze.list&&le!==null&&le!==void 0&&(Me=le.data)!==null&&Me!==void 0&&(Me=Me.list)!==null&&Me!==void 0&&Me.length&&(c.current=le==null||(Ue=le.data)===null||Ue===void 0?void 0:Ue.total_pages,H(function(Ae){return De?ue()(le.data.list.reverse()):[].concat(ue()(le.data.list.reverse()),ue()(Ae))}),m(!0),I(!0),setTimeout(function(){l.current=!0},500)),De&&setTimeout(function(){var Ae;$==null||(Ae=$.current)===null||Ae===void 0||Ae.scrollTo({top:0})},200),me||(v(Z.id),y({})));case 10:case"end":return Se.stop()}},oe)}));return function(){return Y.apply(this,arguments)}}(),X=function(){var Y=q()(C()().mark(function oe(me){return C()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:me.target.scrollHeight+(me.target.scrollTop-me.target.clientHeight)<400&&l.current&&(l.current=!1,I(!0),W.current=W.current+=1,L(!0,!1));case 1:case"end":return le.stop()}},oe)}));return function(me){return Y.apply(this,arguments)}}();(0,t.useEffect)(function(){W.current=1,L()},[x]),(0,t.useEffect)(function(){Z&&Z.id&&(m(!0),Q||B(!0),P&&E(!1),O&&U(!1),W.current=1,N(!0),L(!1),j.current=!0)},[Z]);var ve=(0,ae.Z)(function(Y){return Y.setOrientationShow});return(0,t.useEffect)(function(){p&&ve(!0)},[p]),(0,e.jsx)(e.Fragment,{children:p?(0,e.jsxs)(Gt.Z,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(O?"translate-x-full flex-[0]":""),children:[te?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(we.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){U(function(oe){return!oe})},className:`
                                        `.concat(O?"fixed right-[100%] top-[60px]":"absolute right-[99%] top-[60px]",`
                                        history_packup
                                        hover:text-[#1B64F3]
                                         w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                                    `),children:O?(0,e.jsx)(na,{className:"text-[18px]"}):(0,e.jsx)(Yt,{className:"text-[18px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:X,ref:$,children:[(0,e.jsxs)("div",{children:[M.length?(0,e.jsx)(Fa.ZP,{id:x,runid:ee,scrollDom:$,list:M,historyHeight:j.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:ne?$==null||(n=$.current)===null||n===void 0?void 0:n.offsetHeight:""},children:[(0,e.jsx)(ka,{setShow:E,inputShow:Q,setBoxLoading:ce,setAppRunId:de,scrollDom:$}),P?(0,e.jsx)(Ca,{id:r,runid:ee,setBoxLoading:ce,scrollDom:$,setinputShow:B}):(0,e.jsx)(e.Fragment,{})]})]}),f?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(we.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},Za=(0,t.memo)(Ia),Aa=function(a){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(xe.Z,{image:xe.Z.PRESENTED_IMAGE_SIMPLE})})},Da=(0,t.memo)(function(){var d=(0,J.useParams)(),a=d.id,n=(0,t.useRef)([]),x=(0,t.useRef)(null),S=(0,t.useState)(!1),h=w()(S,2),r=h[0],v=h[1],R=function(){var g=q()(C()().mark(function p(){var m;return C()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!a){F.next=5;break}return F.next=3,(0,se.cH)({id:a});case 3:m=F.sent,m.code==0?(v(!0),x.current=m.data,n.current=m.data.agent_list):J.history.replace("/meeting");case 5:case"end":return F.stop()}},p)}));return function(){return g.apply(this,arguments)}}();return(0,t.useEffect)(function(){R()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden overflow-x-auto",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(ft,{roomDetail:x.current,setAgent:n}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:r?(0,e.jsx)(Wt,{agentList:n}):(0,e.jsx)(Aa,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Za,{id:a})})]})})}),Oa=Da}}]);
