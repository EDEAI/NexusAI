"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[142,735],{36711:function(ot,ye,t){t.r(ye),t.d(ye,{waitTime:function(){return v},waitTimePromise:function(){return Ne}});var Re=t(97857),b=t.n(Re),Oe=t(5574),_e=t.n(Oe),Be=t(15009),de=t.n(Be),He=t(99289),Pe=t.n(He),Ue=t(42237),je=t(29608),De=t(32592),V=t(35312),xe=t(67294),Ve=t(85893),Ne=function(){var k=Pe()(de()().mark(function l(){var e,Q=arguments;return de()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return e=Q.length>0&&Q[0]!==void 0?Q[0]:100,K.abrupt("return",new Promise(function(J){setTimeout(function(){J(!0)},e)}));case 2:case"end":return K.stop()}},l)}));return function(){return k.apply(this,arguments)}}(),v=function(){var k=Pe()(de()().mark(function l(){var e,Q=arguments;return de()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return e=Q.length>0&&Q[0]!==void 0?Q[0]:100,K.next=3,Ne(e);case 3:case"end":return K.stop()}},l)}));return function(){return k.apply(this,arguments)}}();ye.default=function(){var k=(0,V.useIntl)(),l=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:k.formatMessage({id:"workflow.toName",defaultMessage:""}),dataIndex:"app_runs_name",ellipsis:!0,fieldProps:{onChange:function(fe){var x;ce==null||(x=ce.current)===null||x===void 0||x.submit()}}},{title:k.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:k.formatMessage({id:"workflow.created_time_des",defaultMessage:k.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{disable:!0,title:k.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"app_runs_status",filters:!0,onFilter:!0,ellipsis:!0,valueType:"select",fieldProps:{onChange:function(fe){var x;ce==null||(x=ce.current)===null||x===void 0||x.submit()}},valueEnum:{1:{text:k.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:k.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:k.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:"".concat(k.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:k.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:k.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,key:"user"}],e=(0,V.useSearchParams)(),Q=_e()(e,1),Ze=Q[0],K=(0,je.Z)(function(q){return q.setRunPanelLogRecord}),J=Ze.get("app_id"),ce=(0,xe.useRef)(null);return(0,Ve.jsx)(De.Z,{columns:l,formRef:ce,form:{submitter:!1},cardBordered:!0,request:function(){var q=Pe()(de()().mark(function fe(x,We,N){var Y;return de()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return console.log(x,We,N),pe.next=3,(0,Ue.bB)(b()(b()({app_runs_name:"",app_runs_status:0},x),{},{app_id:J}));case 3:return Y=pe.sent,console.log(Y),pe.abrupt("return",{data:Y.data.list,success:!0,total:Y.data.total_count});case 6:case"end":return pe.stop()}},fe)}));return function(fe,x,We){return q.apply(this,arguments)}}(),onRow:function(fe){return{onClick:function(){console.log("Row clicked:",fe),K(fe)}}},editable:{type:"multiple"},rowKey:"app_runs_id",search:{labelWidth:"auto"},options:{setting:{listsHeight:600}},pagination:{pageSize:12,showSizeChanger:!1},dateFormatter:"string",headerTitle:k.formatMessage({id:"workflow.workflowLog",defaultMessage:""})})}},23677:function(ot,ye,t){t.r(ye),t.d(ye,{default:function(){return Lt}});var Re=t(5574),b=t.n(Re),Oe=t(47520),_e=t(36711),Be=t(82826),de=t(43425),He=t(48869),Pe=t(69243),Ue=t(91806),je=t(34994),De=t(52688),V=t(35312),xe=t(77598),Ve=t(55241),Ne=t(50136),v=t(67294),k=t(10899),l=t(1096),e=t(85893),Q=function(){var c,i=(0,V.useIntl)(),S=(0,v.useState)(!0),A=b()(S,2),p=A[0],r=A[1],g=(0,l.Z)(function(m){return m.setWorkflowEditInfo}),u=(0,l.Z)(function(m){return m.workFlowInfo}),W=(0,l.Z)(function(m){return m.setSelect}),ee=(0,v.useState)("1"),G=b()(ee,2),le=G[0],te=G[1],n=(0,v.useState)(!1),ne=b()(n,2),ie=ne[0],H=ne[1],h=(0,k.Z)(),E=(0,v.useRef)(null),a=function(){var C,P;return(0,e.jsx)("div",{className:"",children:(0,e.jsx)("div",{className:"w-[240px]  ",children:(0,e.jsxs)(je.A,{formRef:E,submitter:{render:function(){return null}},onValuesChange:I,layout:"horizontal",children:[(0,e.jsx)(De.Z,{name:"is_public",label:i.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(De.Z,{tooltip:(u==null||(C=u.app)===null||C===void 0?void 0:C.publish_status)!="1"?{title:i.formatMessage({id:"component.tooltip.publishWorkflowFirst",defaultMessage:""})}:null,formItemProps:{className:"mb-0"},disabled:(u==null||(P=u.app)===null||P===void 0?void 0:P.publish_status)!="1",name:"enable_api",label:"API"})]})})})},w=[{key:"4",icon:(0,e.jsx)(Be.Z,{}),label:i.formatMessage({id:"component.menu.backToPreviousPage",defaultMessage:""})},{key:"0",icon:u!=null&&u.isProd?(0,e.jsx)(de.Z,{}):(0,e.jsx)(Ve.Z,{content:a,trigger:"click",forceRender:!0,placement:"rightTop",title:i.formatMessage({id:"component.menu.setting",defaultMessage:""}),children:(0,e.jsx)(de.Z,{})}),label:i.formatMessage({id:"component.menu.setting",defaultMessage:""}),disabled:u==null?void 0:u.isProd},{key:"1",icon:(0,e.jsx)(He.Z,{}),label:i.formatMessage({id:"component.menu.arrange",defaultMessage:""})},{key:"2",icon:(0,e.jsx)(Pe.Z,{}),label:i.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}),title:ie?i.formatMessage({id:"component.menu.accessAPI",defaultMessage:"API"}):i.formatMessage({id:"component.tooltip.enableAPIFirst",defaultMessage:"API"}),disabled:!ie},{key:"3",icon:(0,e.jsx)(Ue.Z,{}),label:i.formatMessage({id:"component.menu.log",defaultMessage:""})}];(0,xe.Z)(function(){if(u){var m,C,P,F,z=u==null||(m=u.app)===null||m===void 0?void 0:m.is_public,Te=u==null||(C=u.app)===null||C===void 0?void 0:C.enable_api,oe={};oe.is_public=!!z,oe.enable_api=(u==null||(P=u.app)===null||P===void 0?void 0:P.publish_status)=="1"?!!Te:!1,console.log(oe),H(oe.enable_api),E==null||(F=E.current)===null||F===void 0||F.setFieldsValue(oe)}},[u]);var I=function(C,P){console.log(C,P),M(P.enable_api),g(P),setTimeout(h,300)},M=function(C){H(!!C)},ae=function(C){var P;switch(C.key){case"4":V.history.go(-1);break;case"0":break;case"2":window.open(Oe._n+(u==null||(P=u.app)===null||P===void 0?void 0:P.api_url),"_blank");break;default:W(""),te(C.key)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"fixed left-[0px] top-16 mt-2 transition-all duration-300 z-20",children:[(0,e.jsx)(Ne.Z,{defaultSelectedKeys:["1"],selectedKeys:[le],className:"w-10 rounded-md",mode:"vertical",inlineCollapsed:p,items:w,onClick:ae}),le=="0"&&(0,e.jsx)("div",{className:"absolute top-0 left-full ml-2",children:(0,e.jsx)("div",{className:"w-[240px]  bg-white  rounded-md p-4 border border-gray-200",children:(0,e.jsxs)(je.A,{formRef:E,submitter:{render:function(){return null}},onValuesChange:I,layout:"horizontal",children:[(0,e.jsx)(De.Z,{name:"is_public",label:i.formatMessage({id:"component.label.teamVisible",defaultMessage:""})}),(0,e.jsx)(De.Z,{disabled:!(u!=null&&(c=u.app)!==null&&c!==void 0&&c.api_url),name:"enable_api",label:"API"})]})})})]}),le=="3"&&(0,e.jsx)("div",{className:"fixed right-0 top-[56px]   pl-12 pt-4 pr-2 bg-white z-10",style:{height:"calc(100vh - 56px)"},children:(0,e.jsx)("div",{className:"bg-white rounded-md h-full",children:(0,e.jsx)(_e.default,{})})})]})},Ze=Q,K=t(15009),J=t.n(K),ce=t(99289),q=t.n(ce),fe=t(97857),x=t.n(fe),We=t(32060),N=t(42237),Y=t(63648),rt=t(16091),pe=t(13118),Qe=t(78234),Ie=t(45360),st=t(85576),re=t(71471),lt=t(64599),it=t.n(lt),$e=t(7493),ut=t(34559),se=t(96906),Rt=function(c){return{nodes:c.nodes,edges:c.edges,onNodesChange:c.onNodesChange,onEdgesChange:c.onEdgesChange,onConnect:c.onConnect,nodeTypes:c.nodeTypes,connectionLineStyle:c.connectionLineStyle,defaultViewport:c.defaultViewport,onDrop:c.onDrop,onDragOver:c.onDragOver,setSelect:c.setSelect,preventScrolling:c.preventScrolling}},dt=(0,v.memo)(function(T){var c=T.children,i=(0,V.useIntl)(),S=(0,l.Z)(function(a){return a.nodes}),A=(0,l.Z)(function(a){return a.getEdges}),p=(0,l.Z)(function(a){return a.edges}),r=(0,l.Z)(function(a){return a.setEdges}),g=(0,l.Z)(function(a){return a.onNodesChange}),u=(0,l.Z)(function(a){return a.onEdgesChange}),W=(0,l.Z)(function(a){return a.onConnect}),ee=(0,l.Z)(function(a){return a.nodeTypes}),G=(0,l.Z)(function(a){return a.connectionLineStyle}),le=(0,l.Z)(function(a){return a.defaultViewport}),te=(0,l.Z)(function(a){return a.onDrop}),n=(0,l.Z)(function(a){return a.onDragOver}),ne=(0,l.Z)(function(a){return a.setSelect}),ie=(0,l.Z)(function(a){return a.preventScrolling}),H=(0,v.useCallback)(function(a){var w=S.find(function(M){return M.id===a.target}),I=function M(ae){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(m.has(ae.id))return!1;m.add(ae.id);var C=it()((0,$e.xA)(ae,S,p)),P;try{for(C.s();!(P=C.n()).done;){var F=P.value;if(F.id===a.source||M(F,m))return!0}}catch(z){C.e(z)}finally{C.f()}};return w.id===a.source?!1:!I(w)},[S,p]),h=function(){},E=(0,v.useCallback)(function(a,w){console.log(a,w,A(),(0,$e.Kz)(a,w,p)),r((0,$e.Kz)(a,w,A()))},[]);return(0,xe.Z)(function(){},[S]),(0,e.jsx)(ut.tV,{children:(0,e.jsx)(Y.x$,{onViewportChange:h,nodes:S,edges:p,onNodesChange:g,onEdgesChange:u,onEdgesDelete:function(w){},onConnect:W,onReconnect:E,nodeTypes:ee,minZoom:.3,maxZoom:1,connectionLineStyle:G,snapToGrid:!1,isValidConnection:H,connectionRadius:30,preventScrolling:ie,onDragOver:n,onPaneClick:function(){ne("")},onPaneContextMenu:function(w){w.preventDefault()},onSelectionChange:function(w){},onNodeClick:function(w,I){ne(I.id)},onEdgeClick:function(w,I){},deleteKeyCode:["Delete","Backspace"],onNodesDelete:function(w){},onBeforeDelete:function(){var a=q()(J()().mark(function w(I){var M;return J()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if((I==null||(M=I.nodes)===null||M===void 0||(M=M[0])===null||M===void 0?void 0:M.type)!=se.vW.Start){m.next=3;break}return Ie.ZP.error(i.formatMessage({id:"workflow.delStartNodeError"})),m.abrupt("return",Promise.reject(i.formatMessage({id:"workflow.delStartNodeError"})));case 3:return ne(""),m.abrupt("return",Promise.resolve(I));case 5:case"end":return m.stop()}},w)}));return function(w){return a.apply(this,arguments)}}(),fitView:!0,children:c})})}),ct=function(c){var i=(0,v.useCallback)(function(p){p.preventDefault(),p.dataTransfer.dropEffect="move"},[]),S=(0,v.useCallback)(function(p){p.preventDefault();var r=p.dataTransfer.getData("application/reactflow");if(!r)return null;var g=JSON.parse(r),u=g.type,W=g.item;if(!u||!W)return null;var ee=c({x:p.clientX,y:p.clientY});return{position:ee,type:u,item:W}},[c]),A=(0,v.useCallback)(function(p){var r=function(u){var W=S(u);W&&p(W.position,W.type,W.item)};return document.addEventListener("dragover",i),document.addEventListener("drop",r),function(){document.removeEventListener("dragover",i),document.removeEventListener("drop",r)}},[i,S]);return{onDnD:A}},ft=ct,vt=function(){var c=(0,l.Z)(function(r){return r.setAgentData}),i=(0,l.Z)(function(r){return r.setSkillData}),S=(0,l.Z)(function(r){return r.setToolData}),A=(0,l.Z)(function(r){return r.setDatasetData}),p=(0,l.Z)(function(r){return r.setTeamDatasetData});(0,v.useEffect)(function(){(0,N.x$)(2).then(function(r){r.code===0&&c({team:r.data})}),(0,N.x$)(3).then(function(r){r.code===0&&c({user:r.data})}),(0,N.w)(2).then(function(r){r.code===0&&i({team:r.data})}),(0,N.w)(3).then(function(r){r.code===0&&i({user:r.data})}),(0,N.GZ)().then(function(r){r.code===0&&S({list:Object.values(r.data)})}),(0,N.mG)().then(function(r){r.code==0&&A({list:r.data.data.map(function(g){return x()(x()({},g),{},{label:g.name,value:g.dataset_id})})})}),(0,N.mG)(2).then(function(r){r.code==0&&p({list:r.data.data.map(function(g){return x()(x()({},g),{},{label:g.name,value:g.dataset_id})})})})},[c,i,S])},mt=vt,pt=t(83065),gt=t(39944),Ke=t(10759),ke=t(55927),ht=t(33914),xt=t(88284),wt=t(28508),qe=t(90672),Mt=t(46822),yt=t(97462),jt=t(64317),Dt=t(29933),St=t(3917),bt=t(40056),et=t(2487),we=t(28036),Ct=t(96486),tt=t.n(Ct),Se=t(29432),Ae=t(92485),_t=re.Z.Text,Bt=bt.Z.ErrorBoundary,Pt=(0,v.memo)(function(){var T,c,i=(0,V.useIntl)(),S=(0,v.useState)(!1),A=b()(S,2),p=A[0],r=A[1],g=(0,ke.Z)(function(s){return s.dealtWithData}),u=(0,ke.Z)(function(s){return s.setDealtWithData}),W=(0,ke.Z)(function(s){return s.setFlowMessage}),ee=(0,ke.Z)(function(s){return s.getNeedHumanConfirmMessage}),G=(0,ke.Z)(function(s){return s.flowMessage}),le=(0,v.useState)(null),te=b()(le,2),n=te[0],ne=te[1],ie=(0,v.useState)(""),H=b()(ie,2),h=H[0],E=H[1],a=(0,v.useState)(!1),w=b()(a,2),I=w[0],M=w[1],ae=(0,v.useState)(""),m=b()(ae,2),C=m[0],P=m[1],F=(0,St.Z)(N.N7,{manual:!0}),z=F.loading,Te=F.runAsync;(0,v.useEffect)(function(){var s;r(!!g);var d=g==null||(s=g.data)===null||s===void 0||(s=s.node_exec_data)===null||s===void 0?void 0:s.node_exec_id;return console.log(g,d),E(d),d&&oe(d),function(){r(!1)}},[g]);var oe=function(d){z||Te(d).then(function(f){f.data&&(ne(f.data),d!=C&&(M(!1),P(d)))})};(0,xe.Z)(function(){console.log(G,h);var s=G.find(function(d){var f;return(d==null||(f=d.data)===null||f===void 0||(f=f.node_exec_data)===null||f===void 0?void 0:f.node_exec_id)==h});console.log(s),s&&oe(h)},[G.length]);var be=function(d){M(!0),(0,N.YX)(h,{correct_prompt:new gt.N("",d.prompt,""),operation:1,outputs:(n==null?void 0:n.outputs)||null}).then(function(f){f.code==0&&(Me(h),E(f.data.exec_id))})},Me=function(d){var f=G.filter(function(j){var Z;return!((j==null||(Z=j.data)===null||Z===void 0||(Z=Z.node_exec_data)===null||Z===void 0?void 0:Z.node_exec_id)==d&&(j==null?void 0:j.type)=="workflow_need_human_confirm")});W(f)},Fe=function(){(0,N.YX)(h,{operation:0,outputs:(n==null?void 0:n.outputs)||null}).then(function(d){d.code==0&&(r(!1),Me(h),u(null))})},Ge=(0,v.useCallback)(function(){var s,d,f=g==null||(s=g.data)===null||s===void 0||(s=s.node_exec_data)===null||s===void 0?void 0:s.node_type;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[f!=se.vW.LLM&&(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"input"})}),(n==null||(d=n.correct_llm_history)===null||d===void 0?void 0:d.length)>0&&(0,e.jsx)(et.Z,{header:(0,e.jsx)(re.Z.Title,{level:5,children:i.formatMessage({id:"workflow.historyPrompt",defaultMessage:"prompt"})}),dataSource:n==null?void 0:n.correct_llm_history,renderItem:function(Z){var L;return(0,e.jsx)(et.Z.Item,{children:Z==null||(L=Z.correct_prompt)===null||L===void 0||(L=L.user)===null||L===void 0?void 0:L.value})}}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.outputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"output"})})]}),(0,e.jsx)(je.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:i.formatMessage({id:"workflow.xz"})}},loading:I,onFinish:be,children:(0,e.jsx)("div",{className:"flex ",children:(0,e.jsxs)("div",{className:"flex-1 pt-2 border-stone-300 border rounded-md my-2",children:[(0,e.jsxs)("div",{className:"px-2 flex justify-between cursor-default",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"text-sm text-gray-500 font-bold pb-1",children:"Prompt"})}),(0,e.jsx)("div",{})]}),(0,e.jsx)("div",{className:" pb-6 user-input-error",children:(0,e.jsx)(qe.Z,{formItemProps:{className:"mb-0"},name:"prompt",required:!0,rules:[{required:!0,message:i.formatMessage({id:"workflow.requireInputPrompt"})}],fieldProps:{variant:"borderless",placeholder:i.formatMessage({id:"workflow.requireInputPrompt"}),autoSize:{minRows:2,maxRows:40},count:{show:function(Z){var L=Z.value,ve=Z.count,$=Z.maxLength;return(0,e.jsx)("div",{className:"pr-2 text-blue-400",children:ve})}}}})})]})})})]})},[n]),ze=(0,v.useCallback)(function(){var s,d,f,j=n==null||(s=n.node_graph)===null||s===void 0||(s=s.data)===null||s===void 0?void 0:s.input,Z=j==null?void 0:j.properties,L=n==null||(d=n.node_graph)===null||d===void 0||(d=d.data)===null||d===void 0?void 0:d.requires_upload,ve=n==null||(f=n.node_graph)===null||f===void 0||(f=f.data)===null||f===void 0||(f=f.import_to_knowledge_base)===null||f===void 0?void 0:f.input;console.log("requires_upload",n,L);var $=(0,l.Z)(function(o){return o.datasetData});if(!Z)return(0,e.jsx)(e.Fragment,{children:i.formatMessage({id:"workflow.requireInputPrompt",defaultMessage:""})});var ge=Object.values(Z),ue=function(y){var D;console.log(y);var U=(0,Ke.vV)(j);if(ge.length>0){var he=Object.entries(y).filter(function(R){var _=b()(R,2),me=_[0],B=_[1];return me.startsWith("variables.")});he.forEach(function(R){var _=b()(R,2),me=_[0],B=_[1];U.properties[me.replace("variables.","")].value=B})}var O=new Ke.V7(Se.Mp,"array[number]");y.file&&y.file.forEach(function(R){var _,me=new Ke._w(R.uid,"number",(R==null||(_=R.response)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.file_id)||0);O.addValue(me)}),U.addProperty(Se.Mp,O),console.log(U,O);var X=(n==null||(D=n.node_graph)===null||D===void 0||(D=D.data)===null||D===void 0?void 0:D.knowledge_base_mapping)||{input:{},output:{}};Object.entries(y).forEach(function(R){var _=b()(R,2),me=_[0],B=_[1];me.startsWith("dataset.")&&(X.input[Se.Mp]||(X.input[Se.Mp]={}),X.input[Se.Mp][me.replace("dataset.","")]=B)}),console.log(X),(0,N.YX)(h,{operation:0,inputs:U,outputs:null,correct_prompt:null,knowledge_base_mapping:X}).then(function(R){R.code==0&&(r(!1),u(null),Me(h))})},Ee={icon:(0,e.jsx)(ht.Z,{}),title:i.formatMessage({id:"workflow.uploadFileText",defaultMessage:"\uFF0C"}),description:i.formatMessage({id:"workflow.uploadFileDes"}),accept:".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv",fieldProps:{listType:"picture",name:"file",multiple:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},action:pt.M$,beforeUpload:function(y){var D=y.size/1024/1024<15;return D||Ie.ZP.error(i.formatMessage({id:"workflow.uploadFileErrorText"})),D}}};return(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsxs)(je.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:i.formatMessage({id:"workflow.checked",defaultMessage:""})}},onFinish:ue,children:[ge.map(function(o){return(0,e.jsx)(qe.Z,{label:o.display_name,name:"variables.".concat(o.name),required:o.required,rules:[{required:o.required,message:i.formatMessage({id:"workflow.toInput"})}]},o.name)}),L&&(0,e.jsx)(Mt.Z,x()({name:"file"},Ee)),(0,e.jsx)(yt.Z,{name:["file"],children:function(y){var D=y.file;return ve&&(D==null?void 0:D.length)>0&&(D==null?void 0:D.map(function(U){return(0,e.jsx)(jt.Z,{label:U.name,name:"dataset.".concat(U.uid),options:($==null?void 0:$.list)||[],required:!0,rules:[{required:!0,message:i.formatMessage({id:"workflow.select_to_knowledge_base"})}]},U.uid)}))||null}})]})})},[n]),Ce=function(d){if(d.type!=="object"||!d.properties)return[d];var f=[],j=function Z(L){var ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";tt().forOwn(L,function($,ge){var ue=ve?"".concat(ve,".").concat(ge):ge;$.type==="object"&&$.properties?Z($.properties,ue):f.push(x()(x()({},$),{},{name:ue}))})};return j(d.properties),f},Je=function(d){return d.reduce(function(f,j){return f[j.name]=j.value,f},{})},Ye=(0,v.useCallback)(function(){console.log(n);var s=n==null?void 0:n.inputs,d=(0,v.useRef)(null),f=(0,v.useState)([]),j=b()(f,2),Z=j[0],L=j[1],ve=(0,v.useState)({}),$=b()(ve,2),ge=$[0],ue=$[1],Ee=Ie.ZP.useMessage(),o=b()(Ee,2),y=o[0],D=o[1];(0,Qe.Z)(function(){n!=null&&n.outputs&&(console.log(s,Ce(n==null?void 0:n.outputs)),L(Ce(n==null?void 0:n.outputs)),ue(JSON.stringify(Ce(n==null?void 0:n.outputs))))});var U=function(){var O={};try{O=JSON.parse(ge),console.log(O,O[0]),(0,N.YX)(h,{outputs:tt().isArray(O)?O[0]:O}).then(function(X){X.code==0&&(y.success(i.formatMessage({id:"workflow.checkSc",defaultMessage:""})),r(!1),Me(h),u(null))})}catch(X){console.log(X),y.error(i.formatMessage({id:"workflow.checkOutputMessageError",defaultMessage:","}))}};return(0,e.jsxs)("div",{children:[D,(0,e.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[!Se.eT.includes(n==null?void 0:n.node_type)&&(0,e.jsxs)("div",{children:[(0,e.jsx)(re.Z.Title,{level:5,children:"Inputs"}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.inputs,readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(O){ue(O)}})})]}),(0,e.jsxs)(re.Z.Title,{level:5,children:["Outputs(",i.formatMessage({id:"workflow.toEdit",defaultMessage:""}),")"]}),(0,e.jsx)("div",{className:"h-80",children:(0,e.jsx)(Ae.Z,{language:"python3",value:n==null?void 0:n.outputs,isJSONStringifyBeauty:!0,onChange:function(O){ue(O)}})}),(0,e.jsx)(we.ZP,{type:"primary",onClick:U,className:"w-full mt-4",children:i.formatMessage({id:"workflow.checked",defaultMessage:""})})]})]})},[n]),Xe=(0,v.useCallback)(function(){var s=n==null?void 0:n.node_type;return s==se.vW.Human?(0,e.jsx)(ze,{}):s==se.vW.LLM||s==se.vW.Agent||s==se.vW.TaskGeneration?(0,e.jsx)(Ge,{}):(0,e.jsx)(Ye,{})},[n]),Le=function(){var d=n==null?void 0:n.node_type;return d==se.vW.LLM||d==se.vW.Agent||d==se.vW.TaskGeneration?(0,e.jsx)(we.ZP,{type:"text",onClick:Fe,className:"text-green-500",disabled:I,icon:(0,e.jsx)(xt.Z,{}),children:i.formatMessage({id:"workflow.checkBackLogs",defaultMessage:""})}):null};return p?(0,e.jsx)(Dt.Z,{className:"w-[400px] border border-blue-300 fixed z-10  top-[105px] right-2 ",style:{height:"calc(100vh - 10px - 100px)"},extra:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(Le,{}),(0,e.jsx)(we.ZP,{onClick:function(){r(!1),u(null)},type:"text",icon:(0,e.jsx)(wt.Z,{})})]}),title:(0,e.jsx)(re.Z.Title,{level:5,children:i.formatMessage({id:"workflow.backlogs",defaultMessage:""})}),bodyStyle:{overflowY:"auto",marginTop:"20px",boxSizing:"border-box"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Title,{level:5,children:n==null||(T=n.node_graph)===null||T===void 0||(T=T.data)===null||T===void 0?void 0:T.title})}),(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{children:n==null||(c=n.node_graph)===null||c===void 0||(c=c.data)===null||c===void 0?void 0:c.desc})}),Xe()]})}):null}),nt=t(55877),Zt=t(94791),It=t(74842),kt=t(98165),Tt=t(58638),Et=t(27484),Ot=t.n(Et),Nt=(0,v.memo)(function(){var T=(0,V.useIntl)(),c=(0,V.useSearchParams)(),i=b()(c,1),S=i[0],A=(0,l.Z)(function(h){return h.setWorkFlowInfo}),p=(0,l.Z)(function(h){return h.workFlowInfo}),r=(0,l.Z)(function(h){return h.setRunPanelShow}),g=S.get("type")=="true",u=(0,k.Z)(),W=Ie.ZP.useMessage(),ee=b()(W,2),G=ee[0],le=ee[1],te=function(){var E=S.get("app_id");(0,N.aJ)(E).then(function(a){console.log(a),a.code==0&&(A(x()(x()({},p),{},{app:x()(x()({},p==null?void 0:p.app),{},{publish_status:"1"})})),G.open({type:"success",content:T.formatMessage({id:"workflow.releaseSuc"})}))})},n=function(){r(!0)},ne=function(){var h=q()(J()().mark(function E(){var a,w;return J()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return a=S.get("app_id"),M.next=3,(0,N.Uq)(a);case 3:w=M.sent;case 4:case"end":return M.stop()}},E)}));return function(){return h.apply(this,arguments)}}(),ie=function(){var h=q()(J()().mark(function E(){var a,w,I,M;return J()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:w=S.get("app_id"),I=(p==null||(a=p.app)===null||a===void 0?void 0:a.name)||"workflow",M=Ot()().format("YYYY_MM_DD-HH_mm_ss"),(0,N.w8)(w,g==!0?1:0).then(function(C){var P=new Blob([C],{type:"text/yaml"}),F=URL.createObjectURL(P),z=document.createElement("a");z.href=F,z.download="".concat(I,"_").concat(M,".yml"),document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(F)});case 4:case"end":return m.stop()}},E)}));return function(){return h.apply(this,arguments)}}(),H={name:"file",fileList:null,action:Oe._n+"/v1/workflow/import",accept:".yml",multiple:!1,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}};return(0,e.jsxs)("div",{className:"fixed right-2 top-16 flex gap-2",children:[!g&&(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(we.ZP,{type:"primary",onClick:te,children:T.formatMessage({id:"workflow.release"})}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(It.Z,{}),onClick:n,children:T.formatMessage({id:"workflow.run"})}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(kt.Z,{}),type:"dashed",onClick:u,children:T.formatMessage({id:"workflow.save"})})]}),(0,e.jsx)(we.ZP,{icon:(0,e.jsx)(Tt.Z,{}),type:"dashed",onClick:ie,children:T.formatMessage({id:"workflow.export",defaultMessage:""})}),le]})}),Wt=function(){var c,i,S=(0,V.useIntl)(),A=(0,v.useRef)(null),p=(0,l.Z)(function(o){return o.resetNodes}),r=(0,l.Z)(function(o){return o.setNodeTypes}),g=(0,l.Z)(function(o){return o.addNode}),u=(0,l.Z)(function(o){return o.createNode}),W=(0,l.Z)(function(o){return o.setNodes}),ee=(0,l.Z)(function(o){return o.setEdges}),G=(0,l.Z)(function(o){return o.setAppId}),le=(0,l.Z)(function(o){return o.setRunPanelShow}),te=(0,l.Z)(function(o){return o.runPanelShow}),n=(0,l.Z)(function(o){return o.getModelData}),ne=(0,l.Z)(function(o){return o.setWorkFlowInfo}),ie=(0,l.Z)(function(o){return o.setHandleList}),H=(0,l.Z)(function(o){return o.workFlowInfo}),h=(0,l.Z)(function(o){return o.setWorkflowEditInfo}),E=Ie.ZP.useMessage(),a=b()(E,2),w=a[0],I=a[1],M=(0,Y._K)(),ae=M.screenToFlowPosition,m=M.getNodes,C=M.setViewport,P=ft(ae),F=P.onDnD,z=(0,V.useSearchParams)(),Te=b()(z,1),oe=Te[0],be=oe.get("type")=="true",Me=(0,Y.B)({includeHiddenNodes:!1}),Fe=(0,pe.Z)(),Ge=(0,k.Z)(),ze=(0,v.useState)(null),Ce=b()(ze,2),Je=Ce[0],Ye=Ce[1],Xe=(0,v.useState)(!1),Le=b()(Xe,2),s=Le[0],d=Le[1],f=(0,v.useState)(""),j=b()(f,2),Z=j[0],L=j[1],ve=null;(0,Y.CV)({onEnd:function(y){}}),(0,Qe.Z)(function(){r((0,Zt.$P)()),p(),(0,We.b6)(),$(),ie([])}),mt(),(0,v.useEffect)(function(){if(Je){V.history.push(Z);return}var o=V.history.block(function(y,D){if(te){L(y.location.pathname),d(!0);return}});return te||o==null||o(),function(){o==null||o()}},[te,Je]),(0,xe.Z)(function(){if(Me){var o=m(),y=o[o.length-1];y.data.drag&&(y.position={x:y.position.x-y.measured.width/2,y:y.position.y-y.measured.height/2},W(o))}},[Me]),(0,v.useEffect)(function(){var o=F(function(y,D,U){console.log(y,D,U),u(D,{position:y,data:x()(x()({drag:!0},U.data),{},{baseData:U.baseData})})});return o},[F,g]),(0,xe.Z)(function(){Fe=="hidden"&&Ge()},[Fe]);var $=function(){var o=q()(J()().mark(function y(){var D;return J()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:D=oe.get("app_id"),be&&w.open({type:"warning",content:S.formatMessage({id:"workflow.nodeRunOtherMessage"}),duration:10}),G(D),(0,N.kE)(D,be?1:0).then(function(O){if(O.code==0){if(ne(x()(x()({},O.data),{},{isProd:be})),!O.data.workflow.graph){u(se.vW.Start);return}var X=O.data,R=X.workflow.graph,_=R.edges,me=R.nodes,B=R.views,at=X.app;h({enable_api:!!at.enable_api,is_public:!!at.is_public}),B!=null&&B.nodes&&W(B.nodes),B!=null&&B.edges&&ee(B.edges),B!=null&&B.viewPort}}),n();case 5:case"end":return he.stop()}},y)}));return function(){return o.apply(this,arguments)}}(),ge=function(){le(!0)},ue=function(){Ye(!0),console.log(Z),V.history.push(Z),d(!1)},Ee=function(){d(!1)};return(0,e.jsxs)("div",{className:"dndflow",children:[I,(0,e.jsx)(st.Z,{title:S.formatMessage({id:"workflow.modal.title",defaultMessage:""}),open:s,onOk:ue,onCancel:Ee,children:S.formatMessage({id:"workflow.modal.content",defaultMessage:""})}),(0,e.jsx)("div",{className:"reactflow-wrapper",ref:A,children:(0,e.jsxs)(dt,{children:[(0,e.jsx)(Y.Aq,{}),(0,e.jsx)("div",{children:(0,e.jsx)(Y.a9,{className:"table",nodeColor:"#1890ff",position:"bottom-left",maskStrokeWidth:3,pannable:!0,nodeStrokeWidth:3})})]})}),(0,e.jsxs)("div",{className:"fixed left-8 top-16 flex  flex-col gap-2 pt-3 pl-4",children:[(0,e.jsx)(re.Z.Title,{className:"!m-0",level:5,children:H==null||(c=H.app)===null||c===void 0?void 0:c.name}),be&&(0,e.jsxs)(re.Z.Text,{children:["( ",S.formatMessage({id:"workflow.nodeRunOtherMessage"}),")"]}),(0,e.jsx)(re.Z.Text,{children:H==null||(i=H.app)===null||i===void 0?void 0:i.description})]}),(0,e.jsx)(Nt,{}),(0,e.jsx)(nt.s_,{}),(0,e.jsx)(nt.Jf,{}),(0,e.jsx)(Pt,{})]})},At=(0,v.memo)(function(){return(0,e.jsx)(Y.tV,{children:(0,e.jsx)(Wt,{})})}),Ft=function(){return(0,e.jsxs)("div",{style:{height:"calc(100vh - 56px)"},className:"w-full relative overflow-x-auto",children:[(0,e.jsx)(Ze,{}),(0,e.jsx)(At,{})]})},Lt=Ft}}]);
