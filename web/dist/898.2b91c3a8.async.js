"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[898],{11551:function(ue,S,t){t.d(S,{CU:function(){return Z},CY:function(){return F},Ce:function(){return O},Dh:function(){return p},Iw:function(){return x},LH:function(){return U},My:function(){return $},Nj:function(){return L},XB:function(){return _},ek:function(){return f},pC:function(){return z},zl:function(){return V}});var H=t(15009),u=t.n(H),G=t(99289),o=t.n(G),c=t(47520),m="/v1/agent/agent_info/",J="/v1/vector/dataset_list/2",P="/v1/agent/agent_base_update/",C="/v1/agent/agent_abilities_set/",j="/v1/agent/agent_output_set/",w="/v1/agent/agent_engine_set/",I="/v1/agent/agent_publish/",h="/v1/agent/agent_run",f=function(){var d=o()(u()().mark(function l(r,s){var n;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.ZP)("".concat(m).concat(r),{method:"GET",data:{publish_status:s=="true"?1:0}});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},l)}));return function(r,s){return d.apply(this,arguments)}}(),V=function(){var d=o()(u()().mark(function l(){var r;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.ZP)("".concat(J),{method:"GET"});case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}},l)}));return function(){return d.apply(this,arguments)}}(),_=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("".concat(P).concat(r.agent_id),{method:"PUT",data:r.data});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),x=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("".concat(C).concat(r.agent_id),{method:"PUT",data:r.data});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),O=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("".concat(j).concat(r.agent_id),{method:"PUT",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),D=null,p=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("".concat(I).concat(r),{method:"PUT"});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),U=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("".concat(h),{method:"POST",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),F=function(){var d=o()(u()().mark(function l(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.ZP)("/v1/agent/agent_chat_message",{method:"POST",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},l)}));return function(r){return d.apply(this,arguments)}}(),Z=function(){var d=o()(u()().mark(function l(r,s){var n;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.ZP)("/v1/agent/".concat(r,"/agent_message_list"),{method:"GET",data:{page:s,page_size:20}});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},l)}));return function(r,s){return d.apply(this,arguments)}}(),$=function(){var d=o()(u()().mark(function l(r,s){var n;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.ZP)("/v1/agent/".concat(r,"/agent_log_list"),{method:"GET",data:s});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},l)}));return function(r,s){return d.apply(this,arguments)}}(),z=function(){var d=o()(u()().mark(function l(r,s){var n;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.ZP)("/v1/agent/".concat(r,"/agent_log_details"),{method:"GET",data:{app_run_id:s}});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},l)}));return function(r,s){return d.apply(this,arguments)}}(),L=function(){var d=o()(u()().mark(function l(r,s){var n;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.ZP)("/v1/agent/".concat(r,"/clear_agent_chat_memory"),{method:"POST",data:{message_id:s,agent_id:r}});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},l)}));return function(r,s){return d.apply(this,arguments)}}()},27522:function(ue,S,t){var H=t(55060),u=t(28036),G=t(69753),o=t(97245),c=t(77295),m=t(85893),J=function(j,w){try{var I=document.createElement("a");I.href=j,I.download=w,I.target="_blank",document.body.appendChild(I),I.click(),document.body.removeChild(I)}catch(h){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",h)}},P=function(j){var w=j.fileList,I=j.onDownload,h=I===void 0?J:I,f=j.className,V=f===void 0?"":f,_=j.showInGrid,x=_===void 0?!1:_,O=j.maxHeight;return!w||w.length===0?null:(0,m.jsx)("div",{className:"mb-2 ".concat(V),style:{maxHeight:O,overflow:O?"auto":"visible"},children:(0,m.jsx)(H.Z.PreviewGroup,{children:(0,m.jsx)("div",{className:"".concat(x?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:w.map(function(D,p){var U=D.path_show||D.url,F=(0,c.CO)(D.name);return(0,m.jsx)("div",{className:"".concat(x?"":"mb-2"),children:F?(0,m.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,m.jsx)(H.Z,{src:U,alt:D.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,m.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,m.jsx)(u.ZP,{type:"primary",size:"small",icon:(0,m.jsx)(G.Z,{}),onClick:function($){$.stopPropagation(),h(U,D.name)}})})]}):(0,m.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,m.jsx)(o.Z,{className:"mr-2 flex-shrink-0"}),(0,m.jsx)("span",{className:"text-sm truncate",children:D.name})]}),(0,m.jsx)(u.ZP,{type:"text",size:"small",icon:(0,m.jsx)(G.Z,{}),onClick:function(){return h(U,D.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(D.uid||D.file_id||p))})})})})};S.Z=P},39873:function(ue,S,t){var H=t(5574),u=t.n(H),G=t(42881),o=t(67294),c=t(85893),m=function(P){var C=P.children,j=P.className,w=j===void 0?"":j,I=P.dragDirection,h=I===void 0?"left":I,f=P.minWidth,V=f===void 0?415:f,_=P.maxWidth,x=_===void 0?820:_,O=P.minHeight,D=O===void 0?200:O,p=P.maxHeight,U=p===void 0?800:p,F=P.defaultWidth,Z=F===void 0?415:F,$=P.defaultHeight,z=$===void 0?300:$,L=P.onChange,d=(0,o.useState)(Z),l=u()(d,2),r=l[0],s=l[1],n=(0,o.useState)(z),e=u()(n,2),a=e[0],T=e[1],M=(0,o.useCallback)(function(ne,W){s(ne),W&&T(W),L==null||L(ne,W)},[s,T,L]),g=(0,G.W)({direction:["left","right"].includes(h)?"horizontal":"vertical",triggerDirection:h,minWidth:V,maxWidth:x,minHeight:D,maxHeight:U,onResize:M}),A=g.triggerRef,k=g.containerRef;return(0,c.jsxs)("div",{ref:k,style:{width:["left","right"].includes(h)?"".concat(r,"px"):void 0,height:["top","bottom"].includes(h)?"".concat(a,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(w),children:[h==="left"&&(0,c.jsx)("div",{ref:A,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,c.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),h==="right"&&(0,c.jsx)("div",{ref:A,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,c.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),h==="top"&&(0,c.jsx)("div",{ref:A,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,c.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),h==="bottom"&&(0,c.jsx)("div",{ref:A,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,c.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),C]})};S.Z=(0,o.memo)(m)},85877:function(ue,S,t){var H=t(19632),u=t.n(H),G=t(97857),o=t.n(G),c=t(5574),m=t.n(c),J=t(52677),P=t.n(J),C=t(35312),j=t(78234),w=t(77598),I=t(96486),h=t.n(I),f=t(67294),V=t(73935),_=t(43413),x=t(92858),O=t(16845),D=t(15425),p=t(85893),U=function(n){var e=n.children;return(typeof document=="undefined"?"undefined":P()(document))==="object"?V.createPortal(e,document.body):null},F=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Z=function(n){var e=n.value,a=n.onChange,T=n.id,M=n.placeholder,g=n.options,A=(0,C.useIntl)(),k=(0,f.useRef)(),ne=(0,f.useState)(),W=m()(ne,2),B=W[0],N=W[1],ae=(0,f.useState)(0),Q=m()(ae,2),R=Q[0],K=Q[1],re=(0,f.useState)(""),se=m()(re,2),oe=se[0],Y=se[1],le=(0,f.useCallback)(function(i){return(0,p.jsx)(d,o()({},i))},[]),_e=(0,f.useCallback)(function(i){return(0,p.jsx)(L,o()({},i))},[]),E=(0,f.useMemo)(function(){return $((0,O.BU)((0,x.VC)((0,_.Jh)())))},[]),me=(0,f.useState)(null),v=m()(me,2),q=v[0],ge=v[1],Ie=(0,D.Z)(function(i){return i.selectedNode}),Oe=(0,D.Z)(function(i){return i.getOutputVariables}),xe=(0,D.Z)(function(i){return i.getInputVariables}),be=(0,f.useState)([]),pe=m()(be,2),X=pe[0],fe=pe[1];(0,j.Z)(function(){e&&e.length>0&&de(e),g!=null&&g.length&&fe(g.map(function(i){return o()(o()({},i),{},{name:i.label,id:i.value})}))}),(0,w.Z)(function(){var i=h().isEqual(q,e);i||(e&&e.length>0?de(e):e&&h().isArray(e)&&e.length==0&&de([{type:"paragraph",children:[]}]))},[e,T]),(0,w.Z)(function(){g.length&&fe(g.map(function(i){return o()(o()({},i),{},{name:i.label,id:i.value})})),console.log(g)},[g]);var de=function(b){ge(b),ve(E,{nodes:[{type:"paragraph",children:[]}]}),ve(E,{nodes:b})},Ee=(0,f.useCallback)(function(i){if(B&&X.length>0)switch(i.key){case"ArrowDown":i.preventDefault();var b=R>=X.length-1?0:R+1;K(b);return;case"ArrowUp":i.preventDefault();var y=R<=0?X.length-1:R-1;K(y);return;case"Tab":case"Enter":i.preventDefault(),_.YR.select(E,B),z(E,X[R]),N(null);return;case"Escape":i.preventDefault(),N(null);return}else if(i.key==="@"){setTimeout(function(){return Pe()},10);return}N(null)},[X,E,R,B]),ve=function(b){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ce=u()(b.children);if(ce.forEach(function(ee){return b.apply({type:"remove_node",path:[0],node:ee})}),y.nodes){var te=_.NB.isNode(y.nodes)?[y.nodes]:y.nodes;te.forEach(function(ee,he){return b.apply({type:"insert_node",path:[he],node:ee})})}var ie=y.at&&_.E9.isPoint(y.at)?y.at:_.ML.end(b,[]);ie&&_.YR.select(b,ie)};(0,f.useEffect)(function(){if(B&&X.length>0){var i=k.current,b=O.F3.toDOMRange(E,B),y=b.getBoundingClientRect();i.style.top="".concat(y.top+window.pageYOffset+24,"px"),i.style.left="".concat(y.left+window.pageXOffset,"px")}},[X.length,E,R,oe,B]);var Pe=function(){var b=E.selection;if(b&&_.e6.isCollapsed(b)){var y=_.e6.edges(b),ce=m()(y,1),te=ce[0],ie=_.ML.before(E,te),ee=ie&&_.ML.range(E,ie,te),he=ee&&_.ML.string(E,ee),De=_.ML.after(E,te),Me=_.ML.range(E,te,De),Te=_.ML.string(E,Me);N(ee),Y(""),K(0);return}N(null)};return(0,p.jsxs)(O.mH,{editor:E,initialValue:r,onChange:function(b){a==null||a(b),N(null)},children:[(0,p.jsx)(O.CX,{renderElement:le,renderLeaf:_e,onKeyDown:Ee,className:"!outline-none",placeholder:M!=null?M:A.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),B&&(0,p.jsx)(U,{children:(0,p.jsx)("div",{ref:k,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:X.length?X.map(function(i,b){return(0,p.jsx)("div",{onClick:function(){console.log(i),_.YR.select(E,B),z(E,i),N(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:b===R?"#B4D5FF":""},children:(0,p.jsx)("span",{children:i.name})},i.name+b)}):(0,p.jsx)(p.Fragment,{children:A.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},$=function(n){var e=n.isInline,a=n.isVoid,T=n.markableVoid;return n.isInline=function(M){return M.type==="mention"?!0:e(M)},n.isVoid=function(M){return M.type==="mention"?!0:a(M)},n.markableVoid=function(M){return M.type==="mention"||T(M)},n},z=function(n,e){var a={type:"mention",id:(e==null?void 0:e.id)||"",character:e.name,base:e,children:[{bold:!0,text:"11111"}]};_.YR.insertNodes(n,a),_.YR.move(n)},L=function(n){var e=n.attributes,a=n.children,T=n.leaf;return(0,p.jsx)("span",o()(o()({},e),{},{children:a}))},d=function(n){var e=n.attributes,a=n.children,T=n.element;switch(T.type){case"mention":return(0,p.jsx)(l,o()({},n));default:return(0,p.jsx)("p",o()(o()({},e),{},{children:a}))}},l=function(n){var e=n.attributes,a=n.children,T=n.element,M=(0,O.vt)(),g=(0,O.UE)(),A={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:M&&g?"0 0 0 2px #B4D5FF":"none"};return T.children[0].bold&&(A.fontWeight="bold"),T.children[0].italic&&(A.fontStyle="italic"),(0,p.jsx)("span",o()(o()({},e),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(T.character.replace(" ","-")),style:A,children:F?(0,p.jsxs)(f.Fragment,{children:["1",a,"/",T.character]}):(0,p.jsxs)(f.Fragment,{children:[(0,p.jsx)("span",{children:T.character}),a]})}))},r=[{type:"paragraph",children:[{text:""}]}];S.Z=Z},77295:function(ue,S,t){t.d(S,{CO:function(){return h}});var H=t(15009),u=t.n(H),G=t(19632),o=t.n(G),c=t(99289),m=t.n(c),J=t(5574),P=t.n(J),C=t(45360),j=t(35312),w=t(67294),I=t(83065),h=function(_){var x,O=(x=_.split(".").pop())===null||x===void 0?void 0:x.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(O||"")},f=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=(0,j.useIntl)(),O=(0,w.useState)([]),D=P()(O,2),p=D[0],U=D[1],F=(0,w.useState)(!1),Z=P()(F,2),$=Z[0],z=Z[1],L=_.maxSizeMB,d=L===void 0?15:L,l=_.acceptedFileTypes,r=l===void 0?".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv,.jpg,.png,.jpeg":l,s=_.multiple,n=s===void 0?!0:s,e=function(){var g=document.createElement("input");g.type="file",g.accept=r,g.multiple=n,g.onchange=function(){var A=m()(u()().mark(function k(ne){var W,B,N,ae,Q,R,K,re,se,oe,Y,le,_e,E;return u()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(W=ne.target,!(W.files&&W.files.length>0)){v.next=37;break}if(z(!0),B=Array.from(W.files),N=B.filter(function(q){return q.size/1024/1024>d}),!(N.length>0)){v.next=9;break}return C.ZP.error("".concat(N.map(function(q){return q.name}).join(", ")," ").concat(x.formatMessage({id:"workflow.uploadFileErrorText"}))),z(!1),v.abrupt("return");case 9:ae=[],Q=0,R=B;case 11:if(!(Q<R.length)){v.next=35;break}return K=R[Q],re=new FormData,re.append("file",K),v.prev=15,v.next=18,(0,I.M$)();case 18:return se=v.sent,v.next=21,fetch(se,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:re});case 21:return oe=v.sent,v.next=24,oe.json();case 24:Y=v.sent,Y.code===0?(C.ZP.success("".concat(K.name," ").concat(x.formatMessage({id:"workflow.uploadSuccess"}))),(le=Y.data)!==null&&le!==void 0&&le.file_id&&(_e=h(K.name),E={name:K.name,url:Y.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:_e,file_id:Y.data.file_id,path_show:Y.data.file_url||Y.data.path_show||""},ae.push(E))):C.ZP.error("".concat(K.name," ").concat(x.formatMessage({id:"workflow.uploadFailed"}))),v.next=32;break;case 28:v.prev=28,v.t0=v.catch(15),console.error("Upload error:",v.t0),C.ZP.error("".concat(K.name," ").concat(x.formatMessage({id:"workflow.uploadFailed"})));case 32:Q++,v.next=11;break;case 35:U(function(q){return[].concat(o()(q),ae)}),z(!1);case 37:case"end":return v.stop()}},k,null,[[15,28]])}));return function(k){return A.apply(this,arguments)}}(),g.click()},a=function(g){U(function(A){return A.filter(function(k){return k.uid!==g})})},T=function(){U([])};return{uploadedFiles:p,setUploadedFiles:U,handleUpload:e,removeFile:a,clearFiles:T,isUploading:$}};S.ZP=f}}]);
