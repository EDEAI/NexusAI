"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[543],{54543:function(ce,k,r){r.d(k,{OT:function(){return H},e0:function(){return _e}});var V=r(15009),E=r.n(V),z=r(99289),B=r.n(z),J=r(5574),U=r.n(J),Q=r(13769),X=r.n(Q),Y=r(97857),m=r.n(Y),S=r(42237),x=r(51042),$=r(82061),W=r(35312),q=r(42380),ee=r(78234),ae=r(71471),C=r(2453),re=r(26915),K=r(28036),se=r(86738),ne=r(17788),te=r(34041),le=r(66309),i=r(67294),d=r(85893),de=["children","showAddButton"],fe=ae.Z.Paragraph,F=function(o,g){switch(g.type){case"SET_TAGS":return m()(m()({},o),{},{tagList:g.payload,error:null});case"SET_LOADING":return m()(m()({},o),{},{loading:g.payload});case"SET_ERROR":return m()(m()({},o),{},{error:g.payload,loading:!1});default:return o}},ue=(0,i.memo)(function(_){var o=_.children,g=_.showAddButton,O=g===void 0?!0:g,n=X()(_,de),s=(0,W.useIntl)(),I=n.modes,M=I===void 0?0:I,D=(0,i.useState)(!1),p=U()(D,2),T=p[0],y=p[1],G=(0,i.useState)(""),L=U()(G,2),c=L[0],w=L[1],R=(0,i.useReducer)(F,{tagList:[{label:s.formatMessage({id:"addTag.all",defaultMessage:"All"}),value:"All"}],loading:!1,error:null}),j=U()(R,2),A=j[0],h=j[1],u=(0,q.Z)(c,300);(0,i.useEffect)(function(){var t=A.tagList.filter(function(l){var f=String(l.label).toLowerCase();return f.includes(u.toLowerCase())});u?h({type:"SET_TAGS",payload:t}):P()},[u]);var P=(0,i.useCallback)(B()(E()().mark(function t(){var l,f,v;return E()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h({type:"SET_LOADING",payload:!0}),e.next=4,(0,S.kV)(M);case 4:if(l=e.sent,l.code!==0){e.next=10;break}v=(f=l.data)===null||f===void 0?void 0:f.map(function(a){return m()(m()({},a),{},{label:a.name,value:a.id})}),h({type:"SET_TAGS",payload:v}),e.next=11;break;case 10:throw new Error(l.message||"Failed to fetch tags");case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),h({type:"SET_ERROR",payload:e.t0.message}),C.ZP.error(s.formatMessage({id:"error.fetchTags",defaultMessage:"Failed to fetch tags"}));case 17:return e.prev=17,h({type:"SET_LOADING",payload:!1}),e.finish(17);case 20:case"end":return e.stop()}},t,null,[[0,13,17,20]])})),[M,s]),N=(0,i.useCallback)(function(){var t=B()(E()().mark(function l(f){var v,b;return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(f.trim()){a.next=3;break}return C.ZP.warning(s.formatMessage({id:"addTag.emptyName",defaultMessage:"Tag name cannot be empty"})),a.abrupt("return");case 3:return a.prev=3,h({type:"SET_LOADING",payload:!0}),a.next=7,(0,S.ln)(f,M);case 7:if(v=a.sent,v.code!==0){a.next=15;break}w(""),P(),n==null||(b=n.onTagChange)===null||b===void 0||b.call(n),C.ZP.success(s.formatMessage({id:"addTag.success",defaultMessage:"Tag created successfully"})),a.next=16;break;case 15:throw new Error(v.message||"Failed to create tag");case 16:a.next=21;break;case 18:a.prev=18,a.t0=a.catch(3),C.ZP.error(s.formatMessage({id:"error.createTag",defaultMessage:"Failed to create tag"}));case 21:return a.prev=21,h({type:"SET_LOADING",payload:!1}),a.finish(21);case 24:case"end":return a.stop()}},l,null,[[3,18,21,24]])}));return function(l){return t.apply(this,arguments)}}(),[M,s,n==null?void 0:n.onTagChange]),Z=(0,i.useCallback)(function(){var t=B()(E()().mark(function l(f){var v;return E()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h({type:"SET_LOADING",payload:!0}),e.next=4,(0,S.Pn)(f);case 4:if(v=e.sent,v.code!==0){e.next=10;break}P(),C.ZP.success(s.formatMessage({id:"deleteTag.success",defaultMessage:"Tag deleted successfully"})),e.next=11;break;case 10:throw new Error(v.message||"Failed to delete tag");case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),C.ZP.error(s.formatMessage({id:"error.deleteTag",defaultMessage:"Failed to delete tag"}));case 16:return e.prev=16,h({type:"SET_LOADING",payload:!1}),e.finish(16);case 19:case"end":return e.stop()}},l,null,[[0,13,16,19]])}));return function(l){return t.apply(this,arguments)}}(),[s]);(0,ee.Z)(function(){P()});var ge=(0,i.useMemo)(function(){return(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,d.jsx)(re.Z,{suffix:(0,d.jsx)(x.Z,{onClick:function(){return c.trim()&&N(c)},className:"cursor-pointer mx-1 ".concat(c.trim()?"":"text-gray-300")}),placeholder:s.formatMessage({id:"addTag.inputTagName",defaultMessage:"Enter tag name"}),maxLength:10,value:c,onChange:function(l){return w(l.target.value)},onPressEnter:function(l){l.preventDefault(),c.trim()&&N(c)}}),A.tagList.map(function(t){return(0,d.jsxs)("div",{className:"p-0.5 cursor-pointer border border-gray-300 text-gray-600 hover:border-[#1B64F3] rounded-md flex flex-wrap items-center transition-all duration-300",children:[(0,d.jsx)("div",{className:"pl-3 pr-1",children:(0,d.jsx)(ie,{onUpdate:function(){var l=B()(E()().mark(function f(v){var b;return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,S.Lp)(t.id,v);case 3:P(),n==null||(b=n.onTagChange)===null||b===void 0||b.call(n),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),C.ZP.error(s.formatMessage({id:"error.updateTag",defaultMessage:"Failed to update tag"}));case 10:case"end":return a.stop()}},f,null,[[0,7]])}));return function(f){return l.apply(this,arguments)}}(),children:t.name})}),t.reference_count===0?(0,d.jsx)(K.ZP,{onClick:function(){return Z(t.id)},type:"text",icon:(0,d.jsx)($.Z,{})}):(0,d.jsx)(se.Z,{title:s.formatMessage({id:"addTag.deleteTag",defaultMessage:"Delete"}),description:"".concat(s.formatMessage({id:"addTag.deleteConfirmation1"})," ").concat(t.reference_count," ").concat(s.formatMessage({id:"addTag.deleteConfirmation2"})),onConfirm:function(){return Z(t.id)},okText:s.formatMessage({id:"addTag.confirm",defaultMessage:"Confirm"}),cancelText:s.formatMessage({id:"addTag.cancel",defaultMessage:"Cancel"}),children:(0,d.jsx)(K.ZP,{type:"text",icon:(0,d.jsx)($.Z,{})})})]},t.id)})]})},[A.tagList,c,s,N,Z]);return(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(ne.Z,{title:s.formatMessage({id:"addTag.addTag",defaultMessage:"Add Tag"}),className:"z-[999]",open:T,onCancel:function(){return y(!1)},onOk:function(){c.trim()&&N(c),y(!1)},okButtonProps:{disabled:!c.trim()},bodyProps:{className:"min-h-[200px] pt-4"},children:ge}),O&&(0,d.jsx)(K.ZP,{onClick:function(){return y(!0)},type:"text",className:"shrink-0",icon:(0,d.jsx)(x.Z,{className:"cursor-pointer mr-1"}),"aria-label":s.formatMessage({id:"addTag.button",defaultMessage:"Add new tag"})}),(0,d.jsx)(H,m()({className:"!w-[160px]",options:A.tagList,loading:A.loading},n))]})}),H=(0,i.memo)(function(_){var o=(0,W.useIntl)();return(0,d.jsx)(te.Z,m()({mode:"multiple",size:"middle",placeholder:o.formatMessage({id:"addTag.pleaseSelect",defaultMessage:"Please select"}),maxTagCount:"responsive",onChange:function(O){var n;_==null||(n=_.onChange)===null||n===void 0||n.call(_,O)},tagRender:oe,options:(_==null?void 0:_.options)||[]},_))}),oe=function(o){var g=o.label,O=o.value,n=o.closable,s=o.onClose,I=function(D){D.preventDefault(),D.stopPropagation()};return(0,d.jsx)(le.Z,{color:"blue",onMouseDown:I,style:{marginInlineEnd:4},children:g})},ie=function(o){var g=o.children,O=o.onUpdate,n=o.maxLength,s=n===void 0?10:n,I=function(p){var T=p.currentTarget.textContent;T.length>s&&(p.currentTarget.textContent=T.substring(0,s))},M=function(p){var T=p.currentTarget.textContent;O(T)};return(0,d.jsx)("div",{contentEditable:!0,onInput:I,onBlur:M,suppressContentEditableWarning:!0,children:g})},_e=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,g=(0,W.useIntl)(),O=(0,i.useState)(o),n=U()(O,2),s=n[0],I=n[1],M=(0,i.useReducer)(F,{tagList:[{label:g.formatMessage({id:"addTag.all",defaultMessage:"All"}),value:"All"}],loading:!1,error:null}),D=U()(M,2),p=D[0],T=D[1],y=(0,i.useCallback)(function(){var L=B()(E()().mark(function c(w){var R,j,A;return E()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,T({type:"SET_LOADING",payload:!0}),u.next=4,(0,S.kV)(w);case 4:if(R=u.sent,R.code!==0){u.next=10;break}A=(j=R.data)===null||j===void 0?void 0:j.map(function(P){return m()(m()({},P),{},{label:P.name,value:P.id})}),T({type:"SET_TAGS",payload:A}),u.next=11;break;case 10:throw new Error(R.message||"Failed to fetch tags");case 11:u.next=17;break;case 13:u.prev=13,u.t0=u.catch(0),T({type:"SET_ERROR",payload:u.t0.message}),C.ZP.error(g.formatMessage({id:"error.fetchTags",defaultMessage:"Failed to fetch tags"}));case 17:return u.prev=17,T({type:"SET_LOADING",payload:!1}),u.finish(17);case 20:case"end":return u.stop()}},c,null,[[0,13,17,20]])}));return function(c){return L.apply(this,arguments)}}(),[g]);(0,i.useEffect)(function(){y(s)},[s,y]);var G=(0,i.useCallback)(function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;I(L)},[]);return{tagList:p.tagList,loading:p.loading,error:p.error,refreshTags:G}};k.ZP=(0,i.memo)(ue)}}]);
