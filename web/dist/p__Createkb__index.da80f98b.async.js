"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1734],{82826:function(ze,Fe,n){n.d(Fe,{Z:function(){return o}});var he=n(1413),h=n(67294),Pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},de=Pe,A=n(91146),re=function(x,E){return h.createElement(A.Z,(0,he.Z)((0,he.Z)({},x),{},{ref:E,icon:de}))},De=h.forwardRef(re),o=De},83510:function(ze,Fe,n){n.d(Fe,{LK:function(){return c},bs:function(){return T},go:function(){return t},uy:function(){return b}});var he=n(15009),h=n.n(he),Pe=n(99289),de=n.n(Pe),A=n(47520),re="/v1/apps/apps_list",De="/v1/agent/agent_delete/",o="/v1/workflow/workflow_app_delete/",Be="/v1/vector/delete_dataset/",x="/v1/skill/delete_skill_by_app_id/",E="/v1/apps/apps_create",r="/v1/apps/app_update/",t=function(){var ue=de()(h()().mark(function q(B){var ae;return h()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(re),{method:"GET",data:B});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},q)}));return function(B){return ue.apply(this,arguments)}}(),c=function(){var ue=de()(h()().mark(function q(B){var ae;return h()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(B),e.next=3,B.mode;case 3:if(e.t0=e.sent,e.t0!=1){e.next=8;break}e.t1=(0,A.ZP)("".concat(De).concat(B.app_id),{method:"DELETE"}),e.next=9;break;case 8:e.t1=B.mode==2?(0,A.ZP)("".concat(o).concat(B.app_id),{method:"DELETE"}):B.mode==3?(0,A.ZP)("".concat(Be).concat(B.app_id),{method:"DELETE"}):(0,A.ZP)("".concat(x).concat(B.app_id),{method:"DELETE",data:{is_soft:1}});case 9:return ae=e.t1,e.abrupt("return",ae);case 11:case"end":return e.stop()}},q)}));return function(B){return ue.apply(this,arguments)}}(),b=function(){var ue=de()(h()().mark(function q(B){var ae;return h()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(E),{method:"POST",data:B});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},q)}));return function(B){return ue.apply(this,arguments)}}(),T=function(){var ue=de()(h()().mark(function q(B){var ae;return h()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.ZP)("".concat(r).concat(B.app_id),{method:"PUT",data:B});case 2:return ae=e.sent,e.abrupt("return",ae);case 4:case"end":return e.stop()}},q)}));return function(B){return ue.apply(this,arguments)}}()},51845:function(ze,Fe,n){n.r(Fe),n.d(Fe,{default:function(){return ma}});var he=n(5574),h=n.n(he),Pe=n(32332),de=n(82826),A=n(35312),re=n(28036),De=n(50136),o=n(67294),Be=n(97857),x=n.n(Be),E=n(15009),r=n.n(E),t=n(99289),c=n.n(t),b=n(83065),T=n(45360),ue=n(71230),q=n(15746),B=n(4393),ae=n(26915),Ce=n(86842),e=n(85893),Ue=1,He=function(d){var u=d.createkbInfo,s=(0,A.useIntl)(),m=[{title:s.formatMessage({id:"createkb.text",defaultMessage:""}),dataIndex:"input",ellipsis:!0},{title:s.formatMessage({id:"createkb.recallParagraph",defaultMessage:""}),dataIndex:"document_segment_num",width:"15%"},{title:s.formatMessage({id:"createkb.time",defaultMessage:""}),dataIndex:"created_time",width:"25%"}],a=(0,o.useState)([]),L=h()(a,2),Z=L[0],N=L[1],ee=(0,o.useState)(null),fe=h()(ee,2),$=fe[0],_=fe[1],V=(0,o.useState)(null),F=h()(V,2),z=F[0],xe=F[1],K=(0,o.useState)([]),ve=h()(K,2),ge=ve[0],ne=ve[1],oe=(0,o.useState)(!1),we=h()(oe,2),be=we[0],U=we[1],R=(0,o.useState)(""),k=h()(R,2),Y=k[0],I=k[1],P=(0,o.useRef)(null),ce=(0,o.useState)(0),X=h()(ce,2),pe=X[0],je=X[1],_e=(0,o.useState)(1),Ee=h()(_e,2),Me=Ee[0],ye=Ee[1],le=function(){var y=c()(r()().mark(function p(){var j;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(Y==""){f.next=11;break}return U(!0),ne([]),f.next=5,(0,b.I9)({user_input:Y},u.app_id);case 5:j=f.sent,j.code==0?(j.data.data.length<=0&&T.ZP.error(s.formatMessage({id:"createkb.saveSuccess",defaultMessage:""})),ne(j.data.data)):T.ZP.error(j.detail),U(!1),te(),f.next=14;break;case 11:U(!1),ne([]),T.ZP.error(s.formatMessage({id:"createkb.testInput",defaultMessage:""}));case 14:case"end":return f.stop()}},p)}));return function(){return y.apply(this,arguments)}}(),O=function(){var y=c()(r()().mark(function p(j){return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:I(j.target.value);case 1:case"end":return f.stop()}},p)}));return function(j){return y.apply(this,arguments)}}(),se=function(p){Ue=p,te()},ie=function(){var y=c()(r()().mark(function p(j){var i;return r()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return U(!0),W.next=3,(0,b.gk)(j.id);case 3:i=W.sent,i.code==0?ne(i.data.data):T.ZP.error(i.detail),U(!1),I(j.input);case 7:case"end":return W.stop()}},p)}));return function(j){return y.apply(this,arguments)}}(),te=function(){var y=c()(r()().mark(function p(){var j,i,f=arguments;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return j=f.length>0&&f[0]!==void 0?f[0]:Ue,S.next=3,(0,b.yC)({page:j},u.app_id);case 3:i=S.sent,i.code==0&&(N(i.data.data),xe(i.data));case 5:case"end":return S.stop()}},p)}));return function(){return y.apply(this,arguments)}}(),Te=function(){var y=c()(r()().mark(function p(){var j,i,f,W,S=arguments;return r()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return j=S.length>0&&S[0]!==void 0?S[0]:1,i={app_id:u.app_id},me.next=4,(0,b.SH)(i);case 4:f=me.sent,f.code==0&&(W=f.data.data.map(function(Ie,Ae){return x()(x()({},Ie),{},{statusText:Ie.status==1?s.formatMessage({id:"createkb.normal",defaultMessage:""}):Ie.status==2?s.formatMessage({id:"createkb.disabled",defaultMessage:""}):s.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),console.log(f),_(f.data));case 6:case"end":return me.stop()}},p)}));return function(){return y.apply(this,arguments)}}();return(0,o.useEffect)(function(){te(),Te(),setTimeout(function(){P.current&&je(P.current.offsetHeight-55-82)},200),u.app_id&&ye(u.type?2:1)},[]),(0,e.jsx)(e.Fragment,{children:z!=null?(0,e.jsxs)("div",{className:"h-full pb-[30px]",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Me==2?(0,A.getLocale)()=="zh-CN"?$?$.dataset_detail.nickname+s.formatMessage({id:"createkb.knowledge.base.of"}):s.formatMessage({id:"createkb.knowledge.base.of"}):$?s.formatMessage({id:"createkb.knowledge.base.of"})+$.dataset_detail.nickname:s.formatMessage({id:"createkb.knowledge.base.of"}):Me==1?s.formatMessage({id:"createkb.editKB"}):s.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"flex w-full",style:{height:"calc(100% - 84px)"},children:(0,e.jsxs)(ue.Z,{gutter:0,style:{marginRight:"0px",marginLeft:"0px"},children:[(0,e.jsx)(q.Z,{className:"pb-[30px] h-2/4",span:24,children:(0,e.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,e.jsx)("div",{className:"mb-5 text-[#555555] text-sm font-medium",children:s.formatMessage({id:"createkb.recallTest",defaultMessage:""})}),(0,e.jsxs)("div",{className:"w-full px-[15px] py-[15px] border-[#EEEEEE] rounded-lg bg-[#F7F7F7] flex-1 min-h-0",children:[(0,e.jsx)("div",{className:" overflow-y-auto",style:{height:"calc(100% - 65px)"},children:(0,e.jsx)(ue.Z,{gutter:[15,15],className:"w-full",children:ge.map(function(y,p){var j=(y.score*1).toFixed(4),i=y.reranking_score>0?(y.reranking_score*1).toFixed(4):0;return(0,e.jsx)(q.Z,{className:"gutter-row w-full",span:24,children:(0,e.jsx)(B.Z,{activeTabKey:y.id,size:"small",children:(0,e.jsxs)("div",{className:"w-full bg-white  font-normal text-[12px] rounded-lg",children:[(0,e.jsx)("div",{className:"break-all text-[#213044] leading-[17px]",children:y.content}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",s.formatMessage({id:"createkb.source",defaultMessage:""}),"\uFF1A ",y.name]}),(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px]  leading-[17px]",children:[" ",s.formatMessage({id:"createkb.matchScore"}),"\uFF1A ",j]}),i==0?"":(0,e.jsxs)("div",{className:"text-[#BBBBBB] mt-[15px] leading-[17px]",children:[" ",s.formatMessage({id:"createkb.sortScore"}),"\uFF1A ",i]})]})})},y.id)})})}),(0,e.jsxs)("div",{className:"bg-white flex items-center rounded-lg mt-[15px] p-[10px]",children:[(0,e.jsx)(ae.Z,{className:" custom-textarea",onChange:O,variant:"borderless",placeholder:s.formatMessage({id:"createkb.briefText"}),maxLength:200,showCount:!0,value:Y,onPressEnter:le}),(0,e.jsx)("div",{className:"flex justify-end",children:(0,e.jsx)(re.ZP,{type:"primary",loading:be,onClick:le,style:{background:"rgba(27,100,243,.1)"},className:"w-[30px] h-[30px] rounded-md flex justify-center items-center p-0",children:be?"":(0,e.jsx)("img",{src:"/icons/fs.svg",className:"w-4 h-4"})})})]})]})]})}),(0,e.jsx)("div",{className:"h-2/4",ref:P,children:(0,e.jsx)(q.Z,{span:24,children:(0,e.jsxs)("div",{className:"w-full h-full",children:[(0,e.jsx)("div",{className:" mb-[20px] text-[#555555] text-sm font-medium",children:s.formatMessage({id:"createkb.recentQuery"})}),(0,e.jsx)("div",{className:"w-[900px] rounded-md border-[#eeeeee] border rounded-lg",children:(0,e.jsx)(Ce.Z,{rowKey:"id",columns:m,dataSource:Z,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:s.formatMessage({id:"createkb.no.data.available"})})})},pagination:{pageSize:z.paging_information.page_size,total:z.paging_information.total_count,onChange:se,style:{margin:"0px",marginTop:"10px"},hideOnSinglePage:!0},onRow:function(p,j){return{onClick:function(){return ie(p)},style:{cursor:"pointer"}}},scroll:pe!=0?{y:pe}:{}})})]})})})]})})]}):""})},vt=He,bt=n(64599),yt=n.n(bt),wt=n(83510),jt=n(40741),Ve=n(72269),et=n(34041),tt=n(66309),Mt=n(74330),kt=function(d){var u,s=d.createkbInfo,m=d.fun,a=(0,A.useIntl)(),L=(0,o.useState)(null),Z=h()(L,2),N=Z[0],ee=Z[1],fe=(0,o.useState)(!1),$=h()(fe,2),_=$[0],V=$[1],F=(0,o.useState)(1),z=h()(F,2),xe=z[0],K=z[1],ve=(0,o.useState)(1),ge=h()(ve,2),ne=ge[0],oe=ge[1],we=(0,o.useState)(null),be=h()(we,2),U=be[0],R=be[1],k=(0,o.useState)(null),Y=h()(k,2),I=Y[0],P=Y[1],ce=(0,o.useState)(null),X=h()(ce,2),pe=X[0],je=X[1],_e=(0,o.useState)(1),Ee=h()(_e,2),Me=Ee[0],ye=Ee[1],le=function(p){s.type||K(p)},O=function(p){oe(p==!0?1:0)},se=function(){m({type:"return"})},ie=function(){var y=c()(r()().mark(function p(){var j,i,f;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(V(!0),s.app_id){S.next=11;break}return S.next=4,(0,wt.uy)((0,Pe.Go)("GET"));case 4:if(j=S.sent,j.code!=0){S.next=9;break}m({type:"set",data:j.data.app_id}),S.next=11;break;case 9:return T.ZP.error(a.formatMessage({id:"createkb.creationFailed",defaultMessage:""})),S.abrupt("return");case 11:return i={app_id:s.app_id,name:N.name,description:N.description,public:ne,embeddings_config_id:pe},S.next=14,(0,b._W)(i);case 14:f=S.sent,f.code==0?(T.ZP.success(a.formatMessage({id:"createkb.setupSuccess",defaultMessage:""})),setTimeout(function(){m({type:"next",data:"2"}),V(!1)},1e3)):(T.ZP.error(a.formatMessage({id:"createkb.settingFailed",defaultMessage:""})),V(!1));case 16:case"end":return S.stop()}},p)}));return function(){return y.apply(this,arguments)}}(),te=function(){var y=c()(r()().mark(function p(){var j,i,f=arguments;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return j=f.length>0&&f[0]!==void 0?f[0]:1,S.next=3,(0,b.SH)({app_id:s.app_id,page:j,page_size:10,name:""});case 3:i=S.sent,i.code==0&&(oe(i.data.dataset_detail.is_public),K(i.data.dataset_detail.mode),P(i.data.dataset_detail.embedding_model_config_id),je(i.data.dataset_detail.embedding_model_config_id||null),ee({name:i.data.dataset_detail.name,description:i.data.dataset_detail.description,nickname:i.data.dataset_detail.nickname}),Te(i.data.dataset_detail.embedding_model_config_id));case 5:case"end":return S.stop()}},p)}));return function(){return y.apply(this,arguments)}}(),Te=function(){var y=c()(r()().mark(function p(j){var i,f,W,S,Oe,me,Ie,Ae,Le;return r()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,b.Ue)(j);case 2:if(i=G.sent,i.code!=0){G.next=28;break}W=Array.isArray(i==null||(f=i.data)===null||f===void 0?void 0:f.data)?i.data.data:[],S=W.map(function(ke){return{label:ke.supplier_name,options:Array.isArray(ke.model_list)?ke.model_list.map(function(Se){return x()(x()({},Se),{},{label:Se.model_name,value:Se.model_config_id})}):[]}}),me=yt()(W),G.prev=7,me.s();case 9:if((Ie=me.n()).done){G.next=18;break}if(Ae=Ie.value,!Array.isArray(Ae.model_list)){G.next=16;break}if(Le=Ae.model_list.find(function(ke){return ke.model_default_used===1}),!Le){G.next=16;break}return Oe=Le.model_config_id,G.abrupt("break",18);case 16:G.next=9;break;case 18:G.next=23;break;case 20:G.prev=20,G.t0=G.catch(7),me.e(G.t0);case 23:return G.prev=23,me.f(),G.finish(23);case 26:R({options:S,defaultValue:Oe}),je(function(ke){var Se;return ke==null?(Se=Oe)!==null&&Se!==void 0?Se:null:ke});case 28:case"end":return G.stop()}},p,null,[[7,20,23,26]])}));return function(j){return y.apply(this,arguments)}}();return(0,o.useEffect)(function(){s.app_id?(ye(s.type?2:1),te()):(Te(0),ee({name:s.name,description:s.description}),ye(3))},[]),(0,e.jsx)(e.Fragment,{children:N!=null?(0,e.jsxs)("div",{className:"bg-white h-full flex flex-col w-full relative",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:Me==2?(0,A.getLocale)()=="zh-CN"?N.nickname+a.formatMessage({id:"createkb.knowledge.base.of"}):a.formatMessage({id:"createkb.knowledge.base.of"})+N.nickname:Me==1?a.formatMessage({id:"createkb.editKB",defaultMessage:""}):a.formatMessage({id:"createkb.createKnowledgeBase",defaultMessage:""})})]}),(0,e.jsx)("div",{className:" pb-[30px] bg-white flex-1",children:(0,e.jsx)(ue.Z,{className:"h-full",children:(0,e.jsxs)(q.Z,{span:24,className:"flex flex-col justify-between",children:[(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:a.formatMessage({id:"createkb.settings",defaultMessage:""})}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsxs)(jt.Z,{layout:"vertical",children:[(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:a.formatMessage({id:"createkb.name",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:N.name}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:a.formatMessage({id:"createkb.desc",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px] p-[15px] bg-[#F7F7F7] border border-[#EEEEEE] rounded-lg text-[12px] text-[#213044] font-normal leading-[17px]",children:N.description}),(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:a.formatMessage({id:"createkb.teamVisible",defaultMessage:""})})]}),(0,e.jsx)("div",{className:"w-full mt-[15px]",children:(0,e.jsx)(Ve.Z,{onChange:O,checked:ne===1,size:"small",disabled:s.type})}),(U==null||(u=U.options)===null||u===void 0?void 0:u.length)>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[30px] flex items-start text-[12px]",children:[(0,e.jsx)("span",{className:"mr-[2px] text-[#E80000] leading-[17px] font-medium",children:"*"}),(0,e.jsx)("span",{className:"text-[#555555] font-medium",children:a.formatMessage({id:"createkb.modelSelect"})})]}),(0,e.jsx)(et.Z,{className:"w-full mt-4",value:pe!=null?pe:void 0,onChange:function(p){return je(p)},options:((U==null?void 0:U.options)||[]).map(function(y){return{label:y.label,options:(y.options||[]).map(function(p){return x()(x()({},p),{},{label:(0,e.jsxs)("div",{children:[p.label," ",(p==null?void 0:p.support_image)===1&&(0,e.jsx)(tt.Z,{color:"blue",className:"text-xs",children:a.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})}),(p==null?void 0:p.model_mode)===2&&(0,e.jsx)(tt.Z,{color:"default",className:"text-xs",children:a.formatMessage({id:"workflow.tag.localModel",defaultMessage:"Local Model"})})]}),value:p.value})})}}),disabled:s.type})]})]}),(0,e.jsxs)("div",{className:"flex items-center mt-[60px]",children:[(0,e.jsx)(re.ZP,{type:"primary",onClick:ie,className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",disabled:s.type,style:{cursor:s.type?"not-allowed":""},children:a.formatMessage({id:"createkb.save.and.upload.document"})}),(0,e.jsx)(re.ZP,{type:"primary",onClick:se,className:"ml-[20px] py-[10px] h-[40px] px-[15px] bg-[#ffffff] text-[#213044] text-[14px] leading-[20px] font-medium border border-[#979797]",children:a.formatMessage({id:"createkb.cancel"})})]})]})]})})}),_?(0,e.jsx)("div",{className:" absolute w-full h-full t-0 l-0 z-10 flex justify-center items-center",children:(0,e.jsx)(Mt.Z,{size:"large"})}):""]}):""})},St=kt,Nt=n(19632),Ke=n.n(Nt),Ct=n(82061),at=n(40110),Et=n(85576),Tt=n(38703),Lt=n(47520),Ft=n(13769),Pt=n.n(Ft),Dt=n(78367),It=["onChange","fileList","action","headers","disabled","multiple","accept","maxSize","showUploadList","className","height","timeout","fileTypeIcons","children","dragText","limitText"],Zt=Dt.Z.Dragger,st=(0,o.forwardRef)(function(l,d){var u=l.onChange,s=l.fileList,m=s===void 0?[]:s,a=l.action,L=l.headers,Z=l.disabled,N=Z===void 0?!1:Z,ee=l.multiple,fe=ee===void 0?!0:ee,$=l.accept,_=$===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv":$,V=l.maxSize,F=V===void 0?15:V,z=l.showUploadList,xe=z===void 0?!1:z,K=l.className,ve=K===void 0?"":K,ge=l.height,ne=ge===void 0?"200px":ge,oe=l.timeout,we=oe===void 0?3e5:oe,be=l.fileTypeIcons,U=be===void 0?[{src:"/icons/word.svg",alt:"Word"},{src:"/icons/txt.svg",alt:"TXT"},{src:"/icons/pdf.svg",alt:"PDF"},{src:"/icons/xlsx.svg",alt:"Excel"},{src:"/icons/md.svg",alt:"Markdown"}]:be,R=l.children,k=l.dragText,Y=l.limitText,I=Pt()(l,It),P=(0,A.useIntl)(),ce=(0,o.useRef)(null);console.log("FileUpload component received fileList:",m.length,"files"),console.log("FileUpload fileList names:",m.map(function(le){return le.name}));var X=function(){ce.current&&(ce.current.fileList=[],ce.current.upload&&(ce.current.upload.fileList=[]),ce.current.forceUpdate&&ce.current.forceUpdate(),console.log("FileUpload component reset completed"))};(0,o.useImperativeHandle)(d,function(){return{reset:X}});var pe=function(){return L||{Authorization:"Bearer ".concat(localStorage.getItem("token"))}},je={action:a||"",headers:pe(),fileList:m,onChange:function(O){var se=O.file.status;se==="uploading"&&console.log("Upload progress:",O.file.percent),se==="done"?T.ZP.success("".concat(O.file.name," ").concat(P.formatMessage({id:"common.upload.success",defaultMessage:"Upload successful"}))):se==="error"&&T.ZP.error("".concat(O.file.name," ").concat(P.formatMessage({id:"common.upload.error",defaultMessage:"Upload failed"}))),u==null||u(O)},beforeUpload:function(O){var se=O.size/1024/1024<F;if(!se)return T.ZP.error(P.formatMessage({id:"common.upload.error.fileSize",defaultMessage:"File size cannot exceed ".concat(F,"MB")},{maxSize:F})),!1;var ie=(O.size/1024/1024).toFixed(2),te="".concat(P.formatMessage({id:"common.upload.starting",defaultMessage:"Starting upload"})," ").concat(O.name,", ").concat(P.formatMessage({id:"common.upload.fileSize",defaultMessage:"File size"}),": ").concat(ie,"MB");return T.ZP.info(te),se},customRequest:function(O){var se=O.action,ie=O.file,te=O.onError,Te=O.onProgress,y=O.onSuccess,p=O.headers,j=new FormData;j.append("file",ie);var i=new XMLHttpRequest;return i.timeout=we,i.open("post",se,!0),p&&Object.keys(p).forEach(function(f){i.setRequestHeader(f,p[f])}),i.upload.addEventListener("progress",function(f){if(f.lengthComputable){var W=Math.round(f.loaded/f.total*100);Te({percent:W},ie)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var f=JSON.parse(i.response);y(f,ie)}catch(Oe){var W=P.formatMessage({id:"common.upload.error.serverResponse",defaultMessage:"Server response error"});te(new Error(W),ie)}else{var S="".concat(P.formatMessage({id:"common.upload.error.httpStatus",defaultMessage:"HTTP status error"})," ").concat(i.status);te(new Error(S),ie)}}),i.addEventListener("error",function(){var f=P.formatMessage({id:"common.upload.error.network",defaultMessage:"Network error"});te(new Error(f),ie)}),i.addEventListener("timeout",function(){var f=P.formatMessage({id:"common.upload.error.timeout",defaultMessage:"Upload timeout"});te(new Error(f),ie)}),i.addEventListener("abort",function(){var f=P.formatMessage({id:"common.upload.error.cancelled",defaultMessage:"Upload cancelled"});te(new Error(f),ie)}),i.send(j),{abort:function(){i.abort()}}}},_e=k||P.formatMessage({id:"common.upload.instruction.dragOrClick",defaultMessage:"Drag files here or click to upload"}),Ee=Y||P.formatMessage({id:"common.upload.instruction.uploadLimit",defaultMessage:"Supports batch upload, single file no more than ".concat(F,"MB")},{maxSize:F}),Me=function(){return(0,e.jsxs)("div",{className:"upload-content p-[4px]",children:[(0,e.jsx)("div",{className:"flex items-center w-full justify-center",children:U.map(function(O,se){return(0,e.jsx)("img",{src:O.src,alt:O.alt,className:"w-[42px] h-[42px] mx-3"},se)})}),(0,e.jsx)("div",{className:"mt-[10px] text-[#213044] text-sm",children:_e}),(0,e.jsx)("div",{className:"mt-[10px] text-[#999999] text-sm",children:Ee})]})},ye=x()(x()(x()({},je),I),{},{name:"file",multiple:fe,className:"".concat(ve," flex flex-col items-center justify-center"),showUploadList:xe,accept:_,disabled:N,style:{height:ne}});return(0,e.jsx)(Zt,x()(x()({},ye),{},{ref:ce,listType:"picture",children:R||Me()}))});st.displayName="FileUpload";var _t=st,Ot=(0,o.forwardRef)(function(l,d){var u=l.fun,s=l.createkbInfo,m=l.fileList,a=m===void 0?[]:m;return console.log("Upload component received fileList:",a.length,"files"),console.log("Upload fileList names:",a.map(function(L){return L.name})),(0,e.jsx)(_t,{ref:d,action:"".concat(Lt._n,"/v1/upload/upload_file"),fileList:a,onChange:u,disabled:s.type,accept:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv",maxSize:15,height:"200px",timeout:3e5,multiple:!0,showUploadList:!1,className:"mt-[15px]",fileTypeIcons:[{src:"/icons/word.svg",alt:"Word"},{src:"/icons/txt.svg",alt:"TXT"},{src:"/icons/pdf.svg",alt:"PDF"},{src:"/icons/xlsx.svg",alt:"Excel"},{src:"/icons/md.svg",alt:"Markdown"}]})}),Bt=Ot,Ge=n(34994),Ut=n(52688),Rt=n(86615),rt=n(31199),At=n(93967),nt=n.n(At),$t=n(98423),lt=n(98065),zt=n(53124),Ht=n(83559),Vt=n(83262);const it=["wrap","nowrap","wrap-reverse"],ot=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],ct=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Kt=(l,d)=>{const u=d.wrap===!0?"wrap":d.wrap;return{[`${l}-wrap-${u}`]:u&&it.includes(u)}},Gt=(l,d)=>{const u={};return ct.forEach(s=>{u[`${l}-align-${s}`]=d.align===s}),u[`${l}-align-stretch`]=!d.align&&!!d.vertical,u},Yt=(l,d)=>{const u={};return ot.forEach(s=>{u[`${l}-justify-${s}`]=d.justify===s}),u};function Wt(l,d){return nt()(Object.assign(Object.assign(Object.assign({},Kt(l,d)),Gt(l,d)),Yt(l,d)))}var Jt=Wt;const Xt=l=>{const{componentCls:d}=l;return{[d]:{display:"flex","&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Qt=l=>{const{componentCls:d}=l;return{[d]:{"&-gap-small":{gap:l.flexGapSM},"&-gap-middle":{gap:l.flexGap},"&-gap-large":{gap:l.flexGapLG}}}},qt=l=>{const{componentCls:d}=l,u={};return it.forEach(s=>{u[`${d}-wrap-${s}`]={flexWrap:s}}),u},ea=l=>{const{componentCls:d}=l,u={};return ct.forEach(s=>{u[`${d}-align-${s}`]={alignItems:s}}),u},ta=l=>{const{componentCls:d}=l,u={};return ot.forEach(s=>{u[`${d}-justify-${s}`]={justifyContent:s}}),u},aa=()=>({});var sa=(0,Ht.I$)("Flex",l=>{const{paddingXS:d,padding:u,paddingLG:s}=l,m=(0,Vt.mergeToken)(l,{flexGapSM:d,flexGap:u,flexGapLG:s});return[Xt(m),Qt(m),qt(m),ea(m),ta(m)]},aa,{resetStyle:!1}),ra=function(l,d){var u={};for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&d.indexOf(s)<0&&(u[s]=l[s]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,s=Object.getOwnPropertySymbols(l);m<s.length;m++)d.indexOf(s[m])<0&&Object.prototype.propertyIsEnumerable.call(l,s[m])&&(u[s[m]]=l[s[m]]);return u},na=o.forwardRef((l,d)=>{const{prefixCls:u,rootClassName:s,className:m,style:a,flex:L,gap:Z,children:N,vertical:ee=!1,component:fe="div"}=l,$=ra(l,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:_,direction:V,getPrefixCls:F}=o.useContext(zt.E_),z=F("flex",u),[xe,K,ve]=sa(z),ge=ee!=null?ee:_==null?void 0:_.vertical,ne=nt()(m,s,_==null?void 0:_.className,z,K,ve,Jt(z,l),{[`${z}-rtl`]:V==="rtl",[`${z}-gap-${Z}`]:(0,lt.n)(Z),[`${z}-vertical`]:ge}),oe=Object.assign(Object.assign({},_==null?void 0:_.style),a);return L&&(oe.flex=L),Z&&!(0,lt.n)(Z)&&(oe.gap=Z),xe(o.createElement(fe,Object.assign({ref:d,className:ne,style:oe},(0,$t.Z)($,["justify","wrap","align"])),N))}),Ye=n(78045),la=n(96074),dt=n(2487),ia=n(58533),We="0",Je="hit_count asc",Xe=1,ut="",ft,pt,oa=function(d){var u=d.item,s=d.fun,m=d.createkbInfo,a=(0,A.useIntl)(),L=[{title:a.formatMessage({id:"createkb.splitMode",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.charLimit",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.avgChar",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.sectionNum",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.totalRecall",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.embedTime",defaultMessage:""})+"\uFF1A",value:""},{title:a.formatMessage({id:"createkb.embedCost",defaultMessage:""})+"\uFF1A",value:""}],Z=(0,o.useState)(!1),N=h()(Z,2),ee=N[0],fe=N[1],$=(0,o.useState)([]),_=h()($,2),V=_[0],F=_[1],z=(0,o.useState)(null),xe=h()(z,2),K=xe[0],ve=xe[1],ge=function(){s("return")};function ne(){return L.filter(function(R){return R.value!=null}).map(function(R){return(0,e.jsx)("div",{className:"mr-[40px]",children:(0,e.jsxs)("div",{className:"flex items-center grow shrink-0",children:[(0,e.jsx)("div",{className:"text-[#666666] text-[12px] leading-[17px] font-normal",children:R.title}),(0,e.jsx)("div",{className:"text-[#213044] text-[12px] leading-[17px] font-medium",children:R.value})]})},"".concat(R.title))})}var oe=function(k){var Y=k.target.value;clearTimeout(ft),ft=setTimeout(function(){F([]),ut=Y,U(1)},500)},we=function(){Xe+=1,U(Xe)},be=function(){var R=c()(r()().mark(function k(Y,I){var P;return r()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:Y?P=(0,b.Rc)(I.id):P=(0,b.U4)(I.id);case 1:case"end":return X.stop()}},k)}));return function(Y,I){return R.apply(this,arguments)}}(),U=function(){var R=c()(r()().mark(function k(){var Y,I,P=arguments;return r()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return Y=P.length>0&&P[0]!==void 0?P[0]:1,Xe=Y,X.next=4,(0,b.gD)({document_id:u.id,page:Y,page_size:10,hit_count:Je,content:ut,status:We});case 4:I=X.sent,ve(I.data),K==null&&(L[0].value=I.data.seg_set.seg_Mode,L[1].value=I.data.seg_set.seg_Len,L[2].value=I.data.seg_set.seg_Overlap,L[3].value=I.data.seg_set.seg_Avg,L[4].value=I.data.seg_set.seg_Num,L[5].value=I.data.seg_set.hit_Num,L[6].value=I.data.seg_set.Embedding_Time,L[7].value=I.data.seg_set.Embedding_Token,pt=ne()),F(function(pe){return[].concat(Ke()(pe),Ke()(I.data.data))});case 8:case"end":return X.stop()}},k)}));return function(){return R.apply(this,arguments)}}();return(0,o.useEffect)(function(){U()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"py-[30px] bg-white overflow-hidden w-full h-full flex flex-col",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"border-b  flex items-center pb-[30px]",children:[(0,e.jsx)("div",{className:"border-r mr-[10px] pr-[10px] cursor-pointer",onClick:ge,children:(0,e.jsx)("img",{src:"/icons/return.svg",className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("img",{src:"/icons/textIcon.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"text-[#213044] leading-[25px] text-[18px] font-medium ml-[5px]",children:u.name})]})]}),(0,e.jsx)("div",{className:"pt-[20px] pb-[15px] text-[#555555]  text-[14px] leading-[20px] font-medium",children:a.formatMessage({id:"createkb.docParams",defaultMessage:""})}),(0,e.jsx)("div",{className:"w-full border border-[#EEEEEE] rounded-lg p-[15px] bg-[#F7F7F7]",children:(0,e.jsx)(na,{wrap:!0,gap:"middle",align:"center",children:pt})}),(0,e.jsxs)("div",{className:"pt-[20px] pb-[15px] text-[#555555] text-[14px] leading-[20px] font-medium",children:[a.formatMessage({id:"createkb.docPara",defaultMessage:""})," ",K!=null?K.paging_information.total_count:""]}),(0,e.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,e.jsxs)("div",{className:"sticky-0 flex items-center",children:[(0,e.jsx)(et.Z,{defaultValue:"".concat(We),style:{width:114,height:32,background:"#F7F7F7"},onSelect:function(k){We=k,F([]),U(1)},options:[{value:"0",label:a.formatMessage({id:"createkb.all",defaultMessage:""})},{value:"1",label:a.formatMessage({id:"createkb.enabled",defaultMessage:""})},{value:"2",label:a.formatMessage({id:"createkb.disabled",defaultMessage:""})}]}),(0,e.jsx)(ae.Z,{size:"large",placeholder:a.formatMessage({id:"createkb.search",defaultMessage:""}),prefix:(0,e.jsx)(at.Z,{className:"text-[#213044] opacity-30"}),onChange:oe,className:"w-[300px] text-sm h-8 ml-5"})]}),(0,e.jsx)("div",{className:"flex-1 justify-end flex items-center",children:(0,e.jsxs)("div",{className:"flex items-center text-[#555555] text-[14px] leading-[20px] font-normal",children:[(0,e.jsxs)("span",{children:[a.formatMessage({id:"createkb.recallSort"}),"\uFF1A"]}),(0,e.jsxs)(Ye.ZP.Group,{defaultValue:Je,onChange:function(k){Je=k.target.value,F([]),U(1)},size:"small",children:[(0,e.jsx)(Ye.ZP,{value:"hit_count asc",children:a.formatMessage({id:"createkb.highToLow"})}),(0,e.jsx)(Ye.ZP,{value:"hit_count desc",children:a.formatMessage({id:"createkb.lowToHigh"})})]})]})})]})]}),K!=null?(0,e.jsx)("div",{className:"overflow-y-auto flex-1 mt-4",id:"lists",children:(0,e.jsx)(ia.Z,{dataLength:V.length,next:we,hasMore:V.length<K.paging_information.total_count,loader:!1,endMessage:V.length<=0?"":(0,e.jsx)(la.Z,{plain:!0,children:a.formatMessage({id:"createkb.bottom"})}),scrollableTarget:"lists",children:(0,e.jsx)(dt.Z,{dataSource:V,split:!1,renderItem:function(k){return(0,e.jsx)(dt.Z.Item,{style:{padding:"0px"},children:(0,e.jsxs)("div",{className:"w-full rounded-lg bg-[#F7F7F7] p-[15px] mb-[15px]",children:[(0,e.jsxs)("div",{className:"w-full flex items-center",children:[(0,e.jsxs)("div",{className:"py-1 rounded-md px-2 border border-[#D8D8D8] flex items-center justify-center text-[#213044] text-sm",children:["#",k.segnum<=9?"00"+k.segnum:k.segnum<=99?"0"+k.segnum:k.segnum]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zishu.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:k.word_count})]}),(0,e.jsxs)("div",{className:"flex items-center ml-8",children:[(0,e.jsx)("img",{src:"/icons/zh.svg",className:"w-4 h-4"}),(0,e.jsx)("div",{className:"ml-[5px] text-[#213044] text-sm",children:k.hit_count})]}),(0,e.jsx)("div",{className:"ml-8 ",children:(0,e.jsx)(Ve.Z,{defaultChecked:k.status!=2,onChange:function(I){return be(I,k)},disabled:m.type,size:"small"},k.id)})]}),(0,e.jsx)("div",{className:"pt-5",children:(0,e.jsx)("span",{className:"text-[#213044] text-sm",children:k.content})})]})},k.id)}})})}):""]})})},ca=oa,Re=1,mt,gt="",Qe=null,qe={split:!0,split_mode:"text",chunk_size:4e3,chunk_overlap:200},da=(0,o.memo)(function(l){var d=l.onFinish,u=l.isUploading,s=l.formValuesRef,m=l.intl,a=(0,o.useCallback)(function(Z){return s.current=Z,d(Z)},[d,s]),L=(0,o.useCallback)(function(Z,N){s.current=N},[s]);return(0,e.jsxs)(Ge.A,{submitter:{resetButtonProps:!1,searchConfig:{submitText:m.formatMessage({id:"createkb.uploadToKnowledgeBase",defaultMessage:""})}},onFinish:a,layout:"horizontal",initialValues:s.current,disabled:u,onValuesChange:L,preserve:!1,children:[(0,e.jsx)(Ut.Z,{name:"split",label:m.formatMessage({id:"createkb.splitContent",defaultMessage:""})}),(0,e.jsx)(Ge.A.Item,{noStyle:!0,dependencies:["split"],children:function(N){var ee=N.getFieldValue;return ee("split")?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Rt.Z.Group,{label:m.formatMessage({id:"createkb.splitType",defaultMessage:""}),name:"split_mode",radioType:"button",fieldProps:{options:[{label:"text",value:"text"},{label:"markdown",value:"markdown"}]}}),(0,e.jsx)(Ge.A.Item,{noStyle:!0,dependencies:["split_mode"],children:function($){var _=$.getFieldValue;return _("split_mode")==="text"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(rt.Z,{label:m.formatMessage({id:"createkb.chunkSize",defaultMessage:""}),name:"chunk_size",min:200,max:8e3}),(0,e.jsx)(rt.Z,{label:m.formatMessage({id:"createkb.chunkOverlap",defaultMessage:""}),name:"chunk_overlap",min:0,max:8e3})]}):null}})]}):null}})]})}),ua=function(d){var u=d.fun,s=d.createkbInfo,m=Et.Z.confirm,a=(0,A.useIntl)(),L=function(g,v,D,H,Q,M){return(0,e.jsx)("div",{className:"mt-[10px] border border-[#EEEEEE] rounded-lg",children:(0,e.jsx)(Ce.Z,{columns:g,loading:v,dataSource:D,size:"middle",pagination:H,locale:{emptyText:(0,e.jsx)("div",{className:"text-[#666666] text-[14px] leading-[20px] font-normal",children:(0,e.jsx)("span",{children:a.formatMessage({id:"createkb.no.data.available",defaultMessage:""})})})},onRow:function($e,J){return{onClick:function(){return Q($e,J)},style:{cursor:"pointer"}}},onChange:M,rowKey:"id"})})},Z=(0,o.useState)([]),N=h()(Z,2),ee=N[0],fe=N[1],$=(0,o.useState)([]),_=h()($,2),V=_[0],F=_[1],z=(0,o.useState)(null),xe=h()(z,2),K=xe[0],ve=xe[1],ge=(0,o.useState)(!0),ne=h()(ge,2),oe=ne[0],we=ne[1],be=(0,o.useState)(!0),U=h()(be,2),R=U[0],k=U[1],Y=(0,o.useState)(null),I=h()(Y,2),P=I[0],ce=I[1],X=(0,o.useState)(1),pe=h()(X,2),je=pe[0],_e=pe[1],Ee=(0,o.useState)([]),Me=h()(Ee,2),ye=Me[0],le=Me[1],O=(0,o.useState)(!1),se=h()(O,2),ie=se[0],te=se[1],Te=(0,o.useRef)(qe),y=(0,o.useRef)(null),p=function(){u({type:"next",data:"3"})},j=function(g){k(!0)},i=function(g){var v=Ke()(ee);v[g]=!v[g],fe(v)},f=function(){var w=c()(r()().mark(function g(v,D,H,Q){var M,C;return r()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(M=null,v){J.next=7;break}return J.next=4,(0,b.LV)(H.id);case 4:M=J.sent,J.next=10;break;case 7:return J.next=9,(0,b.OK)(H.id);case 9:M=J.sent;case 10:M.code==0&&(C=V.map(function(Ne,Ze){return Q==Ze&&(Ne.status=v?1:2),x()(x()({},Ne),{},{statusText:Ne.status==1?a.formatMessage({id:"createkb.normal",defaultMessage:""}):Ne.status==2?a.formatMessage({id:"createkb.disabled",defaultMessage:""}):a.formatMessage({id:"createkb.deleted",defaultMessage:""})})}),F(C));case 11:case"end":return J.stop()}},g)}));return function(v,D,H,Q){return w.apply(this,arguments)}}(),W=function(){var w=c()(r()().mark(function g(v,D){return r()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:m({title:a.formatMessage({id:"createkb.deleteOperation",defaultMessage:""}),content:a.formatMessage({id:"createkb.confirmDelete",defaultMessage:"?"}),onOk:function(){var M=c()(r()().mark(function $e(){var J;return r()().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:return Ze.next=2,(0,b.iH)(v);case 2:J=Ze.sent,J.code==0&&(Le(Re),i(D));case 4:case"end":return Ze.stop()}},$e)}));function C(){return M.apply(this,arguments)}return C}(),onCancel:function(){}});case 1:case"end":return Q.stop()}},g)}));return function(v,D){return w.apply(this,arguments)}}(),S=function(g){var v=g.target.value;clearTimeout(mt),mt=setTimeout(function(){gt=v,Re=1,Le()},500)},Oe=function(g,v){ce(g),k(!1)},me=function(g){g&&g.stopPropagation&&g.stopPropagation()},Ie=[{title:a.formatMessage({id:"createkb.filename",defaultMessage:""}),dataIndex:"name",key:"name",ellipsis:!0,className:"max-w-48 text-[#213044] text-xs py-[15px]"},{title:a.formatMessage({id:"createkb.charCount",defaultMessage:""}),dataIndex:"word_count",key:"word_count",className:"max-w-48 w-24 text-[#213044] text-xs py-[15px]"},{title:a.formatMessage({id:"createkb.recallNum",defaultMessage:""}),dataIndex:"hit_count",key:"hit_count",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]"},{title:a.formatMessage({id:"createkb.uploadTime",defaultMessage:""}),dataIndex:"created_time",key:"created_time",className:"max-w-48 w-44 text-[#213044] text-xs py-[15px]",sorter:!0},{title:a.formatMessage({id:"createkb.status",defaultMessage:""}),dataIndex:"statusText",key:"statusText",className:"max-w-48 w-28 text-[#213044] text-xs py-[15px]",render:function(g,v,D){return(0,e.jsx)("div",{onClick:me,children:(0,e.jsx)(Ve.Z,{className:v.status==2?"":"bg-[#1B64F3]",defaultChecked:v.status!=2,onChange:function(Q){return f(Q,g,v,D)},size:"small"},g)})}},{title:a.formatMessage({id:"createkb.action"}),dataIndex:"id",key:"id",className:"max-w-48 w-20 text-[#213044] text-xs py-[15px]",render:function(g,v,D){return(0,e.jsx)("div",{onClick:me,children:(0,e.jsx)("img",{src:"/icons/delete.svg",className:"w-4 h-4",onClick:function(){W(g,D)}})})}}],Ae=function(){var w=c()(r()().mark(function g(v){var D,H;return r()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:console.log("getList called with:",v.fileList.length,"files"),console.log("File names:",v.fileList.map(function(C){return C.name})),console.log("File statuses:",v.fileList.map(function(C){return"".concat(C.name,": ").concat(C.status)})),D=v.fileList.some(function(C){return C.status==="uploading"}),te(D),H=v.fileList.some(function(C){return C.status==="error"}),H&&!D&&te(!1),le(v.fileList);case 8:case"end":return M.stop()}},g)}));return function(v){return w.apply(this,arguments)}}(),Le=function(){var w=c()(r()().mark(function g(){var v,D,H,Q,M,C=arguments;return r()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return v=C.length>0&&C[0]!==void 0?C[0]:1,D=C.length>1&&C[1]!==void 0?C[1]:Qe,we(!0),H={app_id:s.app_id,page:v,page_size:10,name:gt},J.next=6,(0,b.SH)(H);case 6:Q=J.sent,Q.code==0&&(M=Q.data.data.map(function(Ne,Ze){return x()(x()({},Ne),{},{statusText:Ne.status==1?a.formatMessage({id:"createkb.normal"}):Ne.status==2?a.formatMessage({id:"createkb.disabled"}):a.formatMessage({id:"createkb.deleted"})})}),F(M),ve(Q.data)),we(!1);case 9:case"end":return J.stop()}},g)}));return function(){return w.apply(this,arguments)}}(),xt=function(g,v,D){Qe=D.order=="ascend"?"asc":D.order=="descend"?"desc":null,Re=g.current,Le(Re,Qe)},G={total:K!=null?K.paging_information.total_count:0,current:Re,hideOnSinglePage:!0};(0,o.useEffect)(function(){s.app_id&&(_e(s.type?2:1),Le())},[]);var ke=(0,o.useCallback)(function(){var w=c()(r()().mark(function g(v){var D,H;return r()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(D=ye.filter(function(C){return C.status==="done"&&C.response}),D.length!==0){M.next=4;break}return T.ZP.warning(a.formatMessage({id:"createkb.upload.selectFileFirst"})),M.abrupt("return");case 4:return M.prev=4,M.next=7,(0,b.H_)({app_id:s.app_id*1,file_ids:D.map(function(C){return C.response.data.file_id*1}),process_rule_id:1,data_source_type:1,text_split_config:x()(x()({},qe),v)});case 7:H=M.sent,H.code==0?(le([]),Te.current=qe,setTimeout(function(){var C;(C=y.current)===null||C===void 0||C.reset()},100),Le(Re),T.ZP.success(a.formatMessage({id:"createkb.upload.addToKbSuccess",defaultMessage:"Files successfully added to knowledge base"})),console.log("Files cleared and component reset")):T.ZP.error(a.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"})),M.next=15;break;case 11:M.prev=11,M.t0=M.catch(4),console.error("Add document error:",M.t0),T.ZP.error(a.formatMessage({id:"createkb.upload.addToKbFailed",defaultMessage:"Failed to add files to knowledge base"}));case 15:case"end":return M.stop()}},g,null,[[4,11]])}));return function(g){return w.apply(this,arguments)}}(),[ye,s.app_id,a]),Se=function(g){le(function(v){var D=v[g],H=v.filter(function(M,C){return C!==g});console.log("File deleted: ".concat(D==null?void 0:D.name," at index ").concat(g)),console.log("Remaining files:",H.map(function(M){return M.name})),console.log("File list length changed from ".concat(v.length," to ").concat(H.length));var Q=H.some(function(M){return M.status==="uploading"});return te(Q),H})},ga=function(){le([]),te(!1),setTimeout(function(){var g;(g=y.current)===null||g===void 0||g.reset()},100),T.ZP.info(a.formatMessage({id:"createkb.upload.allFilesCleared",defaultMessage:"All files cleared"})),console.log("All files manually cleared")};return(0,e.jsx)(e.Fragment,{children:R?K!=null?(0,e.jsxs)("div",{className:"h-full bg-white w-full",children:[(0,e.jsxs)("div",{className:"w-full py-[30px] flex items-center ",children:[(0,e.jsx)("img",{src:"/icons/flag.svg",className:"w-4 h-4"}),(0,e.jsx)("span",{className:"ml-[10px] text-[#213044] text-[18px] leading-[25px] font-medium",children:je==2?(0,A.getLocale)()=="zh-CN"?K.dataset_detail.nickname+a.formatMessage({id:"createkb.knowledge.base.of"}):a.formatMessage({id:"createkb.knowledge.base.of"})+K.dataset_detail.nickname:je==1?a.formatMessage({id:"createkb.editKB"}):a.formatMessage({id:"createkb.createKnowledgeBase"})})]}),(0,e.jsx)("div",{className:"text-[#333333] text-[16px] leading-[22px] font-medium",children:a.formatMessage({id:"createkb.documentSettings"})}),(0,e.jsx)("div",{className:"text-[#555555] text-[12px] leading-[17px] font-medium pt-[30px]",children:a.formatMessage({id:"createkb.uploadDoc"})}),(0,e.jsx)(Bt,{ref:y,fun:Ae,createkbInfo:s,fileList:ye}),ye.length>0&&(0,e.jsxs)("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg ",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("h4",{className:"text-base font-medium text-gray-700",children:a.formatMessage({id:"createkb.fileList",defaultMessage:""})}),(0,e.jsx)("button",{onClick:ga,className:"text-xs text-red-500 hover:text-red-700 transition-colors px-2 py-1 border border-red-200 rounded hover:border-red-300",children:a.formatMessage({id:"createkb.upload.clearAll",defaultMessage:"Clear All"})})]}),(0,e.jsx)("ul",{className:"space-y-1",children:ye.map(function(w,g){return(0,e.jsx)("li",{className:"flex items-center justify-between text-sm text-gray-600 bg-gray-50 p-3 rounded",children:(0,e.jsxs)("div",{className:"flex-1 mr-2",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsx)("span",{className:"truncate font-medium",children:w.name}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[w.status==="uploading"&&(0,e.jsx)("button",{onClick:function(){w.xhr&&w.xhr.abort(),Se(g)},className:"text-gray-500 hover:text-gray-700 transition-colors text-xs",children:a.formatMessage({id:"createkb.upload.cancel"})}),(0,e.jsx)("button",{onClick:function(){return Se(g)},className:"text-red-500 hover:text-red-700 transition-colors","aria-label":"".concat(a.formatMessage({id:"createkb.deleteFile"})," ").concat(w.name),title:"".concat(a.formatMessage({id:"createkb.deleteFile"})," ").concat(w.name),children:(0,e.jsx)(Ct.Z,{})})]})]}),w.status==="uploading"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)(Tt.Z,{percent:Math.round(w.percent||0),size:"small",status:"active",strokeColor:"#1B64F3"}),(0,e.jsxs)("div",{className:"text-xs text-blue-500 font-medium",children:[a.formatMessage({id:"createkb.upload.progress"})," ",Math.round(w.percent||0),"%",w.size&&(0,e.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",(w.size/1024/1024).toFixed(2),"MB)"]})]})]}),w.status==="done"&&(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-green-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-green-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-green-600 font-medium whitespace-nowrap",children:a.formatMessage({id:"createkb.upload.complete"})})]}),w.status==="error"&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-full bg-red-100 rounded-full h-2",children:(0,e.jsx)("div",{className:"bg-red-500 h-2 rounded-full w-full"})}),(0,e.jsx)("div",{className:"text-xs text-red-600 font-medium whitespace-nowrap",children:a.formatMessage({id:"createkb.upload.failed"})})]}),w.error&&(0,e.jsx)("div",{className:"text-xs text-red-500 mt-1",children:w.error.message||a.formatMessage({id:"createkb.error.unknown"})}),(0,e.jsx)("button",{onClick:function(){T.ZP.info(a.formatMessage({id:"createkb.instruction.retryUpload"}))},className:"text-xs text-blue-500 hover:text-blue-700",children:a.formatMessage({id:"createkb.upload.retry"})})]})]})},w.uid||g)})}),(0,e.jsx)(da,{onFinish:ke,isUploading:ie,formValuesRef:Te,intl:a})]}),(0,e.jsx)("div",{className:"flex justify-between pt-[30px]",children:(0,e.jsx)("span",{className:"text-[#213044] text-xs font-medium",children:a.formatMessage({id:"createkb.documentList"})})}),(0,e.jsx)("div",{className:"flex items-center w-full pt-[10px]",children:(0,e.jsx)(ae.Z,{placeholder:a.formatMessage({id:"createkb.searchDoc"}),onChange:S,className:"w-[782px] h-10 mr-5",prefix:(0,e.jsx)(at.Z,{})})}),L(Ie,oe,V,G,Oe,xt),(0,e.jsx)("div",{className:"mt-[30px]",children:(0,e.jsx)(re.ZP,{type:"primary",className:"py-[10px] h-[40px] px-[15px] bg-[#1B64F3] text-white text-[14px] leading-[20px] font-medium",onClick:p,children:a.formatMessage({id:"createkb.enterRecallTest"})})})]}):"":(0,e.jsx)(ca,{fun:j,item:P,createkbInfo:s})})},fa=ua,ht=function(){A.history.back()},pa=function(){var d=(0,A.useIntl)(),u=(0,o.useState)("1"),s=h()(u,2),m=s[0],a=s[1],L=(0,o.useState)((0,Pe.Go)("GET")),Z=h()(L,2),N=Z[0],ee=Z[1],fe=[{key:"1",icon:(0,e.jsx)(e.Fragment,{children:m=="1"?(0,e.jsx)("img",{src:"/icons/kb_setting_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/kb_setting.svg",className:"w-4 h-4 mr-[10px]"})}),label:d.formatMessage({id:"createkb.settings",defaultMessage:""}),style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:m=="1"?"#1B64F3":"#213044"}},{key:"2",icon:(0,e.jsx)(e.Fragment,{children:m=="2"?(0,e.jsx)("img",{src:"/icons/uptxt_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/uptxt.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:N.app_id?"1":"0.4"}})}),label:d.formatMessage({id:"createkb.documentSettings",defaultMessage:""}),disabled:!N.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:m=="2"?"#1B64F3":"#213044"}},{key:"3",icon:(0,e.jsx)(e.Fragment,{children:m=="3"?(0,e.jsx)("img",{src:"/icons/recall_test_select.svg",className:"w-4 h-4 mr-[10px]"}):(0,e.jsx)("img",{src:"/icons/recall_test.svg",className:"w-4 h-4 mr-[10px]",style:{opacity:N.app_id?"1":"0.4"}})}),label:d.formatMessage({id:"createkb.recallTest",defaultMessage:""}),disabled:!N.app_id,style:{padding:"15px",width:"100%",margin:"0px",marginBottom:"10px",fontSize:"16px",fontWeight:"500",color:m=="3"?"#1B64F3":"#213044"}}],$=function(F){F.type=="set"&&(N.app_id=F.data,ee(N)),F.type=="return"&&ht(),F.type=="next"&&a(F.data)};function _(){var V=function(z){a(z.key)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"flex flex-col bg-white h-full",children:[(0,e.jsx)("div",{className:" bg-white pl-[30px] pt-[30px] border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)("div",{className:"w-full flex  justify-start",children:(0,e.jsxs)("div",{className:"cursor-pointer flex items-center",onClick:ht,children:[(0,e.jsx)(re.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(de.Z,{className:"text-[#1B64F3] w-4 h-4"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:d.formatMessage({id:"createkb.back",defaultMessage:""})})]})})}),(0,e.jsx)("div",{className:"w-full flex-1 px-[30px] py-[30px] bg-white border-[#e5e7eb] border-solid border-r",children:(0,e.jsx)(De.Z,{onClick:V,style:{width:"100%",borderInlineEnd:"1px solid rgba(0,0,0,0)"},defaultSelectedKeys:[m],mode:"inline",items:fe})})]})})}return(0,e.jsxs)("div",{className:"w-full flex bg-white",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)("div",{className:"w-[300px] shrink-0",children:(0,e.jsx)(_,{})}),(0,e.jsx)("div",{className:"shrink-0 h-full overflow-y-auto bg-white overflow-x-auto",style:{width:"calc(100% - 300px)"},children:(0,e.jsx)("div",{className:"w-full h-full flex xl:justify-center justify-start flex-1",children:(0,e.jsx)("div",{className:"w-[900px] xl:px-0 px-[30px]",children:m=="1"?(0,e.jsx)(St,{createkbInfo:N,fun:$}):m=="2"?(0,e.jsx)(fa,{createkbInfo:N,fun:$}):(0,e.jsx)(vt,{createkbInfo:N,fun:$})})})})]})},ma=pa},58533:function(ze,Fe,n){var he=n(67294);var h=function(x,E){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var c in t)t.hasOwnProperty(c)&&(r[c]=t[c])},h(x,E)};function Pe(x,E){h(x,E);function r(){this.constructor=x}x.prototype=E===null?Object.create(E):(r.prototype=E.prototype,new r)}var de=function(){return de=Object.assign||function(E){for(var r,t=1,c=arguments.length;t<c;t++){r=arguments[t];for(var b in r)Object.prototype.hasOwnProperty.call(r,b)&&(E[b]=r[b])}return E},de.apply(this,arguments)};function A(x,E,r,t){var c,b=!1,T=0;function ue(){c&&clearTimeout(c)}function q(){ue(),b=!0}typeof E!="boolean"&&(t=r,r=E,E=void 0);function B(){var ae=this,Ce=Date.now()-T,e=arguments;if(b)return;function Ue(){T=Date.now(),r.apply(ae,e)}function He(){c=void 0}t&&!c&&Ue(),ue(),t===void 0&&Ce>x?Ue():E!==!0&&(c=setTimeout(t?He:Ue,t===void 0?x-Ce:x))}return B.cancel=q,B}var re={Pixel:"Pixel",Percent:"Percent"},De={unit:re.Percent,value:.8};function o(x){return typeof x=="number"?{unit:re.Percent,value:x*100}:typeof x=="string"?x.match(/^(\d*(\.\d+)?)px$/)?{unit:re.Pixel,value:parseFloat(x)}:x.match(/^(\d*(\.\d+)?)%$/)?{unit:re.Percent,value:parseFloat(x)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),De):(console.warn("scrollThreshold should be string or number"),De)}var Be=function(x){Pe(E,x);function E(r){var t=x.call(this,r)||this;return t.lastScrollTop=0,t.actionTriggered=!1,t.startY=0,t.currentY=0,t.dragging=!1,t.maxPullDownDistance=0,t.getScrollableTarget=function(){return t.props.scrollableTarget instanceof HTMLElement?t.props.scrollableTarget:typeof t.props.scrollableTarget=="string"?document.getElementById(t.props.scrollableTarget):(t.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},t.onStart=function(c){t.lastScrollTop||(t.dragging=!0,c instanceof MouseEvent?t.startY=c.pageY:c instanceof TouchEvent&&(t.startY=c.touches[0].pageY),t.currentY=t.startY,t._infScroll&&(t._infScroll.style.willChange="transform",t._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},t.onMove=function(c){t.dragging&&(c instanceof MouseEvent?t.currentY=c.pageY:c instanceof TouchEvent&&(t.currentY=c.touches[0].pageY),!(t.currentY<t.startY)&&(t.currentY-t.startY>=Number(t.props.pullDownToRefreshThreshold)&&t.setState({pullToRefreshThresholdBreached:!0}),!(t.currentY-t.startY>t.maxPullDownDistance*1.5)&&t._infScroll&&(t._infScroll.style.overflow="visible",t._infScroll.style.transform="translate3d(0px, "+(t.currentY-t.startY)+"px, 0px)")))},t.onEnd=function(){t.startY=0,t.currentY=0,t.dragging=!1,t.state.pullToRefreshThresholdBreached&&(t.props.refreshFunction&&t.props.refreshFunction(),t.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){t._infScroll&&(t._infScroll.style.overflow="auto",t._infScroll.style.transform="none",t._infScroll.style.willChange="unset")})},t.onScrollListener=function(c){typeof t.props.onScroll=="function"&&setTimeout(function(){return t.props.onScroll&&t.props.onScroll(c)},0);var b=t.props.height||t._scrollableNode?c.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!t.actionTriggered){var T=t.props.inverse?t.isElementAtTop(b,t.props.scrollThreshold):t.isElementAtBottom(b,t.props.scrollThreshold);T&&t.props.hasMore&&(t.actionTriggered=!0,t.setState({showLoader:!0}),t.props.next&&t.props.next()),t.lastScrollTop=b.scrollTop}},t.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:r.dataLength},t.throttledOnScrollListener=A(150,t.onScrollListener).bind(t),t.onStart=t.onStart.bind(t),t.onMove=t.onMove.bind(t),t.onEnd=t.onEnd.bind(t),t}return E.prototype.componentDidMount=function(){if(typeof this.props.dataLength=="undefined")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},E.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},E.prototype.componentDidUpdate=function(r){this.props.dataLength!==r.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},E.getDerivedStateFromProps=function(r,t){var c=r.dataLength!==t.prevDataLength;return c?de(de({},t),{prevDataLength:r.dataLength}):null},E.prototype.isElementAtTop=function(r,t){t===void 0&&(t=.8);var c=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,b=o(t);return b.unit===re.Pixel?r.scrollTop<=b.value+c-r.scrollHeight+1:r.scrollTop<=b.value/100+c-r.scrollHeight+1},E.prototype.isElementAtBottom=function(r,t){t===void 0&&(t=.8);var c=r===document.body||r===document.documentElement?window.screen.availHeight:r.clientHeight,b=o(t);return b.unit===re.Pixel?r.scrollTop+c>=r.scrollHeight-b.value:r.scrollTop+c>=b.value/100*r.scrollHeight},E.prototype.render=function(){var r=this,t=de({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),c=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),b=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return he.createElement("div",{style:b,className:"infinite-scroll-component__outerdiv"},he.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(T){return r._infScroll=T},style:t},this.props.pullDownToRefresh&&he.createElement("div",{style:{position:"relative"},ref:function(T){return r._pullDown=T}},he.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!c&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},E}(he.Component);Fe.Z=Be}}]);
