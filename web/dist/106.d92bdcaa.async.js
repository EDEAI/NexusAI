"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[106],{85422:function(Ee,Q,e){var X=e(15009),R=e.n(X),q=e(99289),D=e.n(q),ee=e(5574),O=e.n(ee),ae=e(11551),w=e(39873),te=e(28508),M=e(29933),A=e(35312),se=e(3917),B=e(66309),ie=e(28036),F=e(71471),N=e(74330),v=e(26412),h=e(12845),L=e(67294),z=e(22683),J=e(97807),ne=e(24216),s=e(85893);Q.Z=(0,L.memo)(function(W){var x,Z,K,c=W.data,re=W.onClose,g=(0,A.useIntl)(),V=(0,L.useState)(500),_=O()(V,2),m=_[0],le=_[1],n=(0,se.Z)(function(){var I=D()(R()().mark(function b(S,y){var k;return R()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,ae.pC)(S,y);case 2:return k=$.sent,$.abrupt("return",k.data);case 4:case"end":return $.stop()}},b)}));return function(b,S){return I.apply(this,arguments)}}(),{manual:!0}),a=n.data,o=n.loading,d=n.run;(0,L.useEffect)(function(){c!=null&&c.app_id&&c!==null&&c!==void 0&&c.app_run_id&&d(c.app_id,c.app_run_id)},[c==null?void 0:c.app_id,c==null?void 0:c.app_run_id,d]);var P=function(b){var S={1:{color:"processing",text:g.formatMessage({id:"workflow.running"})},2:{color:"success",text:g.formatMessage({id:"workflow.runSc"})},3:{color:"error",text:g.formatMessage({id:"workflow.runF"})}},y=S[b]||{color:"default",text:"Unknown"};return(0,s.jsx)(B.Z,{color:y.color,children:y.text})},j=function(b){le(b)};return(0,s.jsx)(w.Z,{className:"fixed top-[65px] right-2 p-0",dragDirection:"left",minWidth:400,maxWidth:800,defaultWidth:m,onChange:j,children:(0,s.jsx)(M.Z,{className:"border-none h-full",style:{height:"calc(100vh - 50px - 60px)"},bodyStyle:{overflowY:"auto",padding:"16px"},extra:(0,s.jsx)(ie.ZP,{type:"text",className:"-mr-4 -mt-8",onClick:re,icon:(0,s.jsx)(te.Z,{})}),title:(0,s.jsx)(F.Z.Title,{level:5,children:g.formatMessage({id:"agent.log.detail"})}),loading:o,children:(0,s.jsx)("div",{className:"space-y-6",children:o?(0,s.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,s.jsx)(N.Z,{})}):a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(v.Z,{column:1,bordered:!0,size:"small",children:[(0,s.jsx)(v.Z.Item,{label:g.formatMessage({id:"workflow.user"}),children:a.nickname}),(0,s.jsx)(v.Z.Item,{label:g.formatMessage({id:"workflow.status"}),children:P(a.status)}),(0,s.jsx)(v.Z.Item,{label:g.formatMessage({id:"workflow.created_time"}),children:a.created_time}),(0,s.jsxs)(v.Z.Item,{label:g.formatMessage({id:"workflow.elapsed_time"}),children:[a.elapsed_time,"s"]}),(0,s.jsx)(v.Z.Item,{label:"Tokens",children:a.total_tokens})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(F.Z.Title,{level:5,children:g.formatMessage({id:"agent.log.output"})}),a.outputs?(0,s.jsx)("div",{children:(a==null||(x=a.outputs)===null||x===void 0?void 0:x.type)=="json"?(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)(ne.Z,{language:"python3",value:JSON.parse((Z=a.outputs)===null||Z===void 0?void 0:Z.value)||"{}",readOnly:!0,isJSONStringifyBeauty:!0,onChange:function(){},title:"JSON"})}):(0,s.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,s.jsx)(z.U,{rehypePlugins:[J.Z],children:((K=a.outputs)===null||K===void 0?void 0:K.value)||""})})}):a.error?(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded mt-2 border-l-4 border-red-500",children:[(0,s.jsx)("div",{className:"text-red-500 font-medium mb-2",children:g.formatMessage({id:"agent.log.error"})}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-red-500",children:a.error})]}):(0,s.jsx)("div",{className:"bg-gray-50 p-4 rounded mt-2",children:(0,s.jsx)("div",{className:"text-sm text-gray-500",children:g.formatMessage({id:"agent.log.no.output"})})})]}),Array.isArray(a==null?void 0:a.prompt_data)&&a.prompt_data.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)(F.Z.Title,{level:5,children:g.formatMessage({id:"agent.log.conversation"})}),(0,s.jsx)(h.Z,{className:"mt-2",children:a.prompt_data.map(function(I,b){var S=O()(I,2),y=S[0],k=S[1];return(0,s.jsx)(h.Z.Item,{color:y==="human"?"blue":"green",children:(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:y}),(0,s.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:k.value})]})},b)})})]})]}):null})})})})},68709:function(Ee,Q,e){e.d(Q,{Z:function(){return le}});var X=e(19632),R=e.n(X),q=e(15009),D=e.n(q),ee=e(99289),O=e.n(ee),ae=e(97857),w=e.n(ae),te=e(5574),M=e.n(te),A=e(11551),se=e(80279),B=e(77295),ie=e(39944),F=e(55927),N=e(38008),v="agent_fullscreen_states",h=function(a){try{var o=localStorage.getItem(v);if(!o)return!1;var d=JSON.parse(o);return d[String(a)]||!1}catch(P){return console.warn("Failed to get agent fullscreen state:",P),!1}},L=function(a,o){try{var d=localStorage.getItem(v),P=d?JSON.parse(d):{};P[String(a)]=o,localStorage.setItem(v,JSON.stringify(P)),console.log("Agent ".concat(a," fullscreen state saved: ").concat(o))}catch(j){console.warn("Failed to save agent fullscreen state:",j)}},z=function(a){try{var o=localStorage.getItem(v);if(!o)return;var d=JSON.parse(o);delete d[String(a)],localStorage.setItem(v,JSON.stringify(d)),console.log("Agent ".concat(a," fullscreen state cleared"))}catch(P){console.warn("Failed to clear agent fullscreen state:",P)}},J=function(){try{var a=localStorage.getItem(v);return a?JSON.parse(a):{}}catch(o){return console.warn("Failed to get all agent fullscreen states:",o),{}}},ne=function(){try{localStorage.removeItem(v),console.log("All agent fullscreen states cleared")}catch(a){console.warn("Failed to clear all agent fullscreen states:",a)}},s=e(19078),W=e(5785),x=e(34994),Z=e(35312),K=e(77598),c=e(45360),re=e(74330),g=e(28036),V=e(32983),_=e(67294),m=e(85893),le=(0,_.memo)(function(n){var a,o,d,P,j,I=(0,_.useState)([]),b=M()(I,2),S=b[0],y=b[1],k=(0,_.useState)(!0),oe=M()(k,2),$=oe[0],Be=oe[1],Fe=(0,_.useState)(1),Me=M()(Fe,2),la=Me[0],Ne=Me[1],We=(0,_.useState)(!0),xe=M()(We,2),Ze=xe[0],Ke=xe[1],$e=(0,_.useState)(!1),Se=M()($e,2),ue=Se[0],De=Se[1],Ge=(0,_.useState)(!1),Pe=M()(Ge,2),ia=Pe[0],de=Pe[1],He=(0,_.useState)(!1),Ie=M()(He,2),je=Ie[0],be=Ie[1],ze=(0,_.useState)(!1),ye=M()(ze,2),Je=ye[0],ce=ye[1],Ve=(0,_.useState)(!1),Te=M()(Ve,2),U=Te[0],_e=Te[1],me=(0,_.useRef)(),ke=(0,_.useRef)(null),Ye=(0,_.useRef)(null),G=(0,Z.useIntl)(),ve=(0,F.Z)(function(l){return l.getTypedMessages("chat_message_llm_return")}),Qe=(0,_.useState)(null),Oe=M()(Qe,2),Re=Oe[0],Xe=Oe[1],ge=(0,F.Z)(function(l){return l.getTypedLastMessage("chat_message_llm_return")}),qe=(0,_.useState)(null),Ae=M()(qe,2),ea=Ae[0],aa=Ae[1],ta=function(){var r,u=(r=n.data)===null||r===void 0||(r=r.detailList)===null||r===void 0||(r=r.agent)===null||r===void 0?void 0:r.agent_id;if(u){var i=!U;_e(i),L(u,i)}else console.warn("Cannot save fullscreen state: agentId is not available"),_e(function(p){return!p})};(0,_.useEffect)(function(){var l;if(((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.app)===null||l===void 0?void 0:l.name)!=null){var r;console.log(n.data);var u=n.data.detailList.agent_chatroom_id,i=n.data.detailList.agent.agent_id;if(u){var p=window.location.search,E=new URLSearchParams(p);Xe(u),E.set("id",String(u));var t="".concat(window.location.pathname,"?").concat(E.toString()).concat(window.location.hash);window.history.replaceState({},"",t)}var C=w()(w()({},n.data.detailList.app),{},{agent:n.data.detailList.agent,agent_id:i});if(console.log("AgentInfo updated:",{m_config_id:(r=C.agent)===null||r===void 0?void 0:r.m_config_id,agent_id:C.agent_id,name:C.name}),aa(C),i){var f=h(i);console.log("Restoring fullscreen state for agent ".concat(i,": ").concat(f)),_e(f)}setTimeout(function(){Ke(!1)},500)}},[(a=n.data)===null||a===void 0||(a=a.detailList)===null||a===void 0||(a=a.app)===null||a===void 0?void 0:a.name,(o=n.data)===null||o===void 0||(o=o.detailList)===null||o===void 0||(o=o.agent)===null||o===void 0?void 0:o.m_config_id]);var Y=(0,B.ZP)(),Le=Y.uploadedFiles,oa=Y.setUploadedFiles,ua=Y.handleUpload,da=Y.removeFile,sa=Y.clearFiles,ca=Y.isUploading,fe=function(){var r;(r=ke.current)===null||r===void 0||r.scrollIntoView({behavior:"smooth"})},Ce=function(){var l=O()(D()().mark(function r(){var u,i,p;return D()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,be(!0),!(n!=null&&(u=n.saveInfo)!==null&&u!==void 0&&u.firstjudgingcondition())){t.next=6;break}return t.abrupt("return",!0);case 6:if(!(n!=null&&(i=n.saveInfo)!==null&&i!==void 0&&i.secondjudgingcondition())){t.next=10;break}return t.abrupt("return",!0);case 10:return t.next=12,n==null||(p=n.saveInfo)===null||p===void 0?void 0:p.agentupdata();case 12:return t.abrupt("return",t.sent);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(0),console.error("Failed to save info:",t.t0),t.abrupt("return",!1);case 19:return t.prev=19,be(!1),t.finish(19);case 22:case"end":return t.stop()}},r,null,[[0,15,19,22]])}));return function(){return l.apply(this,arguments)}}();(0,K.Z)(function(){var l,r=ge==null?void 0:ge.data;if(r&&!((r==null?void 0:r.agent_id)!==((l=n.data)===null||l===void 0||(l=l.detailList)===null||l===void 0||(l=l.agent)===null||l===void 0?void 0:l.agent_id)&&!c.ZP.error)){var u=w()(w()({},r),{},{id:r.message_id});ve&&ve.length>0&&(de(!1),y(function(i){return[].concat(R()(i),[u])}),setTimeout(fe,100))}},[ve]),(0,_.useEffect)(function(){!ue&&S.length>0&&fe()},[ue]);var na=function(){var l=O()(D()().mark(function r(u){var i,p,E,t,C,f,he,we,pe,Ue;return D()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(console.log(u),t=(i=me.current)===null||i===void 0?void 0:i.getFieldsValue(),!(!t||!((p=u.content)!==null&&p!==void 0&&p.trim()))){T.next=4;break}return T.abrupt("return");case 4:return C=n.data.detailList.agent.agent_id,f=n.data.detailList.agent.input_variables,he=t.ability_id,we=new ie.z({user:{value:t.content}}),pe=Le.map(function(H){return{name:H.name,url:H.url||H.path_show||""}}),Ue={id:Date.now(),content:u.content,isUser:!0,ability_id:he,agent_id:C,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:t.content,prompt_tokens:0,total_tokens:0,file_list:pe.length>0?pe:void 0},de(!0),y(function(H){return[].concat(R()(H),[Ue])}),(E=me.current)===null||E===void 0||E.resetFields(["content"]),T.prev=13,T.next=16,(0,A.CY)({agent_id:C,input_dict:f,ability_id:he,prompt:we,file_list:Le.map(function(H){return H.file_id})});case 16:sa(),T.next=23;break;case 19:T.prev=19,T.t0=T.catch(13),de(!1),c.ZP.error(G.formatMessage({id:"agent.chat.send.failed"}));case 23:setTimeout(fe,100);case 24:case"end":return T.stop()}},r,null,[[13,19]])}));return function(u){return l.apply(this,arguments)}}(),_a=function(){var l=O()(D()().mark(function r(){var u,i,p;return D()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((u=n.data)!==null&&u!==void 0&&(u=u.detailList)!==null&&u!==void 0&&(u=u.agent)!==null&&u!==void 0&&u.agent_id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,De(!0),t.next=6,(0,A.CU)(String(n.data.detailList.agent.agent_id),1);case 6:p=t.sent,(i=p.data)!==null&&i!==void 0&&i.list&&(y(p.data.list),Be(p.data.total_pages>1),Ne(1)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("Failed to fetch initial messages:",t.t0);case 13:return t.prev=13,De(!1),t.finish(13);case 16:case"end":return t.stop()}},r,null,[[2,10,13,16]])}));return function(){return l.apply(this,arguments)}}();if(ue)return(0,m.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,m.jsx)(re.Z,{})});var ra=function(){var l=O()(D()().mark(function r(){return D()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,ce(!0),i.next=4,Ce();case 4:setTimeout(O()(D()().mark(function p(){var E,t;return D()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,(0,A.Dh)((E=n.data)===null||E===void 0||(E=E.detailList)===null||E===void 0||(E=E.agent)===null||E===void 0?void 0:E.agent_id);case 3:t=f.sent,t.code==0?c.ZP.success(G.formatMessage({id:"agent.message.success.publish"})):c.ZP.error(G.formatMessage({id:"agent.message.fail.publish"})),f.next=11;break;case 7:f.prev=7,f.t0=f.catch(0),console.error("Failed to publish agent:",f.t0),c.ZP.error(G.formatMessage({id:"agent.message.fail.publish"}));case 11:return f.prev=11,ce(!1),f.finish(11);case 14:case"end":return f.stop()}},p,null,[[0,7,11,14]])})),500),i.next=11;break;case 7:i.prev=7,i.t0=i.catch(0),console.error("Failed to save before publish:",i.t0),ce(!1);case 11:case"end":return i.stop()}},r,null,[[0,7]])}));return function(){return l.apply(this,arguments)}}();return Ze?null:(0,m.jsx)("div",{ref:Ye,className:"".concat(U?"fixed inset-0 z-50 !h-screen  border border-gray-300 top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:U?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,m.jsxs)(x.A,{formRef:me,submitter:!1,onFinish:na,layout:"horizontal",initialValues:{ability_id:0},style:{height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[(0,m.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,m.jsx)("div",{className:"flex-1 flex items-center font-bold text-base",children:(d=n.data)===null||d===void 0||(d=d.detailList)===null||d===void 0||(d=d.app)===null||d===void 0?void 0:d.name}),(0,m.jsx)(g.ZP,{type:"text",icon:U?(0,m.jsx)(s.Z,{}):(0,m.jsx)(W.Z,{}),onClick:ta,title:G.formatMessage({id:U?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),n.operationbentate=="false"&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(g.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:je,onClick:Ce,className:"min-w-24",children:G.formatMessage({id:"agent.btn.savedebug"})}),(0,m.jsx)(g.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:Je||je,onClick:ra,className:"min-w-24",children:G.formatMessage({id:"agent.publish"})})]})]}),Re?(0,m.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(U?"max-w-[1400px] mx-auto justify-center":""),style:{height:U?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,m.jsx)(N.aS,{children:(0,m.jsx)(se.F,{agentList:{current:[ea]},abilitiesList:(P=n.data)===null||P===void 0?void 0:P.abilitiesList,agentChatRoomId:Re,chatStatus:(j=n.data)===null||j===void 0||(j=j.detailList)===null||j===void 0?void 0:j.chat_status})})}):(0,m.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,m.jsx)(V.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})},27842:function(Ee,Q,e){var X=e(5574),R=e.n(X),q=e(15009),D=e.n(q),ee=e(99289),O=e.n(ee),ae=e(11551),w=e(29608),te=e(83535),M=e(35312),A=e(67294),se=e(85422),B=e(85893),ie=null,F=null;Q.ZP=function(N){var v=N.agent_id,h=(0,M.useIntl)(),L=(0,M.useSearchParams)(),z=R()(L,1),J=z[0],ne=(0,A.useRef)(null),s=(0,A.useState)(null),W=R()(s,2),x=W[0],Z=W[1],K=(0,A.useState)(!1),c=R()(K,2),re=c[0],g=c[1],V=J.get("app_id"),_=function(){g(!1)},m=function(o){Z({app_id:V,app_run_id:o.id}),g(!0)},le=[{dataIndex:"index",valueType:"indexBorder",width:48},{disable:!0,title:h.formatMessage({id:"workflow.status",defaultMessage:""}),dataIndex:"status",ellipsis:!0,search:!1,valueEnum:{1:{text:h.formatMessage({id:"workflow.running",defaultMessage:""}),status:"Processing"},2:{text:h.formatMessage({id:"workflow.runSc",defaultMessage:""}),status:"Success"},3:{text:h.formatMessage({id:"workflow.runF",defaultMessage:""}),status:"Error"}}},{title:h.formatMessage({id:"workflow.created_time",defaultMessage:""}),dataIndex:"created_time",ellipsis:!0,tooltip:h.formatMessage({id:"workflow.created_time_des",defaultMessage:h.formatMessage({id:"workflow.created_time_des",defaultMessage:""})}),search:!1},{title:"".concat(h.formatMessage({id:"workflow.elapsed_time",defaultMessage:""}),"S"),dataIndex:"elapsed_time",ellipsis:!0,tooltip:h.formatMessage({id:"workflow.run_time"}),search:!1},{title:"Tokens",key:"showTime",dataIndex:"total_tokens",hideInSearch:!0},{title:h.formatMessage({id:"workflow.user"}),dataIndex:"nickname",search:!1,ellipsis:!0,key:"user"}],n=(0,w.Z)(function(a){return a.setRunPanelLogRecord});return(0,B.jsxs)("div",{className:"h-full",children:[(0,B.jsx)(te.Z,{columns:le,formRef:ne,form:{submitter:!1},cardBordered:!0,style:{height:"calc(100% - 20px)"},scroll:{y:"calc(100vh - 230px)"},request:function(){var a=O()(D()().mark(function o(d,P,j){var I;return D()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return console.log(d,P,j),S.next=3,(0,ae.My)(V,{page:d.current,page_size:d.pageSize});case 3:return I=S.sent,console.log(I),S.abrupt("return",{data:I.data.list,success:!0,total:I.data.total_count});case 6:case"end":return S.stop()}},o)}));return function(o,d,P){return a.apply(this,arguments)}}(),onRow:function(o){return{onClick:function(){m(o)},className:(x==null?void 0:x.app_run_id)===o.id?"bg-blue-50":""}},editable:{type:"multiple"},rowKey:"app_runs_id",search:!1,options:{search:!1,setting:{listsHeight:600}},pagination:{pageSize:20,showSizeChanger:!1},dateFormatter:"string",headerTitle:h.formatMessage({id:"agent.log.list"})}),re&&(x==null?void 0:x.app_id)&&(x==null?void 0:x.app_run_id)&&(0,B.jsx)(se.Z,{data:x,onClose:_})]})}}}]);
