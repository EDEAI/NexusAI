"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{86:function(ct,ke,h){var $e=h(5574),A=h.n($e),He=h(32332),re=h(38703),Le=h(67294),v=h(85893),de=function(a){var ae=a.subtitle,Ze=a.handleClick,le=a.lineClamp,Qe=le===void 0?2:le,ee=a.textDetails,ve=a.title,Be=a.icon,De=a.iconType,Ie=De===void 0?"":De,Ae=a.operation,Ce=Ae===void 0?"":Ae,Se=a.progress,fe=a.status,Pe=a.backlogTips,Ee=(0,Le.useState)(0),he=A()(Ee,2),Me=he[0],Re=he[1],ze=function(){Re(Se)},Ue=function(){Re(0)},Ve=function(e){return"rounded-[4px] border-l-[4px] ".concat(e==1?"border-[#1B64F3]":e==2?"border-[#52C41C]":"border-[#F04444]"," ")};return(0,v.jsxs)("div",{className:"flex  p-[10px] cursor-pointer overflow-hidden relative bg-[#fff] ".concat(fe!==void 0?Ve(fe):"graphicbox"),onClick:Ze,onMouseEnter:function(){Se!=null&&ze()},onMouseLeave:function(){Se!=null&&Ue()},children:[fe!==void 0&&(0,v.jsx)("div",{style:{width:"".concat(Me,"%"),transition:"width 0.5s "},className:"absolute bottom-0 left-0 top-0 bottom-0 h-full ".concat(fe==1?"bg-[#1B64F3]/[.03]":fe==2?"bg-[#52c41c]/[.05]":"bg-[#FAFAFA]"," ")}),(0,v.jsxs)("div",{className:"flex gap-x-[20px] w-full relative z-20",children:[(0,v.jsx)("div",{className:"shrink-0 flex gap-x-[7px] items-center",style:{fontSize:0},children:(0,v.jsxs)("div",{className:"w-[40px] h-[40px] rounded-[6px] flex items-center justify-center bg-[#F4F8F1] relative",children:[(0,v.jsx)("img",{src:(0,He.s9)("single",Be),className:"w-[22px] h-[22px]"}),Ie&&(0,v.jsx)("div",{className:"w-[16px] h-[16px] absolute top-[28px] left-[28px] flex items-center justify-center bg-[#fff] rounded-[3px]",style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,v.jsx)("img",{src:"/icons/".concat(Ie,".svg"),alt:"",className:"w-[12px] h-[12px]"})})]})}),(0,v.jsx)("div",{className:"flex flex-1 min-w-0",children:(0,v.jsxs)("div",{className:"flex justify-center flex-col gap-y-[5px] flex-1 min-w-0",children:[(0,v.jsxs)("span",{className:"text-[12px] flex items-center",style:{color:"#213044"},children:[(0,v.jsx)("span",{className:"truncate",children:ve}),(0,v.jsx)("span",{className:"flex items-center flex-1",children:ae})]}),(0,v.jsx)("span",{className:"text-[12px] max-w-full truncate",style:{color:"#999999"},children:ee})]})}),Pe||(0,v.jsx)(v.Fragment,{}),Ce&&(0,v.jsx)("div",{className:"flex items-center w-[24px]",children:(0,v.jsx)("span",{className:"operation",children:Ce})}),Se!=null&&(0,v.jsx)("div",{className:"graphic_progress flex items-center pl-[30px]",children:(0,v.jsx)(re.Z,{type:"circle",percent:Se,size:29})})]})]})};ke.Z=de},43777:function(ct,ke,h){h.r(ke),h.d(ke,{default:function(){return Ia}});var $e=h(15009),A=h.n($e),He=h(99289),re=h.n(He),Le=h(5574),v=h.n(Le),de=h(43722),ye=h(32983),a=h(67294),ae=h(35312),Ze=h(19632),le=h.n(Ze),Qe=h(97857),ee=h.n(Qe),ve=h(32332),Be=h(82114),De=h(82826),Ie=h(63783),Ae=h(3471),Ce=h(45360),Se=h(85576),fe=h(28036),Pe=h(83062),Ee=h(72269),he=h(74330),Me=h(96486),Re=h(44010),ze=h(73445),Ue=h(782),Ve=(0,ze.Ue)((0,Ue.mW)(function(u,n){return{clearMemory:null,truncatable:!1,disableInput:!1,summaryParams:null,runsSummaryShow:!1,summaryClick:!0,setClearMemory:function(p){u({clearMemory:p})},setTruncatable:function(p){u({truncatable:p})},setDisableInput:function(p){u({disableInput:p})},setSummaryParams:function(p){u({summaryParams:p})},setRunsSummaryShow:function(p){u({runsSummaryShow:p})},setSummaryClick:function(p){console.log(p),u({summaryClick:p})}}})),X=Ve,e=h(85893),ot=function(n){var r=(0,ae.useIntl)(),p=n.roomDetail,S=n.setAgent,d=Ce.ZP.useMessage(),f=v()(d,2),m=f[0],R=f[1],g=(0,ae.useParams)(),j=g.id,l=X(function(s){return s.disableInput}),N=X(function(s){return s.truncatable}),w=X(function(s){return s.setClearMemory}),M=(0,a.useState)([]),P=v()(M,2),x=P[0],H=P[1],J=(0,a.useState)(ee()({},p)),$=v()(J,2),t=$[0],Z=$[1],U=(0,a.useState)([]),K=v()(U,2),L=K[0],I=K[1],W=(0,a.useRef)(!1),te=(0,a.useRef)(!1),Y=(0,a.useState)(!1),B=v()(Y,2),O=B[0],V=B[1],E=function(){var i=Se.Z.confirm;i({title:r.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(Be.Z,{}),content:r.formatMessage({id:"app.chatroom.clear.tips"}),okText:r.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:r.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){w(["TRUNCATE","0"])}})},C=function(){var s=re()(A()().mark(function i(){var c;return A()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!j){y.next=5;break}return y.next=3,(0,de.cH)({id:j});case 3:if(c=y.sent,c.code==0)try{Z(function(){return ee()(ee()({},c.data.chat_info),{},{max_round:c.data.max_round,smart_selection:c.data.smart_selection})}),H(c.data.agent_list),W.current=!0}catch(b){}case 5:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),se=function(){var s=re()(A()().mark(function i(){var c;return A()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,de.j2)({id:j});case 2:c=y.sent,c.code==0&&(I(c.data.list),te.current=!0);case 4:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}(),ie=function(){var s=re()(A()().mark(function i(c){var o,y,b;return A()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!j){D.next=11;break}if(o=c.active==1?0:1,o!=0){D.next=7;break}if(y=x.filter(function(z){return z.active==1}),y.length-1!=0){D.next=7;break}return m.open({type:"error",content:r.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),D.abrupt("return",!1);case 7:return D.next=9,(0,de.sT)({active:o},j,c.agent_id);case 9:b=D.sent,b.code==0&&H(function(z){return z.map(function(ce){return ee()(ee()({},ce),{},{active:ce.agent_id==c.agent_id?o:ce.active})})});case 11:case"end":return D.stop()}},i)}));return function(c){return s.apply(this,arguments)}}(),pe=function(i){return i.length>6?i.length=6:i.lenth,i},G=function(i){i.type=="my_agent"?ae.history.push("/Agents?app_id=".concat(i.app_id,"&type=false&from=chat_room")):ae.history.push("/ReadOnlyAgent?app_id=".concat(i.app_id,"&type=true&from=chat_room"))},T=function(i){ae.history.replace("/chat_room/".concat(i.chatroom_id)),window.location.reload()},q=function(){V(!0)},Q=function(){V(!1)},F=function(){var s=re()(A()().mark(function i(c){var o,y,b;return A()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!(c.checkItem&&c.checkItem.length==0)){D.next=3;break}return m.open({type:"error",content:r.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2}),D.abrupt("return");case 3:return o=le()(c.checkItem).map(function(z){var ce=z.agent_id,ne=z.active,oe=ne===void 0?1:ne;return{agent_id:ce,active:oe}}),y={description:t.description,name:t.name,max_round:t.max_round},D.next=7,(0,de.sI)(ee()(ee()({},y),{},{agent:o}),j);case 7:b=D.sent,b.code==0?(c.checkItem.map(function(z){z.active=z.active==null?1:z.active}),H(le()(c.checkItem)),S.current=le()(c.checkItem),m.open({type:"success",content:r.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):m.open({type:"error",content:r.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 9:case"end":return D.stop()}},i)}));return function(c){return s.apply(this,arguments)}}(),_=function(){var s=re()(A()().mark(function i(){var c;return A()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return c=t.smart_selection==1?0:1,y.next=3,(0,de.r5)({smart_selection:c},j);case 3:Z(function(b){return ee()(ee()({},b),{},{smart_selection:c})});case 4:case"end":return y.stop()}},i)}));return function(){return s.apply(this,arguments)}}();return(0,a.useEffect)(function(){C(),se()},[]),(0,e.jsxs)(e.Fragment,{children:[R,(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){ae.history.go(-1)},children:[(0,e.jsx)(fe.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(De.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:r.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:t.name})]})}),(0,e.jsx)("div",{className:"h-[360px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsx)("div",{className:"flex gap-x-[5px] flex-1",children:(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_title"})})}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)(Pe.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:r.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(Ie.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:r.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Ee.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:t.smart_selection==1,onChange:_,disabled:l})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:W.current?(0,e.jsx)("div",{className:"flex flex-col",children:x&&x.length>0?x.map(function(s){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",s.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:s.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:s.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){G(s)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Ee.Z,{size:"small",disabled:l,defaultChecked:!0,className:"w-[28px]",checked:s.active==1,onChange:function(){ie(s)}})]})]},s.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px] ",children:(0,e.jsx)("div",{style:{border:"1px solid #1B64F3"},onClick:q,className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.add.agent"})})})}),(0,e.jsx)("div",{className:"px-[20px] pt-[15px]",children:(0,e.jsx)("div",{style:N&&!l?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,Me.throttle)(function(){N&&!l&&E()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:r.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:te.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:L&&L.length>0?L.map(function(s){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){T(s)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:s.name}),s.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:s.agent_list&&s.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[pe(s.agent_list).map(function(i,c){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,ve.s9)("single",i.icon),alt:"",className:"w-[18px]  h-[18px]"})})},c)}),s.agent_list.length>=6?(0,e.jsx)(Ae.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},s.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(he.Z,{})})})})]})]}),(0,e.jsx)(Re.Z,{show:O,popupClose:Q,popupSave:F,checkList:x,zIndex:99})]})]})},ut=(0,a.memo)(ot),dt=h(13769),pt=h.n(dt),xt=h(47635),xe=h(1413),ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},mt=ft,Ne=h(91146),vt=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:mt}))},ht=a.forwardRef(vt),gt=ht,jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},yt=jt,St=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:yt}))},Nt=a.forwardRef(St),wt=Nt,_t=h(2068),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M312.1 591.5c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8 86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.1-3.1 3.1-8.2 0-11.3l-36.8-36.8a8.03 8.03 0 00-11.3 0L517 485.3l-86.1-86.2a8.03 8.03 0 00-11.3 0L275.3 543.4a8.03 8.03 0 000 11.3l36.8 36.8z"}},{tag:"path",attrs:{d:"M904 160H548V96c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H120c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h356.4v32L311.6 884.1a7.92 7.92 0 00-2.3 11l30.3 47.2v.1c2.4 3.7 7.4 4.7 11.1 2.3L512 838.9l161.3 105.8c3.7 2.4 8.7 1.4 11.1-2.3v-.1l30.3-47.2a8 8 0 00-2.3-11L548 776.3V744h356c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 512H160V232h704v440z"}}]},name:"fund-projection-screen",theme:"outlined"},Ct=bt,Mt=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:Ct}))},Rt=a.forwardRef(Mt),Ft=Rt,Xe=h(26915),kt=h(20640),qe=h.n(kt),ge=h(22683),je=h(97807),Dt=["node","className","children"],It=Xe.Z.TextArea,At=(0,a.memo)(function(u){var n=u.setInstruction,r=u.messageApi,p=u.isStop,S=u.scrollDomRef,d=u.upButtonDom,f=(0,ae.useIntl)(),m=X(function(P){return P.disableInput}),R=X(function(P){return P.setDisableInput}),g=(0,a.useState)(""),j=v()(g,2),l=j[0],N=j[1],w=function(x){!x.shiftKey&&x.target.value==""&&(r.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),N(""),x.preventDefault()),!x.shiftKey&&x.keyCode==13&&x.target.value!=""&&(R(!0),N(""),n(["INPUT",x.target.value]),x.preventDefault())},M=(0,Me.throttle)(function(){n(["STOP",null])},300);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:d,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(x){S.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(gt,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(It,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:l,disabled:m,onChange:function(x){N(x.target.value)},onPressEnter:w,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(f.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),p?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:M,children:(0,e.jsx)(wt,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(m||!l?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,Me.throttle)(function(){if(m||!l)return!1;l||r.open({type:"warning",content:f.formatMessage({id:"app.chatroom.content.input"}),duration:10}),R(!0),n(["INPUT",l]),N("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),Pt=function u(n){return typeof n=="string"?n:Array.isArray(n)?n.map(u).join(""):a.isValidElement(n)?u(n.props.children):""},Et=function(n){return Pt(n)},We=function(n,r){return{code:function(S){var d=S.node,f=S.className,m=S.children,R=pt()(S,Dt),g=/language-(\w+)/.exec(f||"");if(g!=null&&g.length){var j=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:g[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var l=re()(A()().mark(function N(w){var M;return A()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,M=w.currentTarget,x.next=4,qe()(Et(m));case 4:M&&(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){M&&(M.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copycode"}))},200),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(0),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},N,null,[[0,8]])}));return function(N){return l.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:r.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(j).concat(n),className:"p-4",children:m})})]})}else return(0,e.jsx)("code",ee()(ee()({},R),{},{children:m}))}}},et=(0,a.memo)(function(u){var n=u.messageApi,r=u.index,p=u.idName,S=u.cidName,d=(0,ae.useIntl)(),f=(0,a.useState)(!1),m=v()(f,2),R=m[0],g=m[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){g(!0)},onMouseLeave:function(){g(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var j=re()(A()().mark(function l(N){var w,M;return A()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return w=N.target.closest("#".concat(p).concat(r)),M=w.querySelector("#".concat(S).concat(r)),x.prev=2,x.next=5,qe()(M.innerText);case 5:n.open({type:"success",content:d.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),x.next=11;break;case 8:x.prev=8,x.t0=x.catch(2),console.error("Failed to copy text: ",x.t0);case 11:case"end":return x.stop()}},l,null,[[2,8]])}));return function(l){return j.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(R?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(R?" text-[#1B64F3]":"text-[#666]"),children:d.formatMessage({id:"app.chatroom.content.copy"})})]})})}),tt=function(n){var r=n.id,p=n.index,S=n.idName,d=n.cidName,f=(0,ae.useIntl)(),m=X(function(M){return M.setSummaryClick}),R=(0,a.useState)(!0),g=v()(R,2),j=g[0],l=g[1],N=X(function(M){return M.summaryClick});(0,a.useEffect)(function(){l(N)},[N]);var w=X(function(M){return M.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(j?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(P){if(j){var x=P.target.closest("#".concat(S).concat(p)),H=x.querySelector("#".concat(d).concat(p));w({id:r,message:H.innerText}),m(!1)}},children:[(0,e.jsx)(_t.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:f.formatMessage({id:"app.chatroom.content.summary"})})]})})},Ot=function(n){var r=n.roomid,p=(0,ae.useIntl)(),S=X(function(l){return l.setSummaryClick}),d=(0,a.useState)(!0),f=v()(d,2),m=f[0],R=f[1],g=X(function(l){return l.summaryClick});(0,a.useEffect)(function(){R(g)},[g]);var j=X(function(l){return l.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(m?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){m&&(j({id:r}),S(!1))},children:[(0,e.jsx)(Ft,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:p.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},Tt=(0,a.memo)(function(u){var n=u.messageApi,r=u.setCurrentMessageContent,p=u.sendValue,S=u.agentList,d=u.scrollDomRef,f=u.upButtonDom,m=u.setIsStop,R=u.setisEnd,g=u.setSendValue,j=(0,ae.useIntl)(),l=(0,ae.useParams)(),N=l.id,w=X(function(W){return W.setDisableInput}),M=(0,a.useState)({}),P=v()(M,2),x=P[0],H=P[1],J=(0,a.useRef)(!1),$=(0,a.useRef)(""),t=X(function(W){return W.setTruncatable}),Z=function(te){var Y=te.data;if(Y.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var B=JSON.parse(Y.slice(22,-2));switch(B[0]){case"ERROR":w(!1),m(!1),g(""),n.open({type:"error",content:"webSocket-".concat(B[1]),duration:10});break;case"CHAT":var O={content:"".concat(B[1]),is_agent:0};r(function(C){return[].concat(le()(C),[O])}),setTimeout(function(){d.current.scrollTop=0,f.current.style.display="none"});break;case"STOPPABLE":m(B[1]);break;case"TRUNCATABLE":t(B[1]),B[1]||n.open({type:"success",content:"".concat(j.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":n.open({type:"success",content:"".concat(j.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(Y.indexOf("REPLY")!==-1&&Y.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var V=JSON.parse(Y.slice(22,-2))[1];$.current="",J.current=!0;var E=S.current.filter(function(C){return C.agent_id==V})[0];Object.keys(x).length&&r(function(C){return[].concat(le()(C),[x])}),H(function(C){return ee()(ee()({},C),{},{is_agent:1,icon:E==null?void 0:E.icon,name:E==null?void 0:E.name})}),m(!0),t(!1)}Y.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&J.current&&(d.current.scrollTop=0,f.current.style.display="none",$.current+=Y,H(function(C){return ee()(ee()({},C),{},{content:$.current})})),Y.indexOf("ENDCHAT")!==-1&&(J.current=!1,$.current="",w(!1),m(!1),t(!0),Object.keys(x).length&&r(function(C){return[].concat(le()(C),[x])}),H({}),R(!0),g(""))},U=(0,xt.Z)("chat",Z),K=U.runSocket,L=U.sendMessage,I=U.readyState;return(0,a.useEffect)(function(){I==1&&N&&L(JSON.stringify(["ENTER",parseInt(N)]))},[I]),(0,a.useEffect)(function(){p&&I==1&&L(p)},[p]),(0,a.useEffect)(function(){K()},[]),(0,e.jsx)(e.Fragment,{children:x.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(x.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:x.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",x.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(x.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:x.name?x.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(x.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:x.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We("add",j),children:x.content})})})]})]}):(0,e.jsx)(e.Fragment,{})})}),$t=(0,a.memo)(function(u){var n=u.messageApi,r=u.setUserMessage,p=u.sendValue,S=u.agentList,d=u.scrollDomRef,f=u.upButtonDom,m=u.setIsStop,R=u.setSendValue,g=(0,ae.useIntl)(),j=(0,a.useState)([]),l=v()(j,2),N=l[0],w=l[1],M=(0,a.useState)(!1),P=v()(M,2),x=P[0],H=P[1],J=(0,ae.useParams)(),$=J.id;return(0,a.useEffect)(function(){x&&(r(function(t){return[].concat(le()(N.reverse()),le()(t))}),w([]),setTimeout(function(){H(!1),d.current.scrollTop=0},200))},[x]),(0,e.jsxs)(e.Fragment,{children:[N.length?N.map(function(t,Z){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(t.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:t.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",t.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"currentContent".concat(Z),children:[(0,e.jsx)("div",{className:"".concat(t.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:t.name?t.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(t.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:t.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(Z),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We(Z,g),children:t.content})})}),t.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:n,index:Z,idName:"currentContent",cidName:"currentChilContent"}),(0,e.jsx)(tt,{id:$,index:Z,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},Z)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(Tt,{messageApi:n,setCurrentMessageContent:w,sendValue:p,agentList:S,scrollDomRef:d,upButtonDom:f,setIsStop:m,setisEnd:H,setSendValue:R})]})}),Ht=(0,a.memo)(function(u){var n=u.messageApi,r=u.scrollDomRef,p=u.instruction,S=u.setIsStop,d=u.upButtonDom,f=u.setInstruction,m=u.agentList,R=(0,ae.useIntl)(),g=(0,ae.useParams)(),j=g.id,l=(0,a.useState)([]),N=v()(l,2),w=N[0],M=N[1],P=(0,a.useRef)(!1),x=(0,a.useState)(""),H=v()(x,2),J=H[0],$=H[1],t=(0,a.useRef)(null),Z=(0,a.useRef)(!0),U=(0,a.useRef)(2),K=(0,a.useRef)(1),L=(0,a.useRef)(0),I=function(){var O=re()(A()().mark(function V(E){var C,se,ie=arguments;return A()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(C=ie.length>1&&ie[1]!==void 0?ie[1]:function(){},!j){G.next=6;break}return G.next=4,(0,de.KH)(j,{page:K.current,page_size:10});case 4:se=G.sent,se.code==0&&(U.current=se.data.total_pages,E||(t.current.style.display="none"),M(function(T){return E?le()(se.data.list.reverse()):[].concat(le()(T),le()(se.data.list.reverse()))}),E?setTimeout(function(){r.current.scrollTop=0,d.current.style.display="none"}):L.current=se.data.list.length,Z.current=!0);case 6:case"end":return G.stop()}},V)}));return function(E){return O.apply(this,arguments)}}(),W=function(V){var E=V.target.scrollHeight+(V.target.scrollTop-V.target.clientHeight);P.current!==Math.ceil(V.target.scrollTop)<-50&&(P.current=Math.ceil(V.target.scrollTop)<-50,d.current.style.display=P.current?"flex":"none"),E<10&&Z.current&&(Z.current=!1,K.current=K.current+1,t.current.style.display="flex",U.current>=K.current?I(!1):t.current.style.display="none")},te=function(V,E){E==="0"&&(E=Number(E));var C=["".concat(V),E===0||E?E:null];$(JSON.stringify(C))},Y=X(function(O){return O.disableInput}),B=X(function(O){return O.clearMemory});return(0,a.useEffect)(function(){B&&B.length&&te(B[0],B[1])},[B]),(0,a.useEffect)(function(){p&&p.length&&(te(p[0],p[1]?p[1]:""),f([]))},[p]),(0,a.useEffect)(function(){K.current=1,I(!0)},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:r,onScroll:W,children:[(0,e.jsxs)("div",{className:"w-[920px]",children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:w&&w.length?w.map(function(O,V){return(0,e.jsxs)("div",{id:"c".concat(O.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(O.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:O.is_agent==1?(0,e.jsx)("img",{src:(0,ve.s9)("single",O.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(V),children:[(0,e.jsx)("div",{className:"".concat(O.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:O.name?O.name:(0,ve.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(O.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:O.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(V),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],components:We(V,R),children:O.content})})}),O.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(et,{messageApi:n,idName:"content",cidName:"chilContent",index:V}),(0,e.jsx)(tt,{id:j,index:V,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},V)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)($t,{messageApi:n,setUserMessage:M,sendValue:J,agentList:m,scrollDomRef:r,upButtonDom:d,setIsStop:S,setSendValue:$})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!Y&&w.length?(0,e.jsx)(Ot,{roomid:j}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:t,children:(0,e.jsx)(he.Z,{})})]})})}),Lt=(0,a.memo)(function(u){var n=u.agentList,r=(0,a.useRef)(null),p=(0,a.useRef)(null),S=(0,a.useState)(!1),d=v()(S,2),f=d[0],m=d[1],R=(0,a.useState)([]),g=v()(R,2),j=g[0],l=g[1],N=Ce.ZP.useMessage(),w=v()(N,2),M=w[0],P=w[1];return(0,e.jsxs)(e.Fragment,{children:[P,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full",children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(Ht,{instruction:j,setInstruction:l,messageApi:M,scrollDomRef:r,setIsStop:m,upButtonDom:p,agentList:n}),(0,e.jsx)(At,{setInstruction:l,messageApi:M,isStop:f,upButtonDom:p,scrollDomRef:r})]})})]})}),Zt=h(42881),Bt=function(n){var r=n.children,p=n.className,S=p===void 0?"":p,d=n.dragDirection,f=d===void 0?"left":d,m=n.minWidth,R=m===void 0?415:m,g=n.maxWidth,j=g===void 0?820:g,l=n.minHeight,N=l===void 0?200:l,w=n.maxHeight,M=w===void 0?800:w,P=n.defaultWidth,x=P===void 0?415:P,H=n.defaultHeight,J=H===void 0?300:H,$=(0,a.useState)(x),t=v()($,2),Z=t[0],U=t[1],K=(0,a.useState)(J),L=v()(K,2),I=L[0],W=L[1],te=(0,a.useCallback)(function(V,E){U(V),E&&W(E)},[U,W]),Y=(0,Zt.W)({direction:["left","right"].includes(f)?"horizontal":"vertical",triggerDirection:f,minWidth:R,maxWidth:j,minHeight:N,maxHeight:M,onResize:te}),B=Y.triggerRef,O=Y.containerRef;return(0,e.jsxs)("div",{ref:O,style:{width:["left","right"].includes(f)?"".concat(Z,"px"):void 0,height:["top","bottom"].includes(f)?"".concat(I,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(S),children:[f==="left"&&(0,e.jsx)("div",{ref:B,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),f==="right"&&(0,e.jsx)("div",{ref:B,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,e.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),f==="top"&&(0,e.jsx)("div",{ref:B,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),f==="bottom"&&(0,e.jsx)("div",{ref:B,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,e.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),r]})},zt=(0,a.memo)(Bt),Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},Vt=Ut,Wt=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:Vt}))},Gt=a.forwardRef(Wt),Kt=Gt,Jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},Yt=Jt,Qt=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:Yt}))},Xt=a.forwardRef(Qt),qt=Xt,ea=h(83159),ta={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},aa=ta,na=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:aa}))},ra=a.forwardRef(na),sa=ra,Oe=h(86),at=h(34994),nt=h(2216),ia=h(85877),la=h(29432),ca=h(39944),oa=h(11551),Ge=h(55927),ua=function(n){var r,p,S,d=n.selectApp,f=n.runid,m=n.setBoxLoading,R=n.setinputShow,g=n.appId,j=n.id,l=n.setisRun,N=(0,ae.useIntl)(),w=(0,a.useRef)(""),M=(0,a.useRef)(""),P=(0,a.useRef)(null),x=(0,a.useState)(""),H=v()(x,2),J=H[0],$=H[1],t=(0,a.useState)(null),Z=v()(t,2),U=Z[0],K=Z[1],L=(0,a.useState)([]),I=v()(L,2),W=I[0],te=I[1],Y=(0,a.useState)(""),B=v()(Y,2),O=B[0],V=B[1],E=(0,Ge.Z)(function(G){return G.flowMessage}),C=function(T){M.current=se(T);var q={user:{value:se(T)}};V(new ca.z(q))},se=function G(T){return T.map(function(q){return q.type==="mention"?q.id:q.children?G(q.children):q.text}).join("")},ie=function(){var G=re()(A()().mark(function T(q){var Q,F;return A()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return m(!0),Q=Object.keys(q),Q.forEach(function(i){P.current.properties[i]&&(P.current.properties[i].value=q[i])}),s.next=5,(0,oa.LH)({agent_id:d.checkItem[0].agent_id,ability_id:0,input_dict:P.current,prompt:O,data_source_run_id:w.current});case 5:F=s.sent,F.code==0&&($(F.data.outputs_md),m(!1),l(!1));case 7:case"end":return s.stop()}},T)}));return function(q){return G.apply(this,arguments)}}(),pe=function(){var G=re()(A()().mark(function T(q,Q){var F,_;return A()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,de.xT)(q,Q);case 2:F=i.sent,(F==null?void 0:F.code)==0&&(w.current=F==null||(_=F.data)===null||_===void 0?void 0:_.app_run_id);case 4:case"end":return i.stop()}},T)}));return function(q,Q){return G.apply(this,arguments)}}();return(0,a.useEffect)(function(){d&&d.checkItem.length&&(l(!0),pe(j,{app_id:g,app_run_id:f,status:1,corrected_parameter:""}))},[d]),(0,a.useEffect)(function(){var G=E.filter(function(s){return s.data.app_run_id==f&&s.type.indexOf("generate_meeting_action_items")!==-1});if(G.length!=0){var T,q=(T=G[G.length-1])===null||T===void 0||(T=T.data)===null||T===void 0||(T=T.exec_data)===null||T===void 0||(T=T.outputs)===null||T===void 0?void 0:T.value;if(q){var Q=JSON.parse(q);P.current=Q;var F=Object.keys(Q.properties);if(F.length){K(Q.properties);var _=F.map(function(s){return{value:"<<".concat(la.qX,".inputs.").concat(s,">>"),label:s}});te(_)}R(!1),m(!1)}}},[E]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:d==null||(r=d.checkItem[0])===null||r===void 0?void 0:r.icon,title:d==null||(p=d.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:d==null||(S=d.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"robot_icon",handleClick:function(){}})}),U!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full",disabled:!M.current},searchConfig:{submitText:N.formatMessage({id:"workflow.button.run"})}},onFinish:function(T){ie(T)},children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(nt._,{data:U})}),(0,e.jsx)("div",{className:"h-[150px] overflow-y-auto border border-color-[#eee] py-[4px] px-[11px] mb-[8px]",children:(0,e.jsx)(ia.Z,{onChange:function(T){C(T)},options:W,placeholder:"\u8BF7\u8F93\u5165\u8FD0\u884C\u6307\u4EE4\uFF0C\u8F93\u5165@\u63D2\u5165\u53D8\u91CF"})})]}):(0,e.jsx)(e.Fragment,{}),J?(0,e.jsx)("div",{className:"max-h-[400px] overflow-y-auto mt-[16px]",children:(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:J})})}):(0,e.jsx)(e.Fragment,{})]})},da=(0,a.memo)(ua),pa=h(66309),rt=h(42237),xa=h(93696),fa=function(n,r){return a.createElement(Ne.Z,(0,xe.Z)((0,xe.Z)({},n),{},{ref:r,icon:xa.Z}))},ma=a.forwardRef(fa),va=ma,ha=h(4981),Ke=h(29608),ga=(0,a.memo)(function(u){var n=u.progressObj,r=function(){return parseFloat(n.elapsed_time).toFixed(6)},p=function(d){var f=new Date(d),m=f.getFullYear(),R=(f.getMonth()+1).toString().padStart(2,"0"),g=f.getDate().toString().padStart(2,"0"),j=f.getHours().toString().padStart(2,"0"),l=f.getMinutes().toString().padStart(2,"0"),N=f.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(m,".").concat(R,".").concat(g," ").concat(j,":").concat(l,":").concat(N)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&p(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[r(),"S"]})]})]})})}),ja=function(n){var r,p,S,d=n.selectApp,f=n.runid,m=n.setBoxLoading,R=n.setinputShow,g=n.appId,j=n.id,l=n.setisRun,N=(0,ae.useIntl)(),w=(0,a.useRef)(""),M=(0,a.useRef)(null),P=(0,a.useState)(null),x=v()(P,2),H=x[0],J=x[1],$=(0,a.useState)(!1),t=v()($,2),Z=t[0],U=t[1],K=(0,a.useState)(null),L=v()(K,2),I=L[0],W=L[1],te=(0,a.useState)(null),Y=v()(te,2),B=Y[0],O=Y[1],V=(0,a.useState)(null),E=v()(V,2),C=E[0],se=E[1],ie=(0,Ke.Z)(function(i){return i.setDealtWithData}),pe=(0,Ke.Z)(function(i){return i.setRunPanelLogRecord}),G=function(){var i=re()(A()().mark(function c(o){var y,b,k,D,z;return A()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return m(!0),y=Object.keys(o),b={},y.forEach(function(oe){M.current.properties[oe]&&(M.current.properties[oe].value=o[oe]),B&&B.forEach(function(me){me.node_id==oe&&(b[oe]=o[oe])})}),k={inputs:M.current,node_confirm_users:b,run_name:"chatroom-".concat(j,"-run-").concat(w.current,"-driven"),run_type:1,data_source_run_id:w.current},ne.next=7,(0,rt.UE)(g,k);case 7:D=ne.sent,D.code==0&&(w.current=D==null||(z=D.data)===null||z===void 0?void 0:z.app_run_id,U(!0),l(!1));case 9:case"end":return ne.stop()}},c)}));return function(o){return i.apply(this,arguments)}}(),T=function(){var i=re()(A()().mark(function c(){var o,y;return A()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:o=s==null?void 0:s.filter(function(D){return D.type=="workflow_run_progress"&&D.data.app_run_id==w.current}).map(function(D){var z=D.data;return z}),o&&o.length&&(y=o[o.length-1],J(y),m(!1));case 2:case"end":return k.stop()}},c)}));return function(){return i.apply(this,arguments)}}(),q=function(){var i=re()(A()().mark(function c(){var o,y,b,k,D;return A()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:y=s==null?void 0:s.filter(function(ne){return ne.type=="workflow_need_human_confirm"&&ne.data.app_run_id==w.current}),b=(o=y.map(function(ne){var oe=ne.data,me=ne.need_human_confirm;return{data:oe,need_human_confirm:me}}))===null||o===void 0?void 0:o.filter(function(ne){return ne.data.type!==1}),b&&b.length&&(D=b[b.length-1].data,D.exec_id=D==null||(k=D.node_exec_data)===null||k===void 0?void 0:k.node_exec_id,se(b[b.length-1]),m(!1));case 3:case"end":return ce.stop()}},c)}));return function(){return i.apply(this,arguments)}}(),Q=function(c){return c.completed_progress?parseInt(c.completed_progress.slice(0,-1)):!1},F=function(){var i=re()(A()().mark(function c(o,y){var b,k;return A()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,(0,de.xT)(o,y);case 2:b=z.sent,(b==null?void 0:b.code)==0&&(w.current=b==null||(k=b.data)===null||k===void 0?void 0:k.app_run_id);case 4:case"end":return z.stop()}},c)}));return function(o,y){return i.apply(this,arguments)}}(),_=function(){var i=re()(A()().mark(function c(){var o,y;return A()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return console.log(g),k.next=3,(0,rt.zO)(g);case 3:o=k.sent,o.code==0&&O(o==null||(y=o.data)===null||y===void 0?void 0:y.need_confirm_nodes),F(j,{app_id:g,app_run_id:f,status:1,corrected_parameter:""});case 6:case"end":return k.stop()}},c)}));return function(){return i.apply(this,arguments)}}();(0,a.useEffect)(function(){d&&d.checkItem.length&&(l(!0),_())},[d]);var s=(0,Ge.Z)(function(i){return i.flowMessage});return(0,a.useEffect)(function(){T(),q();var i=s.filter(function(k){return k.data.app_run_id==f&&k.type.indexOf("generate_meeting_action_items")!==-1});if(i.length!=0){var c,o=(c=i[i.length-1])===null||c===void 0||(c=c.data)===null||c===void 0||(c=c.exec_data)===null||c===void 0||(c=c.outputs)===null||c===void 0?void 0:c.value;if(o){var y=JSON.parse(o);M.current=y;var b=Object.keys(y.properties);b.length&&(console.log(y.properties),W(y.properties)),R(!1),m(!1)}}},[s]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(Oe.Z,{icon:d==null||(r=d.checkItem[0])===null||r===void 0?void 0:r.icon,title:d==null||(p=d.checkItem[0])===null||p===void 0?void 0:p.name,textDetails:d==null||(S=d.checkItem[0])===null||S===void 0?void 0:S.description,iconType:"workflow_icon",handleClick:function(){}})}),!Z&&I!=null?(0,e.jsxs)(at.A,{submitter:{resetButtonProps:!1,submitButtonProps:{className:"w-full"},searchConfig:{submitText:N.formatMessage({id:"workflow.button.run"})}},onFinish:G,children:[(0,e.jsx)("div",{className:"py-[6px]",children:(0,e.jsx)(nt._,{data:I})}),(0,e.jsx)(ha.e,{data:B})]}):(0,e.jsx)(e.Fragment,{children:I!=null?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[N.formatMessage({id:"app.summaryhistory.input"}),":"]}),Object.values(I).map(function(i){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:i.display_name||i.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:i.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),C&&C.need_human_confirm!=0?(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsxs)("div",{className:"flex gap-x-[6px] items-center h-[20px] cursor-pointer",onClick:function(){ie(C.data)},children:[(0,e.jsx)("div",{children:(0,e.jsx)(va,{className:"text-[#1B64F3] text-[16px]"})}),(0,e.jsx)("span",{children:N.formatMessage({id:"app.summary.backlogTips"})})]})}):(0,e.jsx)(e.Fragment,{}),H?(0,e.jsx)("div",{className:"pt-[10px]",children:(0,e.jsx)(Oe.Z,{status:H.status,icon:H.icon,title:(0,e.jsxs)("div",{className:"items-center gap-x-[8px] inline-flex justify-end w-full",children:[(0,e.jsx)("span",{className:"flex-1 truncate",children:H.run_name}),H.need_human_confirm==1?(0,e.jsx)(pa.Z,{className:" text-[12px] flex items-center justify-center margin-0",color:"blue",children:N.formatMessage({id:"app.summaryhistory.tag"})}):(0,e.jsx)(e.Fragment,{})]}),textDetails:(0,e.jsx)(ga,{progressObj:H}),handleClick:function(){pe(H)},progress:Q(H)})}):(0,e.jsx)(e.Fragment,{})]})},ya=(0,a.memo)(ja),Sa=function(n){var r,p,S,d=(0,ae.useIntl)(),f=n.runid,m=n.id,R=n.setBoxLoading,g=n.scrollDom,j=n.setinputShow,l=(0,a.useRef)("agent"),N=(0,a.useRef)(""),w=(0,a.useState)(!1),M=v()(w,2),P=M[0],x=M[1],H=(0,a.useState)({type:"agent",checkItem:[],show:!1}),J=v()(H,2),$=J[0],t=J[1],Z=[{key:"1",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(I){return ee()(ee()({},I),{},{type:"agent",show:!0})})},children:d.formatMessage({id:"app.summary.SelectAgent"})})},{key:"2",label:(0,e.jsx)("div",{className:"hover:text-[#1B64F3]",onClick:function(){t(function(I){return ee()(ee()({},I),{},{type:"workflow",show:!0})})},children:d.formatMessage({id:"app.summary.SelectWorkflow"})})}],U=function(){t(function(I){return ee()(ee()({},I),{},{show:!1})})},K=function(I){R(!0),t(function(W){return ee()(ee()({},W),{},{checkItem:I.checkItem})}),l.current=$.type,N.current=I.checkItem[0].app_id};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pt-[24px]  border-[#ddd]",style:{minHeight:$!=null&&(r=$.checkItem)!==null&&r!==void 0&&r.length?g==null||(p=g.current)===null||p===void 0?void 0:p.offsetHeight:"100%"},children:[(0,e.jsxs)("div",{className:"text-[14px] font-[500] flex item-center",children:[(0,e.jsx)("div",{className:"flex-1",children:d.formatMessage({id:"app.summary.Runapp"})}),(0,e.jsx)("div",{className:"px-[10px]",children:P?(0,e.jsx)(ea.Z,{menu:{items:Z},children:(0,e.jsx)(sa,{className:"transition cursor-pointer text-[#999] text-[18px] hover:text-[#1B64F3]"})}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{children:$!=null&&(S=$.checkItem)!==null&&S!==void 0&&S.length?(0,e.jsx)(e.Fragment,{children:l.current=="agent"?(0,e.jsx)(da,{id:m,appId:N.current,selectApp:$,runid:f,setBoxLoading:R,scrollDom:g,setinputShow:j,setisRun:x}):(0,e.jsx)(ya,{id:m,appId:N.current,selectApp:$,runid:f,setBoxLoading:R,scrollDom:g,setinputShow:j,setisRun:x})}):(0,e.jsxs)("div",{className:"flex gap-x-[20px] min-h-[70px] items-center px-[20px]",children:[(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(I){return ee()(ee()({},I),{},{type:"agent",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/robot_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),d.formatMessage({id:"app.summary.SelectAgent"})]}),(0,e.jsxs)(fe.ZP,{className:"flex-1 text-[14px]",onClick:function(){t(function(I){return ee()(ee()({},I),{},{type:"workflow",show:!0})})},children:[(0,e.jsx)("img",{src:"/icons/workflow_icon.svg",alt:"",className:"w-[14px] h-[14px]"}),d.formatMessage({id:"app.summary.SelectWorkflow"})]})]})})]}),(0,e.jsx)(Re.Z,{show:$.show,nodetype:$.type,popupClose:U,popupSave:K,checkList:l.current==$.type?$.checkItem:[],zIndex:99,radio:!0})]})},Na=(0,a.memo)(Sa),st=h(87740),it=(0,a.memo)(function(u){var n=u.id,r=u.message,p=(0,ae.useIntl)(),S=X(function(l){return l.setSummaryClick}),d=(0,a.useState)(!0),f=v()(d,2),m=f[0],R=f[1],g=X(function(l){return l.summaryClick}),j=X(function(l){return l.setSummaryParams});return(0,a.useEffect)(function(){R(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(N){m&&(j({id:n,message:r}),S(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(st.Z,{className:"text-[14px]"})]})})}),wa=function(n){var r,p,S,d,f=n.setShow,m=n.inputShow,R=n.setBoxLoading,g=n.setAppRunId,j=n.scrollDom,l=(0,ae.useIntl)(),N=(0,a.useState)(!1),w=v()(N,2),M=w[0],P=w[1],x=(0,a.useState)(""),H=v()(x,2),J=H[0],$=H[1],t=(0,a.useState)(""),Z=v()(t,2),U=Z[0],K=Z[1],L=(0,a.useRef)(""),I=(0,a.useRef)(""),W=(0,a.useRef)(!1),te=(0,a.useState)(!1),Y=v()(te,2),B=Y[0],O=Y[1],V=(0,a.useState)(null),E=v()(V,2),C=E[0],se=E[1],ie=X(function(_){return _.setSummaryClick}),pe=function(){var _=re()(A()().mark(function s(i){var c,o,y,b,k=arguments;return A()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return c=k.length>1&&k[1]!==void 0?k[1]:{app_run_id:"",corrected_parameter:""},z.next=3,(0,de.Rp)(i,c);case 3:o=z.sent,(o==null?void 0:o.code)==0&&(g(o==null||(y=o.data)===null||y===void 0?void 0:y.app_run_id),I.current=o==null||(b=o.data)===null||b===void 0?void 0:b.app_run_id,c.app_run_id&&(W.current=!0));case 5:case"end":return z.stop()}},s)}));return function(i){return _.apply(this,arguments)}}(),G=function(){var _=re()(A()().mark(function s(i,c){var o,y,b,k,D;return A()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,(0,de.xM)(i,{message:c});case 2:o=ce.sent,(o==null?void 0:o.code)==0&&(I.current=o==null||(y=o.data)===null||y===void 0?void 0:y.app_run_id,g(o==null||(b=o.data)===null||b===void 0?void 0:b.app_run_id),o!=null&&(k=o.data)!==null&&k!==void 0&&(k=k.outputs)!==null&&k!==void 0&&k.value&&($(o==null||(D=o.data)===null||D===void 0||(D=D.outputs)===null||D===void 0?void 0:D.value),f(!0),R(!1),ie(!0),j.current.scrollTo({top:0})));case 4:case"end":return ce.stop()}},s)}));return function(i,c){return _.apply(this,arguments)}}(),T=function(){var _=re()(A()().mark(function s(){var i;return A()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,de.Gh)({chatroom_id:L.current,app_run_id:I.current});case 2:i=o.sent,i&&i!==null&&i!==void 0&&i.data&&se(i.data);case 4:case"end":return o.stop()}},s)}));return function(){return _.apply(this,arguments)}}(),q=function(s){var i=new Date(s),c=i.getMonth()+1,o=i.getDate(),y=i.getHours(),b=i.getMinutes(),k=i.getSeconds();return i.getFullYear()+"-"+(c<10?"0"+c:c)+"-"+(o<10?"0"+o:o)+" "+(y<10?"0"+y:y)+":"+(b<10?"0"+b:b)+":"+(k<10?"0"+k:k)},Q=(0,Ge.Z)(function(_){return _.flowMessage});(0,a.useEffect)(function(){var _=Q.filter(function(c){return c.data.app_run_id==I.current&&c.type.indexOf("generate_meeting_summary")!==-1});if(_.length!=0){var s,i=(s=_[_.length-1])===null||s===void 0||(s=s.data)===null||s===void 0||(s=s.exec_data)===null||s===void 0||(s=s.outputs)===null||s===void 0?void 0:s.value;i&&(W.current&&T(),$(i),O(!1),f(!0),ie(!0),R(!1),j.current.scrollTo({top:0}))}},[Q]);var F=X(function(_){return _.summaryParams});return(0,a.useEffect)(function(){F&&F.id&&(L.current=F.id,C&&se(null),B&&O(!1),J&&$(""),P(!0),F.message?(R(!0),G(F.id,F.message)):pe(F.id))},[F]),(0,e.jsx)(e.Fragment,{children:M?(0,e.jsxs)("div",{className:"pb-[16px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pt-[12px]",children:l.formatMessage({id:"app.summary.title"})}),(0,e.jsx)("div",{className:"text-[14px] pt-[12px] leading-[23px] px-[8px]",children:J?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:" ".concat("max-h-[400px]"," p-[12px]  bg-[#F7F7F7]  relative overflow-y-auto"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:C?C==null||(r=C.source_run)===null||r===void 0?void 0:r.summary:J})}),C&&(C==null||(p=C.source_corrections)===null||p===void 0?void 0:p.length)>0||!m?(0,e.jsx)(it,{id:L.current,message:C?C==null||(S=C.source_run)===null||S===void 0?void 0:S.summary:J}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)("div",{className:"min-h-[120px] flex items-center justify-center",children:(0,e.jsx)(he.Z,{size:"large"})})}),C&&(C==null||(d=C.source_corrections)===null||d===void 0?void 0:d.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[l.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),C.source_corrections.map(function(_,s){return(0,e.jsxs)("div",{className:"mb-[16px]",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat(C.source_corrections.length-1==s?"bg-blue-100":"bg-[#F7F7F7]"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[l.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",_.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[l.formatMessage({id:"app.summaryhistory.time"}),": ",q(_.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:_==null?void 0:_.corrected_summary})]})},_.created_time),!m||C.source_corrections.length-1!=s?(0,e.jsx)(it,{id:L.current,message:_==null?void 0:_.corrected_summary}):(0,e.jsx)(e.Fragment,{})]},_.created_time)})]}):(0,e.jsx)(e.Fragment,{}),m?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pt-[12px]",children:(0,e.jsx)(Xe.Z.TextArea,{onChange:function(s){K(s.target.value)},value:U,disabled:!J||B,rows:4,placeholder:l.formatMessage({id:"app.summary.placeholder"})})}),(0,e.jsx)("div",{className:"flex pt-[12px] gap-x-[4px]",children:(0,e.jsx)(fe.ZP,{type:"primary",disabled:!J||!U,loading:B,className:"bg-[#1B64F3] rounded-[4px] w-[88px] h-[40px] flex-1",onClick:function(){pe(L.current,{app_run_id:String(I.current),corrected_parameter:U}),O(!0),K(""),f("")},children:l.formatMessage({id:"app.summary.submitText"})})})]}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})},_a=(0,a.memo)(wa),ba=(0,a.memo)(function(u){var n=u.progressObj;console.log(n);var r=function(){return parseFloat(n.elapsed_time).toFixed(6)},p=function(d){var f=new Date(d),m=f.getFullYear(),R=(f.getMonth()+1).toString().padStart(2,"0"),g=f.getDate().toString().padStart(2,"0"),j=f.getHours().toString().padStart(2,"0"),l=f.getMinutes().toString().padStart(2,"0"),N=f.getSeconds().toString().padStart(2,"0");return(0,e.jsx)(e.Fragment,{children:"".concat(m,".").concat(R,".").concat(g," ").concat(j,":").concat(l,":").concat(N)})};return(0,e.jsx)("div",{className:"inline-flex gap-x-4 justify-end max-w-[100%]",children:(0,e.jsxs)("div",{className:"inline-flex gap-x-[20px] max-w-[100%]",children:[(0,e.jsx)("div",{className:"truncate min-w-[70px]",children:n.created_time&&p(n.created_time)}),(0,e.jsx)("div",{className:"truncate",children:n.apps_name||n.app_name}),(0,e.jsxs)("div",{className:"flex items-center gap-x-[7px] truncate min-w-[50px]",children:[(0,e.jsx)("div",{className:"shrink-0 rounded-full ".concat(n.status==1?"bg-blue-600":n.status==2?"bg-green-500":"bg-red-500"),style:{width:"3px",height:"3px"}}),(0,e.jsxs)("div",{className:"truncate",children:[r(),"S"]})]})]})})}),lt=(0,a.memo)(function(u){var n=u.id,r=u.message,p=(0,ae.useIntl)(),S=X(function(l){return l.setSummaryClick}),d=(0,a.useState)(!0),f=v()(d,2),m=f[0],R=f[1],g=X(function(l){return l.summaryClick}),j=X(function(l){return l.setSummaryParams});return(0,a.useEffect)(function(){R(g)},[g]),(0,e.jsx)("div",{className:"flex flex-row-reverse",children:(0,e.jsxs)(fe.ZP,{type:"primary",className:"bg-[#1B64F3] rounded-[4px] my-3 h-[30px] w-[110px] gap-[6px]",onClick:function(N){m&&(j({id:n,message:r}),S(!1))},children:[(0,e.jsx)("span",{className:"text-[12px]",children:p.formatMessage({id:"app.summaryhistory.submitText"})}),(0,e.jsx)(st.Z,{className:"text-[14px]"})]})})}),Ca=function(n){var r=n.list,p=n.scrollDom,S=n.historyHeight,d=n.id,f=n.runid,m=(0,ae.useIntl)(),R=(0,a.useState)([]),g=v()(R,2),j=g[0],l=g[1],N=(0,a.useRef)("100%"),w=(0,a.useState)(0),M=v()(w,2),P=M[0],x=M[1],H=(0,Ke.Z)(function(t){return t.setRunPanelLogRecord}),J=function(Z){var U=new Date(Z),K=U.getMonth()+1,L=U.getDate(),I=U.getHours(),W=U.getMinutes(),te=U.getSeconds();return U.getFullYear()+"-"+(K<10?"0"+K:K)+"-"+(L<10?"0"+L:L)+" "+(I<10?"0"+I:I)+":"+(W<10?"0"+W:W)+":"+(te<10?"0"+te:te)},$=function(Z){var U=Object.keys(Z),K=[];return U.forEach(function(L){K.push(Z[L])}),K};return(0,a.useEffect)(function(){if(p){var t;N.current=p==null||(t=p.current)===null||t===void 0?void 0:t.offsetHeight}},[p]),(0,a.useEffect)(function(){S&&(N.current="auto")},[S]),(0,a.useEffect)(function(){l(le()(r))},[r]),(0,a.useEffect)(function(){console.log(f),x(f)},[f]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"px-4",style:{minHeight:N.current},children:j&&j.length?j.map(function(t){var Z,U,K,L,I,W,te,Y,B,O,V,E,C,se,ie,pe,G,T,q,Q;return t!=null&&t.source_run&&t!==null&&t!==void 0&&t.source_run.summary&&(!P||P!=(t==null||(Z=t.source_run)===null||Z===void 0?void 0:Z.id))?(0,e.jsx)("div",{className:"pt-[16px] border-b-[1px] border-color-[#eee] ",children:(0,e.jsxs)("div",{className:"pb-[60px]",children:[(0,e.jsx)("div",{className:"text-[16px] font-[600] pb-[8px] flex items-center",children:(0,e.jsx)("span",{className:"flex-1",children:m.formatMessage({id:"app.summary.title"})})}),(0,e.jsx)("p",{className:"text-[12px] color-[#eee] mb-[8px]",children:J(t==null||(U=t.source_run)===null||U===void 0?void 0:U.created_time)}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"p-[12px]  leading-[22px] ".concat(t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?"bg-[#F7F7F7]":"bg-blue-100 rounded-[4px]"),children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(K=t.source_run)===null||K===void 0?void 0:K.summary})}),(0,e.jsx)(lt,{id:d,message:t==null||(L=t.source_run)===null||L===void 0?void 0:L.summary})]}),t!=null&&t.source_corrections&&(t==null?void 0:t.source_corrections.length)>0?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.orientation"}),":"]}),t==null?void 0:t.source_corrections.map(function(F,_){return(0,e.jsxs)("div",{className:"mb-[16px] last-of-type:mb-0",children:[(0,e.jsx)("div",{className:"rounded-[4px]  ".concat((t==null?void 0:t.source_corrections.length)-1!=_?"bg-[#F7F7F7]":"bg-blue-100"),children:(0,e.jsxs)("div",{className:"p-[12px]   leading-[22px]",children:[(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.userPrompt"}),": ",F.user_prompt]}),(0,e.jsxs)("div",{className:"tetx-[14px] font-[600] pb-[12px]",children:[m.formatMessage({id:"app.summaryhistory.time"}),":"," ",J(F.created_time)]}),(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:F==null?void 0:F.corrected_summary})]})}),(0,e.jsx)(lt,{id:d,message:F==null?void 0:F.corrected_summary})]},F.created_time)})]}):(0,e.jsx)(e.Fragment,{}),t!=null&&t.target_run?(0,e.jsxs)("div",{className:"py-[12px]",children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.runapp"}),":"]}),(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:"text-[14px] py-[6px]",children:[(0,e.jsx)("span",{className:"font-[500] ",children:t!=null&&(I=t.target_run)!==null&&I!==void 0&&I.agent_id?"agent":"workflow"}),(0,e.jsx)("span",{className:"px-[6px]",children:":"}),(0,e.jsx)("span",{children:t==null||(W=t.target_run)===null||W===void 0||(W=W.app)===null||W===void 0?void 0:W.name})]})}),(0,e.jsx)("div",{children:t!=null&&(te=t.target_run)!==null&&te!==void 0&&(te=te.inputs)!==null&&te!==void 0&&te.properties?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px]",children:[m.formatMessage({id:"app.summaryhistory.input"}),":"]}),$(t==null||(Y=t.target_run)===null||Y===void 0||(Y=Y.inputs)===null||Y===void 0?void 0:Y.properties).map(function(F){return(0,e.jsxs)("div",{className:"pb-[10px]",children:[(0,e.jsx)("div",{className:"pb-[8px] font-[600]",children:F.display_name||F.name}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] h-[]",children:F.value})]})})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsx)("div",{children:t!=null&&(B=t.target_run)!==null&&B!==void 0&&B.raw_user_prompt?(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] color-[#000] font-[600] py-[12px] pb-[6px]",children:[m.formatMessage({id:"app.summaryhistory.prompt"}),":"]}),(0,e.jsx)("div",{className:"py-[4px] px-[11px] text-[14px] leading-[1.5] ",children:t==null||(O=t.target_run)===null||O===void 0?void 0:O.raw_user_prompt})]}):(0,e.jsx)(e.Fragment,{})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-[16px] font-[600] py-[8px]",children:[m.formatMessage({id:"app.summaryhistory.results"}),":"]}),(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7]",children:(t==null||(V=t.target_run)===null||V===void 0?void 0:V.agent_id)!=0?(0,e.jsx)("div",{className:"p-[12px]  bg-[#F7F7F7] leading-[22px]",children:(0,e.jsx)(ge.U,{rehypePlugins:[je.Z],children:t==null||(E=t.target_run)===null||E===void 0||(E=E.outputs)===null||E===void 0?void 0:E.value})}):(0,e.jsx)(Oe.Z,{status:t==null||(C=t.target_run)===null||C===void 0?void 0:C.status,icon:t==null||(se=t.target_run)===null||se===void 0?void 0:se.icon,title:t==null||(ie=t.target_run)===null||ie===void 0?void 0:ie.name,textDetails:(0,e.jsx)(ba,{progressObj:{created_time:t==null||(pe=t.target_run)===null||pe===void 0?void 0:pe.created_time,elapsed_time:t==null||(G=t.target_run)===null||G===void 0?void 0:G.elapsed_time,app_name:t==null||(T=t.target_run)===null||T===void 0?void 0:T.app.name,status:t==null||(q=t.target_run)===null||q===void 0?void 0:q.status}}),handleClick:function(){var _,s,i,c,o,y,b,k,D,z;H({app_id:t==null||(_=t.target_run)===null||_===void 0||(_=_.app)===null||_===void 0?void 0:_.id,app_name:t==null||(s=t.target_run)===null||s===void 0||(s=s.app)===null||s===void 0?void 0:s.name,icon:t==null||(i=t.target_run)===null||i===void 0?void 0:i.icon,workflow_id:t==null||(c=t.target_run)===null||c===void 0?void 0:c.workflow_id,type:2,app_run_id:t==null||(o=t.target_run)===null||o===void 0?void 0:o.id,run_name:t==null||(y=t.target_run)===null||y===void 0?void 0:y.name,status:t==null||(b=t.target_run)===null||b===void 0?void 0:b.status,created_time:t==null||(k=t.target_run)===null||k===void 0?void 0:k.created_time,elapsed_time:t==null||(D=t.target_run)===null||D===void 0?void 0:D.elapsed_time,completed_progress:"".concat(t==null||(z=t.target_run)===null||z===void 0?void 0:z.percentage,"%")})},progress:t==null||(Q=t.target_run)===null||Q===void 0?void 0:Q.percentage})})]})]}):(0,e.jsx)(e.Fragment,{})]})},t.source_run.id):(0,e.jsx)(e.Fragment,{})}):(0,e.jsx)(e.Fragment,{})})})},Ma=(0,a.memo)(Ca),Ra=function(n){var r,p=n.id,S=(0,a.useState)(""),d=v()(S,2),f=d[0],m=d[1],R=(0,a.useState)(!1),g=v()(R,2),j=g[0],l=g[1],N=(0,a.useState)([]),w=v()(N,2),M=w[0],P=w[1],x=(0,a.useState)(!1),H=v()(x,2),J=H[0],$=H[1],t=(0,a.useState)(!1),Z=v()(t,2),U=Z[0],K=Z[1],L=(0,a.useState)(""),I=v()(L,2),W=I[0],te=I[1],Y=(0,a.useState)(!1),B=v()(Y,2),O=B[0],V=B[1],E=(0,a.useState)(!1),C=v()(E,2),se=C[0],ie=C[1],pe=(0,a.useState)(!0),G=v()(pe,2),T=G[0],q=G[1],Q=(0,a.useRef)(null),F=(0,a.useRef)(1),_=(0,a.useRef)(!1),s=(0,a.useRef)(!0),i=(0,a.useRef)(0),c=(0,a.useState)(!1),o=v()(c,2),y=o[0],b=o[1],k=X(function(ne){return ne.summaryParams}),D=X(function(ne){return ne.setSummaryParams}),z=function(){var ne=re()(A()().mark(function oe(){var me,Te,ue,Je,_e,Ye,be=arguments;return A()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(me=be.length>0&&be[0]!==void 0?be[0]:!0,Te=be.length>1&&be[1]!==void 0?be[1]:!0,!(i.current!=0&&i.current<F.current)){we.next=5;break}return b(!1),we.abrupt("return");case 5:return we.next=8,(0,de.sh)({chatroom_id:p,page:F.current,page_size:10});case 8:ue=we.sent,ue.code==0&&(ue!=null&&(Je=ue.data)!==null&&Je!==void 0&&Je.list&&ue!==null&&ue!==void 0&&(_e=ue.data)!==null&&_e!==void 0&&(_e=_e.list)!==null&&_e!==void 0&&_e.length&&(i.current=ue==null||(Ye=ue.data)===null||Ye===void 0?void 0:Ye.total_pages,P(function(Fe){return Te?le()(ue.data.list.reverse()):[].concat(le()(ue.data.list.reverse()),le()(Fe))}),l(!0),b(!0),setTimeout(function(){s.current=!0},300)),Te&&setTimeout(function(){var Fe;Q==null||(Fe=Q.current)===null||Fe===void 0||Fe.scrollTo({top:0})},200),me||(m(k.id),D({})));case 10:case"end":return we.stop()}},oe)}));return function(){return ne.apply(this,arguments)}}(),ce=function(){var ne=re()(A()().mark(function oe(me){return A()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:me.target.scrollHeight+(me.target.scrollTop-me.target.clientHeight)<10&&s.current&&(s.current=!1,b(!0),F.current=F.current+=1,z(!0,!1));case 1:case"end":return ue.stop()}},oe)}));return function(me){return ne.apply(this,arguments)}}();return(0,a.useEffect)(function(){F.current=1,z()},[p]),(0,a.useEffect)(function(){k&&k.id&&(l(!0),T||q(!0),J&&$(!1),O&&V(!1),F.current=1,K(!0),z(!1),_.current=!0)},[k]),(0,e.jsx)(e.Fragment,{children:j?(0,e.jsxs)(zt,{minWidth:400,className:"relative h-full right-0 border-0 returned-0 px-[0] ".concat(O?"translate-x-full flex-[0]":"translate-x-0"),children:[se?(0,e.jsx)("div",{className:"h-full w-full absolute top-0 left-0 flex justify-center items-center z-[100] bg-[rgba(255,255,255,0.5)]",children:(0,e.jsx)(he.Z,{size:"large"})}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{onClick:function(){V(function(oe){return!oe})},className:`
                                        `.concat(O?"right-[100%] top-[60px]":"right-[99%] top-[60px]",`
                                        history_packup
                                        hover:text-[#1B64F3]
                                        fixed w-[30px] h-[60px] bg-[rgba(255,255,255,1)] shadow-md flex justify-center items-center cursor-pointer z-[99]
                                    `),children:O?(0,e.jsx)(qt,{className:"text-[18px]"}):(0,e.jsx)(Kt,{className:"text-[18px]"})}),(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse scroll-smooth relative",onScroll:ce,ref:Q,children:[(0,e.jsxs)("div",{children:[M.length?(0,e.jsx)(Ma,{id:p,runid:W,scrollDom:Q,list:M,historyHeight:_.current}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)("div",{className:"w-full px-4 h-full",style:{minHeight:U?Q==null||(r=Q.current)===null||r===void 0?void 0:r.offsetHeight:""},children:[(0,e.jsx)(_a,{setShow:$,inputShow:T,setBoxLoading:ie,setAppRunId:te,scrollDom:Q}),J?(0,e.jsx)(Na,{id:f,runid:W,setBoxLoading:ie,scrollDom:Q,setinputShow:q}):(0,e.jsx)(e.Fragment,{})]})]}),y?(0,e.jsx)("div",{className:"text-center justify-center items-center flex",children:(0,e.jsx)(he.Z,{})}):(0,e.jsx)(e.Fragment,{})]})]})]}):(0,e.jsx)(e.Fragment,{})})},Fa=(0,a.memo)(Ra),ka=function(n){return(0,e.jsx)("div",{className:"flex items-center h-full justify-center",children:(0,e.jsx)(ye.Z,{image:ye.Z.PRESENTED_IMAGE_SIMPLE})})},Da=(0,a.memo)(function(){var u=(0,ae.useParams)(),n=u.id,r=(0,a.useRef)([]),p=(0,a.useRef)(null),S=(0,a.useState)(!1),d=v()(S,2),f=d[0],m=d[1],R=function(){var g=re()(A()().mark(function j(){var l;return A()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!n){w.next=5;break}return w.next=3,(0,de.cH)({id:n});case 3:l=w.sent,l.code==0?(m(!0),p.current=l.data,r.current=l.data.agent_list):ae.history.replace("/meeting");case 5:case"end":return w.stop()}},j)}));return function(){return g.apply(this,arguments)}}();return(0,a.useEffect)(function(){R()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"w-full flex bg-[#fff] overflow-hidden",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(ut,{roomDetail:p.current,setAgent:r}),(0,e.jsx)("div",{className:"flex-1 min-h-0 h-full",children:f?(0,e.jsx)(Lt,{agentList:r}):(0,e.jsx)(ka,{})}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Fa,{id:n})})]})})}),Ia=Da}}]);
