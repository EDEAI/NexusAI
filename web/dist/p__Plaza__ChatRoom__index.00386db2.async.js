"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[57],{82826:function(Re,ne,n){n.d(ne,{Z:function(){return J}});var re=n(1413),Z=n(67294),le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},M=le,oe=n(91146),C=function(de,xe){return Z.createElement(oe.Z,(0,re.Z)((0,re.Z)({},de),{},{ref:xe,icon:M}))},ue=Z.forwardRef(C),J=ue},23595:function(Re,ne,n){n.r(ne),n.d(ne,{default:function(){return at}});var re=n(19632),Z=n.n(re),le=n(97857),M=n.n(le),oe=n(15009),C=n.n(oe),ue=n(99289),J=n.n(ue),ve=n(13769),de=n.n(ve),xe=n(5574),I=n.n(xe),Ce=n(47635),ee=n(43722),q=n(32332),ce=n(1413),s=n(67294),Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},Te=Ae,je=n(91146),Me=function(i,r){return s.createElement(je.Z,(0,ce.Z)((0,ce.Z)({},i),{},{ref:r,icon:Te}))},Ie=s.forwardRef(Me),De=Ie,Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},Ee=Fe,ke=function(i,r){return s.createElement(je.Z,(0,ce.Z)((0,ce.Z)({},i),{},{ref:r,icon:Ee}))},Le=s.forwardRef(ke),Oe=Le,k=n(35312),Pe=n(26915),fe=n(74330),Ze=n(2453),Be=n(20640),Ne=n.n(Be),pe=n(96486),me=n(22683),he=n(97807),Ue=n(82826),ze=n(63783),Ve=n(3471),He=n(28036),$e=n(83062),Se=n(72269),ie=n(32983),Ge=n(92004),e=n(85893),Je=function(i){var r=(0,k.useIntl)(),v=i.setsendMessage,b=i.truncatable,m=i.messageApi,D=i.roomDetail,f=i.disableInput,j=(0,k.useParams)(),d=j.id,T=(0,s.useState)([]),N=I()(T,2),p=N[0],y=N[1],S=(0,s.useState)(M()({},D)),A=I()(S,2),a=A[0],z=A[1],h=(0,s.useState)([]),B=I()(h,2),L=B[0],w=B[1],E=(0,s.useRef)(!1),V=(0,s.useRef)(!1),K=(0,s.useState)(!1),H=I()(K,2),$=H[0],G=H[1],se=function(){v("TRUNCATE","0")},O=function(){var c=J()(C()().mark(function o(){var x;return C()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!d){g.next=5;break}return g.next=3,(0,ee.cH)({id:d});case 3:if(x=g.sent,x.code==0)try{z(function(){return M()(M()({},x.data.chat_info),{},{max_round:x.data.max_round,smart_selection:x.data.smart_selection})}),y(x.data.agent_list),E.current=!0}catch(_){}case 5:case"end":return g.stop()}},o)}));return function(){return c.apply(this,arguments)}}(),U=function(){var c=J()(C()().mark(function o(){var x;return C()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,ee.j2)({id:d});case 2:x=g.sent,x.code==0&&(w(x.data.list),V.current=!0);case 4:case"end":return g.stop()}},o)}));return function(){return c.apply(this,arguments)}}(),te=function(){var c=J()(C()().mark(function o(x){var W,g,_;return C()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!d){P.next=11;break}if(W=x.active==1?0:1,W!=0){P.next=7;break}if(g=p.filter(function(X){return X.active==1}),g.length-1!=0){P.next=7;break}return m.open({type:"error",content:r.formatMessage({id:"app.chatroom.sidebar.agent_tips"}),duration:2}),P.abrupt("return",!1);case 7:return P.next=9,(0,ee.sT)({active:W},d,x.agent_id);case 9:_=P.sent,_.code==0&&y(function(X){return X.map(function(ae){return M()(M()({},ae),{},{active:ae.agent_id==x.agent_id?W:ae.active})})});case 11:case"end":return P.stop()}},o)}));return function(x){return c.apply(this,arguments)}}(),R=function(o){return o.length>6?o.length=6:o.lenth,o},u=function(o){o.type=="my_agent"?k.history.push("/Agents?app_id=".concat(o.app_id,"&type=false&from=chat_room")):k.history.push("/ReadOnlyAgent?app_id=".concat(o.app_id,"&type=true&from=chat_room"))},l=function(o){k.history.replace("/chat_room/".concat(o.chatroom_id)),window.location.reload()},Q=function(){G(!0)},F=function(){G(!1)},Y=function(){var c=J()(C()().mark(function o(x){var W,g,_;return C()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return W=Z()(x.checkAgent).map(function(X){var ae=X.agent_id,we=X.active,rt=we===void 0?1:we;return{agent_id:ae,active:rt}}),g={description:a.description,name:a.name,max_round:a.max_round},P.next=4,(0,ee.sI)(M()(M()({},g),{},{agent:W}),d);case 4:_=P.sent,_.code==0?(x.checkAgent.map(function(X){X.active=X.active==null?1:X.active}),console.log(x.checkAgent),y(Z()(x.checkAgent)),m.open({type:"success",content:r.formatMessage({id:"app.chatroom.content.addAgentTips"}),duration:2})):m.open({type:"error",content:r.formatMessage({id:"app.chatroom.content.addAgentTips_fail"}),duration:2});case 6:case"end":return P.stop()}},o)}));return function(x){return c.apply(this,arguments)}}(),ye=function(){var c=J()(C()().mark(function o(){var x;return C()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return x=a.smart_selection==1?0:1,g.next=3,(0,ee.r5)({smart_selection:x},d);case 3:z(function(_){return M()(M()({},_),{},{smart_selection:x})});case 4:case"end":return g.stop()}},o)}));return function(){return c.apply(this,arguments)}}();return(0,s.useEffect)(function(){O(),U()},[]),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"h-full w-[320px] bg-[#fff] shrink-0",style:{boxShadow:"0px 2px 4px 0px rgba(0,0,0,0.1)"},id:"sider",children:[(0,e.jsxs)("div",{className:"flex flex-col  h-full",children:[(0,e.jsx)("div",{className:"w-full flex  justify-start px-[30px]",children:(0,e.jsxs)("div",{className:"py-[20px] text-[14px] text-[#213044] font-[500] flex gap-x-[10px] items-center w-full",children:[(0,e.jsxs)("div",{className:"cursor-pointer flex items-center shrink-0",onClick:function(){k.history.go(-1)},children:[(0,e.jsx)(He.ZP,{type:"link",danger:!0,className:"p-0",children:(0,e.jsx)(Ue.Z,{className:"text-[#1B64F3] w-[16px] h-[16px]"})}),(0,e.jsx)("span",{className:"ml-[5px] text-[#213044] text-sm",children:r.formatMessage({id:"app.chatroom.sidebar.return"})})]}),(0,e.jsx)("div",{className:"h-full flex items-center shrink-0",children:(0,e.jsx)("div",{className:"w-[1px] h-[13px] bg-[#ebebeb]"})}),(0,e.jsx)("div",{className:"flex-1 min-w-0 truncate",children:a.name})]})}),(0,e.jsx)("div",{className:"h-[327px]",children:(0,e.jsxs)("div",{className:"pb-[20px] border-b-[1px] px-[10px]",children:[(0,e.jsxs)("div",{className:"flex items-center cursor-pointer px-[20px]",children:[(0,e.jsxs)("div",{className:"flex gap-x-[5px] flex-1",children:[(0,e.jsx)("span",{className:"text-[#666] text-[14px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_title"})}),(0,e.jsxs)("div",{onClick:Q,children:[(0,e.jsx)("img",{src:"/icons/edit_icon_1.svg",className:"w-[16px] h-[16px] shrink-0"})," "]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex items-center",children:[(0,e.jsx)($e.Z,{className:"pr-[2px]",overlayStyle:{fontSize:"12px"},title:r.formatMessage({id:"app.chatroom.sidebar.chatroom_switch_tips"}),children:(0,e.jsx)(ze.Z,{className:"cursor-pointer text-[#666] text-[12px]"})}),(0,e.jsx)("span",{className:"text-[12px] text-[#666] pr-[5px]",children:r.formatHTMLMessage({id:"app.chatroom_list.switch"})}),(0,e.jsx)(Se.Z,{size:"small",defaultChecked:!0,className:"w-[28px]",checked:a.smart_selection==1,onChange:ye,disabled:f})]})]}),(0,e.jsx)("div",{className:"py-[20px] pt-[10px]",children:(0,e.jsx)("div",{className:"h-[220px] overflow-y-auto px-[10px]",children:E.current?(0,e.jsx)("div",{className:"flex flex-col",children:p&&p.length>0?p.map(function(c){return(0,e.jsxs)("div",{className:"flex items-center gap-x-[5px] hover:bg-[#FAFAFA] transition p-[10px] slider_agent_box",children:[(0,e.jsxs)("div",{className:"flex gap-x-[15px] flex-1 min-w-[0]",children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:(0,e.jsx)("img",{src:(0,q.s9)("single",c.icon),alt:"",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex flex-col gap-y-[5px] justify-center flex-1 min-w-[0]",children:[(0,e.jsx)("span",{className:"text-[#213044] text-[12px] font-[500] truncate w-full",children:c.name}),(0,e.jsx)("span",{className:"text-[#999999] text-[12px] truncate",children:c.description})]})]}),(0,e.jsxs)("div",{className:"shrink-0 flex gap-x-[15px] items-center",children:[(0,e.jsx)("div",{className:"edit cursor-pointer w-[20px] h-[20px] flex justify-center items-center opacity-0 transition",onClick:function(){u(c)},children:(0,e.jsx)("img",{className:"w-[16px] h-[16px]",src:"/icons/edit_icon_1.svg"})}),(0,e.jsx)(Se.Z,{size:"small",disabled:f,defaultChecked:!0,className:"w-[28px]",checked:c.active==1,onChange:function(){te(c)}})]})]},c.agent_id)}):(0,e.jsx)("div",{className:"w-full min-h-[220px] flex items-center justify-center",children:(0,e.jsx)(ie.Z,{image:ie.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(fe.Z,{})})})}),(0,e.jsx)("div",{className:"px-[20px]",children:(0,e.jsx)("div",{style:b&&!f?{border:"1px solid #1B64F3"}:{background:"#d9d9d9",color:"rgba(0,0,0,0.25)",cursor:"not-allowed"},onClick:(0,pe.throttle)(function(){b&&!f&&se()}),className:"w-full h-[30px] transition text-[#1B64F3] flex items-center justify-center cursor-pointer rounded-[6px] hover:text-[#fff] hover:bg-[#1B64F3]",children:(0,e.jsx)("span",{className:"text-[12px]",children:r.formatMessage({id:"app.chatroom.sidebar.agent_button"})})})})]})}),(0,e.jsxs)("div",{className:"flex-1 min-h-[0] flex flex-col",children:[(0,e.jsx)("div",{className:"pt-[30px] px-[30px] text-[#666] text-[14px] shrink-0",children:r.formatMessage({id:"app.chatroom.sidebar.othe_title"})}),(0,e.jsx)("div",{className:"px-[10px] flex-1 min-h-[0] py-[10px]",children:(0,e.jsx)("div",{style:{height:"calc(100% - 20px)"},className:"px-[10px]  overflow-y-auto",children:V.current?(0,e.jsx)("div",{className:"h-full flex flex-col",children:L&&L.length>0?L.map(function(c){return(0,e.jsxs)("div",{className:"w-full transition hover:bg-[#FAFAFA] p-[10px] cursor-pointer",onClick:function(){l(c)},children:[(0,e.jsxs)("div",{className:"flex pb-[10px]",children:[(0,e.jsx)("div",{className:"flex-1 min-w-[0] truncate text-[#333] text-[14px]",children:c.name}),c.active==0?(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c2.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status"})})]}):(0,e.jsxs)("div",{className:"flex items-center gap-x-[6px]",children:[(0,e.jsx)("img",{className:"w-[12px] h-[12px]",src:"/icons/plaza_m2_c1.svg",alt:""}),(0,e.jsx)("span",{className:"text-[12px] text-[#aaa]",children:r.formatMessage({id:"app.chatroom.sidebar.othe_status_succeed"})})]})]}),(0,e.jsx)("div",{className:"flex gap-x-[10px]",children:c.agent_list&&c.agent_list.length>0?(0,e.jsxs)(e.Fragment,{children:[R(c.agent_list).map(function(o,x){return(0,e.jsx)("div",{className:"flex",children:(0,e.jsx)("div",{className:"w-[30px] h-[30px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center",children:(0,e.jsx)("img",{src:(0,q.s9)("single",o.icon),alt:"",className:"w-[18px]  h-[18px]"})})},x)}),c.agent_list.length>=6?(0,e.jsx)(Ve.Z,{}):(0,e.jsx)(e.Fragment,{})]}):(0,e.jsx)(e.Fragment,{})})]},c.chatroom_id)}):(0,e.jsx)("div",{className:"w-full h-full",children:(0,e.jsx)(ie.Z,{image:ie.Z.PRESENTED_IMAGE_SIMPLE})})}):(0,e.jsx)("div",{className:"flex justify-center w-full h-full items-center",children:(0,e.jsx)(fe.Z,{})})})})]})]}),$?(0,e.jsx)(Ge.Z,{show:$,popupClose:F,popupSave:Y,checkList:p,zIndex:99}):(0,e.jsx)(e.Fragment,{})]})})},Ke=(0,s.memo)(Je),Qe=["node","className","children"],We=Pe.Z.TextArea,Xe=(0,s.memo)(function(t){var i=t.disableInput,r=t.setsendMessage,v=t.setDisableInput,b=t.messageApi,m=t.isStop,D=t.scrollDomRef,f=t.upButtonDom,j=(0,k.useIntl)(),d=(0,s.useState)(""),T=I()(d,2),N=T[0],p=T[1],y=function(a){!a.shiftKey&&a.target.value==""&&(b.open({type:"warning",content:j.formatMessage({id:"app.chatroom.content.input"}),duration:10}),p(""),a.preventDefault()),!a.shiftKey&&a.keyCode==13&&a.target.value!=""&&(v(!0),p(""),r("INPUT",a.target.value),a.preventDefault())},S=(0,pe.throttle)(function(){r("STOP",null)},300);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:f,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(a){D.current.scrollTo({top:D.current.scrollHeight,behavior:"smooth"})},children:(0,e.jsx)(De,{className:"text-[16px]"})}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] rounded-[8px]",children:[(0,e.jsx)(We,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:N,disabled:i,onChange:function(a){p(a.target.value)},onPressEnter:y,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(j.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),m?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:S,children:(0,e.jsx)(Oe,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(i||!N?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,pe.throttle)(function(){if(i||!N)return!1;N||b.open({type:"warning",content:j.formatMessage({id:"app.chatroom.content.input"}),duration:10}),v(!0),r("INPUT",N),p("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})}),Ye=function t(i){return typeof i=="string"?i:Array.isArray(i)?i.map(t).join(""):s.isValidElement(i)?t(i.props.children):""},qe=function(i){return Ye(i)},ge=function(i,r){return{code:function(b){var m=b.node,D=b.className,f=b.children,j=de()(b,Qe),d=/language-(\w+)/.exec(D||"");if(d!=null&&d.length){var T=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:d[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var N=J()(C()().mark(function p(y){var S;return C()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,S=y.currentTarget,a.next=4,Ne()(qe(f));case 4:S&&(S.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){S&&(S.children[1].innerText=r.formatMessage({id:"app.chatroom.content.copycode"}))},200),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.error("Failed to copy text: ",a.t0);case 11:case"end":return a.stop()}},p,null,[[0,8]])}));return function(p){return N.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:r.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(T).concat(i),className:"p-4",children:f})})]})}else return(0,e.jsx)("code",M()(M()({},j),{},{children:f}))}}},be=(0,s.memo)(function(t){var i=t.messageApi,r=t.index,v=t.idName,b=t.cidName,m=(0,k.useIntl)(),D=(0,s.useState)(!1),f=I()(D,2),j=f[0],d=f[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){d(!0)},onMouseLeave:function(){d(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var T=J()(C()().mark(function N(p){var y,S;return C()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return y=p.target.closest("#".concat(v).concat(r)),S=y.querySelector("#".concat(b).concat(r)),a.prev=2,a.next=5,Ne()(S.innerText);case 5:i.open({type:"success",content:m.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(2),console.error("Failed to copy text: ",a.t0);case 11:case"end":return a.stop()}},N,null,[[2,8]])}));return function(N){return T.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(j?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(j?" text-[#1B64F3]":"text-[#666]"),children:m.formatMessage({id:"app.chatroom.content.copy"})})]})})}),_e=(0,s.memo)(function(t){var i=t.messageApi,r=t.scrollDomRef,v=t.instruction,b=t.setDisableInput,m=t.setIsStop,D=t.setTruncatable,f=t.upButtonDom,j=t.setInstruction,d=t.agentList,T=t.isRoomSuccess,N=(0,k.useIntl)(),p=(0,k.useParams)(),y=p.id,S=(0,s.useState)([]),A=I()(S,2),a=A[0],z=A[1],h=(0,s.useRef)(!1),B=(0,s.useState)(""),L=I()(B,2),w=L[0],E=L[1],V=(0,s.useRef)(null),K=(0,s.useRef)(null),H=(0,s.useRef)(!0),$=(0,s.useRef)(2),G=(0,s.useRef)(1),se=(0,s.useRef)(!1),O=function(){var R=J()(C()().mark(function u(l){var Q,F,Y=arguments;return C()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(Q=Y.length>1&&Y[1]!==void 0?Y[1]:function(){},!y){c.next=6;break}return c.next=4,(0,ee.KH)(y,{page:G.current,page_size:20});case 4:F=c.sent,F.code==0&&($.current=F.data.total_pages,z(function(o){return l?Z()(F.data.list):[].concat(Z()(F.data.list),Z()(o))}),l?setTimeout(function(){r.current.scrollTop=r.current.scrollHeight,f.current.style.display="none"}):Q({length:F.data.list.length}));case 6:case"end":return c.stop()}},u)}));return function(l){return R.apply(this,arguments)}}(),U=function(u){var l=u.target.scrollHeight-u.target.scrollTop-u.target.clientHeight;if(h.current!==Math.ceil(l)>50&&(h.current=Math.ceil(l)>50,f.current.style.display=h.current?"flex":"none"),u.target.scrollTop==0&&H.current){H.current=!1;var Q=V.current.firstChild;G.current=G.current+1,K.current.style.display="flex",$.current,$.current>=G.current?O(!1,function(F){K.current.style.display="none",setTimeout(function(){var Y=0;Q.offsetTop==0?Y=V.current.children[F.length].offsetTop:Y=Q.offsetTop,r.current.scrollTop=Y,H.current=!0})}):K.current.style.display="none"}},te=function(u,l){l==="0"&&(l=Number(l));var Q=["".concat(u),l===0||l?l:null];E(JSON.stringify(Q))};return(0,s.useEffect)(function(){v&&v.length&&(te(v[0],v[1]?v[1]:""),j([]))},[v]),(0,s.useEffect)(function(){G.current=1,O(!0)},[]),(0,e.jsxs)("div",{className:"flex-1 box-border relative overflow-y-auto chatroom",ref:r,onScroll:U,children:[(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:K,children:(0,e.jsx)(fe.Z,{})}),(0,e.jsxs)("div",{className:"max-w-[920px] mx-auto",ref:V,children:[a.map(function(R,u){return(0,e.jsxs)("div",{id:"c".concat(R.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(R.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:R.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",R.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px] text-right",id:"content".concat(u),children:[(0,e.jsx)("div",{className:"".concat(R.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:R.name?R.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left markdown-container inline-block text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:R.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"chilContent".concat(u),children:(0,e.jsx)(me.U,{rehypePlugins:[he.Z],components:ge(u,N),children:R.content})}),R.is_agent==1?(0,e.jsx)(be,{messageApi:i,idName:"content",cidName:"chilContent",index:u}):(0,e.jsx)(e.Fragment,{})]})]},u)}),(0,e.jsx)(et,{messageApi:i,setUserMessage:z,sendValue:w,agentList:d,scrollDomRef:r,upButtonDom:f,setDisableInput:b,setIsStop:m,setTruncatable:D,setSendValue:E,isRoomSuccess:T})]})]})}),et=(0,s.memo)(function(t){var i=t.messageApi,r=t.setUserMessage,v=t.sendValue,b=t.agentList,m=t.scrollDomRef,D=t.upButtonDom,f=t.setDisableInput,j=t.setIsStop,d=t.setTruncatable,T=t.setSendValue,N=t.isRoomSuccess,p=(0,k.useIntl)(),y=(0,s.useState)([]),S=I()(y,2),A=S[0],a=S[1],z=(0,s.useState)(!1),h=I()(z,2),B=h[0],L=h[1];return(0,s.useEffect)(function(){B&&(r(function(w){return[].concat(Z()(w),Z()(A))}),a([]),setTimeout(function(){L(!1),m.current.scrollTop=m.current.scrollHeight},200))},[B]),(0,e.jsxs)(e.Fragment,{children:[A.length?A.map(function(w,E){return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(w.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:w.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",w.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px]",id:"currentContent".concat(E),children:[(0,e.jsx)("div",{className:"text-left font-[500] text-[14px] text-[#213044] pb-[8px]",children:w.name?w.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:w.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"currentChilContent".concat(E),children:(0,e.jsx)(me.U,{rehypePlugins:[he.Z],components:ge(E,p),children:w.content})}),w.is_agent==1?(0,e.jsx)(be,{messageApi:i,index:E,idName:"currentContent",cidName:"currentChilContent"}):(0,e.jsx)(e.Fragment,{})]})]},E)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(tt,{messageApi:i,setCurrentMessageContent:a,sendValue:v,agentList:b,scrollDomRef:m,upButtonDom:D,setDisableInput:f,setIsStop:j,setTruncatable:d,setisEnd:L,setSendValue:T,isRoomSuccess:N})]})}),tt=(0,s.memo)(function(t){var i=t.messageApi,r=t.setCurrentMessageContent,v=t.sendValue,b=t.agentList,m=t.scrollDomRef,D=t.upButtonDom,f=t.setDisableInput,j=t.setIsStop,d=t.setTruncatable,T=t.setisEnd,N=t.setSendValue,p=t.isRoomSuccess,y=(0,k.useIntl)(),S=(0,k.useParams)(),A=S.id,a=(0,s.useState)({}),z=I()(a,2),h=z[0],B=z[1],L=(0,s.useRef)(!1),w=(0,s.useRef)(""),E=function(se){var O=se.data;if(O.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var U=JSON.parse(O.slice(22,-2));switch(U[0]){case"ERROR":f(!1),j(!1),N(""),i.open({type:"error",content:"webSocket-".concat(U[1]),duration:10});break;case"CHAT":var te={content:"".concat(U[1]),is_agent:0};r(function(l){return[].concat(Z()(l),[te])}),setTimeout(function(){m.current.scrollTop=m.current.scrollHeight,D.current.style.display="none"});break;case"STOPPABLE":j(U[1]);break;case"TRUNCATABLE":d(U[1]),U[1]||i.open({type:"success",content:"".concat(y.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":i.open({type:"success",content:"".concat(y.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(O.indexOf("REPLY")!==-1&&O.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var R=JSON.parse(O.slice(22,-2))[1];w.current="",L.current=!0;var u=b.current.filter(function(l){return l.agent_id==R})[0];Object.keys(h).length&&r(function(l){return[].concat(Z()(l),[h])}),B(function(l){return M()(M()({},l),{},{is_agent:1,icon:u==null?void 0:u.icon,name:u==null?void 0:u.name})}),j(!0),d(!1)}O.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&L.current&&(m.current.scrollTop=m.current.scrollHeight,D.current.style.display="none",w.current+=O,B(function(l){return M()(M()({},l),{},{content:w.current})})),O.indexOf("ENDCHAT")!==-1&&(L.current=!1,w.current="",f(!1),j(!1),d(!0),Object.keys(h).length&&r(function(l){return[].concat(Z()(l),[h])}),B({}),T(!0),N(""))},V=(0,Ce.Z)("chat",E),K=V.runSocket,H=V.sendMessage,$=V.readyState;return(0,s.useEffect)(function(){$==1&&A&&p&&H(JSON.stringify(["ENTER",parseInt(A)]))},[$,p]),(0,s.useEffect)(function(){v&&$==1&&H(v)},[v]),(0,s.useEffect)(function(){K()},[]),(0,e.jsx)(e.Fragment,{children:h.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(h.is_agent!=1?"flex-row-reverse":""),children:[(0,e.jsx)("div",{className:"w-[40px] h-[40px] bg-[#F4F8F1] rounded-[6px] flex items-center justify-center shrink-0",children:h.is_agent==1?(0,e.jsx)("img",{src:(0,q.s9)("single",h.icon),alt:"",className:"w-[18px]  h-[18px]"}):(0,e.jsx)("img",{src:"/icons/user_header.svg",className:"w-[18px]  h-[18px]"})}),(0,e.jsxs)("div",{className:"flex1 max-w-[560px]",id:"addcontent",children:[(0,e.jsx)("div",{className:"text-left font-[500] text-[14px] text-[#213044] pb-[8px]",children:h.name?h.name:(0,q.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:h.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)"},id:"addchilContent",children:(0,e.jsx)(me.U,{rehypePlugins:[he.Z],components:ge("add",y),children:h.content})})]})]}):(0,e.jsx)(e.Fragment,{})})}),st=(0,s.memo)(function(){var t=(0,k.useParams)(),i=t.id,r=(0,s.useRef)([]),v=Ze.ZP.useMessage(),b=I()(v,2),m=b[0],D=b[1],f=(0,s.useRef)(null),j=(0,s.useRef)(null),d=(0,s.useState)([]),T=I()(d,2),N=T[0],p=T[1],y=(0,s.useState)(!1),S=I()(y,2),A=S[0],a=S[1],z=(0,s.useState)(!1),h=I()(z,2),B=h[0],L=h[1],w=(0,s.useState)(!1),E=I()(w,2),V=E[0],K=E[1],H=(0,s.useRef)(null),$=(0,s.useState)(!1),G=I()($,2),se=G[0],O=G[1],U=function(u,l){p([u,l])},te=function(){var R=J()(C()().mark(function u(){var l;return C()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!i){F.next=5;break}return F.next=3,(0,ee.cH)({id:i});case 3:l=F.sent,l.code==0?(O(!0),H.current=l.data,r.current=l.data.agent_list):k.history.replace("/meeting");case 5:case"end":return F.stop()}},u)}));return function(){return R.apply(this,arguments)}}();return(0,s.useEffect)(function(){te()},[]),(0,e.jsxs)(e.Fragment,{children:[D,(0,e.jsxs)("div",{className:"w-full flex bg-[#fff]",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(Ke,{roomDetail:H.current,messageApi:m,setsendMessage:U,truncatable:V,disableInput:A}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px]   overflow-auto",style:{height:"calc(100% )"},children:(0,e.jsxs)("div",{className:"flex flex-col w-full",children:[(0,e.jsx)(_e,{instruction:N,setInstruction:p,messageApi:m,scrollDomRef:f,setDisableInput:a,setIsStop:L,setTruncatable:K,upButtonDom:j,agentList:r,isRoomSuccess:se}),(0,e.jsx)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:(0,e.jsx)(Xe,{disableInput:A,setsendMessage:U,setDisableInput:a,messageApi:m,isStop:B,upButtonDom:j,scrollDomRef:f})})]})})})]})]})}),at=st}}]);
