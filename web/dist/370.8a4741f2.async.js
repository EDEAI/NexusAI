"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[370],{80459:function(ke,ve,t){var he=t(32332),H=t(67294),fe=t(85893),M=function(c){var ge=c.width,re=ge===void 0?"40px":ge,le=c.bg,$=le===void 0?"#F4F8F1":le,Y=c.rounded,h=Y===void 0?"6px":Y,U=c.data,S=c.imgWidth,X=S===void 0?"18px":S,x=c.background;U!=null&&U.avatar&&(X=re);var k=x||$;return(0,fe.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:re,height:re,backgroundColor:k,borderRadius:h},children:(0,fe.jsx)("img",{src:U!=null&&U.avatar?U.avatar:(0,he.s9)("single",U==null?void 0:U.icon),style:{width:X,height:X,borderRadius:h},alt:""})})};ve.Z=(0,H.memo)(M)},94813:function(ke,ve,t){t.d(ve,{F:function(){return Ye}});var he=t(19632),H=t.n(he),fe=t(97857),M=t.n(fe),ye=t(15009),c=t.n(ye),ge=t(99289),re=t.n(ge),le=t(13769),$=t.n(le),Y=t(5574),h=t.n(Y),U=t(47635),S=t(43722),X=t(80459),x=t(27522),k=t(77295),I=t(39e3),K=t(32332),L=t(82114),ue=t(77171),De=t(69753),Ae=t(97245),Re=t(52645),Ne=t(88484),Se=t(30159),Ze=t(2068),Le=t(41428),He=t(64317),y=t(35312),_=t(26915),g=t(85576),F=t(55060),J=t(66309),G=t(83062),B=t(28036),_e=t(74330),Ie=t(45360),Ge=t(20640),Ee=t.n(Ge),ce=t(55026),te=t(96486),Be=t.n(te),r=t(67294),Q=t(22683),ae=t(97807),e=t(85893),Ue=["node","className","children"],we=["node"],pe=_.Z.TextArea,me=function(i,u){try{var m=document.createElement("a");m.href=i,m.download=u,m.target="_blank",document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(D){}},We=(0,r.memo)(function(n){var i=n.setInstruction,u=n.messageApi,m=n.isStop,D=n.scrollDomRef,O=n.upButtonDom,a=n.abilitiesList,o=n.agentChatRoomId,s=(0,y.useIntl)(),f=(0,I.Z)(function(l){return l.disableInput}),E=(0,I.Z)(function(l){return l.setDisableInput}),v=(0,r.useState)(null),P=h()(v,2),A=P[0],b=P[1],q=(0,I.Z)(function(l){return l.setClearMemory}),d=(0,k.ZP)({maxSizeMB:15,acceptedFileTypes:".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg",multiple:!0}),Z=d.uploadedFiles,xe=d.handleUpload,je=d.removeFile,de=d.clearFiles,C=d.isUploading,oe=(0,r.useState)(""),ne=h()(oe,2),se=ne[0],ie=ne[1],N=function(){var T=g.Z.confirm;T({title:s.formatMessage({id:"app.chatroom.clear.title"}),icon:(0,e.jsx)(L.Z,{}),content:s.formatMessage({id:"app.chatroom.clear.tips"}),okText:s.formatMessage({id:"app.chatroom.clear.confirm"}),okType:"danger",cancelText:s.formatMessage({id:"app.chatroom.clear.cancel"}),onOk:function(){q(["TRUNCATE","0"])}})},ee=function(T){(Z==null?void 0:Z.length)>0?(i(["FILELIST",Z.map(function(R){return R.file_id})]),A&&i(["SETABILITY",A]),setTimeout(function(){i(["INPUT",T]),Z.length>0&&de()},300)):(A&&i(["SETABILITY",A]),setTimeout(function(){i(["INPUT",T])},300))},Pe=function(T){!T.shiftKey&&T.target.value==""&&(u.open({type:"warning",content:s.formatMessage({id:"app.chatroom.content.input"}),duration:10}),ie(""),T.preventDefault()),!T.shiftKey&&T.keyCode==13&&T.target.value!=""&&(E(!0),ie(""),ee(T.target.value),T.preventDefault())},Ce=(0,te.throttle)(function(){i(["STOP",null])},300),Me=function(){f||xe()};return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"max-w-[920px] w-full min-h-[60px] mt-[20px] mb-[20px] mx-auto relative",children:[(0,e.jsx)("div",{ref:O,className:"w-[40px] h-[40px] rounded-[6px]  bg-[#fff] border border-[#ddd] cursor-pointer absolute top-[-67px] left-2/4 flex items-center justify-center hidden",onClick:function(T){D.current.scrollTo({top:0,behavior:"smooth"})},children:(0,e.jsx)(ue.Z,{className:"text-[16px]"})}),(0,e.jsx)(F.Z.PreviewGroup,{children:Z.length>0&&(0,e.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,e.jsx)("div",{className:"flex flex-wrap gap-2",children:Z.map(function(l){return(0,e.jsx)(J.Z,{closable:!0,onClose:function(){return je(l.uid)},className:"flex items-center ".concat(l.isImage?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-blue-50 text-blue-600"),children:(0,e.jsx)(G.Z,{title:l.name,children:(0,e.jsx)("div",{className:"flex items-center",children:l.isImage?(0,e.jsxs)("div",{className:"mr-1 flex items-center",children:[(0,e.jsx)(F.Z,{src:l.path_show||l.url,alt:l.name,className:"w-6 h-6 max-w-6 max-h-6 object-cover mr-1 rounded-sm cursor-pointer",preview:{src:l.path_show||l.url,mask:!1}}),(0,e.jsx)("span",{className:"truncate mr-1",children:l.name}),(0,e.jsx)(De.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(R){R.stopPropagation(),me(l.path_show||l.url,l.name)}})]}):(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(Ae.Z,{className:"mr-1"}),(0,e.jsx)("span",{className:"truncate mr-1",children:l.name}),(0,e.jsx)(De.Z,{className:"text-gray-500 hover:text-blue-600 cursor-pointer ml-1",onClick:function(R){R.stopPropagation(),me(l.path_show||l.url,l.name)}})]})})})},l.uid)})})})}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(a==null?void 0:a.length)>0&&(0,e.jsx)(He.Z,{label:s.formatMessage({id:"agent.selectivepower"}),name:"ability_id",options:a,initialValue:A,fieldProps:{placeholder:s.formatMessage({id:"agent.pleaseselect"}),size:"small",onChange:function(T){b(T)}},formItemProps:{className:"m-0 flex-1"}}),o&&(0,e.jsx)(B.ZP,{size:"small",color:"danger",variant:"outlined",onClick:N,icon:(0,e.jsx)(Re.Z,{}),children:s.formatMessage({id:"app.chatroom.sidebar.agent_button"})})]}),(0,e.jsxs)("div",{className:"flex items-center p-[12px] gap-[10px] box-border border border-[#ccc] bg-[#fff] ".concat(Z.length>0?"rounded-b-[8px]":"rounded-[8px]"),children:[(0,e.jsx)(B.ZP,{type:"text",icon:(0,e.jsx)(Ne.Z,{}),onClick:Me,disabled:f||C,loading:C}),(0,e.jsx)(pe,{id:"userValue",className:"placeholder-text-[#aaa] placeholder-text-[14px]",autoSize:{minRows:1,maxRows:6},value:se,disabled:f,onChange:function(T){ie(T.target.value)},onPressEnter:Pe,style:{height:"34px",border:"none",resize:"none",backgroundColor:"transparent"},placeholder:"".concat(s.formatMessage({id:"app.chatroom.content.input"}),"\u2026")}),m?(0,e.jsx)("div",{className:"min-w-[34px] h-[34px] bg-[#000] flex items-center justify-center cursor-pointer rounded-[4px]",onClick:Ce,children:(0,e.jsx)(Se.Z,{style:{color:"#fff",fontSize:"20px"}})}):(0,e.jsx)("div",{className:"".concat(f||!se?"bg-[#ddd]":"bg-[#1B64F3]"," min-w-[30px] h-[30px]  flex items-center justify-center cursor-pointer rounded-[6px]"),onClick:(0,te.throttle)(function(){if(f||!se)return!1;se||u.open({type:"warning",content:s.formatMessage({id:"app.chatroom.content.input"}),duration:10}),E(!0),ee(se),ie("")},300),children:(0,e.jsx)("img",{src:"/icons/send_icon_w.svg",alt:"",className:"w-[18px] h-[18px]"})})]})]})})}),w=function n(i){return typeof i=="string"?i:Array.isArray(i)?i.map(n).join(""):r.isValidElement(i)?n(i.props.children):""},ze=function(i){return w(i)},j=function(i,u){return{code:function(D){var O=D.node,a=D.className,o=D.children,s=$()(D,Ue),f=/language-(\w+)/.exec(a||"");if(f!=null&&f.length){var E=Math.random().toString(36).substr(2,9);return(0,e.jsxs)("div",{className:" rounded-md border overflow-hidden",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center justify-between bg-zinc-100 px-4 bg-zinc-900",children:[(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("p",{className:"text-sm  text-[#fff] mb-[0]",children:f[1]})}),(0,e.jsxs)("div",{className:"text-[12px] text-[#fff] mb-[0] cursor-pointer flex gap-x-[5px]",onClick:function(){var v=re()(c()().mark(function P(A){var b;return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,b=A.currentTarget,d.next=4,Ee()(ze(o));case 4:b&&(b.children[1].innerText=u.formatMessage({id:"app.chatroom.content.copySucceed"})),setTimeout(function(){b&&(b.children[1].innerText=u.formatMessage({id:"app.chatroom.content.copycode"}))},200),d.next=11;break;case 8:d.prev=8,d.t0=d.catch(0),console.error("Failed to copy text: ",d.t0);case 11:case"end":return d.stop()}},P,null,[[0,8]])}));return function(P){return v.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"/icons/chat_copy_w.svg"}),(0,e.jsx)("span",{children:u.formatMessage({id:"app.chatroom.content.copycode"})})]})]}),(0,e.jsx)("div",{className:"overflow-x-auto bg-[#282c34] text-[#abb2bf]",children:(0,e.jsx)("div",{id:"".concat(E).concat(i),className:"p-4",children:o})})]})}else return(0,e.jsx)("code",M()(M()({},s),{},{children:o}))},img:function(D){var O=D.node,a=$()(D,we);return(0,e.jsxs)("div",{className:"relative group",children:[(0,e.jsx)(F.Z,{src:a.src,alt:a.alt,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,e.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,e.jsx)(B.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(De.Z,{}),onClick:function(s){s.stopPropagation(),me(a.src||"",a.alt||"image.png")}})})]})}}},be=(0,r.memo)(function(n){var i=n.messageApi,u=n.index,m=n.idName,D=n.cidName,O=(0,y.useIntl)(),a=(0,r.useState)(!1),o=h()(a,2),s=o[0],f=o[1];return(0,e.jsx)("div",{className:"flex gap-x-[4px]",children:(0,e.jsxs)("div",{onMouseEnter:function(){f(!0)},onMouseLeave:function(){f(!1)},className:" p-[2px] cursor-pointer rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(){var E=re()(c()().mark(function v(P){var A,b;return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return A=P.target.closest("#".concat(m).concat(u)),b=A.querySelector("#".concat(D).concat(u)),d.prev=2,d.next=5,Ee()(b.innerText);case 5:i.open({type:"success",content:O.formatMessage({id:"app.chatroom.content.copySucceed"}),duration:2}),d.next=11;break;case 8:d.prev=8,d.t0=d.catch(2),console.error("Failed to copy text: ",d.t0);case 11:case"end":return d.stop()}},v,null,[[2,8]])}));return function(v){return E.apply(this,arguments)}}(),children:[(0,e.jsx)("img",{src:"".concat(s?"/icons/chat_copy_check.svg":"/icons/chat_copy.svg"),className:"w-[16px] h-[16px]"}),(0,e.jsx)("span",{className:"text-[12px] ".concat(s?" text-[#1B64F3]":"text-[#666]"),children:O.formatMessage({id:"app.chatroom.content.copy"})})]})})}),$e=function(i){var u=i.id,m=i.index,D=i.idName,O=i.cidName,a=(0,y.useIntl)(),o=(0,I.Z)(function(b){return b.setSummaryClick}),s=(0,r.useState)(!0),f=h()(s,2),E=f[0],v=f[1],P=(0,I.Z)(function(b){return b.summaryClick});(0,r.useEffect)(function(){v(P)},[P]);var A=(0,I.Z)(function(b){return b.setSummaryParams});return(0,e.jsx)("div",{className:"flex gap-x-[4px] text-[#666] ".concat(E?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),children:(0,e.jsxs)("div",{className:" p-[2px]  rounded-md flex gap-x-[5px] items-center pt-[10px]",onClick:function(q){if(E){var d=q.target.closest("#".concat(D).concat(m)),Z=d.querySelector("#".concat(O).concat(m));A({id:u,message:Z.innerText}),o(!1)}},children:[(0,e.jsx)(Ze.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[12px]",children:a.formatMessage({id:"app.chatroom.content.summary"})})]})})},tt=function(i){var u=i.roomid,m=(0,y.useIntl)(),D=(0,I.Z)(function(v){return v.setSummaryClick}),O=(0,r.useState)(!0),a=h()(O,2),o=a[0],s=a[1],f=(0,I.Z)(function(v){return v.summaryClick});(0,r.useEffect)(function(){s(f)},[f]);var E=(0,I.Z)(function(v){return v.setSummaryParams});return(0,e.jsx)("div",{className:"bg-[#fff] text-[#999999]   items-center justify-center rounded-[8px] ".concat(o?"cursor-pointer hover:text-[#1B64F3]":"cursor-no-drop"),style:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.1)"},children:(0,e.jsxs)("div",{className:" gap-x-[4px] flex items-center justify-center h-[40px] px-[20px]",onClick:function(){o&&(E({id:u}),D(!1))},children:[(0,e.jsx)(Le.Z,{className:"text-[16px]"}),(0,e.jsx)("span",{className:"text-[14px]",children:m.formatMessage({id:"app.chatroom.content.meetingSummary"})})]})})},at=(0,r.memo)(function(n){var i=n.messageApi,u=n.setCurrentMessageContent,m=n.sendValue,D=n.agentList,O=n.scrollDomRef,a=n.upButtonDom,o=n.setIsStop,s=n.setisEnd,f=n.setSendValue,E=n.agentChatRoomId,v=(0,y.useIntl)(),P=(0,y.useParams)(),A=P.id,b=(0,y.useLocation)(),q=new URLSearchParams(b.search),d=q.get("id"),Z=E||A||d,xe=(0,I.Z)(function(l){return l.setDisableInput}),je=(0,r.useState)({}),de=h()(je,2),C=de[0],oe=de[1],ne=(0,r.useRef)(!1),se=(0,r.useRef)(""),ie=(0,I.Z)(function(l){return l.setTruncatable}),N=function(T){var R=T.data;if(R.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var Oe=JSON.parse(R.slice(22,-2));switch(Oe[0]){case"ERROR":xe(!1),o(!1),f(""),i.open({type:"error",content:"webSocket-".concat(Oe[1]),duration:10});break;case"CHAT":var Xe={content:"".concat(Oe[1]),is_agent:0};u(function(W){return[].concat(H()(W),[Xe])}),setTimeout(function(){O.current.scrollTop=0,a.current.style.display="none"});break;case"WITHFILELIST":u(function(W){var p=H()(W);return p.length&&(p[p.length-1].file_list=Oe[1]),p}),setTimeout(function(){O.current.scrollTop=0,a.current.style.display="none"});break;case"STOPPABLE":o(Oe[1]);break;case"TRUNCATABLE":ie(Oe[1]),Oe[1]||i.open({type:"success",content:"".concat(v.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break;case"TRUNCATEOK":i.open({type:"success",content:"".concat(v.formatMessage({id:"app.chatroom.sidebar.cleartips"})),duration:3});break}}if(R.indexOf("REPLY")!==-1&&R.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var Qe=JSON.parse(R.slice(22,-2))[1];se.current="",ne.current=!0;var Te=D.current.filter(function(W){return W.agent_id==Qe})[0];Object.keys(C).length&&u(function(W){return[].concat(H()(W),[C])}),oe(function(W){return M()(M()({},W),{},{is_agent:1,icon:Te==null?void 0:Te.icon,name:Te==null?void 0:Te.name})}),o(!0),ie(!1)}if(R.indexOf("ABILITY")!==-1&&R.indexOf("--NEXUSAI-INSTRUCTION-")!==-1){var qe=JSON.parse(R.slice(22,-2))[1];oe(function(W){return M()(M()({},W),{},{is_agent:1,ability_id:qe})})}R.indexOf("--NEXUSAI-INSTRUCTION-")===-1&&ne.current&&(O.current.scrollTop=0,a.current.style.display="none",se.current+=R,oe(function(W){return M()(M()({},W),{},{content:se.current})})),R.indexOf("ENDCHAT")!==-1&&(ne.current=!1,se.current="",xe(!1),o(!1),ie(!0),Object.keys(C).length&&u(function(W){return[].concat(H()(W),[C])}),oe({}),s(!0),f(""))},ee=(0,U.Z)("chat",N),Pe=ee.runSocket,Ce=ee.sendMessage,Me=ee.readyState;return(0,r.useEffect)(function(){Me==1&&Z&&Ce(JSON.stringify(["ENTER",parseInt(Z)]))},[Me]),(0,r.useEffect)(function(){m&&Me==1&&Ce(m)},[m]),(0,r.useEffect)(function(){Pe()},[]),(0,e.jsx)(e.Fragment,{children:C.name?(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(C.is_agent!=1?"flex-row-reverse":""),children:[C.is_agent==1?(0,e.jsx)(X.Z,{data:C}):(0,e.jsx)(X.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(E?"":"max-w-[560px]"," text-right"),id:"addcontent",children:[(0,e.jsx)("div",{className:"".concat(C.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:C.name?C.name:(0,K.Qy)("GET").nickname}),(0,e.jsx)("div",{className:"flex ".concat(C.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:C.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"addchilContent",children:[C.file_list&&C.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(x.Z,{fileList:C.file_list,onDownload:me})}),(0,e.jsx)(Q.U,{rehypePlugins:[ae.Z],components:j("add",v),children:C.content})]})})]})]}):(0,e.jsx)(e.Fragment,{})})}),nt=(0,r.memo)(function(n){var i=n.messageApi,u=n.setUserMessage,m=n.sendValue,D=n.agentList,O=n.scrollDomRef,a=n.upButtonDom,o=n.setIsStop,s=n.setSendValue,f=n.agentChatRoomId,E=n.abilitiesList,v=(0,y.useIntl)(),P=(0,r.useState)([]),A=h()(P,2),b=A[0],q=A[1],d=(0,r.useState)(!1),Z=h()(d,2),xe=Z[0],je=Z[1],de=(0,y.useParams)(),C=de.id,oe=(0,y.useLocation)(),ne=new URLSearchParams(oe.search),se=ne.get("id"),ie=C||se;return(0,r.useEffect)(function(){xe&&(u(function(N){return[].concat(H()(b.reverse()),H()(N))}),q([]),setTimeout(function(){je(!1),O.current.scrollTop=0},200))},[xe]),(0,e.jsxs)(e.Fragment,{children:[b.length?b.map(function(N,ee){var Pe;return(0,e.jsxs)("div",{className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(N.is_agent!=1?"flex-row-reverse":""),children:[N.is_agent==1?(0,e.jsx)(X.Z,{data:N}):(0,e.jsx)(X.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(f?"":"max-w-[560px]"," text-right"),id:"currentContent".concat(ee),children:[(0,e.jsxs)("div",{className:"".concat(N.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[N.name?N.name:(0,K.Qy)("GET").nickname,N.name&&N.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((Pe=E.find(function(Ce){return N.ability_id==Ce.value}))===null||Pe===void 0?void 0:Pe.label)||"\u672A\u627E\u5230\u8BE5\u80FD\u529B",")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(N.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:N.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"currentChilContent".concat(ee),children:[N.file_list&&N.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(x.Z,{fileList:N.file_list,onDownload:me})}),(0,e.jsx)(Q.U,{rehypePlugins:[ae.Z],components:j(ee,v),children:N.content})]})}),N.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(be,{messageApi:i,index:ee,idName:"currentContent",cidName:"currentChilContent"}),!f&&(0,e.jsx)($e,{id:ie,index:ee,idName:"currentContent",cidName:"currentChilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},ee)}):(0,e.jsx)(e.Fragment,{}),(0,e.jsx)(at,{messageApi:i,setCurrentMessageContent:q,sendValue:m,agentList:D,scrollDomRef:O,upButtonDom:a,setIsStop:o,setisEnd:je,setSendValue:s,agentChatRoomId:f})]})}),Je=(0,r.memo)(function(n){var i=n.messageApi,u=n.scrollDomRef,m=n.instruction,D=n.setIsStop,O=n.upButtonDom,a=n.setInstruction,o=n.agentList,s=n.agentChatRoomId,f=n.abilitiesList,E=(0,y.useIntl)(),v=(0,r.useState)(860),P=h()(v,2),A=P[0],b=P[1],q=(0,y.useParams)(),d=q.id,Z=(0,y.useLocation)(),xe=new URLSearchParams(Z.search),je=xe.get("id"),de=s||d||je,C=(0,r.useState)([]),oe=h()(C,2),ne=oe[0],se=oe[1],ie=(0,r.useRef)(!1),N=(0,r.useState)(""),ee=h()(N,2),Pe=ee[0],Ce=ee[1],Me=(0,r.useRef)(null),l=(0,r.useRef)(!0),T=(0,r.useRef)(2),R=(0,r.useRef)(1),Oe=(0,r.useRef)(0),Xe=function(){var p=re()(c()().mark(function V(z){var Ve,Ke,et=arguments;return c()().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:if(Ve=et.length>1&&et[1]!==void 0?et[1]:function(){},!de){Fe.next=6;break}return Fe.next=4,(0,S.KH)(de,{page:R.current,page_size:10});case 4:Ke=Fe.sent,Ke.code==0&&(T.current=Ke.data.total_pages,z||(Me.current.style.display="none"),se(function(st){return z?H()(Ke.data.list.reverse()):[].concat(H()(st),H()(Ke.data.list.reverse()))}),z?u&&u.current&&setTimeout(function(){u.current.scrollTop=0,O.current.style.display="none"}):Oe.current=Ke.data.list.length,l.current=!0);case 6:case"end":return Fe.stop()}},V)}));return function(z){return p.apply(this,arguments)}}(),Qe=function(V){var z=V.target.scrollHeight+(V.target.scrollTop-V.target.clientHeight);ie.current!==Math.ceil(V.target.scrollTop)<-50&&(ie.current=Math.ceil(V.target.scrollTop)<-50,O.current.style.display=ie.current?"flex":"none"),z<10&&l.current&&(l.current=!1,R.current=R.current+1,Me.current.style.display="flex",T.current>=R.current?Xe(!1):Me.current.style.display="none")},Te=function(V,z){z==="0"&&(z=Number(z));var Ve=["".concat(V),z===0||z?z:null];Ce(JSON.stringify(Ve))},qe=(0,I.Z)(function(p){return p.disableInput}),W=(0,I.Z)(function(p){return p.clearMemory});return(0,r.useEffect)(function(){W&&W.length&&Te(W[0],W[1])},[W]),(0,r.useEffect)(function(){m&&m.length&&(Te(m[0],m[1]?m[1]:""),a([]))},[m]),(0,r.useEffect)(function(){R.current=1,Xe(!0)},[]),(0,r.useEffect)(function(){var p=function(){window.innerWidth<1280||b(window.innerWidth-320-(window.innerWidth-320)/2-88)};return p(),window.addEventListener("resize",p),function(){window.removeEventListener("resize",p)}},[]),(0,e.jsx)("div",{className:"flex-1 min-h-0",children:(0,e.jsxs)("div",{className:"h-full min-h-full overflow-y-auto flex flex-col-reverse  items-center  scroll-smooth chatroom",ref:u,onScroll:Qe,children:[(0,e.jsxs)("div",{style:{minWidth:s?"":"".concat(A,"px")},children:[(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsx)("div",{className:"flex flex-col-reverse",children:(0,e.jsx)(e.Fragment,{children:ne&&ne.length?ne.map(function(p,V){var z;return(0,e.jsxs)("div",{id:"c".concat(p.id),className:"w-full flex gap-[15px] pt-[15px] pb-[15px] ".concat(p.is_agent!=1?"flex-row-reverse":""),children:[p.is_agent==1?(0,e.jsx)(X.Z,{data:p}):(0,e.jsx)(X.Z,{data:{avatar:"/icons/user_header.svg"}}),(0,e.jsxs)("div",{className:"flex1 ".concat(s?"":"max-w-[560px]"," text-right"),id:"content".concat(V),children:[(0,e.jsxs)("div",{className:"".concat(p.is_agent==1?"text-left":"text-right"," font-[500] text-[14px] text-[#213044] pb-[8px]"),children:[p.name?p.name:(0,K.Qy)("GET").nickname,p.ability_id>0&&(0,e.jsxs)(e.Fragment,{children:[" ","(",((z=f.find(function(Ve){return p.ability_id==Ve.value}))===null||z===void 0?void 0:z.label)||E.formatMessage({id:"app.chatroom.content.abilityNotFound"}),")"]})]}),(0,e.jsx)("div",{className:"flex ".concat(p.is_agent==1?"flex-row":"flex-row-reverse"),children:(0,e.jsxs)("div",{className:"text-left inline-block markdown-container text-[14px] font-[400] text-[#213044] bg-[#F7F7F7] p-[15px] pb-[1px] leading-[22px]",style:p.is_agent==1?{borderRadius:" 0px 8px 8px 8px"}:{borderRadius:"8px 0px 8px 8px",background:"rgba(27,100,243,0.1)",whiteSpace:"pre-wrap"},id:"chilContent".concat(V),children:[p.file_list&&p.file_list.length>0&&(0,e.jsx)("div",{className:"mb-3",children:(0,e.jsx)(x.Z,{fileList:p.file_list,onDownload:me})}),(0,e.jsx)(Q.U,{rehypePlugins:[ae.Z],components:j(V,E),children:p.content})]})}),p.is_agent==1?(0,e.jsxs)("div",{className:"flex gap-x-[20px]",children:[(0,e.jsx)(be,{messageApi:i,idName:"content",cidName:"chilContent",index:V}),!s&&(0,e.jsx)($e,{id:de,index:V,idName:"content",cidName:"chilContent"})]}):(0,e.jsx)(e.Fragment,{})]})]},V)}):(0,e.jsx)(e.Fragment,{})})}),(0,e.jsx)(nt,{messageApi:i,setUserMessage:se,sendValue:Pe,agentList:o,scrollDomRef:u,upButtonDom:O,setIsStop:D,setSendValue:Ce,agentChatRoomId:s,abilitiesList:f})]}),(0,e.jsx)("div",{className:"w-full flex justify-center pb-[10px]",children:!s&&!qe&&ne.length?(0,e.jsx)(tt,{roomid:de}):(0,e.jsx)(e.Fragment,{})})]}),(0,e.jsx)("div",{className:"text-center justify-center items-center flex",style:{display:"none"},ref:Me,children:(0,e.jsx)(_e.Z,{})})]})})}),Ye=(0,r.memo)(function(n){var i=n.agentList,u=n.agentChatRoomId,m=n.abilitiesList,D=(0,r.useRef)(null),O=(0,r.useRef)(null),a=(0,r.useState)(!1),o=h()(a,2),s=o[0],f=o[1],E=(0,r.useState)([]),v=h()(E,2),P=v[0],A=v[1],b=(0,y.useParams)(),q=b.id,d=(0,y.useLocation)(),Z=new URLSearchParams(d.search),xe=Z.get("id"),je=q||xe,de=Ie.ZP.useMessage(),C=h()(de,2),oe=C[0],ne=C[1];return(0,e.jsxs)(e.Fragment,{children:[ne,(0,e.jsx)("div",{className:"mx-[44px] flex justify-center relative box-border pt-[12px] h-full ".concat(u?"w-full":""),children:(0,e.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,e.jsx)(Je,{instruction:P,setInstruction:A,messageApi:oe,scrollDomRef:D,setIsStop:f,upButtonDom:O,agentList:i,agentChatRoomId:u,abilitiesList:m}),(0,e.jsx)(We,{setInstruction:A,messageApi:oe,isStop:s,upButtonDom:O,scrollDomRef:D,agentChatRoomId:u,abilitiesList:m})]})})]})})},27522:function(ke,ve,t){var he=t(55060),H=t(28036),fe=t(69753),M=t(97245),ye=t(77295),c=t(85893),ge=function($,Y){try{var h=document.createElement("a");h.href=$,h.download=Y,h.target="_blank",document.body.appendChild(h),h.click(),document.body.removeChild(h)}catch(U){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",U)}},re=function($){var Y=$.fileList,h=$.onDownload,U=h===void 0?ge:h,S=$.className,X=S===void 0?"":S,x=$.showInGrid,k=x===void 0?!1:x,I=$.maxHeight;return!Y||Y.length===0?null:(0,c.jsx)("div",{className:"mb-2 ".concat(X),style:{maxHeight:I,overflow:I?"auto":"visible"},children:(0,c.jsx)(he.Z.PreviewGroup,{children:(0,c.jsx)("div",{className:"".concat(k?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:Y.map(function(K,L){var ue=K.path_show||K.url,De=(0,ye.CO)(K.name);return(0,c.jsx)("div",{className:"".concat(k?"":"mb-2"),children:De?(0,c.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,c.jsx)(he.Z,{src:ue,alt:K.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,c.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,c.jsx)(H.ZP,{type:"primary",size:"small",icon:(0,c.jsx)(fe.Z,{}),onClick:function(Re){Re.stopPropagation(),U(ue,K.name)}})})]}):(0,c.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,c.jsx)(M.Z,{className:"mr-2 flex-shrink-0"}),(0,c.jsx)("span",{className:"text-sm truncate",children:K.name})]}),(0,c.jsx)(H.ZP,{type:"text",size:"small",icon:(0,c.jsx)(fe.Z,{}),onClick:function(){return U(ue,K.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(K.uid||K.file_id||L))})})})})};ve.Z=re},85877:function(ke,ve,t){var he=t(19632),H=t.n(he),fe=t(97857),M=t.n(fe),ye=t(5574),c=t.n(ye),ge=t(52677),re=t.n(ge),le=t(35312),$=t(78234),Y=t(77598),h=t(96486),U=t.n(h),S=t(67294),X=t(73935),x=t(43413),k=t(92858),I=t(16845),K=t(15425),L=t(85893),ue=function(_){var g=_.children;return(typeof document=="undefined"?"undefined":re()(document))==="object"?X.createPortal(g,document.body):null},De=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),Ae=function(_){var g=_.value,F=_.onChange,J=_.id,G=_.placeholder,B=_.options,_e=(0,le.useIntl)(),Ie=(0,S.useRef)(),Ge=(0,S.useState)(),Ee=c()(Ge,2),ce=Ee[0],te=Ee[1],Be=(0,S.useState)(0),r=c()(Be,2),Q=r[0],ae=r[1],e=(0,S.useState)(""),Ue=c()(e,2),we=Ue[0],pe=Ue[1],me=(0,S.useCallback)(function(a){return(0,L.jsx)(Ze,M()({},a))},[]),We=(0,S.useCallback)(function(a){return(0,L.jsx)(Se,M()({},a))},[]),w=(0,S.useMemo)(function(){return Re((0,I.BU)((0,k.VC)((0,x.Jh)())))},[]),ze=(0,S.useState)(null),j=c()(ze,2),be=j[0],$e=j[1],tt=(0,K.Z)(function(a){return a.selectedNode}),at=(0,K.Z)(function(a){return a.getOutputVariables}),nt=(0,K.Z)(function(a){return a.getInputVariables}),Je=(0,S.useState)([]),Ye=c()(Je,2),n=Ye[0],i=Ye[1];(0,$.Z)(function(){g&&g.length>0&&u(g),B!=null&&B.length&&i(B.map(function(a){return M()(M()({},a),{},{name:a.label,id:a.value})}))}),(0,Y.Z)(function(){var a=U().isEqual(be,g);a||(g&&g.length>0?u(g):g&&U().isArray(g)&&g.length==0&&u([{type:"paragraph",children:[]}]))},[g,J]),(0,Y.Z)(function(){B.length&&i(B.map(function(a){return M()(M()({},a),{},{name:a.label,id:a.value})})),console.log(B)},[B]);var u=function(o){$e(o),D(w,{nodes:[{type:"paragraph",children:[]}]}),D(w,{nodes:o})},m=(0,S.useCallback)(function(a){if(ce&&n.length>0)switch(a.key){case"ArrowDown":a.preventDefault();var o=Q>=n.length-1?0:Q+1;ae(o);return;case"ArrowUp":a.preventDefault();var s=Q<=0?n.length-1:Q-1;ae(s);return;case"Tab":case"Enter":a.preventDefault(),x.YR.select(w,ce),Ne(w,n[Q]),te(null);return;case"Escape":a.preventDefault(),te(null);return}else if(a.key==="@"){setTimeout(function(){return O()},10);return}te(null)},[n,w,Q,ce]),D=function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=H()(o.children);if(f.forEach(function(P){return o.apply({type:"remove_node",path:[0],node:P})}),s.nodes){var E=x.NB.isNode(s.nodes)?[s.nodes]:s.nodes;E.forEach(function(P,A){return o.apply({type:"insert_node",path:[A],node:P})})}var v=s.at&&x.E9.isPoint(s.at)?s.at:x.ML.end(o,[]);v&&x.YR.select(o,v)};(0,S.useEffect)(function(){if(ce&&n.length>0){var a=Ie.current,o=I.F3.toDOMRange(w,ce),s=o.getBoundingClientRect();a.style.top="".concat(s.top+window.pageYOffset+24,"px"),a.style.left="".concat(s.left+window.pageXOffset,"px")}},[n.length,w,Q,we,ce]);var O=function(){var o=w.selection;if(o&&x.e6.isCollapsed(o)){var s=x.e6.edges(o),f=c()(s,1),E=f[0],v=x.ML.before(w,E),P=v&&x.ML.range(w,v,E),A=P&&x.ML.string(w,P),b=x.ML.after(w,E),q=x.ML.range(w,E,b),d=x.ML.string(w,q);te(P),pe(""),ae(0);return}te(null)};return(0,L.jsxs)(I.mH,{editor:w,initialValue:He,onChange:function(o){F==null||F(o),te(null)},children:[(0,L.jsx)(I.CX,{renderElement:me,renderLeaf:We,onKeyDown:m,className:"!outline-none",placeholder:G!=null?G:_e.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),ce&&(0,L.jsx)(ue,{children:(0,L.jsx)("div",{ref:Ie,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:n.length?n.map(function(a,o){return(0,L.jsx)("div",{onClick:function(){console.log(a),x.YR.select(w,ce),Ne(w,a),te(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:o===Q?"#B4D5FF":""},children:(0,L.jsx)("span",{children:a.name})},a.name+o)}):(0,L.jsx)(L.Fragment,{children:_e.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},Re=function(_){var g=_.isInline,F=_.isVoid,J=_.markableVoid;return _.isInline=function(G){return G.type==="mention"?!0:g(G)},_.isVoid=function(G){return G.type==="mention"?!0:F(G)},_.markableVoid=function(G){return G.type==="mention"||J(G)},_},Ne=function(_,g){var F={type:"mention",id:(g==null?void 0:g.id)||"",character:g.name,base:g,children:[{bold:!0,text:"11111"}]};x.YR.insertNodes(_,F),x.YR.move(_)},Se=function(_){var g=_.attributes,F=_.children,J=_.leaf;return(0,L.jsx)("span",M()(M()({},g),{},{children:F}))},Ze=function(_){var g=_.attributes,F=_.children,J=_.element;switch(J.type){case"mention":return(0,L.jsx)(Le,M()({},_));default:return(0,L.jsx)("p",M()(M()({},g),{},{children:F}))}},Le=function(_){var g=_.attributes,F=_.children,J=_.element,G=(0,I.vt)(),B=(0,I.UE)(),_e={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:G&&B?"0 0 0 2px #B4D5FF":"none"};return J.children[0].bold&&(_e.fontWeight="bold"),J.children[0].italic&&(_e.fontStyle="italic"),(0,L.jsx)("span",M()(M()({},g),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(J.character.replace(" ","-")),style:_e,children:De?(0,L.jsxs)(S.Fragment,{children:["1",F,"/",J.character]}):(0,L.jsxs)(S.Fragment,{children:[(0,L.jsx)("span",{children:J.character}),F]})}))},He=[{type:"paragraph",children:[{text:""}]}];ve.Z=Ae},77295:function(ke,ve,t){t.d(ve,{CO:function(){return U}});var he=t(15009),H=t.n(he),fe=t(19632),M=t.n(fe),ye=t(99289),c=t.n(ye),ge=t(5574),re=t.n(ge),le=t(45360),$=t(35312),Y=t(67294),h=t(83065),U=function(x){var k,I=(k=x.split(".").pop())===null||k===void 0?void 0:k.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(I||"")},S=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=(0,$.useIntl)(),I=(0,Y.useState)([]),K=re()(I,2),L=K[0],ue=K[1],De=(0,Y.useState)(!1),Ae=re()(De,2),Re=Ae[0],Ne=Ae[1],Se=x.maxSizeMB,Ze=Se===void 0?15:Se,Le=x.acceptedFileTypes,He=Le===void 0?".txt,.md,.pdf,.html,.xlsx,.pptx,.docx,.csv,.jpg,.png,.jpeg":Le,y=x.multiple,_=y===void 0?!0:y,g=function(){var B=document.createElement("input");B.type="file",B.accept=He,B.multiple=_,B.onchange=function(){var _e=c()(H()().mark(function Ie(Ge){var Ee,ce,te,Be,r,Q,ae,e,Ue,we,pe,me,We,w;return H()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(Ee=Ge.target,!(Ee.files&&Ee.files.length>0)){j.next=37;break}if(Ne(!0),ce=Array.from(Ee.files),te=ce.filter(function(be){return be.size/1024/1024>Ze}),!(te.length>0)){j.next=9;break}return le.ZP.error("".concat(te.map(function(be){return be.name}).join(", ")," ").concat(k.formatMessage({id:"workflow.uploadFileErrorText"}))),Ne(!1),j.abrupt("return");case 9:Be=[],r=0,Q=ce;case 11:if(!(r<Q.length)){j.next=35;break}return ae=Q[r],e=new FormData,e.append("file",ae),j.prev=15,j.next=18,(0,h.M$)();case 18:return Ue=j.sent,j.next=21,fetch(Ue,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:e});case 21:return we=j.sent,j.next=24,we.json();case 24:pe=j.sent,pe.code===0?(le.ZP.success("".concat(ae.name," ").concat(k.formatMessage({id:"workflow.uploadSuccess"}))),(me=pe.data)!==null&&me!==void 0&&me.file_id&&(We=U(ae.name),w={name:ae.name,url:pe.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:We,file_id:pe.data.file_id,path_show:pe.data.file_url||pe.data.path_show||""},Be.push(w))):le.ZP.error("".concat(ae.name," ").concat(k.formatMessage({id:"workflow.uploadFailed"}))),j.next=32;break;case 28:j.prev=28,j.t0=j.catch(15),console.error("Upload error:",j.t0),le.ZP.error("".concat(ae.name," ").concat(k.formatMessage({id:"workflow.uploadFailed"})));case 32:r++,j.next=11;break;case 35:ue(function(be){return[].concat(M()(be),Be)}),Ne(!1);case 37:case"end":return j.stop()}},Ie,null,[[15,28]])}));return function(Ie){return _e.apply(this,arguments)}}(),B.click()},F=function(B){ue(function(_e){return _e.filter(function(Ie){return Ie.uid!==B})})},J=function(){ue([])};return{uploadedFiles:L,setUploadedFiles:ue,handleUpload:g,removeFile:F,clearFiles:J,isUploading:Re}};ve.ZP=S}}]);
