"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[696],{5785:function(Ee,S,i){var A=i(1413),L=i(67294),C=i(44685),v=i(91146),y=function(O,U){return L.createElement(v.Z,(0,A.Z)((0,A.Z)({},O),{},{ref:U,icon:C.Z}))},p=L.forwardRef(y);S.Z=p},10696:function(Ee,S,i){var A=i(19632),L=i.n(A),C=i(15009),v=i.n(C),y=i(99289),p=i.n(y),Y=i(97857),O=i.n(Y),U=i(5574),m=i.n(U),T=i(11551),pe=i(18304),B=i(85750),Me=i(38008),be=i(77295),Pe=i(39944),Oe=i(58299),J=i(55927),Q=i(79574),De=i(19078),Ie=i(5785),je=i(34994),Le=i(76772),Re=i(77598),R=i(45360),Ae=i(74330),X=i(66309),W=i(28036),Se=i(32983),_=i(67294),r=i(85893);S.Z=(0,_.memo)(function(n){var c,g,w,D,Ce=(0,_.useState)([]),q=m()(Ce,2),ye=q[0],K=q[1],Ue=(0,_.useState)(!0),ee=m()(Ue,2),ra=ee[0],Te=ee[1],Be=(0,_.useState)(1),ae=m()(Be,2),ua=ae[0],We=ae[1],we=(0,_.useState)(!0),te=m()(we,2),Ke=te[0],xe=te[1],Fe=(0,_.useState)(!1),ne=m()(Fe,2),x=ne[0],se=ne[1],Ne=(0,_.useState)(!1),ie=m()(Ne,2),_a=ie[0],F=ie[1],Ze=(0,_.useState)(!1),le=m()(Ze,2),re=le[0],ue=le[1],$e=(0,_.useState)(!1),_e=m()($e,2),He=_e[0],N=_e[1],ke=(0,_.useState)(!1),oe=m()(ke,2),h=oe[0],Z=oe[1],$=(0,_.useRef)(),ze=(0,_.useRef)(null),Ve=(0,_.useRef)(null),E=(0,Le.useIntl)(),H=(0,J.Z)(function(s){return s.getTypedMessages("chat_message_llm_return")}),Ge=(0,_.useState)(null),de=m()(Ge,2),ve=de[0],Ye=de[1],k=(0,J.Z)(function(s){return s.getTypedLastMessage("chat_message_llm_return")}),Je=(0,_.useState)(null),me=m()(Je,2),M=me[0],Qe=me[1],Xe=(0,Oe.m)(),I=Xe.options,qe=function(e){if(!e||!I)return"\u672A\u77E5\u6A21\u578B";var t=(0,B.ti)(e,{options:I});return(t==null?void 0:t.label)||"\u672A\u77E5\u6A21\u578B"},ea=function(e){if(!e||!I)return!1;var t=(0,B.ti)(e,{options:I});return(t==null?void 0:t.support_image)===1},aa=function(e){if(!e||!I)return!1;var t=(0,B.ti)(e,{options:I});return(t==null?void 0:t.model_mode)===2},ta=function(){var e,t=(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.agent)===null||e===void 0?void 0:e.agent_id;if(t){var l=!h;Z(l),(0,Q.S_)(t,l)}else console.warn("Cannot save fullscreen state: agentId is not available"),Z(function(u){return!u})};(0,_.useEffect)(function(){var s;if(((s=n.data)===null||s===void 0||(s=s.detailList)===null||s===void 0||(s=s.app)===null||s===void 0?void 0:s.name)!=null){var e=n.data.detailList.agent_chatroom_id,t=n.data.detailList.agent.agent_id;if(e){var l=window.location.search,u=new URLSearchParams(l);Ye(e),u.set("id",String(e));var o="".concat(window.location.pathname,"?").concat(u.toString()).concat(window.location.hash);window.history.replaceState({},"",o)}var a=O()(O()({},n.data.detailList.app),{},{agent:n.data.detailList.agent,agent_id:t});if(Qe(a),t){var b=(0,Q.WM)(t);console.log("Restoring fullscreen state for agent ".concat(t,": ").concat(b)),Z(b)}setTimeout(function(){xe(!1)},500)}},[(c=n.data)===null||c===void 0||(c=c.detailList)===null||c===void 0||(c=c.app)===null||c===void 0?void 0:c.name,(g=n.data)===null||g===void 0||(g=g.detailList)===null||g===void 0||(g=g.agent)===null||g===void 0?void 0:g.m_config_id]);var j=(0,be.ZP)(),fe=j.uploadedFiles,oa=j.setUploadedFiles,da=j.handleUpload,va=j.removeFile,na=j.clearFiles,ma=j.isUploading,z=function(){var e;(e=ze.current)===null||e===void 0||e.scrollIntoView({behavior:"smooth"})},ce=function(){var s=p()(v()().mark(function e(){var t,l,u;return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,ue(!0),!(n!=null&&(t=n.saveInfo)!==null&&t!==void 0&&t.firstjudgingcondition())){a.next=6;break}return a.abrupt("return",!0);case 6:if(!(n!=null&&(l=n.saveInfo)!==null&&l!==void 0&&l.secondjudgingcondition())){a.next=10;break}return a.abrupt("return",!0);case 10:return a.next=12,n==null||(u=n.saveInfo)===null||u===void 0?void 0:u.agentupdata();case 12:return a.abrupt("return",a.sent);case 13:a.next=19;break;case 15:return a.prev=15,a.t0=a.catch(0),console.error("Failed to save info:",a.t0),a.abrupt("return",!1);case 19:return a.prev=19,ue(!1),a.finish(19);case 22:case"end":return a.stop()}},e,null,[[0,15,19,22]])}));return function(){return s.apply(this,arguments)}}();(0,Re.Z)(function(){var s,e=k==null?void 0:k.data;if(e&&!((e==null?void 0:e.agent_id)!==((s=n.data)===null||s===void 0||(s=s.detailList)===null||s===void 0||(s=s.agent)===null||s===void 0?void 0:s.agent_id)&&!R.ZP.error)){var t=O()(O()({},e),{},{id:e.message_id});H&&H.length>0&&(F(!1),K(function(l){return[].concat(L()(l),[t])}),setTimeout(z,100))}},[H]),(0,_.useEffect)(function(){!x&&ye.length>0&&z()},[x]);var sa=function(){var s=p()(v()().mark(function e(t){var l,u,o,a,b,d,V,ge,G,he;return v()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a=(l=$.current)===null||l===void 0?void 0:l.getFieldsValue(),!(!a||!((u=t.content)!==null&&u!==void 0&&u.trim()))){f.next=3;break}return f.abrupt("return");case 3:return b=n.data.detailList.agent.agent_id,d=n.data.detailList.agent.input_variables,V=a.ability_id,ge=new Pe.z({user:{value:a.content}}),G=fe.map(function(P){return{name:P.name,url:P.url||P.path_show||""}}),he={id:Date.now(),content:t.content,isUser:!0,ability_id:V,agent_id:b,agent_run_id:0,completion_tokens:0,created_time:new Date().toISOString(),message:a.content,prompt_tokens:0,total_tokens:0,file_list:G.length>0?G:void 0},F(!0),K(function(P){return[].concat(L()(P),[he])}),(o=$.current)===null||o===void 0||o.resetFields(["content"]),f.prev=12,f.next=15,(0,T.CY)({agent_id:b,input_dict:d,ability_id:V,prompt:ge,file_list:fe.map(function(P){return P.file_id})});case 15:na(),f.next=22;break;case 18:f.prev=18,f.t0=f.catch(12),F(!1),R.ZP.error(E.formatMessage({id:"agent.chat.send.failed"}));case 22:setTimeout(z,100);case 23:case"end":return f.stop()}},e,null,[[12,18]])}));return function(t){return s.apply(this,arguments)}}(),fa=function(){var s=p()(v()().mark(function e(){var t,l,u;return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((t=n.data)!==null&&t!==void 0&&(t=t.detailList)!==null&&t!==void 0&&(t=t.agent)!==null&&t!==void 0&&t.agent_id){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,se(!0),a.next=6,(0,T.CU)(String(n.data.detailList.agent.agent_id),1);case 6:u=a.sent,(l=u.data)!==null&&l!==void 0&&l.list&&(K(u.data.list),Te(u.data.total_pages>1),We(1)),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(2),console.error("Failed to fetch initial messages:",a.t0);case 13:return a.prev=13,se(!1),a.finish(13);case 16:case"end":return a.stop()}},e,null,[[2,10,13,16]])}));return function(){return s.apply(this,arguments)}}();if(x)return(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(Ae.Z,{})});var ia=function(){var s=p()(v()().mark(function e(){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,N(!0),l.next=4,ce();case 4:setTimeout(p()(v()().mark(function u(){var o,a;return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,(0,T.Dh)((o=n.data)===null||o===void 0||(o=o.detailList)===null||o===void 0||(o=o.agent)===null||o===void 0?void 0:o.agent_id);case 3:a=d.sent,a.code==0?R.ZP.success(E.formatMessage({id:"agent.message.success.publish"})):R.ZP.error(E.formatMessage({id:"agent.message.fail.publish"})),d.next=11;break;case 7:d.prev=7,d.t0=d.catch(0),console.error("Failed to publish agent:",d.t0),R.ZP.error(E.formatMessage({id:"agent.message.fail.publish"}));case 11:return d.prev=11,N(!1),d.finish(11);case 14:case"end":return d.stop()}},u,null,[[0,7,11,14]])})),500),l.next=11;break;case 7:l.prev=7,l.t0=l.catch(0),console.error("Failed to save before publish:",l.t0),N(!1);case 11:case"end":return l.stop()}},e,null,[[0,7]])}));return function(){return s.apply(this,arguments)}}();if(Ke)return null;var la=function(){var e,t;return(0,r.jsxs)("div",{className:"pb-4 flex gap-[10px] items-center",style:{paddingBottom:"16px"},children:[(0,r.jsxs)("div",{className:"flex-1 flex items-center font-bold text-base",children:[(e=n.data)===null||e===void 0||(e=e.detailList)===null||e===void 0||(e=e.app)===null||e===void 0?void 0:e.name,h&&(M==null||(t=M.agent)===null||t===void 0?void 0:t.m_config_id)&&(0,r.jsx)("div",{className:"ml-3 flex items-center gap-2",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium text-blue-700 border shadow-sm",children:[qe(M.agent.m_config_id),ea(M.agent.m_config_id)&&(0,r.jsx)(X.Z,{color:"blue",className:"text-xs",children:E.formatMessage({id:"workflow.tag.imageUnderstanding",defaultMessage:"Image Understanding"})}),aa(M.agent.m_config_id)&&(0,r.jsx)(X.Z,{color:"default",className:"text-xs",children:E.formatMessage({id:"workflow.tag.localModel",defaultMessage:"Local Model"})})]})})]}),(0,r.jsx)(W.ZP,{type:"text",icon:h?(0,r.jsx)(De.Z,{}):(0,r.jsx)(Ie.Z,{}),onClick:ta,title:E.formatMessage({id:h?"agent.chat.exit.fullscreen":"agent.chat.fullscreen"})}),n.operationbentate=="false"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:re,onClick:ce,className:"min-w-24",children:E.formatMessage({id:"agent.btn.savedebug"})}),(0,r.jsx)(W.ZP,{type:"primary",disabled:n.operationbentate!="false",loading:He||re,onClick:ia,className:"min-w-24",children:E.formatMessage({id:"agent.publish"})})]})]})};return(0,r.jsx)("div",{ref:Ve,className:n.iframe?"w-full":"".concat(h?"fixed inset-0 z-50  border border-gray-300 !h-screen top-[55px] left-0 bg-white p-4":"!h-[calc(100vh-65px)] p-4 !pb-0"," box-border transition-all duration-300"),style:{height:n.iframe?n.iframe.height:h?"calc(100vh - 265px)":"calc(100vh - 65px)",backgroundColor:"#fff"},children:(0,r.jsxs)(je.A,{formRef:$,submitter:!1,onFinish:sa,layout:"horizontal",initialValues:{ability_id:0},style:{height:n.iframe?n.iframe.height:"calc(100vh - 57px - 16px)"},className:"m-0 flex flex-col overflow-y-auto",children:[n.iframe?null:(0,r.jsx)(la,{}),ve?(0,r.jsx)("div",{className:"w-full flex-1 flex bg-[#fff] overflow-hidden overflow-x-auto ".concat(h?"max-w-[1400px] mx-auto justify-center":""),style:{height:n.iframe?n.iframe.height:h?"calc(100vh - 64px)":"calc(100vh - 56px)"},children:(0,r.jsx)(Me.aS,{children:(0,r.jsx)(pe.F,{agentList:{current:[M]},abilitiesList:(w=n.data)===null||w===void 0?void 0:w.abilitiesList,agentChatRoomId:ve,chatStatus:(D=n.data)===null||D===void 0||(D=D.detailList)===null||D===void 0?void 0:D.chat_status})})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(Se.Z,{description:"\u7B49\u5F85\u521B\u5EFA\u667A\u80FD\u4F53"})})]})})})}}]);
