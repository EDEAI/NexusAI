"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[439],{11551:function(ae,L,n){n.d(L,{CU:function(){return z},CY:function(){return Z},Ce:function(){return T},Dh:function(){return f},Iw:function(){return M},LH:function(){return U},My:function(){return k},Nj:function(){return H},XB:function(){return d},ek:function(){return v},pC:function(){return V},zl:function(){return R}});var W=n(15009),u=n.n(W),B=n(99289),o=n.n(B),p=n(47520),_="/v1/agent/agent_info/",S="/v1/vector/dataset_list/2",h="/v1/agent/agent_base_update/",y="/v1/agent/agent_abilities_set/",O="/v1/agent/agent_output_set/",j="/v1/agent/agent_engine_set/",b="/v1/agent/agent_publish/",c="/v1/agent/agent_run",v=function(){var m=o()(u()().mark(function i(r,s){var t;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,p.ZP)("".concat(_).concat(r),{method:"GET",data:{publish_status:s=="true"?1:0}});case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},i)}));return function(r,s){return m.apply(this,arguments)}}(),R=function(){var m=o()(u()().mark(function i(){var r;return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,p.ZP)("".concat(S),{method:"GET"});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}},i)}));return function(){return m.apply(this,arguments)}}(),d=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("".concat(h).concat(r.agent_id),{method:"PUT",data:r.data});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),M=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("".concat(y).concat(r.agent_id),{method:"PUT",data:r.data});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),T=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("".concat(O).concat(r.agent_id),{method:"PUT",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),x=null,f=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("".concat(b).concat(r),{method:"PUT"});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),U=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("".concat(c),{method:"POST",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),Z=function(){var m=o()(u()().mark(function i(r){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ZP)("/v1/agent/agent_chat_message",{method:"POST",data:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},i)}));return function(r){return m.apply(this,arguments)}}(),z=function(){var m=o()(u()().mark(function i(r,s){var t;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,p.ZP)("/v1/agent/".concat(r,"/agent_message_list"),{method:"GET",data:{page:s,page_size:20}});case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},i)}));return function(r,s){return m.apply(this,arguments)}}(),k=function(){var m=o()(u()().mark(function i(r,s){var t;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,p.ZP)("/v1/agent/".concat(r,"/agent_log_list"),{method:"GET",data:s});case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},i)}));return function(r,s){return m.apply(this,arguments)}}(),V=function(){var m=o()(u()().mark(function i(r,s){var t;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,p.ZP)("/v1/agent/".concat(r,"/agent_log_details"),{method:"GET",data:{app_run_id:s}});case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},i)}));return function(r,s){return m.apply(this,arguments)}}(),H=function(){var m=o()(u()().mark(function i(r,s){var t;return u()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,p.ZP)("/v1/agent/".concat(r,"/clear_agent_chat_memory"),{method:"POST",data:{message_id:s,agent_id:r}});case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}},i)}));return function(r,s){return m.apply(this,arguments)}}()},80459:function(ae,L,n){var W=n(32332),u=n(67294),B=n(85893),o=function(_){var S=_.width,h=S===void 0?"40px":S,y=_.bg,O=y===void 0?"#F4F8F1":y,j=_.rounded,b=j===void 0?"6px":j,c=_.data,v=_.imgWidth,R=v===void 0?"18px":v,d=_.background;c!=null&&c.avatar&&(R=h);var M=d||O;return(0,B.jsx)("div",{className:"relative flex items-center justify-center shrink-0",style:{width:h,height:h,backgroundColor:M,borderRadius:b},children:(0,B.jsx)("img",{src:c!=null&&c.avatar?c.avatar:(0,W.s9)("single",c==null?void 0:c.icon),style:{width:R,height:R,borderRadius:b},alt:""})})};L.Z=(0,u.memo)(o)},27522:function(ae,L,n){var W=n(55060),u=n(28036),B=n(69753),o=n(97245),p=n(77295),_=n(85893),S=function(O,j){try{var b=document.createElement("a");b.href=O,b.download=j,b.target="_blank",document.body.appendChild(b),b.click(),document.body.removeChild(b)}catch(c){console.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25",c)}},h=function(O){var j=O.fileList,b=O.onDownload,c=b===void 0?S:b,v=O.className,R=v===void 0?"":v,d=O.showInGrid,M=d===void 0?!1:d,T=O.maxHeight;return!j||j.length===0?null:(0,_.jsx)("div",{className:"mb-2 ".concat(R),style:{maxHeight:T,overflow:T?"auto":"visible"},children:(0,_.jsx)(W.Z.PreviewGroup,{children:(0,_.jsx)("div",{className:"".concat(M?"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4":"flex flex-col"),children:j.map(function(x,f){var U=x.path_show||x.url,Z=(0,p.CO)(x.name);return(0,_.jsx)("div",{className:"".concat(M?"":"mb-2"),children:Z?(0,_.jsxs)("div",{className:"rounded-md overflow-hidden relative group",children:[(0,_.jsx)(W.Z,{src:U,alt:x.name,className:"max-w-full max-h-40 h-auto rounded-md"}),(0,_.jsx)("div",{className:"absolute top-0 right-0 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,_.jsx)(u.ZP,{type:"primary",size:"small",icon:(0,_.jsx)(B.Z,{}),onClick:function(k){k.stopPropagation(),c(U,x.name)}})})]}):(0,_.jsxs)("div",{className:"flex items-center bg-white rounded-md p-2 text-blue-600 justify-between",children:[(0,_.jsxs)("div",{className:"flex items-center overflow-hidden",children:[(0,_.jsx)(o.Z,{className:"mr-2 flex-shrink-0"}),(0,_.jsx)("span",{className:"text-sm truncate",children:x.name})]}),(0,_.jsx)(u.ZP,{type:"text",size:"small",icon:(0,_.jsx)(B.Z,{}),onClick:function(){return c(U,x.name)},className:"ml-2 flex-shrink-0"})]})},"".concat(x.uid||x.file_id||f))})})})})};L.Z=h},39873:function(ae,L,n){var W=n(5574),u=n.n(W),B=n(42881),o=n(67294),p=n(85893),_=function(h){var y=h.children,O=h.className,j=O===void 0?"":O,b=h.dragDirection,c=b===void 0?"left":b,v=h.minWidth,R=v===void 0?415:v,d=h.maxWidth,M=d===void 0?820:d,T=h.minHeight,x=T===void 0?200:T,f=h.maxHeight,U=f===void 0?800:f,Z=h.defaultWidth,z=Z===void 0?415:Z,k=h.defaultHeight,V=k===void 0?300:k,H=h.onChange,m=(0,o.useState)(z),i=u()(m,2),r=i[0],s=i[1],t=(0,o.useState)(V),e=u()(t,2),a=e[0],A=e[1],I=(0,o.useCallback)(function(te,F){s(te),F&&A(F),H==null||H(te,F)},[s,A,H]),E=(0,B.W)({direction:["left","right"].includes(c)?"horizontal":"vertical",triggerDirection:c,minWidth:R,maxWidth:M,minHeight:x,maxHeight:U,onResize:I}),w=E.triggerRef,Y=E.containerRef;return(0,p.jsxs)("div",{ref:Y,style:{width:["left","right"].includes(c)?"".concat(r,"px"):void 0,height:["top","bottom"].includes(c)?"".concat(a,"px"):void 0},className:"flex flex-col p-4 shadow-lg rounded-md border border-blue-300 bg-white z-10 wrapPanel ".concat(j),children:[c==="left"&&(0,p.jsx)("div",{ref:w,className:"absolute top-1/2 -translate-y-1/2 -left-2 w-3 h-6 cursor-col-resize resize-x",children:(0,p.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),c==="right"&&(0,p.jsx)("div",{ref:w,className:"absolute top-1/2 -translate-y-1/2 -right-2 flex justify-end w-3 h-6 cursor-col-resize resize-x",children:(0,p.jsx)("div",{className:"w-1 h-6 bg-gray-300 rounded-sm"})}),c==="top"&&(0,p.jsx)("div",{ref:w,className:"absolute left-1/2 -translate-x-1/2 -top-2 h-3 w-6 cursor-row-resize resize-y",children:(0,p.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),c==="bottom"&&(0,p.jsx)("div",{ref:w,className:"absolute left-1/2 -translate-x-1/2 -bottom-2 h-3 w-6 cursor-row-resize resize-y",children:(0,p.jsx)("div",{className:"h-1 w-6 bg-gray-300 rounded-sm"})}),y]})};L.Z=(0,o.memo)(_)},85877:function(ae,L,n){var W=n(19632),u=n.n(W),B=n(97857),o=n.n(B),p=n(5574),_=n.n(p),S=n(52677),h=n.n(S),y=n(35312),O=n(78234),j=n(77598),b=n(96486),c=n.n(b),v=n(67294),R=n(73935),d=n(43413),M=n(92858),T=n(16845),x=n(15425),f=n(85893),U=function(t){var e=t.children;return(typeof document=="undefined"?"undefined":h()(document))==="object"?R.createPortal(e,document.body):null},Z=typeof navigator!="undefined"&&/Mac OS X/.test(navigator.userAgent),z=function(t){var e=t.value,a=t.onChange,A=t.id,I=t.placeholder,E=t.options,w=(0,y.useIntl)(),Y=(0,v.useRef)(),te=(0,v.useState)(),F=_()(te,2),N=F[0],G=F[1],re=(0,v.useState)(0),Q=_()(re,2),K=Q[0],$=Q[1],se=(0,v.useState)(""),ie=_()(se,2),oe=ie[0],X=ie[1],le=(0,v.useCallback)(function(l){return(0,f.jsx)(m,o()({},l))},[]),_e=(0,v.useCallback)(function(l){return(0,f.jsx)(H,o()({},l))},[]),D=(0,v.useMemo)(function(){return k((0,T.BU)((0,M.VC)((0,d.Jh)())))},[]),me=(0,v.useState)(null),g=_()(me,2),q=g[0],ge=g[1],xe=(0,x.Z)(function(l){return l.selectedNode}),Ie=(0,x.Z)(function(l){return l.getOutputVariables}),Oe=(0,x.Z)(function(l){return l.getInputVariables}),be=(0,v.useState)([]),pe=_()(be,2),J=pe[0],ve=pe[1];(0,O.Z)(function(){e&&e.length>0&&de(e),E!=null&&E.length&&ve(E.map(function(l){return o()(o()({},l),{},{name:l.label,id:l.value})}))}),(0,j.Z)(function(){var l=c().isEqual(q,e);l||(e&&e.length>0?de(e):e&&c().isArray(e)&&e.length==0&&de([{type:"paragraph",children:[]}]))},[e,A]),(0,j.Z)(function(){E.length&&ve(E.map(function(l){return o()(o()({},l),{},{name:l.label,id:l.value})})),console.log(E)},[E]);var de=function(P){ge(P),fe(D,{nodes:[{type:"paragraph",children:[]}]}),fe(D,{nodes:P})},Ee=(0,v.useCallback)(function(l){if(N&&J.length>0)switch(l.key){case"ArrowDown":l.preventDefault();var P=K>=J.length-1?0:K+1;$(P);return;case"ArrowUp":l.preventDefault();var C=K<=0?J.length-1:K-1;$(C);return;case"Tab":case"Enter":l.preventDefault(),d.YR.select(D,N),V(D,J[K]),G(null);return;case"Escape":l.preventDefault(),G(null);return}else if(l.key==="@"){setTimeout(function(){return Pe()},10);return}G(null)},[J,D,K,N]),fe=function(P){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ce=u()(P.children);if(ce.forEach(function(ee){return P.apply({type:"remove_node",path:[0],node:ee})}),C.nodes){var ne=d.NB.isNode(C.nodes)?[C.nodes]:C.nodes;ne.forEach(function(ee,he){return P.apply({type:"insert_node",path:[he],node:ee})})}var ue=C.at&&d.E9.isPoint(C.at)?C.at:d.ML.end(P,[]);ue&&d.YR.select(P,ue)};(0,v.useEffect)(function(){if(N&&J.length>0){var l=Y.current,P=T.F3.toDOMRange(D,N),C=P.getBoundingClientRect();l.style.top="".concat(C.top+window.pageYOffset+24,"px"),l.style.left="".concat(C.left+window.pageXOffset,"px")}},[J.length,D,K,oe,N]);var Pe=function(){var P=D.selection;if(P&&d.e6.isCollapsed(P)){var C=d.e6.edges(P),ce=_()(C,1),ne=ce[0],ue=d.ML.before(D,ne),ee=ue&&d.ML.range(D,ue,ne),he=ee&&d.ML.string(D,ee),De=d.ML.after(D,ne),Me=d.ML.range(D,ne,De),Te=d.ML.string(D,Me);G(ee),X(""),$(0);return}G(null)};return(0,f.jsxs)(T.mH,{editor:D,initialValue:r,onChange:function(P){a==null||a(P),G(null)},children:[(0,f.jsx)(T.CX,{renderElement:le,renderLeaf:_e,onKeyDown:Ee,className:"!outline-none",placeholder:I!=null?I:w.formatMessage({id:"workflow.placeholder.enterContent",defaultMessage:"\uFF0C@"})}),N&&(0,f.jsx)(U,{children:(0,f.jsx)("div",{ref:Y,style:{top:"-9999px",left:"-9999px",position:"absolute",zIndex:10,padding:"3px",background:"white",borderRadius:"4px",boxShadow:"0 1px 5px rgba(0,0,0,.2)"},className:"px-1 pt-1 z-10","data-cy":"mentions-portal",children:J.length?J.map(function(l,P){return(0,f.jsx)("div",{onClick:function(){console.log(l),d.YR.select(D,N),V(D,l),G(null)},className:"hover:bg-blue-100 text-sm mb-1",style:{padding:"1px 3px",borderRadius:"3px",cursor:"pointer",background:P===K?"#B4D5FF":""},children:(0,f.jsx)("span",{children:l.name})},l.name+P)}):(0,f.jsx)(f.Fragment,{children:w.formatMessage({id:"workflow.message.noVariablesFound",defaultMessage:""})})})})]})},k=function(t){var e=t.isInline,a=t.isVoid,A=t.markableVoid;return t.isInline=function(I){return I.type==="mention"?!0:e(I)},t.isVoid=function(I){return I.type==="mention"?!0:a(I)},t.markableVoid=function(I){return I.type==="mention"||A(I)},t},V=function(t,e){var a={type:"mention",id:(e==null?void 0:e.id)||"",character:e.name,base:e,children:[{bold:!0,text:"11111"}]};d.YR.insertNodes(t,a),d.YR.move(t)},H=function(t){var e=t.attributes,a=t.children,A=t.leaf;return(0,f.jsx)("span",o()(o()({},e),{},{children:a}))},m=function(t){var e=t.attributes,a=t.children,A=t.element;switch(A.type){case"mention":return(0,f.jsx)(i,o()({},t));default:return(0,f.jsx)("p",o()(o()({},e),{},{children:a}))}},i=function(t){var e=t.attributes,a=t.children,A=t.element,I=(0,T.vt)(),E=(0,T.UE)(),w={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:I&&E?"0 0 0 2px #B4D5FF":"none"};return A.children[0].bold&&(w.fontWeight="bold"),A.children[0].italic&&(w.fontStyle="italic"),(0,f.jsx)("span",o()(o()({},e),{},{className:"m-2",contentEditable:!1,"data-cy":"mention-".concat(A.character.replace(" ","-")),style:w,children:Z?(0,f.jsxs)(v.Fragment,{children:["1",a,"/",A.character]}):(0,f.jsxs)(v.Fragment,{children:[(0,f.jsx)("span",{children:A.character}),a]})}))},r=[{type:"paragraph",children:[{text:""}]}];L.Z=z},77295:function(ae,L,n){n.d(L,{CO:function(){return c}});var W=n(15009),u=n.n(W),B=n(19632),o=n.n(B),p=n(99289),_=n.n(p),S=n(5574),h=n.n(S),y=n(45360),O=n(35312),j=n(67294),b=n(83065),c=function(d){var M,T=(M=d.split(".").pop())===null||M===void 0?void 0:M.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(T||"")},v=function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=(0,O.useIntl)(),T=(0,j.useState)([]),x=h()(T,2),f=x[0],U=x[1],Z=(0,j.useState)(!1),z=h()(Z,2),k=z[0],V=z[1],H=d.maxSizeMB,m=H===void 0?15:H,i=d.acceptedFileTypes,r=i===void 0?".txt,.md,.pdf,.html,.xlsx,.xls,.docx,.csv,.jpg,.png,.jpeg":i,s=d.multiple,t=s===void 0?!0:s,e=function(){var E=document.createElement("input");E.type="file",E.accept=r,E.multiple=t,E.onchange=function(){var w=_()(u()().mark(function Y(te){var F,N,G,re,Q,K,$,se,ie,oe,X,le,_e,D;return u()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(F=te.target,!(F.files&&F.files.length>0)){g.next=37;break}if(V(!0),N=Array.from(F.files),G=N.filter(function(q){return q.size/1024/1024>m}),!(G.length>0)){g.next=9;break}return y.ZP.error("".concat(G.map(function(q){return q.name}).join(", ")," ").concat(M.formatMessage({id:"workflow.uploadFileErrorText"}))),V(!1),g.abrupt("return");case 9:re=[],Q=0,K=N;case 11:if(!(Q<K.length)){g.next=35;break}return $=K[Q],se=new FormData,se.append("file",$),g.prev=15,g.next=18,(0,b.M$)();case 18:return ie=g.sent,g.next=21,fetch(ie,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:se});case 21:return oe=g.sent,g.next=24,oe.json();case 24:X=g.sent,X.code===0?(y.ZP.success("".concat($.name," ").concat(M.formatMessage({id:"workflow.uploadSuccess"}))),(le=X.data)!==null&&le!==void 0&&le.file_id&&(_e=c($.name),D={name:$.name,url:X.data.file_url||"",uid:"file-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),isImage:_e,file_id:X.data.file_id,path_show:X.data.file_url||X.data.path_show||""},re.push(D))):y.ZP.error("".concat($.name," ").concat(M.formatMessage({id:"workflow.uploadFailed"}))),g.next=32;break;case 28:g.prev=28,g.t0=g.catch(15),console.error("Upload error:",g.t0),y.ZP.error("".concat($.name," ").concat(M.formatMessage({id:"workflow.uploadFailed"})));case 32:Q++,g.next=11;break;case 35:U(function(q){return[].concat(o()(q),re)}),V(!1);case 37:case"end":return g.stop()}},Y,null,[[15,28]])}));return function(Y){return w.apply(this,arguments)}}(),E.click()},a=function(E){U(function(w){return w.filter(function(Y){return Y.uid!==E})})},A=function(){U([])};return{uploadedFiles:f,setUploadedFiles:U,handleUpload:e,removeFile:a,clearFiles:A,isUploading:k}};L.ZP=v}}]);
